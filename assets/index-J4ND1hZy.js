(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const a of i)if(a.type==="childList")for(const o of a.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function n(i){const a={};return i.integrity&&(a.integrity=i.integrity),i.referrerPolicy&&(a.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?a.credentials="include":i.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function r(i){if(i.ep)return;i.ep=!0;const a=n(i);fetch(i.href,a)}})();var Rr=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Eo(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function kL(t){if(t.__esModule)return t;var e=t.default;if(typeof e=="function"){var n=function r(){return this instanceof r?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};n.prototype=e.prototype}else n={};return Object.defineProperty(n,"__esModule",{value:!0}),Object.keys(t).forEach(function(r){var i=Object.getOwnPropertyDescriptor(t,r);Object.defineProperty(n,r,i.get?i:{enumerable:!0,get:function(){return t[r]}})}),n}var OC={exports:{}},jh={},DC={exports:{}},wt={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ad=Symbol.for("react.element"),AL=Symbol.for("react.portal"),FL=Symbol.for("react.fragment"),UL=Symbol.for("react.strict_mode"),BL=Symbol.for("react.profiler"),GL=Symbol.for("react.provider"),$L=Symbol.for("react.context"),WL=Symbol.for("react.forward_ref"),zL=Symbol.for("react.suspense"),jL=Symbol.for("react.memo"),HL=Symbol.for("react.lazy"),F8=Symbol.iterator;function KL(t){return t===null||typeof t!="object"?null:(t=F8&&t[F8]||t["@@iterator"],typeof t=="function"?t:null)}var RC={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},MC=Object.assign,_C={};function zu(t,e,n){this.props=t,this.context=e,this.refs=_C,this.updater=n||RC}zu.prototype.isReactComponent={};zu.prototype.setState=function(t,e){if(typeof t!="object"&&typeof t!="function"&&t!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,t,e,"setState")};zu.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")};function bC(){}bC.prototype=zu.prototype;function yv(t,e,n){this.props=t,this.context=e,this.refs=_C,this.updater=n||RC}var Tv=yv.prototype=new bC;Tv.constructor=yv;MC(Tv,zu.prototype);Tv.isPureReactComponent=!0;var U8=Array.isArray,LC=Object.prototype.hasOwnProperty,Cv={current:null},IC={key:!0,ref:!0,__self:!0,__source:!0};function VC(t,e,n){var r,i={},a=null,o=null;if(e!=null)for(r in e.ref!==void 0&&(o=e.ref),e.key!==void 0&&(a=""+e.key),e)LC.call(e,r)&&!IC.hasOwnProperty(r)&&(i[r]=e[r]);var s=arguments.length-2;if(s===1)i.children=n;else if(1<s){for(var c=Array(s),l=0;l<s;l++)c[l]=arguments[l+2];i.children=c}if(t&&t.defaultProps)for(r in s=t.defaultProps,s)i[r]===void 0&&(i[r]=s[r]);return{$$typeof:ad,type:t,key:a,ref:o,props:i,_owner:Cv.current}}function qL(t,e){return{$$typeof:ad,type:t.type,key:e,ref:t.ref,props:t.props,_owner:t._owner}}function wv(t){return typeof t=="object"&&t!==null&&t.$$typeof===ad}function XL(t){var e={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,function(n){return e[n]})}var B8=/\/+/g;function Q2(t,e){return typeof t=="object"&&t!==null&&t.key!=null?XL(""+t.key):e.toString(36)}function A1(t,e,n,r,i){var a=typeof t;(a==="undefined"||a==="boolean")&&(t=null);var o=!1;if(t===null)o=!0;else switch(a){case"string":case"number":o=!0;break;case"object":switch(t.$$typeof){case ad:case AL:o=!0}}if(o)return o=t,i=i(o),t=r===""?"."+Q2(o,0):r,U8(i)?(n="",t!=null&&(n=t.replace(B8,"$&/")+"/"),A1(i,e,n,"",function(l){return l})):i!=null&&(wv(i)&&(i=qL(i,n+(!i.key||o&&o.key===i.key?"":(""+i.key).replace(B8,"$&/")+"/")+t)),e.push(i)),1;if(o=0,r=r===""?".":r+":",U8(t))for(var s=0;s<t.length;s++){a=t[s];var c=r+Q2(a,s);o+=A1(a,e,n,c,i)}else if(c=KL(t),typeof c=="function")for(t=c.call(t),s=0;!(a=t.next()).done;)a=a.value,c=r+Q2(a,s++),o+=A1(a,e,n,c,i);else if(a==="object")throw e=String(t),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return o}function Ld(t,e,n){if(t==null)return t;var r=[],i=0;return A1(t,r,"","",function(a){return e.call(n,a,i++)}),r}function YL(t){if(t._status===-1){var e=t._result;e=e(),e.then(function(n){(t._status===0||t._status===-1)&&(t._status=1,t._result=n)},function(n){(t._status===0||t._status===-1)&&(t._status=2,t._result=n)}),t._status===-1&&(t._status=0,t._result=e)}if(t._status===1)return t._result.default;throw t._result}var di={current:null},F1={transition:null},ZL={ReactCurrentDispatcher:di,ReactCurrentBatchConfig:F1,ReactCurrentOwner:Cv};function PC(){throw Error("act(...) is not supported in production builds of React.")}wt.Children={map:Ld,forEach:function(t,e,n){Ld(t,function(){e.apply(this,arguments)},n)},count:function(t){var e=0;return Ld(t,function(){e++}),e},toArray:function(t){return Ld(t,function(e){return e})||[]},only:function(t){if(!wv(t))throw Error("React.Children.only expected to receive a single React element child.");return t}};wt.Component=zu;wt.Fragment=FL;wt.Profiler=BL;wt.PureComponent=yv;wt.StrictMode=UL;wt.Suspense=zL;wt.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=ZL;wt.act=PC;wt.cloneElement=function(t,e,n){if(t==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+t+".");var r=MC({},t.props),i=t.key,a=t.ref,o=t._owner;if(e!=null){if(e.ref!==void 0&&(a=e.ref,o=Cv.current),e.key!==void 0&&(i=""+e.key),t.type&&t.type.defaultProps)var s=t.type.defaultProps;for(c in e)LC.call(e,c)&&!IC.hasOwnProperty(c)&&(r[c]=e[c]===void 0&&s!==void 0?s[c]:e[c])}var c=arguments.length-2;if(c===1)r.children=n;else if(1<c){s=Array(c);for(var l=0;l<c;l++)s[l]=arguments[l+2];r.children=s}return{$$typeof:ad,type:t.type,key:i,ref:a,props:r,_owner:o}};wt.createContext=function(t){return t={$$typeof:$L,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},t.Provider={$$typeof:GL,_context:t},t.Consumer=t};wt.createElement=VC;wt.createFactory=function(t){var e=VC.bind(null,t);return e.type=t,e};wt.createRef=function(){return{current:null}};wt.forwardRef=function(t){return{$$typeof:WL,render:t}};wt.isValidElement=wv;wt.lazy=function(t){return{$$typeof:HL,_payload:{_status:-1,_result:t},_init:YL}};wt.memo=function(t,e){return{$$typeof:jL,type:t,compare:e===void 0?null:e}};wt.startTransition=function(t){var e=F1.transition;F1.transition={};try{t()}finally{F1.transition=e}};wt.unstable_act=PC;wt.useCallback=function(t,e){return di.current.useCallback(t,e)};wt.useContext=function(t){return di.current.useContext(t)};wt.useDebugValue=function(){};wt.useDeferredValue=function(t){return di.current.useDeferredValue(t)};wt.useEffect=function(t,e){return di.current.useEffect(t,e)};wt.useId=function(){return di.current.useId()};wt.useImperativeHandle=function(t,e,n){return di.current.useImperativeHandle(t,e,n)};wt.useInsertionEffect=function(t,e){return di.current.useInsertionEffect(t,e)};wt.useLayoutEffect=function(t,e){return di.current.useLayoutEffect(t,e)};wt.useMemo=function(t,e){return di.current.useMemo(t,e)};wt.useReducer=function(t,e,n){return di.current.useReducer(t,e,n)};wt.useRef=function(t){return di.current.useRef(t)};wt.useState=function(t){return di.current.useState(t)};wt.useSyncExternalStore=function(t,e,n){return di.current.useSyncExternalStore(t,e,n)};wt.useTransition=function(){return di.current.useTransition()};wt.version="18.3.1";DC.exports=wt;var Fn=DC.exports;const QL=Eo(Fn);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var JL=Fn,eI=Symbol.for("react.element"),tI=Symbol.for("react.fragment"),nI=Object.prototype.hasOwnProperty,rI=JL.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,iI={key:!0,ref:!0,__self:!0,__source:!0};function NC(t,e,n){var r,i={},a=null,o=null;n!==void 0&&(a=""+n),e.key!==void 0&&(a=""+e.key),e.ref!==void 0&&(o=e.ref);for(r in e)nI.call(e,r)&&!iI.hasOwnProperty(r)&&(i[r]=e[r]);if(t&&t.defaultProps)for(r in e=t.defaultProps,e)i[r]===void 0&&(i[r]=e[r]);return{$$typeof:eI,type:t,key:a,ref:o,props:i,_owner:rI.current}}jh.Fragment=tI;jh.jsx=NC;jh.jsxs=NC;OC.exports=jh;var hr=OC.exports,xm={},kC={exports:{}},Ki={},AC={exports:{}},FC={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(t){function e(Q,q){var j=Q.length;Q.push(q);e:for(;0<j;){var ie=j-1>>>1,ue=Q[ie];if(0<i(ue,q))Q[ie]=q,Q[j]=ue,j=ie;else break e}}function n(Q){return Q.length===0?null:Q[0]}function r(Q){if(Q.length===0)return null;var q=Q[0],j=Q.pop();if(j!==q){Q[0]=j;e:for(var ie=0,ue=Q.length,le=ue>>>1;ie<le;){var Fe=2*(ie+1)-1,kt=Q[Fe],lt=Fe+1,yt=Q[lt];if(0>i(kt,j))lt<ue&&0>i(yt,kt)?(Q[ie]=yt,Q[lt]=j,ie=lt):(Q[ie]=kt,Q[Fe]=j,ie=Fe);else if(lt<ue&&0>i(yt,j))Q[ie]=yt,Q[lt]=j,ie=lt;else break e}}return q}function i(Q,q){var j=Q.sortIndex-q.sortIndex;return j!==0?j:Q.id-q.id}if(typeof performance=="object"&&typeof performance.now=="function"){var a=performance;t.unstable_now=function(){return a.now()}}else{var o=Date,s=o.now();t.unstable_now=function(){return o.now()-s}}var c=[],l=[],f=1,u=null,g=3,d=!1,h=!1,p=!1,m=typeof setTimeout=="function"?setTimeout:null,v=typeof clearTimeout=="function"?clearTimeout:null,y=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function T(Q){for(var q=n(l);q!==null;){if(q.callback===null)r(l);else if(q.startTime<=Q)r(l),q.sortIndex=q.expirationTime,e(c,q);else break;q=n(l)}}function C(Q){if(p=!1,T(Q),!h)if(n(c)!==null)h=!0,J(w);else{var q=n(l);q!==null&&de(C,q.startTime-Q)}}function w(Q,q){h=!1,p&&(p=!1,v(M),M=-1),d=!0;var j=g;try{for(T(q),u=n(c);u!==null&&(!(u.expirationTime>q)||Q&&!k());){var ie=u.callback;if(typeof ie=="function"){u.callback=null,g=u.priorityLevel;var ue=ie(u.expirationTime<=q);q=t.unstable_now(),typeof ue=="function"?u.callback=ue:u===n(c)&&r(c),T(q)}else r(c);u=n(c)}if(u!==null)var le=!0;else{var Fe=n(l);Fe!==null&&de(C,Fe.startTime-q),le=!1}return le}finally{u=null,g=j,d=!1}}var x=!1,O=null,M=-1,A=5,_=-1;function k(){return!(t.unstable_now()-_<A)}function z(){if(O!==null){var Q=t.unstable_now();_=Q;var q=!0;try{q=O(!0,Q)}finally{q?X():(x=!1,O=null)}}else x=!1}var X;if(typeof y=="function")X=function(){y(z)};else if(typeof MessageChannel<"u"){var Z=new MessageChannel,ce=Z.port2;Z.port1.onmessage=z,X=function(){ce.postMessage(null)}}else X=function(){m(z,0)};function J(Q){O=Q,x||(x=!0,X())}function de(Q,q){M=m(function(){Q(t.unstable_now())},q)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(Q){Q.callback=null},t.unstable_continueExecution=function(){h||d||(h=!0,J(w))},t.unstable_forceFrameRate=function(Q){0>Q||125<Q?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):A=0<Q?Math.floor(1e3/Q):5},t.unstable_getCurrentPriorityLevel=function(){return g},t.unstable_getFirstCallbackNode=function(){return n(c)},t.unstable_next=function(Q){switch(g){case 1:case 2:case 3:var q=3;break;default:q=g}var j=g;g=q;try{return Q()}finally{g=j}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(Q,q){switch(Q){case 1:case 2:case 3:case 4:case 5:break;default:Q=3}var j=g;g=Q;try{return q()}finally{g=j}},t.unstable_scheduleCallback=function(Q,q,j){var ie=t.unstable_now();switch(typeof j=="object"&&j!==null?(j=j.delay,j=typeof j=="number"&&0<j?ie+j:ie):j=ie,Q){case 1:var ue=-1;break;case 2:ue=250;break;case 5:ue=1073741823;break;case 4:ue=1e4;break;default:ue=5e3}return ue=j+ue,Q={id:f++,callback:q,priorityLevel:Q,startTime:j,expirationTime:ue,sortIndex:-1},j>ie?(Q.sortIndex=j,e(l,Q),n(c)===null&&Q===n(l)&&(p?(v(M),M=-1):p=!0,de(C,j-ie))):(Q.sortIndex=ue,e(c,Q),h||d||(h=!0,J(w))),Q},t.unstable_shouldYield=k,t.unstable_wrapCallback=function(Q){var q=g;return function(){var j=g;g=q;try{return Q.apply(this,arguments)}finally{g=j}}}})(FC);AC.exports=FC;var aI=AC.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var oI=Fn,ji=aI;function _e(t){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+t,n=1;n<arguments.length;n++)e+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+t+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var UC=new Set,Tg={};function ul(t,e){yu(t,e),yu(t+"Capture",e)}function yu(t,e){for(Tg[t]=e,t=0;t<e.length;t++)UC.add(e[t])}var fs=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Sm=Object.prototype.hasOwnProperty,sI=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,G8={},$8={};function cI(t){return Sm.call($8,t)?!0:Sm.call(G8,t)?!1:sI.test(t)?$8[t]=!0:(G8[t]=!0,!1)}function lI(t,e,n,r){if(n!==null&&n.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return r?!1:n!==null?!n.acceptsBooleans:(t=t.toLowerCase().slice(0,5),t!=="data-"&&t!=="aria-");default:return!1}}function uI(t,e,n,r){if(e===null||typeof e>"u"||lI(t,e,n,r))return!0;if(r)return!1;if(n!==null)switch(n.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function pi(t,e,n,r,i,a,o){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=r,this.attributeNamespace=i,this.mustUseProperty=n,this.propertyName=t,this.type=e,this.sanitizeURL=a,this.removeEmptyString=o}var Lr={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(t){Lr[t]=new pi(t,0,!1,t,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(t){var e=t[0];Lr[e]=new pi(e,1,!1,t[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(t){Lr[t]=new pi(t,2,!1,t.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(t){Lr[t]=new pi(t,2,!1,t,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(t){Lr[t]=new pi(t,3,!1,t.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(t){Lr[t]=new pi(t,3,!0,t,null,!1,!1)});["capture","download"].forEach(function(t){Lr[t]=new pi(t,4,!1,t,null,!1,!1)});["cols","rows","size","span"].forEach(function(t){Lr[t]=new pi(t,6,!1,t,null,!1,!1)});["rowSpan","start"].forEach(function(t){Lr[t]=new pi(t,5,!1,t.toLowerCase(),null,!1,!1)});var xv=/[\-:]([a-z])/g;function Sv(t){return t[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(t){var e=t.replace(xv,Sv);Lr[e]=new pi(e,1,!1,t,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(t){var e=t.replace(xv,Sv);Lr[e]=new pi(e,1,!1,t,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(t){var e=t.replace(xv,Sv);Lr[e]=new pi(e,1,!1,t,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(t){Lr[t]=new pi(t,1,!1,t.toLowerCase(),null,!1,!1)});Lr.xlinkHref=new pi("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(t){Lr[t]=new pi(t,1,!1,t.toLowerCase(),null,!0,!0)});function Ev(t,e,n,r){var i=Lr.hasOwnProperty(e)?Lr[e]:null;(i!==null?i.type!==0:r||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(uI(e,n,i,r)&&(n=null),r||i===null?cI(e)&&(n===null?t.removeAttribute(e):t.setAttribute(e,""+n)):i.mustUseProperty?t[i.propertyName]=n===null?i.type===3?!1:"":n:(e=i.attributeName,r=i.attributeNamespace,n===null?t.removeAttribute(e):(i=i.type,n=i===3||i===4&&n===!0?"":""+n,r?t.setAttributeNS(r,e,n):t.setAttribute(e,n))))}var Ts=oI.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,Id=Symbol.for("react.element"),Ll=Symbol.for("react.portal"),Il=Symbol.for("react.fragment"),Ov=Symbol.for("react.strict_mode"),Em=Symbol.for("react.profiler"),BC=Symbol.for("react.provider"),GC=Symbol.for("react.context"),Dv=Symbol.for("react.forward_ref"),Om=Symbol.for("react.suspense"),Dm=Symbol.for("react.suspense_list"),Rv=Symbol.for("react.memo"),Xs=Symbol.for("react.lazy"),$C=Symbol.for("react.offscreen"),W8=Symbol.iterator;function cf(t){return t===null||typeof t!="object"?null:(t=W8&&t[W8]||t["@@iterator"],typeof t=="function"?t:null)}var xn=Object.assign,J2;function bf(t){if(J2===void 0)try{throw Error()}catch(n){var e=n.stack.trim().match(/\n( *(at )?)/);J2=e&&e[1]||""}return`
`+J2+t}var e5=!1;function t5(t,e){if(!t||e5)return"";e5=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(l){var r=l}Reflect.construct(t,[],e)}else{try{e.call()}catch(l){r=l}t.call(e.prototype)}else{try{throw Error()}catch(l){r=l}t()}}catch(l){if(l&&r&&typeof l.stack=="string"){for(var i=l.stack.split(`
`),a=r.stack.split(`
`),o=i.length-1,s=a.length-1;1<=o&&0<=s&&i[o]!==a[s];)s--;for(;1<=o&&0<=s;o--,s--)if(i[o]!==a[s]){if(o!==1||s!==1)do if(o--,s--,0>s||i[o]!==a[s]){var c=`
`+i[o].replace(" at new "," at ");return t.displayName&&c.includes("<anonymous>")&&(c=c.replace("<anonymous>",t.displayName)),c}while(1<=o&&0<=s);break}}}finally{e5=!1,Error.prepareStackTrace=n}return(t=t?t.displayName||t.name:"")?bf(t):""}function fI(t){switch(t.tag){case 5:return bf(t.type);case 16:return bf("Lazy");case 13:return bf("Suspense");case 19:return bf("SuspenseList");case 0:case 2:case 15:return t=t5(t.type,!1),t;case 11:return t=t5(t.type.render,!1),t;case 1:return t=t5(t.type,!0),t;default:return""}}function Rm(t){if(t==null)return null;if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case Il:return"Fragment";case Ll:return"Portal";case Em:return"Profiler";case Ov:return"StrictMode";case Om:return"Suspense";case Dm:return"SuspenseList"}if(typeof t=="object")switch(t.$$typeof){case GC:return(t.displayName||"Context")+".Consumer";case BC:return(t._context.displayName||"Context")+".Provider";case Dv:var e=t.render;return t=t.displayName,t||(t=e.displayName||e.name||"",t=t!==""?"ForwardRef("+t+")":"ForwardRef"),t;case Rv:return e=t.displayName||null,e!==null?e:Rm(t.type)||"Memo";case Xs:e=t._payload,t=t._init;try{return Rm(t(e))}catch{}}return null}function gI(t){var e=t.type;switch(t.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return t=e.render,t=t.displayName||t.name||"",e.displayName||(t!==""?"ForwardRef("+t+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Rm(e);case 8:return e===Ov?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function xc(t){switch(typeof t){case"boolean":case"number":case"string":case"undefined":return t;case"object":return t;default:return""}}function WC(t){var e=t.type;return(t=t.nodeName)&&t.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function dI(t){var e=WC(t)?"checked":"value",n=Object.getOwnPropertyDescriptor(t.constructor.prototype,e),r=""+t[e];if(!t.hasOwnProperty(e)&&typeof n<"u"&&typeof n.get=="function"&&typeof n.set=="function"){var i=n.get,a=n.set;return Object.defineProperty(t,e,{configurable:!0,get:function(){return i.call(this)},set:function(o){r=""+o,a.call(this,o)}}),Object.defineProperty(t,e,{enumerable:n.enumerable}),{getValue:function(){return r},setValue:function(o){r=""+o},stopTracking:function(){t._valueTracker=null,delete t[e]}}}}function Vd(t){t._valueTracker||(t._valueTracker=dI(t))}function zC(t){if(!t)return!1;var e=t._valueTracker;if(!e)return!0;var n=e.getValue(),r="";return t&&(r=WC(t)?t.checked?"true":"false":t.value),t=r,t!==n?(e.setValue(t),!0):!1}function Dp(t){if(t=t||(typeof document<"u"?document:void 0),typeof t>"u")return null;try{return t.activeElement||t.body}catch{return t.body}}function Mm(t,e){var n=e.checked;return xn({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:n??t._wrapperState.initialChecked})}function z8(t,e){var n=e.defaultValue==null?"":e.defaultValue,r=e.checked!=null?e.checked:e.defaultChecked;n=xc(e.value!=null?e.value:n),t._wrapperState={initialChecked:r,initialValue:n,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function jC(t,e){e=e.checked,e!=null&&Ev(t,"checked",e,!1)}function _m(t,e){jC(t,e);var n=xc(e.value),r=e.type;if(n!=null)r==="number"?(n===0&&t.value===""||t.value!=n)&&(t.value=""+n):t.value!==""+n&&(t.value=""+n);else if(r==="submit"||r==="reset"){t.removeAttribute("value");return}e.hasOwnProperty("value")?bm(t,e.type,n):e.hasOwnProperty("defaultValue")&&bm(t,e.type,xc(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(t.defaultChecked=!!e.defaultChecked)}function j8(t,e,n){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var r=e.type;if(!(r!=="submit"&&r!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+t._wrapperState.initialValue,n||e===t.value||(t.value=e),t.defaultValue=e}n=t.name,n!==""&&(t.name=""),t.defaultChecked=!!t._wrapperState.initialChecked,n!==""&&(t.name=n)}function bm(t,e,n){(e!=="number"||Dp(t.ownerDocument)!==t)&&(n==null?t.defaultValue=""+t._wrapperState.initialValue:t.defaultValue!==""+n&&(t.defaultValue=""+n))}var Lf=Array.isArray;function Ql(t,e,n,r){if(t=t.options,e){e={};for(var i=0;i<n.length;i++)e["$"+n[i]]=!0;for(n=0;n<t.length;n++)i=e.hasOwnProperty("$"+t[n].value),t[n].selected!==i&&(t[n].selected=i),i&&r&&(t[n].defaultSelected=!0)}else{for(n=""+xc(n),e=null,i=0;i<t.length;i++){if(t[i].value===n){t[i].selected=!0,r&&(t[i].defaultSelected=!0);return}e!==null||t[i].disabled||(e=t[i])}e!==null&&(e.selected=!0)}}function Lm(t,e){if(e.dangerouslySetInnerHTML!=null)throw Error(_e(91));return xn({},e,{value:void 0,defaultValue:void 0,children:""+t._wrapperState.initialValue})}function H8(t,e){var n=e.value;if(n==null){if(n=e.children,e=e.defaultValue,n!=null){if(e!=null)throw Error(_e(92));if(Lf(n)){if(1<n.length)throw Error(_e(93));n=n[0]}e=n}e==null&&(e=""),n=e}t._wrapperState={initialValue:xc(n)}}function HC(t,e){var n=xc(e.value),r=xc(e.defaultValue);n!=null&&(n=""+n,n!==t.value&&(t.value=n),e.defaultValue==null&&t.defaultValue!==n&&(t.defaultValue=n)),r!=null&&(t.defaultValue=""+r)}function K8(t){var e=t.textContent;e===t._wrapperState.initialValue&&e!==""&&e!==null&&(t.value=e)}function KC(t){switch(t){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Im(t,e){return t==null||t==="http://www.w3.org/1999/xhtml"?KC(e):t==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":t}var Pd,qC=function(t){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,n,r,i){MSApp.execUnsafeLocalFunction(function(){return t(e,n,r,i)})}:t}(function(t,e){if(t.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in t)t.innerHTML=e;else{for(Pd=Pd||document.createElement("div"),Pd.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=Pd.firstChild;t.firstChild;)t.removeChild(t.firstChild);for(;e.firstChild;)t.appendChild(e.firstChild)}});function Cg(t,e){if(e){var n=t.firstChild;if(n&&n===t.lastChild&&n.nodeType===3){n.nodeValue=e;return}}t.textContent=e}var Kf={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},pI=["Webkit","ms","Moz","O"];Object.keys(Kf).forEach(function(t){pI.forEach(function(e){e=e+t.charAt(0).toUpperCase()+t.substring(1),Kf[e]=Kf[t]})});function XC(t,e,n){return e==null||typeof e=="boolean"||e===""?"":n||typeof e!="number"||e===0||Kf.hasOwnProperty(t)&&Kf[t]?(""+e).trim():e+"px"}function YC(t,e){t=t.style;for(var n in e)if(e.hasOwnProperty(n)){var r=n.indexOf("--")===0,i=XC(n,e[n],r);n==="float"&&(n="cssFloat"),r?t.setProperty(n,i):t[n]=i}}var hI=xn({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Vm(t,e){if(e){if(hI[t]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(_e(137,t));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(_e(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(_e(61))}if(e.style!=null&&typeof e.style!="object")throw Error(_e(62))}}function Pm(t,e){if(t.indexOf("-")===-1)return typeof e.is=="string";switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Nm=null;function Mv(t){return t=t.target||t.srcElement||window,t.correspondingUseElement&&(t=t.correspondingUseElement),t.nodeType===3?t.parentNode:t}var km=null,Jl=null,eu=null;function q8(t){if(t=cd(t)){if(typeof km!="function")throw Error(_e(280));var e=t.stateNode;e&&(e=Yh(e),km(t.stateNode,t.type,e))}}function ZC(t){Jl?eu?eu.push(t):eu=[t]:Jl=t}function QC(){if(Jl){var t=Jl,e=eu;if(eu=Jl=null,q8(t),e)for(t=0;t<e.length;t++)q8(e[t])}}function JC(t,e){return t(e)}function ew(){}var n5=!1;function tw(t,e,n){if(n5)return t(e,n);n5=!0;try{return JC(t,e,n)}finally{n5=!1,(Jl!==null||eu!==null)&&(ew(),QC())}}function wg(t,e){var n=t.stateNode;if(n===null)return null;var r=Yh(n);if(r===null)return null;n=r[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(t=t.type,r=!(t==="button"||t==="input"||t==="select"||t==="textarea")),t=!r;break e;default:t=!1}if(t)return null;if(n&&typeof n!="function")throw Error(_e(231,e,typeof n));return n}var Am=!1;if(fs)try{var lf={};Object.defineProperty(lf,"passive",{get:function(){Am=!0}}),window.addEventListener("test",lf,lf),window.removeEventListener("test",lf,lf)}catch{Am=!1}function mI(t,e,n,r,i,a,o,s,c){var l=Array.prototype.slice.call(arguments,3);try{e.apply(n,l)}catch(f){this.onError(f)}}var qf=!1,Rp=null,Mp=!1,Fm=null,vI={onError:function(t){qf=!0,Rp=t}};function yI(t,e,n,r,i,a,o,s,c){qf=!1,Rp=null,mI.apply(vI,arguments)}function TI(t,e,n,r,i,a,o,s,c){if(yI.apply(this,arguments),qf){if(qf){var l=Rp;qf=!1,Rp=null}else throw Error(_e(198));Mp||(Mp=!0,Fm=l)}}function fl(t){var e=t,n=t;if(t.alternate)for(;e.return;)e=e.return;else{t=e;do e=t,e.flags&4098&&(n=e.return),t=e.return;while(t)}return e.tag===3?n:null}function nw(t){if(t.tag===13){var e=t.memoizedState;if(e===null&&(t=t.alternate,t!==null&&(e=t.memoizedState)),e!==null)return e.dehydrated}return null}function X8(t){if(fl(t)!==t)throw Error(_e(188))}function CI(t){var e=t.alternate;if(!e){if(e=fl(t),e===null)throw Error(_e(188));return e!==t?null:t}for(var n=t,r=e;;){var i=n.return;if(i===null)break;var a=i.alternate;if(a===null){if(r=i.return,r!==null){n=r;continue}break}if(i.child===a.child){for(a=i.child;a;){if(a===n)return X8(i),t;if(a===r)return X8(i),e;a=a.sibling}throw Error(_e(188))}if(n.return!==r.return)n=i,r=a;else{for(var o=!1,s=i.child;s;){if(s===n){o=!0,n=i,r=a;break}if(s===r){o=!0,r=i,n=a;break}s=s.sibling}if(!o){for(s=a.child;s;){if(s===n){o=!0,n=a,r=i;break}if(s===r){o=!0,r=a,n=i;break}s=s.sibling}if(!o)throw Error(_e(189))}}if(n.alternate!==r)throw Error(_e(190))}if(n.tag!==3)throw Error(_e(188));return n.stateNode.current===n?t:e}function rw(t){return t=CI(t),t!==null?iw(t):null}function iw(t){if(t.tag===5||t.tag===6)return t;for(t=t.child;t!==null;){var e=iw(t);if(e!==null)return e;t=t.sibling}return null}var aw=ji.unstable_scheduleCallback,Y8=ji.unstable_cancelCallback,wI=ji.unstable_shouldYield,xI=ji.unstable_requestPaint,Gn=ji.unstable_now,SI=ji.unstable_getCurrentPriorityLevel,_v=ji.unstable_ImmediatePriority,ow=ji.unstable_UserBlockingPriority,_p=ji.unstable_NormalPriority,EI=ji.unstable_LowPriority,sw=ji.unstable_IdlePriority,Hh=null,lo=null;function OI(t){if(lo&&typeof lo.onCommitFiberRoot=="function")try{lo.onCommitFiberRoot(Hh,t,void 0,(t.current.flags&128)===128)}catch{}}var Ba=Math.clz32?Math.clz32:MI,DI=Math.log,RI=Math.LN2;function MI(t){return t>>>=0,t===0?32:31-(DI(t)/RI|0)|0}var Nd=64,kd=4194304;function If(t){switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return t&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return t}}function bp(t,e){var n=t.pendingLanes;if(n===0)return 0;var r=0,i=t.suspendedLanes,a=t.pingedLanes,o=n&268435455;if(o!==0){var s=o&~i;s!==0?r=If(s):(a&=o,a!==0&&(r=If(a)))}else o=n&~i,o!==0?r=If(o):a!==0&&(r=If(a));if(r===0)return 0;if(e!==0&&e!==r&&!(e&i)&&(i=r&-r,a=e&-e,i>=a||i===16&&(a&4194240)!==0))return e;if(r&4&&(r|=n&16),e=t.entangledLanes,e!==0)for(t=t.entanglements,e&=r;0<e;)n=31-Ba(e),i=1<<n,r|=t[n],e&=~i;return r}function _I(t,e){switch(t){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function bI(t,e){for(var n=t.suspendedLanes,r=t.pingedLanes,i=t.expirationTimes,a=t.pendingLanes;0<a;){var o=31-Ba(a),s=1<<o,c=i[o];c===-1?(!(s&n)||s&r)&&(i[o]=_I(s,e)):c<=e&&(t.expiredLanes|=s),a&=~s}}function Um(t){return t=t.pendingLanes&-1073741825,t!==0?t:t&1073741824?1073741824:0}function cw(){var t=Nd;return Nd<<=1,!(Nd&4194240)&&(Nd=64),t}function r5(t){for(var e=[],n=0;31>n;n++)e.push(t);return e}function od(t,e,n){t.pendingLanes|=e,e!==536870912&&(t.suspendedLanes=0,t.pingedLanes=0),t=t.eventTimes,e=31-Ba(e),t[e]=n}function LI(t,e){var n=t.pendingLanes&~e;t.pendingLanes=e,t.suspendedLanes=0,t.pingedLanes=0,t.expiredLanes&=e,t.mutableReadLanes&=e,t.entangledLanes&=e,e=t.entanglements;var r=t.eventTimes;for(t=t.expirationTimes;0<n;){var i=31-Ba(n),a=1<<i;e[i]=0,r[i]=-1,t[i]=-1,n&=~a}}function bv(t,e){var n=t.entangledLanes|=e;for(t=t.entanglements;n;){var r=31-Ba(n),i=1<<r;i&e|t[r]&e&&(t[r]|=e),n&=~i}}var Gt=0;function lw(t){return t&=-t,1<t?4<t?t&268435455?16:536870912:4:1}var uw,Lv,fw,gw,dw,Bm=!1,Ad=[],fc=null,gc=null,dc=null,xg=new Map,Sg=new Map,Js=[],II="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Z8(t,e){switch(t){case"focusin":case"focusout":fc=null;break;case"dragenter":case"dragleave":gc=null;break;case"mouseover":case"mouseout":dc=null;break;case"pointerover":case"pointerout":xg.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":Sg.delete(e.pointerId)}}function uf(t,e,n,r,i,a){return t===null||t.nativeEvent!==a?(t={blockedOn:e,domEventName:n,eventSystemFlags:r,nativeEvent:a,targetContainers:[i]},e!==null&&(e=cd(e),e!==null&&Lv(e)),t):(t.eventSystemFlags|=r,e=t.targetContainers,i!==null&&e.indexOf(i)===-1&&e.push(i),t)}function VI(t,e,n,r,i){switch(e){case"focusin":return fc=uf(fc,t,e,n,r,i),!0;case"dragenter":return gc=uf(gc,t,e,n,r,i),!0;case"mouseover":return dc=uf(dc,t,e,n,r,i),!0;case"pointerover":var a=i.pointerId;return xg.set(a,uf(xg.get(a)||null,t,e,n,r,i)),!0;case"gotpointercapture":return a=i.pointerId,Sg.set(a,uf(Sg.get(a)||null,t,e,n,r,i)),!0}return!1}function pw(t){var e=_0(t.target);if(e!==null){var n=fl(e);if(n!==null){if(e=n.tag,e===13){if(e=nw(n),e!==null){t.blockedOn=e,dw(t.priority,function(){fw(n)});return}}else if(e===3&&n.stateNode.current.memoizedState.isDehydrated){t.blockedOn=n.tag===3?n.stateNode.containerInfo:null;return}}}t.blockedOn=null}function U1(t){if(t.blockedOn!==null)return!1;for(var e=t.targetContainers;0<e.length;){var n=Gm(t.domEventName,t.eventSystemFlags,e[0],t.nativeEvent);if(n===null){n=t.nativeEvent;var r=new n.constructor(n.type,n);Nm=r,n.target.dispatchEvent(r),Nm=null}else return e=cd(n),e!==null&&Lv(e),t.blockedOn=n,!1;e.shift()}return!0}function Q8(t,e,n){U1(t)&&n.delete(e)}function PI(){Bm=!1,fc!==null&&U1(fc)&&(fc=null),gc!==null&&U1(gc)&&(gc=null),dc!==null&&U1(dc)&&(dc=null),xg.forEach(Q8),Sg.forEach(Q8)}function ff(t,e){t.blockedOn===e&&(t.blockedOn=null,Bm||(Bm=!0,ji.unstable_scheduleCallback(ji.unstable_NormalPriority,PI)))}function Eg(t){function e(i){return ff(i,t)}if(0<Ad.length){ff(Ad[0],t);for(var n=1;n<Ad.length;n++){var r=Ad[n];r.blockedOn===t&&(r.blockedOn=null)}}for(fc!==null&&ff(fc,t),gc!==null&&ff(gc,t),dc!==null&&ff(dc,t),xg.forEach(e),Sg.forEach(e),n=0;n<Js.length;n++)r=Js[n],r.blockedOn===t&&(r.blockedOn=null);for(;0<Js.length&&(n=Js[0],n.blockedOn===null);)pw(n),n.blockedOn===null&&Js.shift()}var tu=Ts.ReactCurrentBatchConfig,Lp=!0;function NI(t,e,n,r){var i=Gt,a=tu.transition;tu.transition=null;try{Gt=1,Iv(t,e,n,r)}finally{Gt=i,tu.transition=a}}function kI(t,e,n,r){var i=Gt,a=tu.transition;tu.transition=null;try{Gt=4,Iv(t,e,n,r)}finally{Gt=i,tu.transition=a}}function Iv(t,e,n,r){if(Lp){var i=Gm(t,e,n,r);if(i===null)d5(t,e,r,Ip,n),Z8(t,r);else if(VI(i,t,e,n,r))r.stopPropagation();else if(Z8(t,r),e&4&&-1<II.indexOf(t)){for(;i!==null;){var a=cd(i);if(a!==null&&uw(a),a=Gm(t,e,n,r),a===null&&d5(t,e,r,Ip,n),a===i)break;i=a}i!==null&&r.stopPropagation()}else d5(t,e,r,null,n)}}var Ip=null;function Gm(t,e,n,r){if(Ip=null,t=Mv(r),t=_0(t),t!==null)if(e=fl(t),e===null)t=null;else if(n=e.tag,n===13){if(t=nw(e),t!==null)return t;t=null}else if(n===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;t=null}else e!==t&&(t=null);return Ip=t,null}function hw(t){switch(t){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(SI()){case _v:return 1;case ow:return 4;case _p:case EI:return 16;case sw:return 536870912;default:return 16}default:return 16}}var ac=null,Vv=null,B1=null;function mw(){if(B1)return B1;var t,e=Vv,n=e.length,r,i="value"in ac?ac.value:ac.textContent,a=i.length;for(t=0;t<n&&e[t]===i[t];t++);var o=n-t;for(r=1;r<=o&&e[n-r]===i[a-r];r++);return B1=i.slice(t,1<r?1-r:void 0)}function G1(t){var e=t.keyCode;return"charCode"in t?(t=t.charCode,t===0&&e===13&&(t=13)):t=e,t===10&&(t=13),32<=t||t===13?t:0}function Fd(){return!0}function J8(){return!1}function qi(t){function e(n,r,i,a,o){this._reactName=n,this._targetInst=i,this.type=r,this.nativeEvent=a,this.target=o,this.currentTarget=null;for(var s in t)t.hasOwnProperty(s)&&(n=t[s],this[s]=n?n(a):a[s]);return this.isDefaultPrevented=(a.defaultPrevented!=null?a.defaultPrevented:a.returnValue===!1)?Fd:J8,this.isPropagationStopped=J8,this}return xn(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var n=this.nativeEvent;n&&(n.preventDefault?n.preventDefault():typeof n.returnValue!="unknown"&&(n.returnValue=!1),this.isDefaultPrevented=Fd)},stopPropagation:function(){var n=this.nativeEvent;n&&(n.stopPropagation?n.stopPropagation():typeof n.cancelBubble!="unknown"&&(n.cancelBubble=!0),this.isPropagationStopped=Fd)},persist:function(){},isPersistent:Fd}),e}var ju={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Pv=qi(ju),sd=xn({},ju,{view:0,detail:0}),AI=qi(sd),i5,a5,gf,Kh=xn({},sd,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Nv,button:0,buttons:0,relatedTarget:function(t){return t.relatedTarget===void 0?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==gf&&(gf&&t.type==="mousemove"?(i5=t.screenX-gf.screenX,a5=t.screenY-gf.screenY):a5=i5=0,gf=t),i5)},movementY:function(t){return"movementY"in t?t.movementY:a5}}),e6=qi(Kh),FI=xn({},Kh,{dataTransfer:0}),UI=qi(FI),BI=xn({},sd,{relatedTarget:0}),o5=qi(BI),GI=xn({},ju,{animationName:0,elapsedTime:0,pseudoElement:0}),$I=qi(GI),WI=xn({},ju,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),zI=qi(WI),jI=xn({},ju,{data:0}),t6=qi(jI),HI={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},KI={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},qI={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function XI(t){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(t):(t=qI[t])?!!e[t]:!1}function Nv(){return XI}var YI=xn({},sd,{key:function(t){if(t.key){var e=HI[t.key]||t.key;if(e!=="Unidentified")return e}return t.type==="keypress"?(t=G1(t),t===13?"Enter":String.fromCharCode(t)):t.type==="keydown"||t.type==="keyup"?KI[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Nv,charCode:function(t){return t.type==="keypress"?G1(t):0},keyCode:function(t){return t.type==="keydown"||t.type==="keyup"?t.keyCode:0},which:function(t){return t.type==="keypress"?G1(t):t.type==="keydown"||t.type==="keyup"?t.keyCode:0}}),ZI=qi(YI),QI=xn({},Kh,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),n6=qi(QI),JI=xn({},sd,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Nv}),eV=qi(JI),tV=xn({},ju,{propertyName:0,elapsedTime:0,pseudoElement:0}),nV=qi(tV),rV=xn({},Kh,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),iV=qi(rV),aV=[9,13,27,32],kv=fs&&"CompositionEvent"in window,Xf=null;fs&&"documentMode"in document&&(Xf=document.documentMode);var oV=fs&&"TextEvent"in window&&!Xf,vw=fs&&(!kv||Xf&&8<Xf&&11>=Xf),r6=" ",i6=!1;function yw(t,e){switch(t){case"keyup":return aV.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Tw(t){return t=t.detail,typeof t=="object"&&"data"in t?t.data:null}var Vl=!1;function sV(t,e){switch(t){case"compositionend":return Tw(e);case"keypress":return e.which!==32?null:(i6=!0,r6);case"textInput":return t=e.data,t===r6&&i6?null:t;default:return null}}function cV(t,e){if(Vl)return t==="compositionend"||!kv&&yw(t,e)?(t=mw(),B1=Vv=ac=null,Vl=!1,t):null;switch(t){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return vw&&e.locale!=="ko"?null:e.data;default:return null}}var lV={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function a6(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e==="input"?!!lV[t.type]:e==="textarea"}function Cw(t,e,n,r){ZC(r),e=Vp(e,"onChange"),0<e.length&&(n=new Pv("onChange","change",null,n,r),t.push({event:n,listeners:e}))}var Yf=null,Og=null;function uV(t){Lw(t,0)}function qh(t){var e=kl(t);if(zC(e))return t}function fV(t,e){if(t==="change")return e}var ww=!1;if(fs){var s5;if(fs){var c5="oninput"in document;if(!c5){var o6=document.createElement("div");o6.setAttribute("oninput","return;"),c5=typeof o6.oninput=="function"}s5=c5}else s5=!1;ww=s5&&(!document.documentMode||9<document.documentMode)}function s6(){Yf&&(Yf.detachEvent("onpropertychange",xw),Og=Yf=null)}function xw(t){if(t.propertyName==="value"&&qh(Og)){var e=[];Cw(e,Og,t,Mv(t)),tw(uV,e)}}function gV(t,e,n){t==="focusin"?(s6(),Yf=e,Og=n,Yf.attachEvent("onpropertychange",xw)):t==="focusout"&&s6()}function dV(t){if(t==="selectionchange"||t==="keyup"||t==="keydown")return qh(Og)}function pV(t,e){if(t==="click")return qh(e)}function hV(t,e){if(t==="input"||t==="change")return qh(e)}function mV(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var $a=typeof Object.is=="function"?Object.is:mV;function Dg(t,e){if($a(t,e))return!0;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return!1;var n=Object.keys(t),r=Object.keys(e);if(n.length!==r.length)return!1;for(r=0;r<n.length;r++){var i=n[r];if(!Sm.call(e,i)||!$a(t[i],e[i]))return!1}return!0}function c6(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function l6(t,e){var n=c6(t);t=0;for(var r;n;){if(n.nodeType===3){if(r=t+n.textContent.length,t<=e&&r>=e)return{node:n,offset:e-t};t=r}e:{for(;n;){if(n.nextSibling){n=n.nextSibling;break e}n=n.parentNode}n=void 0}n=c6(n)}}function Sw(t,e){return t&&e?t===e?!0:t&&t.nodeType===3?!1:e&&e.nodeType===3?Sw(t,e.parentNode):"contains"in t?t.contains(e):t.compareDocumentPosition?!!(t.compareDocumentPosition(e)&16):!1:!1}function Ew(){for(var t=window,e=Dp();e instanceof t.HTMLIFrameElement;){try{var n=typeof e.contentWindow.location.href=="string"}catch{n=!1}if(n)t=e.contentWindow;else break;e=Dp(t.document)}return e}function Av(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e&&(e==="input"&&(t.type==="text"||t.type==="search"||t.type==="tel"||t.type==="url"||t.type==="password")||e==="textarea"||t.contentEditable==="true")}function vV(t){var e=Ew(),n=t.focusedElem,r=t.selectionRange;if(e!==n&&n&&n.ownerDocument&&Sw(n.ownerDocument.documentElement,n)){if(r!==null&&Av(n)){if(e=r.start,t=r.end,t===void 0&&(t=e),"selectionStart"in n)n.selectionStart=e,n.selectionEnd=Math.min(t,n.value.length);else if(t=(e=n.ownerDocument||document)&&e.defaultView||window,t.getSelection){t=t.getSelection();var i=n.textContent.length,a=Math.min(r.start,i);r=r.end===void 0?a:Math.min(r.end,i),!t.extend&&a>r&&(i=r,r=a,a=i),i=l6(n,a);var o=l6(n,r);i&&o&&(t.rangeCount!==1||t.anchorNode!==i.node||t.anchorOffset!==i.offset||t.focusNode!==o.node||t.focusOffset!==o.offset)&&(e=e.createRange(),e.setStart(i.node,i.offset),t.removeAllRanges(),a>r?(t.addRange(e),t.extend(o.node,o.offset)):(e.setEnd(o.node,o.offset),t.addRange(e)))}}for(e=[],t=n;t=t.parentNode;)t.nodeType===1&&e.push({element:t,left:t.scrollLeft,top:t.scrollTop});for(typeof n.focus=="function"&&n.focus(),n=0;n<e.length;n++)t=e[n],t.element.scrollLeft=t.left,t.element.scrollTop=t.top}}var yV=fs&&"documentMode"in document&&11>=document.documentMode,Pl=null,$m=null,Zf=null,Wm=!1;function u6(t,e,n){var r=n.window===n?n.document:n.nodeType===9?n:n.ownerDocument;Wm||Pl==null||Pl!==Dp(r)||(r=Pl,"selectionStart"in r&&Av(r)?r={start:r.selectionStart,end:r.selectionEnd}:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection(),r={anchorNode:r.anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset}),Zf&&Dg(Zf,r)||(Zf=r,r=Vp($m,"onSelect"),0<r.length&&(e=new Pv("onSelect","select",null,e,n),t.push({event:e,listeners:r}),e.target=Pl)))}function Ud(t,e){var n={};return n[t.toLowerCase()]=e.toLowerCase(),n["Webkit"+t]="webkit"+e,n["Moz"+t]="moz"+e,n}var Nl={animationend:Ud("Animation","AnimationEnd"),animationiteration:Ud("Animation","AnimationIteration"),animationstart:Ud("Animation","AnimationStart"),transitionend:Ud("Transition","TransitionEnd")},l5={},Ow={};fs&&(Ow=document.createElement("div").style,"AnimationEvent"in window||(delete Nl.animationend.animation,delete Nl.animationiteration.animation,delete Nl.animationstart.animation),"TransitionEvent"in window||delete Nl.transitionend.transition);function Xh(t){if(l5[t])return l5[t];if(!Nl[t])return t;var e=Nl[t],n;for(n in e)if(e.hasOwnProperty(n)&&n in Ow)return l5[t]=e[n];return t}var Dw=Xh("animationend"),Rw=Xh("animationiteration"),Mw=Xh("animationstart"),_w=Xh("transitionend"),bw=new Map,f6="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Mc(t,e){bw.set(t,e),ul(e,[t])}for(var u5=0;u5<f6.length;u5++){var f5=f6[u5],TV=f5.toLowerCase(),CV=f5[0].toUpperCase()+f5.slice(1);Mc(TV,"on"+CV)}Mc(Dw,"onAnimationEnd");Mc(Rw,"onAnimationIteration");Mc(Mw,"onAnimationStart");Mc("dblclick","onDoubleClick");Mc("focusin","onFocus");Mc("focusout","onBlur");Mc(_w,"onTransitionEnd");yu("onMouseEnter",["mouseout","mouseover"]);yu("onMouseLeave",["mouseout","mouseover"]);yu("onPointerEnter",["pointerout","pointerover"]);yu("onPointerLeave",["pointerout","pointerover"]);ul("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));ul("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));ul("onBeforeInput",["compositionend","keypress","textInput","paste"]);ul("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));ul("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));ul("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Vf="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),wV=new Set("cancel close invalid load scroll toggle".split(" ").concat(Vf));function g6(t,e,n){var r=t.type||"unknown-event";t.currentTarget=n,TI(r,e,void 0,t),t.currentTarget=null}function Lw(t,e){e=(e&4)!==0;for(var n=0;n<t.length;n++){var r=t[n],i=r.event;r=r.listeners;e:{var a=void 0;if(e)for(var o=r.length-1;0<=o;o--){var s=r[o],c=s.instance,l=s.currentTarget;if(s=s.listener,c!==a&&i.isPropagationStopped())break e;g6(i,s,l),a=c}else for(o=0;o<r.length;o++){if(s=r[o],c=s.instance,l=s.currentTarget,s=s.listener,c!==a&&i.isPropagationStopped())break e;g6(i,s,l),a=c}}}if(Mp)throw t=Fm,Mp=!1,Fm=null,t}function Jt(t,e){var n=e[qm];n===void 0&&(n=e[qm]=new Set);var r=t+"__bubble";n.has(r)||(Iw(e,t,2,!1),n.add(r))}function g5(t,e,n){var r=0;e&&(r|=4),Iw(n,t,r,e)}var Bd="_reactListening"+Math.random().toString(36).slice(2);function Rg(t){if(!t[Bd]){t[Bd]=!0,UC.forEach(function(n){n!=="selectionchange"&&(wV.has(n)||g5(n,!1,t),g5(n,!0,t))});var e=t.nodeType===9?t:t.ownerDocument;e===null||e[Bd]||(e[Bd]=!0,g5("selectionchange",!1,e))}}function Iw(t,e,n,r){switch(hw(e)){case 1:var i=NI;break;case 4:i=kI;break;default:i=Iv}n=i.bind(null,e,n,t),i=void 0,!Am||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(i=!0),r?i!==void 0?t.addEventListener(e,n,{capture:!0,passive:i}):t.addEventListener(e,n,!0):i!==void 0?t.addEventListener(e,n,{passive:i}):t.addEventListener(e,n,!1)}function d5(t,e,n,r,i){var a=r;if(!(e&1)&&!(e&2)&&r!==null)e:for(;;){if(r===null)return;var o=r.tag;if(o===3||o===4){var s=r.stateNode.containerInfo;if(s===i||s.nodeType===8&&s.parentNode===i)break;if(o===4)for(o=r.return;o!==null;){var c=o.tag;if((c===3||c===4)&&(c=o.stateNode.containerInfo,c===i||c.nodeType===8&&c.parentNode===i))return;o=o.return}for(;s!==null;){if(o=_0(s),o===null)return;if(c=o.tag,c===5||c===6){r=a=o;continue e}s=s.parentNode}}r=r.return}tw(function(){var l=a,f=Mv(n),u=[];e:{var g=bw.get(t);if(g!==void 0){var d=Pv,h=t;switch(t){case"keypress":if(G1(n)===0)break e;case"keydown":case"keyup":d=ZI;break;case"focusin":h="focus",d=o5;break;case"focusout":h="blur",d=o5;break;case"beforeblur":case"afterblur":d=o5;break;case"click":if(n.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":d=e6;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":d=UI;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":d=eV;break;case Dw:case Rw:case Mw:d=$I;break;case _w:d=nV;break;case"scroll":d=AI;break;case"wheel":d=iV;break;case"copy":case"cut":case"paste":d=zI;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":d=n6}var p=(e&4)!==0,m=!p&&t==="scroll",v=p?g!==null?g+"Capture":null:g;p=[];for(var y=l,T;y!==null;){T=y;var C=T.stateNode;if(T.tag===5&&C!==null&&(T=C,v!==null&&(C=wg(y,v),C!=null&&p.push(Mg(y,C,T)))),m)break;y=y.return}0<p.length&&(g=new d(g,h,null,n,f),u.push({event:g,listeners:p}))}}if(!(e&7)){e:{if(g=t==="mouseover"||t==="pointerover",d=t==="mouseout"||t==="pointerout",g&&n!==Nm&&(h=n.relatedTarget||n.fromElement)&&(_0(h)||h[gs]))break e;if((d||g)&&(g=f.window===f?f:(g=f.ownerDocument)?g.defaultView||g.parentWindow:window,d?(h=n.relatedTarget||n.toElement,d=l,h=h?_0(h):null,h!==null&&(m=fl(h),h!==m||h.tag!==5&&h.tag!==6)&&(h=null)):(d=null,h=l),d!==h)){if(p=e6,C="onMouseLeave",v="onMouseEnter",y="mouse",(t==="pointerout"||t==="pointerover")&&(p=n6,C="onPointerLeave",v="onPointerEnter",y="pointer"),m=d==null?g:kl(d),T=h==null?g:kl(h),g=new p(C,y+"leave",d,n,f),g.target=m,g.relatedTarget=T,C=null,_0(f)===l&&(p=new p(v,y+"enter",h,n,f),p.target=T,p.relatedTarget=m,C=p),m=C,d&&h)t:{for(p=d,v=h,y=0,T=p;T;T=vl(T))y++;for(T=0,C=v;C;C=vl(C))T++;for(;0<y-T;)p=vl(p),y--;for(;0<T-y;)v=vl(v),T--;for(;y--;){if(p===v||v!==null&&p===v.alternate)break t;p=vl(p),v=vl(v)}p=null}else p=null;d!==null&&d6(u,g,d,p,!1),h!==null&&m!==null&&d6(u,m,h,p,!0)}}e:{if(g=l?kl(l):window,d=g.nodeName&&g.nodeName.toLowerCase(),d==="select"||d==="input"&&g.type==="file")var w=fV;else if(a6(g))if(ww)w=hV;else{w=dV;var x=gV}else(d=g.nodeName)&&d.toLowerCase()==="input"&&(g.type==="checkbox"||g.type==="radio")&&(w=pV);if(w&&(w=w(t,l))){Cw(u,w,n,f);break e}x&&x(t,g,l),t==="focusout"&&(x=g._wrapperState)&&x.controlled&&g.type==="number"&&bm(g,"number",g.value)}switch(x=l?kl(l):window,t){case"focusin":(a6(x)||x.contentEditable==="true")&&(Pl=x,$m=l,Zf=null);break;case"focusout":Zf=$m=Pl=null;break;case"mousedown":Wm=!0;break;case"contextmenu":case"mouseup":case"dragend":Wm=!1,u6(u,n,f);break;case"selectionchange":if(yV)break;case"keydown":case"keyup":u6(u,n,f)}var O;if(kv)e:{switch(t){case"compositionstart":var M="onCompositionStart";break e;case"compositionend":M="onCompositionEnd";break e;case"compositionupdate":M="onCompositionUpdate";break e}M=void 0}else Vl?yw(t,n)&&(M="onCompositionEnd"):t==="keydown"&&n.keyCode===229&&(M="onCompositionStart");M&&(vw&&n.locale!=="ko"&&(Vl||M!=="onCompositionStart"?M==="onCompositionEnd"&&Vl&&(O=mw()):(ac=f,Vv="value"in ac?ac.value:ac.textContent,Vl=!0)),x=Vp(l,M),0<x.length&&(M=new t6(M,t,null,n,f),u.push({event:M,listeners:x}),O?M.data=O:(O=Tw(n),O!==null&&(M.data=O)))),(O=oV?sV(t,n):cV(t,n))&&(l=Vp(l,"onBeforeInput"),0<l.length&&(f=new t6("onBeforeInput","beforeinput",null,n,f),u.push({event:f,listeners:l}),f.data=O))}Lw(u,e)})}function Mg(t,e,n){return{instance:t,listener:e,currentTarget:n}}function Vp(t,e){for(var n=e+"Capture",r=[];t!==null;){var i=t,a=i.stateNode;i.tag===5&&a!==null&&(i=a,a=wg(t,n),a!=null&&r.unshift(Mg(t,a,i)),a=wg(t,e),a!=null&&r.push(Mg(t,a,i))),t=t.return}return r}function vl(t){if(t===null)return null;do t=t.return;while(t&&t.tag!==5);return t||null}function d6(t,e,n,r,i){for(var a=e._reactName,o=[];n!==null&&n!==r;){var s=n,c=s.alternate,l=s.stateNode;if(c!==null&&c===r)break;s.tag===5&&l!==null&&(s=l,i?(c=wg(n,a),c!=null&&o.unshift(Mg(n,c,s))):i||(c=wg(n,a),c!=null&&o.push(Mg(n,c,s)))),n=n.return}o.length!==0&&t.push({event:e,listeners:o})}var xV=/\r\n?/g,SV=/\u0000|\uFFFD/g;function p6(t){return(typeof t=="string"?t:""+t).replace(xV,`
`).replace(SV,"")}function Gd(t,e,n){if(e=p6(e),p6(t)!==e&&n)throw Error(_e(425))}function Pp(){}var zm=null,jm=null;function Hm(t,e){return t==="textarea"||t==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var Km=typeof setTimeout=="function"?setTimeout:void 0,EV=typeof clearTimeout=="function"?clearTimeout:void 0,h6=typeof Promise=="function"?Promise:void 0,OV=typeof queueMicrotask=="function"?queueMicrotask:typeof h6<"u"?function(t){return h6.resolve(null).then(t).catch(DV)}:Km;function DV(t){setTimeout(function(){throw t})}function p5(t,e){var n=e,r=0;do{var i=n.nextSibling;if(t.removeChild(n),i&&i.nodeType===8)if(n=i.data,n==="/$"){if(r===0){t.removeChild(i),Eg(e);return}r--}else n!=="$"&&n!=="$?"&&n!=="$!"||r++;n=i}while(n);Eg(e)}function pc(t){for(;t!=null;t=t.nextSibling){var e=t.nodeType;if(e===1||e===3)break;if(e===8){if(e=t.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return t}function m6(t){t=t.previousSibling;for(var e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="$"||n==="$!"||n==="$?"){if(e===0)return t;e--}else n==="/$"&&e++}t=t.previousSibling}return null}var Hu=Math.random().toString(36).slice(2),so="__reactFiber$"+Hu,_g="__reactProps$"+Hu,gs="__reactContainer$"+Hu,qm="__reactEvents$"+Hu,RV="__reactListeners$"+Hu,MV="__reactHandles$"+Hu;function _0(t){var e=t[so];if(e)return e;for(var n=t.parentNode;n;){if(e=n[gs]||n[so]){if(n=e.alternate,e.child!==null||n!==null&&n.child!==null)for(t=m6(t);t!==null;){if(n=t[so])return n;t=m6(t)}return e}t=n,n=t.parentNode}return null}function cd(t){return t=t[so]||t[gs],!t||t.tag!==5&&t.tag!==6&&t.tag!==13&&t.tag!==3?null:t}function kl(t){if(t.tag===5||t.tag===6)return t.stateNode;throw Error(_e(33))}function Yh(t){return t[_g]||null}var Xm=[],Al=-1;function _c(t){return{current:t}}function rn(t){0>Al||(t.current=Xm[Al],Xm[Al]=null,Al--)}function qt(t,e){Al++,Xm[Al]=t.current,t.current=e}var Sc={},Wr=_c(Sc),Mi=_c(!1),j0=Sc;function Tu(t,e){var n=t.type.contextTypes;if(!n)return Sc;var r=t.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===e)return r.__reactInternalMemoizedMaskedChildContext;var i={},a;for(a in n)i[a]=e[a];return r&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=e,t.__reactInternalMemoizedMaskedChildContext=i),i}function _i(t){return t=t.childContextTypes,t!=null}function Np(){rn(Mi),rn(Wr)}function v6(t,e,n){if(Wr.current!==Sc)throw Error(_e(168));qt(Wr,e),qt(Mi,n)}function Vw(t,e,n){var r=t.stateNode;if(e=e.childContextTypes,typeof r.getChildContext!="function")return n;r=r.getChildContext();for(var i in r)if(!(i in e))throw Error(_e(108,gI(t)||"Unknown",i));return xn({},n,r)}function kp(t){return t=(t=t.stateNode)&&t.__reactInternalMemoizedMergedChildContext||Sc,j0=Wr.current,qt(Wr,t),qt(Mi,Mi.current),!0}function y6(t,e,n){var r=t.stateNode;if(!r)throw Error(_e(169));n?(t=Vw(t,e,j0),r.__reactInternalMemoizedMergedChildContext=t,rn(Mi),rn(Wr),qt(Wr,t)):rn(Mi),qt(Mi,n)}var qo=null,Zh=!1,h5=!1;function Pw(t){qo===null?qo=[t]:qo.push(t)}function _V(t){Zh=!0,Pw(t)}function bc(){if(!h5&&qo!==null){h5=!0;var t=0,e=Gt;try{var n=qo;for(Gt=1;t<n.length;t++){var r=n[t];do r=r(!0);while(r!==null)}qo=null,Zh=!1}catch(i){throw qo!==null&&(qo=qo.slice(t+1)),aw(_v,bc),i}finally{Gt=e,h5=!1}}return null}var Fl=[],Ul=0,Ap=null,Fp=0,ca=[],la=0,H0=null,Jo=1,es="";function y0(t,e){Fl[Ul++]=Fp,Fl[Ul++]=Ap,Ap=t,Fp=e}function Nw(t,e,n){ca[la++]=Jo,ca[la++]=es,ca[la++]=H0,H0=t;var r=Jo;t=es;var i=32-Ba(r)-1;r&=~(1<<i),n+=1;var a=32-Ba(e)+i;if(30<a){var o=i-i%5;a=(r&(1<<o)-1).toString(32),r>>=o,i-=o,Jo=1<<32-Ba(e)+i|n<<i|r,es=a+t}else Jo=1<<a|n<<i|r,es=t}function Fv(t){t.return!==null&&(y0(t,1),Nw(t,1,0))}function Uv(t){for(;t===Ap;)Ap=Fl[--Ul],Fl[Ul]=null,Fp=Fl[--Ul],Fl[Ul]=null;for(;t===H0;)H0=ca[--la],ca[la]=null,es=ca[--la],ca[la]=null,Jo=ca[--la],ca[la]=null}var zi=null,$i=null,ln=!1,Pa=null;function kw(t,e){var n=ga(5,null,null,0);n.elementType="DELETED",n.stateNode=e,n.return=t,e=t.deletions,e===null?(t.deletions=[n],t.flags|=16):e.push(n)}function T6(t,e){switch(t.tag){case 5:var n=t.type;return e=e.nodeType!==1||n.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(t.stateNode=e,zi=t,$i=pc(e.firstChild),!0):!1;case 6:return e=t.pendingProps===""||e.nodeType!==3?null:e,e!==null?(t.stateNode=e,zi=t,$i=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(n=H0!==null?{id:Jo,overflow:es}:null,t.memoizedState={dehydrated:e,treeContext:n,retryLane:1073741824},n=ga(18,null,null,0),n.stateNode=e,n.return=t,t.child=n,zi=t,$i=null,!0):!1;default:return!1}}function Ym(t){return(t.mode&1)!==0&&(t.flags&128)===0}function Zm(t){if(ln){var e=$i;if(e){var n=e;if(!T6(t,e)){if(Ym(t))throw Error(_e(418));e=pc(n.nextSibling);var r=zi;e&&T6(t,e)?kw(r,n):(t.flags=t.flags&-4097|2,ln=!1,zi=t)}}else{if(Ym(t))throw Error(_e(418));t.flags=t.flags&-4097|2,ln=!1,zi=t}}}function C6(t){for(t=t.return;t!==null&&t.tag!==5&&t.tag!==3&&t.tag!==13;)t=t.return;zi=t}function $d(t){if(t!==zi)return!1;if(!ln)return C6(t),ln=!0,!1;var e;if((e=t.tag!==3)&&!(e=t.tag!==5)&&(e=t.type,e=e!=="head"&&e!=="body"&&!Hm(t.type,t.memoizedProps)),e&&(e=$i)){if(Ym(t))throw Aw(),Error(_e(418));for(;e;)kw(t,e),e=pc(e.nextSibling)}if(C6(t),t.tag===13){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(_e(317));e:{for(t=t.nextSibling,e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="/$"){if(e===0){$i=pc(t.nextSibling);break e}e--}else n!=="$"&&n!=="$!"&&n!=="$?"||e++}t=t.nextSibling}$i=null}}else $i=zi?pc(t.stateNode.nextSibling):null;return!0}function Aw(){for(var t=$i;t;)t=pc(t.nextSibling)}function Cu(){$i=zi=null,ln=!1}function Bv(t){Pa===null?Pa=[t]:Pa.push(t)}var bV=Ts.ReactCurrentBatchConfig;function df(t,e,n){if(t=n.ref,t!==null&&typeof t!="function"&&typeof t!="object"){if(n._owner){if(n=n._owner,n){if(n.tag!==1)throw Error(_e(309));var r=n.stateNode}if(!r)throw Error(_e(147,t));var i=r,a=""+t;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===a?e.ref:(e=function(o){var s=i.refs;o===null?delete s[a]:s[a]=o},e._stringRef=a,e)}if(typeof t!="string")throw Error(_e(284));if(!n._owner)throw Error(_e(290,t))}return t}function Wd(t,e){throw t=Object.prototype.toString.call(e),Error(_e(31,t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t))}function w6(t){var e=t._init;return e(t._payload)}function Fw(t){function e(v,y){if(t){var T=v.deletions;T===null?(v.deletions=[y],v.flags|=16):T.push(y)}}function n(v,y){if(!t)return null;for(;y!==null;)e(v,y),y=y.sibling;return null}function r(v,y){for(v=new Map;y!==null;)y.key!==null?v.set(y.key,y):v.set(y.index,y),y=y.sibling;return v}function i(v,y){return v=yc(v,y),v.index=0,v.sibling=null,v}function a(v,y,T){return v.index=T,t?(T=v.alternate,T!==null?(T=T.index,T<y?(v.flags|=2,y):T):(v.flags|=2,y)):(v.flags|=1048576,y)}function o(v){return t&&v.alternate===null&&(v.flags|=2),v}function s(v,y,T,C){return y===null||y.tag!==6?(y=x5(T,v.mode,C),y.return=v,y):(y=i(y,T),y.return=v,y)}function c(v,y,T,C){var w=T.type;return w===Il?f(v,y,T.props.children,C,T.key):y!==null&&(y.elementType===w||typeof w=="object"&&w!==null&&w.$$typeof===Xs&&w6(w)===y.type)?(C=i(y,T.props),C.ref=df(v,y,T),C.return=v,C):(C=q1(T.type,T.key,T.props,null,v.mode,C),C.ref=df(v,y,T),C.return=v,C)}function l(v,y,T,C){return y===null||y.tag!==4||y.stateNode.containerInfo!==T.containerInfo||y.stateNode.implementation!==T.implementation?(y=S5(T,v.mode,C),y.return=v,y):(y=i(y,T.children||[]),y.return=v,y)}function f(v,y,T,C,w){return y===null||y.tag!==7?(y=U0(T,v.mode,C,w),y.return=v,y):(y=i(y,T),y.return=v,y)}function u(v,y,T){if(typeof y=="string"&&y!==""||typeof y=="number")return y=x5(""+y,v.mode,T),y.return=v,y;if(typeof y=="object"&&y!==null){switch(y.$$typeof){case Id:return T=q1(y.type,y.key,y.props,null,v.mode,T),T.ref=df(v,null,y),T.return=v,T;case Ll:return y=S5(y,v.mode,T),y.return=v,y;case Xs:var C=y._init;return u(v,C(y._payload),T)}if(Lf(y)||cf(y))return y=U0(y,v.mode,T,null),y.return=v,y;Wd(v,y)}return null}function g(v,y,T,C){var w=y!==null?y.key:null;if(typeof T=="string"&&T!==""||typeof T=="number")return w!==null?null:s(v,y,""+T,C);if(typeof T=="object"&&T!==null){switch(T.$$typeof){case Id:return T.key===w?c(v,y,T,C):null;case Ll:return T.key===w?l(v,y,T,C):null;case Xs:return w=T._init,g(v,y,w(T._payload),C)}if(Lf(T)||cf(T))return w!==null?null:f(v,y,T,C,null);Wd(v,T)}return null}function d(v,y,T,C,w){if(typeof C=="string"&&C!==""||typeof C=="number")return v=v.get(T)||null,s(y,v,""+C,w);if(typeof C=="object"&&C!==null){switch(C.$$typeof){case Id:return v=v.get(C.key===null?T:C.key)||null,c(y,v,C,w);case Ll:return v=v.get(C.key===null?T:C.key)||null,l(y,v,C,w);case Xs:var x=C._init;return d(v,y,T,x(C._payload),w)}if(Lf(C)||cf(C))return v=v.get(T)||null,f(y,v,C,w,null);Wd(y,C)}return null}function h(v,y,T,C){for(var w=null,x=null,O=y,M=y=0,A=null;O!==null&&M<T.length;M++){O.index>M?(A=O,O=null):A=O.sibling;var _=g(v,O,T[M],C);if(_===null){O===null&&(O=A);break}t&&O&&_.alternate===null&&e(v,O),y=a(_,y,M),x===null?w=_:x.sibling=_,x=_,O=A}if(M===T.length)return n(v,O),ln&&y0(v,M),w;if(O===null){for(;M<T.length;M++)O=u(v,T[M],C),O!==null&&(y=a(O,y,M),x===null?w=O:x.sibling=O,x=O);return ln&&y0(v,M),w}for(O=r(v,O);M<T.length;M++)A=d(O,v,M,T[M],C),A!==null&&(t&&A.alternate!==null&&O.delete(A.key===null?M:A.key),y=a(A,y,M),x===null?w=A:x.sibling=A,x=A);return t&&O.forEach(function(k){return e(v,k)}),ln&&y0(v,M),w}function p(v,y,T,C){var w=cf(T);if(typeof w!="function")throw Error(_e(150));if(T=w.call(T),T==null)throw Error(_e(151));for(var x=w=null,O=y,M=y=0,A=null,_=T.next();O!==null&&!_.done;M++,_=T.next()){O.index>M?(A=O,O=null):A=O.sibling;var k=g(v,O,_.value,C);if(k===null){O===null&&(O=A);break}t&&O&&k.alternate===null&&e(v,O),y=a(k,y,M),x===null?w=k:x.sibling=k,x=k,O=A}if(_.done)return n(v,O),ln&&y0(v,M),w;if(O===null){for(;!_.done;M++,_=T.next())_=u(v,_.value,C),_!==null&&(y=a(_,y,M),x===null?w=_:x.sibling=_,x=_);return ln&&y0(v,M),w}for(O=r(v,O);!_.done;M++,_=T.next())_=d(O,v,M,_.value,C),_!==null&&(t&&_.alternate!==null&&O.delete(_.key===null?M:_.key),y=a(_,y,M),x===null?w=_:x.sibling=_,x=_);return t&&O.forEach(function(z){return e(v,z)}),ln&&y0(v,M),w}function m(v,y,T,C){if(typeof T=="object"&&T!==null&&T.type===Il&&T.key===null&&(T=T.props.children),typeof T=="object"&&T!==null){switch(T.$$typeof){case Id:e:{for(var w=T.key,x=y;x!==null;){if(x.key===w){if(w=T.type,w===Il){if(x.tag===7){n(v,x.sibling),y=i(x,T.props.children),y.return=v,v=y;break e}}else if(x.elementType===w||typeof w=="object"&&w!==null&&w.$$typeof===Xs&&w6(w)===x.type){n(v,x.sibling),y=i(x,T.props),y.ref=df(v,x,T),y.return=v,v=y;break e}n(v,x);break}else e(v,x);x=x.sibling}T.type===Il?(y=U0(T.props.children,v.mode,C,T.key),y.return=v,v=y):(C=q1(T.type,T.key,T.props,null,v.mode,C),C.ref=df(v,y,T),C.return=v,v=C)}return o(v);case Ll:e:{for(x=T.key;y!==null;){if(y.key===x)if(y.tag===4&&y.stateNode.containerInfo===T.containerInfo&&y.stateNode.implementation===T.implementation){n(v,y.sibling),y=i(y,T.children||[]),y.return=v,v=y;break e}else{n(v,y);break}else e(v,y);y=y.sibling}y=S5(T,v.mode,C),y.return=v,v=y}return o(v);case Xs:return x=T._init,m(v,y,x(T._payload),C)}if(Lf(T))return h(v,y,T,C);if(cf(T))return p(v,y,T,C);Wd(v,T)}return typeof T=="string"&&T!==""||typeof T=="number"?(T=""+T,y!==null&&y.tag===6?(n(v,y.sibling),y=i(y,T),y.return=v,v=y):(n(v,y),y=x5(T,v.mode,C),y.return=v,v=y),o(v)):n(v,y)}return m}var wu=Fw(!0),Uw=Fw(!1),Up=_c(null),Bp=null,Bl=null,Gv=null;function $v(){Gv=Bl=Bp=null}function Wv(t){var e=Up.current;rn(Up),t._currentValue=e}function Qm(t,e,n){for(;t!==null;){var r=t.alternate;if((t.childLanes&e)!==e?(t.childLanes|=e,r!==null&&(r.childLanes|=e)):r!==null&&(r.childLanes&e)!==e&&(r.childLanes|=e),t===n)break;t=t.return}}function nu(t,e){Bp=t,Gv=Bl=null,t=t.dependencies,t!==null&&t.firstContext!==null&&(t.lanes&e&&(Di=!0),t.firstContext=null)}function ma(t){var e=t._currentValue;if(Gv!==t)if(t={context:t,memoizedValue:e,next:null},Bl===null){if(Bp===null)throw Error(_e(308));Bl=t,Bp.dependencies={lanes:0,firstContext:t}}else Bl=Bl.next=t;return e}var b0=null;function zv(t){b0===null?b0=[t]:b0.push(t)}function Bw(t,e,n,r){var i=e.interleaved;return i===null?(n.next=n,zv(e)):(n.next=i.next,i.next=n),e.interleaved=n,ds(t,r)}function ds(t,e){t.lanes|=e;var n=t.alternate;for(n!==null&&(n.lanes|=e),n=t,t=t.return;t!==null;)t.childLanes|=e,n=t.alternate,n!==null&&(n.childLanes|=e),n=t,t=t.return;return n.tag===3?n.stateNode:null}var Ys=!1;function jv(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Gw(t,e){t=t.updateQueue,e.updateQueue===t&&(e.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,effects:t.effects})}function rs(t,e){return{eventTime:t,lane:e,tag:0,payload:null,callback:null,next:null}}function hc(t,e,n){var r=t.updateQueue;if(r===null)return null;if(r=r.shared,Vt&2){var i=r.pending;return i===null?e.next=e:(e.next=i.next,i.next=e),r.pending=e,ds(t,n)}return i=r.interleaved,i===null?(e.next=e,zv(r)):(e.next=i.next,i.next=e),r.interleaved=e,ds(t,n)}function $1(t,e,n){if(e=e.updateQueue,e!==null&&(e=e.shared,(n&4194240)!==0)){var r=e.lanes;r&=t.pendingLanes,n|=r,e.lanes=n,bv(t,n)}}function x6(t,e){var n=t.updateQueue,r=t.alternate;if(r!==null&&(r=r.updateQueue,n===r)){var i=null,a=null;if(n=n.firstBaseUpdate,n!==null){do{var o={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};a===null?i=a=o:a=a.next=o,n=n.next}while(n!==null);a===null?i=a=e:a=a.next=e}else i=a=e;n={baseState:r.baseState,firstBaseUpdate:i,lastBaseUpdate:a,shared:r.shared,effects:r.effects},t.updateQueue=n;return}t=n.lastBaseUpdate,t===null?n.firstBaseUpdate=e:t.next=e,n.lastBaseUpdate=e}function Gp(t,e,n,r){var i=t.updateQueue;Ys=!1;var a=i.firstBaseUpdate,o=i.lastBaseUpdate,s=i.shared.pending;if(s!==null){i.shared.pending=null;var c=s,l=c.next;c.next=null,o===null?a=l:o.next=l,o=c;var f=t.alternate;f!==null&&(f=f.updateQueue,s=f.lastBaseUpdate,s!==o&&(s===null?f.firstBaseUpdate=l:s.next=l,f.lastBaseUpdate=c))}if(a!==null){var u=i.baseState;o=0,f=l=c=null,s=a;do{var g=s.lane,d=s.eventTime;if((r&g)===g){f!==null&&(f=f.next={eventTime:d,lane:0,tag:s.tag,payload:s.payload,callback:s.callback,next:null});e:{var h=t,p=s;switch(g=e,d=n,p.tag){case 1:if(h=p.payload,typeof h=="function"){u=h.call(d,u,g);break e}u=h;break e;case 3:h.flags=h.flags&-65537|128;case 0:if(h=p.payload,g=typeof h=="function"?h.call(d,u,g):h,g==null)break e;u=xn({},u,g);break e;case 2:Ys=!0}}s.callback!==null&&s.lane!==0&&(t.flags|=64,g=i.effects,g===null?i.effects=[s]:g.push(s))}else d={eventTime:d,lane:g,tag:s.tag,payload:s.payload,callback:s.callback,next:null},f===null?(l=f=d,c=u):f=f.next=d,o|=g;if(s=s.next,s===null){if(s=i.shared.pending,s===null)break;g=s,s=g.next,g.next=null,i.lastBaseUpdate=g,i.shared.pending=null}}while(!0);if(f===null&&(c=u),i.baseState=c,i.firstBaseUpdate=l,i.lastBaseUpdate=f,e=i.shared.interleaved,e!==null){i=e;do o|=i.lane,i=i.next;while(i!==e)}else a===null&&(i.shared.lanes=0);q0|=o,t.lanes=o,t.memoizedState=u}}function S6(t,e,n){if(t=e.effects,e.effects=null,t!==null)for(e=0;e<t.length;e++){var r=t[e],i=r.callback;if(i!==null){if(r.callback=null,r=n,typeof i!="function")throw Error(_e(191,i));i.call(r)}}}var ld={},uo=_c(ld),bg=_c(ld),Lg=_c(ld);function L0(t){if(t===ld)throw Error(_e(174));return t}function Hv(t,e){switch(qt(Lg,e),qt(bg,t),qt(uo,ld),t=e.nodeType,t){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:Im(null,"");break;default:t=t===8?e.parentNode:e,e=t.namespaceURI||null,t=t.tagName,e=Im(e,t)}rn(uo),qt(uo,e)}function xu(){rn(uo),rn(bg),rn(Lg)}function $w(t){L0(Lg.current);var e=L0(uo.current),n=Im(e,t.type);e!==n&&(qt(bg,t),qt(uo,n))}function Kv(t){bg.current===t&&(rn(uo),rn(bg))}var yn=_c(0);function $p(t){for(var e=t;e!==null;){if(e.tag===13){var n=e.memoizedState;if(n!==null&&(n=n.dehydrated,n===null||n.data==="$?"||n.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var m5=[];function qv(){for(var t=0;t<m5.length;t++)m5[t]._workInProgressVersionPrimary=null;m5.length=0}var W1=Ts.ReactCurrentDispatcher,v5=Ts.ReactCurrentBatchConfig,K0=0,Tn=null,ir=null,mr=null,Wp=!1,Qf=!1,Ig=0,LV=0;function Ar(){throw Error(_e(321))}function Xv(t,e){if(e===null)return!1;for(var n=0;n<e.length&&n<t.length;n++)if(!$a(t[n],e[n]))return!1;return!0}function Yv(t,e,n,r,i,a){if(K0=a,Tn=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,W1.current=t===null||t.memoizedState===null?NV:kV,t=n(r,i),Qf){a=0;do{if(Qf=!1,Ig=0,25<=a)throw Error(_e(301));a+=1,mr=ir=null,e.updateQueue=null,W1.current=AV,t=n(r,i)}while(Qf)}if(W1.current=zp,e=ir!==null&&ir.next!==null,K0=0,mr=ir=Tn=null,Wp=!1,e)throw Error(_e(300));return t}function Zv(){var t=Ig!==0;return Ig=0,t}function ao(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return mr===null?Tn.memoizedState=mr=t:mr=mr.next=t,mr}function va(){if(ir===null){var t=Tn.alternate;t=t!==null?t.memoizedState:null}else t=ir.next;var e=mr===null?Tn.memoizedState:mr.next;if(e!==null)mr=e,ir=t;else{if(t===null)throw Error(_e(310));ir=t,t={memoizedState:ir.memoizedState,baseState:ir.baseState,baseQueue:ir.baseQueue,queue:ir.queue,next:null},mr===null?Tn.memoizedState=mr=t:mr=mr.next=t}return mr}function Vg(t,e){return typeof e=="function"?e(t):e}function y5(t){var e=va(),n=e.queue;if(n===null)throw Error(_e(311));n.lastRenderedReducer=t;var r=ir,i=r.baseQueue,a=n.pending;if(a!==null){if(i!==null){var o=i.next;i.next=a.next,a.next=o}r.baseQueue=i=a,n.pending=null}if(i!==null){a=i.next,r=r.baseState;var s=o=null,c=null,l=a;do{var f=l.lane;if((K0&f)===f)c!==null&&(c=c.next={lane:0,action:l.action,hasEagerState:l.hasEagerState,eagerState:l.eagerState,next:null}),r=l.hasEagerState?l.eagerState:t(r,l.action);else{var u={lane:f,action:l.action,hasEagerState:l.hasEagerState,eagerState:l.eagerState,next:null};c===null?(s=c=u,o=r):c=c.next=u,Tn.lanes|=f,q0|=f}l=l.next}while(l!==null&&l!==a);c===null?o=r:c.next=s,$a(r,e.memoizedState)||(Di=!0),e.memoizedState=r,e.baseState=o,e.baseQueue=c,n.lastRenderedState=r}if(t=n.interleaved,t!==null){i=t;do a=i.lane,Tn.lanes|=a,q0|=a,i=i.next;while(i!==t)}else i===null&&(n.lanes=0);return[e.memoizedState,n.dispatch]}function T5(t){var e=va(),n=e.queue;if(n===null)throw Error(_e(311));n.lastRenderedReducer=t;var r=n.dispatch,i=n.pending,a=e.memoizedState;if(i!==null){n.pending=null;var o=i=i.next;do a=t(a,o.action),o=o.next;while(o!==i);$a(a,e.memoizedState)||(Di=!0),e.memoizedState=a,e.baseQueue===null&&(e.baseState=a),n.lastRenderedState=a}return[a,r]}function Ww(){}function zw(t,e){var n=Tn,r=va(),i=e(),a=!$a(r.memoizedState,i);if(a&&(r.memoizedState=i,Di=!0),r=r.queue,Qv(Kw.bind(null,n,r,t),[t]),r.getSnapshot!==e||a||mr!==null&&mr.memoizedState.tag&1){if(n.flags|=2048,Pg(9,Hw.bind(null,n,r,i,e),void 0,null),Tr===null)throw Error(_e(349));K0&30||jw(n,e,i)}return i}function jw(t,e,n){t.flags|=16384,t={getSnapshot:e,value:n},e=Tn.updateQueue,e===null?(e={lastEffect:null,stores:null},Tn.updateQueue=e,e.stores=[t]):(n=e.stores,n===null?e.stores=[t]:n.push(t))}function Hw(t,e,n,r){e.value=n,e.getSnapshot=r,qw(e)&&Xw(t)}function Kw(t,e,n){return n(function(){qw(e)&&Xw(t)})}function qw(t){var e=t.getSnapshot;t=t.value;try{var n=e();return!$a(t,n)}catch{return!0}}function Xw(t){var e=ds(t,1);e!==null&&Ga(e,t,1,-1)}function E6(t){var e=ao();return typeof t=="function"&&(t=t()),e.memoizedState=e.baseState=t,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Vg,lastRenderedState:t},e.queue=t,t=t.dispatch=PV.bind(null,Tn,t),[e.memoizedState,t]}function Pg(t,e,n,r){return t={tag:t,create:e,destroy:n,deps:r,next:null},e=Tn.updateQueue,e===null?(e={lastEffect:null,stores:null},Tn.updateQueue=e,e.lastEffect=t.next=t):(n=e.lastEffect,n===null?e.lastEffect=t.next=t:(r=n.next,n.next=t,t.next=r,e.lastEffect=t)),t}function Yw(){return va().memoizedState}function z1(t,e,n,r){var i=ao();Tn.flags|=t,i.memoizedState=Pg(1|e,n,void 0,r===void 0?null:r)}function Qh(t,e,n,r){var i=va();r=r===void 0?null:r;var a=void 0;if(ir!==null){var o=ir.memoizedState;if(a=o.destroy,r!==null&&Xv(r,o.deps)){i.memoizedState=Pg(e,n,a,r);return}}Tn.flags|=t,i.memoizedState=Pg(1|e,n,a,r)}function O6(t,e){return z1(8390656,8,t,e)}function Qv(t,e){return Qh(2048,8,t,e)}function Zw(t,e){return Qh(4,2,t,e)}function Qw(t,e){return Qh(4,4,t,e)}function Jw(t,e){if(typeof e=="function")return t=t(),e(t),function(){e(null)};if(e!=null)return t=t(),e.current=t,function(){e.current=null}}function ex(t,e,n){return n=n!=null?n.concat([t]):null,Qh(4,4,Jw.bind(null,e,t),n)}function Jv(){}function tx(t,e){var n=va();e=e===void 0?null:e;var r=n.memoizedState;return r!==null&&e!==null&&Xv(e,r[1])?r[0]:(n.memoizedState=[t,e],t)}function nx(t,e){var n=va();e=e===void 0?null:e;var r=n.memoizedState;return r!==null&&e!==null&&Xv(e,r[1])?r[0]:(t=t(),n.memoizedState=[t,e],t)}function rx(t,e,n){return K0&21?($a(n,e)||(n=cw(),Tn.lanes|=n,q0|=n,t.baseState=!0),e):(t.baseState&&(t.baseState=!1,Di=!0),t.memoizedState=n)}function IV(t,e){var n=Gt;Gt=n!==0&&4>n?n:4,t(!0);var r=v5.transition;v5.transition={};try{t(!1),e()}finally{Gt=n,v5.transition=r}}function ix(){return va().memoizedState}function VV(t,e,n){var r=vc(t);if(n={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null},ax(t))ox(e,n);else if(n=Bw(t,e,n,r),n!==null){var i=fi();Ga(n,t,r,i),sx(n,e,r)}}function PV(t,e,n){var r=vc(t),i={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null};if(ax(t))ox(e,i);else{var a=t.alternate;if(t.lanes===0&&(a===null||a.lanes===0)&&(a=e.lastRenderedReducer,a!==null))try{var o=e.lastRenderedState,s=a(o,n);if(i.hasEagerState=!0,i.eagerState=s,$a(s,o)){var c=e.interleaved;c===null?(i.next=i,zv(e)):(i.next=c.next,c.next=i),e.interleaved=i;return}}catch{}finally{}n=Bw(t,e,i,r),n!==null&&(i=fi(),Ga(n,t,r,i),sx(n,e,r))}}function ax(t){var e=t.alternate;return t===Tn||e!==null&&e===Tn}function ox(t,e){Qf=Wp=!0;var n=t.pending;n===null?e.next=e:(e.next=n.next,n.next=e),t.pending=e}function sx(t,e,n){if(n&4194240){var r=e.lanes;r&=t.pendingLanes,n|=r,e.lanes=n,bv(t,n)}}var zp={readContext:ma,useCallback:Ar,useContext:Ar,useEffect:Ar,useImperativeHandle:Ar,useInsertionEffect:Ar,useLayoutEffect:Ar,useMemo:Ar,useReducer:Ar,useRef:Ar,useState:Ar,useDebugValue:Ar,useDeferredValue:Ar,useTransition:Ar,useMutableSource:Ar,useSyncExternalStore:Ar,useId:Ar,unstable_isNewReconciler:!1},NV={readContext:ma,useCallback:function(t,e){return ao().memoizedState=[t,e===void 0?null:e],t},useContext:ma,useEffect:O6,useImperativeHandle:function(t,e,n){return n=n!=null?n.concat([t]):null,z1(4194308,4,Jw.bind(null,e,t),n)},useLayoutEffect:function(t,e){return z1(4194308,4,t,e)},useInsertionEffect:function(t,e){return z1(4,2,t,e)},useMemo:function(t,e){var n=ao();return e=e===void 0?null:e,t=t(),n.memoizedState=[t,e],t},useReducer:function(t,e,n){var r=ao();return e=n!==void 0?n(e):e,r.memoizedState=r.baseState=e,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:e},r.queue=t,t=t.dispatch=VV.bind(null,Tn,t),[r.memoizedState,t]},useRef:function(t){var e=ao();return t={current:t},e.memoizedState=t},useState:E6,useDebugValue:Jv,useDeferredValue:function(t){return ao().memoizedState=t},useTransition:function(){var t=E6(!1),e=t[0];return t=IV.bind(null,t[1]),ao().memoizedState=t,[e,t]},useMutableSource:function(){},useSyncExternalStore:function(t,e,n){var r=Tn,i=ao();if(ln){if(n===void 0)throw Error(_e(407));n=n()}else{if(n=e(),Tr===null)throw Error(_e(349));K0&30||jw(r,e,n)}i.memoizedState=n;var a={value:n,getSnapshot:e};return i.queue=a,O6(Kw.bind(null,r,a,t),[t]),r.flags|=2048,Pg(9,Hw.bind(null,r,a,n,e),void 0,null),n},useId:function(){var t=ao(),e=Tr.identifierPrefix;if(ln){var n=es,r=Jo;n=(r&~(1<<32-Ba(r)-1)).toString(32)+n,e=":"+e+"R"+n,n=Ig++,0<n&&(e+="H"+n.toString(32)),e+=":"}else n=LV++,e=":"+e+"r"+n.toString(32)+":";return t.memoizedState=e},unstable_isNewReconciler:!1},kV={readContext:ma,useCallback:tx,useContext:ma,useEffect:Qv,useImperativeHandle:ex,useInsertionEffect:Zw,useLayoutEffect:Qw,useMemo:nx,useReducer:y5,useRef:Yw,useState:function(){return y5(Vg)},useDebugValue:Jv,useDeferredValue:function(t){var e=va();return rx(e,ir.memoizedState,t)},useTransition:function(){var t=y5(Vg)[0],e=va().memoizedState;return[t,e]},useMutableSource:Ww,useSyncExternalStore:zw,useId:ix,unstable_isNewReconciler:!1},AV={readContext:ma,useCallback:tx,useContext:ma,useEffect:Qv,useImperativeHandle:ex,useInsertionEffect:Zw,useLayoutEffect:Qw,useMemo:nx,useReducer:T5,useRef:Yw,useState:function(){return T5(Vg)},useDebugValue:Jv,useDeferredValue:function(t){var e=va();return ir===null?e.memoizedState=t:rx(e,ir.memoizedState,t)},useTransition:function(){var t=T5(Vg)[0],e=va().memoizedState;return[t,e]},useMutableSource:Ww,useSyncExternalStore:zw,useId:ix,unstable_isNewReconciler:!1};function La(t,e){if(t&&t.defaultProps){e=xn({},e),t=t.defaultProps;for(var n in t)e[n]===void 0&&(e[n]=t[n]);return e}return e}function Jm(t,e,n,r){e=t.memoizedState,n=n(r,e),n=n==null?e:xn({},e,n),t.memoizedState=n,t.lanes===0&&(t.updateQueue.baseState=n)}var Jh={isMounted:function(t){return(t=t._reactInternals)?fl(t)===t:!1},enqueueSetState:function(t,e,n){t=t._reactInternals;var r=fi(),i=vc(t),a=rs(r,i);a.payload=e,n!=null&&(a.callback=n),e=hc(t,a,i),e!==null&&(Ga(e,t,i,r),$1(e,t,i))},enqueueReplaceState:function(t,e,n){t=t._reactInternals;var r=fi(),i=vc(t),a=rs(r,i);a.tag=1,a.payload=e,n!=null&&(a.callback=n),e=hc(t,a,i),e!==null&&(Ga(e,t,i,r),$1(e,t,i))},enqueueForceUpdate:function(t,e){t=t._reactInternals;var n=fi(),r=vc(t),i=rs(n,r);i.tag=2,e!=null&&(i.callback=e),e=hc(t,i,r),e!==null&&(Ga(e,t,r,n),$1(e,t,r))}};function D6(t,e,n,r,i,a,o){return t=t.stateNode,typeof t.shouldComponentUpdate=="function"?t.shouldComponentUpdate(r,a,o):e.prototype&&e.prototype.isPureReactComponent?!Dg(n,r)||!Dg(i,a):!0}function cx(t,e,n){var r=!1,i=Sc,a=e.contextType;return typeof a=="object"&&a!==null?a=ma(a):(i=_i(e)?j0:Wr.current,r=e.contextTypes,a=(r=r!=null)?Tu(t,i):Sc),e=new e(n,a),t.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=Jh,t.stateNode=e,e._reactInternals=t,r&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=i,t.__reactInternalMemoizedMaskedChildContext=a),e}function R6(t,e,n,r){t=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(n,r),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(n,r),e.state!==t&&Jh.enqueueReplaceState(e,e.state,null)}function e3(t,e,n,r){var i=t.stateNode;i.props=n,i.state=t.memoizedState,i.refs={},jv(t);var a=e.contextType;typeof a=="object"&&a!==null?i.context=ma(a):(a=_i(e)?j0:Wr.current,i.context=Tu(t,a)),i.state=t.memoizedState,a=e.getDerivedStateFromProps,typeof a=="function"&&(Jm(t,e,a,n),i.state=t.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof i.getSnapshotBeforeUpdate=="function"||typeof i.UNSAFE_componentWillMount!="function"&&typeof i.componentWillMount!="function"||(e=i.state,typeof i.componentWillMount=="function"&&i.componentWillMount(),typeof i.UNSAFE_componentWillMount=="function"&&i.UNSAFE_componentWillMount(),e!==i.state&&Jh.enqueueReplaceState(i,i.state,null),Gp(t,n,i,r),i.state=t.memoizedState),typeof i.componentDidMount=="function"&&(t.flags|=4194308)}function Su(t,e){try{var n="",r=e;do n+=fI(r),r=r.return;while(r);var i=n}catch(a){i=`
Error generating stack: `+a.message+`
`+a.stack}return{value:t,source:e,stack:i,digest:null}}function C5(t,e,n){return{value:t,source:null,stack:n??null,digest:e??null}}function t3(t,e){try{console.error(e.value)}catch(n){setTimeout(function(){throw n})}}var FV=typeof WeakMap=="function"?WeakMap:Map;function lx(t,e,n){n=rs(-1,n),n.tag=3,n.payload={element:null};var r=e.value;return n.callback=function(){Hp||(Hp=!0,f3=r),t3(t,e)},n}function ux(t,e,n){n=rs(-1,n),n.tag=3;var r=t.type.getDerivedStateFromError;if(typeof r=="function"){var i=e.value;n.payload=function(){return r(i)},n.callback=function(){t3(t,e)}}var a=t.stateNode;return a!==null&&typeof a.componentDidCatch=="function"&&(n.callback=function(){t3(t,e),typeof r!="function"&&(mc===null?mc=new Set([this]):mc.add(this));var o=e.stack;this.componentDidCatch(e.value,{componentStack:o!==null?o:""})}),n}function M6(t,e,n){var r=t.pingCache;if(r===null){r=t.pingCache=new FV;var i=new Set;r.set(e,i)}else i=r.get(e),i===void 0&&(i=new Set,r.set(e,i));i.has(n)||(i.add(n),t=QV.bind(null,t,e,n),e.then(t,t))}function _6(t){do{var e;if((e=t.tag===13)&&(e=t.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return t;t=t.return}while(t!==null);return null}function b6(t,e,n,r,i){return t.mode&1?(t.flags|=65536,t.lanes=i,t):(t===e?t.flags|=65536:(t.flags|=128,n.flags|=131072,n.flags&=-52805,n.tag===1&&(n.alternate===null?n.tag=17:(e=rs(-1,1),e.tag=2,hc(n,e,1))),n.lanes|=1),t)}var UV=Ts.ReactCurrentOwner,Di=!1;function oi(t,e,n,r){e.child=t===null?Uw(e,null,n,r):wu(e,t.child,n,r)}function L6(t,e,n,r,i){n=n.render;var a=e.ref;return nu(e,i),r=Yv(t,e,n,r,a,i),n=Zv(),t!==null&&!Di?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~i,ps(t,e,i)):(ln&&n&&Fv(e),e.flags|=1,oi(t,e,r,i),e.child)}function I6(t,e,n,r,i){if(t===null){var a=n.type;return typeof a=="function"&&!s4(a)&&a.defaultProps===void 0&&n.compare===null&&n.defaultProps===void 0?(e.tag=15,e.type=a,fx(t,e,a,r,i)):(t=q1(n.type,null,r,e,e.mode,i),t.ref=e.ref,t.return=e,e.child=t)}if(a=t.child,!(t.lanes&i)){var o=a.memoizedProps;if(n=n.compare,n=n!==null?n:Dg,n(o,r)&&t.ref===e.ref)return ps(t,e,i)}return e.flags|=1,t=yc(a,r),t.ref=e.ref,t.return=e,e.child=t}function fx(t,e,n,r,i){if(t!==null){var a=t.memoizedProps;if(Dg(a,r)&&t.ref===e.ref)if(Di=!1,e.pendingProps=r=a,(t.lanes&i)!==0)t.flags&131072&&(Di=!0);else return e.lanes=t.lanes,ps(t,e,i)}return n3(t,e,n,r,i)}function gx(t,e,n){var r=e.pendingProps,i=r.children,a=t!==null?t.memoizedState:null;if(r.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},qt($l,Bi),Bi|=n;else{if(!(n&1073741824))return t=a!==null?a.baseLanes|n:n,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:t,cachePool:null,transitions:null},e.updateQueue=null,qt($l,Bi),Bi|=t,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=a!==null?a.baseLanes:n,qt($l,Bi),Bi|=r}else a!==null?(r=a.baseLanes|n,e.memoizedState=null):r=n,qt($l,Bi),Bi|=r;return oi(t,e,i,n),e.child}function dx(t,e){var n=e.ref;(t===null&&n!==null||t!==null&&t.ref!==n)&&(e.flags|=512,e.flags|=2097152)}function n3(t,e,n,r,i){var a=_i(n)?j0:Wr.current;return a=Tu(e,a),nu(e,i),n=Yv(t,e,n,r,a,i),r=Zv(),t!==null&&!Di?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~i,ps(t,e,i)):(ln&&r&&Fv(e),e.flags|=1,oi(t,e,n,i),e.child)}function V6(t,e,n,r,i){if(_i(n)){var a=!0;kp(e)}else a=!1;if(nu(e,i),e.stateNode===null)j1(t,e),cx(e,n,r),e3(e,n,r,i),r=!0;else if(t===null){var o=e.stateNode,s=e.memoizedProps;o.props=s;var c=o.context,l=n.contextType;typeof l=="object"&&l!==null?l=ma(l):(l=_i(n)?j0:Wr.current,l=Tu(e,l));var f=n.getDerivedStateFromProps,u=typeof f=="function"||typeof o.getSnapshotBeforeUpdate=="function";u||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(s!==r||c!==l)&&R6(e,o,r,l),Ys=!1;var g=e.memoizedState;o.state=g,Gp(e,r,o,i),c=e.memoizedState,s!==r||g!==c||Mi.current||Ys?(typeof f=="function"&&(Jm(e,n,f,r),c=e.memoizedState),(s=Ys||D6(e,n,s,r,g,c,l))?(u||typeof o.UNSAFE_componentWillMount!="function"&&typeof o.componentWillMount!="function"||(typeof o.componentWillMount=="function"&&o.componentWillMount(),typeof o.UNSAFE_componentWillMount=="function"&&o.UNSAFE_componentWillMount()),typeof o.componentDidMount=="function"&&(e.flags|=4194308)):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=r,e.memoizedState=c),o.props=r,o.state=c,o.context=l,r=s):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),r=!1)}else{o=e.stateNode,Gw(t,e),s=e.memoizedProps,l=e.type===e.elementType?s:La(e.type,s),o.props=l,u=e.pendingProps,g=o.context,c=n.contextType,typeof c=="object"&&c!==null?c=ma(c):(c=_i(n)?j0:Wr.current,c=Tu(e,c));var d=n.getDerivedStateFromProps;(f=typeof d=="function"||typeof o.getSnapshotBeforeUpdate=="function")||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(s!==u||g!==c)&&R6(e,o,r,c),Ys=!1,g=e.memoizedState,o.state=g,Gp(e,r,o,i);var h=e.memoizedState;s!==u||g!==h||Mi.current||Ys?(typeof d=="function"&&(Jm(e,n,d,r),h=e.memoizedState),(l=Ys||D6(e,n,l,r,g,h,c)||!1)?(f||typeof o.UNSAFE_componentWillUpdate!="function"&&typeof o.componentWillUpdate!="function"||(typeof o.componentWillUpdate=="function"&&o.componentWillUpdate(r,h,c),typeof o.UNSAFE_componentWillUpdate=="function"&&o.UNSAFE_componentWillUpdate(r,h,c)),typeof o.componentDidUpdate=="function"&&(e.flags|=4),typeof o.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof o.componentDidUpdate!="function"||s===t.memoizedProps&&g===t.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||s===t.memoizedProps&&g===t.memoizedState||(e.flags|=1024),e.memoizedProps=r,e.memoizedState=h),o.props=r,o.state=h,o.context=c,r=l):(typeof o.componentDidUpdate!="function"||s===t.memoizedProps&&g===t.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||s===t.memoizedProps&&g===t.memoizedState||(e.flags|=1024),r=!1)}return r3(t,e,n,r,a,i)}function r3(t,e,n,r,i,a){dx(t,e);var o=(e.flags&128)!==0;if(!r&&!o)return i&&y6(e,n,!1),ps(t,e,a);r=e.stateNode,UV.current=e;var s=o&&typeof n.getDerivedStateFromError!="function"?null:r.render();return e.flags|=1,t!==null&&o?(e.child=wu(e,t.child,null,a),e.child=wu(e,null,s,a)):oi(t,e,s,a),e.memoizedState=r.state,i&&y6(e,n,!0),e.child}function px(t){var e=t.stateNode;e.pendingContext?v6(t,e.pendingContext,e.pendingContext!==e.context):e.context&&v6(t,e.context,!1),Hv(t,e.containerInfo)}function P6(t,e,n,r,i){return Cu(),Bv(i),e.flags|=256,oi(t,e,n,r),e.child}var i3={dehydrated:null,treeContext:null,retryLane:0};function a3(t){return{baseLanes:t,cachePool:null,transitions:null}}function hx(t,e,n){var r=e.pendingProps,i=yn.current,a=!1,o=(e.flags&128)!==0,s;if((s=o)||(s=t!==null&&t.memoizedState===null?!1:(i&2)!==0),s?(a=!0,e.flags&=-129):(t===null||t.memoizedState!==null)&&(i|=1),qt(yn,i&1),t===null)return Zm(e),t=e.memoizedState,t!==null&&(t=t.dehydrated,t!==null)?(e.mode&1?t.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(o=r.children,t=r.fallback,a?(r=e.mode,a=e.child,o={mode:"hidden",children:o},!(r&1)&&a!==null?(a.childLanes=0,a.pendingProps=o):a=n2(o,r,0,null),t=U0(t,r,n,null),a.return=e,t.return=e,a.sibling=t,e.child=a,e.child.memoizedState=a3(n),e.memoizedState=i3,t):e4(e,o));if(i=t.memoizedState,i!==null&&(s=i.dehydrated,s!==null))return BV(t,e,o,r,s,i,n);if(a){a=r.fallback,o=e.mode,i=t.child,s=i.sibling;var c={mode:"hidden",children:r.children};return!(o&1)&&e.child!==i?(r=e.child,r.childLanes=0,r.pendingProps=c,e.deletions=null):(r=yc(i,c),r.subtreeFlags=i.subtreeFlags&14680064),s!==null?a=yc(s,a):(a=U0(a,o,n,null),a.flags|=2),a.return=e,r.return=e,r.sibling=a,e.child=r,r=a,a=e.child,o=t.child.memoizedState,o=o===null?a3(n):{baseLanes:o.baseLanes|n,cachePool:null,transitions:o.transitions},a.memoizedState=o,a.childLanes=t.childLanes&~n,e.memoizedState=i3,r}return a=t.child,t=a.sibling,r=yc(a,{mode:"visible",children:r.children}),!(e.mode&1)&&(r.lanes=n),r.return=e,r.sibling=null,t!==null&&(n=e.deletions,n===null?(e.deletions=[t],e.flags|=16):n.push(t)),e.child=r,e.memoizedState=null,r}function e4(t,e){return e=n2({mode:"visible",children:e},t.mode,0,null),e.return=t,t.child=e}function zd(t,e,n,r){return r!==null&&Bv(r),wu(e,t.child,null,n),t=e4(e,e.pendingProps.children),t.flags|=2,e.memoizedState=null,t}function BV(t,e,n,r,i,a,o){if(n)return e.flags&256?(e.flags&=-257,r=C5(Error(_e(422))),zd(t,e,o,r)):e.memoizedState!==null?(e.child=t.child,e.flags|=128,null):(a=r.fallback,i=e.mode,r=n2({mode:"visible",children:r.children},i,0,null),a=U0(a,i,o,null),a.flags|=2,r.return=e,a.return=e,r.sibling=a,e.child=r,e.mode&1&&wu(e,t.child,null,o),e.child.memoizedState=a3(o),e.memoizedState=i3,a);if(!(e.mode&1))return zd(t,e,o,null);if(i.data==="$!"){if(r=i.nextSibling&&i.nextSibling.dataset,r)var s=r.dgst;return r=s,a=Error(_e(419)),r=C5(a,r,void 0),zd(t,e,o,r)}if(s=(o&t.childLanes)!==0,Di||s){if(r=Tr,r!==null){switch(o&-o){case 4:i=2;break;case 16:i=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:i=32;break;case 536870912:i=268435456;break;default:i=0}i=i&(r.suspendedLanes|o)?0:i,i!==0&&i!==a.retryLane&&(a.retryLane=i,ds(t,i),Ga(r,t,i,-1))}return o4(),r=C5(Error(_e(421))),zd(t,e,o,r)}return i.data==="$?"?(e.flags|=128,e.child=t.child,e=JV.bind(null,t),i._reactRetry=e,null):(t=a.treeContext,$i=pc(i.nextSibling),zi=e,ln=!0,Pa=null,t!==null&&(ca[la++]=Jo,ca[la++]=es,ca[la++]=H0,Jo=t.id,es=t.overflow,H0=e),e=e4(e,r.children),e.flags|=4096,e)}function N6(t,e,n){t.lanes|=e;var r=t.alternate;r!==null&&(r.lanes|=e),Qm(t.return,e,n)}function w5(t,e,n,r,i){var a=t.memoizedState;a===null?t.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:r,tail:n,tailMode:i}:(a.isBackwards=e,a.rendering=null,a.renderingStartTime=0,a.last=r,a.tail=n,a.tailMode=i)}function mx(t,e,n){var r=e.pendingProps,i=r.revealOrder,a=r.tail;if(oi(t,e,r.children,n),r=yn.current,r&2)r=r&1|2,e.flags|=128;else{if(t!==null&&t.flags&128)e:for(t=e.child;t!==null;){if(t.tag===13)t.memoizedState!==null&&N6(t,n,e);else if(t.tag===19)N6(t,n,e);else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;t.sibling===null;){if(t.return===null||t.return===e)break e;t=t.return}t.sibling.return=t.return,t=t.sibling}r&=1}if(qt(yn,r),!(e.mode&1))e.memoizedState=null;else switch(i){case"forwards":for(n=e.child,i=null;n!==null;)t=n.alternate,t!==null&&$p(t)===null&&(i=n),n=n.sibling;n=i,n===null?(i=e.child,e.child=null):(i=n.sibling,n.sibling=null),w5(e,!1,i,n,a);break;case"backwards":for(n=null,i=e.child,e.child=null;i!==null;){if(t=i.alternate,t!==null&&$p(t)===null){e.child=i;break}t=i.sibling,i.sibling=n,n=i,i=t}w5(e,!0,n,null,a);break;case"together":w5(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function j1(t,e){!(e.mode&1)&&t!==null&&(t.alternate=null,e.alternate=null,e.flags|=2)}function ps(t,e,n){if(t!==null&&(e.dependencies=t.dependencies),q0|=e.lanes,!(n&e.childLanes))return null;if(t!==null&&e.child!==t.child)throw Error(_e(153));if(e.child!==null){for(t=e.child,n=yc(t,t.pendingProps),e.child=n,n.return=e;t.sibling!==null;)t=t.sibling,n=n.sibling=yc(t,t.pendingProps),n.return=e;n.sibling=null}return e.child}function GV(t,e,n){switch(e.tag){case 3:px(e),Cu();break;case 5:$w(e);break;case 1:_i(e.type)&&kp(e);break;case 4:Hv(e,e.stateNode.containerInfo);break;case 10:var r=e.type._context,i=e.memoizedProps.value;qt(Up,r._currentValue),r._currentValue=i;break;case 13:if(r=e.memoizedState,r!==null)return r.dehydrated!==null?(qt(yn,yn.current&1),e.flags|=128,null):n&e.child.childLanes?hx(t,e,n):(qt(yn,yn.current&1),t=ps(t,e,n),t!==null?t.sibling:null);qt(yn,yn.current&1);break;case 19:if(r=(n&e.childLanes)!==0,t.flags&128){if(r)return mx(t,e,n);e.flags|=128}if(i=e.memoizedState,i!==null&&(i.rendering=null,i.tail=null,i.lastEffect=null),qt(yn,yn.current),r)break;return null;case 22:case 23:return e.lanes=0,gx(t,e,n)}return ps(t,e,n)}var vx,o3,yx,Tx;vx=function(t,e){for(var n=e.child;n!==null;){if(n.tag===5||n.tag===6)t.appendChild(n.stateNode);else if(n.tag!==4&&n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break;for(;n.sibling===null;){if(n.return===null||n.return===e)return;n=n.return}n.sibling.return=n.return,n=n.sibling}};o3=function(){};yx=function(t,e,n,r){var i=t.memoizedProps;if(i!==r){t=e.stateNode,L0(uo.current);var a=null;switch(n){case"input":i=Mm(t,i),r=Mm(t,r),a=[];break;case"select":i=xn({},i,{value:void 0}),r=xn({},r,{value:void 0}),a=[];break;case"textarea":i=Lm(t,i),r=Lm(t,r),a=[];break;default:typeof i.onClick!="function"&&typeof r.onClick=="function"&&(t.onclick=Pp)}Vm(n,r);var o;n=null;for(l in i)if(!r.hasOwnProperty(l)&&i.hasOwnProperty(l)&&i[l]!=null)if(l==="style"){var s=i[l];for(o in s)s.hasOwnProperty(o)&&(n||(n={}),n[o]="")}else l!=="dangerouslySetInnerHTML"&&l!=="children"&&l!=="suppressContentEditableWarning"&&l!=="suppressHydrationWarning"&&l!=="autoFocus"&&(Tg.hasOwnProperty(l)?a||(a=[]):(a=a||[]).push(l,null));for(l in r){var c=r[l];if(s=i!=null?i[l]:void 0,r.hasOwnProperty(l)&&c!==s&&(c!=null||s!=null))if(l==="style")if(s){for(o in s)!s.hasOwnProperty(o)||c&&c.hasOwnProperty(o)||(n||(n={}),n[o]="");for(o in c)c.hasOwnProperty(o)&&s[o]!==c[o]&&(n||(n={}),n[o]=c[o])}else n||(a||(a=[]),a.push(l,n)),n=c;else l==="dangerouslySetInnerHTML"?(c=c?c.__html:void 0,s=s?s.__html:void 0,c!=null&&s!==c&&(a=a||[]).push(l,c)):l==="children"?typeof c!="string"&&typeof c!="number"||(a=a||[]).push(l,""+c):l!=="suppressContentEditableWarning"&&l!=="suppressHydrationWarning"&&(Tg.hasOwnProperty(l)?(c!=null&&l==="onScroll"&&Jt("scroll",t),a||s===c||(a=[])):(a=a||[]).push(l,c))}n&&(a=a||[]).push("style",n);var l=a;(e.updateQueue=l)&&(e.flags|=4)}};Tx=function(t,e,n,r){n!==r&&(e.flags|=4)};function pf(t,e){if(!ln)switch(t.tailMode){case"hidden":e=t.tail;for(var n=null;e!==null;)e.alternate!==null&&(n=e),e=e.sibling;n===null?t.tail=null:n.sibling=null;break;case"collapsed":n=t.tail;for(var r=null;n!==null;)n.alternate!==null&&(r=n),n=n.sibling;r===null?e||t.tail===null?t.tail=null:t.tail.sibling=null:r.sibling=null}}function Fr(t){var e=t.alternate!==null&&t.alternate.child===t.child,n=0,r=0;if(e)for(var i=t.child;i!==null;)n|=i.lanes|i.childLanes,r|=i.subtreeFlags&14680064,r|=i.flags&14680064,i.return=t,i=i.sibling;else for(i=t.child;i!==null;)n|=i.lanes|i.childLanes,r|=i.subtreeFlags,r|=i.flags,i.return=t,i=i.sibling;return t.subtreeFlags|=r,t.childLanes=n,e}function $V(t,e,n){var r=e.pendingProps;switch(Uv(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Fr(e),null;case 1:return _i(e.type)&&Np(),Fr(e),null;case 3:return r=e.stateNode,xu(),rn(Mi),rn(Wr),qv(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),(t===null||t.child===null)&&($d(e)?e.flags|=4:t===null||t.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,Pa!==null&&(p3(Pa),Pa=null))),o3(t,e),Fr(e),null;case 5:Kv(e);var i=L0(Lg.current);if(n=e.type,t!==null&&e.stateNode!=null)yx(t,e,n,r,i),t.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!r){if(e.stateNode===null)throw Error(_e(166));return Fr(e),null}if(t=L0(uo.current),$d(e)){r=e.stateNode,n=e.type;var a=e.memoizedProps;switch(r[so]=e,r[_g]=a,t=(e.mode&1)!==0,n){case"dialog":Jt("cancel",r),Jt("close",r);break;case"iframe":case"object":case"embed":Jt("load",r);break;case"video":case"audio":for(i=0;i<Vf.length;i++)Jt(Vf[i],r);break;case"source":Jt("error",r);break;case"img":case"image":case"link":Jt("error",r),Jt("load",r);break;case"details":Jt("toggle",r);break;case"input":z8(r,a),Jt("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!a.multiple},Jt("invalid",r);break;case"textarea":H8(r,a),Jt("invalid",r)}Vm(n,a),i=null;for(var o in a)if(a.hasOwnProperty(o)){var s=a[o];o==="children"?typeof s=="string"?r.textContent!==s&&(a.suppressHydrationWarning!==!0&&Gd(r.textContent,s,t),i=["children",s]):typeof s=="number"&&r.textContent!==""+s&&(a.suppressHydrationWarning!==!0&&Gd(r.textContent,s,t),i=["children",""+s]):Tg.hasOwnProperty(o)&&s!=null&&o==="onScroll"&&Jt("scroll",r)}switch(n){case"input":Vd(r),j8(r,a,!0);break;case"textarea":Vd(r),K8(r);break;case"select":case"option":break;default:typeof a.onClick=="function"&&(r.onclick=Pp)}r=i,e.updateQueue=r,r!==null&&(e.flags|=4)}else{o=i.nodeType===9?i:i.ownerDocument,t==="http://www.w3.org/1999/xhtml"&&(t=KC(n)),t==="http://www.w3.org/1999/xhtml"?n==="script"?(t=o.createElement("div"),t.innerHTML="<script><\/script>",t=t.removeChild(t.firstChild)):typeof r.is=="string"?t=o.createElement(n,{is:r.is}):(t=o.createElement(n),n==="select"&&(o=t,r.multiple?o.multiple=!0:r.size&&(o.size=r.size))):t=o.createElementNS(t,n),t[so]=e,t[_g]=r,vx(t,e,!1,!1),e.stateNode=t;e:{switch(o=Pm(n,r),n){case"dialog":Jt("cancel",t),Jt("close",t),i=r;break;case"iframe":case"object":case"embed":Jt("load",t),i=r;break;case"video":case"audio":for(i=0;i<Vf.length;i++)Jt(Vf[i],t);i=r;break;case"source":Jt("error",t),i=r;break;case"img":case"image":case"link":Jt("error",t),Jt("load",t),i=r;break;case"details":Jt("toggle",t),i=r;break;case"input":z8(t,r),i=Mm(t,r),Jt("invalid",t);break;case"option":i=r;break;case"select":t._wrapperState={wasMultiple:!!r.multiple},i=xn({},r,{value:void 0}),Jt("invalid",t);break;case"textarea":H8(t,r),i=Lm(t,r),Jt("invalid",t);break;default:i=r}Vm(n,i),s=i;for(a in s)if(s.hasOwnProperty(a)){var c=s[a];a==="style"?YC(t,c):a==="dangerouslySetInnerHTML"?(c=c?c.__html:void 0,c!=null&&qC(t,c)):a==="children"?typeof c=="string"?(n!=="textarea"||c!=="")&&Cg(t,c):typeof c=="number"&&Cg(t,""+c):a!=="suppressContentEditableWarning"&&a!=="suppressHydrationWarning"&&a!=="autoFocus"&&(Tg.hasOwnProperty(a)?c!=null&&a==="onScroll"&&Jt("scroll",t):c!=null&&Ev(t,a,c,o))}switch(n){case"input":Vd(t),j8(t,r,!1);break;case"textarea":Vd(t),K8(t);break;case"option":r.value!=null&&t.setAttribute("value",""+xc(r.value));break;case"select":t.multiple=!!r.multiple,a=r.value,a!=null?Ql(t,!!r.multiple,a,!1):r.defaultValue!=null&&Ql(t,!!r.multiple,r.defaultValue,!0);break;default:typeof i.onClick=="function"&&(t.onclick=Pp)}switch(n){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}}r&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return Fr(e),null;case 6:if(t&&e.stateNode!=null)Tx(t,e,t.memoizedProps,r);else{if(typeof r!="string"&&e.stateNode===null)throw Error(_e(166));if(n=L0(Lg.current),L0(uo.current),$d(e)){if(r=e.stateNode,n=e.memoizedProps,r[so]=e,(a=r.nodeValue!==n)&&(t=zi,t!==null))switch(t.tag){case 3:Gd(r.nodeValue,n,(t.mode&1)!==0);break;case 5:t.memoizedProps.suppressHydrationWarning!==!0&&Gd(r.nodeValue,n,(t.mode&1)!==0)}a&&(e.flags|=4)}else r=(n.nodeType===9?n:n.ownerDocument).createTextNode(r),r[so]=e,e.stateNode=r}return Fr(e),null;case 13:if(rn(yn),r=e.memoizedState,t===null||t.memoizedState!==null&&t.memoizedState.dehydrated!==null){if(ln&&$i!==null&&e.mode&1&&!(e.flags&128))Aw(),Cu(),e.flags|=98560,a=!1;else if(a=$d(e),r!==null&&r.dehydrated!==null){if(t===null){if(!a)throw Error(_e(318));if(a=e.memoizedState,a=a!==null?a.dehydrated:null,!a)throw Error(_e(317));a[so]=e}else Cu(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;Fr(e),a=!1}else Pa!==null&&(p3(Pa),Pa=null),a=!0;if(!a)return e.flags&65536?e:null}return e.flags&128?(e.lanes=n,e):(r=r!==null,r!==(t!==null&&t.memoizedState!==null)&&r&&(e.child.flags|=8192,e.mode&1&&(t===null||yn.current&1?or===0&&(or=3):o4())),e.updateQueue!==null&&(e.flags|=4),Fr(e),null);case 4:return xu(),o3(t,e),t===null&&Rg(e.stateNode.containerInfo),Fr(e),null;case 10:return Wv(e.type._context),Fr(e),null;case 17:return _i(e.type)&&Np(),Fr(e),null;case 19:if(rn(yn),a=e.memoizedState,a===null)return Fr(e),null;if(r=(e.flags&128)!==0,o=a.rendering,o===null)if(r)pf(a,!1);else{if(or!==0||t!==null&&t.flags&128)for(t=e.child;t!==null;){if(o=$p(t),o!==null){for(e.flags|=128,pf(a,!1),r=o.updateQueue,r!==null&&(e.updateQueue=r,e.flags|=4),e.subtreeFlags=0,r=n,n=e.child;n!==null;)a=n,t=r,a.flags&=14680066,o=a.alternate,o===null?(a.childLanes=0,a.lanes=t,a.child=null,a.subtreeFlags=0,a.memoizedProps=null,a.memoizedState=null,a.updateQueue=null,a.dependencies=null,a.stateNode=null):(a.childLanes=o.childLanes,a.lanes=o.lanes,a.child=o.child,a.subtreeFlags=0,a.deletions=null,a.memoizedProps=o.memoizedProps,a.memoizedState=o.memoizedState,a.updateQueue=o.updateQueue,a.type=o.type,t=o.dependencies,a.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext}),n=n.sibling;return qt(yn,yn.current&1|2),e.child}t=t.sibling}a.tail!==null&&Gn()>Eu&&(e.flags|=128,r=!0,pf(a,!1),e.lanes=4194304)}else{if(!r)if(t=$p(o),t!==null){if(e.flags|=128,r=!0,n=t.updateQueue,n!==null&&(e.updateQueue=n,e.flags|=4),pf(a,!0),a.tail===null&&a.tailMode==="hidden"&&!o.alternate&&!ln)return Fr(e),null}else 2*Gn()-a.renderingStartTime>Eu&&n!==1073741824&&(e.flags|=128,r=!0,pf(a,!1),e.lanes=4194304);a.isBackwards?(o.sibling=e.child,e.child=o):(n=a.last,n!==null?n.sibling=o:e.child=o,a.last=o)}return a.tail!==null?(e=a.tail,a.rendering=e,a.tail=e.sibling,a.renderingStartTime=Gn(),e.sibling=null,n=yn.current,qt(yn,r?n&1|2:n&1),e):(Fr(e),null);case 22:case 23:return a4(),r=e.memoizedState!==null,t!==null&&t.memoizedState!==null!==r&&(e.flags|=8192),r&&e.mode&1?Bi&1073741824&&(Fr(e),e.subtreeFlags&6&&(e.flags|=8192)):Fr(e),null;case 24:return null;case 25:return null}throw Error(_e(156,e.tag))}function WV(t,e){switch(Uv(e),e.tag){case 1:return _i(e.type)&&Np(),t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 3:return xu(),rn(Mi),rn(Wr),qv(),t=e.flags,t&65536&&!(t&128)?(e.flags=t&-65537|128,e):null;case 5:return Kv(e),null;case 13:if(rn(yn),t=e.memoizedState,t!==null&&t.dehydrated!==null){if(e.alternate===null)throw Error(_e(340));Cu()}return t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 19:return rn(yn),null;case 4:return xu(),null;case 10:return Wv(e.type._context),null;case 22:case 23:return a4(),null;case 24:return null;default:return null}}var jd=!1,Gr=!1,zV=typeof WeakSet=="function"?WeakSet:Set,Ae=null;function Gl(t,e){var n=t.ref;if(n!==null)if(typeof n=="function")try{n(null)}catch(r){Dn(t,e,r)}else n.current=null}function s3(t,e,n){try{n()}catch(r){Dn(t,e,r)}}var k6=!1;function jV(t,e){if(zm=Lp,t=Ew(),Av(t)){if("selectionStart"in t)var n={start:t.selectionStart,end:t.selectionEnd};else e:{n=(n=t.ownerDocument)&&n.defaultView||window;var r=n.getSelection&&n.getSelection();if(r&&r.rangeCount!==0){n=r.anchorNode;var i=r.anchorOffset,a=r.focusNode;r=r.focusOffset;try{n.nodeType,a.nodeType}catch{n=null;break e}var o=0,s=-1,c=-1,l=0,f=0,u=t,g=null;t:for(;;){for(var d;u!==n||i!==0&&u.nodeType!==3||(s=o+i),u!==a||r!==0&&u.nodeType!==3||(c=o+r),u.nodeType===3&&(o+=u.nodeValue.length),(d=u.firstChild)!==null;)g=u,u=d;for(;;){if(u===t)break t;if(g===n&&++l===i&&(s=o),g===a&&++f===r&&(c=o),(d=u.nextSibling)!==null)break;u=g,g=u.parentNode}u=d}n=s===-1||c===-1?null:{start:s,end:c}}else n=null}n=n||{start:0,end:0}}else n=null;for(jm={focusedElem:t,selectionRange:n},Lp=!1,Ae=e;Ae!==null;)if(e=Ae,t=e.child,(e.subtreeFlags&1028)!==0&&t!==null)t.return=e,Ae=t;else for(;Ae!==null;){e=Ae;try{var h=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(h!==null){var p=h.memoizedProps,m=h.memoizedState,v=e.stateNode,y=v.getSnapshotBeforeUpdate(e.elementType===e.type?p:La(e.type,p),m);v.__reactInternalSnapshotBeforeUpdate=y}break;case 3:var T=e.stateNode.containerInfo;T.nodeType===1?T.textContent="":T.nodeType===9&&T.documentElement&&T.removeChild(T.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(_e(163))}}catch(C){Dn(e,e.return,C)}if(t=e.sibling,t!==null){t.return=e.return,Ae=t;break}Ae=e.return}return h=k6,k6=!1,h}function Jf(t,e,n){var r=e.updateQueue;if(r=r!==null?r.lastEffect:null,r!==null){var i=r=r.next;do{if((i.tag&t)===t){var a=i.destroy;i.destroy=void 0,a!==void 0&&s3(e,n,a)}i=i.next}while(i!==r)}}function e2(t,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var n=e=e.next;do{if((n.tag&t)===t){var r=n.create;n.destroy=r()}n=n.next}while(n!==e)}}function c3(t){var e=t.ref;if(e!==null){var n=t.stateNode;switch(t.tag){case 5:t=n;break;default:t=n}typeof e=="function"?e(t):e.current=t}}function Cx(t){var e=t.alternate;e!==null&&(t.alternate=null,Cx(e)),t.child=null,t.deletions=null,t.sibling=null,t.tag===5&&(e=t.stateNode,e!==null&&(delete e[so],delete e[_g],delete e[qm],delete e[RV],delete e[MV])),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}function wx(t){return t.tag===5||t.tag===3||t.tag===4}function A6(t){e:for(;;){for(;t.sibling===null;){if(t.return===null||wx(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;t.tag!==5&&t.tag!==6&&t.tag!==18;){if(t.flags&2||t.child===null||t.tag===4)continue e;t.child.return=t,t=t.child}if(!(t.flags&2))return t.stateNode}}function l3(t,e,n){var r=t.tag;if(r===5||r===6)t=t.stateNode,e?n.nodeType===8?n.parentNode.insertBefore(t,e):n.insertBefore(t,e):(n.nodeType===8?(e=n.parentNode,e.insertBefore(t,n)):(e=n,e.appendChild(t)),n=n._reactRootContainer,n!=null||e.onclick!==null||(e.onclick=Pp));else if(r!==4&&(t=t.child,t!==null))for(l3(t,e,n),t=t.sibling;t!==null;)l3(t,e,n),t=t.sibling}function u3(t,e,n){var r=t.tag;if(r===5||r===6)t=t.stateNode,e?n.insertBefore(t,e):n.appendChild(t);else if(r!==4&&(t=t.child,t!==null))for(u3(t,e,n),t=t.sibling;t!==null;)u3(t,e,n),t=t.sibling}var Or=null,Va=!1;function Bs(t,e,n){for(n=n.child;n!==null;)xx(t,e,n),n=n.sibling}function xx(t,e,n){if(lo&&typeof lo.onCommitFiberUnmount=="function")try{lo.onCommitFiberUnmount(Hh,n)}catch{}switch(n.tag){case 5:Gr||Gl(n,e);case 6:var r=Or,i=Va;Or=null,Bs(t,e,n),Or=r,Va=i,Or!==null&&(Va?(t=Or,n=n.stateNode,t.nodeType===8?t.parentNode.removeChild(n):t.removeChild(n)):Or.removeChild(n.stateNode));break;case 18:Or!==null&&(Va?(t=Or,n=n.stateNode,t.nodeType===8?p5(t.parentNode,n):t.nodeType===1&&p5(t,n),Eg(t)):p5(Or,n.stateNode));break;case 4:r=Or,i=Va,Or=n.stateNode.containerInfo,Va=!0,Bs(t,e,n),Or=r,Va=i;break;case 0:case 11:case 14:case 15:if(!Gr&&(r=n.updateQueue,r!==null&&(r=r.lastEffect,r!==null))){i=r=r.next;do{var a=i,o=a.destroy;a=a.tag,o!==void 0&&(a&2||a&4)&&s3(n,e,o),i=i.next}while(i!==r)}Bs(t,e,n);break;case 1:if(!Gr&&(Gl(n,e),r=n.stateNode,typeof r.componentWillUnmount=="function"))try{r.props=n.memoizedProps,r.state=n.memoizedState,r.componentWillUnmount()}catch(s){Dn(n,e,s)}Bs(t,e,n);break;case 21:Bs(t,e,n);break;case 22:n.mode&1?(Gr=(r=Gr)||n.memoizedState!==null,Bs(t,e,n),Gr=r):Bs(t,e,n);break;default:Bs(t,e,n)}}function F6(t){var e=t.updateQueue;if(e!==null){t.updateQueue=null;var n=t.stateNode;n===null&&(n=t.stateNode=new zV),e.forEach(function(r){var i=eP.bind(null,t,r);n.has(r)||(n.add(r),r.then(i,i))})}}function Ra(t,e){var n=e.deletions;if(n!==null)for(var r=0;r<n.length;r++){var i=n[r];try{var a=t,o=e,s=o;e:for(;s!==null;){switch(s.tag){case 5:Or=s.stateNode,Va=!1;break e;case 3:Or=s.stateNode.containerInfo,Va=!0;break e;case 4:Or=s.stateNode.containerInfo,Va=!0;break e}s=s.return}if(Or===null)throw Error(_e(160));xx(a,o,i),Or=null,Va=!1;var c=i.alternate;c!==null&&(c.return=null),i.return=null}catch(l){Dn(i,e,l)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)Sx(e,t),e=e.sibling}function Sx(t,e){var n=t.alternate,r=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:if(Ra(e,t),to(t),r&4){try{Jf(3,t,t.return),e2(3,t)}catch(p){Dn(t,t.return,p)}try{Jf(5,t,t.return)}catch(p){Dn(t,t.return,p)}}break;case 1:Ra(e,t),to(t),r&512&&n!==null&&Gl(n,n.return);break;case 5:if(Ra(e,t),to(t),r&512&&n!==null&&Gl(n,n.return),t.flags&32){var i=t.stateNode;try{Cg(i,"")}catch(p){Dn(t,t.return,p)}}if(r&4&&(i=t.stateNode,i!=null)){var a=t.memoizedProps,o=n!==null?n.memoizedProps:a,s=t.type,c=t.updateQueue;if(t.updateQueue=null,c!==null)try{s==="input"&&a.type==="radio"&&a.name!=null&&jC(i,a),Pm(s,o);var l=Pm(s,a);for(o=0;o<c.length;o+=2){var f=c[o],u=c[o+1];f==="style"?YC(i,u):f==="dangerouslySetInnerHTML"?qC(i,u):f==="children"?Cg(i,u):Ev(i,f,u,l)}switch(s){case"input":_m(i,a);break;case"textarea":HC(i,a);break;case"select":var g=i._wrapperState.wasMultiple;i._wrapperState.wasMultiple=!!a.multiple;var d=a.value;d!=null?Ql(i,!!a.multiple,d,!1):g!==!!a.multiple&&(a.defaultValue!=null?Ql(i,!!a.multiple,a.defaultValue,!0):Ql(i,!!a.multiple,a.multiple?[]:"",!1))}i[_g]=a}catch(p){Dn(t,t.return,p)}}break;case 6:if(Ra(e,t),to(t),r&4){if(t.stateNode===null)throw Error(_e(162));i=t.stateNode,a=t.memoizedProps;try{i.nodeValue=a}catch(p){Dn(t,t.return,p)}}break;case 3:if(Ra(e,t),to(t),r&4&&n!==null&&n.memoizedState.isDehydrated)try{Eg(e.containerInfo)}catch(p){Dn(t,t.return,p)}break;case 4:Ra(e,t),to(t);break;case 13:Ra(e,t),to(t),i=t.child,i.flags&8192&&(a=i.memoizedState!==null,i.stateNode.isHidden=a,!a||i.alternate!==null&&i.alternate.memoizedState!==null||(r4=Gn())),r&4&&F6(t);break;case 22:if(f=n!==null&&n.memoizedState!==null,t.mode&1?(Gr=(l=Gr)||f,Ra(e,t),Gr=l):Ra(e,t),to(t),r&8192){if(l=t.memoizedState!==null,(t.stateNode.isHidden=l)&&!f&&t.mode&1)for(Ae=t,f=t.child;f!==null;){for(u=Ae=f;Ae!==null;){switch(g=Ae,d=g.child,g.tag){case 0:case 11:case 14:case 15:Jf(4,g,g.return);break;case 1:Gl(g,g.return);var h=g.stateNode;if(typeof h.componentWillUnmount=="function"){r=g,n=g.return;try{e=r,h.props=e.memoizedProps,h.state=e.memoizedState,h.componentWillUnmount()}catch(p){Dn(r,n,p)}}break;case 5:Gl(g,g.return);break;case 22:if(g.memoizedState!==null){B6(u);continue}}d!==null?(d.return=g,Ae=d):B6(u)}f=f.sibling}e:for(f=null,u=t;;){if(u.tag===5){if(f===null){f=u;try{i=u.stateNode,l?(a=i.style,typeof a.setProperty=="function"?a.setProperty("display","none","important"):a.display="none"):(s=u.stateNode,c=u.memoizedProps.style,o=c!=null&&c.hasOwnProperty("display")?c.display:null,s.style.display=XC("display",o))}catch(p){Dn(t,t.return,p)}}}else if(u.tag===6){if(f===null)try{u.stateNode.nodeValue=l?"":u.memoizedProps}catch(p){Dn(t,t.return,p)}}else if((u.tag!==22&&u.tag!==23||u.memoizedState===null||u===t)&&u.child!==null){u.child.return=u,u=u.child;continue}if(u===t)break e;for(;u.sibling===null;){if(u.return===null||u.return===t)break e;f===u&&(f=null),u=u.return}f===u&&(f=null),u.sibling.return=u.return,u=u.sibling}}break;case 19:Ra(e,t),to(t),r&4&&F6(t);break;case 21:break;default:Ra(e,t),to(t)}}function to(t){var e=t.flags;if(e&2){try{e:{for(var n=t.return;n!==null;){if(wx(n)){var r=n;break e}n=n.return}throw Error(_e(160))}switch(r.tag){case 5:var i=r.stateNode;r.flags&32&&(Cg(i,""),r.flags&=-33);var a=A6(t);u3(t,a,i);break;case 3:case 4:var o=r.stateNode.containerInfo,s=A6(t);l3(t,s,o);break;default:throw Error(_e(161))}}catch(c){Dn(t,t.return,c)}t.flags&=-3}e&4096&&(t.flags&=-4097)}function HV(t,e,n){Ae=t,Ex(t)}function Ex(t,e,n){for(var r=(t.mode&1)!==0;Ae!==null;){var i=Ae,a=i.child;if(i.tag===22&&r){var o=i.memoizedState!==null||jd;if(!o){var s=i.alternate,c=s!==null&&s.memoizedState!==null||Gr;s=jd;var l=Gr;if(jd=o,(Gr=c)&&!l)for(Ae=i;Ae!==null;)o=Ae,c=o.child,o.tag===22&&o.memoizedState!==null?G6(i):c!==null?(c.return=o,Ae=c):G6(i);for(;a!==null;)Ae=a,Ex(a),a=a.sibling;Ae=i,jd=s,Gr=l}U6(t)}else i.subtreeFlags&8772&&a!==null?(a.return=i,Ae=a):U6(t)}}function U6(t){for(;Ae!==null;){var e=Ae;if(e.flags&8772){var n=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:Gr||e2(5,e);break;case 1:var r=e.stateNode;if(e.flags&4&&!Gr)if(n===null)r.componentDidMount();else{var i=e.elementType===e.type?n.memoizedProps:La(e.type,n.memoizedProps);r.componentDidUpdate(i,n.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var a=e.updateQueue;a!==null&&S6(e,a,r);break;case 3:var o=e.updateQueue;if(o!==null){if(n=null,e.child!==null)switch(e.child.tag){case 5:n=e.child.stateNode;break;case 1:n=e.child.stateNode}S6(e,o,n)}break;case 5:var s=e.stateNode;if(n===null&&e.flags&4){n=s;var c=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":c.autoFocus&&n.focus();break;case"img":c.src&&(n.src=c.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var l=e.alternate;if(l!==null){var f=l.memoizedState;if(f!==null){var u=f.dehydrated;u!==null&&Eg(u)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(_e(163))}Gr||e.flags&512&&c3(e)}catch(g){Dn(e,e.return,g)}}if(e===t){Ae=null;break}if(n=e.sibling,n!==null){n.return=e.return,Ae=n;break}Ae=e.return}}function B6(t){for(;Ae!==null;){var e=Ae;if(e===t){Ae=null;break}var n=e.sibling;if(n!==null){n.return=e.return,Ae=n;break}Ae=e.return}}function G6(t){for(;Ae!==null;){var e=Ae;try{switch(e.tag){case 0:case 11:case 15:var n=e.return;try{e2(4,e)}catch(c){Dn(e,n,c)}break;case 1:var r=e.stateNode;if(typeof r.componentDidMount=="function"){var i=e.return;try{r.componentDidMount()}catch(c){Dn(e,i,c)}}var a=e.return;try{c3(e)}catch(c){Dn(e,a,c)}break;case 5:var o=e.return;try{c3(e)}catch(c){Dn(e,o,c)}}}catch(c){Dn(e,e.return,c)}if(e===t){Ae=null;break}var s=e.sibling;if(s!==null){s.return=e.return,Ae=s;break}Ae=e.return}}var KV=Math.ceil,jp=Ts.ReactCurrentDispatcher,t4=Ts.ReactCurrentOwner,pa=Ts.ReactCurrentBatchConfig,Vt=0,Tr=null,Qn=null,br=0,Bi=0,$l=_c(0),or=0,Ng=null,q0=0,t2=0,n4=0,eg=null,Oi=null,r4=0,Eu=1/0,Ho=null,Hp=!1,f3=null,mc=null,Hd=!1,oc=null,Kp=0,tg=0,g3=null,H1=-1,K1=0;function fi(){return Vt&6?Gn():H1!==-1?H1:H1=Gn()}function vc(t){return t.mode&1?Vt&2&&br!==0?br&-br:bV.transition!==null?(K1===0&&(K1=cw()),K1):(t=Gt,t!==0||(t=window.event,t=t===void 0?16:hw(t.type)),t):1}function Ga(t,e,n,r){if(50<tg)throw tg=0,g3=null,Error(_e(185));od(t,n,r),(!(Vt&2)||t!==Tr)&&(t===Tr&&(!(Vt&2)&&(t2|=n),or===4&&ec(t,br)),bi(t,r),n===1&&Vt===0&&!(e.mode&1)&&(Eu=Gn()+500,Zh&&bc()))}function bi(t,e){var n=t.callbackNode;bI(t,e);var r=bp(t,t===Tr?br:0);if(r===0)n!==null&&Y8(n),t.callbackNode=null,t.callbackPriority=0;else if(e=r&-r,t.callbackPriority!==e){if(n!=null&&Y8(n),e===1)t.tag===0?_V($6.bind(null,t)):Pw($6.bind(null,t)),OV(function(){!(Vt&6)&&bc()}),n=null;else{switch(lw(r)){case 1:n=_v;break;case 4:n=ow;break;case 16:n=_p;break;case 536870912:n=sw;break;default:n=_p}n=Ix(n,Ox.bind(null,t))}t.callbackPriority=e,t.callbackNode=n}}function Ox(t,e){if(H1=-1,K1=0,Vt&6)throw Error(_e(327));var n=t.callbackNode;if(ru()&&t.callbackNode!==n)return null;var r=bp(t,t===Tr?br:0);if(r===0)return null;if(r&30||r&t.expiredLanes||e)e=qp(t,r);else{e=r;var i=Vt;Vt|=2;var a=Rx();(Tr!==t||br!==e)&&(Ho=null,Eu=Gn()+500,F0(t,e));do try{YV();break}catch(s){Dx(t,s)}while(!0);$v(),jp.current=a,Vt=i,Qn!==null?e=0:(Tr=null,br=0,e=or)}if(e!==0){if(e===2&&(i=Um(t),i!==0&&(r=i,e=d3(t,i))),e===1)throw n=Ng,F0(t,0),ec(t,r),bi(t,Gn()),n;if(e===6)ec(t,r);else{if(i=t.current.alternate,!(r&30)&&!qV(i)&&(e=qp(t,r),e===2&&(a=Um(t),a!==0&&(r=a,e=d3(t,a))),e===1))throw n=Ng,F0(t,0),ec(t,r),bi(t,Gn()),n;switch(t.finishedWork=i,t.finishedLanes=r,e){case 0:case 1:throw Error(_e(345));case 2:T0(t,Oi,Ho);break;case 3:if(ec(t,r),(r&130023424)===r&&(e=r4+500-Gn(),10<e)){if(bp(t,0)!==0)break;if(i=t.suspendedLanes,(i&r)!==r){fi(),t.pingedLanes|=t.suspendedLanes&i;break}t.timeoutHandle=Km(T0.bind(null,t,Oi,Ho),e);break}T0(t,Oi,Ho);break;case 4:if(ec(t,r),(r&4194240)===r)break;for(e=t.eventTimes,i=-1;0<r;){var o=31-Ba(r);a=1<<o,o=e[o],o>i&&(i=o),r&=~a}if(r=i,r=Gn()-r,r=(120>r?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*KV(r/1960))-r,10<r){t.timeoutHandle=Km(T0.bind(null,t,Oi,Ho),r);break}T0(t,Oi,Ho);break;case 5:T0(t,Oi,Ho);break;default:throw Error(_e(329))}}}return bi(t,Gn()),t.callbackNode===n?Ox.bind(null,t):null}function d3(t,e){var n=eg;return t.current.memoizedState.isDehydrated&&(F0(t,e).flags|=256),t=qp(t,e),t!==2&&(e=Oi,Oi=n,e!==null&&p3(e)),t}function p3(t){Oi===null?Oi=t:Oi.push.apply(Oi,t)}function qV(t){for(var e=t;;){if(e.flags&16384){var n=e.updateQueue;if(n!==null&&(n=n.stores,n!==null))for(var r=0;r<n.length;r++){var i=n[r],a=i.getSnapshot;i=i.value;try{if(!$a(a(),i))return!1}catch{return!1}}}if(n=e.child,e.subtreeFlags&16384&&n!==null)n.return=e,e=n;else{if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function ec(t,e){for(e&=~n4,e&=~t2,t.suspendedLanes|=e,t.pingedLanes&=~e,t=t.expirationTimes;0<e;){var n=31-Ba(e),r=1<<n;t[n]=-1,e&=~r}}function $6(t){if(Vt&6)throw Error(_e(327));ru();var e=bp(t,0);if(!(e&1))return bi(t,Gn()),null;var n=qp(t,e);if(t.tag!==0&&n===2){var r=Um(t);r!==0&&(e=r,n=d3(t,r))}if(n===1)throw n=Ng,F0(t,0),ec(t,e),bi(t,Gn()),n;if(n===6)throw Error(_e(345));return t.finishedWork=t.current.alternate,t.finishedLanes=e,T0(t,Oi,Ho),bi(t,Gn()),null}function i4(t,e){var n=Vt;Vt|=1;try{return t(e)}finally{Vt=n,Vt===0&&(Eu=Gn()+500,Zh&&bc())}}function X0(t){oc!==null&&oc.tag===0&&!(Vt&6)&&ru();var e=Vt;Vt|=1;var n=pa.transition,r=Gt;try{if(pa.transition=null,Gt=1,t)return t()}finally{Gt=r,pa.transition=n,Vt=e,!(Vt&6)&&bc()}}function a4(){Bi=$l.current,rn($l)}function F0(t,e){t.finishedWork=null,t.finishedLanes=0;var n=t.timeoutHandle;if(n!==-1&&(t.timeoutHandle=-1,EV(n)),Qn!==null)for(n=Qn.return;n!==null;){var r=n;switch(Uv(r),r.tag){case 1:r=r.type.childContextTypes,r!=null&&Np();break;case 3:xu(),rn(Mi),rn(Wr),qv();break;case 5:Kv(r);break;case 4:xu();break;case 13:rn(yn);break;case 19:rn(yn);break;case 10:Wv(r.type._context);break;case 22:case 23:a4()}n=n.return}if(Tr=t,Qn=t=yc(t.current,null),br=Bi=e,or=0,Ng=null,n4=t2=q0=0,Oi=eg=null,b0!==null){for(e=0;e<b0.length;e++)if(n=b0[e],r=n.interleaved,r!==null){n.interleaved=null;var i=r.next,a=n.pending;if(a!==null){var o=a.next;a.next=i,r.next=o}n.pending=r}b0=null}return t}function Dx(t,e){do{var n=Qn;try{if($v(),W1.current=zp,Wp){for(var r=Tn.memoizedState;r!==null;){var i=r.queue;i!==null&&(i.pending=null),r=r.next}Wp=!1}if(K0=0,mr=ir=Tn=null,Qf=!1,Ig=0,t4.current=null,n===null||n.return===null){or=1,Ng=e,Qn=null;break}e:{var a=t,o=n.return,s=n,c=e;if(e=br,s.flags|=32768,c!==null&&typeof c=="object"&&typeof c.then=="function"){var l=c,f=s,u=f.tag;if(!(f.mode&1)&&(u===0||u===11||u===15)){var g=f.alternate;g?(f.updateQueue=g.updateQueue,f.memoizedState=g.memoizedState,f.lanes=g.lanes):(f.updateQueue=null,f.memoizedState=null)}var d=_6(o);if(d!==null){d.flags&=-257,b6(d,o,s,a,e),d.mode&1&&M6(a,l,e),e=d,c=l;var h=e.updateQueue;if(h===null){var p=new Set;p.add(c),e.updateQueue=p}else h.add(c);break e}else{if(!(e&1)){M6(a,l,e),o4();break e}c=Error(_e(426))}}else if(ln&&s.mode&1){var m=_6(o);if(m!==null){!(m.flags&65536)&&(m.flags|=256),b6(m,o,s,a,e),Bv(Su(c,s));break e}}a=c=Su(c,s),or!==4&&(or=2),eg===null?eg=[a]:eg.push(a),a=o;do{switch(a.tag){case 3:a.flags|=65536,e&=-e,a.lanes|=e;var v=lx(a,c,e);x6(a,v);break e;case 1:s=c;var y=a.type,T=a.stateNode;if(!(a.flags&128)&&(typeof y.getDerivedStateFromError=="function"||T!==null&&typeof T.componentDidCatch=="function"&&(mc===null||!mc.has(T)))){a.flags|=65536,e&=-e,a.lanes|=e;var C=ux(a,s,e);x6(a,C);break e}}a=a.return}while(a!==null)}_x(n)}catch(w){e=w,Qn===n&&n!==null&&(Qn=n=n.return);continue}break}while(!0)}function Rx(){var t=jp.current;return jp.current=zp,t===null?zp:t}function o4(){(or===0||or===3||or===2)&&(or=4),Tr===null||!(q0&268435455)&&!(t2&268435455)||ec(Tr,br)}function qp(t,e){var n=Vt;Vt|=2;var r=Rx();(Tr!==t||br!==e)&&(Ho=null,F0(t,e));do try{XV();break}catch(i){Dx(t,i)}while(!0);if($v(),Vt=n,jp.current=r,Qn!==null)throw Error(_e(261));return Tr=null,br=0,or}function XV(){for(;Qn!==null;)Mx(Qn)}function YV(){for(;Qn!==null&&!wI();)Mx(Qn)}function Mx(t){var e=Lx(t.alternate,t,Bi);t.memoizedProps=t.pendingProps,e===null?_x(t):Qn=e,t4.current=null}function _x(t){var e=t;do{var n=e.alternate;if(t=e.return,e.flags&32768){if(n=WV(n,e),n!==null){n.flags&=32767,Qn=n;return}if(t!==null)t.flags|=32768,t.subtreeFlags=0,t.deletions=null;else{or=6,Qn=null;return}}else if(n=$V(n,e,Bi),n!==null){Qn=n;return}if(e=e.sibling,e!==null){Qn=e;return}Qn=e=t}while(e!==null);or===0&&(or=5)}function T0(t,e,n){var r=Gt,i=pa.transition;try{pa.transition=null,Gt=1,ZV(t,e,n,r)}finally{pa.transition=i,Gt=r}return null}function ZV(t,e,n,r){do ru();while(oc!==null);if(Vt&6)throw Error(_e(327));n=t.finishedWork;var i=t.finishedLanes;if(n===null)return null;if(t.finishedWork=null,t.finishedLanes=0,n===t.current)throw Error(_e(177));t.callbackNode=null,t.callbackPriority=0;var a=n.lanes|n.childLanes;if(LI(t,a),t===Tr&&(Qn=Tr=null,br=0),!(n.subtreeFlags&2064)&&!(n.flags&2064)||Hd||(Hd=!0,Ix(_p,function(){return ru(),null})),a=(n.flags&15990)!==0,n.subtreeFlags&15990||a){a=pa.transition,pa.transition=null;var o=Gt;Gt=1;var s=Vt;Vt|=4,t4.current=null,jV(t,n),Sx(n,t),vV(jm),Lp=!!zm,jm=zm=null,t.current=n,HV(n),xI(),Vt=s,Gt=o,pa.transition=a}else t.current=n;if(Hd&&(Hd=!1,oc=t,Kp=i),a=t.pendingLanes,a===0&&(mc=null),OI(n.stateNode),bi(t,Gn()),e!==null)for(r=t.onRecoverableError,n=0;n<e.length;n++)i=e[n],r(i.value,{componentStack:i.stack,digest:i.digest});if(Hp)throw Hp=!1,t=f3,f3=null,t;return Kp&1&&t.tag!==0&&ru(),a=t.pendingLanes,a&1?t===g3?tg++:(tg=0,g3=t):tg=0,bc(),null}function ru(){if(oc!==null){var t=lw(Kp),e=pa.transition,n=Gt;try{if(pa.transition=null,Gt=16>t?16:t,oc===null)var r=!1;else{if(t=oc,oc=null,Kp=0,Vt&6)throw Error(_e(331));var i=Vt;for(Vt|=4,Ae=t.current;Ae!==null;){var a=Ae,o=a.child;if(Ae.flags&16){var s=a.deletions;if(s!==null){for(var c=0;c<s.length;c++){var l=s[c];for(Ae=l;Ae!==null;){var f=Ae;switch(f.tag){case 0:case 11:case 15:Jf(8,f,a)}var u=f.child;if(u!==null)u.return=f,Ae=u;else for(;Ae!==null;){f=Ae;var g=f.sibling,d=f.return;if(Cx(f),f===l){Ae=null;break}if(g!==null){g.return=d,Ae=g;break}Ae=d}}}var h=a.alternate;if(h!==null){var p=h.child;if(p!==null){h.child=null;do{var m=p.sibling;p.sibling=null,p=m}while(p!==null)}}Ae=a}}if(a.subtreeFlags&2064&&o!==null)o.return=a,Ae=o;else e:for(;Ae!==null;){if(a=Ae,a.flags&2048)switch(a.tag){case 0:case 11:case 15:Jf(9,a,a.return)}var v=a.sibling;if(v!==null){v.return=a.return,Ae=v;break e}Ae=a.return}}var y=t.current;for(Ae=y;Ae!==null;){o=Ae;var T=o.child;if(o.subtreeFlags&2064&&T!==null)T.return=o,Ae=T;else e:for(o=y;Ae!==null;){if(s=Ae,s.flags&2048)try{switch(s.tag){case 0:case 11:case 15:e2(9,s)}}catch(w){Dn(s,s.return,w)}if(s===o){Ae=null;break e}var C=s.sibling;if(C!==null){C.return=s.return,Ae=C;break e}Ae=s.return}}if(Vt=i,bc(),lo&&typeof lo.onPostCommitFiberRoot=="function")try{lo.onPostCommitFiberRoot(Hh,t)}catch{}r=!0}return r}finally{Gt=n,pa.transition=e}}return!1}function W6(t,e,n){e=Su(n,e),e=lx(t,e,1),t=hc(t,e,1),e=fi(),t!==null&&(od(t,1,e),bi(t,e))}function Dn(t,e,n){if(t.tag===3)W6(t,t,n);else for(;e!==null;){if(e.tag===3){W6(e,t,n);break}else if(e.tag===1){var r=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof r.componentDidCatch=="function"&&(mc===null||!mc.has(r))){t=Su(n,t),t=ux(e,t,1),e=hc(e,t,1),t=fi(),e!==null&&(od(e,1,t),bi(e,t));break}}e=e.return}}function QV(t,e,n){var r=t.pingCache;r!==null&&r.delete(e),e=fi(),t.pingedLanes|=t.suspendedLanes&n,Tr===t&&(br&n)===n&&(or===4||or===3&&(br&130023424)===br&&500>Gn()-r4?F0(t,0):n4|=n),bi(t,e)}function bx(t,e){e===0&&(t.mode&1?(e=kd,kd<<=1,!(kd&130023424)&&(kd=4194304)):e=1);var n=fi();t=ds(t,e),t!==null&&(od(t,e,n),bi(t,n))}function JV(t){var e=t.memoizedState,n=0;e!==null&&(n=e.retryLane),bx(t,n)}function eP(t,e){var n=0;switch(t.tag){case 13:var r=t.stateNode,i=t.memoizedState;i!==null&&(n=i.retryLane);break;case 19:r=t.stateNode;break;default:throw Error(_e(314))}r!==null&&r.delete(e),bx(t,n)}var Lx;Lx=function(t,e,n){if(t!==null)if(t.memoizedProps!==e.pendingProps||Mi.current)Di=!0;else{if(!(t.lanes&n)&&!(e.flags&128))return Di=!1,GV(t,e,n);Di=!!(t.flags&131072)}else Di=!1,ln&&e.flags&1048576&&Nw(e,Fp,e.index);switch(e.lanes=0,e.tag){case 2:var r=e.type;j1(t,e),t=e.pendingProps;var i=Tu(e,Wr.current);nu(e,n),i=Yv(null,e,r,t,i,n);var a=Zv();return e.flags|=1,typeof i=="object"&&i!==null&&typeof i.render=="function"&&i.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,_i(r)?(a=!0,kp(e)):a=!1,e.memoizedState=i.state!==null&&i.state!==void 0?i.state:null,jv(e),i.updater=Jh,e.stateNode=i,i._reactInternals=e,e3(e,r,t,n),e=r3(null,e,r,!0,a,n)):(e.tag=0,ln&&a&&Fv(e),oi(null,e,i,n),e=e.child),e;case 16:r=e.elementType;e:{switch(j1(t,e),t=e.pendingProps,i=r._init,r=i(r._payload),e.type=r,i=e.tag=nP(r),t=La(r,t),i){case 0:e=n3(null,e,r,t,n);break e;case 1:e=V6(null,e,r,t,n);break e;case 11:e=L6(null,e,r,t,n);break e;case 14:e=I6(null,e,r,La(r.type,t),n);break e}throw Error(_e(306,r,""))}return e;case 0:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:La(r,i),n3(t,e,r,i,n);case 1:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:La(r,i),V6(t,e,r,i,n);case 3:e:{if(px(e),t===null)throw Error(_e(387));r=e.pendingProps,a=e.memoizedState,i=a.element,Gw(t,e),Gp(e,r,null,n);var o=e.memoizedState;if(r=o.element,a.isDehydrated)if(a={element:r,isDehydrated:!1,cache:o.cache,pendingSuspenseBoundaries:o.pendingSuspenseBoundaries,transitions:o.transitions},e.updateQueue.baseState=a,e.memoizedState=a,e.flags&256){i=Su(Error(_e(423)),e),e=P6(t,e,r,n,i);break e}else if(r!==i){i=Su(Error(_e(424)),e),e=P6(t,e,r,n,i);break e}else for($i=pc(e.stateNode.containerInfo.firstChild),zi=e,ln=!0,Pa=null,n=Uw(e,null,r,n),e.child=n;n;)n.flags=n.flags&-3|4096,n=n.sibling;else{if(Cu(),r===i){e=ps(t,e,n);break e}oi(t,e,r,n)}e=e.child}return e;case 5:return $w(e),t===null&&Zm(e),r=e.type,i=e.pendingProps,a=t!==null?t.memoizedProps:null,o=i.children,Hm(r,i)?o=null:a!==null&&Hm(r,a)&&(e.flags|=32),dx(t,e),oi(t,e,o,n),e.child;case 6:return t===null&&Zm(e),null;case 13:return hx(t,e,n);case 4:return Hv(e,e.stateNode.containerInfo),r=e.pendingProps,t===null?e.child=wu(e,null,r,n):oi(t,e,r,n),e.child;case 11:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:La(r,i),L6(t,e,r,i,n);case 7:return oi(t,e,e.pendingProps,n),e.child;case 8:return oi(t,e,e.pendingProps.children,n),e.child;case 12:return oi(t,e,e.pendingProps.children,n),e.child;case 10:e:{if(r=e.type._context,i=e.pendingProps,a=e.memoizedProps,o=i.value,qt(Up,r._currentValue),r._currentValue=o,a!==null)if($a(a.value,o)){if(a.children===i.children&&!Mi.current){e=ps(t,e,n);break e}}else for(a=e.child,a!==null&&(a.return=e);a!==null;){var s=a.dependencies;if(s!==null){o=a.child;for(var c=s.firstContext;c!==null;){if(c.context===r){if(a.tag===1){c=rs(-1,n&-n),c.tag=2;var l=a.updateQueue;if(l!==null){l=l.shared;var f=l.pending;f===null?c.next=c:(c.next=f.next,f.next=c),l.pending=c}}a.lanes|=n,c=a.alternate,c!==null&&(c.lanes|=n),Qm(a.return,n,e),s.lanes|=n;break}c=c.next}}else if(a.tag===10)o=a.type===e.type?null:a.child;else if(a.tag===18){if(o=a.return,o===null)throw Error(_e(341));o.lanes|=n,s=o.alternate,s!==null&&(s.lanes|=n),Qm(o,n,e),o=a.sibling}else o=a.child;if(o!==null)o.return=a;else for(o=a;o!==null;){if(o===e){o=null;break}if(a=o.sibling,a!==null){a.return=o.return,o=a;break}o=o.return}a=o}oi(t,e,i.children,n),e=e.child}return e;case 9:return i=e.type,r=e.pendingProps.children,nu(e,n),i=ma(i),r=r(i),e.flags|=1,oi(t,e,r,n),e.child;case 14:return r=e.type,i=La(r,e.pendingProps),i=La(r.type,i),I6(t,e,r,i,n);case 15:return fx(t,e,e.type,e.pendingProps,n);case 17:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:La(r,i),j1(t,e),e.tag=1,_i(r)?(t=!0,kp(e)):t=!1,nu(e,n),cx(e,r,i),e3(e,r,i,n),r3(null,e,r,!0,t,n);case 19:return mx(t,e,n);case 22:return gx(t,e,n)}throw Error(_e(156,e.tag))};function Ix(t,e){return aw(t,e)}function tP(t,e,n,r){this.tag=t,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function ga(t,e,n,r){return new tP(t,e,n,r)}function s4(t){return t=t.prototype,!(!t||!t.isReactComponent)}function nP(t){if(typeof t=="function")return s4(t)?1:0;if(t!=null){if(t=t.$$typeof,t===Dv)return 11;if(t===Rv)return 14}return 2}function yc(t,e){var n=t.alternate;return n===null?(n=ga(t.tag,e,t.key,t.mode),n.elementType=t.elementType,n.type=t.type,n.stateNode=t.stateNode,n.alternate=t,t.alternate=n):(n.pendingProps=e,n.type=t.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=t.flags&14680064,n.childLanes=t.childLanes,n.lanes=t.lanes,n.child=t.child,n.memoizedProps=t.memoizedProps,n.memoizedState=t.memoizedState,n.updateQueue=t.updateQueue,e=t.dependencies,n.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},n.sibling=t.sibling,n.index=t.index,n.ref=t.ref,n}function q1(t,e,n,r,i,a){var o=2;if(r=t,typeof t=="function")s4(t)&&(o=1);else if(typeof t=="string")o=5;else e:switch(t){case Il:return U0(n.children,i,a,e);case Ov:o=8,i|=8;break;case Em:return t=ga(12,n,e,i|2),t.elementType=Em,t.lanes=a,t;case Om:return t=ga(13,n,e,i),t.elementType=Om,t.lanes=a,t;case Dm:return t=ga(19,n,e,i),t.elementType=Dm,t.lanes=a,t;case $C:return n2(n,i,a,e);default:if(typeof t=="object"&&t!==null)switch(t.$$typeof){case BC:o=10;break e;case GC:o=9;break e;case Dv:o=11;break e;case Rv:o=14;break e;case Xs:o=16,r=null;break e}throw Error(_e(130,t==null?t:typeof t,""))}return e=ga(o,n,e,i),e.elementType=t,e.type=r,e.lanes=a,e}function U0(t,e,n,r){return t=ga(7,t,r,e),t.lanes=n,t}function n2(t,e,n,r){return t=ga(22,t,r,e),t.elementType=$C,t.lanes=n,t.stateNode={isHidden:!1},t}function x5(t,e,n){return t=ga(6,t,null,e),t.lanes=n,t}function S5(t,e,n){return e=ga(4,t.children!==null?t.children:[],t.key,e),e.lanes=n,e.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},e}function rP(t,e,n,r,i){this.tag=e,this.containerInfo=t,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=r5(0),this.expirationTimes=r5(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=r5(0),this.identifierPrefix=r,this.onRecoverableError=i,this.mutableSourceEagerHydrationData=null}function c4(t,e,n,r,i,a,o,s,c){return t=new rP(t,e,n,s,c),e===1?(e=1,a===!0&&(e|=8)):e=0,a=ga(3,null,null,e),t.current=a,a.stateNode=t,a.memoizedState={element:r,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},jv(a),t}function iP(t,e,n){var r=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Ll,key:r==null?null:""+r,children:t,containerInfo:e,implementation:n}}function Vx(t){if(!t)return Sc;t=t._reactInternals;e:{if(fl(t)!==t||t.tag!==1)throw Error(_e(170));var e=t;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(_i(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(_e(171))}if(t.tag===1){var n=t.type;if(_i(n))return Vw(t,n,e)}return e}function Px(t,e,n,r,i,a,o,s,c){return t=c4(n,r,!0,t,i,a,o,s,c),t.context=Vx(null),n=t.current,r=fi(),i=vc(n),a=rs(r,i),a.callback=e??null,hc(n,a,i),t.current.lanes=i,od(t,i,r),bi(t,r),t}function r2(t,e,n,r){var i=e.current,a=fi(),o=vc(i);return n=Vx(n),e.context===null?e.context=n:e.pendingContext=n,e=rs(a,o),e.payload={element:t},r=r===void 0?null:r,r!==null&&(e.callback=r),t=hc(i,e,o),t!==null&&(Ga(t,i,o,a),$1(t,i,o)),o}function Xp(t){if(t=t.current,!t.child)return null;switch(t.child.tag){case 5:return t.child.stateNode;default:return t.child.stateNode}}function z6(t,e){if(t=t.memoizedState,t!==null&&t.dehydrated!==null){var n=t.retryLane;t.retryLane=n!==0&&n<e?n:e}}function l4(t,e){z6(t,e),(t=t.alternate)&&z6(t,e)}function aP(){return null}var Nx=typeof reportError=="function"?reportError:function(t){console.error(t)};function u4(t){this._internalRoot=t}i2.prototype.render=u4.prototype.render=function(t){var e=this._internalRoot;if(e===null)throw Error(_e(409));r2(t,e,null,null)};i2.prototype.unmount=u4.prototype.unmount=function(){var t=this._internalRoot;if(t!==null){this._internalRoot=null;var e=t.containerInfo;X0(function(){r2(null,t,null,null)}),e[gs]=null}};function i2(t){this._internalRoot=t}i2.prototype.unstable_scheduleHydration=function(t){if(t){var e=gw();t={blockedOn:null,target:t,priority:e};for(var n=0;n<Js.length&&e!==0&&e<Js[n].priority;n++);Js.splice(n,0,t),n===0&&pw(t)}};function f4(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11)}function a2(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11&&(t.nodeType!==8||t.nodeValue!==" react-mount-point-unstable "))}function j6(){}function oP(t,e,n,r,i){if(i){if(typeof r=="function"){var a=r;r=function(){var l=Xp(o);a.call(l)}}var o=Px(e,r,t,0,null,!1,!1,"",j6);return t._reactRootContainer=o,t[gs]=o.current,Rg(t.nodeType===8?t.parentNode:t),X0(),o}for(;i=t.lastChild;)t.removeChild(i);if(typeof r=="function"){var s=r;r=function(){var l=Xp(c);s.call(l)}}var c=c4(t,0,!1,null,null,!1,!1,"",j6);return t._reactRootContainer=c,t[gs]=c.current,Rg(t.nodeType===8?t.parentNode:t),X0(function(){r2(e,c,n,r)}),c}function o2(t,e,n,r,i){var a=n._reactRootContainer;if(a){var o=a;if(typeof i=="function"){var s=i;i=function(){var c=Xp(o);s.call(c)}}r2(e,o,t,i)}else o=oP(n,e,t,i,r);return Xp(o)}uw=function(t){switch(t.tag){case 3:var e=t.stateNode;if(e.current.memoizedState.isDehydrated){var n=If(e.pendingLanes);n!==0&&(bv(e,n|1),bi(e,Gn()),!(Vt&6)&&(Eu=Gn()+500,bc()))}break;case 13:X0(function(){var r=ds(t,1);if(r!==null){var i=fi();Ga(r,t,1,i)}}),l4(t,1)}};Lv=function(t){if(t.tag===13){var e=ds(t,134217728);if(e!==null){var n=fi();Ga(e,t,134217728,n)}l4(t,134217728)}};fw=function(t){if(t.tag===13){var e=vc(t),n=ds(t,e);if(n!==null){var r=fi();Ga(n,t,e,r)}l4(t,e)}};gw=function(){return Gt};dw=function(t,e){var n=Gt;try{return Gt=t,e()}finally{Gt=n}};km=function(t,e,n){switch(e){case"input":if(_m(t,n),e=n.name,n.type==="radio"&&e!=null){for(n=t;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<n.length;e++){var r=n[e];if(r!==t&&r.form===t.form){var i=Yh(r);if(!i)throw Error(_e(90));zC(r),_m(r,i)}}}break;case"textarea":HC(t,n);break;case"select":e=n.value,e!=null&&Ql(t,!!n.multiple,e,!1)}};JC=i4;ew=X0;var sP={usingClientEntryPoint:!1,Events:[cd,kl,Yh,ZC,QC,i4]},hf={findFiberByHostInstance:_0,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},cP={bundleType:hf.bundleType,version:hf.version,rendererPackageName:hf.rendererPackageName,rendererConfig:hf.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Ts.ReactCurrentDispatcher,findHostInstanceByFiber:function(t){return t=rw(t),t===null?null:t.stateNode},findFiberByHostInstance:hf.findFiberByHostInstance||aP,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Kd=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Kd.isDisabled&&Kd.supportsFiber)try{Hh=Kd.inject(cP),lo=Kd}catch{}}Ki.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=sP;Ki.createPortal=function(t,e){var n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!f4(e))throw Error(_e(200));return iP(t,e,null,n)};Ki.createRoot=function(t,e){if(!f4(t))throw Error(_e(299));var n=!1,r="",i=Nx;return e!=null&&(e.unstable_strictMode===!0&&(n=!0),e.identifierPrefix!==void 0&&(r=e.identifierPrefix),e.onRecoverableError!==void 0&&(i=e.onRecoverableError)),e=c4(t,1,!1,null,null,n,!1,r,i),t[gs]=e.current,Rg(t.nodeType===8?t.parentNode:t),new u4(e)};Ki.findDOMNode=function(t){if(t==null)return null;if(t.nodeType===1)return t;var e=t._reactInternals;if(e===void 0)throw typeof t.render=="function"?Error(_e(188)):(t=Object.keys(t).join(","),Error(_e(268,t)));return t=rw(e),t=t===null?null:t.stateNode,t};Ki.flushSync=function(t){return X0(t)};Ki.hydrate=function(t,e,n){if(!a2(e))throw Error(_e(200));return o2(null,t,e,!0,n)};Ki.hydrateRoot=function(t,e,n){if(!f4(t))throw Error(_e(405));var r=n!=null&&n.hydratedSources||null,i=!1,a="",o=Nx;if(n!=null&&(n.unstable_strictMode===!0&&(i=!0),n.identifierPrefix!==void 0&&(a=n.identifierPrefix),n.onRecoverableError!==void 0&&(o=n.onRecoverableError)),e=Px(e,null,t,1,n??null,i,!1,a,o),t[gs]=e.current,Rg(t),r)for(t=0;t<r.length;t++)n=r[t],i=n._getVersion,i=i(n._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[n,i]:e.mutableSourceEagerHydrationData.push(n,i);return new i2(e)};Ki.render=function(t,e,n){if(!a2(e))throw Error(_e(200));return o2(null,t,e,!1,n)};Ki.unmountComponentAtNode=function(t){if(!a2(t))throw Error(_e(40));return t._reactRootContainer?(X0(function(){o2(null,null,t,!1,function(){t._reactRootContainer=null,t[gs]=null})}),!0):!1};Ki.unstable_batchedUpdates=i4;Ki.unstable_renderSubtreeIntoContainer=function(t,e,n,r){if(!a2(n))throw Error(_e(200));if(t==null||t._reactInternals===void 0)throw Error(_e(38));return o2(t,e,n,!1,r)};Ki.version="18.3.1-next-f1338f8080-20240426";function kx(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(kx)}catch(t){console.error(t)}}kx(),kC.exports=Ki;var lP=kC.exports,H6=lP;xm.createRoot=H6.createRoot,xm.hydrateRoot=H6.hydrateRoot;function uP(t,e,n){if(t===void 0)throw new Error("decodeRGB: rgbBuffer must be defined");if(t.length%3!==0)throw new Error(`decodeRGB: rgbBuffer length ${t.length} must be divisible by 3`);const r=t.length/3;let i=0,a=0;if(n){for(let o=0;o<r;o++)e[a++]=t[i++],e[a++]=t[i++],e[a++]=t[i++],e[a++]=255;return}e.set(t)}function fP(t,e,n){if(t===void 0)throw new Error("decodeRGB: rgbBuffer must be defined");if(t.length%3!==0)throw new Error(`decodeRGB: rgbBuffer length ${t.length} must be divisible by 3`);const r=t.length/3;let i=0,a=0,o=r,s=r*2;if(n)for(let c=0;c<r;c++)e[i++]=t[a++],e[i++]=t[o++],e[i++]=t[s++],e[i++]=255;else for(let c=0;c<r;c++)e[i++]=t[a++],e[i++]=t[o++],e[i++]=t[s++]}function gP(t,e,n){if(t===void 0)throw new Error("convertYBRFullByPixel: ybrBuffer must be defined");if(t.length%3!==0)throw new Error(`convertYBRFullByPixel: ybrBuffer length ${t.length} must be divisible by 3`);const r=t.length/3;let i=0,a=0;if(n){for(let o=0;o<r;o++){const s=t[i++],c=t[i++],l=t[i++];e[a++]=s+1.402*(l-128),e[a++]=s-.34414*(c-128)-.71414*(l-128),e[a++]=s+1.772*(c-128),e[a++]=255}return}for(let o=0;o<r;o++){const s=t[i++],c=t[i++],l=t[i++];e[a++]=s+1.402*(l-128),e[a++]=s-.34414*(c-128)-.71414*(l-128),e[a++]=s+1.772*(c-128)}}function dP(t,e,n){if(t===void 0)throw new Error("convertYBRFullByPlane: ybrBuffer must be defined");if(t.length%3!==0)throw new Error(`convertYBRFullByPlane: ybrBuffer length ${t.length} must be divisible by 3`);const r=t.length/3;let i=0,a=0,o=r,s=r*2;if(n){for(let c=0;c<r;c++){const l=t[a++],f=t[o++],u=t[s++];e[i++]=l+1.402*(u-128),e[i++]=l-.34414*(f-128)-.71414*(u-128),e[i++]=l+1.772*(f-128),e[i++]=255}return}for(let c=0;c<r;c++){const l=t[a++],f=t[o++],u=t[s++];e[i++]=l+1.402*(u-128),e[i++]=l-.34414*(f-128)-.71414*(u-128),e[i++]=l+1.772*(f-128)}}function pP(t,e,n){if(t===void 0)throw new Error("convertYBRFull422ByPixel: ybrBuffer must be defined");if(t.length%2!==0)throw new Error(`convertYBRFull422ByPixel: ybrBuffer length ${t.length} must be divisible by 2`);const r=t.length/2;let i=0,a=0;if(n){for(let o=0;o<r;o+=2){const s=t[i++],c=t[i++],l=t[i++],f=t[i++];e[a++]=s+1.402*(f-128),e[a++]=s-.34414*(l-128)-.71414*(f-128),e[a++]=s+1.772*(l-128),e[a++]=255,e[a++]=c+1.402*(f-128),e[a++]=c-.34414*(l-128)-.71414*(f-128),e[a++]=c+1.772*(l-128),e[a++]=255}return}for(let o=0;o<r;o+=2){const s=t[i++],c=t[i++],l=t[i++],f=t[i++];e[a++]=s+1.402*(f-128),e[a++]=s-.34414*(l-128)-.71414*(f-128),e[a++]=s+1.772*(l-128),e[a++]=c+1.402*(f-128),e[a++]=c-.34414*(l-128)-.71414*(f-128),e[a++]=c+1.772*(l-128)}}var Oe;(function(t){t.ERROR_EVENT="CORNERSTONE_ERROR",t.CACHE_SIZE_EXCEEDED="CACHE_SIZE_EXCEEDED",t.IMAGE_LOAD_ERROR="IMAGE_LOAD_ERROR",t.CAMERA_MODIFIED="CORNERSTONE_CAMERA_MODIFIED",t.CAMERA_RESET="CORNERSTONE_CAMERA_RESET",t.VOI_MODIFIED="CORNERSTONE_VOI_MODIFIED",t.PRESET_MODIFIED="CORNERSTONE_VIEWPORT_RENDERING_PRESET_MODIFIED",t.DISPLAY_AREA_MODIFIED="CORNERSTONE_DISPLAY_AREA_MODIFIED",t.ELEMENT_DISABLED="CORNERSTONE_ELEMENT_DISABLED",t.ELEMENT_ENABLED="CORNERSTONE_ELEMENT_ENABLED",t.IMAGE_RENDERED="CORNERSTONE_IMAGE_RENDERED",t.IMAGE_VOLUME_MODIFIED="CORNERSTONE_IMAGE_VOLUME_MODIFIED",t.IMAGE_VOLUME_LOADING_COMPLETED="CORNERSTONE_IMAGE_VOLUME_LOADING_COMPLETED",t.IMAGE_LOADED="CORNERSTONE_IMAGE_LOADED",t.IMAGE_RETRIEVAL_STAGE="CORNERSTONE_IMAGE_RETRIEVAL_STAGE",t.IMAGE_LOAD_FAILED="CORNERSTONE_IMAGE_LOAD_FAILED",t.VOLUME_VIEWPORT_NEW_VOLUME="CORNERSTONE_VOLUME_VIEWPORT_NEW_VOLUME",t.VOLUME_LOADED="CORNERSTONE_VOLUME_LOADED",t.VOLUME_LOADED_FAILED="CORNERSTONE_VOLUME_LOADED_FAILED",t.IMAGE_CACHE_IMAGE_ADDED="CORNERSTONE_IMAGE_CACHE_IMAGE_ADDED",t.IMAGE_CACHE_IMAGE_REMOVED="CORNERSTONE_IMAGE_CACHE_IMAGE_REMOVED",t.VOLUME_CACHE_VOLUME_ADDED="CORNERSTONE_VOLUME_CACHE_VOLUME_ADDED",t.VOLUME_CACHE_VOLUME_REMOVED="CORNERSTONE_VOLUME_CACHE_VOLUME_REMOVED",t.STACK_NEW_IMAGE="CORNERSTONE_STACK_NEW_IMAGE",t.VOLUME_NEW_IMAGE="CORNERSTONE_VOLUME_NEW_IMAGE",t.PRE_STACK_NEW_IMAGE="CORNERSTONE_PRE_STACK_NEW_IMAGE",t.IMAGE_SPACING_CALIBRATED="CORNERSTONE_IMAGE_SPACING_CALIBRATED",t.VIEWPORT_NEW_IMAGE_SET="CORNERSTONE_VIEWPORT_NEW_IMAGE_SET",t.STACK_VIEWPORT_SCROLL="CORNERSTONE_STACK_VIEWPORT_SCROLL",t.STACK_SCROLL_OUT_OF_BOUNDS="STACK_SCROLL_OUT_OF_BOUNDS",t.GEOMETRY_CACHE_GEOMETRY_ADDED="CORNERSTONE_GEOMETRY_CACHE_GEOMETRY_ADDED",t.GEOMETRY_CACHE_GEOMETRY_REMOVED="CORNERSTONE_GEOMETRY_CACHE_GEOMETRY_REMOVED",t.VOLUME_VIEWPORT_SCROLL_OUT_OF_BOUNDS="VOLUME_VIEWPORT_SCROLL_OUT_OF_BOUNDS",t.VOLUME_VIEWPORT_SCROLL="VOLUME_VIEWPORT_SCROLL",t.CLIPPING_PLANES_UPDATED="CORNERSTONE_CLIPPING_PLANES_UPDATED",t.WEB_WORKER_PROGRESS="CORNERSTONE_WEB_WORKER_PROGRESS",t.COLORMAP_MODIFIED="CORNERSTONE_COLORMAP_MODIFIED",t.DYNAMIC_VOLUME_DIMENSION_GROUP_CHANGED="DYNAMIC_VOLUME_DIMENSION_GROUP_CHANGED",t.DYNAMIC_VOLUME_TIME_POINT_INDEX_CHANGED="DYNAMIC_VOLUME_TIME_POINT_INDEX_CHANGED",t.DYNAMIC_VOLUME_DIMENSION_GROUP_LOADED="DYNAMIC_VOLUME_DIMENSION_GROUP_LOADED",t.DYNAMIC_VOLUME_TIME_POINT_LOADED="DYNAMIC_VOLUME_TIME_POINT_LOADED",t.GEOMETRY_LOADED="GEOMETRY_LOADED",t.GEOMETRY_LOADED_FAILED="GEOMETRY_LOADED_FAILED"})(Oe||(Oe={}));var ot;(function(t){t.Interaction="interaction",t.Thumbnail="thumbnail",t.Prefetch="prefetch",t.Compute="compute"})(ot||(ot={}));var un;(function(t){t.STACK="stack",t.ORTHOGRAPHIC="orthographic",t.PERSPECTIVE="perspective",t.VOLUME_3D="volume3d",t.VIDEO="video",t.WHOLE_SLIDE="wholeSlide"})(un||(un={}));var ts;(function(t){t[t.NEAREST=0]="NEAREST",t[t.LINEAR=1]="LINEAR",t[t.FAST_LINEAR=2]="FAST_LINEAR"})(ts||(ts={}));const X1={COMPOSITE_BLEND:0,MAXIMUM_INTENSITY_BLEND:1,MINIMUM_INTENSITY_BLEND:2,AVERAGE_INTENSITY_BLEND:3,ADDITIVE_INTENSITY_BLEND:4,RADON_TRANSFORM_BLEND:5,LABELMAP_EDGE_PROJECTION_BLEND:6},hP={OFF:0,NORMALIZED:1,RAW:2};var Ax={BlendMode:X1,FilterMode:hP};const{BlendMode:mf}=Ax;var Tc;(function(t){t[t.COMPOSITE=mf.COMPOSITE_BLEND]="COMPOSITE",t[t.MAXIMUM_INTENSITY_BLEND=mf.MAXIMUM_INTENSITY_BLEND]="MAXIMUM_INTENSITY_BLEND",t[t.MINIMUM_INTENSITY_BLEND=mf.MINIMUM_INTENSITY_BLEND]="MINIMUM_INTENSITY_BLEND",t[t.AVERAGE_INTENSITY_BLEND=mf.AVERAGE_INTENSITY_BLEND]="AVERAGE_INTENSITY_BLEND",t[t.LABELMAP_EDGE_PROJECTION_BLEND=mf.LABELMAP_EDGE_PROJECTION_BLEND]="LABELMAP_EDGE_PROJECTION_BLEND"})(Tc||(Tc={}));var Ou;(function(t){t.AXIAL="axial",t.CORONAL="coronal",t.SAGITTAL="sagittal",t.ACQUISITION="acquisition"})(Ou||(Ou={}));var hs;(function(t){t.CONTOUR="CONTOUR",t.SURFACE="SURFACE"})(hs||(hs={}));var h3;(function(t){t.CLOSED_PLANAR="CLOSED_PLANAR",t.OPEN_PLANAR="OPEN_PLANAR"})(h3||(h3={}));const mP=h3;var ui;(function(t){t.LINEAR="LINEAR",t.SAMPLED_SIGMOID="SIGMOID",t.LINEAR_EXACT="LINEAR_EXACT"})(ui||(ui={}));var m3;(function(t){t.SUM="SUM",t.AVERAGE="AVERAGE",t.SUBTRACT="SUBTRACT"})(m3||(m3={}));const vP=m3;var v3;(function(t){t.NOT_APPLICABLE="",t.ERMF="ERMF",t.USER="User",t.PROJECTION="Proj",t.REGION="Region",t.ERROR="Error",t.UNCALIBRATED="Uncalibrated"})(v3||(v3={}));const yP=v3;var si;(function(t){t.NO_DATA="noData",t.LOADING="loading",t.PRE_RENDER="preRender",t.RESIZE="resize",t.RENDERED="rendered"})(si||(si={}));var Wi;(function(t){t[t.FAR_REPLICATE=1]="FAR_REPLICATE",t[t.ADJACENT_REPLICATE=3]="ADJACENT_REPLICATE",t[t.SUBRESOLUTION=6]="SUBRESOLUTION",t[t.LOSSY=7]="LOSSY",t[t.FULL_RESOLUTION=8]="FULL_RESOLUTION"})(Wi||(Wi={}));var kg;(function(t){t.FRAME="f",t.SECOND="s"})(kg||(kg={}));const TP=Object.freeze(Object.defineProperty({__proto__:null,get SpeedUnit(){return kg}},Symbol.toStringTag,{value:"Module"}));var li;(function(t){t.CALIBRATION="calibrationModule",t.CINE="cineModule",t.GENERAL_IMAGE="generalImageModule",t.GENERAL_SERIES="generalSeriesModule",t.GENERAL_STUDY="generalStudyModule",t.IMAGE_PIXEL="imagePixelModule",t.IMAGE_PLANE="imagePlaneModule",t.IMAGE_URL="imageUrlModule",t.MODALITY_LUT="modalityLutModule",t.MULTIFRAME="multiframeModule",t.NM_MULTIFRAME_GEOMETRY="nmMultiframeGeometryModule",t.OVERLAY_PLANE="overlayPlaneModule",t.PATIENT="patientModule",t.PATIENT_STUDY="patientStudyModule",t.PET_IMAGE="petImageModule",t.PET_ISOTOPE="petIsotopeModule",t.PET_SERIES="petSeriesModule",t.SOP_COMMON="sopCommonModule",t.ULTRASOUND_ENHANCED_REGION="ultrasoundEnhancedRegionModule",t.VOI_LUT="voiLutModule",t.WADO_WEB_CLIENT="wadoWebClient"})(li||(li={}));var y3;(function(t){t.SUM="SUM",t.SUBTRACT="SUBTRACT",t.AVERAGE="AVERAGE"})(y3||(y3={}));var Yp;(function(t){t.RLE="RLE",t.Volume="Volume"})(Yp||(Yp={}));const Cs=Object.freeze(Object.defineProperty({__proto__:null,BlendModes:Tc,CalibrationTypes:yP,ContourType:mP,DynamicOperatorType:vP,Events:Oe,get GenerateImageType(){return y3},GeometryType:hs,ImageQualityStatus:Wi,InterpolationType:ts,MetadataModules:li,OrientationAxis:Ou,RequestType:ot,VOILUTFunctionType:ui,VideoEnums:TP,ViewportStatus:si,ViewportType:un,VoxelManagerEnum:Yp},Symbol.toStringTag,{value:"Module"})),T3={hotIron:{name:"Hot Iron",numOfColors:256,colors:[[0,0,0,255],[2,0,0,255],[4,0,0,255],[6,0,0,255],[8,0,0,255],[10,0,0,255],[12,0,0,255],[14,0,0,255],[16,0,0,255],[18,0,0,255],[20,0,0,255],[22,0,0,255],[24,0,0,255],[26,0,0,255],[28,0,0,255],[30,0,0,255],[32,0,0,255],[34,0,0,255],[36,0,0,255],[38,0,0,255],[40,0,0,255],[42,0,0,255],[44,0,0,255],[46,0,0,255],[48,0,0,255],[50,0,0,255],[52,0,0,255],[54,0,0,255],[56,0,0,255],[58,0,0,255],[60,0,0,255],[62,0,0,255],[64,0,0,255],[66,0,0,255],[68,0,0,255],[70,0,0,255],[72,0,0,255],[74,0,0,255],[76,0,0,255],[78,0,0,255],[80,0,0,255],[82,0,0,255],[84,0,0,255],[86,0,0,255],[88,0,0,255],[90,0,0,255],[92,0,0,255],[94,0,0,255],[96,0,0,255],[98,0,0,255],[100,0,0,255],[102,0,0,255],[104,0,0,255],[106,0,0,255],[108,0,0,255],[110,0,0,255],[112,0,0,255],[114,0,0,255],[116,0,0,255],[118,0,0,255],[120,0,0,255],[122,0,0,255],[124,0,0,255],[126,0,0,255],[128,0,0,255],[130,0,0,255],[132,0,0,255],[134,0,0,255],[136,0,0,255],[138,0,0,255],[140,0,0,255],[142,0,0,255],[144,0,0,255],[146,0,0,255],[148,0,0,255],[150,0,0,255],[152,0,0,255],[154,0,0,255],[156,0,0,255],[158,0,0,255],[160,0,0,255],[162,0,0,255],[164,0,0,255],[166,0,0,255],[168,0,0,255],[170,0,0,255],[172,0,0,255],[174,0,0,255],[176,0,0,255],[178,0,0,255],[180,0,0,255],[182,0,0,255],[184,0,0,255],[186,0,0,255],[188,0,0,255],[190,0,0,255],[192,0,0,255],[194,0,0,255],[196,0,0,255],[198,0,0,255],[200,0,0,255],[202,0,0,255],[204,0,0,255],[206,0,0,255],[208,0,0,255],[210,0,0,255],[212,0,0,255],[214,0,0,255],[216,0,0,255],[218,0,0,255],[220,0,0,255],[222,0,0,255],[224,0,0,255],[226,0,0,255],[228,0,0,255],[230,0,0,255],[232,0,0,255],[234,0,0,255],[236,0,0,255],[238,0,0,255],[240,0,0,255],[242,0,0,255],[244,0,0,255],[246,0,0,255],[248,0,0,255],[250,0,0,255],[252,0,0,255],[254,0,0,255],[255,0,0,255],[255,2,0,255],[255,4,0,255],[255,6,0,255],[255,8,0,255],[255,10,0,255],[255,12,0,255],[255,14,0,255],[255,16,0,255],[255,18,0,255],[255,20,0,255],[255,22,0,255],[255,24,0,255],[255,26,0,255],[255,28,0,255],[255,30,0,255],[255,32,0,255],[255,34,0,255],[255,36,0,255],[255,38,0,255],[255,40,0,255],[255,42,0,255],[255,44,0,255],[255,46,0,255],[255,48,0,255],[255,50,0,255],[255,52,0,255],[255,54,0,255],[255,56,0,255],[255,58,0,255],[255,60,0,255],[255,62,0,255],[255,64,0,255],[255,66,0,255],[255,68,0,255],[255,70,0,255],[255,72,0,255],[255,74,0,255],[255,76,0,255],[255,78,0,255],[255,80,0,255],[255,82,0,255],[255,84,0,255],[255,86,0,255],[255,88,0,255],[255,90,0,255],[255,92,0,255],[255,94,0,255],[255,96,0,255],[255,98,0,255],[255,100,0,255],[255,102,0,255],[255,104,0,255],[255,106,0,255],[255,108,0,255],[255,110,0,255],[255,112,0,255],[255,114,0,255],[255,116,0,255],[255,118,0,255],[255,120,0,255],[255,122,0,255],[255,124,0,255],[255,126,0,255],[255,128,4,255],[255,130,8,255],[255,132,12,255],[255,134,16,255],[255,136,20,255],[255,138,24,255],[255,140,28,255],[255,142,32,255],[255,144,36,255],[255,146,40,255],[255,148,44,255],[255,150,48,255],[255,152,52,255],[255,154,56,255],[255,156,60,255],[255,158,64,255],[255,160,68,255],[255,162,72,255],[255,164,76,255],[255,166,80,255],[255,168,84,255],[255,170,88,255],[255,172,92,255],[255,174,96,255],[255,176,100,255],[255,178,104,255],[255,180,108,255],[255,182,112,255],[255,184,116,255],[255,186,120,255],[255,188,124,255],[255,190,128,255],[255,192,132,255],[255,194,136,255],[255,196,140,255],[255,198,144,255],[255,200,148,255],[255,202,152,255],[255,204,156,255],[255,206,160,255],[255,208,164,255],[255,210,168,255],[255,212,172,255],[255,214,176,255],[255,216,180,255],[255,218,184,255],[255,220,188,255],[255,222,192,255],[255,224,196,255],[255,226,200,255],[255,228,204,255],[255,230,208,255],[255,232,212,255],[255,234,216,255],[255,236,220,255],[255,238,224,255],[255,240,228,255],[255,242,232,255],[255,244,236,255],[255,246,240,255],[255,248,244,255],[255,250,248,255],[255,252,252,255],[255,255,255,255]]},pet:{name:"PET",numColors:256,colors:[[0,0,0,255],[0,2,1,255],[0,4,3,255],[0,6,5,255],[0,8,7,255],[0,10,9,255],[0,12,11,255],[0,14,13,255],[0,16,15,255],[0,18,17,255],[0,20,19,255],[0,22,21,255],[0,24,23,255],[0,26,25,255],[0,28,27,255],[0,30,29,255],[0,32,31,255],[0,34,33,255],[0,36,35,255],[0,38,37,255],[0,40,39,255],[0,42,41,255],[0,44,43,255],[0,46,45,255],[0,48,47,255],[0,50,49,255],[0,52,51,255],[0,54,53,255],[0,56,55,255],[0,58,57,255],[0,60,59,255],[0,62,61,255],[0,65,63,255],[0,67,65,255],[0,69,67,255],[0,71,69,255],[0,73,71,255],[0,75,73,255],[0,77,75,255],[0,79,77,255],[0,81,79,255],[0,83,81,255],[0,85,83,255],[0,87,85,255],[0,89,87,255],[0,91,89,255],[0,93,91,255],[0,95,93,255],[0,97,95,255],[0,99,97,255],[0,101,99,255],[0,103,101,255],[0,105,103,255],[0,107,105,255],[0,109,107,255],[0,111,109,255],[0,113,111,255],[0,115,113,255],[0,117,115,255],[0,119,117,255],[0,121,119,255],[0,123,121,255],[0,125,123,255],[0,128,125,255],[1,126,127,255],[3,124,129,255],[5,122,131,255],[7,120,133,255],[9,118,135,255],[11,116,137,255],[13,114,139,255],[15,112,141,255],[17,110,143,255],[19,108,145,255],[21,106,147,255],[23,104,149,255],[25,102,151,255],[27,100,153,255],[29,98,155,255],[31,96,157,255],[33,94,159,255],[35,92,161,255],[37,90,163,255],[39,88,165,255],[41,86,167,255],[43,84,169,255],[45,82,171,255],[47,80,173,255],[49,78,175,255],[51,76,177,255],[53,74,179,255],[55,72,181,255],[57,70,183,255],[59,68,185,255],[61,66,187,255],[63,64,189,255],[65,63,191,255],[67,61,193,255],[69,59,195,255],[71,57,197,255],[73,55,199,255],[75,53,201,255],[77,51,203,255],[79,49,205,255],[81,47,207,255],[83,45,209,255],[85,43,211,255],[86,41,213,255],[88,39,215,255],[90,37,217,255],[92,35,219,255],[94,33,221,255],[96,31,223,255],[98,29,225,255],[100,27,227,255],[102,25,229,255],[104,23,231,255],[106,21,233,255],[108,19,235,255],[110,17,237,255],[112,15,239,255],[114,13,241,255],[116,11,243,255],[118,9,245,255],[120,7,247,255],[122,5,249,255],[124,3,251,255],[126,1,253,255],[128,0,255,255],[130,2,252,255],[132,4,248,255],[134,6,244,255],[136,8,240,255],[138,10,236,255],[140,12,232,255],[142,14,228,255],[144,16,224,255],[146,18,220,255],[148,20,216,255],[150,22,212,255],[152,24,208,255],[154,26,204,255],[156,28,200,255],[158,30,196,255],[160,32,192,255],[162,34,188,255],[164,36,184,255],[166,38,180,255],[168,40,176,255],[170,42,172,255],[171,44,168,255],[173,46,164,255],[175,48,160,255],[177,50,156,255],[179,52,152,255],[181,54,148,255],[183,56,144,255],[185,58,140,255],[187,60,136,255],[189,62,132,255],[191,64,128,255],[193,66,124,255],[195,68,120,255],[197,70,116,255],[199,72,112,255],[201,74,108,255],[203,76,104,255],[205,78,100,255],[207,80,96,255],[209,82,92,255],[211,84,88,255],[213,86,84,255],[215,88,80,255],[217,90,76,255],[219,92,72,255],[221,94,68,255],[223,96,64,255],[225,98,60,255],[227,100,56,255],[229,102,52,255],[231,104,48,255],[233,106,44,255],[235,108,40,255],[237,110,36,255],[239,112,32,255],[241,114,28,255],[243,116,24,255],[245,118,20,255],[247,120,16,255],[249,122,12,255],[251,124,8,255],[253,126,4,255],[255,128,0,255],[255,130,4,255],[255,132,8,255],[255,134,12,255],[255,136,16,255],[255,138,20,255],[255,140,24,255],[255,142,28,255],[255,144,32,255],[255,146,36,255],[255,148,40,255],[255,150,44,255],[255,152,48,255],[255,154,52,255],[255,156,56,255],[255,158,60,255],[255,160,64,255],[255,162,68,255],[255,164,72,255],[255,166,76,255],[255,168,80,255],[255,170,85,255],[255,172,89,255],[255,174,93,255],[255,176,97,255],[255,178,101,255],[255,180,105,255],[255,182,109,255],[255,184,113,255],[255,186,117,255],[255,188,121,255],[255,190,125,255],[255,192,129,255],[255,194,133,255],[255,196,137,255],[255,198,141,255],[255,200,145,255],[255,202,149,255],[255,204,153,255],[255,206,157,255],[255,208,161,255],[255,210,165,255],[255,212,170,255],[255,214,174,255],[255,216,178,255],[255,218,182,255],[255,220,186,255],[255,222,190,255],[255,224,194,255],[255,226,198,255],[255,228,202,255],[255,230,206,255],[255,232,210,255],[255,234,214,255],[255,236,218,255],[255,238,222,255],[255,240,226,255],[255,242,230,255],[255,244,234,255],[255,246,238,255],[255,248,242,255],[255,250,246,255],[255,252,250,255],[255,255,255,255]]},hotMetalBlue:{name:"Hot Metal Blue",numColors:256,colors:[[0,0,0,255],[0,0,2,255],[0,0,4,255],[0,0,6,255],[0,0,8,255],[0,0,10,255],[0,0,12,255],[0,0,14,255],[0,0,16,255],[0,0,17,255],[0,0,19,255],[0,0,21,255],[0,0,23,255],[0,0,25,255],[0,0,27,255],[0,0,29,255],[0,0,31,255],[0,0,33,255],[0,0,35,255],[0,0,37,255],[0,0,39,255],[0,0,41,255],[0,0,43,255],[0,0,45,255],[0,0,47,255],[0,0,49,255],[0,0,51,255],[0,0,53,255],[0,0,55,255],[0,0,57,255],[0,0,59,255],[0,0,61,255],[0,0,63,255],[0,0,65,255],[0,0,67,255],[0,0,69,255],[0,0,71,255],[0,0,73,255],[0,0,75,255],[0,0,77,255],[0,0,79,255],[0,0,81,255],[0,0,83,255],[0,0,84,255],[0,0,86,255],[0,0,88,255],[0,0,90,255],[0,0,92,255],[0,0,94,255],[0,0,96,255],[0,0,98,255],[0,0,100,255],[0,0,102,255],[0,0,104,255],[0,0,106,255],[0,0,108,255],[0,0,110,255],[0,0,112,255],[0,0,114,255],[0,0,116,255],[0,0,117,255],[0,0,119,255],[0,0,121,255],[0,0,123,255],[0,0,125,255],[0,0,127,255],[0,0,129,255],[0,0,131,255],[0,0,133,255],[0,0,135,255],[0,0,137,255],[0,0,139,255],[0,0,141,255],[0,0,143,255],[0,0,145,255],[0,0,147,255],[0,0,149,255],[0,0,151,255],[0,0,153,255],[0,0,155,255],[0,0,157,255],[0,0,159,255],[0,0,161,255],[0,0,163,255],[0,0,165,255],[0,0,167,255],[3,0,169,255],[6,0,171,255],[9,0,173,255],[12,0,175,255],[15,0,177,255],[18,0,179,255],[21,0,181,255],[24,0,183,255],[26,0,184,255],[29,0,186,255],[32,0,188,255],[35,0,190,255],[38,0,192,255],[41,0,194,255],[44,0,196,255],[47,0,198,255],[50,0,200,255],[52,0,197,255],[55,0,194,255],[57,0,191,255],[59,0,188,255],[62,0,185,255],[64,0,182,255],[66,0,179,255],[69,0,176,255],[71,0,174,255],[74,0,171,255],[76,0,168,255],[78,0,165,255],[81,0,162,255],[83,0,159,255],[85,0,156,255],[88,0,153,255],[90,0,150,255],[93,2,144,255],[96,4,138,255],[99,6,132,255],[102,8,126,255],[105,9,121,255],[108,11,115,255],[111,13,109,255],[114,15,103,255],[116,17,97,255],[119,19,91,255],[122,21,85,255],[125,23,79,255],[128,24,74,255],[131,26,68,255],[134,28,62,255],[137,30,56,255],[140,32,50,255],[143,34,47,255],[146,36,44,255],[149,38,41,255],[152,40,38,255],[155,41,35,255],[158,43,32,255],[161,45,29,255],[164,47,26,255],[166,49,24,255],[169,51,21,255],[172,53,18,255],[175,55,15,255],[178,56,12,255],[181,58,9,255],[184,60,6,255],[187,62,3,255],[190,64,0,255],[194,66,0,255],[198,68,0,255],[201,70,0,255],[205,72,0,255],[209,73,0,255],[213,75,0,255],[217,77,0,255],[221,79,0,255],[224,81,0,255],[228,83,0,255],[232,85,0,255],[236,87,0,255],[240,88,0,255],[244,90,0,255],[247,92,0,255],[251,94,0,255],[255,96,0,255],[255,98,3,255],[255,100,6,255],[255,102,9,255],[255,104,12,255],[255,105,15,255],[255,107,18,255],[255,109,21,255],[255,111,24,255],[255,113,26,255],[255,115,29,255],[255,117,32,255],[255,119,35,255],[255,120,38,255],[255,122,41,255],[255,124,44,255],[255,126,47,255],[255,128,50,255],[255,130,53,255],[255,132,56,255],[255,134,59,255],[255,136,62,255],[255,137,65,255],[255,139,68,255],[255,141,71,255],[255,143,74,255],[255,145,76,255],[255,147,79,255],[255,149,82,255],[255,151,85,255],[255,152,88,255],[255,154,91,255],[255,156,94,255],[255,158,97,255],[255,160,100,255],[255,162,103,255],[255,164,106,255],[255,166,109,255],[255,168,112,255],[255,169,115,255],[255,171,118,255],[255,173,121,255],[255,175,124,255],[255,177,126,255],[255,179,129,255],[255,181,132,255],[255,183,135,255],[255,184,138,255],[255,186,141,255],[255,188,144,255],[255,190,147,255],[255,192,150,255],[255,194,153,255],[255,196,156,255],[255,198,159,255],[255,200,162,255],[255,201,165,255],[255,203,168,255],[255,205,171,255],[255,207,174,255],[255,209,176,255],[255,211,179,255],[255,213,182,255],[255,215,185,255],[255,216,188,255],[255,218,191,255],[255,220,194,255],[255,222,197,255],[255,224,200,255],[255,226,203,255],[255,228,206,255],[255,229,210,255],[255,231,213,255],[255,233,216,255],[255,235,219,255],[255,237,223,255],[255,239,226,255],[255,240,229,255],[255,242,232,255],[255,244,236,255],[255,246,239,255],[255,248,242,255],[255,250,245,255],[255,251,249,255],[255,253,252,255],[255,255,255,255]]},pet20Step:{name:"PET 20 Step",numColors:256,colors:[[0,0,0,255],[0,0,0,255],[0,0,0,255],[0,0,0,255],[0,0,0,255],[0,0,0,255],[0,0,0,255],[0,0,0,255],[0,0,0,255],[0,0,0,255],[0,0,0,255],[0,0,0,255],[0,0,0,255],[96,0,80,255],[96,0,80,255],[96,0,80,255],[96,0,80,255],[96,0,80,255],[96,0,80,255],[96,0,80,255],[96,0,80,255],[96,0,80,255],[96,0,80,255],[96,0,80,255],[96,0,80,255],[96,0,80,255],[48,48,80,255],[48,48,80,255],[48,48,80,255],[48,48,80,255],[48,48,80,255],[48,48,80,255],[48,48,80,255],[48,48,80,255],[48,48,80,255],[48,48,80,255],[48,48,80,255],[48,48,80,255],[48,48,80,255],[48,48,112,255],[48,48,112,255],[48,48,112,255],[48,48,112,255],[48,48,112,255],[48,48,112,255],[48,48,112,255],[48,48,112,255],[48,48,112,255],[48,48,112,255],[48,48,112,255],[48,48,112,255],[80,80,128,255],[80,80,128,255],[80,80,128,255],[80,80,128,255],[80,80,128,255],[80,80,128,255],[80,80,128,255],[80,80,128,255],[80,80,128,255],[80,80,128,255],[80,80,128,255],[80,80,128,255],[80,80,128,255],[96,96,176,255],[96,96,176,255],[96,96,176,255],[96,96,176,255],[96,96,176,255],[96,96,176,255],[96,96,176,255],[96,96,176,255],[96,96,176,255],[96,96,176,255],[96,96,176,255],[96,96,176,255],[96,96,176,255],[112,112,192,255],[112,112,192,255],[112,112,192,255],[112,112,192,255],[112,112,192,255],[112,112,192,255],[112,112,192,255],[112,112,192,255],[112,112,192,255],[112,112,192,255],[112,112,192,255],[112,112,192,255],[112,112,192,255],[128,128,224,255],[128,128,224,255],[128,128,224,255],[128,128,224,255],[128,128,224,255],[128,128,224,255],[128,128,224,255],[128,128,224,255],[128,128,224,255],[128,128,224,255],[128,128,224,255],[128,128,224,255],[48,96,48,255],[48,96,48,255],[48,96,48,255],[48,96,48,255],[48,96,48,255],[48,96,48,255],[48,96,48,255],[48,96,48,255],[48,96,48,255],[48,96,48,255],[48,96,48,255],[48,96,48,255],[48,96,48,255],[48,144,48,255],[48,144,48,255],[48,144,48,255],[48,144,48,255],[48,144,48,255],[48,144,48,255],[48,144,48,255],[48,144,48,255],[48,144,48,255],[48,144,48,255],[48,144,48,255],[48,144,48,255],[48,144,48,255],[80,192,80,255],[80,192,80,255],[80,192,80,255],[80,192,80,255],[80,192,80,255],[80,192,80,255],[80,192,80,255],[80,192,80,255],[80,192,80,255],[80,192,80,255],[80,192,80,255],[80,192,80,255],[80,192,80,255],[64,224,64,255],[64,224,64,255],[64,224,64,255],[64,224,64,255],[64,224,64,255],[64,224,64,255],[64,224,64,255],[64,224,64,255],[64,224,64,255],[64,224,64,255],[64,224,64,255],[64,224,64,255],[224,224,80,255],[224,224,80,255],[224,224,80,255],[224,224,80,255],[224,224,80,255],[224,224,80,255],[224,224,80,255],[224,224,80,255],[224,224,80,255],[224,224,80,255],[224,224,80,255],[224,224,80,255],[224,224,80,255],[208,208,96,255],[208,208,96,255],[208,208,96,255],[208,208,96,255],[208,208,96,255],[208,208,96,255],[208,208,96,255],[208,208,96,255],[208,208,96,255],[208,208,96,255],[208,208,96,255],[208,208,96,255],[208,208,96,255],[208,176,64,255],[208,176,64,255],[208,176,64,255],[208,176,64,255],[208,176,64,255],[208,176,64,255],[208,176,64,255],[208,176,64,255],[208,176,64,255],[208,176,64,255],[208,176,64,255],[208,176,64,255],[208,176,64,255],[208,144,0,255],[208,144,0,255],[208,144,0,255],[208,144,0,255],[208,144,0,255],[208,144,0,255],[208,144,0,255],[208,144,0,255],[208,144,0,255],[208,144,0,255],[208,144,0,255],[208,144,0,255],[192,96,0,255],[192,96,0,255],[192,96,0,255],[192,96,0,255],[192,96,0,255],[192,96,0,255],[192,96,0,255],[192,96,0,255],[192,96,0,255],[192,96,0,255],[192,96,0,255],[192,96,0,255],[192,96,0,255],[176,48,0,255],[176,48,0,255],[176,48,0,255],[176,48,0,255],[176,48,0,255],[176,48,0,255],[176,48,0,255],[176,48,0,255],[176,48,0,255],[176,48,0,255],[176,48,0,255],[176,48,0,255],[176,48,0,255],[255,0,0,255],[255,0,0,255],[255,0,0,255],[255,0,0,255],[255,0,0,255],[255,0,0,255],[255,0,0,255],[255,0,0,255],[255,0,0,255],[255,0,0,255],[255,0,0,255],[255,0,0,255],[255,0,0,255],[255,255,255,255],[255,255,255,255],[255,255,255,255],[255,255,255,255],[255,255,255,255],[255,255,255,255],[255,255,255,255],[255,255,255,255],[255,255,255,255],[255,255,255,255],[255,255,255,255],[255,255,255,255],[255,255,255,255]]},gray:{name:"Gray",numColors:256,gamma:1,segmentedData:{red:[[0,0,0],[1,1,1]],green:[[0,0,0],[1,1,1]],blue:[[0,0,0],[1,1,1]]}},jet:{name:"Jet",numColors:256,gamma:1,segmentedData:{red:[[0,0,0],[.35,0,0],[.66,1,1],[.89,1,1],[1,.5,.5]],green:[[0,0,0],[.125,0,0],[.375,1,1],[.64,1,1],[.91,0,0],[1,0,0]],blue:[[0,.5,.5],[.11,1,1],[.34,1,1],[.65,0,0],[1,0,0]]}},hsv:{name:"HSV",numColors:256,gamma:1,segmentedData:{red:[[0,1,1],[.15873,1,1],[.174603,.96875,.96875],[.333333,.03125,.03125],[.349206,0,0],[.666667,0,0],[.68254,.03125,.03125],[.84127,.96875,.96875],[.857143,1,1],[1,1,1]],green:[[0,0,0],[.15873,.9375,.9375],[.174603,1,1],[.507937,1,1],[.666667,.0625,.0625],[.68254,0,0],[1,0,0]],blue:[[0,0,0],[.333333,0,0],[.349206,.0625,.0625],[.507937,1,1],[.84127,1,1],[.857143,.9375,.9375],[1,.09375,.09375]]}},hot:{name:"Hot",numColors:256,gamma:1,segmentedData:{red:[[0,.0416,.0416],[.365079,1,1],[1,1,1]],green:[[0,0,0],[.365079,0,0],[.746032,1,1],[1,1,1]],blue:[[0,0,0],[.746032,0,0],[1,1,1]]}},cool:{name:"Cool",numColors:256,gamma:1,segmentedData:{red:[[0,0,0],[1,1,1]],green:[[0,1,1],[1,0,0]],blue:[[0,1,1],[1,1,1]]}},spring:{name:"Spring",numColors:256,gamma:1,segmentedData:{red:[[0,1,1],[1,1,1]],green:[[0,0,0],[1,1,1]],blue:[[0,1,1],[1,0,0]]}},summer:{name:"Summer",numColors:256,gamma:1,segmentedData:{red:[[0,0,0],[1,1,1]],green:[[0,.5,.5],[1,1,1]],blue:[[0,.4,.4],[1,.4,.4]]}},autumn:{name:"Autumn",numColors:256,gamma:1,segmentedData:{red:[[0,1,1],[1,1,1]],green:[[0,0,0],[1,1,1]],blue:[[0,0,0],[1,0,0]]}},winter:{name:"Winter",numColors:256,gamma:1,segmentedData:{red:[[0,0,0],[1,0,0]],green:[[0,0,0],[1,1,1]],blue:[[0,1,1],[1,.5,.5]]}},bone:{name:"Bone",numColors:256,gamma:1,segmentedData:{red:[[0,0,0],[.746032,.652778,.652778],[1,1,1]],green:[[0,0,0],[.365079,.319444,.319444],[.746032,.777778,.777778],[1,1,1]],blue:[[0,0,0],[.365079,.444444,.444444],[1,1,1]]}},copper:{name:"Copper",numColors:256,gamma:1,segmentedData:{red:[[0,0,0],[.809524,1,1],[1,1,1]],green:[[0,0,0],[1,.7812,.7812]],blue:[[0,0,0],[1,.4975,.4975]]}},spectral:{name:"Spectral",numColors:256,gamma:1,segmentedData:{red:[[0,0,0],[.05,.4667,.4667],[.1,.5333,.5333],[.15,0,0],[.2,0,0],[.25,0,0],[.3,0,0],[.35,0,0],[.4,0,0],[.45,0,0],[.5,0,0],[.55,0,0],[.6,0,0],[.65,.7333,.7333],[.7,.9333,.9333],[.75,1,1],[.8,1,1],[.85,1,1],[.9,.8667,.8667],[.95,.8,.8],[1,.8,.8]],green:[[0,0,0],[.05,0,0],[.1,0,0],[.15,0,0],[.2,0,0],[.25,.4667,.4667],[.3,.6,.6],[.35,.6667,.6667],[.4,.6667,.6667],[.45,.6,.6],[.5,.7333,.7333],[.55,.8667,.8667],[.6,1,1],[.65,1,1],[.7,.9333,.9333],[.75,.8,.8],[.8,.6,.6],[.85,0,0],[.9,0,0],[.95,0,0],[1,.8,.8]],blue:[[0,0,0],[.05,.5333,.5333],[.1,.6,.6],[.15,.6667,.6667],[.2,.8667,.8667],[.25,.8667,.8667],[.3,.8667,.8667],[.35,.6667,.6667],[.4,.5333,.5333],[.45,0,0],[.5,0,0],[.55,0,0],[.6,0,0],[.65,0,0],[.7,0,0],[.75,0,0],[.8,0,0],[.85,0,0],[.9,0,0],[.95,0,0],[1,.8,.8]]}},coolwarm:{name:"CoolWarm",numColors:256,gamma:1,segmentedData:{red:[[0,.2298057,.2298057],[.03125,.26623388,.26623388],[.0625,.30386891,.30386891],[.09375,.342804478,.342804478],[.125,.38301334,.38301334],[.15625,.424369608,.424369608],[.1875,.46666708,.46666708],[.21875,.509635204,.509635204],[.25,.552953156,.552953156],[.28125,.596262162,.596262162],[.3125,.639176211,.639176211],[.34375,.681291281,.681291281],[.375,.722193294,.722193294],[.40625,.761464949,.761464949],[.4375,.798691636,.798691636],[.46875,.833466556,.833466556],[.5,.865395197,.865395197],[.53125,.897787179,.897787179],[.5625,.924127593,.924127593],[.59375,.944468518,.944468518],[.625,.958852946,.958852946],[.65625,.96732803,.96732803],[.6875,.969954137,.969954137],[.71875,.966811177,.966811177],[.75,.958003065,.958003065],[.78125,.943660866,.943660866],[.8125,.923944917,.923944917],[.84375,.89904617,.89904617],[.875,.869186849,.869186849],[.90625,.834620542,.834620542],[.9375,.795631745,.795631745],[.96875,.752534934,.752534934],[1,.705673158,.705673158]],green:[[0,.298717966,.298717966],[.03125,.353094838,.353094838],[.0625,.406535296,.406535296],[.09375,.458757618,.458757618],[.125,.50941904,.50941904],[.15625,.558148092,.558148092],[.1875,.604562568,.604562568],[.21875,.648280772,.648280772],[.25,.688929332,.688929332],[.28125,.726149107,.726149107],[.3125,.759599947,.759599947],[.34375,.788964712,.788964712],[.375,.813952739,.813952739],[.40625,.834302879,.834302879],[.4375,.849786142,.849786142],[.46875,.860207984,.860207984],[.5,.86541021,.86541021],[.53125,.848937047,.848937047],[.5625,.827384882,.827384882],[.59375,.800927443,.800927443],[.625,.769767752,.769767752],[.65625,.734132809,.734132809],[.6875,.694266682,.694266682],[.71875,.650421156,.650421156],[.75,.602842431,.602842431],[.78125,.551750968,.551750968],[.8125,.49730856,.49730856],[.84375,.439559467,.439559467],[.875,.378313092,.378313092],[.90625,.312874446,.312874446],[.9375,.24128379,.24128379],[.96875,.157246067,.157246067],[1,.01555616,.01555616]],blue:[[0,.753683153,.753683153],[.03125,.801466763,.801466763],[.0625,.84495867,.84495867],[.09375,.883725899,.883725899],[.125,.917387822,.917387822],[.15625,.945619588,.945619588],[.1875,.968154911,.968154911],[.21875,.98478814,.98478814],[.25,.995375608,.995375608],[.28125,.999836203,.999836203],[.3125,.998151185,.998151185],[.34375,.990363227,.990363227],[.375,.976574709,.976574709],[.40625,.956945269,.956945269],[.4375,.931688648,.931688648],[.46875,.901068838,.901068838],[.5,.865395561,.865395561],[.53125,.820880546,.820880546],[.5625,.774508472,.774508472],[.59375,.726736146,.726736146],[.625,.678007945,.678007945],[.65625,.628751763,.628751763],[.6875,.579375448,.579375448],[.71875,.530263762,.530263762],[.75,.481775914,.481775914],[.78125,.434243684,.434243684],[.8125,.387970225,.387970225],[.84375,.343229596,.343229596],[.875,.300267182,.300267182],[.90625,.259301199,.259301199],[.9375,.220525627,.220525627],[.96875,.184115123,.184115123],[1,.150232812,.150232812]]}},blues:{name:"Blues",numColors:256,gamma:1,segmentedData:{red:[[0,.9686274528503418,.9686274528503418],[.125,.8705882430076599,.8705882430076599],[.25,.7764706015586853,.7764706015586853],[.375,.6196078658103943,.6196078658103943],[.5,.41960784792900085,.41960784792900085],[.625,.25882354378700256,.25882354378700256],[.75,.12941177189350128,.12941177189350128],[.875,.0313725508749485,.0313725508749485],[1,.0313725508749485,.0313725508749485]],green:[[0,.9843137264251709,.9843137264251709],[.125,.9215686321258545,.9215686321258545],[.25,.8588235378265381,.8588235378265381],[.375,.7921568751335144,.7921568751335144],[.5,.6823529601097107,.6823529601097107],[.625,.572549045085907,.572549045085907],[.75,.4431372582912445,.4431372582912445],[.875,.3176470696926117,.3176470696926117],[1,.1882352977991104,.1882352977991104]],blue:[[0,1,1],[.125,.9686274528503418,.9686274528503418],[.25,.9372549057006836,.9372549057006836],[.375,.8823529481887817,.8823529481887817],[.5,.8392156958580017,.8392156958580017],[.625,.7764706015586853,.7764706015586853],[.75,.7098039388656616,.7098039388656616],[.875,.6117647290229797,.6117647290229797],[1,.41960784792900085,.41960784792900085]]}}},mn={MINIMUM_SLAB_THICKNESS:.05,MAXIMUM_RAY_DISTANCE:1e6};Object.freeze(mn);const mo=.001;function Fx(t){const e=Object.getOwnPropertyNames(t);for(const n of e){const r=t[n];r&&typeof r=="object"&&Fx(r)}return Object.freeze(t)}const CP={axial:{viewPlaneNormal:[0,0,-1],viewUp:[0,-1,0],viewRight:[1,0,0]},sagittal:{viewPlaneNormal:[1,0,0],viewUp:[0,0,1],viewRight:[0,1,0]},coronal:{viewPlaneNormal:[0,-1,0],viewUp:[0,0,1],viewRight:[1,0,0]}},sc=Fx(CP),Ux=[{name:"CT-AAA",gradientOpacity:"4 0 1 255 1",specularPower:"10",scalarOpacity:"12 -3024 0 143.556 0 166.222 0.686275 214.389 0.696078 419.736 0.833333 3071 0.803922",specular:"0.2",shade:"1",ambient:"0.1",colorTransfer:"24 -3024 0 0 0 143.556 0.615686 0.356863 0.184314 166.222 0.882353 0.603922 0.290196 214.389 1 1 1 419.736 1 0.937033 0.954531 3071 0.827451 0.658824 1",diffuse:"0.9",interpolation:"1"},{name:"CT-AAA2",gradientOpacity:"4 0 1 255 1",specularPower:"10",scalarOpacity:"16 -3024 0 129.542 0 145.244 0.166667 157.02 0.5 169.918 0.627451 395.575 0.8125 1578.73 0.8125 3071 0.8125",specular:"0.2",shade:"1",ambient:"0.1",colorTransfer:"32 -3024 0 0 0 129.542 0.54902 0.25098 0.14902 145.244 0.6 0.627451 0.843137 157.02 0.890196 0.47451 0.6 169.918 0.992157 0.870588 0.392157 395.575 1 0.886275 0.658824 1578.73 1 0.829256 0.957922 3071 0.827451 0.658824 1",diffuse:"0.9",interpolation:"1"},{name:"CT-Bone",gradientOpacity:"4 0 1 255 1",specularPower:"10",scalarOpacity:"8 -3024 0 -16.4458 0 641.385 0.715686 3071 0.705882",specular:"0.2",shade:"1",ambient:"0.1",colorTransfer:"16 -3024 0 0 0 -16.4458 0.729412 0.254902 0.301961 641.385 0.905882 0.815686 0.552941 3071 1 1 1",diffuse:"0.9",interpolation:"1"},{name:"CT-Bones",gradientOpacity:"4 0 1 985.12 1",specularPower:"1",scalarOpacity:"8 -1000 0 152.19 0 278.93 0.190476 952 0.2",specular:"0",shade:"1",ambient:"0.2",colorTransfer:"20 -1000 0.3 0.3 1 -488 0.3 1 0.3 463.28 1 0 0 659.15 1 0.912535 0.0374849 953 1 0.3 0.3",diffuse:"1",interpolation:"1"},{name:"CT-Cardiac",gradientOpacity:"4 0 1 255 1",specularPower:"10",scalarOpacity:"12 -3024 0 -77.6875 0 94.9518 0.285714 179.052 0.553571 260.439 0.848214 3071 0.875",specular:"0.2",shade:"1",ambient:"0.1",colorTransfer:"24 -3024 0 0 0 -77.6875 0.54902 0.25098 0.14902 94.9518 0.882353 0.603922 0.290196 179.052 1 0.937033 0.954531 260.439 0.615686 0 0 3071 0.827451 0.658824 1",diffuse:"0.9",interpolation:"1"},{name:"CT-Cardiac2",gradientOpacity:"4 0 1 255 1",specularPower:"10",scalarOpacity:"12 -3024 0 42.8964 0 163.488 0.428571 277.642 0.776786 1587 0.754902 3071 0.754902",specular:"0.2",shade:"1",ambient:"0.1",colorTransfer:"24 -3024 0 0 0 42.8964 0.54902 0.25098 0.14902 163.488 0.917647 0.639216 0.0588235 277.642 1 0.878431 0.623529 1587 1 1 1 3071 0.827451 0.658824 1",diffuse:"0.9",interpolation:"1"},{name:"CT-Cardiac3",gradientOpacity:"4 0 1 255 1",specularPower:"10",scalarOpacity:"14 -3024 0 -86.9767 0 45.3791 0.169643 139.919 0.589286 347.907 0.607143 1224.16 0.607143 3071 0.616071",specular:"0.2",shade:"1",ambient:"0.1",colorTransfer:"28 -3024 0 0 0 -86.9767 0 0.25098 1 45.3791 1 0 0 139.919 1 0.894893 0.894893 347.907 1 1 0.25098 1224.16 1 1 1 3071 0.827451 0.658824 1",diffuse:"0.9",interpolation:"1"},{name:"CT-Chest-Contrast-Enhanced",gradientOpacity:"4 0 1 255 1",specularPower:"10",scalarOpacity:"10 -3024 0 67.0106 0 251.105 0.446429 439.291 0.625 3071 0.616071",specular:"0.2",shade:"1",ambient:"0.1",colorTransfer:"20 -3024 0 0 0 67.0106 0.54902 0.25098 0.14902 251.105 0.882353 0.603922 0.290196 439.291 1 0.937033 0.954531 3071 0.827451 0.658824 1",diffuse:"0.9",interpolation:"1"},{name:"CT-Chest-Vessels",gradientOpacity:"4 0 1 255 1",specularPower:"1",scalarOpacity:"10 -3024 0 -1278.35 0 22.8277 0.428571 439.291 0.625 3071 0.616071",specular:"0",shade:"1",ambient:"0.2",colorTransfer:"20 -3024 0 0 0 -1278.35 0.54902 0.25098 0.14902 22.8277 0.882353 0.603922 0.290196 439.291 1 0.937033 0.954531 3071 0.827451 0.658824 1",diffuse:"1",interpolation:"1"},{name:"CT-Coronary-Arteries",gradientOpacity:"4 0 1 255 1",specularPower:"1",scalarOpacity:"12 -2048 0 136.47 0 159.215 0.258929 318.43 0.571429 478.693 0.776786 3661 1",specular:"0",shade:"0",ambient:"0.2",colorTransfer:"24 -2048 0 0 0 136.47 0 0 0 159.215 0.159804 0.159804 0.159804 318.43 0.764706 0.764706 0.764706 478.693 1 1 1 3661 1 1 1",diffuse:"1",interpolation:"1"},{name:"CT-Coronary-Arteries-2",gradientOpacity:"4 0 1 255 1",specularPower:"1",scalarOpacity:"14 -2048 0 142.677 0 145.016 0.116071 192.174 0.5625 217.24 0.776786 384.347 0.830357 3661 0.830357",specular:"0",shade:"1",ambient:"0.2",colorTransfer:"28 -2048 0 0 0 142.677 0 0 0 145.016 0.615686 0 0.0156863 192.174 0.909804 0.454902 0 217.24 0.972549 0.807843 0.611765 384.347 0.909804 0.909804 1 3661 1 1 1",diffuse:"1",interpolation:"1"},{name:"CT-Coronary-Arteries-3",gradientOpacity:"4 0 1 255 1",specularPower:"10",scalarOpacity:"14 -2048 0 128.643 0 129.982 0.0982143 173.636 0.669643 255.884 0.857143 584.878 0.866071 3661 1",specular:"0.2",shade:"1",ambient:"0.1",colorTransfer:"28 -2048 0 0 0 128.643 0 0 0 129.982 0.615686 0 0.0156863 173.636 0.909804 0.454902 0 255.884 0.886275 0.886275 0.886275 584.878 0.968627 0.968627 0.968627 3661 1 1 1",diffuse:"0.9",interpolation:"1"},{name:"CT-Cropped-Volume-Bone",gradientOpacity:"4 0 1 255 1",specularPower:"1",scalarOpacity:"10 -2048 0 -451 0 -450 1 1050 1 3661 1",specular:"0",shade:"0",ambient:"0.2",colorTransfer:"20 -2048 0 0 0 -451 0 0 0 -450 0.0556356 0.0556356 0.0556356 1050 1 1 1 3661 1 1 1",diffuse:"1",interpolation:"1"},{name:"CT-Fat",gradientOpacity:"6 0 1 985.12 1 988 1",specularPower:"1",scalarOpacity:"14 -1000 0 -100 0 -99 0.15 -60 0.15 -59 0 101.2 0 952 0",specular:"0",shade:"0",ambient:"0.2",colorTransfer:"36 -1000 0.3 0.3 1 -497.5 0.3 1 0.3 -99 0 0 1 -76.946 0 1 0 -65.481 0.835431 0.888889 0.0165387 83.89 1 0 0 463.28 1 0 0 659.15 1 0.912535 0.0374849 2952 1 0.300267 0.299886",diffuse:"1",interpolation:"1"},{name:"CT-Liver-Vasculature",gradientOpacity:"4 0 1 255 1",specularPower:"1",scalarOpacity:"14 -2048 0 149.113 0 157.884 0.482143 339.96 0.660714 388.526 0.830357 1197.95 0.839286 3661 0.848214",specular:"0",shade:"0",ambient:"0.2",colorTransfer:"28 -2048 0 0 0 149.113 0 0 0 157.884 0.501961 0.25098 0 339.96 0.695386 0.59603 0.36886 388.526 0.854902 0.85098 0.827451 1197.95 1 1 1 3661 1 1 1",diffuse:"1",interpolation:"1"},{name:"CT-Lung",gradientOpacity:"6 0 1 985.12 1 988 1",specularPower:"1",scalarOpacity:"12 -1000 0 -600 0 -599 0.15 -400 0.15 -399 0 2952 0",specular:"0",shade:"1",ambient:"0.2",colorTransfer:"24 -1000 0.3 0.3 1 -600 0 0 1 -530 0.134704 0.781726 0.0724558 -460 0.929244 1 0.109473 -400 0.888889 0.254949 0.0240258 2952 1 0.3 0.3",diffuse:"1",interpolation:"1"},{name:"CT-MIP",gradientOpacity:"4 0 1 255 1",specularPower:"10",scalarOpacity:"8 -3024 0 -637.62 0 700 1 3071 1",specular:"0.2",shade:"1",ambient:"0.1",colorTransfer:"16 -3024 0 0 0 -637.62 1 1 1 700 1 1 1 3071 1 1 1",diffuse:"0.9",interpolation:"1"},{name:"CT-Muscle",gradientOpacity:"4 0 1 255 1",specularPower:"10",scalarOpacity:"10 -3024 0 -155.407 0 217.641 0.676471 419.736 0.833333 3071 0.803922",specular:"0.2",shade:"1",ambient:"0.1",colorTransfer:"20 -3024 0 0 0 -155.407 0.54902 0.25098 0.14902 217.641 0.882353 0.603922 0.290196 419.736 1 0.937033 0.954531 3071 0.827451 0.658824 1",diffuse:"0.9",interpolation:"1"},{name:"CT-Pulmonary-Arteries",gradientOpacity:"4 0 1 255 1",specularPower:"1",scalarOpacity:"14 -2048 0 -568.625 0 -364.081 0.0714286 -244.813 0.401786 18.2775 0.607143 447.798 0.830357 3592.73 0.839286",specular:"0",shade:"1",ambient:"0.2",colorTransfer:"28 -2048 0 0 0 -568.625 0 0 0 -364.081 0.396078 0.301961 0.180392 -244.813 0.611765 0.352941 0.0705882 18.2775 0.843137 0.0156863 0.156863 447.798 0.752941 0.752941 0.752941 3592.73 1 1 1",diffuse:"1",interpolation:"1"},{name:"CT-Soft-Tissue",gradientOpacity:"4 0 1 255 1",specularPower:"1",scalarOpacity:"10 -2048 0 -167.01 0 -160 1 240 1 3661 1",specular:"0",shade:"0",ambient:"0.2",colorTransfer:"20 -2048 0 0 0 -167.01 0 0 0 -160 0.0556356 0.0556356 0.0556356 240 1 1 1 3661 1 1 1",diffuse:"1",interpolation:"1"},{name:"CT-Air",gradientOpacity:"4 0 1 255 1",specularPower:"10",scalarOpacity:"8 -3024 0.705882 -900.0 0.715686 -500.0 0 3071 0",specular:"0.2",shade:"1",ambient:"0.1",colorTransfer:"16 -3024 1 1 1 -900.0 0.2 1.0 1.0 -500.0 0.3 0.3 1.0 3071 0 0 0 ",diffuse:"0.9",interpolation:"1"},{name:"MR-Angio",gradientOpacity:"4 0 1 255 1",specularPower:"1",scalarOpacity:"12 -2048 0 151.354 0 158.279 0.4375 190.112 0.580357 200.873 0.732143 3661 0.741071",specular:"0",shade:"1",ambient:"0.2",colorTransfer:"24 -2048 0 0 0 151.354 0 0 0 158.279 0.74902 0.376471 0 190.112 1 0.866667 0.733333 200.873 0.937255 0.937255 0.937255 3661 1 1 1",diffuse:"1",interpolation:"1"},{name:"MR-Default",gradientOpacity:"4 0 1 255 1",specularPower:"1",scalarOpacity:"12 0 0 20 0 40 0.15 120 0.3 220 0.375 1024 0.5",specular:"0",shade:"1",ambient:"0.2",colorTransfer:"24 0 0 0 0 20 0.168627 0 0 40 0.403922 0.145098 0.0784314 120 0.780392 0.607843 0.380392 220 0.847059 0.835294 0.788235 1024 1 1 1",diffuse:"1",interpolation:"1"},{name:"MR-MIP",gradientOpacity:"4 0 1 255 1",specularPower:"1",scalarOpacity:"8 0 0 98.3725 0 416.637 1 2800 1",specular:"0",shade:"0",ambient:"0.2",colorTransfer:"16 0 1 1 1 98.3725 1 1 1 416.637 1 1 1 2800 1 1 1",diffuse:"1",interpolation:"1"},{name:"MR-T2-Brain",gradientOpacity:"4 0 1 160.25 1",specularPower:"40",scalarOpacity:"10 0 0 36.05 0 218.302 0.171429 412.406 1 641 1",specular:"0.5",shade:"1",ambient:"0.3",colorTransfer:"16 0 0 0 0 98.7223 0.956863 0.839216 0.192157 412.406 0 0.592157 0.807843 641 1 1 1",diffuse:"0.6",interpolation:"1"},{name:"DTI-FA-Brain",gradientOpacity:"4 0 1 0.9950 1",specularPower:"40",scalarOpacity:"16 0 0 0 0 0.3501 0.0158 0.49379 0.7619 0.6419 1 0.9920 1 0.9950 0 0.9950 0",specular:"0.5",shade:"1",ambient:"0.3",colorTransfer:"28 0 1 0 0 0 1 0 0 0.24974 0.4941 1 0 0.49949 0 0.9882 1 0.7492 0.51764 0 1 0.9950 1 0 0 0.9950 1 0 0",diffuse:"0.9",interpolation:"1"}],wP={slicer3D:[160/255,164/255,217/255]},Bx=Object.freeze(Object.defineProperty({__proto__:null,BACKGROUND_COLORS:wP,CPU_COLORMAPS:T3,EPSILON:mo,MPR_CAMERA_VALUES:sc,RENDERING_DEFAULTS:mn,VIEWPORT_PRESETS:Ux},Symbol.toStringTag,{value:"Module"})),vf={},Ag={get:t=>vf[t],set:t=>{const e=t.id;vf[e]=t},delete:t=>delete vf[t],getAll:()=>{const e=Object.keys(vf).map(n=>vf[n]);return e.sort((n,r)=>n.id[0]==="_"&&r.id[0]!=="_"?1:n.id[0]!=="_"&&r.id[0]==="_"?-1:0),e}};class xP{constructor(){this.listeners={},this.debouncedListeners={}}reset(){this.listeners={},this.debouncedListeners={}}addEventListenerOnce(e,n){const r=i=>{this.removeEventListener(e,r),n.call(this,i)};this.addEventListener(e,r)}addEventListener(e,n){this.listeners[e]||(this.listeners[e]=[]),this.listeners[e].indexOf(n)===-1&&this.listeners[e].push(n)}addEventListenerDebounced(e,n,r){this.debouncedListeners[e]=this.debouncedListeners[e]||{};const i=this.debouncedListeners[e];if(!i[n]){const a=o=>{i[n]&&clearTimeout(i[n].timeoutId),i[n].timeoutId=setTimeout(()=>{n.call(this,o)},r)};i[n]={original:n,handle:a,timeoutId:null},this.addEventListener(e,a)}}removeEventListenerDebounced(e,n){var r;if((r=this.debouncedListeners[e])!=null&&r[n]){const i=this.debouncedListeners[e][n];this.removeEventListener(e,i.handle),clearTimeout(i.timeoutId),delete this.debouncedListeners[e][n]}}removeEventListener(e,n){if(!this.listeners[e])return;const r=this.listeners[e],i=r.length;for(let a=0;a<i;a++)if(r[a]===n){r.splice(a,1);return}}dispatchEvent(e){if(!this.listeners[e.type])return!e.defaultPrevented;const n=this.listeners[e.type].slice(),r=n.length;for(let i=0;i<r;i++)try{n[i].call(this,e)}catch(a){console.error(`error in event listener of type:  ${e.type}`,a)}return!e.defaultPrevented}}const Ee=new xP;function In(){return typeof crypto.randomUUID=="function"?crypto.randomUUID():("10000000-1000-4000-8000"+-1e11).replace(/[018]/g,t=>(t^crypto.getRandomValues(new Uint8Array(1))[0]&15>>t/4).toString(16))}function De(t=Ee,e,n=null){if(!e)throw new Error("Event type was not defined");const r=new CustomEvent(e,{detail:n,cancelable:!0});return t==null?void 0:t.dispatchEvent(r)}var SP=function t(e,n){if(e===n)return!0;if(e&&n&&typeof e=="object"&&typeof n=="object"){if(e.constructor!==n.constructor)return!1;var r,i,a;if(Array.isArray(e)){if(r=e.length,r!=n.length)return!1;for(i=r;i--!==0;)if(!t(e[i],n[i]))return!1;return!0}if(e.constructor===RegExp)return e.source===n.source&&e.flags===n.flags;if(e.valueOf!==Object.prototype.valueOf)return e.valueOf()===n.valueOf();if(e.toString!==Object.prototype.toString)return e.toString()===n.toString();if(a=Object.keys(e),r=a.length,r!==Object.keys(n).length)return!1;for(i=r;i--!==0;)if(!Object.prototype.hasOwnProperty.call(n,a[i]))return!1;for(i=r;i--!==0;){var o=a[i];if(!t(e[o],n[o]))return!1}return!0}return e!==e&&n!==n};const Gx=Eo(SP);var K6=Object.prototype.toString,$x=function(e){var n=K6.call(e),r=n==="[object Arguments]";return r||(r=n!=="[object Array]"&&e!==null&&typeof e=="object"&&typeof e.length=="number"&&e.length>=0&&K6.call(e.callee)==="[object Function]"),r},E5,q6;function EP(){if(q6)return E5;q6=1;var t;if(!Object.keys){var e=Object.prototype.hasOwnProperty,n=Object.prototype.toString,r=$x,i=Object.prototype.propertyIsEnumerable,a=!i.call({toString:null},"toString"),o=i.call(function(){},"prototype"),s=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],c=function(g){var d=g.constructor;return d&&d.prototype===g},l={$applicationCache:!0,$console:!0,$external:!0,$frame:!0,$frameElement:!0,$frames:!0,$innerHeight:!0,$innerWidth:!0,$onmozfullscreenchange:!0,$onmozfullscreenerror:!0,$outerHeight:!0,$outerWidth:!0,$pageXOffset:!0,$pageYOffset:!0,$parent:!0,$scrollLeft:!0,$scrollTop:!0,$scrollX:!0,$scrollY:!0,$self:!0,$webkitIndexedDB:!0,$webkitStorageInfo:!0,$window:!0},f=function(){if(typeof window>"u")return!1;for(var g in window)try{if(!l["$"+g]&&e.call(window,g)&&window[g]!==null&&typeof window[g]=="object")try{c(window[g])}catch{return!0}}catch{return!0}return!1}(),u=function(g){if(typeof window>"u"||!f)return c(g);try{return c(g)}catch{return!1}};t=function(d){var h=d!==null&&typeof d=="object",p=n.call(d)==="[object Function]",m=r(d),v=h&&n.call(d)==="[object String]",y=[];if(!h&&!p&&!m)throw new TypeError("Object.keys called on a non-object");var T=o&&p;if(v&&d.length>0&&!e.call(d,0))for(var C=0;C<d.length;++C)y.push(String(C));if(m&&d.length>0)for(var w=0;w<d.length;++w)y.push(String(w));else for(var x in d)!(T&&x==="prototype")&&e.call(d,x)&&y.push(String(x));if(a)for(var O=u(d),M=0;M<s.length;++M)!(O&&s[M]==="constructor")&&e.call(d,s[M])&&y.push(s[M]);return y}}return E5=t,E5}var OP=Array.prototype.slice,DP=$x,X6=Object.keys,Y1=X6?function(e){return X6(e)}:EP(),Y6=Object.keys;Y1.shim=function(){if(Object.keys){var e=function(){var n=Object.keys(arguments);return n&&n.length===arguments.length}(1,2);e||(Object.keys=function(r){return DP(r)?Y6(OP.call(r)):Y6(r)})}else Object.keys=Y1;return Object.keys||Y1};var RP=Y1,Z1=Object.defineProperty||!1;if(Z1)try{Z1({},"a",{value:1})}catch{Z1=!1}var Wx=Z1,MP=SyntaxError,_P=TypeError,bP=Object.getOwnPropertyDescriptor,Q1=bP;if(Q1)try{Q1([],"length")}catch{Q1=null}var LP=Q1,Z6=Wx,IP=MP,yl=_P,Q6=LP,VP=function(e,n,r){if(!e||typeof e!="object"&&typeof e!="function")throw new yl("`obj` must be an object or a function`");if(typeof n!="string"&&typeof n!="symbol")throw new yl("`property` must be a string or a symbol`");if(arguments.length>3&&typeof arguments[3]!="boolean"&&arguments[3]!==null)throw new yl("`nonEnumerable`, if provided, must be a boolean or null");if(arguments.length>4&&typeof arguments[4]!="boolean"&&arguments[4]!==null)throw new yl("`nonWritable`, if provided, must be a boolean or null");if(arguments.length>5&&typeof arguments[5]!="boolean"&&arguments[5]!==null)throw new yl("`nonConfigurable`, if provided, must be a boolean or null");if(arguments.length>6&&typeof arguments[6]!="boolean")throw new yl("`loose`, if provided, must be a boolean");var i=arguments.length>3?arguments[3]:null,a=arguments.length>4?arguments[4]:null,o=arguments.length>5?arguments[5]:null,s=arguments.length>6?arguments[6]:!1,c=!!Q6&&Q6(e,n);if(Z6)Z6(e,n,{configurable:o===null&&c?c.configurable:!o,enumerable:i===null&&c?c.enumerable:!i,value:r,writable:a===null&&c?c.writable:!a});else if(s||!i&&!a&&!o)e[n]=r;else throw new IP("This environment does not support defining a property as non-configurable, non-writable, or non-enumerable.")},C3=Wx,zx=function(){return!!C3};zx.hasArrayLengthDefineBug=function(){if(!C3)return null;try{return C3([],"length",{value:1}).length!==1}catch{return!0}};var PP=zx,NP=RP,kP=typeof Symbol=="function"&&typeof Symbol("foo")=="symbol",AP=Object.prototype.toString,FP=Array.prototype.concat,J6=VP,UP=function(t){return typeof t=="function"&&AP.call(t)==="[object Function]"},jx=PP(),BP=function(t,e,n,r){if(e in t){if(r===!0){if(t[e]===n)return}else if(!UP(r)||!r())return}jx?J6(t,e,n,!0):J6(t,e,n)},Hx=function(t,e){var n=arguments.length>2?arguments[2]:{},r=NP(e);kP&&(r=FP.call(r,Object.getOwnPropertySymbols(e)));for(var i=0;i<r.length;i+=1)BP(t,r[i],e[r[i]],n[r[i]])};Hx.supportsDescriptors=!!jx;var Kx=Hx,J1={exports:{}};typeof self<"u"?J1.exports=self:typeof window<"u"?J1.exports=window:J1.exports=Function("return this")();var qx=J1.exports,GP=qx,Xx=function(){return typeof Rr!="object"||!Rr||Rr.Math!==Math||Rr.Array!==Array?GP:Rr},$P=Kx,WP=Xx,zP=function(){var e=WP();if($P.supportsDescriptors){var n=Object.getOwnPropertyDescriptor(e,"globalThis");(!n||n.configurable&&(n.enumerable||!n.writable||globalThis!==e))&&Object.defineProperty(e,"globalThis",{configurable:!0,enumerable:!1,value:e,writable:!0})}else(typeof globalThis!="object"||globalThis!==e)&&(e.globalThis=e);return e},jP=Kx,HP=qx,Yx=Xx,KP=zP,qP=Yx(),Zx=function(){return qP};jP(Zx,{getPolyfill:Yx,implementation:HP,shim:KP});var XP=Zx;const YP=Eo(XP),Na=YP(),Qx={vtkObject:()=>null};function Fa(t){if(t==null||t.isA)return t;if(!t.vtkClass)return Na.console&&Na.console.error&&Na.console.error("Invalid VTK object"),null;const e=Qx[t.vtkClass];if(!e)return Na.console&&Na.console.error&&Na.console.error(`No vtk class found for Object of type ${t.vtkClass}`),null;const n={...t};Object.keys(n).forEach(i=>{n[i]&&typeof n[i]=="object"&&n[i].vtkClass&&(n[i]=Fa(n[i]))});const r=e(n);return r&&r.modified&&r.modified(),r}function ZP(t,e){Qx[t]=e}Fa.register=ZP;class O5 extends Array{push(){for(let e=0;e<arguments.length;e++)this.includes(arguments[e])||super.push(arguments[e]);return this.length}}let w3=0;const Jx=Symbol("void");function QP(){return w3}const eS={};function S0(){}const JP=["log","debug","info","warn","error","time","timeEnd","group","groupEnd"];JP.forEach(t=>{eS[t]=S0});Na.console=console.hasOwnProperty("log")?console:eS;const Ec={debug:S0,error:Na.console.error||S0,info:Na.console.info||S0,log:Na.console.log||S0,warn:Na.console.warn||S0};function tS(t,e){Ec[t]&&(Ec[t]=e||S0)}function nS(){Ec.log(...arguments)}function rS(){Ec.info(...arguments)}function Zp(){Ec.debug(...arguments)}function mt(){Ec.error(...arguments)}function s2(){Ec.warn(...arguments)}const e9={};function iS(t){e9[t]||(Ec.error(t),e9[t]=!0)}const zr=Object.create(null);zr.Float32Array=Float32Array;zr.Float64Array=Float64Array;zr.Uint8Array=Uint8Array;zr.Int8Array=Int8Array;zr.Uint16Array=Uint16Array;zr.Int16Array=Int16Array;zr.Uint32Array=Uint32Array;zr.Int32Array=Int32Array;zr.Uint8ClampedArray=Uint8ClampedArray;try{zr.BigInt64Array=BigInt64Array,zr.BigUint64Array=BigUint64Array}catch{}function Ku(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];return new(zr[t]||Float64Array)(...n)}function c2(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];return(zr[t]||Float64Array).from(...n)}function l2(t){return t.charAt(0).toUpperCase()+t.slice(1)}function bn(t){return l2(t[0]==="_"?t.slice(1):t)}function aS(t){return t.charAt(0).toLowerCase()+t.slice(1)}function oS(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:2,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1e3;const r=["TB","GB","MB","KB"];let i=Number(t),a="B";for(;i>n;)i/=n,a=r.pop();return`${i.toFixed(e)} ${a}`}function sS(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:" ";const n=[];let r=t;for(;r>1e3;)n.push(`000${r%1e3}`.slice(-3)),r=Math.floor(r/1e3);return r>0&&n.push(r),n.reverse(),n.join(e)}function cS(t){Object.keys(t).forEach(e=>{Array.isArray(t[e])&&(t[e]=[].concat(t[e]))})}function eN(t){return Object.values(zr).some(e=>t instanceof e)}function tN(t,e){if(t===e)return!0;if(Array.isArray(t)&&Array.isArray(e)){if(t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(t[n]!==e[n])return!1;return!0}return!1}function nN(t,e){return Object.keys(t).find(n=>t[n]===e)}function lS(t){return t&&t.isA?t.getState():t}function g4(t){setTimeout(t,0)}function uS(t,e){const n=performance.now();t.finally(()=>{const r=performance.now()-n;e(r)})}function zt(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};cS(e);const n=[];if(Number.isInteger(e.mtime)||(e.mtime=++w3),!("classHierarchy"in e))e.classHierarchy=new O5("vtkObject");else if(!(e.classHierarchy instanceof O5)){const a=new O5;for(let o=0;o<e.classHierarchy.length;o++)a.push(e.classHierarchy[o]);e.classHierarchy=a}function r(a){n[a]=null}function i(a){function o(){r(a)}return Object.freeze({unsubscribe:o})}return t.isDeleted=()=>!!e.deleted,t.modified=a=>{if(e.deleted){mt("instance deleted - cannot call any method");return}a&&a<t.getMTime()||(e.mtime=++w3,n.forEach(o=>o&&o(t)))},t.onModified=a=>{if(e.deleted)return mt("instance deleted - cannot call any method"),null;const o=n.length;return n.push(a),i(o)},t.getMTime=()=>e.mtime,t.isA=a=>{let o=e.classHierarchy.length;for(;o--;)if(e.classHierarchy[o]===a)return!0;return!1},t.getClassName=function(){let a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return e.classHierarchy[e.classHierarchy.length-1-a]},t.set=function(){let a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,c=!1;return Object.keys(a).forEach(l=>{const f=s?null:t[`set${l2(l)}`];f&&Array.isArray(a[l])&&f.length>1?c=f(...a[l])||c:f?c=f(a[l])||c:(["mtime"].indexOf(l)===-1&&!o&&s2(`Warning: Set value to model directly ${l}, ${a[l]}`),c=e[l]!==a[l]||c,e[l]=a[l])}),c},t.get=function(){for(var a=arguments.length,o=new Array(a),s=0;s<a;s++)o[s]=arguments[s];if(!o.length)return e;const c={};return o.forEach(l=>{c[l]=e[l]}),c},t.getReferenceByName=a=>e[a],t.delete=()=>{Object.keys(e).forEach(a=>delete e[a]),n.forEach((a,o)=>r(o)),e.deleted=!0},t.getState=()=>{if(e.deleted)return null;const a={...e,vtkClass:t.getClassName()};Object.keys(a).forEach(s=>{a[s]===null||a[s]===void 0||s[0]==="_"?delete a[s]:a[s].isA?a[s]=a[s].getState():Array.isArray(a[s])?a[s]=a[s].map(lS):eN(a[s])&&(a[s]=Array.from(a[s]))});const o={};return Object.keys(a).sort().forEach(s=>{o[s]=a[s]}),o.mtime&&delete o.mtime,o},t.shallowCopy=function(a){let o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(a.getClassName()!==t.getClassName())throw new Error(`Cannot ShallowCopy ${a.getClassName()} into ${t.getClassName()}`);const s=a.get(),c=Object.keys(e).sort();Object.keys(s).sort().forEach(f=>{const u=c.indexOf(f);u===-1?o&&Zp(`add ${f} in shallowCopy`):c.splice(u,1),e[f]=s[f]}),c.length&&o&&Zp(`Untouched keys: ${c.join(", ")}`),t.modified()},t.toJSON=function(){return t.getState()},t}const rN={object(t,e,n){return function(){return{...e[n.name]}}}};function hi(t,e,n){n.forEach(r=>{if(typeof r=="object"){const i=rN[r.type];i?t[`get${bn(r.name)}`]=i(t,e,r):t[`get${bn(r.name)}`]=()=>e[r.name]}else t[`get${bn(r)}`]=()=>e[r]})}const fS={enum(t,e,n){const r=`_on${bn(n.name)}Changed`;return i=>{var a;if(typeof i=="string"){if(n.enum[i]!==void 0)return e[n.name]!==n.enum[i]?(e[n.name]=n.enum[i],t.modified(),!0):!1;throw mt(`Set Enum with invalid argument ${n}, ${i}`),new RangeError("Set Enum with invalid string argument")}if(typeof i=="number"){if(e[n.name]!==i){if(Object.keys(n.enum).map(o=>n.enum[o]).indexOf(i)!==-1){const o=e[n.name];return e[n.name]=i,(a=e[r])==null||a.call(e,t,e,i,o),t.modified(),!0}throw mt(`Set Enum outside numeric range ${n}, ${i}`),new RangeError("Set Enum outside numeric range")}return!1}throw mt(`Set Enum with invalid argument (String/Number) ${n}, ${i}`),new TypeError("Set Enum with invalid argument (String/Number)")}},object(t,e,n){var i;((i=n.params)==null?void 0:i.length)===1&&s2('Setter of type "object" with a single "param" field is not supported');const r=`_on${bn(n.name)}Changed`;return function(){var l,f;for(var a=arguments.length,o=new Array(a),s=0;s<a;s++)o[s]=arguments[s];let c;if(o.length>1&&((l=n.params)!=null&&l.length)?c=n.params.reduce((u,g,d)=>Object.assign(u,{[g]:o[d]}),{}):c=o[0],!Gx(e[n.name],c)){const u=e[n.name];return e[n.name]=c,(f=e[r])==null||f.call(e,t,e,c,u),t.modified(),!0}return!1}}};function t9(t){if(typeof t=="object"){const e=fS[t.type];if(e)return(n,r)=>e(n,r,t);throw mt(`No setter for field ${t}`),new TypeError("No setter for field")}return function(n,r){const i=`_on${bn(t)}Changed`;return function(o){var s;if(r.deleted)return mt("instance deleted - cannot call any method"),!1;if(r[t]!==o){const c=r[t.name];return r[t]=o,(s=r[i])==null||s.call(r,n,r,o,c),n.modified(),!0}return!1}}}function ud(t,e,n){n.forEach(r=>{typeof r=="object"?t[`set${bn(r.name)}`]=t9(r)(t,e):t[`set${bn(r)}`]=t9(r)(t,e)})}function Vn(t,e,n){hi(t,e,n),ud(t,e,n)}function qu(t,e,n){n.forEach(r=>{t[`get${bn(r)}`]=()=>e[r]?Array.from(e[r]):e[r],t[`get${bn(r)}ByReference`]=()=>e[r]})}function d4(t,e,n,r){let i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:void 0;n.forEach(a=>{if(e[a]&&r&&e[a].length!==r)throw new RangeError(`Invalid initial number of values for array (${a})`);const o=`_on${bn(a)}Changed`;t[`set${bn(a)}`]=function(){var d;if(e.deleted)return mt("instance deleted - cannot call any method"),!1;for(var s=arguments.length,c=new Array(s),l=0;l<s;l++)c[l]=arguments[l];let f=c,u,g=!1;if(f.length===1&&(f[0]==null||f[0].length>=0)&&(f=f[0],g=!0),f==null)u=e[a]!==f;else{if(r&&f.length!==r)if(f.length<r&&i!==void 0)for(f=Array.from(f),g=!1;f.length<r;)f.push(i);else throw new RangeError(`Invalid number of values for array setter (${a})`);u=e[a]==null||e[a].length!==f.length;for(let h=0;!u&&h<f.length;++h)u=e[a][h]!==f[h];u&&g&&(f=Array.from(f))}if(u){const h=e[a.name];e[a]=f,(d=e[o])==null||d.call(e,t,e,f,h),t.modified()}return u},t[`set${bn(a)}From`]=s=>{const c=e[a];s.forEach((l,f)=>{c[f]=l})}})}function p4(t,e,n,r){let i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:void 0;qu(t,e,n),d4(t,e,n,r,i)}function fd(t,e,n){for(let r=0;r<n.length;r++){const i=n[r];e[i]!==void 0&&(e[`_${i}`]=e[i],delete e[i])}}function h4(t,e,n,r){e.inputData?e.inputData=e.inputData.map(Fa):e.inputData=[],e.inputConnection?e.inputConnection=e.inputConnection.map(Fa):e.inputConnection=[],e.output?e.output=e.output.map(Fa):e.output=[],e.inputArrayToProcess?e.inputArrayToProcess=e.inputArrayToProcess.map(Fa):e.inputArrayToProcess=[],e.numberOfInputs=n;function i(d){let h=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;if(e.deleted){mt("instance deleted - cannot call any method");return}if(h>=e.numberOfInputs){mt(`algorithm ${t.getClassName()} only has ${e.numberOfInputs} input ports. To add more input ports, use addInputData()`);return}(e.inputData[h]!==d||e.inputConnection[h])&&(e.inputData[h]=d,e.inputConnection[h]=null,t.modified&&t.modified())}function a(){let d=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return e.inputConnection[d]&&(e.inputData[d]=e.inputConnection[d]()),e.inputData[d]}function o(d){let h=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;if(e.deleted){mt("instance deleted - cannot call any method");return}if(h>=e.numberOfInputs){let p=`algorithm ${t.getClassName()} only has `;p+=`${e.numberOfInputs}`,p+=" input ports. To add more input ports, use addInputConnection()",mt(p);return}e.inputData[h]=null,e.inputConnection[h]=d}function s(){let d=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return e.inputConnection[d]}function c(){let d=e.numberOfInputs;for(;d&&!e.inputData[d-1]&&!e.inputConnection[d-1];)d--;return d===e.numberOfInputs&&e.numberOfInputs++,d}function l(d){if(e.deleted){mt("instance deleted - cannot call any method");return}o(d,c())}function f(d){if(e.deleted){mt("instance deleted - cannot call any method");return}i(d,c())}function u(){let d=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return e.deleted?(mt("instance deleted - cannot call any method"),null):(t.shouldUpdate()&&t.update(),e.output[d])}t.shouldUpdate=()=>{var m,v;const d=t.getMTime();let h=1/0,p=r;for(;p--;){if(!e.output[p]||e.output[p].isDeleted())return!0;const y=e.output[p].getMTime();if(y<d)return!0;y<h&&(h=y)}for(p=e.numberOfInputs;p--;)if((m=e.inputConnection[p])!=null&&m.filter.shouldUpdate()||((v=t.getInputData(p))==null?void 0:v.getMTime())>h)return!0;return!1};function g(){let d=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;const h=()=>u(d);return h.filter=t,h}if(e.numberOfInputs){let d=e.numberOfInputs;for(;d--;)e.inputData.push(null),e.inputConnection.push(null);t.setInputData=i,t.setInputConnection=o,t.addInputData=f,t.addInputConnection=l,t.getInputData=a,t.getInputConnection=s}r&&(t.getOutputData=u,t.getOutputPort=g),t.update=()=>{const d=[];if(e.numberOfInputs){let h=0;for(;h<e.numberOfInputs;)d[h]=t.getInputData(h),h++}t.shouldUpdate()&&t.requestData&&t.requestData(d,e.output)},t.getNumberOfInputPorts=()=>e.numberOfInputs,t.getNumberOfOutputPorts=()=>r||e.output.length,t.getInputArrayToProcess=d=>{const h=e.inputArrayToProcess[d],p=e.inputData[d];return h&&p?p[`get${h.fieldAssociation}`]().getArray(h.arrayName):null},t.setInputArrayToProcess=function(d,h,p){let m=arguments.length>3&&arguments[3]!==void 0?arguments[3]:"Scalars";for(;e.inputArrayToProcess.length<d;)e.inputArrayToProcess.push(null);e.inputArrayToProcess[d]={arrayName:h,fieldAssociation:p,attributeType:m}}}const m4=Symbol("Event abort");function gS(t,e,n){const r=[],i=t.delete;let a=1;function o(l){for(let f=0;f<r.length;++f){const[u]=r[f];if(u===l){r.splice(f,1);return}}}function s(l){function f(){o(l)}return Object.freeze({unsubscribe:f})}function c(){if(e.deleted){mt("instance deleted - cannot call any method");return}const l=r.slice();for(let f=0;f<l.length;++f){const[,u,g]=l[f];if(u){if(g<0)setTimeout(()=>u.apply(t,arguments),1-g);else if(u.apply(t,arguments)===m4)break}}}t[`invoke${bn(n)}`]=c,t[`on${bn(n)}`]=function(l){let f=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;if(!l.apply)return console.error(`Invalid callback for event ${n}`),null;if(e.deleted)return mt("instance deleted - cannot call any method"),null;const u=a++;return r.push([u,l,f]),r.sort((g,d)=>d[2]-g[2]),s(u)},t.delete=()=>{i(),r.forEach(l=>{let[f]=l;return o(f)})}}function Rt(t,e){const n=function(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const i={},a={};return t(a,i,r),Object.freeze(a)};return e&&Fa.register(e,n),n}function gd(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return function(){for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return e.filter(o=>!!o).map(o=>o(...i))}}function v4(t){return t&&t.isA&&t.isA("vtkObject")}function Qp(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[],r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:[];if(v4(t)){if(r.indexOf(t)>=0)return n;r.push(t);const i=e(t);i!==void 0&&n.push(i);const a=t.get();Object.keys(a).forEach(o=>{const s=a[o];Array.isArray(s)?s.forEach(c=>{Qp(c,e,n,r)}):Qp(s,e,n,r)})}return n}function dS(t,e,n){var r=this;let i;const a=function(){for(var o=arguments.length,s=new Array(o),c=0;c<o;c++)s[c]=arguments[c];const l=r,f=()=>{i=null,n||t.apply(l,s)},u=n&&!i;clearTimeout(i),i=setTimeout(f,e),u&&t.apply(l,s)};return a.cancel=()=>clearTimeout(i),a}function pS(t,e){let n=!1,r=null;function i(){n=!1,r!==null&&(a(...r),r=null)}function a(){for(var o=arguments.length,s=new Array(o),c=0;c<o;c++)s[c]=arguments[c];if(n){r=s;return}n=!0,t(...s),setTimeout(i,e)}return a}function y4(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};e.keystore=Object.assign(e.keystore||{},n),t.setKey=(r,i)=>{e.keystore[r]=i},t.getKey=r=>e.keystore[r],t.getAllKeys=()=>Object.keys(e.keystore),t.deleteKey=r=>delete e.keystore[r],t.clearKeystore=()=>t.getAllKeys().forEach(r=>delete e.keystore[r])}let iN=1;const qd="__root__";function hS(t,e){y4(t,e);const n=t.delete;e.proxyId=`${iN++}`,e.ui=JSON.parse(JSON.stringify(e.ui||[])),hi(t,e,["proxyId","proxyGroup","proxyName"]),Vn(t,e,["proxyManager"]);const r={},i={};function a(l,f){i[f]||(i[f]=[]);const u=i[f];for(let g=0;g<l.length;g++)u.push(l[g].name),r[l[g].name]=l[g],l[g].children&&l[g].children.length&&a(l[g].children,l[g].name)}a(e.ui,qd),t.updateUI=l=>{e.ui=JSON.parse(JSON.stringify(l||[])),Object.keys(r).forEach(f=>delete r[f]),Object.keys(i).forEach(f=>delete i[f]),a(e.ui,qd),t.modified()};function o(){let l=arguments.length>0&&arguments[0]!==void 0?arguments[0]:qd;return i[l]}t.updateProxyProperty=(l,f)=>{const u=r[l];u?Object.assign(u,f):r[l]={...f}},t.activate=()=>{if(e.proxyManager){const l=`setActive${bn(t.getProxyGroup().slice(0,-1))}`;e.proxyManager[l]&&e.proxyManager[l](t)}},e.propertyLinkSubscribers={},t.registerPropertyLinkForGC=(l,f)=>{f in e.propertyLinkSubscribers||(e.propertyLinkSubscribers[f]=[]),e.propertyLinkSubscribers[f].push(l)},t.gcPropertyLinks=l=>{const f=e.propertyLinkSubscribers[l]||[];for(;f.length;)f.pop().unbind(t)},e.propertyLinkMap={},t.getPropertyLink=function(l){let f=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(e.propertyLinkMap[l])return e.propertyLinkMap[l];let u=null;const g=[];let d=0,h=!1;function p(C){let w=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(h)return null;const x=[];let O=null;for(d=g.length;d--;){const A=g[d];A.instance===C?O=A:x.push(A)}if(!O)return null;const M=O.instance[`get${bn(O.propertyName)}`]();if(!tN(M,u)||w){for(u=M,h=!0;x.length;){const A=x.pop();A.instance.set({[A.propertyName]:u})}h=!1}return e.propertyLinkMap[l].persistent&&(e.propertyLinkMap[l].value=M),M}function m(C,w){const x=[];for(d=g.length;d--;){const O=g[d];O.instance===C&&(O.propertyName===w||w===void 0)&&(O.subscription.unsubscribe(),x.push(d))}for(;x.length;)g.splice(x.pop(),1)}function v(C,w){let x=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;const O=C.onModified(p),M=g[0];return g.push({instance:C,propertyName:w,subscription:O}),x&&(e.propertyLinkMap[l].persistent&&e.propertyLinkMap[l].value!==void 0?C.set({[w]:e.propertyLinkMap[l].value}):M&&p(M.instance,!0)),{unsubscribe:()=>m(C,w)}}function y(){for(;g.length;)g.pop().subscription.unsubscribe()}const T={bind:v,unbind:m,unsubscribe:y,persistent:f};return e.propertyLinkMap[l]=T,T};function s(){let l=arguments.length>0&&arguments[0]!==void 0?arguments[0]:qd;const f=[],u=e.proxyId,g=o(l)||[];for(let d=0;d<g.length;d++){const h=g[d],p=t[`get${bn(h)}`],m=p?p():void 0,v={id:u,name:h,value:m},y=s(h);y.length&&(v.children=y),f.push(v)}return f}t.listPropertyNames=()=>s().map(l=>l.name),t.getPropertyByName=l=>s().find(f=>f.name===l),t.getPropertyDomainByName=l=>(r[l]||{}).domain,t.getProxySection=()=>({id:e.proxyId,name:e.proxyGroup,ui:e.ui,properties:s()}),t.delete=()=>{const l=Object.keys(e.propertyLinkMap);let f=l.length;for(;f--;)e.propertyLinkMap[l[f]].unsubscribe();Object.keys(e.propertyLinkSubscribers).forEach(t.gcPropertyLinks),n()},t.getState=()=>null;function c(){if(e.links)for(let l=0;l<e.links.length;l++){const{link:f,property:u,persistent:g,updateOnBind:d,type:h}=e.links[l];if(h==="application"){const p=e.proxyManager.getPropertyLink(f,g);t.registerPropertyLinkForGC(p,"application"),p.bind(t,u,d)}}}g4(c)}function mS(t,e,n){const r=t.delete,i=[],a=Object.keys(n);let o=a.length;for(;o--;){const s=a[o],{modelKey:c,property:l,modified:f=!0}=n[s],u=bn(l),g=bn(s);t[`get${g}`]=e[c][`get${u}`],t[`set${g}`]=e[c][`set${u}`],f&&i.push(e[c].onModified(t.modified))}t.delete=()=>{for(;i.length;)i.pop().unsubscribe();r()}}function vS(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};e.this=t;function i(s){const c=Object.keys(s);let l=c.length;for(;l--;){const f=c[l];e[f].set(s[f])}}const a=Object.keys(r);let o=a.length;for(;o--;){const s=a[o];e[s]=r[s];const c=n[s];t[`set${bn(s)}`]=l=>{if(l!==e[s]){e[s]=l;const f=c[l];i(f),t.modified()}}}a.length&&hi(t,e,a)}const n9=10,r9=40,i9=800;function yS(t){let e=0,n=0,r=0,i=0;return"detail"in t&&(n=t.detail),"wheelDelta"in t&&(n=-t.wheelDelta/120),"wheelDeltaY"in t&&(n=-t.wheelDeltaY/120),"wheelDeltaX"in t&&(e=-t.wheelDeltaX/120),"axis"in t&&t.axis===t.HORIZONTAL_AXIS&&(e=n,n=0),r=e*n9,i=n*n9,"deltaY"in t&&(i=t.deltaY),"deltaX"in t&&(r=t.deltaX),(r||i)&&t.deltaMode&&(t.deltaMode===1?(r*=r9,i*=r9):(r*=i9,i*=i9)),r&&!e&&(e=r<1?-1:1),i&&!n&&(n=i<1?-1:1),{spinX:e,spinY:n||e,pixelX:r,pixelY:i||r}}var P={algo:h4,capitalize:l2,chain:gd,debounce:dS,enumToString:nN,event:gS,EVENT_ABORT:m4,formatBytesToProperUnit:oS,formatNumbersWithThousandSeparator:sS,get:hi,getArray:qu,getCurrentGlobalMTime:QP,getStateArrayMapFunc:lS,isVtkObject:v4,keystore:y4,measurePromiseExecution:uS,moveToProtected:fd,newInstance:Rt,newTypedArray:Ku,newTypedArrayFrom:c2,normalizeWheel:yS,obj:zt,proxy:hS,proxyPropertyMapping:mS,proxyPropertyState:vS,safeArrays:cS,set:ud,setArray:d4,setGet:Vn,setGetArray:p4,setImmediate:g4,setLoggerFunction:tS,throttle:pS,traverseInstanceTree:Qp,TYPED_ARRAYS:zr,uncapitalize:aS,VOID:Jx,vtkDebugMacro:Zp,vtkErrorMacro:mt,vtkInfoMacro:rS,vtkLogMacro:nS,vtkOnceErrorMacro:iS,vtkWarningMacro:s2,objectSetterMap:fS},Ir=Object.freeze({__proto__:null,VOID:Jx,setLoggerFunction:tS,vtkLogMacro:nS,vtkInfoMacro:rS,vtkDebugMacro:Zp,vtkErrorMacro:mt,vtkWarningMacro:s2,vtkOnceErrorMacro:iS,TYPED_ARRAYS:zr,newTypedArray:Ku,newTypedArrayFrom:c2,capitalize:l2,_capitalize:bn,uncapitalize:aS,formatBytesToProperUnit:oS,formatNumbersWithThousandSeparator:sS,setImmediateVTK:g4,measurePromiseExecution:uS,obj:zt,get:hi,set:ud,setGet:Vn,getArray:qu,setArray:d4,setGetArray:p4,moveToProtected:fd,algo:h4,EVENT_ABORT:m4,event:gS,newInstance:Rt,chain:gd,isVtkObject:v4,traverseInstanceTree:Qp,debounce:dS,throttle:pS,keystore:y4,proxy:hS,proxyPropertyMapping:mS,proxyPropertyState:vS,normalizeWheel:yS,default:P});const aN={Int8Array:1,Uint8Array:1,Uint8ClampedArray:1,Int16Array:2,Uint16Array:2,Int32Array:4,Uint32Array:4,Float32Array:4,Float64Array:8},ut={VOID:"",CHAR:"Int8Array",SIGNED_CHAR:"Int8Array",UNSIGNED_CHAR:"Uint8Array",UNSIGNED_CHAR_CLAMPED:"Uint8ClampedArray",SHORT:"Int16Array",UNSIGNED_SHORT:"Uint16Array",INT:"Int32Array",UNSIGNED_INT:"Uint32Array",FLOAT:"Float32Array",DOUBLE:"Float64Array"},oN=ut.FLOAT;var TS={DefaultDataType:oN,DataTypeByteSize:aN,VtkDataTypes:ut};const sN="WebGL",Jp=Object.create(null);function CS(t,e){Jp[t]=e}function cN(){return Object.keys(Jp)}function wS(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return Jp[t]&&Jp[t](e)}function lN(t,e){e.classHierarchy.push("vtkRenderWindow"),t.addRenderer=n=>{t.hasRenderer(n)||(n.setRenderWindow(t),e.renderers.push(n),t.modified())},t.removeRenderer=n=>{e.renderers=e.renderers.filter(r=>r!==n),t.modified()},t.hasRenderer=n=>e.renderers.indexOf(n)!==-1,t.newAPISpecificView=function(n){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return wS(n||e.defaultViewAPI,r)},t.addView=n=>{t.hasView(n)||(n.setRenderable(t),e._views.push(n),t.modified())},t.removeView=n=>{e._views=e._views.filter(r=>r!==n),t.modified()},t.hasView=n=>e._views.indexOf(n)!==-1,t.preRender=()=>{e.renderers.forEach(n=>{n.isActiveCameraCreated()||n.resetCamera()})},t.render=()=>{t.preRender(),e.interactor?e.interactor.render():e._views.forEach(n=>n.traverseAllPasses())},t.getStatistics=()=>{const n={propCount:0,invisiblePropCount:0,gpuMemoryMB:0};return e._views.forEach(r=>{r.getGraphicsMemoryInfo&&(n.gpuMemoryMB+=r.getGraphicsMemoryInfo()/1e6)}),e.renderers.forEach(r=>{const i=r.getViewProps(),a=e._views[0].getViewNodeFor(r);i.forEach(o=>{if(o.getVisibility()){n.propCount+=1;const s=o.getMapper&&o.getMapper();if(s&&s.getPrimitiveCount){const c=a.getViewNodeFor(s);if(c){c.getAllocatedGPUMemoryInBytes&&(n.gpuMemoryMB+=c.getAllocatedGPUMemoryInBytes()/1e6);const l=s.getPrimitiveCount();Object.keys(l).forEach(f=>{n[f]||(n[f]=0),n[f]+=l[f]})}}}else n.invisiblePropCount+=1})}),n.str=Object.keys(n).map(r=>`${r}: ${n[r]}`).join(`
`),n},t.captureImages=function(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"image/png",r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return P.setImmediate(t.render),e._views.map(i=>i.captureNextImage?i.captureNextImage(n,r):void 0).filter(i=>!!i)},t.addRenderWindow=n=>e.childRenderWindows.includes(n)?!1:(e.childRenderWindows.push(n),t.modified(),!0),t.removeRenderWindow=n=>{const r=e.childRenderWindows.findIndex(i=>i===n);return r<0?!1:(e.childRenderWindows.splice(r,1),t.modified(),!0)}}const uN={defaultViewAPI:sN,renderers:[],views:[],interactor:null,neverRendered:!0,numberOfLayers:1,childRenderWindows:[]};function xS(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,uN,n),P.obj(t,e),P.setGet(t,e,["interactor","numberOfLayers","_views","defaultViewAPI"]),P.get(t,e,["neverRendered"]),P.getArray(t,e,["renderers","childRenderWindows"]),P.moveToProtected(t,e,["views"]),P.event(t,e,"completion"),lN(t,e)}const fN=P.newInstance(xS,"vtkRenderWindow");var gN={newInstance:fN,extend:xS,registerViewConstructor:CS,listViewAPIs:cN,newAPISpecificView:wS};const Fg={CLAMP_TO_EDGE:0,REPEAT:1,MIRRORED_REPEAT:2},Ge={NEAREST:0,LINEAR:1,NEAREST_MIPMAP_NEAREST:2,NEAREST_MIPMAP_LINEAR:3,LINEAR_MIPMAP_NEAREST:4,LINEAR_MIPMAP_LINEAR:5};var SS={Wrap:Fg,Filter:Ge};const ES=new Float32Array(1),dN=new Int32Array(ES.buffer);function pN(t){ES[0]=t;const e=dN[0];let n=e>>16&32768,r=e>>12&2047;const i=e>>23&255;return i<103?n:i>142?(n|=31744,n|=(i===255?0:1)&&e&8388607,n):i<113?(r|=2048,n|=(r>>114-i)+(r>>113-i&1),n):(n|=i-112<<10|r>>1,n+=r&1,n)}function hN(t){const e=(t&32768)>>15,n=(t&31744)>>10,r=t&1023;return n===0?(e?-1:1)*2**-14*(r/2**10):n===31?r?NaN:(e?-1:1)*(1/0):(e?-1:1)*2**(n-15)*(1+r/2**10)}var E0={fromHalf:hN,toHalf:pN},T4={exports:{}};T4.exports;(function(t){(function(e,n,r){function i(c){var l=this,f=s();l.next=function(){var u=2091639*l.s0+l.c*23283064365386963e-26;return l.s0=l.s1,l.s1=l.s2,l.s2=u-(l.c=u|0)},l.c=1,l.s0=f(" "),l.s1=f(" "),l.s2=f(" "),l.s0-=f(c),l.s0<0&&(l.s0+=1),l.s1-=f(c),l.s1<0&&(l.s1+=1),l.s2-=f(c),l.s2<0&&(l.s2+=1),f=null}function a(c,l){return l.c=c.c,l.s0=c.s0,l.s1=c.s1,l.s2=c.s2,l}function o(c,l){var f=new i(c),u=l&&l.state,g=f.next;return g.int32=function(){return f.next()*4294967296|0},g.double=function(){return g()+(g()*2097152|0)*11102230246251565e-32},g.quick=g,u&&(typeof u=="object"&&a(u,f),g.state=function(){return a(f,{})}),g}function s(){var c=4022871197,l=function(f){f=String(f);for(var u=0;u<f.length;u++){c+=f.charCodeAt(u);var g=.02519603282416938*c;c=g>>>0,g-=c,g*=c,c=g>>>0,g-=c,c+=g*4294967296}return(c>>>0)*23283064365386963e-26};return l}n&&n.exports?n.exports=o:this.alea=o})(Rr,t)})(T4);var mN=T4.exports,C4={exports:{}};C4.exports;(function(t){(function(e,n,r){function i(s){var c=this,l="";c.x=0,c.y=0,c.z=0,c.w=0,c.next=function(){var u=c.x^c.x<<11;return c.x=c.y,c.y=c.z,c.z=c.w,c.w^=c.w>>>19^u^u>>>8},s===(s|0)?c.x=s:l+=s;for(var f=0;f<l.length+64;f++)c.x^=l.charCodeAt(f)|0,c.next()}function a(s,c){return c.x=s.x,c.y=s.y,c.z=s.z,c.w=s.w,c}function o(s,c){var l=new i(s),f=c&&c.state,u=function(){return(l.next()>>>0)/4294967296};return u.double=function(){do var g=l.next()>>>11,d=(l.next()>>>0)/4294967296,h=(g+d)/(1<<21);while(h===0);return h},u.int32=l.next,u.quick=u,f&&(typeof f=="object"&&a(f,l),u.state=function(){return a(l,{})}),u}n&&n.exports?n.exports=o:this.xor128=o})(Rr,t)})(C4);var vN=C4.exports,w4={exports:{}};w4.exports;(function(t){(function(e,n,r){function i(s){var c=this,l="";c.next=function(){var u=c.x^c.x>>>2;return c.x=c.y,c.y=c.z,c.z=c.w,c.w=c.v,(c.d=c.d+362437|0)+(c.v=c.v^c.v<<4^(u^u<<1))|0},c.x=0,c.y=0,c.z=0,c.w=0,c.v=0,s===(s|0)?c.x=s:l+=s;for(var f=0;f<l.length+64;f++)c.x^=l.charCodeAt(f)|0,f==l.length&&(c.d=c.x<<10^c.x>>>4),c.next()}function a(s,c){return c.x=s.x,c.y=s.y,c.z=s.z,c.w=s.w,c.v=s.v,c.d=s.d,c}function o(s,c){var l=new i(s),f=c&&c.state,u=function(){return(l.next()>>>0)/4294967296};return u.double=function(){do var g=l.next()>>>11,d=(l.next()>>>0)/4294967296,h=(g+d)/(1<<21);while(h===0);return h},u.int32=l.next,u.quick=u,f&&(typeof f=="object"&&a(f,l),u.state=function(){return a(l,{})}),u}n&&n.exports?n.exports=o:this.xorwow=o})(Rr,t)})(w4);var yN=w4.exports,x4={exports:{}};x4.exports;(function(t){(function(e,n,r){function i(s){var c=this;c.next=function(){var f=c.x,u=c.i,g,d;return g=f[u],g^=g>>>7,d=g^g<<24,g=f[u+1&7],d^=g^g>>>10,g=f[u+3&7],d^=g^g>>>3,g=f[u+4&7],d^=g^g<<7,g=f[u+7&7],g=g^g<<13,d^=g^g<<9,f[u]=d,c.i=u+1&7,d};function l(f,u){var g,d=[];if(u===(u|0))d[0]=u;else for(u=""+u,g=0;g<u.length;++g)d[g&7]=d[g&7]<<15^u.charCodeAt(g)+d[g+1&7]<<13;for(;d.length<8;)d.push(0);for(g=0;g<8&&d[g]===0;++g);for(g==8?d[7]=-1:d[g],f.x=d,f.i=0,g=256;g>0;--g)f.next()}l(c,s)}function a(s,c){return c.x=s.x.slice(),c.i=s.i,c}function o(s,c){s==null&&(s=+new Date);var l=new i(s),f=c&&c.state,u=function(){return(l.next()>>>0)/4294967296};return u.double=function(){do var g=l.next()>>>11,d=(l.next()>>>0)/4294967296,h=(g+d)/(1<<21);while(h===0);return h},u.int32=l.next,u.quick=u,f&&(f.x&&a(f,l),u.state=function(){return a(l,{})}),u}n&&n.exports?n.exports=o:this.xorshift7=o})(Rr,t)})(x4);var TN=x4.exports,S4={exports:{}};S4.exports;(function(t){(function(e,n,r){function i(s){var c=this;c.next=function(){var f=c.w,u=c.X,g=c.i,d,h;return c.w=f=f+1640531527|0,h=u[g+34&127],d=u[g=g+1&127],h^=h<<13,d^=d<<17,h^=h>>>15,d^=d>>>12,h=u[g]=h^d,c.i=g,h+(f^f>>>16)|0};function l(f,u){var g,d,h,p,m,v=[],y=128;for(u===(u|0)?(d=u,u=null):(u=u+"\0",d=0,y=Math.max(y,u.length)),h=0,p=-32;p<y;++p)u&&(d^=u.charCodeAt((p+32)%u.length)),p===0&&(m=d),d^=d<<10,d^=d>>>15,d^=d<<4,d^=d>>>13,p>=0&&(m=m+1640531527|0,g=v[p&127]^=d+m,h=g==0?h+1:0);for(h>=128&&(v[(u&&u.length||0)&127]=-1),h=127,p=4*128;p>0;--p)d=v[h+34&127],g=v[h=h+1&127],d^=d<<13,g^=g<<17,d^=d>>>15,g^=g>>>12,v[h]=d^g;f.w=m,f.X=v,f.i=h}l(c,s)}function a(s,c){return c.i=s.i,c.w=s.w,c.X=s.X.slice(),c}function o(s,c){s==null&&(s=+new Date);var l=new i(s),f=c&&c.state,u=function(){return(l.next()>>>0)/4294967296};return u.double=function(){do var g=l.next()>>>11,d=(l.next()>>>0)/4294967296,h=(g+d)/(1<<21);while(h===0);return h},u.int32=l.next,u.quick=u,f&&(f.X&&a(f,l),u.state=function(){return a(l,{})}),u}n&&n.exports?n.exports=o:this.xor4096=o})(Rr,t)})(S4);var CN=S4.exports,E4={exports:{}};E4.exports;(function(t){(function(e,n,r){function i(s){var c=this,l="";c.next=function(){var u=c.b,g=c.c,d=c.d,h=c.a;return u=u<<25^u>>>7^g,g=g-d|0,d=d<<24^d>>>8^h,h=h-u|0,c.b=u=u<<20^u>>>12^g,c.c=g=g-d|0,c.d=d<<16^g>>>16^h,c.a=h-u|0},c.a=0,c.b=0,c.c=-1640531527,c.d=1367130551,s===Math.floor(s)?(c.a=s/4294967296|0,c.b=s|0):l+=s;for(var f=0;f<l.length+20;f++)c.b^=l.charCodeAt(f)|0,c.next()}function a(s,c){return c.a=s.a,c.b=s.b,c.c=s.c,c.d=s.d,c}function o(s,c){var l=new i(s),f=c&&c.state,u=function(){return(l.next()>>>0)/4294967296};return u.double=function(){do var g=l.next()>>>11,d=(l.next()>>>0)/4294967296,h=(g+d)/(1<<21);while(h===0);return h},u.int32=l.next,u.quick=u,f&&(typeof f=="object"&&a(f,l),u.state=function(){return a(l,{})}),u}n&&n.exports?n.exports=o:this.tychei=o})(Rr,t)})(E4);var wN=E4.exports,OS={exports:{}};const xN={},SN=Object.freeze(Object.defineProperty({__proto__:null,default:xN},Symbol.toStringTag,{value:"Module"})),vo=kL(SN);(function(t){(function(e,n,r){var i=256,a=6,o=52,s="random",c=r.pow(i,a),l=r.pow(2,o),f=l*2,u=i-1,g;function d(C,w,x){var O=[];w=w==!0?{entropy:!0}:w||{};var M=v(m(w.entropy?[C,T(n)]:C??y(),3),O),A=new h(O),_=function(){for(var k=A.g(a),z=c,X=0;k<l;)k=(k+X)*i,z*=i,X=A.g(1);for(;k>=f;)k/=2,z/=2,X>>>=1;return(k+X)/z};return _.int32=function(){return A.g(4)|0},_.quick=function(){return A.g(4)/4294967296},_.double=_,v(T(A.S),n),(w.pass||x||function(k,z,X,Z){return Z&&(Z.S&&p(Z,A),k.state=function(){return p(A,{})}),X?(r[s]=k,z):k})(_,M,"global"in w?w.global:this==r,w.state)}function h(C){var w,x=C.length,O=this,M=0,A=O.i=O.j=0,_=O.S=[];for(x||(C=[x++]);M<i;)_[M]=M++;for(M=0;M<i;M++)_[M]=_[A=u&A+C[M%x]+(w=_[M])],_[A]=w;(O.g=function(k){for(var z,X=0,Z=O.i,ce=O.j,J=O.S;k--;)z=J[Z=u&Z+1],X=X*i+J[u&(J[Z]=J[ce=u&ce+z])+(J[ce]=z)];return O.i=Z,O.j=ce,X})(i)}function p(C,w){return w.i=C.i,w.j=C.j,w.S=C.S.slice(),w}function m(C,w){var x=[],O=typeof C,M;if(w&&O=="object")for(M in C)try{x.push(m(C[M],w-1))}catch{}return x.length?x:O=="string"?C:C+"\0"}function v(C,w){for(var x=C+"",O,M=0;M<x.length;)w[u&M]=u&(O^=w[u&M]*19)+x.charCodeAt(M++);return T(w)}function y(){try{var C;return g&&(C=g.randomBytes)?C=C(i):(C=new Uint8Array(i),(e.crypto||e.msCrypto).getRandomValues(C)),T(C)}catch{var w=e.navigator,x=w&&w.plugins;return[+new Date,e,x,e.screen,T(n)]}}function T(C){return String.fromCharCode.apply(0,C)}if(v(r.random(),n),t.exports){t.exports=d;try{g=vo}catch{}}else r["seed"+s]=d})(typeof self<"u"?self:Rr,[],Math)})(OS);var EN=OS.exports,ON=mN,DN=vN,RN=yN,MN=TN,_N=CN,bN=wN,gl=EN;gl.alea=ON;gl.xor128=DN;gl.xorwow=RN;gl.xorshift7=MN;gl.xor4096=_N;gl.tychei=bN;var LN=gl;const IN=Eo(LN),O4=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],VN=[1,0,0,0,1,0,0,0,1],D4=1e-6,R4=1e-12,{vtkErrorMacro:DS,vtkWarningMacro:Y0}=P;let RS=0;const a9=20;function dd(t){return()=>DS(`vtkMath::${t} - NOT IMPLEMENTED`)}function ng(t,e,n,r){let i;for(let a=0;a<e;a++)i=t[n*e+a],t[n*e+a]=t[r*e+a],t[r*e+a]=i}function Pf(t,e,n,r){let i;for(let a=0;a<e;a++)i=t[a*e+n],t[a*e+n]=t[a*e+r],t[a*e+r]=i}function Kt(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:3;const e=Array(t);for(let n=0;n<t;++n)e[n]=0;return e}const PN=()=>Math.PI;function NN(t,e){return e>1023?t*2**1023*2**(e-1023):e<-1074?t*2**-1074*2**(e+1074):t*2**e}function hn(t){return t/180*Math.PI}function eh(t){return t*180/Math.PI}const{round:Nf,floor:M4,ceil:kN,min:AN,max:FN}=Math;function UN(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,r=1/0;for(let i=e,a=t.length;i<a;i+=n)t[i]<r&&(r=t[i]);return r}function BN(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,r=-1/0;for(let i=e,a=t.length;i<a;i+=n)r<t[i]&&(r=t[i]);return r}function GN(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,r=1/0,i=-1/0;for(let a=e,o=t.length;a<o;a+=n)t[a]<r&&(r=t[a]),i<t[a]&&(i=t[a]);return[r,i]}const $N=dd("ceilLog2"),WN=dd("factorial");function ua(t){let e=1;for(;e<t;)e*=2;return e}function kf(t){return t===ua(t)}function zN(t,e){let n=1;for(let r=1;r<=e;++r)n*=(t-r+1)/r;return Math.floor(n)}function jN(t,e){if(t<e)return 0;const n=Kt(e);for(let r=0;r<e;++r)n[r]=r;return n}function HN(t,e,n){let r=0;for(let i=e-1;i>=0;--i)if(n[i]<t-e+i){let a=n[i]+1;for(;i<e;)n[i++]=a++;r=1;break}return r}function KN(t){IN(`${t}`,{global:!0}),RS=t}function qN(){return RS}function XN(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;const n=(arguments.length>1&&arguments[1]!==void 0?arguments[1]:1)-t;return t+n*Math.random()}const YN=dd("gaussian");function th(t,e,n){return n[0]=t[0]+e[0],n[1]=t[1]+e[1],n[2]=t[2]+e[2],n}function is(t,e,n){return n[0]=t[0]-e[0],n[1]=t[1]-e[1],n[2]=t[2]-e[2],n}function MS(t,e){return t[0]*=e,t[1]*=e,t[2]*=e,t}function _S(t,e){return t[0]*=e,t[1]*=e,t}function x3(t,e,n,r){return r[0]=t[0]+e[0]*n,r[1]=t[1]+e[1]*n,r[2]=t[2]+e[2]*n,r}function ZN(t,e,n,r){return r[0]=t[0]+e[0]*n,r[1]=t[1]+e[1]*n,r}function ct(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function QN(t,e,n){n[0]=t[0]*e[0],n[1]=t[0]*e[1],n[2]=t[0]*e[2],n[3]=t[1]*e[0],n[4]=t[1]*e[1],n[5]=t[1]*e[2],n[6]=t[2]*e[0],n[7]=t[2]*e[1],n[8]=t[2]*e[2]}function yo(t,e,n){const r=t[1]*e[2]-t[2]*e[1],i=t[2]*e[0]-t[0]*e[2],a=t[0]*e[1]-t[1]*e[0];return n[0]=r,n[1]=i,n[2]=a,n}function cc(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:3;switch(e){case 1:return Math.abs(t);case 2:return Math.sqrt(t[0]*t[0]+t[1]*t[1]);case 3:return Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);default:{let n=0;for(let r=0;r<e;r++)n+=t[r]*t[r];return Math.sqrt(n)}}}function Z0(t){const e=cc(t);return e!==0&&(t[0]/=e,t[1]/=e,t[2]/=e),e}function JN(t,e,n,r){const i=t[0]*t[0],a=t[1]*t[1],o=t[2]*t[2],s=Math.sqrt(i+a+o);let c,l,f;i>a&&i>o?(c=0,l=1,f=2):a>o?(c=1,l=2,f=0):(c=2,l=0,f=1);const u=t[c]/s,g=t[l]/s,d=t[f]/s,h=Math.sqrt(u*u+d*d);if(r!==0){const p=Math.sin(r),m=Math.cos(r);e&&(e[c]=(d*m-u*g*p)/h,e[l]=p*h,e[f]=(-(u*m)-g*d*p)/h),n&&(n[c]=(-(d*p)-u*g*m)/h,n[l]=m*h,n[f]=(u*p-g*d*m)/h)}else e&&(e[c]=d/h,e[l]=0,e[f]=-u/h),n&&(n[c]=-u*g/h,n[l]=h,n[f]=-g*d/h)}function ek(t,e,n){const r=ct(e,e);if(r===0)return n[0]=0,n[1]=0,n[2]=0,!1;const i=ct(t,e)/r;for(let a=0;a<3;a++)n[a]=e[a];return MS(n,i),!0}function S3(t,e){return t[0]*e[0]+t[1]*e[1]}function tk(t,e,n){const r=S3(e,e);if(r===0)return n[0]=0,n[1]=0,!1;const i=S3(t,e)/r;for(let a=0;a<2;a++)n[a]=e[a];return _S(n,i),!0}function oo(t,e){return(t[0]-e[0])*(t[0]-e[0])+(t[1]-e[1])*(t[1]-e[1])+(t[2]-e[2])*(t[2]-e[2])}function nk(t,e){const n=[0,0,0];return yo(t,e,n),Math.atan2(cc(n),ct(t,e))}function rk(t,e,n){const r=Math.abs(t-n);return 1/Math.sqrt(2*Math.PI*e)*Math.exp(-(r**2)/(2*e))}function ik(t,e,n){const r=Math.abs(t-n);return Math.exp(-(r**2)/(2*e))}function ak(t,e,n){n[0]=t[0]*e[0],n[1]=t[0]*e[1],n[2]=t[1]*e[0],n[3]=t[1]*e[1]}function bS(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])}function LS(t){const e=bS(t);return e!==0&&(t[0]/=e,t[1]/=e),e}function vn(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return e.length===2?e[0][0]*e[1][1]-e[1][0]*e[0][1]:e.length===4?e[0]*e[3]-e[1]*e[2]:Number.NaN}function ok(t,e){let n,r,i;const a=[0,0,0];for(let o=0;o<3;o++)i=Math.abs(t[o*3]),(r=Math.abs(t[o*3+1]))>i&&(i=r),(r=Math.abs(t[o*3+2]))>i&&(i=r),a[o]=1/i;i=a[0]*Math.abs(t[0]),n=0,(r=a[1]*Math.abs(t[3]))>=i&&(i=r,n=1),(r=a[2]*Math.abs(t[6]))>=i&&(n=2),n!==0&&(ng(t,3,n,0),a[n]=a[0]),e[0]=n,t[3]/=t[0],t[6]/=t[0],t[4]-=t[3]*t[1],t[7]-=t[6]*t[1],i=a[1]*Math.abs(t[4]),n=1,(r=a[2]*Math.abs(t[7]))>=i&&(n=2,ng(t,3,1,2),a[2]=a[1]),e[1]=n,t[7]/=t[4],t[5]-=t[3]*t[2],t[8]-=t[6]*t[2]+t[7]*t[5],e[2]=2}function sk(t,e,n){let r=n[e[0]];n[e[0]]=n[0],n[0]=r,r=n[e[1]],n[e[1]]=n[1],n[1]=r-t[3]*n[0],r=n[e[2]],n[e[2]]=n[2],n[2]=r-t[6]*n[0]-t[7]*n[1],n[2]/=t[8],n[1]=(n[1]-t[5]*n[2])/t[4],n[0]=(n[0]-t[1]*n[1]-t[2]*n[2])/t[0]}function ck(t,e,n){const r=t[0],i=t[1],a=t[2],o=t[3],s=t[4],c=t[5],l=t[6],f=t[7],u=t[8],g=+vn(s,f,c,u),d=-vn(o,l,c,u),h=+vn(o,l,s,f),p=-vn(i,f,a,u),m=+vn(r,l,a,u),v=-vn(r,l,i,f),y=+vn(i,s,a,c),T=-vn(r,o,a,c),C=+vn(r,o,i,s),w=r*g+i*d+a*h,x=g*e[0]+p*e[1]+y*e[2],O=d*e[0]+m*e[1]+T*e[2],M=h*e[0]+v*e[1]+C*e[2];n[0]=x/w,n[1]=O/w,n[2]=M/w}function ep(t,e,n){const r=t[0]*e[0]+t[1]*e[1]+t[2]*e[2],i=t[3]*e[0]+t[4]*e[1]+t[5]*e[2],a=t[6]*e[0]+t[7]*e[1]+t[8]*e[2];n[0]=r,n[1]=i,n[2]=a}function E3(t,e,n){const r=[...t],i=[...e];for(let a=0;a<3;a++)n[a]=r[0]*i[a]+r[1]*i[a+3]+r[2]*i[a+6],n[a+3]=r[3]*i[a]+r[4]*i[a+3]+r[5]*i[a+6],n[a+6]=r[6]*i[a]+r[7]*i[a+3]+r[8]*i[a+6]}function lk(t,e,n,r,i,a,o){r!==i&&DS("Number of columns of A must match number of rows of B.");const s=[...t],c=[...e];for(let l=0;l<n;l++)for(let f=0;f<a;f++){o[l*a+f]=0;for(let u=0;u<r;u++)o[l*a+f]+=s[l*r+u]*c[f+a*u]}}function iu(t,e){let n;n=t[3],e[3]=t[1],e[1]=n,n=t[6],e[6]=t[2],e[2]=n,n=t[7],e[7]=t[5],e[5]=n,e[0]=t[0],e[4]=t[4],e[8]=t[8]}function uk(t,e){const n=t[0],r=t[1],i=t[2],a=t[3],o=t[4],s=t[5],c=t[6],l=t[7],f=t[8],u=+vn(o,l,s,f),g=-vn(a,c,s,f),d=+vn(a,c,o,l),h=-vn(r,l,i,f),p=+vn(n,c,i,f),m=-vn(n,c,r,l),v=+vn(r,o,i,s),y=-vn(n,a,i,s),T=+vn(n,a,r,o),C=n*u+r*g+i*d;C===0&&Y0("Matrix has 0 determinant"),e[0]=u/C,e[3]=g/C,e[6]=d/C,e[1]=h/C,e[4]=p/C,e[7]=m/C,e[2]=v/C,e[5]=y/C,e[8]=T/C}function u2(t){return t[0]*t[4]*t[8]+t[3]*t[7]*t[2]+t[6]*t[1]*t[5]-t[0]*t[7]*t[5]-t[3]*t[1]*t[8]-t[6]*t[4]*t[2]}function IS(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:D4;if(t.length!==e.length)return!1;function r(i,a){return Math.abs(i-e[a])<=n}return t.every(r)}const pd=IS;function VS(t){for(let e=0;e<3;e++)t[e*3]=t[e*3+1]=t[e*3+2]=0,t[e*3+e]=1}function PS(t,e){for(let n=0;n<t;n++){for(let r=0;r<t;r++)e[n*t+r]=0;e[n*t+n]=1}return e}function fk(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:D4;return pd(t,O4,e)}function gk(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:D4;return pd(t,VN,e)}function NS(t,e){const n=t[0]*t[0],r=t[0]*t[1],i=t[0]*t[2],a=t[0]*t[3],o=t[1]*t[1],s=t[2]*t[2],c=t[3]*t[3],l=t[1]*t[2],f=t[1]*t[3],u=t[2]*t[3],g=o+s+c;let d=1/(n+g);const h=(n-g)*d;d*=2,e[0]=o*d+h,e[3]=(l+a)*d,e[6]=(f-i)*d,e[1]=(l-a)*d,e[4]=s*d+h,e[7]=(u+r)*d,e[2]=(f+i)*d,e[5]=(u-r)*d,e[8]=c*d+h}function tp(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;if(!`${t}`.includes("e"))return+`${Math.round(`${t}e+${e}`)}e-${e}`;const n=`${t}`.split("e");let r="";return+n[1]+e>0&&(r="+"),+`${Math.round(`${+n[0]}e${r}${+n[1]+e}`)}e-${e}`}function O3(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0,0],n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;return e[0]=tp(t[0],n),e[1]=tp(t[1],n),e[2]=tp(t[2],n),e}function hd(t,e,n,r){let i,a,o,s,c,l,f,u,g,d,h,p,m,v,y,T;const C=Kt(e),w=Kt(e),x=(M,A,_)=>{v=M[A],m=M[_],M[A]=v-p*(m+v*d),M[_]=m+p*(v-m*d)};for(PS(e,r),c=0;c<e;c++)C[c]=n[c]=t[c+c*e],w[c]=0;for(i=0;i<a9;i++){for(h=0,c=0;c<e-1;c++)for(s=c+1;s<e;s++)h+=Math.abs(t[c*e+s]);if(h===0)break;for(i<3?f=.2*h/(e*e):f=0,c=0;c<e-1;c++)for(s=c+1;s<e;s++)if(v=100*Math.abs(t[c*e+s]),i>3&&Math.abs(n[c])+v===Math.abs(n[c])&&Math.abs(n[s])+v===Math.abs(n[s]))t[c*e+s]=0;else if(Math.abs(t[c*e+s])>f){for(m=n[s]-n[c],Math.abs(m)+v===Math.abs(m)?g=t[c*e+s]/m:(u=.5*m/t[c*e+s],g=1/(Math.abs(u)+Math.sqrt(1+u*u)),u<0&&(g=-g)),y=1/Math.sqrt(1+g*g),p=g*y,d=p/(1+y),m=g*t[c*e+s],w[c]-=m,w[s]+=m,n[c]-=m,n[s]+=m,t[c*e+s]=0,a=0;a<=c-1;a++)x(t,a*e+c,a*e+s);for(a=c+1;a<=s-1;a++)x(t,c*e+a,a*e+s);for(a=s+1;a<e;a++)x(t,c*e+a,s*e+a);for(a=0;a<e;a++)x(r,a*e+c,a*e+s)}for(c=0;c<e;c++)C[c]+=w[c],n[c]=C[c],w[c]=0}if(i>=a9)return Y0("vtkMath::Jacobi: Error extracting eigenfunctions"),0;for(a=0;a<e-1;a++){for(o=a,T=n[o],i=a+1;i<e;i++)(n[i]>=T||Math.abs(n[i]-T)<R4)&&(o=i,T=n[o]);o!==a&&(n[o]=n[a],n[a]=T,Pf(r,e,a,o))}const O=(e>>1)+(e&1);for(l=0,i=0;i<e*e;i++)r[i]>=0&&l++;if(l<O)for(i=0;i<e;i++)r[i*e+a]*=-1;return 1}function kS(t,e){const n=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];n[0]=t[0]+t[4]+t[8],n[5]=t[0]-t[4]-t[8],n[10]=-t[0]+t[4]-t[8],n[15]=-t[0]-t[4]+t[8],n[1]=n[4]=t[7]-t[5],n[2]=n[8]=t[2]-t[6],n[3]=n[12]=t[3]-t[1],n[6]=n[9]=t[3]+t[1],n[7]=n[13]=t[2]+t[6],n[11]=n[14]=t[7]+t[5];const r=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],i=[0,0,0,0],a=[...n];hd(a,4,i,r),e[0]=r[0],e[1]=r[4],e[2]=r[8],e[3]=r[12]}function dk(t,e,n){const r=t[0]*e[0],i=t[0]*e[1],a=t[0]*e[2],o=t[0]*e[3],s=t[1]*e[0],c=t[1]*e[1],l=t[1]*e[2],f=t[1]*e[3],u=t[2]*e[0],g=t[2]*e[1],d=t[2]*e[2],h=t[2]*e[3],p=t[3]*e[0],m=t[3]*e[1],v=t[3]*e[2],y=t[3]*e[3];n[0]=r-c-d-y,n[1]=i+s+h-v,n[2]=a-f+u+m,n[3]=o+l-g+p}function AS(t,e){for(let g=0;g<9;g++)e[g]=t[g];const n=Kt(3),r=Kt(3);let i;for(let g=0;g<3;g++){const d=Math.abs(e[g*3]),h=Math.abs(e[g*3+1]),p=Math.abs(e[g*3+2]);i=h>d?h:d,i=p>i?p:i,n[g]=1,i!==0&&(n[g]/=i)}const a=Math.abs(e[0])*n[0],o=Math.abs(e[3])*n[1],s=Math.abs(e[6])*n[2];r[0]=0,i=a,o>=i&&(i=o,r[0]=1),s>=i&&(r[0]=2),r[0]!==0&&(Pf(e,3,r[0],0),n[r[0]]=n[0]);const c=Math.abs(e[4])*n[1],l=Math.abs(e[7])*n[2];r[1]=1,i=c,l>=i&&(r[1]=2,Pf(e,3,1,2)),r[2]=2;let f=0;if(u2(e)<0){f=1;for(let g=0;g<9;g++)e[g]=-e[g]}const u=Kt(4);if(kS(e,u),NS(u,e),f)for(let g=0;g<9;g++)e[g]=-e[g];r[1]!==1&&Pf(e,3,r[1],1),r[0]!==0&&Pf(e,3,r[0],0)}function FS(t,e,n){let r,i,a,o,s,c;const l=[...t];if(hd(l,3,e,n),e[0]===e[1]&&e[0]===e[2]){VS(n);return}for(iu(n,n),r=0;r<3;r++)if(e[(r+1)%3]===e[(r+2)%3]){for(c=Math.abs(n[r*3]),o=0,i=1;i<3;i++)c<(s=Math.abs(n[r*3+i]))&&(c=s,o=i);o!==r&&(s=e[o],e[o]=e[r],e[r]=s,ng(n,3,r,o)),n[o*3+o]<0&&(n[o*3]=-n[o*3],n[o*3+1]=-n[o*3+1],n[o*3+2]=-n[o*3+2]),i=(o+1)%3,a=(o+2)%3,n[i*3]=0,n[i*3+1]=0,n[i*3+2]=0,n[i*3+i]=1;const f=yo([n[o*3],n[o*3+1],n[o*3+2]],[n[i*3],n[i*3+1],n[i*3+2]],[]);Z0(f);const u=yo(f,[n[o*3],n[o*3+1],n[o*3+2]],[]);for(let g=0;g<3;g++)n[a*3+g]=f[g],n[i*3+g]=u[g];iu(n,n);return}for(c=Math.abs(n[0]),o=0,r=1;r<3;r++)c<(s=Math.abs(n[r*3]))&&(c=s,o=r);if(o!==0){const f=e[o];e[o]=e[0],e[0]=f,ng(n,3,o,0)}if(Math.abs(n[4])<Math.abs(n[7])){const f=e[2];e[2]=e[1],e[1]=f,ng(n,3,1,2)}for(r=0;r<2;r++)n[r*3+r]<0&&(n[r*3]=-n[r*3],n[r*3+1]=-n[r*3+1],n[r*3+2]=-n[r*3+2]);u2(n)<0&&(n[6]=-n[6],n[7]=-n[7],n[8]=-n[8]),iu(n,n)}function pk(t,e,n,r){let i;const a=[...t],o=u2(a);if(o<0)for(i=0;i<9;i++)a[i]=-a[i];AS(a,e),iu(a,a),E3(a,e,r),FS(r,n,r),E3(e,r,e),iu(r,r),o<0&&(n[0]=-n[0],n[1]=-n[1],n[2]=-n[2])}function _4(t,e,n){let r,i,a,o,s=0,c,l,f;const u=Kt(n);for(r=0;r<n;r++){for(o=0,i=0;i<n;i++)(f=Math.abs(t[r*n+i]))>o&&(o=f);if(o===0)return Y0("Unable to factor linear system"),0;u[r]=1/o}for(i=0;i<n;i++){for(r=0;r<i;r++){for(c=t[r*n+i],a=0;a<r;a++)c-=t[r*n+a]*t[a*n+i];t[r*n+i]=c}for(o=0,r=i;r<n;r++){for(c=t[r*n+i],a=0;a<i;a++)c-=t[r*n+a]*t[a*n+i];t[r*n+i]=c,(l=u[r]*Math.abs(c))>=o&&(o=l,s=r)}if(i!==s){for(a=0;a<n;a++)l=t[s*n+a],t[s*n+a]=t[i*n+a],t[i*n+a]=l;u[s]=u[i]}if(e[i]=s,Math.abs(t[i*n+i])<=R4)return Y0("Unable to factor linear system"),0;if(i!==n-1)for(l=1/t[i*n+i],r=i+1;r<n;r++)t[r*n+i]*=l}return 1}function b4(t,e,n,r){let i,a,o,s,c;for(o=-1,i=0;i<r;i++){if(s=e[i],c=n[s],n[s]=n[i],o>=0)for(a=o;a<=i-1;a++)c-=t[i*r+a]*n[a];else c!==0&&(o=i);n[i]=c}for(i=r-1;i>=0;i--){for(c=n[i],a=i+1;a<r;a++)c-=t[i*r+a]*n[a];n[i]=c/t[i*r+i]}}function US(t,e,n){if(n===2){const i=Kt(2),a=vn(t[0],t[1],t[2],t[3]);return a===0?0:(i[0]=(t[3]*e[0]-t[1]*e[1])/a,i[1]=(-(t[2]*e[0])+t[0]*e[1])/a,e[0]=i[0],e[1]=i[1],1)}if(n===1)return t[0]===0?0:(e[0]/=t[0],1);const r=Kt(n);return _4(t,r,n)===0?0:(b4(t,r,e,n),1)}function BS(t,e,n){let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null,i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:null;const a=r||Kt(n),o=i||Kt(n);if(_4(t,a,n)===0)return null;for(let s=0;s<n;s++){for(let c=0;c<n;c++)o[c]=0;o[s]=1,b4(t,a,o,n);for(let c=0;c<n;c++)e[c*n+s]=o[c]}return e}function hk(t,e){let n=+Number.MAX_VALUE,r=-Number.MAX_VALUE;for(let i=0;i<e;i++)for(let a=i;a<e;a++)Math.abs(t[i*e+a])>r&&(r=Math.abs(t[i*e+a]));for(let i=0;i<e;i++)Math.abs(t[i*e+i])<n&&(n=Math.abs(t[i*e+i]));return n===0?Number.MAX_VALUE:r/n}function mk(t,e,n){return hd(t,3,e,n)}function D3(t,e,n,r){if(t<n)return Y0("Insufficient number of samples. Underdetermined."),0;let i,a,o;const s=Kt(n*n),c=Kt(n),l=Kt(n*n);for(o=0;o<t;o++)for(i=0;i<n;i++)for(a=i;a<n;a++)s[i*n+a]+=e[o*n+i]*e[o*n+a];for(i=0;i<n;i++)for(a=0;a<i;a++)s[i*n+a]=s[a*n+i];for(hd(s,n,c,l),i=0;i<n;i++)r[i]=l[i*n+n-1];return 1}function vk(t,e,n,r,i,a){let o=arguments.length>6&&arguments[6]!==void 0?arguments[6]:!0;if(t<n||t<i)return Y0("Insufficient number of samples. Underdetermined."),0;const s=Kt(i);let c=1,l,f=0,u,g,d,h=0;if(o){for(g=0;g<i;g++)s[g]=1;for(u=0;u<t;u++)for(g=0;g<i;g++)Math.abs(r[u*i+g])>R4&&(c=0,s[g]=0);if(c&&i===1)return Y0("Detected homogeneous system (Y=0), calling SolveHomogeneousLeastSquares()"),D3(t,e,n,a);if(c)h=1;else for(g=0;g<i;g++)s[g]&&(h=1)}h&&(l=Kt(n),f=D3(t,e,n,l));const p=Kt(n*n),m=Kt(n*n),v=Kt(n*i);for(d=0;d<t;d++)for(u=0;u<n;u++){for(g=u;g<n;g++)p[u*n+g]+=e[d*n+u]*e[d*n+g];for(g=0;g<i;g++)v[u*i+g]+=e[d*n+u]*r[d*i+g]}for(u=0;u<n;u++)for(g=0;g<u;g++)p[u*n+g]=p[g*n+u];const y=BS(p,m,n);if(y)for(u=0;u<n;u++)for(g=0;g<i;g++)for(a[u*i+g]=0,d=0;d<n;d++)a[u*i+g]+=m[u*n+d]*v[d*i+g];if(h){for(g=0;g<i;g++)if(s[g])for(u=0;u<n;u++)a[u*i+g]=l[u*i]}return h?f&&y:y}function yk(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,.5,1];switch(t.length){case 3:return e[0]=parseInt(t[0],16)*17/255,e[1]=parseInt(t[1],16)*17/255,e[2]=parseInt(t[2],16)*17/255,e;case 4:return e[0]=parseInt(t[1],16)*17/255,e[1]=parseInt(t[2],16)*17/255,e[2]=parseInt(t[3],16)*17/255,e;case 6:return e[0]=parseInt(t.substr(0,2),16)/255,e[1]=parseInt(t.substr(2,2),16)/255,e[2]=parseInt(t.substr(4,2),16)/255,e;case 7:return e[0]=parseInt(t.substr(1,2),16)/255,e[1]=parseInt(t.substr(3,2),16)/255,e[2]=parseInt(t.substr(5,2),16)/255,e;case 9:return e[0]=parseInt(t.substr(1,2),16)/255,e[1]=parseInt(t.substr(3,2),16)/255,e[2]=parseInt(t.substr(5,2),16)/255,e[3]=parseInt(t.substr(7,2),16)/255,e;default:return e}}function Af(t,e){let n,r;const[i,a,o]=t,s=1/3,c=1/6,l=2/3;let f=i,u=i;a>f?f=a:a<u&&(u=a),o>f?f=o:o<u&&(u=o);const g=f;g>0?r=(f-u)/f:r=0,r>0?(i===f?n=c*(a-o)/(f-u):a===f?n=s+c*(o-i)/(f-u):n=l+c*(i-a)/(f-u),n<0&&(n+=1)):n=0,e[0]=n,e[1]=r,e[2]=g}function O0(t,e){const[n,r,i]=t,a=1/3,o=1/6,s=2/3,c=5/6;let l,f,u;n>o&&n<=a?(f=1,l=(a-n)/o,u=0):n>a&&n<=.5?(f=1,u=(n-a)/o,l=0):n>.5&&n<=s?(u=1,f=(s-n)/o,l=0):n>s&&n<=c?(u=1,l=(n-s)/o,f=0):n>c&&n<=1?(l=1,u=(1-n)/o,f=0):(l=1,f=n/o,u=0),l=r*l+(1-r),f=r*f+(1-r),u=r*u+(1-r),l*=i,f*=i,u*=i,e[0]=l,e[1]=f,e[2]=u}function GS(t,e){const[n,r,i]=t;let a=(n+16)/116,o=r/500+a,s=a-i/200;a**3>.008856?a**=3:a=(a-16/116)/7.787,o**3>.008856?o**=3:o=(o-16/116)/7.787,s**3>.008856?s**=3:s=(s-16/116)/7.787;const c=.9505,l=1,f=1.089;e[0]=c*o,e[1]=l*a,e[2]=f*s}function $S(t,e){const[n,r,i]=t,a=.9505,o=1,s=1.089;let c=n/a,l=r/o,f=i/s;c>.008856?c**=1/3:c=7.787*c+16/116,l>.008856?l**=1/3:l=7.787*l+16/116,f>.008856?f**=1/3:f=7.787*f+16/116,e[0]=116*l-16,e[1]=500*(c-l),e[2]=200*(l-f)}function WS(t,e){const[n,r,i]=t;let a=n*3.2406+r*-1.5372+i*-.4986,o=n*-.9689+r*1.8758+i*.0415,s=n*.0557+r*-.204+i*1.057;a>.0031308?a=1.055*a**(1/2.4)-.055:a*=12.92,o>.0031308?o=1.055*o**(1/2.4)-.055:o*=12.92,s>.0031308?s=1.055*s**(1/2.4)-.055:s*=12.92;let c=a;c<o&&(c=o),c<s&&(c=s),c>1&&(a/=c,o/=c,s/=c),a<0&&(a=0),o<0&&(o=0),s<0&&(s=0),e[0]=a,e[1]=o,e[2]=s}function zS(t,e){let[n,r,i]=t;n>.04045?n=((n+.055)/1.055)**2.4:n/=12.92,r>.04045?r=((r+.055)/1.055)**2.4:r/=12.92,i>.04045?i=((i+.055)/1.055)**2.4:i/=12.92,e[0]=n*.4124+r*.3576+i*.1805,e[1]=n*.2126+r*.7152+i*.0722,e[2]=n*.0193+r*.1192+i*.9505}function I0(t,e){const n=[0,0,0];zS(t,n),$S(n,e)}function nh(t,e){const n=[0,0,0];GS(t,n),WS(n,e)}function Xu(t){return t[0]=1,t[1]=-1,t[2]=1,t[3]=-1,t[4]=1,t[5]=-1,t}function np(t){return!(t[1]-t[0]<0)}function Tk(t,e,n){return n[0]=Math.min(t[0],e[0]),n[1]=Math.max(t[0],e[0]),n[2]=Math.min(t[1],e[1]),n[3]=Math.max(t[1],e[1]),n[4]=Math.min(t[2],e[2]),n[5]=Math.max(t[2],e[2]),n}function Ua(t,e,n){return t<e?e:t>n?n:t}function R3(t,e,n){let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:[0,0,0];return r[0]=Ua(t[0],e[0],n[0]),r[1]=Ua(t[1],e[1],n[1]),r[2]=Ua(t[2],e[2],n[2]),r}function Ck(t,e){let n=0;return e[0]!==e[1]&&(t<e[0]?n=e[0]:t>e[1]?n=e[1]:n=t,n=(n-e[0])/(e[1]-e[0])),n}const wk=dd("GetScalarTypeFittingRange"),xk=dd("GetAdjustedScalarRange");function Sk(t,e){if(!t||!e)return 0;for(let n=0;n<6;n+=2)if(t[n]<e[n]||t[n]>e[n+1]||t[n+1]<e[n]||t[n+1]>e[n+1])return 0;return 1}function Ek(t,e,n){if(!t||!e)return 0;for(let r=0;r<6;r+=2)if(t[r]+n[r/2]<e[r]||t[r]-n[r/2]>e[r+1]||t[r+1]+n[r/2]<e[r]||t[r+1]-n[r/2]>e[r+1])return 0;return 1}function Ok(t,e,n){if(!t||!e||!n)return 0;for(let r=0;r<3;r++)if(t[r]+n[r]<e[2*r]||t[r]-n[r]>e[2*r+1])return 0;return 1}function Dk(t,e,n,r){const i=Kt(3),a=Kt(3),o=Kt(3),s=Kt(3),c=Kt(3),l=Kt(3);for(let C=0;C<3;++C)i[C]=t[C]-e[C],a[C]=e[C]-n[C],o[C]=n[C]-t[C],s[C]=-i[C],c[C]=-a[C],l[C]=-o[C];const f=cc(s),u=cc(c),g=cc(o),d=Kt(3);yo(i,a,d);const h=cc(d),p=f*u*g/(2*h),m=2*h*h,v=u*u*ct(i,l)/m,y=g*g*ct(s,a)/m,T=f*f*ct(o,c)/m;for(let C=0;C<3;++C)r[C]=v*t[C]+y*e[C]+T*n[C];return p}const Rk=1/0,Mk=-1/0,jS=t=>!Number.isFinite(t),{isFinite:_k,isNaN:M3}=Number,rh=M3;function Oc(){return[].concat([Number.MAX_VALUE,-Number.MAX_VALUE,Number.MAX_VALUE,-Number.MAX_VALUE,Number.MAX_VALUE,-Number.MAX_VALUE])}function bk(t){let e=-1,n=-1;for(let r=0;r<t.length;r++){const i=Math.abs(t[r]);i>e&&(n=r,e=i)}return n}function HS(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:3;const n=new Array(e),r=new Array(e);for(let a=0;a<e;++a)n[a]=a,r[a]=a;for(let a=e-1;a>0;a--){let o=-1/0,s=0,c=0;for(let l=0;l<=a;++l){const f=n[l];for(let u=0;u<=a;++u){const g=r[u],d=Math.abs(t[f+e*g]);d>o&&(o=d,s=l,c=u)}}[n[a],n[s]]=[n[s],n[a]],[r[a],r[c]]=[r[c],r[a]]}const i=new Array(e*e).fill(0);for(let a=0;a<e;++a){const o=n[a]+e*r[a];i[o]=t[o]<0?-1:1}return i}function KS(t){const e=Math.floor(t*255);return e>15?e.toString(16):`0${e.toString(16)}`}function Lk(t){return`${arguments.length>1&&arguments[1]!==void 0?arguments[1]:"#"}${t.map(KS).join("")}`}function Xd(t){return Math.round(t*255)}function Ik(t){return t.length===3?`rgb(${t.map(Xd).join(", ")})`:`rgba(${Xd(t[0]||0)}, ${Xd(t[1]||0)}, ${Xd(t[2]||0)}, ${t[3]||0})`}var fa={Pi:PN,ldexp:NN,radiansFromDegrees:hn,degreesFromRadians:eh,round:Nf,floor:M4,ceil:kN,ceilLog2:$N,min:AN,max:FN,arrayMin:UN,arrayMax:BN,arrayRange:GN,isPowerOfTwo:kf,nearestPowerOfTwo:ua,factorial:WN,binomial:zN,beginCombination:jN,nextCombination:HN,randomSeed:KN,getSeed:qN,random:XN,gaussian:YN,add:th,subtract:is,multiplyScalar:MS,multiplyScalar2D:_S,multiplyAccumulate:x3,multiplyAccumulate2D:ZN,dot:ct,outer:QN,cross:yo,norm:cc,normalize:Z0,perpendiculars:JN,projectVector:ek,projectVector2D:tk,distance2BetweenPoints:oo,angleBetweenVectors:nk,gaussianAmplitude:rk,gaussianWeight:ik,dot2D:S3,outer2D:ak,norm2D:bS,normalize2D:LS,determinant2x2:vn,LUFactor3x3:ok,LUSolve3x3:sk,linearSolve3x3:ck,multiply3x3_vect3:ep,multiply3x3_mat3:E3,multiplyMatrix:lk,transpose3x3:iu,invert3x3:uk,identity3x3:VS,identity:PS,isIdentity:fk,isIdentity3x3:gk,determinant3x3:u2,quaternionToMatrix3x3:NS,areEquals:IS,areMatricesEqual:pd,roundNumber:tp,roundVector:O3,matrix3x3ToQuaternion:kS,multiplyQuaternion:dk,orthogonalize3x3:AS,diagonalize3x3:FS,singularValueDecomposition3x3:pk,solveLinearSystem:US,invertMatrix:BS,luFactorLinearSystem:_4,luSolveLinearSystem:b4,estimateMatrixCondition:hk,jacobi:mk,jacobiN:hd,solveHomogeneousLeastSquares:D3,solveLeastSquares:vk,hex2float:yk,rgb2hsv:Af,hsv2rgb:O0,lab2xyz:GS,xyz2lab:$S,xyz2rgb:WS,rgb2xyz:zS,rgb2lab:I0,lab2rgb:nh,uninitializeBounds:Xu,areBoundsInitialized:np,computeBoundsFromPoints:Tk,clampValue:Ua,clampVector:R3,clampAndNormalizeValue:Ck,getScalarTypeFittingRange:wk,getAdjustedScalarRange:xk,extentIsWithinOtherExtent:Sk,boundsIsWithinOtherBounds:Ek,pointIsWithinBounds:Ok,solve3PointCircle:Dk,inf:Rk,negInf:Mk,isInf:jS,isNan:M3,isNaN:M3,isFinite:_k,createUninitializedBounds:Oc,getMajorAxisIndex:bk,getSparseOrthogonalMatrix:HS,floatToHex2:KS,floatRGB2HexCode:Lk,float2CssRGBA:Ik};const{vtkErrorMacro:Vk}=Ir,{DefaultDataType:Pk}=TS,Nk=1e-6;function _3(t,e,n){const r=t.length;let i=Number.MAX_VALUE,a=-Number.MAX_VALUE,o,s;for(s=e;s<r;s+=n)if(!Number.isNaN(t[s])){i=t[s],a=i;break}for(;s<r;s+=n)o=t[s],o<i?i=o:o>a&&(a=o);return{min:i,max:a}}function kk(){let t=Number.MAX_VALUE,e=-Number.MAX_VALUE,n=0,r=0;return{add(i){t>i&&(t=i),e<i&&(e=i),n++,r+=i},get(){return{min:t,max:e,count:n,sum:r,mean:r/n}},getRange(){return{min:t,max:e}}}}function qS(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1;if(e<0&&n>1){const i=t.length/n,a=new Float64Array(i);for(let o=0,s=0;o<i;++o){for(let c=s+n;s<c;++s)a[o]+=t[s]*t[s];a[o]**=.5}return _3(a,0,1)}return _3(t,e<0?0:e,n)}function o9(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;const n=t||[];for(;n.length<=e;)n.push(null);return n}function L4(t){return Object.prototype.toString.call(t).slice(8,-1)}function Ak(t){const e=t.getNumberOfComponents();let n=0;const r=new Array(e);for(let i=0;i<t.getNumberOfTuples();++i){t.getTuple(i,r);const a=cc(r,e);a>n&&(n=a)}return n}const Fk={computeRange:qS,createRangeHelper:kk,fastComputeRange:_3,getDataType:L4,getMaxNorm:Ak};function Uk(t,e){e.classHierarchy.push("vtkDataArray");function n(r){if(r<0)return!1;const i=t.getNumberOfComponents(),a=e.values.length/(i>0?i:1);if(r===a)return!0;if(r>a){const o=e.values;return e.values=Ku(e.dataType,(r+a)*i),e.values.set(o),!0}return e.size>r*i&&(e.size=r*i,t.dataChange()),!0}t.dataChange=()=>{e.ranges=null,t.modified()},t.resize=r=>{n(r);const i=r*t.getNumberOfComponents();return e.size!==i?(e.size=i,t.dataChange(),!0):!1},t.initialize=()=>{t.resize(0)},t.getElementComponentSize=()=>e.values.BYTES_PER_ELEMENT,t.getComponent=function(r){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return e.values[r*e.numberOfComponents+i]},t.setComponent=(r,i,a)=>{a!==e.values[r*e.numberOfComponents+i]&&(e.values[r*e.numberOfComponents+i]=a,t.dataChange())},t.getValue=r=>{const i=r/e.numberOfComponents,a=r%e.numberOfComponents;return t.getComponent(i,a)},t.setValue=(r,i)=>{const a=r/e.numberOfComponents,o=r%e.numberOfComponents;t.setComponent(a,o,i)},t.getData=()=>e.size===e.values.length?e.values:e.values.subarray(0,e.size),t.getRange=function(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:-1,i=r;i<0&&(i=e.numberOfComponents===1?0:e.numberOfComponents);let a=null;return e.ranges||(e.ranges=o9(e.ranges,e.numberOfComponents)),a=e.ranges[i],a?(e.rangeTuple[0]=a.min,e.rangeTuple[1]=a.max,e.rangeTuple):(a=qS(t.getData(),r,e.numberOfComponents),e.ranges[i]=a,e.rangeTuple[0]=a.min,e.rangeTuple[1]=a.max,e.rangeTuple)},t.setRange=(r,i)=>{e.ranges||(e.ranges=o9(e.ranges,e.numberOfComponents));const a={min:r.min,max:r.max};return e.ranges[i]=a,e.rangeTuple[0]=a.min,e.rangeTuple[1]=a.max,e.rangeTuple},t.setTuple=(r,i)=>{const a=r*e.numberOfComponents;for(let o=0;o<e.numberOfComponents;o++)e.values[a+o]=i[o]},t.setTuples=(r,i)=>{let a=r*e.numberOfComponents;const o=Math.min(i.length,e.size-a);for(let s=0;s<o;)e.values[a++]=i[s++]},t.insertTuple=(r,i)=>(e.size<=r*e.numberOfComponents&&(e.size=(r+1)*e.numberOfComponents,n(r+1)),t.setTuple(r,i),r),t.insertTuples=(r,i)=>{const a=r+i.length/e.numberOfComponents;return e.size<a*e.numberOfComponents&&(e.size=a*e.numberOfComponents,n(a)),t.setTuples(r,i),a},t.insertNextTuple=r=>{const i=e.size/e.numberOfComponents;return t.insertTuple(i,r)},t.insertNextTuples=r=>{const i=e.size/e.numberOfComponents;return t.insertTuples(i,r)},t.findTuple=function(r){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Nk;for(let a=0;a<e.size;a+=e.numberOfComponents)if(Math.abs(r[0]-e.values[a])<=i){let o=!0;for(let s=1;s<e.numberOfComponents;++s)if(Math.abs(r[s]-e.values[a+s])>i){o=!1;break}if(o)return a/e.numberOfComponents}return-1},t.getTuple=function(r){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];const a=e.numberOfComponents||1,o=r*a;switch(a){case 4:i[3]=e.values[o+3];case 3:i[2]=e.values[o+2];case 2:i[1]=e.values[o+1];case 1:i[0]=e.values[o];break;default:for(let s=a-1;s>=0;--s)i[s]=e.values[o+s]}return i},t.getTuples=(r,i)=>{const a=(r??0)*e.numberOfComponents,o=(i??t.getNumberOfTuples())*e.numberOfComponents,s=t.getData().subarray(a,o);return s.length>0?s:null},t.getTupleLocation=function(){return(arguments.length>0&&arguments[0]!==void 0?arguments[0]:1)*e.numberOfComponents},t.getNumberOfComponents=()=>e.numberOfComponents,t.getNumberOfValues=()=>e.size,t.getNumberOfTuples=()=>e.size/e.numberOfComponents,t.getDataType=()=>e.dataType,t.newClone=()=>YS({empty:!0,name:e.name,dataType:e.dataType,numberOfComponents:e.numberOfComponents}),t.getName=()=>(e.name||(t.modified(),e.name=`vtkDataArray${t.getMTime()}`),e.name),t.setData=(r,i)=>{e.values=r,e.size=r.length,e.dataType=L4(r),i&&(e.numberOfComponents=i),e.size%e.numberOfComponents!==0&&(e.numberOfComponents=1),t.dataChange()},t.getState=()=>{if(e.deleted)return null;const r={...e,vtkClass:t.getClassName()};r.values=Array.from(r.values),delete r.buffer,Object.keys(r).forEach(a=>{r[a]||delete r[a]});const i={};return Object.keys(r).sort().forEach(a=>{i[a]=r[a]}),i.mtime&&delete i.mtime,i},t.deepCopy=r=>{const i=t.getDataType(),a=e.values;t.shallowCopy(r),(a==null?void 0:a.length)>=r.getNumberOfValues()&&i===r.getDataType()?(a.set(r.getData()),e.values=a,t.dataChange()):t.setData(r.getData().slice())},t.interpolateTuple=(r,i,a,o,s,c)=>{const l=e.numberOfComponents||1;(l!==i.getNumberOfComponents()||l!==o.getNumberOfComponents())&&Vk("numberOfComponents must match");const f=i.getTuple(a),u=o.getTuple(s),g=[];switch(g.length=l,l){case 4:g[3]=f[3]+(u[3]-f[3])*c;case 3:g[2]=f[2]+(u[2]-f[2])*c;case 2:g[1]=f[1]+(u[1]-f[1])*c;case 1:g[0]=f[0]+(u[0]-f[0])*c;break;default:for(let d=0;d<l;d++)g[d]=f[d]+(u[d]-f[d])*c}return t.insertTuple(r,g)}}const Bk={name:"",numberOfComponents:1,dataType:Pk,rangeTuple:[0,0]};function XS(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(Object.assign(e,Bk,n),Array.isArray(n.values)&&n.dataType===void 0&&console.warn("vtkDataArray.newInstance: no dataType provided, converting to Float32Array"),!e.empty&&!e.values&&!e.size)throw new TypeError("Cannot create vtkDataArray object without: size > 0, values");if(e.values?Array.isArray(e.values)&&(e.values=c2(e.dataType,e.values)):e.values=Ku(e.dataType,e.size),e.values&&(e.size=e.size??e.values.length,e.dataType=L4(e.values)),zt(t,e),ud(t,e,["name","numberOfComponents"]),e.size%e.numberOfComponents!==0)throw new RangeError("model.size is not a multiple of model.numberOfComponents");Uk(t,e)}const YS=Rt(XS,"vtkDataArray");var nt={newInstance:YS,extend:XS,...Fk,...TS};const{vtkErrorMacro:Gk}=P,$k=["Build","Render"];function Wk(t,e){e.classHierarchy.push("vtkViewNode"),t.build=r=>{},t.render=r=>{},t.traverse=r=>{const i=r.getTraverseOperation(),a=t[i];if(a){a(r);return}t.apply(r,!0);for(let o=0;o<e.children.length;o++)e.children[o].traverse(r);t.apply(r,!1)},t.apply=(r,i)=>{const a=t[r.getOperation()];a&&a(i,r)},t.getViewNodeFor=r=>{if(e.renderable===r)return t;for(let i=0;i<e.children.length;++i){const o=e.children[i].getViewNodeFor(r);if(o)return o}},t.getFirstAncestorOfType=r=>e._parent?e._parent.isA(r)?e._parent:e._parent.getFirstAncestorOfType(r):null,t.getLastAncestorOfType=r=>{if(!e._parent)return null;const i=e._parent.getLastAncestorOfType(r);return i||(e._parent.isA(r)?e._parent:null)},t.addMissingNode=r=>{if(!r)return;const i=e._renderableChildMap.get(r);if(i!==void 0)return i.setVisited(!0),i;const a=t.createViewNode(r);if(a)return a.setParent(t),a.setVisited(!0),e._renderableChildMap.set(r,a),e.children.push(a),a},t.addMissingNodes=r=>{if(!(!r||!r.length))for(let i=0;i<r.length;++i){const a=r[i];t.addMissingNode(a)}},t.addMissingChildren=r=>{if(!(!r||!r.length))for(let i=0;i<r.length;++i){const a=r[i];if(e.children.indexOf(a)===-1){a.setParent(t),e.children.push(a);const s=a.getRenderable();s&&e._renderableChildMap.set(s,a)}a.setVisited(!0)}},t.removeNode=r=>{const i=e.children.findIndex(o=>o===r);if(i<0)return!1;const a=r.getRenderable();return a&&e._renderableChildMap.delete(a),r.delete(),e.children.splice(i,1),!0},t.prepareNodes=()=>{for(let r=0;r<e.children.length;++r)e.children[r].setVisited(!1)},t.setVisited=r=>{e.visited=r},t.removeUnusedNodes=()=>{let r=0;for(let i=0;i<e.children.length;++i){const a=e.children[i];if(a.getVisited())e.children[r++]=a,a.setVisited(!1);else{const s=a.getRenderable();s&&e._renderableChildMap.delete(s),a.delete()}}e.children.length=r},t.createViewNode=r=>{if(!e.myFactory)return Gk("Cannot create view nodes without my own factory"),null;const i=e.myFactory.createNode(r);return i&&i.setRenderable(r),i};const n=t.delete;t.delete=()=>{for(let r=0;r<e.children.length;r++)e.children[r].delete();n()}}const zk={renderable:null,myFactory:null,children:[],visited:!1};function ZS(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,zk,n),P.obj(t,e),P.event(t,e,"event"),e._renderableChildMap=new Map,P.get(t,e,["visited"]),P.setGet(t,e,["_parent","renderable","myFactory"]),P.getArray(t,e,["children"]),P.moveToProtected(t,e,["parent"]),Wk(t,e)}const jk=P.newInstance(ZS,"vtkViewNode");var Bt={newInstance:jk,extend:ZS,PASS_TYPES:$k};function Hk(t,e){e.overrides||(e.overrides={}),e.classHierarchy.push("vtkViewNodeFactory"),t.createNode=n=>{if(n.isDeleted())return null;let r=0,i=n.getClassName(r++),a=!1;const o=Object.keys(e.overrides);for(;i&&!a;)o.indexOf(i)!==-1?a=!0:i=n.getClassName(r++);if(!a)return null;const s=e.overrides[i]();return s.setMyFactory(t),s}}const Kk={};function QS(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Kk,n),P.obj(t,e),Hk(t,e)}const qk=P.newInstance(QS,"vtkViewNodeFactory");var I4={newInstance:qk,extend:QS};const JS=Object.create(null);function Wn(t,e){JS[t]=e}function Xk(t,e){e.classHierarchy.push("vtkOpenGLViewNodeFactory")}const Yk={};function eE(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Yk,n),e.overrides=JS,I4.extend(t,e,n),Xk(t,e)}const Zk=P.newInstance(eE,"vtkOpenGLViewNodeFactory");var Qk={newInstance:Zk,extend:eE};function Jk(){try{const r=new Int16Array([0,32767]),i=[1,1],a=document.createElement("canvas");a.width=4,a.height=4;const o=a.getContext("webgl2");if(!o)return!1;const s=o.getExtension("EXT_texture_norm16");if(!s)return!1;const c=`#version 300 es
    void main() {
      gl_PointSize = ${4 .toFixed(1)};
      gl_Position = vec4(0, 0, 0, 1);
    }
  `,l=`#version 300 es
    precision highp float;
    precision highp int;
    precision highp sampler2D;

    uniform sampler2D u_image;

    out vec4 color;

    void main() {
        vec4 intColor = texture(u_image, gl_PointCoord.xy);
        color = vec4(vec3(intColor.rrr), 1);
    }
    `,f=o.createShader(o.VERTEX_SHADER);if(o.shaderSource(f,c),o.compileShader(f),!o.getShaderParameter(f,o.COMPILE_STATUS))return!1;const u=o.createShader(o.FRAGMENT_SHADER);if(o.shaderSource(u,l),o.compileShader(u),!o.getShaderParameter(u,o.COMPILE_STATUS))return!1;const g=o.createProgram();if(o.attachShader(g,f),o.attachShader(g,u),o.linkProgram(g),!o.getProgramParameter(g,o.LINK_STATUS))return!1;const d=o.createTexture();o.bindTexture(o.TEXTURE_2D,d),o.texImage2D(o.TEXTURE_2D,0,s.R16_SNORM_EXT,2,1,0,o.RED,o.SHORT,r),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MAG_FILTER,o.LINEAR),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MIN_FILTER,o.LINEAR),o.useProgram(g),o.drawArrays(o.POINTS,0,1);const h=new Uint8Array(4);o.readPixels(i[0],i[1],1,1,o.RGBA,o.UNSIGNED_BYTE,h);const[p,m,v]=h,y=o.getExtension("WEBGL_lose_context");return y&&y.loseContext(),p===m&&m===v&&p!==0}catch{return!1}}let D5;function eA(){return D5===void 0&&(D5=Jk()),D5}const{Wrap:Xo,Filter:nr}=SS,{VtkDataTypes:Mt}=nt,{vtkDebugMacro:R5,vtkErrorMacro:Tl,vtkWarningMacro:s9}=Ir,{toHalf:tA}=E0;function nA(t,e){e.classHierarchy.push("vtkOpenGLTexture"),t.render=function(){let l=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;if(l?e._openGLRenderWindow=l:(e._openGLRenderer=t.getFirstAncestorOfType("vtkOpenGLRenderer"),e._openGLRenderWindow=e._openGLRenderer.getLastAncestorOfType("vtkOpenGLRenderWindow")),e.context=e._openGLRenderWindow.getContext(),e.renderable.getInterpolate()?(e.generateMipmap?t.setMinificationFilter(nr.LINEAR_MIPMAP_LINEAR):t.setMinificationFilter(nr.LINEAR),t.setMagnificationFilter(nr.LINEAR)):(t.setMinificationFilter(nr.NEAREST),t.setMagnificationFilter(nr.NEAREST)),e.renderable.getRepeat()&&(t.setWrapR(Xo.REPEAT),t.setWrapS(Xo.REPEAT),t.setWrapT(Xo.REPEAT)),e.renderable.getInputData()&&e.renderable.setImage(null),!e.handle||e.renderable.getMTime()>e.textureBuildTime.getMTime()){if(e.renderable.getImage()!==null&&(e.renderable.getInterpolate()&&(e.generateMipmap=!0,t.setMinificationFilter(nr.LINEAR_MIPMAP_LINEAR)),e.renderable.getImage()&&e.renderable.getImageLoaded()&&(t.create2DFromImage(e.renderable.getImage()),t.activate(),t.sendParameters(),e.textureBuildTime.modified())),e.renderable.getCanvas()!==null){e.renderable.getInterpolate()&&(e.generateMipmap=!0,t.setMinificationFilter(nr.LINEAR_MIPMAP_LINEAR));const u=e.renderable.getCanvas();t.create2DFromRaw(u.width,u.height,4,Mt.UNSIGNED_CHAR,u,!0),t.activate(),t.sendParameters(),e.textureBuildTime.modified()}if(e.renderable.getJsImageData()!==null){const u=e.renderable.getJsImageData();e.renderable.getInterpolate()&&(e.generateMipmap=!0,t.setMinificationFilter(nr.LINEAR_MIPMAP_LINEAR)),t.create2DFromRaw(u.width,u.height,4,Mt.UNSIGNED_CHAR,u.data,!0),t.activate(),t.sendParameters(),e.textureBuildTime.modified()}const f=e.renderable.getInputData(0);if(f&&f.getPointData().getScalars()){const u=f.getExtent(),g=f.getPointData().getScalars(),d=[];for(let h=0;h<e.renderable.getNumberOfInputPorts();++h){const p=e.renderable.getInputData(h),m=p?p.getPointData().getScalars().getData():null;m&&d.push(m)}e.renderable.getInterpolate()&&g.getNumberOfComponents()===4&&(e.generateMipmap=!0,t.setMinificationFilter(nr.LINEAR_MIPMAP_LINEAR)),d.length%6===0?t.createCubeFromRaw(u[1]-u[0]+1,u[3]-u[2]+1,g.getNumberOfComponents(),g.getDataType(),d):t.create2DFromRaw(u[1]-u[0]+1,u[3]-u[2]+1,g.getNumberOfComponents(),g.getDataType(),g.getData()),t.activate(),t.sendParameters(),e.textureBuildTime.modified()}}e.handle&&t.activate()};const n=()=>{if(!((e.minificationFilter===nr.LINEAR||e.magnificationFilter===nr.LINEAR)&&!eA()))return e.oglNorm16Ext};t.destroyTexture=()=>{t.deactivate(),e.context&&e.handle&&e.context.deleteTexture(e.handle),e.handle=0,e.numberOfDimensions=0,e.target=0,e.components=0,e.width=0,e.height=0,e.depth=0,t.resetFormatAndType()},t.createTexture=()=>{e.handle||(e.handle=e.context.createTexture(),e.target&&(e.context.bindTexture(e.target,e.handle),e.context.texParameteri(e.target,e.context.TEXTURE_MIN_FILTER,t.getOpenGLFilterMode(e.minificationFilter)),e.context.texParameteri(e.target,e.context.TEXTURE_MAG_FILTER,t.getOpenGLFilterMode(e.magnificationFilter)),e.context.texParameteri(e.target,e.context.TEXTURE_WRAP_S,t.getOpenGLWrapMode(e.wrapS)),e.context.texParameteri(e.target,e.context.TEXTURE_WRAP_T,t.getOpenGLWrapMode(e.wrapT)),e._openGLRenderWindow.getWebgl2()&&e.context.texParameteri(e.target,e.context.TEXTURE_WRAP_R,t.getOpenGLWrapMode(e.wrapR)),e.context.bindTexture(e.target,null)))},t.getTextureUnit=()=>e._openGLRenderWindow?e._openGLRenderWindow.getTextureUnitForTexture(t):-1,t.activate=()=>{e._openGLRenderWindow.activateTexture(t),t.bind()},t.deactivate=()=>{e._openGLRenderWindow&&e._openGLRenderWindow.deactivateTexture(t)},t.releaseGraphicsResources=l=>{l&&e.handle&&(l.activateTexture(t),l.deactivateTexture(t),e.context.deleteTexture(e.handle),e.handle=0,e.numberOfDimensions=0,e.target=0,e.internalFormat=0,e.format=0,e.openGLDataType=0,e.components=0,e.width=0,e.height=0,e.depth=0,e.allocatedGPUMemoryInBytes=0),e.shaderProgram&&(e.shaderProgram.releaseGraphicsResources(l),e.shaderProgram=null)},t.bind=()=>{e.context.bindTexture(e.target,e.handle),e.autoParameters&&t.getMTime()>e.sendParametersTime.getMTime()&&t.sendParameters()},t.isBound=()=>{let l=!1;if(e.context&&e.handle){let f=0;switch(e.target){case e.context.TEXTURE_2D:f=e.context.TEXTURE_BINDING_2D;break;default:s9("impossible case");break}l=e.context.getIntegerv(f)===e.handle}return l},t.sendParameters=()=>{e.context.texParameteri(e.target,e.context.TEXTURE_WRAP_S,t.getOpenGLWrapMode(e.wrapS)),e.context.texParameteri(e.target,e.context.TEXTURE_WRAP_T,t.getOpenGLWrapMode(e.wrapT)),e._openGLRenderWindow.getWebgl2()&&e.context.texParameteri(e.target,e.context.TEXTURE_WRAP_R,t.getOpenGLWrapMode(e.wrapR)),e.context.texParameteri(e.target,e.context.TEXTURE_MIN_FILTER,t.getOpenGLFilterMode(e.minificationFilter)),e.context.texParameteri(e.target,e.context.TEXTURE_MAG_FILTER,t.getOpenGLFilterMode(e.magnificationFilter)),e._openGLRenderWindow.getWebgl2()&&(e.context.texParameteri(e.target,e.context.TEXTURE_BASE_LEVEL,e.baseLevel),e.context.texParameteri(e.target,e.context.TEXTURE_MAX_LEVEL,e.maxLevel)),e.sendParametersTime.modified()},t.getInternalFormat=(l,f)=>(e._forceInternalFormat||(e.internalFormat=t.getDefaultInternalFormat(l,f)),e.internalFormat||R5(`Unable to find suitable internal format for T=${l} NC= ${f}`),[e.context.R32F,e.context.RG32F,e.context.RGB32F,e.context.RGBA32F].includes(e.internalFormat)&&!e.context.getExtension("OES_texture_float_linear")&&s9("Failed to load OES_texture_float_linear. Texture filtering is not available for *32F internal formats."),e.internalFormat),t.getDefaultInternalFormat=(l,f)=>{let u=0;return u=e._openGLRenderWindow.getDefaultTextureInternalFormat(l,f,n(),t.useHalfFloat()),u||(u||(R5("Unsupported internal texture type!"),R5(`Unable to find suitable internal format for T=${l} NC= ${f}`)),u)},t.useHalfFloat=()=>e.enableUseHalfFloat&&e.canUseHalfFloat,t.setInternalFormat=l=>{e._forceInternalFormat=!0,l!==e.internalFormat&&(e.internalFormat=l,t.modified())},t.getFormat=(l,f)=>(e.format=t.getDefaultFormat(l,f),e.format),t.getDefaultFormat=(l,f)=>{if(e._openGLRenderWindow.getWebgl2())switch(f){case 1:return e.context.RED;case 2:return e.context.RG;case 3:return e.context.RGB;case 4:return e.context.RGBA;default:return e.context.RGB}else switch(f){case 1:return e.context.LUMINANCE;case 2:return e.context.LUMINANCE_ALPHA;case 3:return e.context.RGB;case 4:return e.context.RGBA;default:return e.context.RGB}},t.resetFormatAndType=()=>{e.format=0,e.internalFormat=0,e._forceInternalFormat=!1,e.openGLDataType=0},t.getDefaultDataType=l=>{const f=t.useHalfFloat();if(e._openGLRenderWindow.getWebgl2())switch(l){case Mt.UNSIGNED_CHAR:return e.context.UNSIGNED_BYTE;case(n()&&!f&&Mt.SHORT):return e.context.SHORT;case(n()&&!f&&Mt.UNSIGNED_SHORT):return e.context.UNSIGNED_SHORT;case(f&&Mt.SHORT):return e.context.HALF_FLOAT;case(f&&Mt.UNSIGNED_SHORT):return e.context.HALF_FLOAT;case Mt.FLOAT:case Mt.VOID:default:return e.context.FLOAT}switch(l){case Mt.UNSIGNED_CHAR:return e.context.UNSIGNED_BYTE;case Mt.FLOAT:case Mt.VOID:default:if(e.context.getExtension("OES_texture_float")&&e.context.getExtension("OES_texture_float_linear"))return e.context.FLOAT;{const u=e.context.getExtension("OES_texture_half_float");if(u&&e.context.getExtension("OES_texture_half_float_linear"))return u.HALF_FLOAT_OES}return e.context.UNSIGNED_BYTE}},t.getOpenGLDataType=function(l){let f=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;return(!e.openGLDataType||f)&&(e.openGLDataType=t.getDefaultDataType(l)),e.openGLDataType},t.getShiftAndScale=()=>{let l=0,f=1;switch(e.openGLDataType){case e.context.BYTE:f=127.5,l=f-128;break;case e.context.UNSIGNED_BYTE:f=255,l=0;break;case e.context.SHORT:f=32767.5,l=f-32768;break;case e.context.UNSIGNED_SHORT:f=65536,l=0;break;case e.context.INT:f=21474836475e-1,l=f-2147483648;break;case e.context.UNSIGNED_INT:f=4294967295,l=0;break;case e.context.FLOAT:}return{shift:l,scale:f}},t.getOpenGLFilterMode=l=>{switch(l){case nr.NEAREST:return e.context.NEAREST;case nr.LINEAR:return e.context.LINEAR;case nr.NEAREST_MIPMAP_NEAREST:return e.context.NEAREST_MIPMAP_NEAREST;case nr.NEAREST_MIPMAP_LINEAR:return e.context.NEAREST_MIPMAP_LINEAR;case nr.LINEAR_MIPMAP_NEAREST:return e.context.LINEAR_MIPMAP_NEAREST;case nr.LINEAR_MIPMAP_LINEAR:return e.context.LINEAR_MIPMAP_LINEAR;default:return e.context.NEAREST}},t.getOpenGLWrapMode=l=>{switch(l){case Xo.CLAMP_TO_EDGE:return e.context.CLAMP_TO_EDGE;case Xo.REPEAT:return e.context.REPEAT;case Xo.MIRRORED_REPEAT:return e.context.MIRRORED_REPEAT;default:return e.context.CLAMP_TO_EDGE}},t.updateArrayDataTypeForGL=function(l,f){let u=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;const g=[];let d=e.width*e.height*e.components;if(u&&(d*=e.depth),l!==Mt.FLOAT&&e.openGLDataType===e.context.FLOAT)for(let p=0;p<f.length;p++)if(f[p]){const m=f[p].length>d?f[p].subarray(0,d):f[p];g.push(new Float32Array(m))}else g.push(null);if(l!==Mt.UNSIGNED_CHAR&&e.openGLDataType===e.context.UNSIGNED_BYTE)for(let p=0;p<f.length;p++)if(f[p]){const m=f[p].length>d?f[p].subarray(0,d):f[p];g.push(new Uint8Array(m))}else g.push(null);let h=!1;if(e._openGLRenderWindow.getWebgl2())h=e.openGLDataType===e.context.HALF_FLOAT;else{const p=e.context.getExtension("OES_texture_half_float");h=p&&e.openGLDataType===p.HALF_FLOAT_OES}if(h)for(let p=0;p<f.length;p++)if(f[p]){const m=new Uint16Array(d),v=f[p];for(let y=0;y<d;y++)m[y]=tA(v[y]);g.push(m)}else g.push(null);if(g.length===0)for(let p=0;p<f.length;p++)g.push(f[p]);return g};function r(l){if(e._openGLRenderWindow.getWebgl2())return l;const f=[],u=e.width,g=e.height,d=e.components;if(l&&(!kf(u)||!kf(g))){const h=e.context.getExtension("OES_texture_half_float"),p=ua(u),m=ua(g),v=p*m*e.components;for(let y=0;y<l.length;y++)if(l[y]!==null){let T=null;const C=g/m,w=u/p;let x=!1;e.openGLDataType===e.context.FLOAT?T=new Float32Array(v):h&&e.openGLDataType===h.HALF_FLOAT_OES?(T=new Uint16Array(v),x=!0):T=new Uint8Array(v);for(let O=0;O<m;O++){const M=O*p*d,A=O*C;let _=Math.floor(A),k=Math.ceil(A);k>=g&&(k=g-1);const z=A-_,X=1-z;_=_*u*d,k=k*u*d;for(let Z=0;Z<p;Z++){const ce=Z*d,J=Z*w;let de=Math.floor(J),Q=Math.ceil(J);Q>=u&&(Q=u-1);const q=J-de;de*=d,Q*=d;for(let j=0;j<d;j++)x?T[M+ce+j]=E0.toHalf(E0.fromHalf(l[y][_+de+j])*X*(1-q)+E0.fromHalf(l[y][_+Q+j])*X*q+E0.fromHalf(l[y][k+de+j])*z*(1-q)+E0.fromHalf(l[y][k+Q+j])*z*q):T[M+ce+j]=l[y][_+de+j]*X*(1-q)+l[y][_+Q+j]*X*q+l[y][k+de+j]*z*(1-q)+l[y][k+Q+j]*z*q}}f.push(T),e.width=p,e.height=m}else f.push(null)}if(f.length===0)for(let h=0;h<l.length;h++)f.push(l[h]);return f}function i(l){var f;return e._openGLRenderWindow?e.resizable||(f=e.renderable)!=null&&f.getResizable()?!1:e._openGLRenderWindow.getWebgl2()?!(e._openGLRenderWindow.getGLInformations().RENDERER.value.match(/WebKit/gi)&&navigator.platform.match(/Mac/gi)&&n()&&(l===Mt.UNSIGNED_SHORT||l===Mt.SHORT)):!1:!1}t.create2DFromRaw=function(l,f,u,g,d){let h=arguments.length>5&&arguments[5]!==void 0?arguments[5]:!1;if(t.getOpenGLDataType(g,!0),t.getInternalFormat(g,u),t.getFormat(g,u),!e.internalFormat||!e.format||!e.openGLDataType)return Tl("Failed to determine texture parameters."),!1;e.target=e.context.TEXTURE_2D,e.components=u,e.width=l,e.height=f,e.depth=1,e.numberOfDimensions=2,e._openGLRenderWindow.activateTexture(t),t.createTexture(),t.bind();const p=[d],m=t.updateArrayDataTypeForGL(g,p),v=r(m);return e.context.pixelStorei(e.context.UNPACK_FLIP_Y_WEBGL,h),e.context.pixelStorei(e.context.UNPACK_ALIGNMENT,1),i(g)?(e.context.texStorage2D(e.target,1,e.internalFormat,e.width,e.height),v[0]!=null&&e.context.texSubImage2D(e.target,0,0,0,e.width,e.height,e.format,e.openGLDataType,v[0])):e.context.texImage2D(e.target,0,e.internalFormat,e.width,e.height,0,e.format,e.openGLDataType,v[0]),e.generateMipmap&&e.context.generateMipmap(e.target),h&&e.context.pixelStorei(e.context.UNPACK_FLIP_Y_WEBGL,!1),e.allocatedGPUMemoryInBytes=e.width*e.height*e.depth*u*e._openGLRenderWindow.getDefaultTextureByteSize(g,n(),t.useHalfFloat()),t.deactivate(),!0},t.createCubeFromRaw=(l,f,u,g,d)=>{if(t.getOpenGLDataType(g),t.getInternalFormat(g,u),t.getFormat(g,u),!e.internalFormat||!e.format||!e.openGLDataType)return Tl("Failed to determine texture parameters."),!1;e.target=e.context.TEXTURE_CUBE_MAP,e.components=u,e.width=l,e.height=f,e.depth=1,e.numberOfDimensions=2,e._openGLRenderWindow.activateTexture(t),e.maxLevel=d.length/6-1,t.createTexture(),t.bind();const h=t.updateArrayDataTypeForGL(g,d),p=r(h),m=[];let v=e.width,y=e.height;for(let T=0;T<p.length;T++){T%6===0&&T!==0&&(v/=2,y/=2),m[T]=Ku(g,y*v*e.components);for(let C=0;C<y;++C){const w=C*v*e.components,x=(y-C-1)*v*e.components;m[T].set(p[T].slice(x,x+v*e.components),w)}}e.context.pixelStorei(e.context.UNPACK_ALIGNMENT,1),i(g)&&e.context.texStorage2D(e.target,6,e.internalFormat,e.width,e.height);for(let T=0;T<6;T++){let C=0,w=e.width,x=e.height;for(;w>=1&&x>=1;){let O=null;C<=e.maxLevel&&(O=m[6*C+T]),i(g)?O!=null&&e.context.texSubImage2D(e.context.TEXTURE_CUBE_MAP_POSITIVE_X+T,C,0,0,w,x,e.format,e.openGLDataType,O):e.context.texImage2D(e.context.TEXTURE_CUBE_MAP_POSITIVE_X+T,C,e.internalFormat,w,x,0,e.format,e.openGLDataType,O),C++,w/=2,x/=2}}return e.allocatedGPUMemoryInBytes=e.width*e.height*e.depth*u*e._openGLRenderWindow.getDefaultTextureByteSize(g,n(),t.useHalfFloat()),t.deactivate(),!0},t.createDepthFromRaw=(l,f,u,g)=>(t.getOpenGLDataType(u),e.format=e.context.DEPTH_COMPONENT,e._openGLRenderWindow.getWebgl2()?u===Mt.FLOAT?e.internalFormat=e.context.DEPTH_COMPONENT32F:e.internalFormat=e.context.DEPTH_COMPONENT16:e.internalFormat=e.context.DEPTH_COMPONENT,!e.internalFormat||!e.format||!e.openGLDataType?(Tl("Failed to determine texture parameters."),!1):(e.target=e.context.TEXTURE_2D,e.components=1,e.width=l,e.height=f,e.depth=1,e.numberOfDimensions=2,e._openGLRenderWindow.activateTexture(t),t.createTexture(),t.bind(),e.context.pixelStorei(e.context.UNPACK_ALIGNMENT,1),i(u)?(e.context.texStorage2D(e.target,1,e.internalFormat,e.width,e.height),g!=null&&e.context.texSubImage2D(e.target,0,0,0,e.width,e.height,e.format,e.openGLDataType,g)):e.context.texImage2D(e.target,0,e.internalFormat,e.width,e.height,0,e.format,e.openGLDataType,g),e.generateMipmap&&e.context.generateMipmap(e.target),e.allocatedGPUMemoryInBytes=e.width*e.height*e.depth*e.components*e._openGLRenderWindow.getDefaultTextureByteSize(u,n(),t.useHalfFloat()),t.deactivate(),!0)),t.create2DFromImage=l=>{if(t.getOpenGLDataType(Mt.UNSIGNED_CHAR),t.getInternalFormat(Mt.UNSIGNED_CHAR,4),t.getFormat(Mt.UNSIGNED_CHAR,4),!e.internalFormat||!e.format||!e.openGLDataType)return Tl("Failed to determine texture parameters."),!1;e.target=e.context.TEXTURE_2D,e.components=4,e.depth=1,e.numberOfDimensions=2,e._openGLRenderWindow.activateTexture(t),t.createTexture(),t.bind(),e.context.pixelStorei(e.context.UNPACK_ALIGNMENT,1);const f=!e._openGLRenderWindow.getWebgl2()&&(!kf(l.width)||!kf(l.height)),u=document.createElement("canvas");u.width=f?ua(l.width):l.width,u.height=f?ua(l.height):l.height,e.width=u.width,e.height=u.height;const g=u.getContext("2d");g.translate(0,u.height),g.scale(1,-1),g.drawImage(l,0,0,l.width,l.height,0,0,u.width,u.height);const d=u;return i(Mt.UNSIGNED_CHAR)?(e.context.texStorage2D(e.target,1,e.internalFormat,e.width,e.height),d!=null&&e.context.texSubImage2D(e.target,0,0,0,e.width,e.height,e.format,e.openGLDataType,d)):e.context.texImage2D(e.target,0,e.internalFormat,e.width,e.height,0,e.format,e.openGLDataType,d),e.generateMipmap&&e.context.generateMipmap(e.target),e.allocatedGPUMemoryInBytes=e.width*e.height*e.depth*e.components*e._openGLRenderWindow.getDefaultTextureByteSize(Mt.UNSIGNED_CHAR,n(),t.useHalfFloat()),t.deactivate(),!0};function a(l,f,u){const g=new Array(u),d=new Array(u);for(let h=0;h<u;++h)g[h]=l[h],d[h]=f[h]-l[h]||1;return{scale:d,offset:g}}function o(l,f){for(let u=0;u<l.length;u++){const g=l[u],d=f[u]+g;if(g<-2048||g>2048||d<-2048||d>2048)return!1}return!0}function s(l,f,u,g){t.getOpenGLDataType(l);const d=o(f,u)||g;let h=!1;if(e._openGLRenderWindow.getWebgl2())h=e.openGLDataType===e.context.FLOAT&&e.context.getExtension("OES_texture_float_linear")===null&&d||e.openGLDataType===e.context.HALF_FLOAT;else{const p=e.context.getExtension("OES_texture_half_float");h=p&&e.openGLDataType===p.HALF_FLOAT_OES}e.canUseHalfFloat=h&&d}function c(l,f){const u=l.getNumberOfComponents(),g=l.getDataType(),d=l.getData(),h=new Array(u),p=new Array(u);for(let v=0;v<u;++v){const[y,T]=l.getRange(v);h[v]=y,p[v]=T}const m=a(h,p,u);return s(g,m.offset,m.scale,f),t.useHalfFloat()||t.getOpenGLDataType(g,!0),{numComps:u,dataType:g,data:d,scaleOffsets:m}}t.create2DFilterableFromRaw=function(l,f,u,g,d){let h=arguments.length>5&&arguments[5]!==void 0?arguments[5]:!1;return t.create2DFilterableFromDataArray(l,f,nt.newInstance({numberOfComponents:u,dataType:g,values:d}),h)},t.create2DFilterableFromDataArray=function(l,f,u){let g=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;const{numComps:d,dataType:h,data:p}=c(u,g);t.create2DFromRaw(l,f,d,h,p)},t.updateVolumeInfoForGL=(l,f)=>{var d,h;let u=!1;const g=t.useHalfFloat();(!((d=e.volumeInfo)!=null&&d.scale)||!((h=e.volumeInfo)!=null&&h.offset))&&(e.volumeInfo={scale:new Array(f),offset:new Array(f)});for(let p=0;p<f;++p)e.volumeInfo.scale[p]=1,e.volumeInfo.offset[p]=0;if(n()&&!g&&l===Mt.SHORT){for(let p=0;p<f;++p)e.volumeInfo.scale[p]=32767;u=!0}if(n()&&!g&&l===Mt.UNSIGNED_SHORT){for(let p=0;p<f;++p)e.volumeInfo.scale[p]=65535;u=!0}if(l===Mt.UNSIGNED_CHAR){for(let p=0;p<f;++p)e.volumeInfo.scale[p]=255;u=!0}return(l===Mt.FLOAT||g&&(l===Mt.SHORT||l===Mt.UNSIGNED_SHORT))&&(u=!0),u},t.create3DFromRaw=(l,f,u,g,d,h)=>{let p=d,m=h;if(!t.updateVolumeInfoForGL(p,g)&&m){const w=l*f*u,x=structuredClone(e.volumeInfo),O=new Float32Array(w*g);e.volumeInfo.offset=x.offset,e.volumeInfo.scale=x.scale;let M=0;const A=x.scale.map(_=>1/_);for(let _=0;_<w;_++)for(let k=0;k<g;k++)O[M]=(m[M]-x.offset[k])*A[k],M++;p=Mt.FLOAT,m=O}if(t.getOpenGLDataType(p),t.getInternalFormat(p,g),t.getFormat(p,g),!e.internalFormat||!e.format||!e.openGLDataType)return Tl("Failed to determine texture parameters."),!1;e.target=e.context.TEXTURE_3D,e.components=g,e.width=l,e.height=f,e.depth=u,e.numberOfDimensions=3,e._openGLRenderWindow.activateTexture(t),t.createTexture(),t.bind();const v=[m],T=t.updateArrayDataTypeForGL(p,v,!0),C=r(T);return e.context.pixelStorei(e.context.UNPACK_ALIGNMENT,1),i(p)?(e.context.texStorage3D(e.target,1,e.internalFormat,e.width,e.height,e.depth),C[0]!=null&&e.context.texSubImage3D(e.target,0,0,0,0,e.width,e.height,e.depth,e.format,e.openGLDataType,C[0])):e.context.texImage3D(e.target,0,e.internalFormat,e.width,e.height,e.depth,0,e.format,e.openGLDataType,C[0]),e.generateMipmap&&e.context.generateMipmap(e.target),e.allocatedGPUMemoryInBytes=e.width*e.height*e.depth*e.components*e._openGLRenderWindow.getDefaultTextureByteSize(p,n(),t.useHalfFloat()),t.deactivate(),!0},t.create3DFilterableFromRaw=function(l,f,u,g,d,h){let p=arguments.length>6&&arguments[6]!==void 0?arguments[6]:!1;return t.create3DFilterableFromDataArray(l,f,u,nt.newInstance({numberOfComponents:g,dataType:d,values:h}),p)},t.create3DFilterableFromDataArray=function(l,f,u,g){let d=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!1;const{numComps:h,dataType:p,data:m,scaleOffsets:v}=c(g,d),y=[],T=[];for(let j=0;j<h;++j)y[j]=0,T[j]=1;if(e.volumeInfo={scale:T,offset:y,dataComputedScale:v.scale,dataComputedOffset:v.offset,width:l,height:f,depth:u},e._openGLRenderWindow.getWebgl2())return t.create3DFromRaw(l,f,u,h,p,m);const C=l*f*u,w=structuredClone(v);let x=(j,ie,ue,le,Fe)=>{j[ie]=ue},O=Mt.UNSIGNED_CHAR;if(p===Mt.UNSIGNED_CHAR)for(let j=0;j<h;++j)w.offset[j]=0,w.scale[j]=255;else e.context.getExtension("OES_texture_float")&&e.context.getExtension("OES_texture_float_linear")?(O=Mt.FLOAT,x=(j,ie,ue,le,Fe)=>{j[ie]=(ue-le)/Fe}):(O=Mt.UNSIGNED_CHAR,x=(j,ie,ue,le,Fe)=>{j[ie]=255*(ue-le)/Fe});if(t.getOpenGLDataType(O),t.getInternalFormat(O,h),t.getFormat(O,h),!e.internalFormat||!e.format||!e.openGLDataType)return Tl("Failed to determine texture parameters."),!1;e.target=e.context.TEXTURE_2D,e.components=h,e.depth=1,e.numberOfDimensions=2;let M=e.context.getParameter(e.context.MAX_TEXTURE_SIZE);M>4096&&(O===Mt.FLOAT||h>=3)&&(M=4096);let A=1,_=1;C>M*M&&(A=Math.ceil(Math.sqrt(C/(M*M))),_=A);let k=Math.sqrt(C)/A;k=ua(k);const z=Math.floor(k*A/l),X=Math.ceil(u/z),Z=ua(f*X/_);e.width=k,e.height=Z,e._openGLRenderWindow.activateTexture(t),t.createTexture(),t.bind(),e.volumeInfo.xreps=z,e.volumeInfo.yreps=X,e.volumeInfo.xstride=A,e.volumeInfo.ystride=_,e.volumeInfo.offset=w.offset,e.volumeInfo.scale=w.scale;let ce;const J=k*Z*h;O===Mt.FLOAT?ce=new Float32Array(J):ce=new Uint8Array(J);let de=0;const Q=Math.floor(l/A),q=Math.floor(f/_);for(let j=0;j<X;j++){const ie=Math.min(z,u-j*z),ue=h*(e.width-ie*Math.floor(l/A));for(let le=0;le<q;le++){for(let Fe=0;Fe<ie;Fe++){const kt=h*((j*z+Fe)*l*f+_*le*l);for(let lt=0;lt<Q;lt++)for(let yt=0;yt<h;yt++)x(ce,de,m[kt+A*lt*h+yt],w.offset[yt],w.scale[yt]),de++}de+=ue}}return e.context.pixelStorei(e.context.UNPACK_ALIGNMENT,1),i(O)?(e.context.texStorage2D(e.target,1,e.internalFormat,e.width,e.height),ce!=null&&e.context.texSubImage2D(e.target,0,0,0,e.width,e.height,e.format,e.openGLDataType,ce)):e.context.texImage2D(e.target,0,e.internalFormat,e.width,e.height,0,e.format,e.openGLDataType,ce),t.deactivate(),!0},t.setOpenGLRenderWindow=l=>{e._openGLRenderWindow!==l&&(t.releaseGraphicsResources(),e._openGLRenderWindow=l,e.context=null,l&&(e.context=e._openGLRenderWindow.getContext()))},t.getMaximumTextureSize=l=>l&&l.isCurrent()?l.getIntegerv(l.MAX_TEXTURE_SIZE):-1,t.enableUseHalfFloat=l=>{e.enableUseHalfFloat=l}}const rA={_openGLRenderWindow:null,_forceInternalFormat:!1,context:null,handle:0,sendParametersTime:null,textureBuildTime:null,numberOfDimensions:0,target:0,format:0,openGLDataType:0,components:0,width:0,height:0,depth:0,autoParameters:!0,wrapS:Xo.CLAMP_TO_EDGE,wrapT:Xo.CLAMP_TO_EDGE,wrapR:Xo.CLAMP_TO_EDGE,minificationFilter:nr.NEAREST,magnificationFilter:nr.NEAREST,minLOD:-1e3,maxLOD:1e3,baseLevel:0,maxLevel:1e3,generateMipmap:!1,oglNorm16Ext:null,allocatedGPUMemoryInBytes:0,enableUseHalfFloat:!0,canUseHalfFloat:!1};function tE(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,rA,n),Bt.extend(t,e,n),e.sendParametersTime={},zt(e.sendParametersTime,{mtime:0}),e.textureBuildTime={},zt(e.textureBuildTime,{mtime:0}),ud(t,e,["format","openGLDataType"]),Vn(t,e,["keyMatrixTime","minificationFilter","magnificationFilter","wrapS","wrapT","wrapR","generateMipmap","oglNorm16Ext"]),hi(t,e,["width","height","volumeInfo","components","handle","target","allocatedGPUMemoryInBytes"]),fd(t,e,["openGLRenderWindow"]),nA(t,e)}const nE=Rt(tE,"vtkOpenGLTexture");var Xt={newInstance:nE,extend:tE,...SS};Wn("vtkTexture",nE);function iA(t,e){e.classHierarchy.push("vtkFramebuffer"),t.getBothMode=()=>e.context.FRAMEBUFFER,t.saveCurrentBindingsAndBuffers=n=>{const r=typeof n<"u"?n:t.getBothMode();t.saveCurrentBindings(r),t.saveCurrentBuffers(r)},t.saveCurrentBindings=n=>{if(!e.context){mt("you must set the OpenGLRenderWindow before calling saveCurrentBindings");return}const r=e.context;e.previousDrawBinding=r.getParameter(e.context.FRAMEBUFFER_BINDING),e.previousActiveFramebuffer=e._openGLRenderWindow.getActiveFramebuffer()},t.saveCurrentBuffers=n=>{},t.restorePreviousBindingsAndBuffers=n=>{const r=typeof n<"u"?n:t.getBothMode();t.restorePreviousBindings(r),t.restorePreviousBuffers(r)},t.restorePreviousBindings=n=>{if(!e.context){mt("you must set the OpenGLRenderWindow before calling restorePreviousBindings");return}const r=e.context;r.bindFramebuffer(r.FRAMEBUFFER,e.previousDrawBinding),e._openGLRenderWindow.setActiveFramebuffer(e.previousActiveFramebuffer)},t.restorePreviousBuffers=n=>{},t.bind=function(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;r===null&&(r=e.context.FRAMEBUFFER),e.context.bindFramebuffer(r,e.glFramebuffer);for(let i=0;i<e.colorBuffers.length;i++)e.colorBuffers[i].bind();e._openGLRenderWindow.setActiveFramebuffer(t)},t.create=(n,r)=>{if(!e.context){mt("you must set the OpenGLRenderWindow before calling create");return}e.glFramebuffer=e.context.createFramebuffer(),e.glFramebuffer.width=n,e.glFramebuffer.height=r},t.setColorBuffer=function(n){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;const i=e.context;if(!i){mt("you must set the OpenGLRenderWindow before calling setColorBuffer");return}let a=i.COLOR_ATTACHMENT0;if(r>0)if(e._openGLRenderWindow.getWebgl2())a+=r;else{mt("Using multiple framebuffer attachments requires WebGL 2");return}e.colorBuffers[r]=n,i.framebufferTexture2D(i.FRAMEBUFFER,a,i.TEXTURE_2D,n.getHandle(),0)},t.removeColorBuffer=function(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;const r=e.context;if(!r){mt("you must set the OpenGLRenderWindow before calling removeColorBuffer");return}let i=r.COLOR_ATTACHMENT0;if(n>0)if(e._openGLRenderWindow.getWebgl2())i+=n;else{mt("Using multiple framebuffer attachments requires WebGL 2");return}r.framebufferTexture2D(r.FRAMEBUFFER,i,r.TEXTURE_2D,null,0),e.colorBuffers=e.colorBuffers.splice(n,1)},t.setDepthBuffer=n=>{if(!e.context){mt("you must set the OpenGLRenderWindow before calling setDepthBuffer");return}if(e._openGLRenderWindow.getWebgl2()){const r=e.context;r.framebufferTexture2D(r.FRAMEBUFFER,r.DEPTH_ATTACHMENT,r.TEXTURE_2D,n.getHandle(),0)}else mt("Attaching depth buffer textures to fbo requires WebGL 2")},t.removeDepthBuffer=()=>{if(!e.context){mt("you must set the OpenGLRenderWindow before calling removeDepthBuffer");return}if(e._openGLRenderWindow.getWebgl2()){const n=e.context;n.framebufferTexture2D(n.FRAMEBUFFER,n.DEPTH_ATTACHMENT,n.TEXTURE_2D,null,0)}else mt("Attaching depth buffer textures to framebuffers requires WebGL 2")},t.getGLFramebuffer=()=>e.glFramebuffer,t.setOpenGLRenderWindow=n=>{e._openGLRenderWindow!==n&&(t.releaseGraphicsResources(),e._openGLRenderWindow=n,e.context=null,n&&(e.context=e._openGLRenderWindow.getContext()))},t.releaseGraphicsResources=()=>{e.glFramebuffer&&e.context.deleteFramebuffer(e.glFramebuffer)},t.getSize=()=>e.glFramebuffer==null?null:[e.glFramebuffer.width,e.glFramebuffer.height],t.populateFramebuffer=()=>{if(!e.context){mt("you must set the OpenGLRenderWindow before calling populateFrameBuffer");return}t.bind();const n=e.context,r=Xt.newInstance();r.setOpenGLRenderWindow(e._openGLRenderWindow),r.setMinificationFilter(Ge.LINEAR),r.setMagnificationFilter(Ge.LINEAR),r.create2DFromRaw(e.glFramebuffer.width,e.glFramebuffer.height,4,ut.UNSIGNED_CHAR,null),t.setColorBuffer(r),e.depthTexture=n.createRenderbuffer(),n.bindRenderbuffer(n.RENDERBUFFER,e.depthTexture),n.renderbufferStorage(n.RENDERBUFFER,n.DEPTH_COMPONENT16,e.glFramebuffer.width,e.glFramebuffer.height),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.DEPTH_ATTACHMENT,n.RENDERBUFFER,e.depthTexture)},t.getColorTexture=()=>e.colorBuffers[0]}const aA={glFramebuffer:null,colorBuffers:null,depthTexture:null,previousDrawBinding:0,previousReadBinding:0,previousDrawBuffer:0,previousReadBuffer:0,previousActiveFramebuffer:null};function rE(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,aA,n),zt(t,e),e.colorBuffers&&mt("you cannot initialize colorBuffers through the constructor. You should call setColorBuffer() instead."),e.colorBuffers=[],qu(t,e,["colorBuffers"]),iA(t,e)}const oA=Rt(rE,"vtkFramebuffer");var f2={newInstance:oA,extend:rE};function sA(t,e){e.classHierarchy.push("vtkRenderPass"),t.getOperation=()=>e.currentOperation,t.setCurrentOperation=n=>{e.currentOperation=n,e.currentTraverseOperation=`traverse${P.capitalize(e.currentOperation)}`},t.getTraverseOperation=()=>e.currentTraverseOperation,t.traverse=function(n){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;e.deleted||(e._currentParent=r,e.preDelegateOperations.forEach(i=>{t.setCurrentOperation(i),n.traverse(t)}),e.delegates.forEach(i=>{i.traverse(n,t)}),e.postDelegateOperations.forEach(i=>{t.setCurrentOperation(i),n.traverse(t)}))}}const cA={delegates:[],currentOperation:null,preDelegateOperations:[],postDelegateOperations:[],currentParent:null};function iE(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,cA,n),P.obj(t,e),P.get(t,e,["currentOperation"]),P.setGet(t,e,["delegates","_currentParent","preDelegateOperations","postDelegateOperations"]),P.moveToProtected(t,e,["currentParent"]),sA(t,e)}const lA=P.newInstance(iE,"vtkRenderPass");var V4={newInstance:lA,extend:iE},Dt=1e-6,$n=typeof Float32Array<"u"?Float32Array:Array,uA=Math.PI/180;function fA(t){return t*uA}function Ug(t,e){return Math.abs(t-e)<=Dt*Math.max(1,Math.abs(t),Math.abs(e))}Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});function P4(){var t=new $n(9);return $n!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t}function g2(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t}function gA(t){var e=new $n(9);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e}function dA(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}function Ff(t,e,n,r,i,a,o,s,c){var l=new $n(9);return l[0]=t,l[1]=e,l[2]=n,l[3]=r,l[4]=i,l[5]=a,l[6]=o,l[7]=s,l[8]=c,l}function aE(t,e,n,r,i,a,o,s,c,l){return t[0]=e,t[1]=n,t[2]=r,t[3]=i,t[4]=a,t[5]=o,t[6]=s,t[7]=c,t[8]=l,t}function ya(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function N4(t,e){if(t===e){var n=e[1],r=e[2],i=e[5];t[1]=e[3],t[2]=e[6],t[3]=n,t[5]=e[7],t[6]=r,t[7]=i}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t}function md(t,e){var n=e[0],r=e[1],i=e[2],a=e[3],o=e[4],s=e[5],c=e[6],l=e[7],f=e[8],u=f*o-s*l,g=-f*a+s*c,d=l*a-o*c,h=n*u+r*g+i*d;return h?(h=1/h,t[0]=u*h,t[1]=(-f*r+i*l)*h,t[2]=(s*r-i*o)*h,t[3]=g*h,t[4]=(f*n-i*c)*h,t[5]=(-s*n+i*a)*h,t[6]=d*h,t[7]=(-l*n+r*c)*h,t[8]=(o*n-r*a)*h,t):null}function pA(t,e){var n=e[0],r=e[1],i=e[2],a=e[3],o=e[4],s=e[5],c=e[6],l=e[7],f=e[8];return t[0]=o*f-s*l,t[1]=i*l-r*f,t[2]=r*s-i*o,t[3]=s*c-a*f,t[4]=n*f-i*c,t[5]=i*a-n*s,t[6]=a*l-o*c,t[7]=r*c-n*l,t[8]=n*o-r*a,t}function C0(t){var e=t[0],n=t[1],r=t[2],i=t[3],a=t[4],o=t[5],s=t[6],c=t[7],l=t[8];return e*(l*a-o*c)+n*(-l*i+o*s)+r*(c*i-a*s)}function Du(t,e,n){var r=e[0],i=e[1],a=e[2],o=e[3],s=e[4],c=e[5],l=e[6],f=e[7],u=e[8],g=n[0],d=n[1],h=n[2],p=n[3],m=n[4],v=n[5],y=n[6],T=n[7],C=n[8];return t[0]=g*r+d*o+h*l,t[1]=g*i+d*s+h*f,t[2]=g*a+d*c+h*u,t[3]=p*r+m*o+v*l,t[4]=p*i+m*s+v*f,t[5]=p*a+m*c+v*u,t[6]=y*r+T*o+C*l,t[7]=y*i+T*s+C*f,t[8]=y*a+T*c+C*u,t}function hA(t,e,n){var r=e[0],i=e[1],a=e[2],o=e[3],s=e[4],c=e[5],l=e[6],f=e[7],u=e[8],g=n[0],d=n[1];return t[0]=r,t[1]=i,t[2]=a,t[3]=o,t[4]=s,t[5]=c,t[6]=g*r+d*o+l,t[7]=g*i+d*s+f,t[8]=g*a+d*c+u,t}function mA(t,e,n){var r=e[0],i=e[1],a=e[2],o=e[3],s=e[4],c=e[5],l=e[6],f=e[7],u=e[8],g=Math.sin(n),d=Math.cos(n);return t[0]=d*r+g*o,t[1]=d*i+g*s,t[2]=d*a+g*c,t[3]=d*o-g*r,t[4]=d*s-g*i,t[5]=d*c-g*a,t[6]=l,t[7]=f,t[8]=u,t}function vA(t,e,n){var r=n[0],i=n[1];return t[0]=r*e[0],t[1]=r*e[1],t[2]=r*e[2],t[3]=i*e[3],t[4]=i*e[4],t[5]=i*e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}function yA(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=e[0],t[7]=e[1],t[8]=1,t}function TA(t,e){var n=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=n,t[2]=0,t[3]=-n,t[4]=r,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function CA(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=e[1],t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function wA(t,e){return t[0]=e[0],t[1]=e[1],t[2]=0,t[3]=e[2],t[4]=e[3],t[5]=0,t[6]=e[4],t[7]=e[5],t[8]=1,t}function xA(t,e){var n=e[0],r=e[1],i=e[2],a=e[3],o=n+n,s=r+r,c=i+i,l=n*o,f=r*o,u=r*s,g=i*o,d=i*s,h=i*c,p=a*o,m=a*s,v=a*c;return t[0]=1-u-h,t[3]=f-v,t[6]=g+m,t[1]=f+v,t[4]=1-l-h,t[7]=d-p,t[2]=g-m,t[5]=d+p,t[8]=1-l-u,t}function SA(t,e){var n=e[0],r=e[1],i=e[2],a=e[3],o=e[4],s=e[5],c=e[6],l=e[7],f=e[8],u=e[9],g=e[10],d=e[11],h=e[12],p=e[13],m=e[14],v=e[15],y=n*s-r*o,T=n*c-i*o,C=n*l-a*o,w=r*c-i*s,x=r*l-a*s,O=i*l-a*c,M=f*p-u*h,A=f*m-g*h,_=f*v-d*h,k=u*m-g*p,z=u*v-d*p,X=g*v-d*m,Z=y*X-T*z+C*k+w*_-x*A+O*M;return Z?(Z=1/Z,t[0]=(s*X-c*z+l*k)*Z,t[1]=(c*_-o*X-l*A)*Z,t[2]=(o*z-s*_+l*M)*Z,t[3]=(i*z-r*X-a*k)*Z,t[4]=(n*X-i*_+a*A)*Z,t[5]=(r*_-n*z-a*M)*Z,t[6]=(p*O-m*x+v*w)*Z,t[7]=(m*C-h*O-v*T)*Z,t[8]=(h*x-p*C+v*y)*Z,t):null}function EA(t,e,n){return t[0]=2/e,t[1]=0,t[2]=0,t[3]=0,t[4]=-2/n,t[5]=0,t[6]=-1,t[7]=1,t[8]=1,t}function OA(t){return"mat3("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+")"}function DA(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8])}function RA(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t[4]=e[4]+n[4],t[5]=e[5]+n[5],t[6]=e[6]+n[6],t[7]=e[7]+n[7],t[8]=e[8]+n[8],t}function oE(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t[4]=e[4]-n[4],t[5]=e[5]-n[5],t[6]=e[6]-n[6],t[7]=e[7]-n[7],t[8]=e[8]-n[8],t}function MA(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*n,t[5]=e[5]*n,t[6]=e[6]*n,t[7]=e[7]*n,t[8]=e[8]*n,t}function _A(t,e,n,r){return t[0]=e[0]+n[0]*r,t[1]=e[1]+n[1]*r,t[2]=e[2]+n[2]*r,t[3]=e[3]+n[3]*r,t[4]=e[4]+n[4]*r,t[5]=e[5]+n[5]*r,t[6]=e[6]+n[6]*r,t[7]=e[7]+n[7]*r,t[8]=e[8]+n[8]*r,t}function bA(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]}function LA(t,e){var n=t[0],r=t[1],i=t[2],a=t[3],o=t[4],s=t[5],c=t[6],l=t[7],f=t[8],u=e[0],g=e[1],d=e[2],h=e[3],p=e[4],m=e[5],v=e[6],y=e[7],T=e[8];return Math.abs(n-u)<=Dt*Math.max(1,Math.abs(n),Math.abs(u))&&Math.abs(r-g)<=Dt*Math.max(1,Math.abs(r),Math.abs(g))&&Math.abs(i-d)<=Dt*Math.max(1,Math.abs(i),Math.abs(d))&&Math.abs(a-h)<=Dt*Math.max(1,Math.abs(a),Math.abs(h))&&Math.abs(o-p)<=Dt*Math.max(1,Math.abs(o),Math.abs(p))&&Math.abs(s-m)<=Dt*Math.max(1,Math.abs(s),Math.abs(m))&&Math.abs(c-v)<=Dt*Math.max(1,Math.abs(c),Math.abs(v))&&Math.abs(l-y)<=Dt*Math.max(1,Math.abs(l),Math.abs(y))&&Math.abs(f-T)<=Dt*Math.max(1,Math.abs(f),Math.abs(T))}var IA=Du,VA=oE;const PA=Object.freeze(Object.defineProperty({__proto__:null,add:RA,adjoint:pA,clone:gA,copy:dA,create:P4,determinant:C0,equals:LA,exactEquals:bA,frob:DA,fromMat2d:wA,fromMat4:g2,fromQuat:xA,fromRotation:TA,fromScaling:CA,fromTranslation:yA,fromValues:Ff,identity:ya,invert:md,mul:IA,multiply:Du,multiplyScalar:MA,multiplyScalarAndAdd:_A,normalFromMat4:SA,projection:EA,rotate:mA,scale:vA,set:aE,str:OA,sub:VA,subtract:oE,translate:hA,transpose:N4},Symbol.toStringTag,{value:"Module"}));function Lc(){var t=new $n(16);return $n!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t}function NA(t){var e=new $n(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function nn(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function sE(t,e,n,r,i,a,o,s,c,l,f,u,g,d,h,p){var m=new $n(16);return m[0]=t,m[1]=e,m[2]=n,m[3]=r,m[4]=i,m[5]=a,m[6]=o,m[7]=s,m[8]=c,m[9]=l,m[10]=f,m[11]=u,m[12]=g,m[13]=d,m[14]=h,m[15]=p,m}function kA(t,e,n,r,i,a,o,s,c,l,f,u,g,d,h,p,m){return t[0]=e,t[1]=n,t[2]=r,t[3]=i,t[4]=a,t[5]=o,t[6]=s,t[7]=c,t[8]=l,t[9]=f,t[10]=u,t[11]=g,t[12]=d,t[13]=h,t[14]=p,t[15]=m,t}function Be(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function ft(t,e){if(t===e){var n=e[1],r=e[2],i=e[3],a=e[6],o=e[7],s=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=n,t[6]=e[9],t[7]=e[13],t[8]=r,t[9]=a,t[11]=e[14],t[12]=i,t[13]=o,t[14]=s}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t}function Ln(t,e){var n=e[0],r=e[1],i=e[2],a=e[3],o=e[4],s=e[5],c=e[6],l=e[7],f=e[8],u=e[9],g=e[10],d=e[11],h=e[12],p=e[13],m=e[14],v=e[15],y=n*s-r*o,T=n*c-i*o,C=n*l-a*o,w=r*c-i*s,x=r*l-a*s,O=i*l-a*c,M=f*p-u*h,A=f*m-g*h,_=f*v-d*h,k=u*m-g*p,z=u*v-d*p,X=g*v-d*m,Z=y*X-T*z+C*k+w*_-x*A+O*M;return Z?(Z=1/Z,t[0]=(s*X-c*z+l*k)*Z,t[1]=(i*z-r*X-a*k)*Z,t[2]=(p*O-m*x+v*w)*Z,t[3]=(g*x-u*O-d*w)*Z,t[4]=(c*_-o*X-l*A)*Z,t[5]=(n*X-i*_+a*A)*Z,t[6]=(m*C-h*O-v*T)*Z,t[7]=(f*O-g*C+d*T)*Z,t[8]=(o*z-s*_+l*M)*Z,t[9]=(r*_-n*z-a*M)*Z,t[10]=(h*x-p*C+v*y)*Z,t[11]=(u*C-f*x-d*y)*Z,t[12]=(s*A-o*k-c*M)*Z,t[13]=(n*k-r*A+i*M)*Z,t[14]=(p*T-h*w-m*y)*Z,t[15]=(f*w-u*T+g*y)*Z,t):null}function AA(t,e){var n=e[0],r=e[1],i=e[2],a=e[3],o=e[4],s=e[5],c=e[6],l=e[7],f=e[8],u=e[9],g=e[10],d=e[11],h=e[12],p=e[13],m=e[14],v=e[15];return t[0]=s*(g*v-d*m)-u*(c*v-l*m)+p*(c*d-l*g),t[1]=-(r*(g*v-d*m)-u*(i*v-a*m)+p*(i*d-a*g)),t[2]=r*(c*v-l*m)-s*(i*v-a*m)+p*(i*l-a*c),t[3]=-(r*(c*d-l*g)-s*(i*d-a*g)+u*(i*l-a*c)),t[4]=-(o*(g*v-d*m)-f*(c*v-l*m)+h*(c*d-l*g)),t[5]=n*(g*v-d*m)-f*(i*v-a*m)+h*(i*d-a*g),t[6]=-(n*(c*v-l*m)-o*(i*v-a*m)+h*(i*l-a*c)),t[7]=n*(c*d-l*g)-o*(i*d-a*g)+f*(i*l-a*c),t[8]=o*(u*v-d*p)-f*(s*v-l*p)+h*(s*d-l*u),t[9]=-(n*(u*v-d*p)-f*(r*v-a*p)+h*(r*d-a*u)),t[10]=n*(s*v-l*p)-o*(r*v-a*p)+h*(r*l-a*s),t[11]=-(n*(s*d-l*u)-o*(r*d-a*u)+f*(r*l-a*s)),t[12]=-(o*(u*m-g*p)-f*(s*m-c*p)+h*(s*g-c*u)),t[13]=n*(u*m-g*p)-f*(r*m-i*p)+h*(r*g-i*u),t[14]=-(n*(s*m-c*p)-o*(r*m-i*p)+h*(r*c-i*s)),t[15]=n*(s*g-c*u)-o*(r*g-i*u)+f*(r*c-i*s),t}function FA(t){var e=t[0],n=t[1],r=t[2],i=t[3],a=t[4],o=t[5],s=t[6],c=t[7],l=t[8],f=t[9],u=t[10],g=t[11],d=t[12],h=t[13],p=t[14],m=t[15],v=e*o-n*a,y=e*s-r*a,T=e*c-i*a,C=n*s-r*o,w=n*c-i*o,x=r*c-i*s,O=l*h-f*d,M=l*p-u*d,A=l*m-g*d,_=f*p-u*h,k=f*m-g*h,z=u*m-g*p;return v*z-y*k+T*_+C*A-w*M+x*O}function vt(t,e,n){var r=e[0],i=e[1],a=e[2],o=e[3],s=e[4],c=e[5],l=e[6],f=e[7],u=e[8],g=e[9],d=e[10],h=e[11],p=e[12],m=e[13],v=e[14],y=e[15],T=n[0],C=n[1],w=n[2],x=n[3];return t[0]=T*r+C*s+w*u+x*p,t[1]=T*i+C*c+w*g+x*m,t[2]=T*a+C*l+w*d+x*v,t[3]=T*o+C*f+w*h+x*y,T=n[4],C=n[5],w=n[6],x=n[7],t[4]=T*r+C*s+w*u+x*p,t[5]=T*i+C*c+w*g+x*m,t[6]=T*a+C*l+w*d+x*v,t[7]=T*o+C*f+w*h+x*y,T=n[8],C=n[9],w=n[10],x=n[11],t[8]=T*r+C*s+w*u+x*p,t[9]=T*i+C*c+w*g+x*m,t[10]=T*a+C*l+w*d+x*v,t[11]=T*o+C*f+w*h+x*y,T=n[12],C=n[13],w=n[14],x=n[15],t[12]=T*r+C*s+w*u+x*p,t[13]=T*i+C*c+w*g+x*m,t[14]=T*a+C*l+w*d+x*v,t[15]=T*o+C*f+w*h+x*y,t}function en(t,e,n){var r=n[0],i=n[1],a=n[2],o,s,c,l,f,u,g,d,h,p,m,v;return e===t?(t[12]=e[0]*r+e[4]*i+e[8]*a+e[12],t[13]=e[1]*r+e[5]*i+e[9]*a+e[13],t[14]=e[2]*r+e[6]*i+e[10]*a+e[14],t[15]=e[3]*r+e[7]*i+e[11]*a+e[15]):(o=e[0],s=e[1],c=e[2],l=e[3],f=e[4],u=e[5],g=e[6],d=e[7],h=e[8],p=e[9],m=e[10],v=e[11],t[0]=o,t[1]=s,t[2]=c,t[3]=l,t[4]=f,t[5]=u,t[6]=g,t[7]=d,t[8]=h,t[9]=p,t[10]=m,t[11]=v,t[12]=o*r+f*i+h*a+e[12],t[13]=s*r+u*i+p*a+e[13],t[14]=c*r+g*i+m*a+e[14],t[15]=l*r+d*i+v*a+e[15]),t}function ms(t,e,n){var r=n[0],i=n[1],a=n[2];return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*i,t[5]=e[5]*i,t[6]=e[6]*i,t[7]=e[7]*i,t[8]=e[8]*a,t[9]=e[9]*a,t[10]=e[10]*a,t[11]=e[11]*a,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function Ma(t,e,n,r){var i=r[0],a=r[1],o=r[2],s=Math.hypot(i,a,o),c,l,f,u,g,d,h,p,m,v,y,T,C,w,x,O,M,A,_,k,z,X,Z,ce;return s<Dt?null:(s=1/s,i*=s,a*=s,o*=s,c=Math.sin(n),l=Math.cos(n),f=1-l,u=e[0],g=e[1],d=e[2],h=e[3],p=e[4],m=e[5],v=e[6],y=e[7],T=e[8],C=e[9],w=e[10],x=e[11],O=i*i*f+l,M=a*i*f+o*c,A=o*i*f-a*c,_=i*a*f-o*c,k=a*a*f+l,z=o*a*f+i*c,X=i*o*f+a*c,Z=a*o*f-i*c,ce=o*o*f+l,t[0]=u*O+p*M+T*A,t[1]=g*O+m*M+C*A,t[2]=d*O+v*M+w*A,t[3]=h*O+y*M+x*A,t[4]=u*_+p*k+T*z,t[5]=g*_+m*k+C*z,t[6]=d*_+v*k+w*z,t[7]=h*_+y*k+x*z,t[8]=u*X+p*Z+T*ce,t[9]=g*X+m*Z+C*ce,t[10]=d*X+v*Z+w*ce,t[11]=h*X+y*Z+x*ce,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)}function k4(t,e,n){var r=Math.sin(n),i=Math.cos(n),a=e[4],o=e[5],s=e[6],c=e[7],l=e[8],f=e[9],u=e[10],g=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=a*i+l*r,t[5]=o*i+f*r,t[6]=s*i+u*r,t[7]=c*i+g*r,t[8]=l*i-a*r,t[9]=f*i-o*r,t[10]=u*i-s*r,t[11]=g*i-c*r,t}function A4(t,e,n){var r=Math.sin(n),i=Math.cos(n),a=e[0],o=e[1],s=e[2],c=e[3],l=e[8],f=e[9],u=e[10],g=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=a*i-l*r,t[1]=o*i-f*r,t[2]=s*i-u*r,t[3]=c*i-g*r,t[8]=a*r+l*i,t[9]=o*r+f*i,t[10]=s*r+u*i,t[11]=c*r+g*i,t}function F4(t,e,n){var r=Math.sin(n),i=Math.cos(n),a=e[0],o=e[1],s=e[2],c=e[3],l=e[4],f=e[5],u=e[6],g=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=a*i+l*r,t[1]=o*i+f*r,t[2]=s*i+u*r,t[3]=c*i+g*r,t[4]=l*i-a*r,t[5]=f*i-o*r,t[6]=u*i-s*r,t[7]=g*i-c*r,t}function d2(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=e[0],t[13]=e[1],t[14]=e[2],t[15]=1,t}function U4(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function B4(t,e,n){var r=n[0],i=n[1],a=n[2],o=Math.hypot(r,i,a),s,c,l;return o<Dt?null:(o=1/o,r*=o,i*=o,a*=o,s=Math.sin(e),c=Math.cos(e),l=1-c,t[0]=r*r*l+c,t[1]=i*r*l+a*s,t[2]=a*r*l-i*s,t[3]=0,t[4]=r*i*l-a*s,t[5]=i*i*l+c,t[6]=a*i*l+r*s,t[7]=0,t[8]=r*a*l+i*s,t[9]=i*a*l-r*s,t[10]=a*a*l+c,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t)}function UA(t,e){var n=Math.sin(e),r=Math.cos(e);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=r,t[6]=n,t[7]=0,t[8]=0,t[9]=-n,t[10]=r,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function BA(t,e){var n=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=0,t[2]=-n,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=n,t[9]=0,t[10]=r,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function GA(t,e){var n=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=n,t[2]=0,t[3]=0,t[4]=-n,t[5]=r,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function cE(t,e,n){var r=e[0],i=e[1],a=e[2],o=e[3],s=r+r,c=i+i,l=a+a,f=r*s,u=r*c,g=r*l,d=i*c,h=i*l,p=a*l,m=o*s,v=o*c,y=o*l;return t[0]=1-(d+p),t[1]=u+y,t[2]=g-v,t[3]=0,t[4]=u-y,t[5]=1-(f+p),t[6]=h+m,t[7]=0,t[8]=g+v,t[9]=h-m,t[10]=1-(f+d),t[11]=0,t[12]=n[0],t[13]=n[1],t[14]=n[2],t[15]=1,t}function $A(t,e){var n=new $n(3),r=-e[0],i=-e[1],a=-e[2],o=e[3],s=e[4],c=e[5],l=e[6],f=e[7],u=r*r+i*i+a*a+o*o;return u>0?(n[0]=(s*o+f*r+c*a-l*i)*2/u,n[1]=(c*o+f*i+l*r-s*a)*2/u,n[2]=(l*o+f*a+s*i-c*r)*2/u):(n[0]=(s*o+f*r+c*a-l*i)*2,n[1]=(c*o+f*i+l*r-s*a)*2,n[2]=(l*o+f*a+s*i-c*r)*2),cE(t,e,n),t}function WA(t,e){return t[0]=e[12],t[1]=e[13],t[2]=e[14],t}function lE(t,e){var n=e[0],r=e[1],i=e[2],a=e[4],o=e[5],s=e[6],c=e[8],l=e[9],f=e[10];return t[0]=Math.hypot(n,r,i),t[1]=Math.hypot(a,o,s),t[2]=Math.hypot(c,l,f),t}function b3(t,e){var n=new $n(3);lE(n,e);var r=1/n[0],i=1/n[1],a=1/n[2],o=e[0]*r,s=e[1]*i,c=e[2]*a,l=e[4]*r,f=e[5]*i,u=e[6]*a,g=e[8]*r,d=e[9]*i,h=e[10]*a,p=o+f+h,m=0;return p>0?(m=Math.sqrt(p+1)*2,t[3]=.25*m,t[0]=(u-d)/m,t[1]=(g-c)/m,t[2]=(s-l)/m):o>f&&o>h?(m=Math.sqrt(1+o-f-h)*2,t[3]=(u-d)/m,t[0]=.25*m,t[1]=(s+l)/m,t[2]=(g+c)/m):f>h?(m=Math.sqrt(1+f-o-h)*2,t[3]=(g-c)/m,t[0]=(s+l)/m,t[1]=.25*m,t[2]=(u+d)/m):(m=Math.sqrt(1+h-o-f)*2,t[3]=(s-l)/m,t[0]=(g+c)/m,t[1]=(u+d)/m,t[2]=.25*m),t}function uE(t,e,n,r){var i=e[0],a=e[1],o=e[2],s=e[3],c=i+i,l=a+a,f=o+o,u=i*c,g=i*l,d=i*f,h=a*l,p=a*f,m=o*f,v=s*c,y=s*l,T=s*f,C=r[0],w=r[1],x=r[2];return t[0]=(1-(h+m))*C,t[1]=(g+T)*C,t[2]=(d-y)*C,t[3]=0,t[4]=(g-T)*w,t[5]=(1-(u+m))*w,t[6]=(p+v)*w,t[7]=0,t[8]=(d+y)*x,t[9]=(p-v)*x,t[10]=(1-(u+h))*x,t[11]=0,t[12]=n[0],t[13]=n[1],t[14]=n[2],t[15]=1,t}function zA(t,e,n,r,i){var a=e[0],o=e[1],s=e[2],c=e[3],l=a+a,f=o+o,u=s+s,g=a*l,d=a*f,h=a*u,p=o*f,m=o*u,v=s*u,y=c*l,T=c*f,C=c*u,w=r[0],x=r[1],O=r[2],M=i[0],A=i[1],_=i[2],k=(1-(p+v))*w,z=(d+C)*w,X=(h-T)*w,Z=(d-C)*x,ce=(1-(g+v))*x,J=(m+y)*x,de=(h+T)*O,Q=(m-y)*O,q=(1-(g+p))*O;return t[0]=k,t[1]=z,t[2]=X,t[3]=0,t[4]=Z,t[5]=ce,t[6]=J,t[7]=0,t[8]=de,t[9]=Q,t[10]=q,t[11]=0,t[12]=n[0]+M-(k*M+Z*A+de*_),t[13]=n[1]+A-(z*M+ce*A+Q*_),t[14]=n[2]+_-(X*M+J*A+q*_),t[15]=1,t}function ih(t,e){var n=e[0],r=e[1],i=e[2],a=e[3],o=n+n,s=r+r,c=i+i,l=n*o,f=r*o,u=r*s,g=i*o,d=i*s,h=i*c,p=a*o,m=a*s,v=a*c;return t[0]=1-u-h,t[1]=f+v,t[2]=g-m,t[3]=0,t[4]=f-v,t[5]=1-l-h,t[6]=d+p,t[7]=0,t[8]=g+m,t[9]=d-p,t[10]=1-l-u,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function jA(t,e,n,r,i,a,o){var s=1/(n-e),c=1/(i-r),l=1/(a-o);return t[0]=a*2*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=a*2*c,t[6]=0,t[7]=0,t[8]=(n+e)*s,t[9]=(i+r)*c,t[10]=(o+a)*l,t[11]=-1,t[12]=0,t[13]=0,t[14]=o*a*2*l,t[15]=0,t}function fE(t,e,n,r,i){var a=1/Math.tan(e/2),o;return t[0]=a/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=a,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,i!=null&&i!==1/0?(o=1/(r-i),t[10]=(i+r)*o,t[14]=2*i*r*o):(t[10]=-1,t[14]=-2*r),t}var HA=fE;function KA(t,e,n,r,i){var a=1/Math.tan(e/2),o;return t[0]=a/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=a,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,i!=null&&i!==1/0?(o=1/(r-i),t[10]=i*o,t[14]=i*r*o):(t[10]=-1,t[14]=-r),t}function qA(t,e,n,r){var i=Math.tan(e.upDegrees*Math.PI/180),a=Math.tan(e.downDegrees*Math.PI/180),o=Math.tan(e.leftDegrees*Math.PI/180),s=Math.tan(e.rightDegrees*Math.PI/180),c=2/(o+s),l=2/(i+a);return t[0]=c,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=l,t[6]=0,t[7]=0,t[8]=-((o-s)*c*.5),t[9]=(i-a)*l*.5,t[10]=r/(n-r),t[11]=-1,t[12]=0,t[13]=0,t[14]=r*n/(n-r),t[15]=0,t}function gE(t,e,n,r,i,a,o){var s=1/(e-n),c=1/(r-i),l=1/(a-o);return t[0]=-2*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*c,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*l,t[11]=0,t[12]=(e+n)*s,t[13]=(i+r)*c,t[14]=(o+a)*l,t[15]=1,t}var G4=gE;function XA(t,e,n,r,i,a,o){var s=1/(e-n),c=1/(r-i),l=1/(a-o);return t[0]=-2*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*c,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=l,t[11]=0,t[12]=(e+n)*s,t[13]=(i+r)*c,t[14]=a*l,t[15]=1,t}function dE(t,e,n,r){var i,a,o,s,c,l,f,u,g,d,h=e[0],p=e[1],m=e[2],v=r[0],y=r[1],T=r[2],C=n[0],w=n[1],x=n[2];return Math.abs(h-C)<Dt&&Math.abs(p-w)<Dt&&Math.abs(m-x)<Dt?Be(t):(f=h-C,u=p-w,g=m-x,d=1/Math.hypot(f,u,g),f*=d,u*=d,g*=d,i=y*g-T*u,a=T*f-v*g,o=v*u-y*f,d=Math.hypot(i,a,o),d?(d=1/d,i*=d,a*=d,o*=d):(i=0,a=0,o=0),s=u*o-g*a,c=g*i-f*o,l=f*a-u*i,d=Math.hypot(s,c,l),d?(d=1/d,s*=d,c*=d,l*=d):(s=0,c=0,l=0),t[0]=i,t[1]=s,t[2]=f,t[3]=0,t[4]=a,t[5]=c,t[6]=u,t[7]=0,t[8]=o,t[9]=l,t[10]=g,t[11]=0,t[12]=-(i*h+a*p+o*m),t[13]=-(s*h+c*p+l*m),t[14]=-(f*h+u*p+g*m),t[15]=1,t)}function YA(t,e,n,r){var i=e[0],a=e[1],o=e[2],s=r[0],c=r[1],l=r[2],f=i-n[0],u=a-n[1],g=o-n[2],d=f*f+u*u+g*g;d>0&&(d=1/Math.sqrt(d),f*=d,u*=d,g*=d);var h=c*g-l*u,p=l*f-s*g,m=s*u-c*f;return d=h*h+p*p+m*m,d>0&&(d=1/Math.sqrt(d),h*=d,p*=d,m*=d),t[0]=h,t[1]=p,t[2]=m,t[3]=0,t[4]=u*m-g*p,t[5]=g*h-f*m,t[6]=f*p-u*h,t[7]=0,t[8]=f,t[9]=u,t[10]=g,t[11]=0,t[12]=i,t[13]=a,t[14]=o,t[15]=1,t}function ZA(t){return"mat4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+")"}function QA(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10],t[11],t[12],t[13],t[14],t[15])}function JA(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t[4]=e[4]+n[4],t[5]=e[5]+n[5],t[6]=e[6]+n[6],t[7]=e[7]+n[7],t[8]=e[8]+n[8],t[9]=e[9]+n[9],t[10]=e[10]+n[10],t[11]=e[11]+n[11],t[12]=e[12]+n[12],t[13]=e[13]+n[13],t[14]=e[14]+n[14],t[15]=e[15]+n[15],t}function pE(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t[4]=e[4]-n[4],t[5]=e[5]-n[5],t[6]=e[6]-n[6],t[7]=e[7]-n[7],t[8]=e[8]-n[8],t[9]=e[9]-n[9],t[10]=e[10]-n[10],t[11]=e[11]-n[11],t[12]=e[12]-n[12],t[13]=e[13]-n[13],t[14]=e[14]-n[14],t[15]=e[15]-n[15],t}function eF(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*n,t[5]=e[5]*n,t[6]=e[6]*n,t[7]=e[7]*n,t[8]=e[8]*n,t[9]=e[9]*n,t[10]=e[10]*n,t[11]=e[11]*n,t[12]=e[12]*n,t[13]=e[13]*n,t[14]=e[14]*n,t[15]=e[15]*n,t}function tF(t,e,n,r){return t[0]=e[0]+n[0]*r,t[1]=e[1]+n[1]*r,t[2]=e[2]+n[2]*r,t[3]=e[3]+n[3]*r,t[4]=e[4]+n[4]*r,t[5]=e[5]+n[5]*r,t[6]=e[6]+n[6]*r,t[7]=e[7]+n[7]*r,t[8]=e[8]+n[8]*r,t[9]=e[9]+n[9]*r,t[10]=e[10]+n[10]*r,t[11]=e[11]+n[11]*r,t[12]=e[12]+n[12]*r,t[13]=e[13]+n[13]*r,t[14]=e[14]+n[14]*r,t[15]=e[15]+n[15]*r,t}function nF(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]&&t[9]===e[9]&&t[10]===e[10]&&t[11]===e[11]&&t[12]===e[12]&&t[13]===e[13]&&t[14]===e[14]&&t[15]===e[15]}function rF(t,e){var n=t[0],r=t[1],i=t[2],a=t[3],o=t[4],s=t[5],c=t[6],l=t[7],f=t[8],u=t[9],g=t[10],d=t[11],h=t[12],p=t[13],m=t[14],v=t[15],y=e[0],T=e[1],C=e[2],w=e[3],x=e[4],O=e[5],M=e[6],A=e[7],_=e[8],k=e[9],z=e[10],X=e[11],Z=e[12],ce=e[13],J=e[14],de=e[15];return Math.abs(n-y)<=Dt*Math.max(1,Math.abs(n),Math.abs(y))&&Math.abs(r-T)<=Dt*Math.max(1,Math.abs(r),Math.abs(T))&&Math.abs(i-C)<=Dt*Math.max(1,Math.abs(i),Math.abs(C))&&Math.abs(a-w)<=Dt*Math.max(1,Math.abs(a),Math.abs(w))&&Math.abs(o-x)<=Dt*Math.max(1,Math.abs(o),Math.abs(x))&&Math.abs(s-O)<=Dt*Math.max(1,Math.abs(s),Math.abs(O))&&Math.abs(c-M)<=Dt*Math.max(1,Math.abs(c),Math.abs(M))&&Math.abs(l-A)<=Dt*Math.max(1,Math.abs(l),Math.abs(A))&&Math.abs(f-_)<=Dt*Math.max(1,Math.abs(f),Math.abs(_))&&Math.abs(u-k)<=Dt*Math.max(1,Math.abs(u),Math.abs(k))&&Math.abs(g-z)<=Dt*Math.max(1,Math.abs(g),Math.abs(z))&&Math.abs(d-X)<=Dt*Math.max(1,Math.abs(d),Math.abs(X))&&Math.abs(h-Z)<=Dt*Math.max(1,Math.abs(h),Math.abs(Z))&&Math.abs(p-ce)<=Dt*Math.max(1,Math.abs(p),Math.abs(ce))&&Math.abs(m-J)<=Dt*Math.max(1,Math.abs(m),Math.abs(J))&&Math.abs(v-de)<=Dt*Math.max(1,Math.abs(v),Math.abs(de))}var ah=vt,iF=pE;const Bg=Object.freeze(Object.defineProperty({__proto__:null,add:JA,adjoint:AA,clone:NA,copy:nn,create:Lc,determinant:FA,equals:rF,exactEquals:nF,frob:QA,fromQuat:ih,fromQuat2:$A,fromRotation:B4,fromRotationTranslation:cE,fromRotationTranslationScale:uE,fromRotationTranslationScaleOrigin:zA,fromScaling:U4,fromTranslation:d2,fromValues:sE,fromXRotation:UA,fromYRotation:BA,fromZRotation:GA,frustum:jA,getRotation:b3,getScaling:lE,getTranslation:WA,identity:Be,invert:Ln,lookAt:dE,mul:ah,multiply:vt,multiplyScalar:eF,multiplyScalarAndAdd:tF,ortho:G4,orthoNO:gE,orthoZO:XA,perspective:HA,perspectiveFromFieldOfView:qA,perspectiveNO:fE,perspectiveZO:KA,rotate:Ma,rotateX:k4,rotateY:A4,rotateZ:F4,scale:ms,set:kA,str:ZA,sub:iF,subtract:pE,targetTo:YA,translate:en,transpose:ft},Symbol.toStringTag,{value:"Module"}));function Le(){var t=new $n(3);return $n!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function Cc(t){var e=t[0],n=t[1],r=t[2];return Math.hypot(e,n,r)}function Cn(t,e,n){var r=new $n(3);return r[0]=t,r[1]=e,r[2]=n,r}function aF(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function bt(t,e,n,r){return t[0]=e,t[1]=n,t[2]=r,t}function da(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t}function tn(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t}function oF(t,e,n){return t[0]=e[0]*n[0],t[1]=e[1]*n[1],t[2]=e[2]*n[2],t}function sF(t,e,n){return t[0]=e[0]/n[0],t[1]=e[1]/n[1],t[2]=e[2]/n[2],t}function Br(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t}function vr(t,e,n,r){return t[0]=e[0]+n[0]*r,t[1]=e[1]+n[1]*r,t[2]=e[2]+n[2]*r,t}function Gg(t,e){var n=e[0]-t[0],r=e[1]-t[1],i=e[2]-t[2];return Math.hypot(n,r,i)}function as(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t}function hE(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t}function wn(t,e){var n=e[0],r=e[1],i=e[2],a=n*n+r*r+i*i;return a>0&&(a=1/Math.sqrt(a)),t[0]=e[0]*a,t[1]=e[1]*a,t[2]=e[2]*a,t}function Qe(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function an(t,e,n){var r=e[0],i=e[1],a=e[2],o=n[0],s=n[1],c=n[2];return t[0]=i*c-a*s,t[1]=a*o-r*c,t[2]=r*s-i*o,t}function pt(t,e,n){var r=e[0],i=e[1],a=e[2],o=n[3]*r+n[7]*i+n[11]*a+n[15];return o=o||1,t[0]=(n[0]*r+n[4]*i+n[8]*a+n[12])/o,t[1]=(n[1]*r+n[5]*i+n[9]*a+n[13])/o,t[2]=(n[2]*r+n[6]*i+n[10]*a+n[14])/o,t}function rp(t,e,n){var r=e[0],i=e[1],a=e[2];return t[0]=r*n[0]+i*n[3]+a*n[6],t[1]=r*n[1]+i*n[4]+a*n[7],t[2]=r*n[2]+i*n[5]+a*n[8],t}function mE(t,e){var n=t[0],r=t[1],i=t[2],a=e[0],o=e[1],s=e[2],c=Math.sqrt(n*n+r*r+i*i),l=Math.sqrt(a*a+o*o+s*s),f=c*l,u=f&&Qe(t,e)/f;return Math.acos(Math.min(Math.max(u,-1),1))}function cF(t){return t[0]=0,t[1]=0,t[2]=0,t}function c9(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]}function l9(t,e){var n=t[0],r=t[1],i=t[2],a=e[0],o=e[1],s=e[2];return Math.abs(n-a)<=Dt*Math.max(1,Math.abs(n),Math.abs(a))&&Math.abs(r-o)<=Dt*Math.max(1,Math.abs(r),Math.abs(o))&&Math.abs(i-s)<=Dt*Math.max(1,Math.abs(i),Math.abs(s))}var _n=tn,lF=oF,oh=Cc;(function(){var t=Le();return function(e,n,r,i,a,o){var s,c;for(n||(n=3),r||(r=0),i?c=Math.min(i*n+r,e.length):c=e.length,s=r;s<c;s+=n)t[0]=e[s],t[1]=e[s+1],t[2]=e[s+2],a(t,t,o),e[s]=t[0],e[s+1]=t[1],e[s+2]=t[2];return e}})();function uF(){var t=new $n(4);return $n!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}function fF(t,e,n,r){var i=new $n(4);return i[0]=t,i[1]=e,i[2]=n,i[3]=r,i}function u9(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t}function gF(t,e){var n=e[0],r=e[1],i=e[2],a=e[3],o=n*n+r*r+i*i+a*a;return o>0&&(o=1/Math.sqrt(o)),t[0]=n*o,t[1]=r*o,t[2]=i*o,t[3]=a*o,t}function V0(t,e,n){var r=e[0],i=e[1],a=e[2],o=e[3];return t[0]=n[0]*r+n[4]*i+n[8]*a+n[12]*o,t[1]=n[1]*r+n[5]*i+n[9]*a+n[13]*o,t[2]=n[2]*r+n[6]*i+n[10]*a+n[14]*o,t[3]=n[3]*r+n[7]*i+n[11]*a+n[15]*o,t}(function(){var t=uF();return function(e,n,r,i,a,o){var s,c;for(n||(n=4),r||(r=0),i?c=Math.min(i*n+r,e.length):c=e.length,s=r;s<c;s+=n)t[0]=e[s],t[1]=e[s+1],t[2]=e[s+2],t[3]=e[s+3],a(t,t,o),e[s]=t[0],e[s+1]=t[1],e[s+2]=t[2],e[s+3]=t[3];return e}})();function Q0(){var t=new $n(4);return $n!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function $4(t,e,n){n=n*.5;var r=Math.sin(n);return t[0]=r*e[0],t[1]=r*e[1],t[2]=r*e[2],t[3]=Math.cos(n),t}function dF(t,e){var n=Math.acos(e[3])*2,r=Math.sin(n/2);return r>Dt?(t[0]=e[0]/r,t[1]=e[1]/r,t[2]=e[2]/r):(t[0]=1,t[1]=0,t[2]=0),n}function f9(t,e,n){var r=e[0],i=e[1],a=e[2],o=e[3],s=n[0],c=n[1],l=n[2],f=n[3];return t[0]=r*f+o*s+i*l-a*c,t[1]=i*f+o*c+a*s-r*l,t[2]=a*f+o*l+r*c-i*s,t[3]=o*f-r*s-i*c-a*l,t}function ip(t,e,n,r){var i=e[0],a=e[1],o=e[2],s=e[3],c=n[0],l=n[1],f=n[2],u=n[3],g,d,h,p,m;return d=i*c+a*l+o*f+s*u,d<0&&(d=-d,c=-c,l=-l,f=-f,u=-u),1-d>Dt?(g=Math.acos(d),h=Math.sin(g),p=Math.sin((1-r)*g)/h,m=Math.sin(r*g)/h):(p=1-r,m=r),t[0]=p*i+m*c,t[1]=p*a+m*l,t[2]=p*o+m*f,t[3]=p*s+m*u,t}function pF(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t}function hF(t,e){var n=e[0]+e[4]+e[8],r;if(n>0)r=Math.sqrt(n+1),t[3]=.5*r,r=.5/r,t[0]=(e[5]-e[7])*r,t[1]=(e[6]-e[2])*r,t[2]=(e[1]-e[3])*r;else{var i=0;e[4]>e[0]&&(i=1),e[8]>e[i*3+i]&&(i=2);var a=(i+1)%3,o=(i+2)%3;r=Math.sqrt(e[i*3+i]-e[a*3+a]-e[o*3+o]+1),t[i]=.5*r,r=.5/r,t[3]=(e[a*3+o]-e[o*3+a])*r,t[a]=(e[a*3+i]+e[i*3+a])*r,t[o]=(e[o*3+i]+e[i*3+o])*r}return t}var g9=fF,vE=gF;(function(){var t=Le(),e=Cn(1,0,0),n=Cn(0,1,0);return function(r,i,a){var o=Qe(i,a);return o<-.999999?(an(t,e,i),oh(t)<1e-6&&an(t,n,i),wn(t,t),$4(r,t,Math.PI),r):o>.999999?(r[0]=0,r[1]=0,r[2]=0,r[3]=1,r):(an(t,i,a),r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=1+o,vE(r,r))}})();(function(){var t=Q0(),e=Q0();return function(n,r,i,a,o,s){return ip(t,r,o,s),ip(e,i,a,s),ip(n,t,e,2*s*(1-s)),n}})();(function(){var t=P4();return function(e,n,r,i){return t[0]=r[0],t[3]=r[1],t[6]=r[2],t[1]=i[0],t[4]=i[1],t[7]=i[2],t[2]=-n[0],t[5]=-n[1],t[8]=-n[2],vE(e,hF(e,t))}})();function os(){var t=new $n(2);return $n!=Float32Array&&(t[0]=0,t[1]=0),t}function d9(t,e){var n=new $n(2);return n[0]=t,n[1]=e,n}function au(t,e,n){return t[0]=e,t[1]=n,t}function W4(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t}function Ru(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t}function p9(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t}function yr(t,e){var n=e[0]-t[0],r=e[1]-t[1];return Math.hypot(n,r)}function yE(t,e){var n=e[0],r=e[1],i=n*n+r*r;return i>0&&(i=1/Math.sqrt(i)),t[0]=e[0]*i,t[1]=e[1]*i,t}function mF(t,e){return t[0]*e[0]+t[1]*e[1]}var sh=Ru,z4=yr;(function(){var t=os();return function(e,n,r,i,a,o){var s,c;for(n||(n=2),r||(r=0),i?c=Math.min(i*n+r,e.length):c=e.length,s=r;s<c;s+=n)t[0]=e[s],t[1]=e[s+1],a(t,t,o),e[s]=t[0],e[s+1]=t[1];return e}})();const ss={ARRAY_BUFFER:0,ELEMENT_ARRAY_BUFFER:1,TEXTURE_BUFFER:2};var TE={ObjectType:ss};const{ObjectType:ap}=TE,vF={};function yF(t,e){e.classHierarchy.push("vtkOpenGLBufferObject");function n(s){switch(s){case ap.ELEMENT_ARRAY_BUFFER:return e.context.ELEMENT_ARRAY_BUFFER;case ap.TEXTURE_BUFFER:if("TEXTURE_BUFFER"in e.context)return e.context.TEXTURE_BUFFER;case ap.ARRAY_BUFFER:default:return e.context.ARRAY_BUFFER}}let r=null,i=null,a=!0,o="";t.getType=()=>r,t.setType=s=>{r=s},t.getHandle=()=>i,t.isReady=()=>a===!1,t.generateBuffer=s=>{const c=n(s);return i===null&&(i=e.context.createBuffer(),r=s),n(r)===c},t.upload=(s,c)=>t.generateBuffer(c)?(e.context.bindBuffer(n(r),i),e.context.bufferData(n(r),s,e.context.STATIC_DRAW),e.allocatedGPUMemoryInBytes=s.length*s.BYTES_PER_ELEMENT,a=!1,!0):(o="Trying to upload array buffer to incompatible buffer.",!1),t.bind=()=>i?(e.context.bindBuffer(n(r),i),!0):!1,t.release=()=>i?(e.context.bindBuffer(n(r),null),!0):!1,t.releaseGraphicsResources=()=>{i!==null&&(e.context.bindBuffer(n(r),null),e.context.deleteBuffer(i),i=null,e.allocatedGPUMemoryInBytes=0)},t.setOpenGLRenderWindow=s=>{e._openGLRenderWindow!==s&&(t.releaseGraphicsResources(),e._openGLRenderWindow=s,e.context=null,s&&(e.context=e._openGLRenderWindow.getContext()))},t.getError=()=>o}const TF={objectType:ap.ARRAY_BUFFER,context:null,allocatedGPUMemoryInBytes:0};function CE(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,TF,n),P.obj(t,e),P.get(t,e,["_openGLRenderWindow","allocatedGPUMemoryInBytes"]),P.moveToProtected(t,e,["openGLRenderWindow"]),yF(t,e)}const CF=P.newInstance(CE);var ns={newInstance:CF,extend:CE,...vF,...TE};const wE={FLAT:0,GOURAUD:1,PHONG:2},_r={POINTS:0,WIREFRAME:1,SURFACE:2},wF=wE;var xE={Shading:wE,Representation:_r,Interpolation:wF};const{vtkErrorMacro:h9}=P;function xF(t,e){const n=new Float64Array(3);hE(n,e);const r=new Float64Array(16);return uE(r,Q0(),t,n),r}function SF(t,e){return t===null||e===null?!1:!(c9(t,[0,0,0])&&c9(e,[1,1,1]))}function EF(t,e){e.classHierarchy.push("vtkOpenGLCellArrayBufferObject"),t.setType(ss.ARRAY_BUFFER),t.createVBO=function(n,r,i,a){let o=arguments.length>4&&arguments[4]!==void 0?arguments[4]:null;if(!n.getData()||!n.getData().length)return e.elementCount=0,0;e.blockSize=3,e.vertexOffset=0,e.normalOffset=0,e.tCoordOffset=0,e.tCoordComponents=0,e.colorComponents=0,e.colorOffset=0,e.customData=[];const s=a.points.getData();let c=null,l=null,f=null;const u=a.colors?a.colors.getNumberOfComponents():0,g=a.tcoords?a.tcoords.getNumberOfComponents():0;a.normals&&(e.normalOffset=4*e.blockSize,e.blockSize+=3,c=a.normals.getData()),a.customAttributes&&a.customAttributes.forEach(q=>{q&&(e.customData.push({data:q.getData(),offset:4*e.blockSize,components:q.getNumberOfComponents(),name:q.getName()}),e.blockSize+=q.getNumberOfComponents())}),a.tcoords&&(e.tCoordOffset=4*e.blockSize,e.tCoordComponents=g,e.blockSize+=g,l=a.tcoords.getData()),a.colors?(e.colorComponents=a.colors.getNumberOfComponents(),e.colorOffset=0,f=a.colors.getData(),e.colorBO||(e.colorBO=ns.newInstance()),e.colorBO.setOpenGLRenderWindow(e._openGLRenderWindow)):e.colorBO=null,e.stride=4*e.blockSize;let d=0,h=0,p=0,m=0,v=0,y=0,T;const C={anythingToPoints(q,j,ie,ue){for(let le=0;le<q;++le)T(j[ie+le],ue)},linesToWireframe(q,j,ie,ue){for(let le=0;le<q-1;++le)T(j[ie+le],ue),T(j[ie+le+1],ue)},polysToWireframe(q,j,ie,ue){if(q>2)for(let le=0;le<q;++le)T(j[ie+le],ue),T(j[ie+(le+1)%q],ue)},stripsToWireframe(q,j,ie,ue){if(q>2){for(let le=0;le<q-1;++le)T(j[ie+le],ue),T(j[ie+le+1],ue);for(let le=0;le<q-2;le++)T(j[ie+le],ue),T(j[ie+le+2],ue)}},polysToSurface(q,j,ie,ue){for(let le=0;le<q-2;le++)T(j[ie+0],ue),T(j[ie+le+1],ue),T(j[ie+le+2],ue)},stripsToSurface(q,j,ie,ue){for(let le=0;le<q-2;le++)T(j[ie+le],ue),T(j[ie+le+1+le%2],ue),T(j[ie+le+1+(le+1)%2],ue)}},w={anythingToPoints(q,j){return q},linesToWireframe(q,j){return q>1?(q-1)*2:0},polysToWireframe(q,j){return q>2?q*2:0},stripsToWireframe(q,j){return q>2?q*4-6:0},polysToSurface(q,j){return q>2?(q-2)*3:0},stripsToSurface(q,j,ie){return q>2?(q-2)*3:0}};let x=null,O=null;i===_r.POINTS||r==="verts"?(x=C.anythingToPoints,O=w.anythingToPoints):i===_r.WIREFRAME||r==="lines"?(x=C[`${r}ToWireframe`],O=w[`${r}ToWireframe`]):(x=C[`${r}ToSurface`],O=w[`${r}ToSurface`]);const M=n.getData(),A=M.length;let _=0;for(let q=0;q<A;)_+=O(M[q],M),q+=M[q]+1;let k=null;const z=new Float32Array(_*e.blockSize);f&&(k=new Uint8Array(_*4));let X=0,Z=0,ce=0,J=0;for(let q=0;q<3;++q){const j=a.points.getRange(q),ie=j[1]-j[0];ce+=ie*ie;const ue=.5*(j[1]+j[0]);J+=ue*ue}if(ce>0&&(Math.abs(J)/ce>1e6||Math.abs(Math.log10(ce))>3||ce===0&&J>1e6)){const q=new Float64Array(3),j=new Float64Array(3);for(let ie=0;ie<3;++ie){const ue=a.points.getRange(ie),le=ue[1]-ue[0];q[ie]=.5*(ue[1]+ue[0]),j[ie]=le>0?1/le:1}t.setCoordShiftAndScale(q,j)}else e.coordShiftAndScaleEnabled===!0&&t.setCoordShiftAndScale(null,null);if(o)if(!o.points&&!o.cells)o.points=new Int32Array(_),o.cells=new Int32Array(_);else{const q=new Int32Array(_+o.points.length);q.set(o.points),o.points=q;const j=new Int32Array(_+o.cells.length);j.set(o.cells),o.cells=j}let Q=a.vertexOffset;T=function(j,ie){if(o&&(o.points[Q]=j,o.cells[Q]=y+a.cellOffset),++Q,d=j*3,e.coordShiftAndScaleEnabled?(z[X++]=(s[d++]-e.coordShift[0])*e.coordScale[0],z[X++]=(s[d++]-e.coordShift[1])*e.coordScale[1],z[X++]=(s[d++]-e.coordShift[2])*e.coordScale[2]):(z[X++]=s[d++],z[X++]=s[d++],z[X++]=s[d++]),c!==null&&(a.haveCellNormals?h=(y+a.cellOffset)*3:h=j*3,z[X++]=c[h++],z[X++]=c[h++],z[X++]=c[h++]),e.customData.forEach(ue=>{v=j*ue.components;for(let le=0;le<ue.components;++le)z[X++]=ue.data[v++]}),l!==null){a.useTCoordsPerCell?p=ie*g:p=j*g;for(let ue=0;ue<g;++ue)z[X++]=l[p++]}f!==null&&(a.haveCellScalars?m=(y+a.cellOffset)*u:m=j*u,k[Z++]=f[m++],k[Z++]=f[m++],k[Z++]=f[m++],k[Z++]=u===4?f[m++]:255)};for(let q=0;q<A;q+=M[q]+1,y++)x(M[q],M,q+1,y+a.cellOffset);return e.elementCount=_,t.upload(z,ss.ARRAY_BUFFER),e.colorBO&&(e.colorBOStride=4,e.colorBO.upload(k,ss.ARRAY_BUFFER)),y},t.setCoordShiftAndScale=(n,r)=>{if(n!==null&&(n.constructor!==Float64Array||n.length!==3)){h9("Wrong type for coordShift, expected vec3 or null");return}if(r!==null&&(r.constructor!==Float64Array||r.length!==3)){h9("Wrong type for coordScale, expected vec3 or null");return}(e.coordShift===null||n===null||!l9(n,e.coordShift))&&(e.coordShift=n),(e.coordScale===null||r===null||!l9(r,e.coordScale))&&(e.coordScale=r),e.coordShiftAndScaleEnabled=SF(e.coordShift,e.coordScale),e.coordShiftAndScaleEnabled?e.inverseShiftAndScaleMatrix=xF(e.coordShift,e.coordScale):e.inverseShiftAndScaleMatrix=null}}const OF={elementCount:0,stride:0,colorBOStride:0,vertexOffset:0,normalOffset:0,tCoordOffset:0,tCoordComponents:0,colorOffset:0,colorComponents:0,tcoordBO:null,customData:[],coordShift:null,coordScale:null,coordShiftAndScaleEnabled:!1,inverseShiftAndScaleMatrix:null};function SE(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,OF,n),ns.extend(t,e,n),P.setGet(t,e,["colorBO","elementCount","stride","colorBOStride","vertexOffset","normalOffset","tCoordOffset","tCoordComponents","colorOffset","colorComponents","customData"]),P.get(t,e,["coordShift","coordScale","coordShiftAndScaleEnabled","inverseShiftAndScaleMatrix"]),EF(t,e)}const DF=P.newInstance(SE);var RF={newInstance:DF,extend:SE};const{vtkErrorMacro:MF}=P;function _F(t,e){e.classHierarchy.push("vtkShader"),t.compile=()=>{let n=e.context.VERTEX_SHADER;if(!e.source||!e.source.length||e.shaderType==="Unknown")return!1;switch(e.handle!==0&&(e.context.deleteShader(e.handle),e.handle=0),e.shaderType){case"Fragment":n=e.context.FRAGMENT_SHADER;break;case"Vertex":default:n=e.context.VERTEX_SHADER;break}if(e.handle=e.context.createShader(n),e.context.shaderSource(e.handle,e.source),e.context.compileShader(e.handle),!e.context.getShaderParameter(e.handle,e.context.COMPILE_STATUS)){const i=e.context.getShaderInfoLog(e.handle);return MF(`Error compiling shader '${e.source}': ${i}`),e.context.deleteShader(e.handle),e.handle=0,!1}return!0},t.cleanup=()=>{e.shaderType==="Unknown"||e.handle===0||(e.context.deleteShader(e.handle),e.handle=0,e.dirty=!0)}}const bF={shaderType:"Unknown",source:"",error:"",handle:0,dirty:!1,context:null};function EE(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,bF,n),P.obj(t,e),P.setGet(t,e,["shaderType","source","error","handle","context"]),_F(t,e)}const LF=P.newInstance(EE,"vtkShader");var M5={newInstance:LF,extend:EE};const{vtkErrorMacro:no}=P;function IF(t,e,n,r){const i=typeof n=="string"?n:n.join(`
`),a=r===!1?e:new RegExp(e,"g"),o=t.replace(a,i);return{replace:o!==i,result:o}}function VF(t,e){e.classHierarchy.push("vtkShaderProgram"),t.compileShader=()=>e.vertexShader.compile()?e.fragmentShader.compile()?!t.attachShader(e.vertexShader)||!t.attachShader(e.fragmentShader)?(no(e.error),0):t.link()?(t.setCompiled(!0),1):(no(`Links failed: ${e.error}`),0):(no(e.fragmentShader.getSource().split(`
`).map((n,r)=>`${r}: ${n}`).join(`
`)),no(e.fragmentShader.getError()),0):(no(e.vertexShader.getSource().split(`
`).map((n,r)=>`${r}: ${n}`).join(`
`)),no(e.vertexShader.getError()),0),t.cleanup=()=>{e.shaderType==="Unknown"||e.handle===0||(t.release(),e.vertexShaderHandle!==0&&(e.context.detachShader(e.handle,e.vertexShaderHandle),e.vertexShaderHandle=0),e.fragmentShaderHandle!==0&&(e.context.detachShader(e.handle,e.fragmentShaderHandle),e.fragmentShaderHandle=0),e.context.deleteProgram(e.handle),e.handle=0,t.setCompiled(!1))},t.bind=()=>!e.linked&&!t.link()?!1:(e.context.useProgram(e.handle),t.setBound(!0),!0),t.isBound=()=>!!e.bound,t.release=()=>{e.context.useProgram(null),t.setBound(!1)},t.setContext=n=>{e.vertexShader.setContext(n),e.fragmentShader.setContext(n),e.geometryShader.setContext(n)},t.link=()=>{if(e.linked)return!0;if(e.handle===0)return e.error="Program has not been initialized, and/or does not have shaders.",!1;if(e.uniformLocs={},e.context.linkProgram(e.handle),!e.context.getProgramParameter(e.handle,e.context.LINK_STATUS)){const r=e.context.getProgramInfoLog(e.handle);return no(`Error linking shader ${r}`),e.handle=0,!1}return t.setLinked(!0),e.attributeLocs={},!0},t.setUniformMatrix=(n,r)=>{const i=t.findUniform(n);if(i===-1)return e.error=`Could not set uniform ${n} . No such uniform.`,!1;const a=new Float32Array(r);return e.context.uniformMatrix4fv(i,!1,a),!0},t.setUniformMatrix3x3=(n,r)=>{const i=t.findUniform(n);if(i===-1)return e.error=`Could not set uniform ${n} . No such uniform.`,!1;const a=new Float32Array(r);return e.context.uniformMatrix3fv(i,!1,a),!0},t.setUniformf=(n,r)=>{const i=t.findUniform(n);return i===-1?(e.error=`Could not set uniform ${n} . No such uniform.`,!1):(e.context.uniform1f(i,r),!0)},t.setUniformfv=(n,r)=>{const i=t.findUniform(n);return i===-1?(e.error=`Could not set uniform ${n} . No such uniform.`,!1):(e.context.uniform1fv(i,r),!0)},t.setUniformi=(n,r)=>{const i=t.findUniform(n);return i===-1?(e.error=`Could not set uniform ${n} . No such uniform.`,!1):(e.context.uniform1i(i,r),!0)},t.setUniformiv=(n,r)=>{const i=t.findUniform(n);return i===-1?(e.error=`Could not set uniform ${n} . No such uniform.`,!1):(e.context.uniform1iv(i,r),!0)},t.setUniform2f=(n,r,i)=>{const a=t.findUniform(n);if(a===-1)return e.error=`Could not set uniform ${n} . No such uniform.`,!1;if(i===void 0)throw new RangeError("Invalid number of values for array");return e.context.uniform2f(a,r,i),!0},t.setUniform2fv=(n,r)=>{const i=t.findUniform(n);return i===-1?(e.error=`Could not set uniform ${n} . No such uniform.`,!1):(e.context.uniform2fv(i,r),!0)},t.setUniform2i=(n,r,i)=>{const a=t.findUniform(n);if(a===-1)return e.error=`Could not set uniform ${n} . No such uniform.`,!1;if(i===void 0)throw new RangeError("Invalid number of values for array");return e.context.uniform2i(a,r,i),!0},t.setUniform2iv=(n,r)=>{const i=t.findUniform(n);return i===-1?(e.error=`Could not set uniform ${n} . No such uniform.`,!1):(e.context.uniform2iv(i,r),!0)},t.setUniform3f=(n,r,i,a)=>{const o=t.findUniform(n);if(o===-1)return e.error=`Could not set uniform ${n} . No such uniform.`,!1;if(a===void 0)throw new RangeError("Invalid number of values for array");return e.context.uniform3f(o,r,i,a),!0},t.setUniform3fArray=(n,r)=>{const i=t.findUniform(n);if(i===-1)return e.error=`Could not set uniform ${n} . No such uniform.`,!1;if(!Array.isArray(r)||r.length!==3)throw new RangeError("Invalid number of values for array");return e.context.uniform3f(i,r[0],r[1],r[2]),!0},t.setUniform3fv=(n,r)=>{const i=t.findUniform(n);return i===-1?(e.error=`Could not set uniform ${n} . No such uniform.`,!1):(e.context.uniform3fv(i,r),!0)},t.setUniform3i=function(n){const r=t.findUniform(n);if(r===-1)return e.error=`Could not set uniform ${n} . No such uniform.`,!1;for(var i=arguments.length,a=new Array(i>1?i-1:0),o=1;o<i;o++)a[o-1]=arguments[o];let s=a;if(s.length===1&&Array.isArray(s[0])&&(s=s[0]),s.length!==3)throw new RangeError("Invalid number of values for array");return e.context.uniform3i(r,s[0],s[1],s[2]),!0},t.setUniform3iv=(n,r)=>{const i=t.findUniform(n);return i===-1?(e.error=`Could not set uniform ${n} . No such uniform.`,!1):(e.context.uniform3iv(i,r),!0)},t.setUniform4f=function(n){const r=t.findUniform(n);if(r===-1)return e.error=`Could not set uniform ${n} . No such uniform.`,!1;for(var i=arguments.length,a=new Array(i>1?i-1:0),o=1;o<i;o++)a[o-1]=arguments[o];let s=a;if(s.length===1&&Array.isArray(s[0])&&(s=s[0]),s.length!==4)throw new RangeError("Invalid number of values for array");return e.context.uniform4f(r,s[0],s[1],s[2],s[3]),!0},t.setUniform4fv=(n,r)=>{const i=t.findUniform(n);return i===-1?(e.error=`Could not set uniform ${n} . No such uniform.`,!1):(e.context.uniform4fv(i,r),!0)},t.setUniform4i=function(n){const r=t.findUniform(n);if(r===-1)return e.error=`Could not set uniform ${n} . No such uniform.`,!1;for(var i=arguments.length,a=new Array(i>1?i-1:0),o=1;o<i;o++)a[o-1]=arguments[o];let s=a;if(s.length===1&&Array.isArray(s[0])&&(s=s[0]),s.length!==4)throw new RangeError("Invalid number of values for array");return e.context.uniform4i(r,s[0],s[1],s[2],s[3]),!0},t.setUniform4iv=(n,r)=>{const i=t.findUniform(n);return i===-1?(e.error=`Could not set uniform ${n} . No such uniform.`,!1):(e.context.uniform4iv(i,r),!0)},t.findUniform=n=>{if(!n||!e.linked)return-1;let r=e.uniformLocs[n];return r!==void 0?r:(r=e.context.getUniformLocation(e.handle,n),r===null?(e.error=`Uniform ${n} not found in current shader program.`,e.uniformLocs[n]=-1,-1):(e.uniformLocs[n]=r,r))},t.isUniformUsed=n=>{if(!n)return!1;let r=e.uniformLocs[n];return r!==void 0?r!==null:e.linked?(r=e.context.getUniformLocation(e.handle,n),e.uniformLocs[n]=r,r!==null):(no("attempt to find uniform when the shader program is not linked"),!1)},t.isAttributeUsed=n=>{if(!n)return!1;if(n in e.attributeLocs)return!0;if(!e.linked)return no("attempt to find uniform when the shader program is not linked"),!1;const r=e.context.getAttribLocation(e.handle,n);return r===-1?!1:(e.attributeLocs[n]=r,!0)},t.attachShader=n=>{if(n.getHandle()===0)return e.error="Shader object was not initialized, cannot attach it.",!1;if(n.getShaderType()==="Unknown")return e.error="Shader object is of type Unknown and cannot be used.",!1;if(e.handle===0){const r=e.context.createProgram();if(r===0)return e.error="Could not create shader program.",!1;e.handle=r,e.linked=!1}return n.getShaderType()==="Vertex"&&(e.vertexShaderHandle!==0&&e.context.detachShader(e.handle,e.vertexShaderHandle),e.vertexShaderHandle=n.getHandle()),n.getShaderType()==="Fragment"&&(e.fragmentShaderHandle!==0&&e.context.detachShader(e.handle,e.fragmentShaderHandle),e.fragmentShaderHandle=n.getHandle()),e.context.attachShader(e.handle,n.getHandle()),t.setLinked(!1),!0},t.detachShader=n=>{if(n.getHandle()===0)return e.error="shader object was not initialized, cannot attach it.",!1;if(n.getShaderType()==="Unknown")return e.error="Shader object is of type Unknown and cannot be used.",!1;switch(e.handle===0&&(e.error="This shader program has not been initialized yet."),n.getShaderType()){case"Vertex":return e.vertexShaderHandle!==n.getHandle()?(e.error="The supplied shader was not attached to this program.",!1):(e.context.detachShader(e.handle,n.getHandle()),e.vertexShaderHandle=0,e.linked=!1,!0);case"Fragment":return e.fragmentShaderHandle!==n.getHandle()?(e.error="The supplied shader was not attached to this program.",!1):(e.context.detachShader(e.handle,n.getHandle()),e.fragmentShaderHandle=0,e.linked=!1,!0);default:return!1}},t.setContext=n=>{e.context=n,e.vertexShader.setContext(n),e.fragmentShader.setContext(n),e.geometryShader.setContext(n)},t.setLastCameraMTime=n=>{e.lastCameraMTime=n}}const PF={vertexShaderHandle:0,fragmentShaderHandle:0,geometryShaderHandle:0,vertexShader:null,fragmentShader:null,geometryShader:null,linked:!1,bound:!1,compiled:!1,error:"",handle:0,numberOfOutputs:0,attributesLocs:null,uniformLocs:null,md5Hash:0,context:null,lastCameraMTime:null};function OE(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,PF,n),e.attributesLocs={},e.uniformLocs={},e.vertexShader=M5.newInstance(),e.vertexShader.setShaderType("Vertex"),e.fragmentShader=M5.newInstance(),e.fragmentShader.setShaderType("Fragment"),e.geometryShader=M5.newInstance(),e.geometryShader.setShaderType("Geometry"),P.obj(t,e),P.get(t,e,["lastCameraMTime"]),P.setGet(t,e,["error","handle","compiled","bound","md5Hash","vertexShader","fragmentShader","geometryShader","linked"]),VF(t,e)}const NF=P.newInstance(OE,"vtkShaderProgram");var te={newInstance:NF,extend:OE,substitute:IF};function kF(t,e){e.classHierarchy.push("vtkOpenGLVertexArrayObject"),t.exposedMethod=()=>{},t.initialize=()=>{e.instancingExtension=null,e._openGLRenderWindow.getWebgl2()||(e.instancingExtension=e.context.getExtension("ANGLE_instanced_arrays")),!e.forceEmulation&&e._openGLRenderWindow&&e._openGLRenderWindow.getWebgl2()?(e.extension=null,e.supported=!0,e.handleVAO=e.context.createVertexArray()):(e.extension=e.context.getExtension("OES_vertex_array_object"),!e.forceEmulation&&e.extension?(e.supported=!0,e.handleVAO=e.extension.createVertexArrayOES()):e.supported=!1)},t.isReady=()=>e.handleVAO!==0||e.supported===!1,t.bind=()=>{if(t.isReady()||t.initialize(),t.isReady()&&e.supported)e.extension?e.extension.bindVertexArrayOES(e.handleVAO):e.context.bindVertexArray(e.handleVAO);else if(t.isReady()){const n=e.context;for(let r=0;r<e.buffers.length;++r){const i=e.buffers[r];e.context.bindBuffer(n.ARRAY_BUFFER,i.buffer);for(let a=0;a<i.attributes.length;++a){const o=i.attributes[a],s=o.isMatrix?o.size:1;for(let c=0;c<s;++c)n.enableVertexAttribArray(o.index+c),n.vertexAttribPointer(o.index+c,o.size,o.type,o.normalize,o.stride,o.offset+o.stride*c/o.size),o.divisor>0&&(e.instancingExtension?e.instancingExtension.vertexAttribDivisorANGLE(o.index+c,1):n.vertexAttribDivisor(o.index+c,1))}}}},t.release=()=>{if(t.isReady()&&e.supported)e.extension?e.extension.bindVertexArrayOES(null):e.context.bindVertexArray(null);else if(t.isReady()){const n=e.context;for(let r=0;r<e.buffers.length;++r){const i=e.buffers[r];e.context.bindBuffer(n.ARRAY_BUFFER,i.buffer);for(let a=0;a<i.attributes.length;++a){const o=i.attributes[a],s=o.isMatrix?o.size:1;for(let c=0;c<s;++c)n.enableVertexAttribArray(o.index+c),n.vertexAttribPointer(o.index+c,o.size,o.type,o.normalize,o.stride,o.offset+o.stride*c/o.size),o.divisor>0&&(e.instancingExtension?e.instancingExtension.vertexAttribDivisorANGLE(o.index+c,0):n.vertexAttribDivisor(o.index+c,0)),n.disableVertexAttribArray(o.index+c)}}}},t.shaderProgramChanged=()=>{t.release(),e.handleVAO&&(e.extension?e.extension.deleteVertexArrayOES(e.handleVAO):e.context.deleteVertexArray(e.handleVAO)),e.handleVAO=0,e.handleProgram=0},t.releaseGraphicsResources=()=>{t.shaderProgramChanged(),e.handleVAO&&(e.extension?e.extension.deleteVertexArrayOES(e.handleVAO):e.context.deleteVertexArray(e.handleVAO)),e.handleVAO=0,e.supported=!0,e.handleProgram=0},t.addAttributeArray=(n,r,i,a,o,s,c,l)=>t.addAttributeArrayWithDivisor(n,r,i,a,o,s,c,l,0,!1),t.addAttributeArrayWithDivisor=(n,r,i,a,o,s,c,l,f,u)=>{if(!n||!n.isBound()||r.getHandle()===0||r.getType()!==ss.ARRAY_BUFFER||(e.handleProgram===0&&(e.handleProgram=n.getHandle()),t.isReady()||t.initialize(),!t.isReady()||e.handleProgram!==n.getHandle()))return!1;const g=e.context,d={};if(d.name=i,d.index=g.getAttribLocation(e.handleProgram,i),d.offset=a,d.stride=o,d.type=s,d.size=c,d.normalize=l,d.isMatrix=u,d.divisor=f,d.Index===-1)return!1;if(r.bind(),g.enableVertexAttribArray(d.index),g.vertexAttribPointer(d.index,d.size,d.type,d.normalize,d.stride,d.offset),f>0&&(e.instancingExtension?e.instancingExtension.vertexAttribDivisorANGLE(d.index,1):g.vertexAttribDivisor(d.index,1)),d.buffer=r.getHandle(),!e.supported){let h=!1;for(let p=0;p<e.buffers.length;++p){const m=e.buffers[p];if(m.buffer===d.buffer){h=!0;let v=!1;for(let y=0;y<m.attributes.length;++y)m.attributes[y].name===i&&(v=!0,m.attributes[y]=d);v||m.attributes.push(d)}}h||e.buffers.push({buffer:d.buffer,attributes:[d]})}return!0},t.addAttributeMatrixWithDivisor=(n,r,i,a,o,s,c,l,f)=>{const u=t.addAttributeArrayWithDivisor(n,r,i,a,o,s,c,l,f,!0);if(!u)return u;const g=e.context,d=g.getAttribLocation(e.handleProgram,i);for(let h=1;h<c;h++)g.enableVertexAttribArray(d+h),g.vertexAttribPointer(d+h,c,s,l,o,a+o*h/c),f>0&&(e.instancingExtension?e.instancingExtension.vertexAttribDivisorANGLE(d+h,1):g.vertexAttribDivisor(d+h,1));return!0},t.removeAttributeArray=n=>{if(!t.isReady()||e.handleProgram===0)return!1;if(!e.supported)for(let r=0;r<e.buffers.length;++r){const i=e.buffers[r];for(let a=0;a<i.attributes.length;++a)if(i.attributes[a].name===n)return i.attributes.splice(a,1),i.attributes.length||e.buffers.splice(r,1),!0}return!0},t.setOpenGLRenderWindow=n=>{e._openGLRenderWindow!==n&&(t.releaseGraphicsResources(),e._openGLRenderWindow=n,e.context=null,n&&(e.context=e._openGLRenderWindow.getContext()))}}const AF={forceEmulation:!1,handleVAO:0,handleProgram:0,supported:!0,buffers:null,context:null};function DE(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,AF,n),e.buffers=[],P.obj(t,e),P.get(t,e,["supported"]),P.setGet(t,e,["forceEmulation"]),kF(t,e)}const FF=P.newInstance(DE,"vtkOpenGLVertexArrayObject");var j4={newInstance:FF,extend:DE};const Hs={Start:0,Points:0,Lines:1,Tris:2,TriStrips:3,TrisEdges:4,TriStripsEdges:5,End:6};function UF(t,e){e.classHierarchy.push("vtkOpenGLHelper"),t.setOpenGLRenderWindow=n=>{e.context=n.getContext(),e.program.setContext(e.context),e.VAO.setOpenGLRenderWindow(n),e.CABO.setOpenGLRenderWindow(n)},t.releaseGraphicsResources=n=>{e.VAO.releaseGraphicsResources(),e.CABO.releaseGraphicsResources(),e.CABO.setElementCount(0)},t.drawArrays=(n,r,i,a)=>{if(e.CABO.getElementCount()){const o=t.getOpenGLMode(i),s=t.haveWideLines(n,r),c=e.context,l=c.getParameter(c.DEPTH_WRITEMASK);e.pointPicking&&c.depthMask(!1),o===c.LINES&&s?(t.updateShaders(n,r,a),c.drawArraysInstanced(o,0,e.CABO.getElementCount(),2*Math.ceil(r.getProperty().getLineWidth()))):(c.lineWidth(r.getProperty().getLineWidth()),t.updateShaders(n,r,a),c.drawArrays(o,0,e.CABO.getElementCount()),c.lineWidth(1));const u=(o===c.POINTS?1:0)||(o===c.LINES?2:3);return e.pointPicking&&c.depthMask(l),e.CABO.getElementCount()/u}return 0},t.getOpenGLMode=n=>{if(e.pointPicking)return e.context.POINTS;const r=e.primitiveType;return n===_r.POINTS||r===Hs.Points?e.context.POINTS:n===_r.WIREFRAME||r===Hs.Lines||r===Hs.TrisEdges||r===Hs.TriStripsEdges?e.context.LINES:e.context.TRIANGLES},t.haveWideLines=(n,r)=>r.getProperty().getLineWidth()>1?!(e.CABO.getOpenGLRenderWindow()&&e.CABO.getOpenGLRenderWindow().getHardwareMaximumLineWidth()>=r.getProperty().getLineWidth()):!1,t.getNeedToRebuildShaders=(n,r,i)=>!!(i.getNeedToRebuildShaders(t,n,r)||t.getProgram()===0||t.getShaderSourceTime().getMTime()<i.getMTime()||t.getShaderSourceTime().getMTime()<r.getMTime()),t.updateShaders=(n,r,i)=>{if(t.getNeedToRebuildShaders(n,r,i)){const a={Vertex:null,Fragment:null,Geometry:null};i.buildShaders(a,n,r);const o=e.CABO.getOpenGLRenderWindow().getShaderCache().readyShaderProgramArray(a.Vertex,a.Fragment,a.Geometry);o!==t.getProgram()&&(t.setProgram(o),t.getVAO().releaseGraphicsResources()),t.getShaderSourceTime().modified()}else e.CABO.getOpenGLRenderWindow().getShaderCache().readyShaderProgram(t.getProgram());t.getVAO().bind(),i.setMapperShaderParameters(t,n,r),i.setPropertyShaderParameters(t,n,r),i.setCameraShaderParameters(t,n,r),i.setLightingShaderParameters(t,n,r),i.invokeShaderCallbacks(t,n,r)},t.setMapperShaderParameters=(n,r,i)=>{if(t.haveWideLines(n,r)){t.getProgram().setUniform2f("viewportSize",i.usize,i.vsize);const a=parseFloat(r.getProperty().getLineWidth()),o=a/2;t.getProgram().setUniformf("lineWidthStepSize",a/Math.ceil(a)),t.getProgram().setUniformf("halfLineWidth",o)}e.primitiveType===Hs.Points||r.getProperty().getRepresentation()===_r.POINTS?t.getProgram().setUniformf("pointSize",r.getProperty().getPointSize()):e.pointPicking&&t.getProgram().setUniformf("pointSize",t.getPointPickingPrimitiveSize())},t.replaceShaderPositionVC=(n,r,i)=>{let a=n.Vertex;a=te.substitute(a,"//VTK::PositionVC::Dec",["//VTK::PositionVC::Dec","uniform float pointSize;"]).result,a=te.substitute(a,"//VTK::PositionVC::Impl",["//VTK::PositionVC::Impl","  gl_PointSize = pointSize;"],!1).result,t.getOpenGLMode(i.getProperty().getRepresentation())===e.context.LINES&&t.haveWideLines(r,i)&&(a=te.substitute(a,"//VTK::PositionVC::Dec",["//VTK::PositionVC::Dec","uniform vec2 viewportSize;","uniform float lineWidthStepSize;","uniform float halfLineWidth;"]).result,a=te.substitute(a,"//VTK::PositionVC::Impl",["//VTK::PositionVC::Impl"," if (halfLineWidth > 0.0)","   {","   float offset = float(gl_InstanceID / 2) * lineWidthStepSize - halfLineWidth;","   vec4 tmpPos = gl_Position;","   vec3 tmpPos2 = tmpPos.xyz / tmpPos.w;","   tmpPos2.x = tmpPos2.x + 2.0 * mod(float(gl_InstanceID), 2.0) * offset / viewportSize[0];","   tmpPos2.y = tmpPos2.y + 2.0 * mod(float(gl_InstanceID + 1), 2.0) * offset / viewportSize[1];","   gl_Position = vec4(tmpPos2.xyz * tmpPos.w, tmpPos.w);","   }"]).result),n.Vertex=a},t.getPointPickingPrimitiveSize=()=>e.primitiveType===Hs.Points?2:e.primitiveType===Hs.Lines?4:6,t.getAllocatedGPUMemoryInBytes=()=>t.getCABO().getAllocatedGPUMemoryInBytes()}const BF={context:null,program:null,shaderSourceTime:null,VAO:null,attributeUpdateTime:null,CABO:null,primitiveType:0,pointPicking:!1};function RE(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,BF,n),P.obj(t,e),e.shaderSourceTime={},P.obj(e.shaderSourceTime),e.attributeUpdateTime={},P.obj(e.attributeUpdateTime),P.setGet(t,e,["program","shaderSourceTime","VAO","attributeUpdateTime","CABO","primitiveType","pointPicking"]),e.program=te.newInstance(),e.VAO=j4.newInstance(),e.CABO=RF.newInstance(),UF(t,e)}const GF=P.newInstance(RE);var Oo={newInstance:GF,extend:RE,primTypes:Hs};const{Representation:Uf,Interpolation:Bf}=xE;function m9(t){return()=>P.vtkErrorMacro(`vtkProperty::${t} - NOT IMPLEMENTED`)}function $F(t,e){e.classHierarchy.push("vtkProperty"),t.setColor=(n,r,i)=>{Array.isArray(n)?(e.color[0]!==n[0]||e.color[1]!==n[1]||e.color[2]!==n[2])&&(e.color[0]=n[0],e.color[1]=n[1],e.color[2]=n[2],t.modified()):(e.color[0]!==n||e.color[1]!==r||e.color[2]!==i)&&(e.color[0]=n,e.color[1]=r,e.color[2]=i,t.modified()),t.setDiffuseColor(e.color),t.setAmbientColor(e.color),t.setSpecularColor(e.color)},t.computeCompositeColor=m9("ComputeCompositeColor"),t.getColor=()=>{let n=0;e.ambient+e.diffuse+e.specular>0&&(n=1/(e.ambient+e.diffuse+e.specular));for(let r=0;r<3;r++)e.color[r]=n*(e.ambient*e.ambientColor[r]+e.diffuse*e.diffuseColor[r]+e.specular*e.specularColor[r]);return[].concat(e.color)},t.setSpecularPower=n=>{const r=1/Math.max(1,n);(e.roughness!==r||e.specularPower!==n)&&(e.specularPower=n,e.roughness=r,t.modified())},t.addShaderVariable=m9("AddShaderVariable"),t.setInterpolationToFlat=()=>t.setInterpolation(Bf.FLAT),t.setInterpolationToGouraud=()=>t.setInterpolation(Bf.GOURAUD),t.setInterpolationToPhong=()=>t.setInterpolation(Bf.PHONG),t.getInterpolationAsString=()=>P.enumToString(Bf,e.interpolation),t.setRepresentationToWireframe=()=>t.setRepresentation(Uf.WIREFRAME),t.setRepresentationToSurface=()=>t.setRepresentation(Uf.SURFACE),t.setRepresentationToPoints=()=>t.setRepresentation(Uf.POINTS),t.getRepresentationAsString=()=>P.enumToString(Uf,e.representation)}const WF={color:[1,1,1],ambientColor:[1,1,1],diffuseColor:[1,1,1],specularColor:[1,1,1],edgeColor:[0,0,0],ambient:0,diffuse:1,metallic:0,roughness:.6,normalStrength:1,emission:1,baseIOR:1.45,specular:0,specularPower:1,opacity:1,interpolation:Bf.GOURAUD,representation:Uf.SURFACE,edgeVisibility:!1,backfaceCulling:!1,frontfaceCulling:!1,pointSize:1,lineWidth:1,lighting:!0,shading:!1,materialName:null};function zF(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,WF,n),P.obj(t,e),P.setGet(t,e,["lighting","interpolation","ambient","diffuse","metallic","roughness","normalStrength","emission","baseIOR","specular","specularPower","opacity","edgeVisibility","lineWidth","pointSize","backfaceCulling","frontfaceCulling","representation","diffuseTexture","metallicTexture","roughnessTexture","normalTexture","ambientOcclusionTexture","emissionTexture"]),P.setGetArray(t,e,["ambientColor","specularColor","diffuseColor","edgeColor"],3),$F(t,e)}const jF=P.newInstance(zF,"vtkProperty");var Yu={newInstance:jF,...xE};const{Representation:HF}=Yu,{vtkErrorMacro:v9}=P;function KF(t){const e=te.substitute(t.Fragment,"//VTK::RenderPassFragmentShader::Impl",`
      float weight = gl_FragData[0].a * pow(max(1.1 - gl_FragCoord.z, 0.0), 2.0);
      gl_FragData[0] = vec4(gl_FragData[0].rgb*weight, gl_FragData[0].a);
      gl_FragData[1].r = weight;
    `,!1);t.Fragment=e.result}const qF=`//VTK::System::Dec

in vec2 tcoord;

uniform sampler2D translucentRTexture;
uniform sampler2D translucentRGBATexture;

// the output of this shader
//VTK::Output::Dec

void main()
{
  vec4 t1Color = texture(translucentRGBATexture, tcoord);
  float t2Color = texture(translucentRTexture, tcoord).r;
  gl_FragData[0] = vec4(t1Color.rgb/max(t2Color,0.01), 1.0 - t1Color.a);
}
`;function XF(t,e){e.classHierarchy.push("vtkOpenGLOrderIndependentTranslucentPass"),t.createVertexBuffer=()=>{const n=new Float32Array([-1,-1,-1,1,-1,-1,-1,1,-1,1,1,-1]),r=new Float32Array([0,0,1,0,0,1,1,1]),i=new Uint16Array([4,0,1,3,2]),a=nt.newInstance({numberOfComponents:3,values:n});a.setName("points");const o=nt.newInstance({numberOfComponents:2,values:r});o.setName("tcoords");const s=nt.newInstance({numberOfComponents:1,values:i});e.tris.getCABO().createVBO(s,"polys",HF.SURFACE,{points:a,tcoords:o,cellOffset:0}),e.VBOBuildTime.modified()},t.createFramebuffer=n=>{const r=n.getSize(),i=n.getContext();e.framebuffer=f2.newInstance(),e.framebuffer.setOpenGLRenderWindow(n),e.framebuffer.create(...r),e.framebuffer.saveCurrentBindingsAndBuffers(),e.framebuffer.bind(),e.translucentRGBATexture=Xt.newInstance(),e.translucentRGBATexture.setInternalFormat(i.RGBA16F),e.translucentRGBATexture.setFormat(i.RGBA),e.translucentRGBATexture.setOpenGLDataType(i.HALF_FLOAT),e.translucentRGBATexture.setOpenGLRenderWindow(n),e.translucentRGBATexture.create2DFromRaw(r[0],r[1],4,"Float32Array",null),e.translucentRTexture=Xt.newInstance(),e.translucentRTexture.setInternalFormat(i.R16F),e.translucentRTexture.setFormat(i.RED),e.translucentRTexture.setOpenGLDataType(i.HALF_FLOAT),e.translucentRTexture.setOpenGLRenderWindow(n),e.translucentRTexture.create2DFromRaw(r[0],r[1],1,"Float32Array",null),e.translucentZTexture=Xt.newInstance(),e.translucentZTexture.setOpenGLRenderWindow(n),e.translucentZTexture.createDepthFromRaw(r[0],r[1],"Float32Array",null),e.framebuffer.setColorBuffer(e.translucentRGBATexture,0),e.framebuffer.setColorBuffer(e.translucentRTexture,1),e.framebuffer.setDepthBuffer(e.translucentZTexture)},t.createCopyShader=n=>{e.copyShader=n.getShaderCache().readyShaderProgramArray(["//VTK::System::Dec","attribute vec4 vertexDC;","attribute vec2 tcoordTC;","varying vec2 tcoord;","void main() { tcoord = tcoordTC; gl_Position = vertexDC; }"].join(`
`),qF,"")},t.createVBO=n=>{const r=n.getContext();e.tris.setOpenGLRenderWindow(n),t.createVertexBuffer();const i=e.copyShader;e.tris.getCABO().bind(),e.copyVAO.addAttributeArray(i,e.tris.getCABO(),"vertexDC",e.tris.getCABO().getVertexOffset(),e.tris.getCABO().getStride(),r.FLOAT,3,r.FALSE)||v9("Error setting vertexDC in copy shader VAO."),e.copyVAO.addAttributeArray(i,e.tris.getCABO(),"tcoordTC",e.tris.getCABO().getTCoordOffset(),e.tris.getCABO().getStride(),r.FLOAT,2,r.FALSE)||v9("Error setting vertexDC in copy shader VAO.")},t.traverse=(n,r,i)=>{if(e.deleted)return;const a=n.getSize(),o=n.getContext();if(e._supported=!1,r.getSelector()||!o||!n.getWebgl2()||!o.getExtension("EXT_color_buffer_half_float")&&!o.getExtension("EXT_color_buffer_float")){t.setCurrentOperation("translucentPass"),r.traverse(t);return}if(e._supported=!0,e.framebuffer===null)t.createFramebuffer(n);else{const c=e.framebuffer.getSize();c===null||c[0]!==a[0]||c[1]!==a[1]?(e.framebuffer.releaseGraphicsResources(),e.translucentRGBATexture.releaseGraphicsResources(n),e.translucentRTexture.releaseGraphicsResources(n),e.translucentZTexture.releaseGraphicsResources(n),t.createFramebuffer(n)):(e.framebuffer.saveCurrentBindingsAndBuffers(),e.framebuffer.bind())}o.drawBuffers([o.COLOR_ATTACHMENT0]),o.clearBufferfv(o.COLOR,0,[0,0,0,0]),o.clearBufferfv(o.DEPTH,0,[1]),o.colorMask(!1,!1,!1,!1),i.getOpaqueActorCount()>0&&(i.setCurrentOperation("opaqueZBufferPass"),r.traverse(i)),o.colorMask(!0,!0,!0,!0),o.drawBuffers([o.COLOR_ATTACHMENT0,o.COLOR_ATTACHMENT1]),o.viewport(0,0,a[0],a[1]),o.scissor(0,0,a[0],a[1]),o.clearBufferfv(o.COLOR,0,[0,0,0,1]),o.clearBufferfv(o.COLOR,1,[0,0,0,0]),o.enable(o.DEPTH_TEST),o.enable(o.BLEND),o.blendFuncSeparate(o.ONE,o.ONE,o.ZERO,o.ONE_MINUS_SRC_ALPHA),t.setCurrentOperation("translucentPass"),r.traverse(t),o.drawBuffers([o.NONE]),e.framebuffer.restorePreviousBindingsAndBuffers(),e.copyShader===null?t.createCopyShader(n):n.getShaderCache().readyShaderProgram(e.copyShader),e.copyVAO||(e.copyVAO=j4.newInstance(),e.copyVAO.setOpenGLRenderWindow(n)),e.copyVAO.bind(),e.VBOBuildTime.getMTime()<t.getMTime()&&t.createVBO(n),o.blendFuncSeparate(o.SRC_ALPHA,o.ONE_MINUS_SRC_ALPHA,o.ONE,o.ONE_MINUS_SRC_ALPHA),o.depthMask(!1),o.depthFunc(o.ALWAYS),o.viewport(0,0,a[0],a[1]),o.scissor(0,0,a[0],a[1]),e.translucentRGBATexture.activate(),e.copyShader.setUniformi("translucentRGBATexture",e.translucentRGBATexture.getTextureUnit()),e.translucentRTexture.activate(),e.copyShader.setUniformi("translucentRTexture",e.translucentRTexture.getTextureUnit()),o.drawArrays(o.TRIANGLES,0,e.tris.getCABO().getElementCount()),o.depthMask(!0),o.depthFunc(o.LEQUAL),e.translucentRGBATexture.deactivate(),e.translucentRTexture.deactivate();const s=r.getTiledSizeAndOrigin();o.scissor(s.lowerLeftU,s.lowerLeftV,s.usize,s.vsize),o.viewport(s.lowerLeftU,s.lowerLeftV,s.usize,s.vsize)},t.getShaderReplacement=()=>e._supported?KF:null,t.releaseGraphicsResources=n=>{e.framebuffer&&(e.framebuffer.releaseGraphicsResources(n),e.framebuffer=null),e.translucentRGBATexture&&(e.translucentRGBATexture.releaseGraphicsResources(n),e.translucentRGBATexture=null),e.translucentRTexture&&(e.translucentRTexture.releaseGraphicsResources(n),e.translucentRTexture=null),e.translucentZTexture&&(e.translucentZTexture.releaseGraphicsResources(n),e.translucentZTexture=null),e.copyVAO&&(e.copyVAO.releaseGraphicsResources(n),e.copyVAO=null),e.copyShader&&(e.copyShader.releaseGraphicsResources(n),e.copyShader=null),e.tris&&(e.tris.releaseGraphicsResources(n),e.tris=null),t.modified()}}const YF={framebuffer:null,copyShader:null,tris:null};function ME(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,YF,n),V4.extend(t,e,n),e.VBOBuildTime={},P.obj(e.VBOBuildTime,{mtime:0}),e.tris=Oo.newInstance(),P.get(t,e,["framebuffer"]),XF(t,e)}const ZF=P.newInstance(ME,"vtkOpenGLOrderIndependentTranslucentPass");var QF={newInstance:ZF,extend:ME};function JF(t,e){e.classHierarchy.push("vtkForwardPass"),t.traverse=function(n){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;if(e.deleted)return;e._currentParent=r,t.setCurrentOperation("buildPass"),n.traverse(t);const i=n.getRenderable().getNumberOfLayers(),a=n.getRenderable().getRenderersByReference();for(let o=0;o<i;o++)for(let s=0;s<a.length;s++){const c=a[s],l=n.getViewNodeFor(c);if(c.getDraw()&&c.getLayer()===o){if(e.opaqueActorCount=0,e.translucentActorCount=0,e.volumeCount=0,e.overlayActorCount=0,t.setCurrentOperation("queryPass"),l.traverse(t),(e.opaqueActorCount>0||e.translucentActorCount>0)&&e.volumeCount>0||e.depthRequested){const f=n.getFramebufferSize();e.framebuffer===null&&(e.framebuffer=f2.newInstance()),e.framebuffer.setOpenGLRenderWindow(n),e.framebuffer.saveCurrentBindingsAndBuffers();const u=e.framebuffer.getSize();(u===null||u[0]!==f[0]||u[1]!==f[1])&&(e.framebuffer.create(f[0],f[1]),e.framebuffer.populateFramebuffer()),e.framebuffer.bind(),t.setCurrentOperation("zBufferPass"),l.traverse(t),e.framebuffer.restorePreviousBindingsAndBuffers(),e.depthRequested=!1}t.setCurrentOperation("cameraPass"),l.traverse(t),e.opaqueActorCount>0&&(t.setCurrentOperation("opaquePass"),l.traverse(t)),e.translucentActorCount>0&&(e.translucentPass||(e.translucentPass=QF.newInstance()),e.translucentPass.traverse(n,l,t)),e.volumeCount>0&&(t.setCurrentOperation("volumePass"),l.traverse(t)),e.overlayActorCount>0&&(t.setCurrentOperation("overlayPass"),l.traverse(t))}}},t.getZBufferTexture=()=>e.framebuffer?e.framebuffer.getColorTexture():null,t.requestDepth=()=>{e.depthRequested=!0},t.incrementOpaqueActorCount=()=>e.opaqueActorCount++,t.incrementTranslucentActorCount=()=>e.translucentActorCount++,t.incrementVolumeCount=()=>e.volumeCount++,t.incrementOverlayActorCount=()=>e.overlayActorCount++}const eU={opaqueActorCount:0,translucentActorCount:0,volumeCount:0,overlayActorCount:0,framebuffer:null,depthRequested:!1};function _E(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,eU,n),V4.extend(t,e,n),P.get(t,e,["framebuffer","opaqueActorCount","translucentActorCount","volumeCount"]),JF(t,e)}const tU=P.newInstance(_E,"vtkForwardPass");var nU={newInstance:tU,extend:_E};const ci={MIN_KNOWN_PASS:0,ACTOR_PASS:0,COMPOSITE_INDEX_PASS:1,ID_LOW24:2,ID_HIGH24:3,MAX_KNOWN_PASS:3};var bE={PassTypes:ci};const{vtkErrorMacro:y9,vtkWarningMacro:rU}=P;function iU(t,e){e.classHierarchy.push("vtkFieldData");const n=t.getState;e.arrays&&(e.arrays=e.arrays.map(r=>({data:Fa(r.data)}))),t.initialize=()=>{t.initializeFields(),t.copyAllOn(),t.clearFieldFlags()},t.initializeFields=()=>{e.arrays=[],e.copyFieldFlags={},t.modified()},t.copyStructure=r=>{t.initializeFields(),e.copyFieldFlags=r.getCopyFieldFlags().map(i=>i),e.arrays=r.arrays().map(i=>({array:i}))},t.getNumberOfArrays=()=>e.arrays.length,t.getNumberOfActiveArrays=()=>e.arrays.length,t.addArray=r=>{const i=r.getName(),{array:a,index:o}=t.getArrayWithIndex(i);return a!=null?(e.arrays[o]={data:r},o):(e.arrays=[].concat(e.arrays,{data:r}),e.arrays.length-1)},t.removeAllArrays=()=>{e.arrays=[]},t.removeArray=r=>{const i=e.arrays.findIndex(a=>a.data.getName()===r);return t.removeArrayByIndex(i)},t.removeArrayByIndex=r=>r!==-1&&r<e.arrays.length?(e.arrays.splice(r,1),!0):!1,t.getArrays=()=>e.arrays.map(r=>r.data),t.getArray=r=>typeof r=="number"?t.getArrayByIndex(r):t.getArrayByName(r),t.getArrayByName=r=>e.arrays.reduce((i,a,o)=>a.data.getName()===r?a.data:i,null),t.getArrayWithIndex=r=>{const i=e.arrays.findIndex(a=>a.data.getName()===r);return{array:i!==-1?e.arrays[i].data:null,index:i}},t.getArrayByIndex=r=>r>=0&&r<e.arrays.length?e.arrays[r].data:null,t.hasArray=r=>t.getArrayWithIndex(r).index>=0,t.getArrayName=r=>{const i=e.arrays[r];return i?i.data.getName():""},t.getCopyFieldFlags=()=>e.copyFieldFlags,t.getFlag=r=>e.copyFieldFlags[r],t.passData=function(r){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:-1,a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:-1;r.getArrays().forEach(o=>{const s=t.getFlag(o.getName());if(s!==!1&&!(e.doCopyAllOff&&s!==!0)&&o){let c=t.getArrayByName(o.getName());if(c)if(o.getNumberOfComponents()===c.getNumberOfComponents())if(i>-1&&i<o.getNumberOfTuples()){const l=a>-1?a:i;c.insertTuple(l,o.getTuple(i))}else c.insertTuples(0,o.getTuples());else y9("Unhandled case in passData");else if(i<0||i>o.getNumberOfTuples())t.addArray(o),r.getAttributes(o).forEach(l=>{t.setAttribute(o,l)});else{const l=o.getNumberOfComponents();let f=o.getNumberOfValues();const u=a>-1?a:i;f<=u*l&&(f=(u+1)*l),c=nt.newInstance({name:o.getName(),dataType:o.getDataType(),numberOfComponents:l,values:P.newTypedArray(o.getDataType(),f),size:0}),c.insertTuple(u,o.getTuple(i)),t.addArray(c),r.getAttributes(o).forEach(g=>{t.setAttribute(c,g)})}}})},t.interpolateData=function(r){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:-1,a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:-1,o=arguments.length>3&&arguments[3]!==void 0?arguments[3]:-1,s=arguments.length>4&&arguments[4]!==void 0?arguments[4]:.5;r.getArrays().forEach(c=>{const l=t.getFlag(c.getName());if(l!==!1&&!(e.doCopyAllOff&&l!==!0)&&c){let f=t.getArrayByName(c.getName());if(f)if(c.getNumberOfComponents()===f.getNumberOfComponents())if(i>-1&&i<c.getNumberOfTuples()){const u=o>-1?o:i;f.interpolateTuple(u,c,i,c,a,s),rU("Unexpected case in interpolateData")}else f.insertTuples(c.getTuples());else y9("Unhandled case in interpolateData");else if(i<0||a<0||i>c.getNumberOfTuples())t.addArray(c),r.getAttributes(c).forEach(u=>{t.setAttribute(c,u)});else{const u=c.getNumberOfComponents();let g=c.getNumberOfValues();const d=o>-1?o:i;g<=d*u&&(g=(d+1)*u),f=nt.newInstance({name:c.getName(),dataType:c.getDataType(),numberOfComponents:u,values:P.newTypedArray(c.getDataType(),g),size:0}),f.interpolateTuple(d,c,i,c,a,s),t.addArray(f),r.getAttributes(c).forEach(h=>{t.setAttribute(f,h)})}}})},t.copyFieldOn=r=>{e.copyFieldFlags[r]=!0},t.copyFieldOff=r=>{e.copyFieldFlags[r]=!1},t.copyAllOn=()=>{(!e.doCopyAllOn||e.doCopyAllOff)&&(e.doCopyAllOn=!0,e.doCopyAllOff=!1,t.modified())},t.copyAllOff=()=>{(e.doCopyAllOn||!e.doCopyAllOff)&&(e.doCopyAllOn=!1,e.doCopyAllOff=!0,t.modified())},t.clearFieldFlags=()=>{e.copyFieldFlags={}},t.deepCopy=r=>{e.arrays=r.getArrays().map(i=>{const a=i.newClone();return a.deepCopy(i),{data:a}})},t.copyFlags=r=>r.getCopyFieldFlags().map(i=>i),t.reset=()=>e.arrays.forEach(r=>r.data.reset()),t.getMTime=()=>e.arrays.reduce((r,i)=>i.data.getMTime()>r?i.data.getMTime():r,e.mtime),t.getNumberOfComponents=()=>e.arrays.reduce((r,i)=>r+i.data.getNumberOfComponents(),0),t.getNumberOfTuples=()=>e.arrays.length>0?e.arrays[0].getNumberOfTuples():0,t.getState=()=>{const r=n();return r&&(r.arrays=e.arrays.map(i=>({data:i.data.getState()}))),r}}const aU={arrays:[],copyFieldFlags:[],doCopyAllOn:!0,doCopyAllOff:!1};function LE(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,aU,n),P.obj(t,e),iU(t,e)}const oU=P.newInstance(LE,"vtkFieldData");var sU={newInstance:oU,extend:LE};const cU={SCALARS:0,VECTORS:1,NORMALS:2,TCOORDS:3,TENSORS:4,GLOBALIDS:5,PEDIGREEIDS:6,EDGEFLAG:7,NUM_ATTRIBUTES:8},lU={MAX:0,EXACT:1,NOLIMIT:2},uU={DUPLICATECELL:1,HIGHCONNECTIVITYCELL:2,LOWCONNECTIVITYCELL:4,REFINEDCELL:8,EXTERIORCELL:16,HIDDENCELL:32},fU={DUPLICATEPOINT:1,HIDDENPOINT:2},gU={COPYTUPLE:0,INTERPOLATE:1,PASSDATA:2,ALLCOPY:3},dU="vtkGhostType",pU={DEFAULT:0,SINGLE:1,DOUBLE:2};var IE={AttributeCopyOperations:gU,AttributeLimitTypes:lU,AttributeTypes:cU,CellGhostTypes:uU,DesiredOutputPrecision:pU,PointGhostTypes:fU,ghostArrayName:dU};const{AttributeTypes:Gs,AttributeCopyOperations:s0}=IE,{vtkWarningMacro:Yd}=P;function hU(t,e){const n=["Scalars","Vectors","Normals","TCoords","Tensors","GlobalIds","PedigreeIds"];function r(o){let s=n.find(c=>Gs[c.toUpperCase()]===o||typeof o!="number"&&c.toLowerCase()===o.toLowerCase());return typeof s>"u"&&(s=null),s}e.classHierarchy.push("vtkDataSetAttributes");const i={...t};t.checkNumberOfComponents=o=>!0,t.setAttribute=(o,s)=>{const c=r(s);if(o&&c.toUpperCase()==="PEDIGREEIDS"&&!o.isA("vtkDataArray"))return Yd(`Cannot set attribute ${c}. The attribute must be a vtkDataArray.`),-1;if(o&&!t.checkNumberOfComponents(o,c))return Yd(`Cannot set attribute ${c}. Incorrect number of components.`),-1;let l=e[`active${c}`];if(l>=0&&l<e.arrays.length){if(e.arrays[l]===o)return l;t.removeArrayByIndex(l)}return o?(l=t.addArray(o),e[`active${c}`]=l):e[`active${c}`]=-1,t.modified(),e[`active${c}`]},t.getAttributes=o=>n.filter(s=>t[`get${s}`]()===o),t.setActiveAttributeByName=(o,s)=>t.setActiveAttributeByIndex(t.getArrayWithIndex(o).index,s),t.setActiveAttributeByIndex=(o,s)=>{const c=r(s);if(o>=0&&o<e.arrays.length){if(c.toUpperCase()!=="PEDIGREEIDS"){const l=t.getArrayByIndex(o);if(!l.isA("vtkDataArray"))return Yd(`Cannot set attribute ${c}. Only vtkDataArray subclasses can be set as active attributes.`),-1;if(!t.checkNumberOfComponents(l,c))return Yd(`Cannot set attribute ${c}. Incorrect number of components.`),-1}return e[`active${c}`]=o,t.modified(),o}return o===-1&&(e[`active${c}`]=o,t.modified()),-1},t.getActiveAttribute=o=>{const s=r(o);return t[`get${s}`]()},t.removeAllArrays=()=>{n.forEach(o=>{e[`active${o}`]=-1}),i.removeAllArrays()},t.removeArrayByIndex=o=>(o!==-1&&n.forEach(s=>{o===e[`active${s}`]?e[`active${s}`]=-1:o<e[`active${s}`]&&(e[`active${s}`]-=1)}),i.removeArrayByIndex(o)),n.forEach(o=>{const s=`active${o}`;t[`get${o}`]=()=>t.getArrayByIndex(e[s]),t[`set${o}`]=c=>t.setAttribute(c,o),t[`setActive${o}`]=c=>t.setActiveAttributeByIndex(t.getArrayWithIndex(c).index,o),t[`copy${o}Off`]=()=>{const c=o.toUpperCase();e.copyAttributeFlags[s0.PASSDATA][Gs[c]]=!1},t[`copy${o}On`]=()=>{const c=o.toUpperCase();e.copyAttributeFlags[s0.PASSDATA][Gs[c]]=!0}}),t.initializeAttributeCopyFlags=()=>{e.copyAttributeFlags=[],Object.keys(s0).filter(o=>o!=="ALLCOPY").forEach(o=>{e.copyAttributeFlags[s0[o]]=Object.keys(Gs).filter(s=>s!=="NUM_ATTRIBUTES").reduce((s,c)=>(s[Gs[c]]=!0,s),[])}),e.copyAttributeFlags[s0.COPYTUPLE][Gs.GLOBALIDS]=!1,e.copyAttributeFlags[s0.INTERPOLATE][Gs.GLOBALIDS]=!1,e.copyAttributeFlags[s0.COPYTUPLE][Gs.PEDIGREEIDS]=!1},t.initialize=P.chain(t.initialize,t.initializeAttributeCopyFlags),e.dataArrays&&Object.keys(e.dataArrays).length&&Object.keys(e.dataArrays).forEach(o=>{!e.dataArrays[o].ref&&e.dataArrays[o].type==="vtkDataArray"&&t.addArray(nt.newInstance(e.dataArrays[o]))});const a=t.shallowCopy;t.shallowCopy=(o,s)=>{a(o,s),e.arrays=o.getArrays().map(c=>{const l=c.newClone();return l.shallowCopy(c,s),{data:l}})},t.initializeAttributeCopyFlags()}const mU={activeScalars:-1,activeVectors:-1,activeTensors:-1,activeNormals:-1,activeTCoords:-1,activeGlobalIds:-1,activePedigreeIds:-1};function VE(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,mU,n),sU.extend(t,e,n),P.setGet(t,e,["activeScalars","activeNormals","activeTCoords","activeVectors","activeTensors","activeGlobalIds","activePedigreeIds"]),e.arrays||(e.arrays={}),hU(t,e)}const vU=P.newInstance(VE,"vtkDataSetAttributes");var T9={newInstance:vU,extend:VE,...IE};const yU={UNIFORM:0,DATA_OBJECT_FIELD:0,COORDINATE:1,POINT_DATA:1,POINT:2,POINT_FIELD_DATA:2,CELL:3,CELL_FIELD_DATA:3,VERTEX:4,VERTEX_FIELD_DATA:4,EDGE:5,EDGE_FIELD_DATA:5,ROW:6,ROW_DATA:6},TU={FIELD_ASSOCIATION_POINTS:0,FIELD_ASSOCIATION_CELLS:1,FIELD_ASSOCIATION_NONE:2,FIELD_ASSOCIATION_POINTS_THEN_CELLS:3,FIELD_ASSOCIATION_VERTICES:4,FIELD_ASSOCIATION_EDGES:5,FIELD_ASSOCIATION_ROWS:6,NUMBER_OF_ASSOCIATIONS:7};var CU={FieldDataTypes:yU,FieldAssociations:TU};const L3=["pointData","cellData","fieldData"];function wU(t,e){e.classHierarchy.push("vtkDataSet"),L3.forEach(r=>{e[r]?e[r]=Fa(e[r]):e[r]=T9.newInstance()});const n=t.shallowCopy;t.shallowCopy=function(r){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;n(r,i),L3.forEach(a=>{e[a]=T9.newInstance(),e[a].shallowCopy(r.getReferenceByName(a))})}}const xU={};function PE(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,xU,n),P.obj(t,e),P.setGet(t,e,L3),wU(t,e)}const SU=P.newInstance(PE,"vtkDataSet");var Zu={newInstance:SU,extend:PE,...CU};const{FieldAssociations:EU}=Zu;function OU(t,e){e.classHierarchy.push("vtkHardwareSelector"),t.getSourceDataAsync=async(n,r,i,a,o)=>{},t.selectAsync=async(n,r,i,a,o)=>{const s=await t.getSourceDataAsync(n,r,i,a,o);return s?s.generateSelection(r,i,a,o):[]}}const DU={fieldAssociation:EU.FIELD_ASSOCIATION_CELLS,captureZValues:!1};function NE(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,DU,n),P.obj(t,e),P.setGet(t,e,["fieldAssociation","captureZValues"]),OU(t,e)}const RU=P.newInstance(NE,"vtkHardwareSelector");var MU={newInstance:RU,extend:NE};const _U={GLOBALIDS:0,PEDIGREEIDS:1,VALUES:2,INDICES:3,FRUSTUM:4,LOCATIONS:5,THRESHOLDS:6,BLOCKS:7,QUERY:8},bU={CELL:0,POINT:1,FIELD:2,VERTEX:3,EDGE:4,ROW:5};var LU={SelectionContent:_U,SelectionField:bU};function IU(t,e){e.classHierarchy.push("vtkSelectionNode"),t.getBounds=()=>e.points.getBounds()}const VU={contentType:-1,fieldType:-1,properties:null,selectionList:[]};function kE(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,VU,n),P.obj(t,e),e.properties={},P.setGet(t,e,["contentType","fieldType","properties","selectionList"]),IU(t,e)}const PU=P.newInstance(kE,"vtkSelectionNode");var AE={newInstance:PU,extend:kE,...LU};const{PassTypes:Un}=bE,{SelectionContent:NU,SelectionField:C9}=AE,{FieldAssociations:rg}=Zu,{vtkErrorMacro:FE}=P,tc=1;function UE(t){return`${t.propID} ${t.compositeID}`}function BE(t,e,n,r){if(!n)return 0;const i=(e*(r[2]-r[0]+1)+t)*4;return n[i+3]}function Zo(t,e,n,r){if(!n)return 0;const i=(e*(r[2]-r[0]+1)+t)*4,a=n[i],o=n[i+1];return(n[i+2]*256+o)*256+a}function GE(t,e){let n=e;return n<<=24,n|=t,n}function kU(t,e,n,r){{if(r[0]=e[0],r[1]=e[1],e[0]<t.area[0]||e[0]>t.area[2]||e[1]<t.area[1]||e[1]>t.area[3])return null;const i=[e[0]-t.area[0],e[1]-t.area[1]],a=Zo(i[0],i[1],t.pixBuffer[Un.ACTOR_PASS],t.area);if(a<=0||a-tc>=t.props.length)return null;const o={};o.valid=!0,o.propID=a-tc,o.prop=t.props[o.propID];let s=Zo(i[0],i[1],t.pixBuffer[Un.COMPOSITE_INDEX_PASS],t.area);if((s<0||s>16777215)&&(s=0),o.compositeID=s-tc,t.captureZValues){const f=(i[1]*(t.area[2]-t.area[0]+1)+i[0])*4;o.zValue=(256*t.zBuffer[f]+t.zBuffer[f+1])/65535,o.displayPosition=e}if(t.pixBuffer[Un.ID_LOW24]&&BE(i[0],i[1],t.pixBuffer[Un.ID_LOW24],t.area)===0)return o;const c=Zo(i[0],i[1],t.pixBuffer[Un.ID_LOW24],t.area),l=Zo(i[0],i[1],t.pixBuffer[Un.ID_HIGH24],t.area);return o.attributeID=GE(c,l),o}}function $E(t,e,n,r,i){const a=[];let o=0;return e.forEach((s,c)=>{const l=AE.newInstance();switch(l.setContentType(NU.INDICES),t){case rg.FIELD_ASSOCIATION_CELLS:l.setFieldType(C9.CELL);break;case rg.FIELD_ASSOCIATION_POINTS:l.setFieldType(C9.POINT);break;default:FE("Unknown field association")}l.getProperties().propID=s.info.propID,l.getProperties().prop=s.info.prop,l.getProperties().compositeID=s.info.compositeID,l.getProperties().attributeID=s.info.attributeID,l.getProperties().pixelCount=s.pixelCount,n&&(l.getProperties().displayPosition=[s.info.displayPosition[0],s.info.displayPosition[1],s.info.zValue],l.getProperties().worldPosition=i.displayToWorld(s.info.displayPosition[0],s.info.displayPosition[1],s.info.zValue,r)),l.setSelectionList(s.attributeIDs),a[o]=l,o++}),a}function AU(t,e,n,r,i){const a=Math.floor(e),o=Math.floor(n),s=Math.floor(r),c=Math.floor(i),l=new Map,f=[0,0];for(let u=o;u<=c;u++)for(let g=a;g<=s;g++){const h=kU(t,[g,u],0,f);if(h&&h.valid){const p=UE(h);if(!l.has(p))l.set(p,{info:h,pixelCount:1,attributeIDs:[h.attributeID]});else{const m=l.get(p);m.pixelCount++,t.captureZValues&&h.zValue<m.info.zValue&&(m.info=h),m.attributeIDs.indexOf(h.attributeID)===-1&&m.attributeIDs.push(h.attributeID)}}}return $E(t.fieldAssociation,l,t.captureZValues,t.renderer,t.openGLRenderWindow)}function FU(t,e){e.classHierarchy.push("vtkOpenGLHardwareSelector"),t.releasePixBuffers=()=>{e.rawPixBuffer=[],e.pixBuffer=[],e.zBuffer=null},t.beginSelection=()=>{e._openGLRenderer=e._openGLRenderWindow.getViewNodeFor(e._renderer),e.maxAttributeId=0;const r=e._openGLRenderWindow.getSize();if(!e.framebuffer)e.framebuffer=f2.newInstance(),e.framebuffer.setOpenGLRenderWindow(e._openGLRenderWindow),e.framebuffer.saveCurrentBindingsAndBuffers(),e.framebuffer.create(r[0],r[1]),e.framebuffer.populateFramebuffer();else{e.framebuffer.setOpenGLRenderWindow(e._openGLRenderWindow),e.framebuffer.saveCurrentBindingsAndBuffers();const i=e.framebuffer.getSize();!i||i[0]!==r[0]||i[1]!==r[1]?(e.framebuffer.create(r[0],r[1]),e.framebuffer.populateFramebuffer()):e.framebuffer.bind()}if(e._openGLRenderer.clear(),e._openGLRenderer.setSelector(t),e.hitProps={},e.propPixels={},e.props=[],t.releasePixBuffers(),e.fieldAssociation===rg.FIELD_ASSOCIATION_POINTS){const i=e._openGLRenderWindow.getContext(),a=i.isEnabled(i.BLEND);i.disable(i.BLEND),e._openGLRenderWindow.traverseAllPasses(),a&&i.enable(i.BLEND)}},t.endSelection=()=>{e.hitProps={},e._openGLRenderer.setSelector(null),e.framebuffer.restorePreviousBindingsAndBuffers()},t.preCapturePass=()=>{const r=e._openGLRenderWindow.getContext();e.originalBlending=r.isEnabled(r.BLEND),r.disable(r.BLEND)},t.postCapturePass=()=>{const r=e._openGLRenderWindow.getContext();e.originalBlending&&r.enable(r.BLEND)},t.select=()=>{let r=null;return t.captureBuffers()&&(r=t.generateSelection(e.area[0],e.area[1],e.area[2],e.area[3]),t.releasePixBuffers()),r},t.getSourceDataAsync=async(r,i,a,o,s)=>{if(e._renderer=r,i===void 0){const l=e._openGLRenderWindow.getSize();t.setArea(0,0,l[0]-1,l[1]-1)}else t.setArea(i,a,o,s);if(!t.captureBuffers())return!1;const c={area:[...e.area],pixBuffer:[...e.pixBuffer],captureZValues:e.captureZValues,zBuffer:e.zBuffer,props:[...e.props],fieldAssociation:e.fieldAssociation,renderer:r,openGLRenderWindow:e._openGLRenderWindow};return c.generateSelection=function(){for(var l=arguments.length,f=new Array(l),u=0;u<l;u++)f[u]=arguments[u];return AU(c,...f)},c},t.captureBuffers=()=>{if(!e._renderer||!e._openGLRenderWindow)return FE("Renderer and view must be set before calling Select."),!1;e._openGLRenderer=e._openGLRenderWindow.getViewNodeFor(e._renderer),e._openGLRenderWindow.getRenderable().preRender(),t.invokeEvent({type:"StartEvent"}),e.originalBackground=e._renderer.getBackgroundByReference(),e._renderer.setBackground(0,0,0,0);const r=e._openGLRenderWindow.getRenderPasses();t.beginSelection();const i=[];for(e.currentPass=Un.MIN_KNOWN_PASS;e.currentPass<=Un.MAX_KNOWN_PASS;e.currentPass++)t.passRequired(e.currentPass)&&(t.preCapturePass(e.currentPass),e.captureZValues&&e.currentPass===Un.ACTOR_PASS&&typeof r[0].requestDepth=="function"&&typeof r[0].getFramebuffer=="function"&&r[0].requestDepth(),e._openGLRenderWindow.traverseAllPasses(),t.postCapturePass(e.currentPass),t.savePixelBuffer(e.currentPass),i.push(e.currentPass));return i.forEach(a=>{e.currentPass=a,t.processPixelBuffers()}),e.currentPass=Un.MAX_KNOWN_PASS,t.endSelection(),e._renderer.setBackground(e.originalBackground),t.invokeEvent({type:"EndEvent"}),!0},t.processPixelBuffers=()=>{e.props.forEach((r,i)=>{t.isPropHit(i)&&r.processSelectorPixelBuffers(t,e.propPixels[i])})},t.passRequired=r=>{if(r===Un.ID_HIGH24){if(e.fieldAssociation===rg.FIELD_ASSOCIATION_POINTS)return e.maximumPointId>16777215;if(e.fieldAssociation===rg.FIELD_ASSOCIATION_CELLS)return e.maximumCellId>16777215}return!0},t.savePixelBuffer=r=>{if(e.pixBuffer[r]=e._openGLRenderWindow.getPixelData(e.area[0],e.area[1],e.area[2],e.area[3]),!e.rawPixBuffer[r]){const i=(e.area[2]-e.area[0]+1)*(e.area[3]-e.area[1]+1)*4;e.rawPixBuffer[r]=new Uint8Array(i),e.rawPixBuffer[r].set(e.pixBuffer[r])}if(r===Un.ACTOR_PASS){if(e.captureZValues){const i=e._openGLRenderWindow.getRenderPasses();if(typeof i[0].requestDepth=="function"&&typeof i[0].getFramebuffer=="function"){const a=i[0].getFramebuffer();a.saveCurrentBindingsAndBuffers(),a.bind(),e.zBuffer=e._openGLRenderWindow.getPixelData(e.area[0],e.area[1],e.area[2],e.area[3]),a.restorePreviousBindingsAndBuffers()}}t.buildPropHitList(e.rawPixBuffer[r])}},t.buildPropHitList=r=>{let i=0;for(let a=0;a<=e.area[3]-e.area[1];a++)for(let o=0;o<=e.area[2]-e.area[0];o++){let s=Zo(o,a,r,e.area);s>0&&(s--,s in e.hitProps||(e.hitProps[s]=!0,e.propPixels[s]=[]),e.propPixels[s].push(i*4)),++i}},t.renderProp=r=>{e.currentPass===Un.ACTOR_PASS&&(t.setPropColorValueFromInt(e.props.length+tc),e.props.push(r))},t.renderCompositeIndex=r=>{e.currentPass===Un.COMPOSITE_INDEX_PASS&&t.setPropColorValueFromInt(r+tc)},t.renderAttributeId=r=>{r<0||(e.maxAttributeId=r>e.maxAttributeId?r:e.maxAttributeId)},t.passTypeToString=r=>P.enumToString(Un,r),t.isPropHit=r=>!!e.hitProps[r],t.setPropColorValueFromInt=r=>{e.propColorValue[0]=r%256/255,e.propColorValue[1]=Math.floor(r/256)%256/255,e.propColorValue[2]=Math.floor(r/65536)%256/255},t.getPixelInformation=(r,i,a)=>{const o=i<0?0:i;if(o===0){if(a[0]=r[0],a[1]=r[1],r[0]<e.area[0]||r[0]>e.area[2]||r[1]<e.area[1]||r[1]>e.area[3])return null;const f=[r[0]-e.area[0],r[1]-e.area[1]],u=Zo(f[0],f[1],e.pixBuffer[Un.ACTOR_PASS],e.area);if(u<=0||u-tc>=e.props.length)return null;const g={};g.valid=!0,g.propID=u-tc,g.prop=e.props[g.propID];let d=Zo(f[0],f[1],e.pixBuffer[Un.COMPOSITE_INDEX_PASS],e.area);if((d<0||d>16777215)&&(d=0),g.compositeID=d-tc,e.captureZValues){const m=(f[1]*(e.area[2]-e.area[0]+1)+f[0])*4;g.zValue=(256*e.zBuffer[m]+e.zBuffer[m+1])/65535,g.displayPosition=r}if(e.pixBuffer[Un.ID_LOW24]&&BE(f[0],f[1],e.pixBuffer[Un.ID_LOW24],e.area)===0)return g;const h=Zo(f[0],f[1],e.pixBuffer[Un.ID_LOW24],e.area),p=Zo(f[0],f[1],e.pixBuffer[Un.ID_HIGH24],e.area);return g.attributeID=GE(h,p),g}const s=[r[0],r[1]],c=[0,0];let l=t.getPixelInformation(r,0,a);if(l&&l.valid)return l;for(let f=1;f<o;++f){for(let u=s[1]>f?s[1]-f:0;u<=s[1]+f;++u)if(c[1]=u,s[0]>=f&&(c[0]=s[0]-f,l=t.getPixelInformation(c,0,a),l&&l.valid)||(c[0]=s[0]+f,l=t.getPixelInformation(c,0,a),l&&l.valid))return l;for(let u=s[0]>=f?s[0]-(f-1):0;u<=s[0]+(f-1);++u)if(c[0]=u,s[1]>=f&&(c[1]=s[1]-f,l=t.getPixelInformation(c,0,a),l&&l.valid)||(c[1]=s[1]+f,l=t.getPixelInformation(c,0,a),l&&l.valid))return l}return a[0]=r[0],a[1]=r[1],null},t.generateSelection=(r,i,a,o)=>{const s=Math.floor(r),c=Math.floor(i),l=Math.floor(a),f=Math.floor(o),u=new Map,g=[0,0];for(let d=c;d<=f;d++)for(let h=s;h<=l;h++){const p=[h,d],m=t.getPixelInformation(p,0,g);if(m&&m.valid){const v=UE(m);if(!u.has(v))u.set(v,{info:m,pixelCount:1,attributeIDs:[m.attributeID]});else{const y=u.get(v);y.pixelCount++,e.captureZValues&&m.zValue<y.info.zValue&&(y.info=m),y.attributeIDs.indexOf(m.attributeID)===-1&&y.attributeIDs.push(m.attributeID)}}}return $E(e.fieldAssociation,u,e.captureZValues,e._renderer,e._openGLRenderWindow)},t.getRawPixelBuffer=r=>e.rawPixBuffer[r],t.getPixelBuffer=r=>e.pixBuffer[r],t.attach=(r,i)=>{e._openGLRenderWindow=r,e._renderer=i};const n=t.setArea;t.setArea=function(){return n(...arguments)?(e.area[0]=Math.floor(e.area[0]),e.area[1]=Math.floor(e.area[1]),e.area[2]=Math.floor(e.area[2]),e.area[3]=Math.floor(e.area[3]),!0):!1}}const UU={area:void 0,currentPass:-1,propColorValue:null,props:null,maximumPointId:0,maximumCellId:0,idOffset:1};function WE(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,UU,n),MU.extend(t,e,n),e.propColorValue=[0,0,0],e.props=[],e.area||(e.area=[0,0,0,0]),P.setGetArray(t,e,["area"],4),P.setGet(t,e,["_renderer","currentPass","_openGLRenderWindow","maximumPointId","maximumCellId"]),P.setGetArray(t,e,["propColorValue"],3),P.moveToProtected(t,e,["renderer","openGLRenderWindow"]),P.event(t,e,"event"),FU(t,e)}const BU=P.newInstance(WE,"vtkOpenGLHardwareSelector");var H4={newInstance:BU,extend:WE,...bE},zE={exports:{}};(function(t,e){(function(n){t.exports=n()})(function(n){var r=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"];function i(v,y){var T=v[0],C=v[1],w=v[2],x=v[3];T+=(C&w|~C&x)+y[0]-680876936|0,T=(T<<7|T>>>25)+C|0,x+=(T&C|~T&w)+y[1]-389564586|0,x=(x<<12|x>>>20)+T|0,w+=(x&T|~x&C)+y[2]+606105819|0,w=(w<<17|w>>>15)+x|0,C+=(w&x|~w&T)+y[3]-1044525330|0,C=(C<<22|C>>>10)+w|0,T+=(C&w|~C&x)+y[4]-176418897|0,T=(T<<7|T>>>25)+C|0,x+=(T&C|~T&w)+y[5]+1200080426|0,x=(x<<12|x>>>20)+T|0,w+=(x&T|~x&C)+y[6]-1473231341|0,w=(w<<17|w>>>15)+x|0,C+=(w&x|~w&T)+y[7]-45705983|0,C=(C<<22|C>>>10)+w|0,T+=(C&w|~C&x)+y[8]+1770035416|0,T=(T<<7|T>>>25)+C|0,x+=(T&C|~T&w)+y[9]-1958414417|0,x=(x<<12|x>>>20)+T|0,w+=(x&T|~x&C)+y[10]-42063|0,w=(w<<17|w>>>15)+x|0,C+=(w&x|~w&T)+y[11]-1990404162|0,C=(C<<22|C>>>10)+w|0,T+=(C&w|~C&x)+y[12]+1804603682|0,T=(T<<7|T>>>25)+C|0,x+=(T&C|~T&w)+y[13]-40341101|0,x=(x<<12|x>>>20)+T|0,w+=(x&T|~x&C)+y[14]-1502002290|0,w=(w<<17|w>>>15)+x|0,C+=(w&x|~w&T)+y[15]+1236535329|0,C=(C<<22|C>>>10)+w|0,T+=(C&x|w&~x)+y[1]-165796510|0,T=(T<<5|T>>>27)+C|0,x+=(T&w|C&~w)+y[6]-1069501632|0,x=(x<<9|x>>>23)+T|0,w+=(x&C|T&~C)+y[11]+643717713|0,w=(w<<14|w>>>18)+x|0,C+=(w&T|x&~T)+y[0]-373897302|0,C=(C<<20|C>>>12)+w|0,T+=(C&x|w&~x)+y[5]-701558691|0,T=(T<<5|T>>>27)+C|0,x+=(T&w|C&~w)+y[10]+38016083|0,x=(x<<9|x>>>23)+T|0,w+=(x&C|T&~C)+y[15]-660478335|0,w=(w<<14|w>>>18)+x|0,C+=(w&T|x&~T)+y[4]-405537848|0,C=(C<<20|C>>>12)+w|0,T+=(C&x|w&~x)+y[9]+568446438|0,T=(T<<5|T>>>27)+C|0,x+=(T&w|C&~w)+y[14]-1019803690|0,x=(x<<9|x>>>23)+T|0,w+=(x&C|T&~C)+y[3]-187363961|0,w=(w<<14|w>>>18)+x|0,C+=(w&T|x&~T)+y[8]+1163531501|0,C=(C<<20|C>>>12)+w|0,T+=(C&x|w&~x)+y[13]-1444681467|0,T=(T<<5|T>>>27)+C|0,x+=(T&w|C&~w)+y[2]-51403784|0,x=(x<<9|x>>>23)+T|0,w+=(x&C|T&~C)+y[7]+1735328473|0,w=(w<<14|w>>>18)+x|0,C+=(w&T|x&~T)+y[12]-1926607734|0,C=(C<<20|C>>>12)+w|0,T+=(C^w^x)+y[5]-378558|0,T=(T<<4|T>>>28)+C|0,x+=(T^C^w)+y[8]-2022574463|0,x=(x<<11|x>>>21)+T|0,w+=(x^T^C)+y[11]+1839030562|0,w=(w<<16|w>>>16)+x|0,C+=(w^x^T)+y[14]-35309556|0,C=(C<<23|C>>>9)+w|0,T+=(C^w^x)+y[1]-1530992060|0,T=(T<<4|T>>>28)+C|0,x+=(T^C^w)+y[4]+1272893353|0,x=(x<<11|x>>>21)+T|0,w+=(x^T^C)+y[7]-155497632|0,w=(w<<16|w>>>16)+x|0,C+=(w^x^T)+y[10]-1094730640|0,C=(C<<23|C>>>9)+w|0,T+=(C^w^x)+y[13]+681279174|0,T=(T<<4|T>>>28)+C|0,x+=(T^C^w)+y[0]-358537222|0,x=(x<<11|x>>>21)+T|0,w+=(x^T^C)+y[3]-722521979|0,w=(w<<16|w>>>16)+x|0,C+=(w^x^T)+y[6]+76029189|0,C=(C<<23|C>>>9)+w|0,T+=(C^w^x)+y[9]-640364487|0,T=(T<<4|T>>>28)+C|0,x+=(T^C^w)+y[12]-421815835|0,x=(x<<11|x>>>21)+T|0,w+=(x^T^C)+y[15]+530742520|0,w=(w<<16|w>>>16)+x|0,C+=(w^x^T)+y[2]-995338651|0,C=(C<<23|C>>>9)+w|0,T+=(w^(C|~x))+y[0]-198630844|0,T=(T<<6|T>>>26)+C|0,x+=(C^(T|~w))+y[7]+1126891415|0,x=(x<<10|x>>>22)+T|0,w+=(T^(x|~C))+y[14]-1416354905|0,w=(w<<15|w>>>17)+x|0,C+=(x^(w|~T))+y[5]-57434055|0,C=(C<<21|C>>>11)+w|0,T+=(w^(C|~x))+y[12]+1700485571|0,T=(T<<6|T>>>26)+C|0,x+=(C^(T|~w))+y[3]-1894986606|0,x=(x<<10|x>>>22)+T|0,w+=(T^(x|~C))+y[10]-1051523|0,w=(w<<15|w>>>17)+x|0,C+=(x^(w|~T))+y[1]-2054922799|0,C=(C<<21|C>>>11)+w|0,T+=(w^(C|~x))+y[8]+1873313359|0,T=(T<<6|T>>>26)+C|0,x+=(C^(T|~w))+y[15]-30611744|0,x=(x<<10|x>>>22)+T|0,w+=(T^(x|~C))+y[6]-1560198380|0,w=(w<<15|w>>>17)+x|0,C+=(x^(w|~T))+y[13]+1309151649|0,C=(C<<21|C>>>11)+w|0,T+=(w^(C|~x))+y[4]-145523070|0,T=(T<<6|T>>>26)+C|0,x+=(C^(T|~w))+y[11]-1120210379|0,x=(x<<10|x>>>22)+T|0,w+=(T^(x|~C))+y[2]+718787259|0,w=(w<<15|w>>>17)+x|0,C+=(x^(w|~T))+y[9]-343485551|0,C=(C<<21|C>>>11)+w|0,v[0]=T+v[0]|0,v[1]=C+v[1]|0,v[2]=w+v[2]|0,v[3]=x+v[3]|0}function a(v){var y=[],T;for(T=0;T<64;T+=4)y[T>>2]=v.charCodeAt(T)+(v.charCodeAt(T+1)<<8)+(v.charCodeAt(T+2)<<16)+(v.charCodeAt(T+3)<<24);return y}function o(v){var y=[],T;for(T=0;T<64;T+=4)y[T>>2]=v[T]+(v[T+1]<<8)+(v[T+2]<<16)+(v[T+3]<<24);return y}function s(v){var y=v.length,T=[1732584193,-271733879,-1732584194,271733878],C,w,x,O,M,A;for(C=64;C<=y;C+=64)i(T,a(v.substring(C-64,C)));for(v=v.substring(C-64),w=v.length,x=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],C=0;C<w;C+=1)x[C>>2]|=v.charCodeAt(C)<<(C%4<<3);if(x[C>>2]|=128<<(C%4<<3),C>55)for(i(T,x),C=0;C<16;C+=1)x[C]=0;return O=y*8,O=O.toString(16).match(/(.*?)(.{0,8})$/),M=parseInt(O[2],16),A=parseInt(O[1],16)||0,x[14]=M,x[15]=A,i(T,x),T}function c(v){var y=v.length,T=[1732584193,-271733879,-1732584194,271733878],C,w,x,O,M,A;for(C=64;C<=y;C+=64)i(T,o(v.subarray(C-64,C)));for(v=C-64<y?v.subarray(C-64):new Uint8Array(0),w=v.length,x=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],C=0;C<w;C+=1)x[C>>2]|=v[C]<<(C%4<<3);if(x[C>>2]|=128<<(C%4<<3),C>55)for(i(T,x),C=0;C<16;C+=1)x[C]=0;return O=y*8,O=O.toString(16).match(/(.*?)(.{0,8})$/),M=parseInt(O[2],16),A=parseInt(O[1],16)||0,x[14]=M,x[15]=A,i(T,x),T}function l(v){var y="",T;for(T=0;T<4;T+=1)y+=r[v>>T*8+4&15]+r[v>>T*8&15];return y}function f(v){var y;for(y=0;y<v.length;y+=1)v[y]=l(v[y]);return v.join("")}f(s("hello")),typeof ArrayBuffer<"u"&&!ArrayBuffer.prototype.slice&&function(){function v(y,T){return y=y|0||0,y<0?Math.max(y+T,0):Math.min(y,T)}ArrayBuffer.prototype.slice=function(y,T){var C=this.byteLength,w=v(y,C),x=C,O,M,A,_;return T!==n&&(x=v(T,C)),w>x?new ArrayBuffer(0):(O=x-w,M=new ArrayBuffer(O),A=new Uint8Array(M),_=new Uint8Array(this,w,O),A.set(_),M)}}();function u(v){return/[\u0080-\uFFFF]/.test(v)&&(v=unescape(encodeURIComponent(v))),v}function g(v,y){var T=v.length,C=new ArrayBuffer(T),w=new Uint8Array(C),x;for(x=0;x<T;x+=1)w[x]=v.charCodeAt(x);return y?w:C}function d(v){return String.fromCharCode.apply(null,new Uint8Array(v))}function h(v,y,T){var C=new Uint8Array(v.byteLength+y.byteLength);return C.set(new Uint8Array(v)),C.set(new Uint8Array(y),v.byteLength),C}function p(v){var y=[],T=v.length,C;for(C=0;C<T-1;C+=2)y.push(parseInt(v.substr(C,2),16));return String.fromCharCode.apply(String,y)}function m(){this.reset()}return m.prototype.append=function(v){return this.appendBinary(u(v)),this},m.prototype.appendBinary=function(v){this._buff+=v,this._length+=v.length;var y=this._buff.length,T;for(T=64;T<=y;T+=64)i(this._hash,a(this._buff.substring(T-64,T)));return this._buff=this._buff.substring(T-64),this},m.prototype.end=function(v){var y=this._buff,T=y.length,C,w=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],x;for(C=0;C<T;C+=1)w[C>>2]|=y.charCodeAt(C)<<(C%4<<3);return this._finish(w,T),x=f(this._hash),v&&(x=p(x)),this.reset(),x},m.prototype.reset=function(){return this._buff="",this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},m.prototype.getState=function(){return{buff:this._buff,length:this._length,hash:this._hash.slice()}},m.prototype.setState=function(v){return this._buff=v.buff,this._length=v.length,this._hash=v.hash,this},m.prototype.destroy=function(){delete this._hash,delete this._buff,delete this._length},m.prototype._finish=function(v,y){var T=y,C,w,x;if(v[T>>2]|=128<<(T%4<<3),T>55)for(i(this._hash,v),T=0;T<16;T+=1)v[T]=0;C=this._length*8,C=C.toString(16).match(/(.*?)(.{0,8})$/),w=parseInt(C[2],16),x=parseInt(C[1],16)||0,v[14]=w,v[15]=x,i(this._hash,v)},m.hash=function(v,y){return m.hashBinary(u(v),y)},m.hashBinary=function(v,y){var T=s(v),C=f(T);return y?p(C):C},m.ArrayBuffer=function(){this.reset()},m.ArrayBuffer.prototype.append=function(v){var y=h(this._buff.buffer,v),T=y.length,C;for(this._length+=v.byteLength,C=64;C<=T;C+=64)i(this._hash,o(y.subarray(C-64,C)));return this._buff=C-64<T?new Uint8Array(y.buffer.slice(C-64)):new Uint8Array(0),this},m.ArrayBuffer.prototype.end=function(v){var y=this._buff,T=y.length,C=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],w,x;for(w=0;w<T;w+=1)C[w>>2]|=y[w]<<(w%4<<3);return this._finish(C,T),x=f(this._hash),v&&(x=p(x)),this.reset(),x},m.ArrayBuffer.prototype.reset=function(){return this._buff=new Uint8Array(0),this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},m.ArrayBuffer.prototype.getState=function(){var v=m.prototype.getState.call(this);return v.buff=d(v.buff),v},m.ArrayBuffer.prototype.setState=function(v){return v.buff=g(v.buff,!0),m.prototype.setState.call(this,v)},m.ArrayBuffer.prototype.destroy=m.prototype.destroy,m.ArrayBuffer.prototype._finish=m.prototype._finish,m.ArrayBuffer.hash=function(v,y){var T=c(new Uint8Array(v)),C=f(T);return y?p(C):C},m})})(zE);var GU=zE.exports;const $U=Eo(GU),WU=["lastShaderProgramBound","context","_openGLRenderWindow"];function zU(t,e){e.classHierarchy.push("vtkShaderCache"),t.replaceShaderValues=(n,r,i)=>{let a=r;i.length>0&&(a=te.substitute(a,"VSOut","GSOut").result);const o=e._openGLRenderWindow.getWebgl2();let s=`
`,c=`#version 100
`;o?c=`#version 300 es
#define attribute in
#define textureCube texture
#define texture2D texture
#define textureCubeLod textureLod
#define texture2DLod textureLod
`:(e.context.getExtension("OES_standard_derivatives"),e.context.getExtension("EXT_frag_depth")&&(s=`#extension GL_EXT_frag_depth : enable
`),e.context.getExtension("EXT_shader_texture_lod")&&(s+=`#extension GL_EXT_shader_texture_lod : enable
#define textureCubeLod textureCubeLodEXT
#define texture2DLod texture2DLodEXT`)),a=te.substitute(a,"//VTK::System::Dec",[`${c}
`,o?"":`#extension GL_OES_standard_derivatives : enable
`,s,"#ifdef GL_FRAGMENT_PRECISION_HIGH","precision highp float;","precision highp int;","#else","precision mediump float;","precision mediump int;","#endif"]).result;let l=te.substitute(n,"//VTK::System::Dec",[`${c}
`,"#ifdef GL_FRAGMENT_PRECISION_HIGH","precision highp float;","precision highp int;","#else","precision mediump float;","precision mediump int;","#endif"]).result;if(o){l=te.substitute(l,"varying","out").result,a=te.substitute(a,"varying","in").result;let u="",g=0;for(;a.includes(`gl_FragData[${g}]`);)a=te.substitute(a,`gl_FragData\\[${g}\\]`,`fragOutput${g}`).result,u+=`layout(location = ${g}) out vec4 fragOutput${g};
`,g++;a=te.substitute(a,"//VTK::Output::Dec",u).result}const f=te.substitute(i,"//VTK::System::Dec",c).result;return{VSSource:l,FSSource:a,GSSource:f}},t.readyShaderProgramArray=(n,r,i)=>{const a=t.replaceShaderValues(n,r,i),o=t.getShaderProgram(a.VSSource,a.FSSource,a.GSSource);return t.readyShaderProgram(o)},t.readyShaderProgram=n=>!n||!n.getCompiled()&&!n.compileShader()||!t.bindShaderProgram(n)?null:n,t.getShaderProgram=(n,r,i)=>{const a=`${n}${r}${i}`,o=$U.hash(a);if(!(o in e.shaderPrograms)){const s=te.newInstance();return s.setContext(e.context),s.getVertexShader().setSource(n),s.getFragmentShader().setSource(r),i&&s.getGeometryShader().setSource(i),s.setMd5Hash(o),e.shaderPrograms[o]=s,s}return e.shaderPrograms[o]},t.releaseGraphicsResources=n=>{t.releaseCurrentShaderProgram(),Object.keys(e.shaderPrograms).map(r=>e.shaderPrograms[r]).forEach(r=>r.cleanup()),e.shaderPrograms={}},t.releaseCurrentShaderProgram=()=>{e.lastShaderProgramBound&&(e.lastShaderProgramBound.cleanup(),e.lastShaderProgramBound=null)},t.bindShaderProgram=n=>(e.lastShaderProgramBound===n||(e.lastShaderProgramBound&&e.lastShaderProgramBound.release(),n.bind(),e.lastShaderProgramBound=n),1)}const jU={lastShaderProgramBound:null,shaderPrograms:null,context:null};function jE(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,jU,n),e.shaderPrograms={},P.obj(t,e),P.setGet(t,e,WU),P.moveToProtected(t,e,["openGLRenderWindow"]),zU(t,e)}const HU=P.newInstance(jE,"vtkShaderCache");var KU={newInstance:HU,extend:jE};const{vtkErrorMacro:qU}=P;function XU(t,e){e.classHierarchy.push("vtkOpenGLTextureUnitManager"),t.deleteTable=()=>{for(let n=0;n<e.numberOfTextureUnits;++n)e.textureUnits[n]===!0&&qU("some texture units  were not properly released");e.textureUnits=[],e.numberOfTextureUnits=0},t.setContext=n=>{if(e.context!==n){if(e.context!==0&&t.deleteTable(),e.context=n,e.context){e.numberOfTextureUnits=n.getParameter(n.MAX_TEXTURE_IMAGE_UNITS);for(let r=0;r<e.numberOfTextureUnits;++r)e.textureUnits[r]=!1}t.modified()}},t.allocate=()=>{for(let n=0;n<e.numberOfTextureUnits;n++)if(!t.isAllocated(n))return e.textureUnits[n]=!0,n;return-1},t.allocateUnit=n=>t.isAllocated(n)?-1:(e.textureUnits[n]=!0,n),t.isAllocated=n=>e.textureUnits[n],t.free=n=>{e.textureUnits[n]=!1},t.freeAll=()=>{for(let n=0;n<e.numberOfTextureUnits;++n)e.textureUnits[n]=!1}}const YU={context:null,numberOfTextureUnits:0,textureUnits:0};function HE(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,YU,n),P.obj(t,e),e.textureUnits=[],P.get(t,e,["numberOfTextureUnits"]),P.setGet(t,e,["context"]),XU(t,e)}const ZU=P.newInstance(HE,"vtkOpenGLTextureUnitManager");var QU={newInstance:ZU,extend:HE};function JU(t,e){e.classHierarchy.push("vtkRenderWindowViewNode"),t.getViewNodeFactory=()=>null,t.getAspectRatio=()=>e.size[0]/e.size[1],t.getAspectRatioForRenderer=n=>{const r=n.getViewportByReference();return e.size[0]*(r[2]-r[0])/((r[3]-r[1])*e.size[1])},t.isInViewport=(n,r,i)=>{const a=i.getViewportByReference(),o=t.getFramebufferSize();return a[0]*o[0]<=n&&a[2]*o[0]>=n&&a[1]*o[1]<=r&&a[3]*o[1]>=r},t.getViewportSize=n=>{const r=n.getViewportByReference(),i=t.getFramebufferSize();return[(r[2]-r[0])*i[0],(r[3]-r[1])*i[1]]},t.getViewportCenter=n=>{const r=t.getViewportSize(n);return[r[0]*.5,r[1]*.5]},t.displayToNormalizedDisplay=(n,r,i)=>{const a=t.getFramebufferSize();return[n/a[0],r/a[1],i]},t.normalizedDisplayToDisplay=(n,r,i)=>{const a=t.getFramebufferSize();return[n*a[0],r*a[1],i]},t.worldToView=(n,r,i,a)=>a.worldToView(n,r,i),t.viewToWorld=(n,r,i,a)=>a.viewToWorld(n,r,i),t.worldToDisplay=(n,r,i,a)=>{const o=a.worldToView(n,r,i),s=t.getViewportSize(a),c=a.viewToProjection(o[0],o[1],o[2],s[0]/s[1]),l=a.projectionToNormalizedDisplay(c[0],c[1],c[2]);return t.normalizedDisplayToDisplay(l[0],l[1],l[2])},t.displayToWorld=(n,r,i,a)=>{const o=t.displayToNormalizedDisplay(n,r,i),s=a.normalizedDisplayToProjection(o[0],o[1],o[2]),c=t.getViewportSize(a),l=a.projectionToView(s[0],s[1],s[2],c[0]/c[1]);return a.viewToWorld(l[0],l[1],l[2])},t.normalizedDisplayToViewport=(n,r,i,a)=>{let o=a.getViewportByReference();o=t.normalizedDisplayToDisplay(o[0],o[1],0);const s=t.normalizedDisplayToDisplay(n,r,i);return[s[0]-o[0]-.5,s[1]-o[1]-.5,i]},t.viewportToNormalizedViewport=(n,r,i,a)=>{const o=t.getViewportSize(a);return o&&o[0]!==0&&o[1]!==0?[n/(o[0]-1),r/(o[1]-1),i]:[n,r,i]},t.normalizedViewportToViewport=(n,r,i,a)=>{const o=t.getViewportSize(a);return[n*(o[0]-1),r*(o[1]-1),i]},t.displayToLocalDisplay=(n,r,i)=>{const a=t.getFramebufferSize();return[n,a[1]-r-1,i]},t.viewportToNormalizedDisplay=(n,r,i,a)=>{let o=a.getViewportByReference();o=t.normalizedDisplayToDisplay(o[0],o[1],0);const s=n+o[0]+.5,c=r+o[1]+.5;return t.displayToNormalizedDisplay(s,c,i)},t.getComputedDevicePixelRatio=()=>e.size[0]/t.getContainerSize()[0],t.getContainerSize=()=>{P.vtkErrorMacro("not implemented")},t.getPixelData=(n,r,i,a)=>{P.vtkErrorMacro("not implemented")},t.createSelector=()=>{P.vtkErrorMacro("not implemented")}}const eB={size:void 0,selector:void 0};function KE(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,eB,n),e.size||(e.size=[300,300]),P.getArray(t,e,["size"],2),P.get(t,e,["selector"]),Bt.extend(t,e,n),JU(t,e)}const tB=P.newInstance(KE,"vtkRenderWindowViewNode");var nB={newInstance:tB,extend:KE};const rB="__getUnderlyingContext";function iB(){const t=new Map,e={apply(i,a,o){return t.has(o[0])?t.get(o[0]):i.apply(a,o)}};function n(i){return{apply(a,o,s){return t.set(i,s[0]),a.apply(o,s)}}}const r=Object.create(null);return r.getParameter=(i,a,o,s)=>new Proxy(s.bind(i),e),r.depthMask=(i,a,o,s)=>new Proxy(s.bind(i),n(i.DEPTH_WRITEMASK)),{get(i,a,o){if(a===rB)return()=>i;let s=Reflect.get(i,a,i);s instanceof Function&&(s=s.bind(i));const c=r[a];return c?c(i,a,o,s):s}}}const{vtkDebugMacro:w9,vtkErrorMacro:x9}=P,aB={position:"absolute",top:0,left:0,width:"100%",height:"100%"},oB=["activateTexture","deactivateTexture","disableCullFace","enableCullFace","get3DContext","getActiveFramebuffer","getContext","getDefaultTextureByteSize","getDefaultTextureInternalFormat","getDefaultToWebgl2","getGLInformations","getGraphicsMemoryInfo","getGraphicsResourceForObject","getHardwareMaximumLineWidth","getPixelData","getShaderCache","getTextureUnitForTexture","getTextureUnitManager","getWebgl2","makeCurrent","releaseGraphicsResources","registerGraphicsResourceUser","unregisterGraphicsResourceUser","restoreContext","setActiveFramebuffer","setContext","setDefaultToWebgl2","setGraphicsResourceForObject"];function ri(t,e,n){const r=t.createFramebuffer(),i=t.createTexture();t.bindTexture(t.TEXTURE_2D,i),t.texImage2D(t.TEXTURE_2D,0,e,2,2,0,e,n,null),t.bindFramebuffer(t.FRAMEBUFFER,r),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,i,0);const a=t.checkFramebufferStatus(t.FRAMEBUFFER);return t.bindFramebuffer(t.FRAMEBUFFER,null),t.bindTexture(t.TEXTURE_2D,null),a===t.FRAMEBUFFER_COMPLETE}let ch=0;const p2=[];function sB(){ch++,p2.forEach(t=>t(ch))}function cB(){ch--,p2.forEach(t=>t(ch))}function lB(t){p2.push(t)}function uB(t){return p2.pop()}function S9(t){t.preventDefault()}function fB(t,e){e.classHierarchy.push("vtkOpenGLRenderWindow");let n;function r(){return n||(n=iB()),n}t.getViewNodeFactory=()=>e.myFactory,e.canvas.addEventListener("webglcontextlost",S9,!1),e.canvas.addEventListener("webglcontextrestored",t.restoreContext,!1);const i=[0,0];function a(){e.renderable&&(e.size[0]!==i[0]||e.size[1]!==i[1])&&(i[0]=e.size[0],i[1]=e.size[1],e.canvas.setAttribute("width",e.size[0]),e.canvas.setAttribute("height",e.size[1])),e.viewStream&&e.viewStream.setSize(e.size[0],e.size[1]),e.canvas.style.display=e.useOffScreen?"none":"block",e.el&&(e.el.style.cursor=e.cursorVisibility?e.cursor:"none"),e.containerSize=null}t.onModified(a),t.buildPass=u=>{if(u){if(!e.renderable)return;t.prepareNodes(),t.addMissingNodes(e.renderable.getRenderersByReference()),t.addMissingNodes(e.renderable.getChildRenderWindowsByReference()),t.removeUnusedNodes(),t.initialize(),e.children.forEach(g=>{var d;(d=g.setOpenGLRenderWindow)==null||d.call(g,t)})}},t.initialize=()=>{if(!e.initialized){if(e.rootOpenGLRenderWindow=t.getLastAncestorOfType("vtkOpenGLRenderWindow"),e.rootOpenGLRenderWindow)e.context2D=t.get2DContext();else{e.context=t.get3DContext(),t.resizeFromChildRenderWindows(),e.context&&sB(),e.textureUnitManager=QU.newInstance(),e.textureUnitManager.setContext(e.context),e.shaderCache.setContext(e.context);const u=e.context;u.blendFuncSeparate(u.SRC_ALPHA,u.ONE_MINUS_SRC_ALPHA,u.ONE,u.ONE_MINUS_SRC_ALPHA),u.depthFunc(u.LEQUAL),u.enable(u.BLEND)}e.initialized=!0}},t.makeCurrent=()=>{e.context.makeCurrent()},t.setContainer=u=>{e.el&&e.el!==u&&(e.canvas.parentNode!==e.el&&x9("Error: canvas parent node does not match container"),e.el.removeChild(e.canvas),e.el.contains(e.bgImage)&&e.el.removeChild(e.bgImage)),e.el!==u&&(e.el=u,e.el&&(e.el.appendChild(e.canvas),e.useBackgroundImage&&e.el.appendChild(e.bgImage)),t.modified())},t.getContainer=()=>e.el,t.getContainerSize=()=>{if(!e.containerSize&&e.el){const{width:u,height:g}=e.el.getBoundingClientRect();e.containerSize=[u,g]}return e.containerSize||e.size},t.getFramebufferSize=()=>{var g;return((g=e.activeFramebuffer)==null?void 0:g.getSize())||e.size},t.getPixelData=(u,g,d,h)=>{const p=new Uint8Array((d-u+1)*(h-g+1)*4);return e.context.readPixels(u,g,d-u+1,h-g+1,e.context.RGBA,e.context.UNSIGNED_BYTE,p),p},t.get3DContext=function(){let u=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{preserveDrawingBuffer:!1,depth:!0,alpha:!0,powerPreference:"high-performance"},g=null;const d=typeof WebGL2RenderingContext<"u";return e.webgl2=!1,e.defaultToWebgl2&&d&&(g=e.canvas.getContext("webgl2",u),g&&(e.webgl2=!0,w9("using webgl2"))),g||(w9("using webgl1"),g=e.canvas.getContext("webgl",u)||e.canvas.getContext("experimental-webgl",u)),new Proxy(g,r())},t.get2DContext=function(){let u=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return e.canvas.getContext("2d",u)},t.restoreContext=()=>{const u=V4.newInstance();u.setCurrentOperation("Release"),u.traverse(t,null)},t.activateTexture=u=>{const g=e._textureResourceIds.get(u);if(g!==void 0){e.context.activeTexture(e.context.TEXTURE0+g);return}const d=t.getTextureUnitManager().allocate();if(d<0){x9("Hardware does not support the number of textures defined.");return}e._textureResourceIds.set(u,d),e.context.activeTexture(e.context.TEXTURE0+d)},t.deactivateTexture=u=>{const g=e._textureResourceIds.get(u);g!==void 0&&(t.getTextureUnitManager().free(g),e._textureResourceIds.delete(u))},t.getTextureUnitForTexture=u=>{const g=e._textureResourceIds.get(u);return g!==void 0?g:-1},t.getDefaultTextureByteSize=function(u){let g=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,d=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;if(e.webgl2)switch(u){case ut.CHAR:case ut.SIGNED_CHAR:case ut.UNSIGNED_CHAR:return 1;case g:case d:case ut.UNSIGNED_SHORT:case ut.SHORT:case ut.VOID:return 2;default:return 4}return 1},t.getDefaultTextureInternalFormat=function(u,g){let d=arguments.length>2&&arguments[2]!==void 0?arguments[2]:null,h=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;if(e.webgl2)switch(u){case ut.UNSIGNED_CHAR:switch(g){case 1:return e.context.R8;case 2:return e.context.RG8;case 3:return e.context.RGB8;case 4:default:return e.context.RGBA8}case(d&&!h&&ut.UNSIGNED_SHORT):switch(g){case 1:return d.R16_EXT;case 2:return d.RG16_EXT;case 3:return d.RGB16_EXT;case 4:default:return d.RGBA16_EXT}case(d&&!h&&ut.SHORT):switch(g){case 1:return d.R16_SNORM_EXT;case 2:return d.RG16_SNORM_EXT;case 3:return d.RGB16_SNORM_EXT;case 4:default:return d.RGBA16_SNORM_EXT}case ut.UNSIGNED_SHORT:case ut.SHORT:case ut.FLOAT:default:switch(g){case 1:return h?e.context.R16F:e.context.R32F;case 2:return h?e.context.RG16F:e.context.RG32F;case 3:return h?e.context.RGB16F:e.context.RGB32F;case 4:default:return h?e.context.RGBA16F:e.context.RGBA32F}}switch(g){case 1:return e.context.LUMINANCE;case 2:return e.context.LUMINANCE_ALPHA;case 3:return e.context.RGB;case 4:default:return e.context.RGBA}},t.setBackgroundImage=u=>{e.bgImage.src=u.src},t.setUseBackgroundImage=u=>{e.useBackgroundImage=u,e.useBackgroundImage&&!e.el.contains(e.bgImage)?e.el.appendChild(e.bgImage):!e.useBackgroundImage&&e.el.contains(e.bgImage)&&e.el.removeChild(e.bgImage)};function o(){let u=arguments.length>0&&arguments[0]!==void 0?arguments[0]:e.imageFormat;const g=document.createElement("canvas"),d=g.getContext("2d");g.width=e.canvas.width,g.height=e.canvas.height,d.drawImage(e.canvas,0,0);const h=e.canvas.getBoundingClientRect();e.renderable.getRenderers().forEach(y=>{y.getViewProps().forEach(C=>{if(C.getContainer){const x=C.getContainer().getElementsByTagName("canvas");for(let O=0;O<x.length;O++){const M=x[O],A=M.getBoundingClientRect(),_=A.x-h.x,k=A.y-h.y;d.drawImage(M,_,k)}}})});const v=g.toDataURL(u);g.remove(),t.invokeImageReady(v)}t.captureNextImage=function(){let u=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"image/png",{resetCamera:g=!1,size:d=null,scale:h=1}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(e.deleted)return null;e.imageFormat=u;const p=e.notifyStartCaptureImage;return e.notifyStartCaptureImage=!0,e._screenshot={size:d||h!==1?d||e.size.map(m=>m*h):null},new Promise((m,v)=>{const y=t.onImageReady(T=>{var C;if(e._screenshot.size===null)e.notifyStartCaptureImage=p,y.unsubscribe(),e._screenshot.placeHolder&&(e.size=e._screenshot.originalSize,t.modified(),e._screenshot.cameras&&e._screenshot.cameras.forEach(w=>{let{restoreParamsFn:x,arg:O}=w;return x(O)}),t.traverseAllPasses(),e.el.removeChild(e._screenshot.placeHolder),e._screenshot.placeHolder.remove(),e._screenshot=null),m(T);else{const w=document.createElement("img");if(w.style=aB,w.src=T,e._screenshot.placeHolder=e.el.appendChild(w),e.canvas.style.display="none",e._screenshot.originalSize=e.size,e.size=e._screenshot.size,(C=e.rootOpenGLRenderWindow)==null||C.resizeFromChildRenderWindows(),e._screenshot.size=null,t.modified(),g){const x=g!==!0;e._screenshot.cameras=e.renderable.getRenderers().map(O=>{const M=O.getActiveCamera(),A=M.get("focalPoint","position","parallelScale");return{resetCameraArgs:x?{renderer:O}:void 0,resetCameraFn:x?g:O.resetCamera,restoreParamsFn:M.set,arg:JSON.parse(JSON.stringify(A))}}),e._screenshot.cameras.forEach(O=>{let{resetCameraFn:M,resetCameraArgs:A}=O;return M(A)})}t.traverseAllPasses()}})})};let s;t.getHardwareMaximumLineWidth=()=>{if(s!=null)return s;const u=t.get3DContext(),g=u.getParameter(u.ALIASED_LINE_WIDTH_RANGE);return s=g[1],g[1]},t.getGLInformations=()=>{if(e._glInformation)return e._glInformation;const u=t.get3DContext(),g=u.getExtension("OES_texture_float"),d=u.getExtension("OES_texture_half_float"),h=u.getExtension("WEBGL_debug_renderer_info"),p=u.getExtension("WEBGL_draw_buffers"),m=u.getExtension("EXT_texture_filter_anisotropic")||u.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),v=[["Max Vertex Attributes","MAX_VERTEX_ATTRIBS",u.getParameter(u.MAX_VERTEX_ATTRIBS)],["Max Varying Vectors","MAX_VARYING_VECTORS",u.getParameter(u.MAX_VARYING_VECTORS)],["Max Vertex Uniform Vectors","MAX_VERTEX_UNIFORM_VECTORS",u.getParameter(u.MAX_VERTEX_UNIFORM_VECTORS)],["Max Fragment Uniform Vectors","MAX_FRAGMENT_UNIFORM_VECTORS",u.getParameter(u.MAX_FRAGMENT_UNIFORM_VECTORS)],["Max Fragment Texture Image Units","MAX_TEXTURE_IMAGE_UNITS",u.getParameter(u.MAX_TEXTURE_IMAGE_UNITS)],["Max Vertex Texture Image Units","MAX_VERTEX_TEXTURE_IMAGE_UNITS",u.getParameter(u.MAX_VERTEX_TEXTURE_IMAGE_UNITS)],["Max Combined Texture Image Units","MAX_COMBINED_TEXTURE_IMAGE_UNITS",u.getParameter(u.MAX_COMBINED_TEXTURE_IMAGE_UNITS)],["Max 2D Texture Size","MAX_TEXTURE_SIZE",u.getParameter(u.MAX_TEXTURE_SIZE)],["Max Cube Texture Size","MAX_CUBE_MAP_TEXTURE_SIZE",u.getParameter(u.MAX_CUBE_MAP_TEXTURE_SIZE)],["Max Texture Anisotropy","MAX_TEXTURE_MAX_ANISOTROPY_EXT",m&&u.getParameter(m.MAX_TEXTURE_MAX_ANISOTROPY_EXT)],["Point Size Range","ALIASED_POINT_SIZE_RANGE",u.getParameter(u.ALIASED_POINT_SIZE_RANGE).join(" - ")],["Line Width Range","ALIASED_LINE_WIDTH_RANGE",u.getParameter(u.ALIASED_LINE_WIDTH_RANGE).join(" - ")],["Max Viewport Dimensions","MAX_VIEWPORT_DIMS",u.getParameter(u.MAX_VIEWPORT_DIMS).join(" - ")],["Max Renderbuffer Size","MAX_RENDERBUFFER_SIZE",u.getParameter(u.MAX_RENDERBUFFER_SIZE)],["Framebuffer Red Bits","RED_BITS",u.getParameter(u.RED_BITS)],["Framebuffer Green Bits","GREEN_BITS",u.getParameter(u.GREEN_BITS)],["Framebuffer Blue Bits","BLUE_BITS",u.getParameter(u.BLUE_BITS)],["Framebuffer Alpha Bits","ALPHA_BITS",u.getParameter(u.ALPHA_BITS)],["Framebuffer Depth Bits","DEPTH_BITS",u.getParameter(u.DEPTH_BITS)],["Framebuffer Stencil Bits","STENCIL_BITS",u.getParameter(u.STENCIL_BITS)],["Framebuffer Subpixel Bits","SUBPIXEL_BITS",u.getParameter(u.SUBPIXEL_BITS)],["MSAA Samples","SAMPLES",u.getParameter(u.SAMPLES)],["MSAA Sample Buffers","SAMPLE_BUFFERS",u.getParameter(u.SAMPLE_BUFFERS)],["Supported Formats for UByte Render Targets     ","UNSIGNED_BYTE RENDER TARGET FORMATS",[g&&ri(u,u.RGBA,u.UNSIGNED_BYTE)?"RGBA":"",g&&ri(u,u.RGB,u.UNSIGNED_BYTE)?"RGB":"",g&&ri(u,u.LUMINANCE,u.UNSIGNED_BYTE)?"LUMINANCE":"",g&&ri(u,u.ALPHA,u.UNSIGNED_BYTE)?"ALPHA":"",g&&ri(u,u.LUMINANCE_ALPHA,u.UNSIGNED_BYTE)?"LUMINANCE_ALPHA":""].join(" ")],["Supported Formats for Half Float Render Targets","HALF FLOAT RENDER TARGET FORMATS",[d&&ri(u,u.RGBA,d.HALF_FLOAT_OES)?"RGBA":"",d&&ri(u,u.RGB,d.HALF_FLOAT_OES)?"RGB":"",d&&ri(u,u.LUMINANCE,d.HALF_FLOAT_OES)?"LUMINANCE":"",d&&ri(u,u.ALPHA,d.HALF_FLOAT_OES)?"ALPHA":"",d&&ri(u,u.LUMINANCE_ALPHA,d.HALF_FLOAT_OES)?"LUMINANCE_ALPHA":""].join(" ")],["Supported Formats for Full Float Render Targets","FLOAT RENDER TARGET FORMATS",[g&&ri(u,u.RGBA,u.FLOAT)?"RGBA":"",g&&ri(u,u.RGB,u.FLOAT)?"RGB":"",g&&ri(u,u.LUMINANCE,u.FLOAT)?"LUMINANCE":"",g&&ri(u,u.ALPHA,u.FLOAT)?"ALPHA":"",g&&ri(u,u.LUMINANCE_ALPHA,u.FLOAT)?"LUMINANCE_ALPHA":""].join(" ")],["Max Multiple Render Targets Buffers","MAX_DRAW_BUFFERS_WEBGL",p?u.getParameter(p.MAX_DRAW_BUFFERS_WEBGL):0],["High Float Precision in Vertex Shader","HIGH_FLOAT VERTEX_SHADER",[u.getShaderPrecisionFormat(u.VERTEX_SHADER,u.HIGH_FLOAT).precision," (-2<sup>",u.getShaderPrecisionFormat(u.VERTEX_SHADER,u.HIGH_FLOAT).rangeMin,"</sup> - 2<sup>",u.getShaderPrecisionFormat(u.VERTEX_SHADER,u.HIGH_FLOAT).rangeMax,"</sup>)"].join("")],["Medium Float Precision in Vertex Shader","MEDIUM_FLOAT VERTEX_SHADER",[u.getShaderPrecisionFormat(u.VERTEX_SHADER,u.MEDIUM_FLOAT).precision," (-2<sup>",u.getShaderPrecisionFormat(u.VERTEX_SHADER,u.MEDIUM_FLOAT).rangeMin,"</sup> - 2<sup>",u.getShaderPrecisionFormat(u.VERTEX_SHADER,u.MEDIUM_FLOAT).rangeMax,"</sup>)"].join("")],["Low Float Precision in Vertex Shader","LOW_FLOAT VERTEX_SHADER",[u.getShaderPrecisionFormat(u.VERTEX_SHADER,u.LOW_FLOAT).precision," (-2<sup>",u.getShaderPrecisionFormat(u.VERTEX_SHADER,u.LOW_FLOAT).rangeMin,"</sup> - 2<sup>",u.getShaderPrecisionFormat(u.VERTEX_SHADER,u.LOW_FLOAT).rangeMax,"</sup>)"].join("")],["High Float Precision in Fragment Shader","HIGH_FLOAT FRAGMENT_SHADER",[u.getShaderPrecisionFormat(u.FRAGMENT_SHADER,u.HIGH_FLOAT).precision," (-2<sup>",u.getShaderPrecisionFormat(u.FRAGMENT_SHADER,u.HIGH_FLOAT).rangeMin,"</sup> - 2<sup>",u.getShaderPrecisionFormat(u.FRAGMENT_SHADER,u.HIGH_FLOAT).rangeMax,"</sup>)"].join("")],["Medium Float Precision in Fragment Shader","MEDIUM_FLOAT FRAGMENT_SHADER",[u.getShaderPrecisionFormat(u.FRAGMENT_SHADER,u.MEDIUM_FLOAT).precision," (-2<sup>",u.getShaderPrecisionFormat(u.FRAGMENT_SHADER,u.MEDIUM_FLOAT).rangeMin,"</sup> - 2<sup>",u.getShaderPrecisionFormat(u.FRAGMENT_SHADER,u.MEDIUM_FLOAT).rangeMax,"</sup>)"].join("")],["Low Float Precision in Fragment Shader","LOW_FLOAT FRAGMENT_SHADER",[u.getShaderPrecisionFormat(u.FRAGMENT_SHADER,u.LOW_FLOAT).precision," (-2<sup>",u.getShaderPrecisionFormat(u.FRAGMENT_SHADER,u.LOW_FLOAT).rangeMin,"</sup> - 2<sup>",u.getShaderPrecisionFormat(u.FRAGMENT_SHADER,u.LOW_FLOAT).rangeMax,"</sup>)"].join("")],["High Int Precision in Vertex Shader","HIGH_INT VERTEX_SHADER",[u.getShaderPrecisionFormat(u.VERTEX_SHADER,u.HIGH_INT).precision," (-2<sup>",u.getShaderPrecisionFormat(u.VERTEX_SHADER,u.HIGH_INT).rangeMin,"</sup> - 2<sup>",u.getShaderPrecisionFormat(u.VERTEX_SHADER,u.HIGH_INT).rangeMax,"</sup>)"].join("")],["Medium Int Precision in Vertex Shader","MEDIUM_INT VERTEX_SHADER",[u.getShaderPrecisionFormat(u.VERTEX_SHADER,u.MEDIUM_INT).precision," (-2<sup>",u.getShaderPrecisionFormat(u.VERTEX_SHADER,u.MEDIUM_INT).rangeMin,"</sup> - 2<sup>",u.getShaderPrecisionFormat(u.VERTEX_SHADER,u.MEDIUM_INT).rangeMax,"</sup>)"].join("")],["Low Int Precision in Vertex Shader","LOW_INT VERTEX_SHADER",[u.getShaderPrecisionFormat(u.VERTEX_SHADER,u.LOW_INT).precision," (-2<sup>",u.getShaderPrecisionFormat(u.VERTEX_SHADER,u.LOW_INT).rangeMin,"</sup> - 2<sup>",u.getShaderPrecisionFormat(u.VERTEX_SHADER,u.LOW_INT).rangeMax,"</sup>)"].join("")],["High Int Precision in Fragment Shader","HIGH_INT FRAGMENT_SHADER",[u.getShaderPrecisionFormat(u.FRAGMENT_SHADER,u.HIGH_INT).precision," (-2<sup>",u.getShaderPrecisionFormat(u.FRAGMENT_SHADER,u.HIGH_INT).rangeMin,"</sup> - 2<sup>",u.getShaderPrecisionFormat(u.FRAGMENT_SHADER,u.HIGH_INT).rangeMax,"</sup>)"].join("")],["Medium Int Precision in Fragment Shader","MEDIUM_INT FRAGMENT_SHADER",[u.getShaderPrecisionFormat(u.FRAGMENT_SHADER,u.MEDIUM_INT).precision," (-2<sup>",u.getShaderPrecisionFormat(u.FRAGMENT_SHADER,u.MEDIUM_INT).rangeMin,"</sup> - 2<sup>",u.getShaderPrecisionFormat(u.FRAGMENT_SHADER,u.MEDIUM_INT).rangeMax,"</sup>)"].join("")],["Low Int Precision in Fragment Shader","LOW_INT FRAGMENT_SHADER",[u.getShaderPrecisionFormat(u.FRAGMENT_SHADER,u.LOW_INT).precision," (-2<sup>",u.getShaderPrecisionFormat(u.FRAGMENT_SHADER,u.LOW_INT).rangeMin,"</sup> - 2<sup>",u.getShaderPrecisionFormat(u.FRAGMENT_SHADER,u.LOW_INT).rangeMax,"</sup>)"].join("")],["Supported Extensions","EXTENSIONS",u.getSupportedExtensions().join("<br/>					    ")],["WebGL Renderer","RENDERER",u.getParameter(u.RENDERER)],["WebGL Vendor","VENDOR",u.getParameter(u.VENDOR)],["WebGL Version","VERSION",u.getParameter(u.VERSION)],["Shading Language Version","SHADING_LANGUAGE_VERSION",u.getParameter(u.SHADING_LANGUAGE_VERSION)],["Unmasked Renderer","UNMASKED_RENDERER",h&&u.getParameter(h.UNMASKED_RENDERER_WEBGL)],["Unmasked Vendor","UNMASKED_VENDOR",h&&u.getParameter(h.UNMASKED_VENDOR_WEBGL)],["WebGL Version","WEBGL_VERSION",e.webgl2?2:1]],y={};for(;v.length;){const[T,C,w]=v.pop();C&&(y[C]={label:T,value:w})}return e._glInformation=y,y},t.traverseAllPasses=()=>{var g;if(e.renderPasses)for(let d=0;d<e.renderPasses.length;++d)e.renderPasses[d].traverse(t,null);t.copyParentContent(),e.notifyStartCaptureImage&&o();const u=e.renderable.getChildRenderWindowsByReference();for(let d=0;d<u.length;++d)(g=t.getViewNodeFor(u[d]))==null||g.traverseAllPasses()},t.copyParentContent=()=>{const u=e.rootOpenGLRenderWindow;if(!u||!e.context2D||e.children.some(h=>{var p;return!!((p=h.getSelector)!=null&&p.call(h))}))return;const g=u.getCanvas(),d=e.canvas;e.context2D.drawImage(g,0,g.height-d.height,d.width,d.height,0,0,d.width,d.height)},t.resizeFromChildRenderWindows=()=>{var g;const u=e.renderable.getChildRenderWindowsByReference();if(u.length>0){const d=[0,0];for(let h=0;h<u.length;++h){const p=(g=t.getViewNodeFor(u[h]))==null?void 0:g.getSize();p&&(d[0]=p[0]>d[0]?p[0]:d[0],d[1]=p[1]>d[1]?p[1]:d[1])}t.setSize(...d)}},t.disableCullFace=()=>{e.cullFaceEnabled&&(e.context.disable(e.context.CULL_FACE),e.cullFaceEnabled=!1)},t.enableCullFace=()=>{e.cullFaceEnabled||(e.context.enable(e.context.CULL_FACE),e.cullFaceEnabled=!0)},t.setViewStream=u=>{if(e.viewStream===u)return!1;if(e.subscription&&(e.subscription.unsubscribe(),e.subscription=null),e.viewStream=u,e.viewStream){const g=e.renderable.getRenderers()[0];g.getBackgroundByReference()[3]=0,t.setUseBackgroundImage(!0),e.subscription=e.viewStream.onImageReady(d=>t.setBackgroundImage(d.image)),e.viewStream.setSize(e.size[0],e.size[1]),e.viewStream.invalidateCache(),e.viewStream.render(),t.modified()}return!0},t.createSelector=()=>{const u=H4.newInstance();return u.setOpenGLRenderWindow(t),u};function c(){e.canvas.removeEventListener("webglcontextlost",S9),e.canvas.removeEventListener("webglcontextrestored",t.restoreContext)}t.delete=P.chain(()=>{e.context&&cB(),t.setContainer(),t.setViewStream()},c,t.delete),t.setActiveFramebuffer=u=>{e.activeFramebuffer=u};const l=t.setSize;t.setSize=(u,g)=>{const d=l(u,g);return d&&t.invokeWindowResizeEvent({width:u,height:g}),d},t.registerGraphicsResourceUser=(u,g)=>{e._graphicsResources.has(u)||t.setGraphicsResourceForObject(u,null,null);const d=e._graphicsResources.get(u);d==null||d.users.add(g)},t.unregisterGraphicsResourceUser=(u,g)=>{var h;const d=e._graphicsResources.get(u);d&&(d.users.delete(g),d.users.size||((h=d.oglObject)==null||h.releaseGraphicsResources(t),e._graphicsResources.delete(u)))},t.getGraphicsResourceForObject=u=>e._graphicsResources.get(u),t.setGraphicsResourceForObject=(u,g,d)=>{var p;if(!u)return;const h=e._graphicsResources.get(u);(p=h==null?void 0:h.oglObject)==null||p.releaseGraphicsResources(t),e._graphicsResources.set(u,{coreObject:u,oglObject:g,hash:d,users:(h==null?void 0:h.users)??new Set})},t.getGraphicsMemoryInfo=()=>{let u=0;return e._graphicsResources.forEach(g=>{let{oglObject:d}=g;u+=d.getAllocatedGPUMemoryInBytes()}),u},t.releaseGraphicsResources=()=>{e.shaderCache!==null&&e.shaderCache.releaseGraphicsResources(t),e._graphicsResources.forEach(u=>{let{oglObject:g}=u;g.releaseGraphicsResources(t)}),e._graphicsResources.clear(),e.textureUnitManager!==null&&e.textureUnitManager.freeAll(),e.renderable.getRenderersByReference().forEach(u=>{const g=t.getViewNodeFor(u);g==null||g.releaseGraphicsResources()})};const f={...t};oB.forEach(u=>{t[u]=function(){return e.rootOpenGLRenderWindow?e.rootOpenGLRenderWindow[u](...arguments):f[u](...arguments)}})}const gB={cullFaceEnabled:!1,shaderCache:null,initialized:!1,context:null,context2D:null,canvas:null,cursorVisibility:!0,cursor:"pointer",textureUnitManager:null,textureResourceIds:null,containerSize:null,renderPasses:[],notifyStartCaptureImage:!1,webgl2:!1,defaultToWebgl2:!0,activeFramebuffer:null,imageFormat:"image/png",useOffScreen:!1,useBackgroundImage:!1};function qE(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,gB,n),nB.extend(t,e,n),e.canvas||(e.canvas=document.createElement("canvas"),e.canvas.style.width="100%"),e.selector||(e.selector=H4.newInstance(),e.selector.setOpenGLRenderWindow(t)),e.bgImage=new Image,e.bgImage.style.position="absolute",e.bgImage.style.left="0",e.bgImage.style.top="0",e.bgImage.style.width="100%",e.bgImage.style.height="100%",e.bgImage.style.zIndex="-1",e._textureResourceIds=new Map,e._graphicsResources=new Map,e._glInformation=null,e.myFactory=Qk.newInstance(),e.shaderCache=KU.newInstance(),e.shaderCache.setOpenGLRenderWindow(t),e.renderPasses[0]=nU.newInstance(),P.get(t,e,["shaderCache","textureUnitManager","webgl2","useBackgroundImage","activeFramebuffer","rootOpenGLRenderWindow"]),P.setGet(t,e,["initialized","context","context2D","canvas","renderPasses","notifyStartCaptureImage","defaultToWebgl2","cursor","useOffScreen"]),P.setGetArray(t,e,["size"],2),P.event(t,e,"imageReady"),P.event(t,e,"windowResizeEvent"),fB(t,e)}const K4=P.newInstance(qE,"vtkOpenGLRenderWindow");CS("WebGL",K4);var dB={newInstance:K4,extend:qE,pushMonitorGLContextCount:lB,popMonitorGLContextCount:uB};Wn("vtkRenderWindow",K4);function pB(t,e){e.classHierarchy.push("vtkOpenGLActor"),t.buildPass=n=>{if(n){e._openGLRenderWindow=t.getLastAncestorOfType("vtkOpenGLRenderWindow"),e._openGLRenderer=t.getFirstAncestorOfType("vtkOpenGLRenderer"),e.context=e._openGLRenderWindow.getContext(),t.prepareNodes(),t.addMissingNodes(e.renderable.getTextures()),t.addMissingNode(e.renderable.getMapper()),t.removeUnusedNodes(),e.ogltextures=null,e.activeTextures=null;for(let r=0;r<e.children.length;r++){const i=e.children[r];i.isA("vtkOpenGLTexture")?(e.ogltextures||(e.ogltextures=[]),e.ogltextures.push(i)):e.oglmapper=i}}},t.traverseZBufferPass=n=>{!e.renderable||!e.renderable.getNestedVisibility()||e._openGLRenderer.getSelector()&&!e.renderable.getNestedPickable()||(t.apply(n,!0),e.oglmapper.traverse(n),t.apply(n,!1))},t.traverseOpaqueZBufferPass=n=>t.traverseOpaquePass(n),t.traverseOpaquePass=n=>{!e.renderable||!e.renderable.getNestedVisibility()||!e.renderable.getIsOpaque()||e._openGLRenderer.getSelector()&&!e.renderable.getNestedPickable()||(t.apply(n,!0),e.oglmapper.traverse(n),t.apply(n,!1))},t.traverseTranslucentPass=n=>{!e.renderable||!e.renderable.getNestedVisibility()||e.renderable.getIsOpaque()||e._openGLRenderer.getSelector()&&!e.renderable.getNestedPickable()||(t.apply(n,!0),e.oglmapper.traverse(n),t.apply(n,!1))},t.activateTextures=()=>{if(e.ogltextures){e.activeTextures=[];for(let n=0;n<e.ogltextures.length;n++){const r=e.ogltextures[n];r.render(),r.getHandle()&&e.activeTextures.push(r)}}},t.queryPass=(n,r)=>{if(n){if(!e.renderable||!e.renderable.getVisibility())return;e.renderable.getIsOpaque()?r.incrementOpaqueActorCount():r.incrementTranslucentActorCount()}},t.zBufferPass=(n,r)=>t.opaquePass(n,r),t.opaqueZBufferPass=(n,r)=>t.opaquePass(n,r),t.opaquePass=(n,r)=>{if(n)e.context.depthMask(!0),t.activateTextures();else if(e.activeTextures)for(let i=0;i<e.activeTextures.length;i++)e.activeTextures[i].deactivate()},t.translucentPass=(n,r)=>{if(n)e.context.depthMask(e._openGLRenderer.getSelector()&&e.renderable.getNestedPickable()),t.activateTextures();else if(e.activeTextures)for(let i=0;i<e.activeTextures.length;i++)e.activeTextures[i].deactivate()},t.getKeyMatrices=()=>(e.renderable.getMTime()>e.keyMatrixTime.getMTime()&&(e.renderable.computeMatrix(),nn(e.keyMatrices.mcwc,e.renderable.getMatrix()),ft(e.keyMatrices.mcwc,e.keyMatrices.mcwc),e.renderable.getIsIdentity()?ya(e.keyMatrices.normalMatrix):(g2(e.keyMatrices.normalMatrix,e.keyMatrices.mcwc),md(e.keyMatrices.normalMatrix,e.keyMatrices.normalMatrix),N4(e.keyMatrices.normalMatrix,e.keyMatrices.normalMatrix)),e.keyMatrixTime.modified()),e.keyMatrices)}const hB={context:null,keyMatrixTime:null,keyMatrices:null,activeTextures:null};function mB(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,hB,n),Bt.extend(t,e,n),e.keyMatrixTime={},zt(e.keyMatrixTime,{mtime:0}),e.keyMatrices={normalMatrix:ya(new Float64Array(9)),mcwc:Be(new Float64Array(16))},Vn(t,e,["context"]),hi(t,e,["activeTextures"]),pB(t,e)}const XE=Rt(mB);var vB={newInstance:XE};Wn("vtkActor",XE);function yB(t,e){e.classHierarchy.push("vtkOpenGLActor2D"),t.buildPass=n=>{if(n){if(!e.renderable)return;e._openGLRenderWindow=t.getLastAncestorOfType("vtkOpenGLRenderWindow"),e._openGLRenderer=t.getFirstAncestorOfType("vtkOpenGLRenderer"),e.context=e._openGLRenderWindow.getContext(),t.prepareNodes(),t.addMissingNodes(e.renderable.getTextures()),t.addMissingNode(e.renderable.getMapper()),t.removeUnusedNodes(),e.ogltextures=null,e.activeTextures=null;for(let r=0;r<e.children.length;r++){const i=e.children[r];i.isA("vtkOpenGLTexture")?(e.ogltextures||(e.ogltextures=[]),e.ogltextures.push(i)):e.oglmapper=i}}},t.queryPass=(n,r)=>{if(n){if(!e.renderable||!e.renderable.getVisibility())return;r.incrementOverlayActorCount()}},t.traverseOpaquePass=n=>{!e.oglmapper||!e.renderable||!e.renderable.getNestedVisibility()||!e.renderable.getIsOpaque()||e._openGLRenderer.getSelector()&&!e.renderable.getNestedPickable()||(t.apply(n,!0),e.oglmapper.traverse(n),t.apply(n,!1))},t.traverseTranslucentPass=n=>{!e.oglmapper||!e.renderable||!e.renderable.getNestedVisibility()||e.renderable.getIsOpaque()||e._openGLRenderer.getSelector()&&!e.renderable.getNestedPickable()||(t.apply(n,!0),e.oglmapper.traverse(n),t.apply(n,!1))},t.traverseOverlayPass=n=>{!e.oglmapper||!e.renderable||!e.renderable.getNestedVisibility()||e._openGLRenderer.getSelector()&&!e.renderable.getNestedPickable||(t.apply(n,!0),e.oglmapper.traverse(n),t.apply(n,!1))},t.activateTextures=()=>{if(e.ogltextures){e.activeTextures=[];for(let n=0;n<e.ogltextures.length;n++){const r=e.ogltextures[n];r.render(),r.getHandle()&&e.activeTextures.push(r)}}},t.opaquePass=(n,r)=>{if(n)e.context.depthMask(!0),t.activateTextures();else if(e.activeTextures)for(let i=0;i<e.activeTextures.length;i++)e.activeTextures[i].deactivate()},t.translucentPass=(n,r)=>{if(n)e.context.depthMask(!1),t.activateTextures();else if(e.activeTextures)for(let i=0;i<e.activeTextures.length;i++)e.activeTextures[i].deactivate()},t.overlayPass=(n,r)=>{if(n)e.context.depthMask(!0),t.activateTextures();else if(e.activeTextures)for(let i=0;i<e.activeTextures.length;i++)e.activeTextures[i].deactivate()}}const TB={context:null,activeTextures:null};function CB(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,TB,n),Bt.extend(t,e,n),Vn(t,e,["context"]),hi(t,e,["activeTextures"]),yB(t,e)}const YE=Rt(CB);var wB={newInstance:YE};Wn("vtkActor2D",YE);function xB(t,e){e.classHierarchy.push("vtkOpenGLCamera"),t.buildPass=n=>{n&&(e._openGLRenderer=t.getFirstAncestorOfType("vtkOpenGLRenderer"),e._openGLRenderWindow=e._openGLRenderer.getParent(),e.context=e._openGLRenderWindow.getContext())},t.opaquePass=n=>{if(n){const r=e._openGLRenderer.getTiledSizeAndOrigin();e.context.viewport(r.lowerLeftU,r.lowerLeftV,r.usize,r.vsize),e.context.scissor(r.lowerLeftU,r.lowerLeftV,r.usize,r.vsize)}},t.translucentPass=t.opaquePass,t.zBufferPass=t.opaquePass,t.opaqueZBufferPass=t.opaquePass,t.volumePass=t.opaquePass,t.getKeyMatrices=n=>{if(n!==e.lastRenderer||e._openGLRenderWindow.getMTime()>e.keyMatrixTime.getMTime()||t.getMTime()>e.keyMatrixTime.getMTime()||n.getMTime()>e.keyMatrixTime.getMTime()||e.renderable.getMTime()>e.keyMatrixTime.getMTime()){nn(e.keyMatrices.wcvc,e.renderable.getViewMatrix()),g2(e.keyMatrices.normalMatrix,e.keyMatrices.wcvc),md(e.keyMatrices.normalMatrix,e.keyMatrices.normalMatrix),ft(e.keyMatrices.wcvc,e.keyMatrices.wcvc);const r=e._openGLRenderer.getAspectRatio();nn(e.keyMatrices.vcpc,e.renderable.getProjectionMatrix(r,-1,1)),ft(e.keyMatrices.vcpc,e.keyMatrices.vcpc),vt(e.keyMatrices.wcpc,e.keyMatrices.vcpc,e.keyMatrices.wcvc),e.keyMatrixTime.modified(),e.lastRenderer=n}return e.keyMatrices}}const SB={context:null,lastRenderer:null,keyMatrixTime:null,keyMatrices:null};function EB(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,SB,n),Bt.extend(t,e,n),e.keyMatrixTime={},zt(e.keyMatrixTime),e.keyMatrices={normalMatrix:new Float64Array(9),vcpc:new Float64Array(16),wcvc:new Float64Array(16),wcpc:new Float64Array(16)},Vn(t,e,["context","keyMatrixTime"]),xB(t,e)}const ZE=Rt(EB);var OB={newInstance:ZE};Wn("vtkCamera",ZE);function DB(t,e){e.classHierarchy.push("vtkAbstractMapper"),t.update=()=>{t.getInputData()},t.addClippingPlane=n=>n.isA("vtkPlane")?e.clippingPlanes.includes(n)?!1:(e.clippingPlanes.push(n),t.modified(),!0):!1,t.getNumberOfClippingPlanes=()=>e.clippingPlanes.length,t.removeAllClippingPlanes=()=>e.clippingPlanes.length===0?!1:(e.clippingPlanes.length=0,t.modified(),!0),t.removeClippingPlane=n=>{const r=e.clippingPlanes.indexOf(n);return r===-1?!1:(e.clippingPlanes.splice(r,1),t.modified(),!0)},t.getClippingPlanes=()=>e.clippingPlanes,t.setClippingPlanes=n=>{if(n)if(!Array.isArray(n))t.addClippingPlane(n);else{const r=n.length;for(let i=0;i<r&&i<6;i++)t.addClippingPlane(n[i])}},t.getClippingPlaneInDataCoords=(n,r,i)=>{const a=e.clippingPlanes,o=n;if(a){const s=a.length;if(r>=0&&r<s){const c=a[r],l=c.getNormal(),f=c.getOrigin(),u=l[0],g=l[1],d=l[2],h=-(u*f[0]+g*f[1]+d*f[2]);i[0]=u*o[0]+g*o[4]+d*o[8]+h*o[12],i[1]=u*o[1]+g*o[5]+d*o[9]+h*o[13],i[2]=u*o[2]+g*o[6]+d*o[10]+h*o[14],i[3]=u*o[3]+g*o[7]+d*o[11]+h*o[15];return}}P.vtkErrorMacro(`Clipping plane index ${r} is out of range.`)}}const RB={clippingPlanes:[]};function MB(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,RB,n),P.obj(t,e),P.algo(t,e,1,0),e.clippingPlanes||(e.clippingPlanes=[]),DB(t,e)}var QE={extend:MB};function _B(t,e){e.classHierarchy.push("vtkImplicitFunction"),t.functionValue=n=>{if(!e.transform)return t.evaluateFunction(n);const r=[];return e.transform.transformPoint(n,r),t.evaluateFunction(r)},t.evaluateFunction=n=>{P.vtkErrorMacro("not implemented")}}const bB={};function JE(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,bB,n),P.obj(t,e),P.setGet(t,e,["transform"]),_B(t,e)}const LB=P.newInstance(JE,"vtkImplicitFunction");var IB={newInstance:LB,extend:JE};const I3=1e-6,eO="coincide",tO="disjoint";function VB(t,e,n){return t[0]*(n[0]-e[0])+t[1]*(n[1]-e[1])+t[2]*(n[2]-e[2])}function nO(t,e,n){const r=n[0]*(t[0]-e[0])+n[1]*(t[1]-e[1])+n[2]*(t[2]-e[2]);return Math.abs(r)}function rO(t,e,n,r){const i=[];is(t,e,i);const a=ct(n,i);r[0]=t[0]-a*n[0],r[1]=t[1]-a*n[1],r[2]=t[2]-a*n[2]}function iO(t,e,n){const r=ct(t,e);let i=ct(e,e);return i===0&&(i=1),n[0]=t[0]-r*e[0]/i,n[1]=t[1]-r*e[1]/i,n[2]=t[2]-r*e[2]/i,n}function aO(t,e,n,r){const i=[];is(t,e,i);const a=ct(n,i),o=ct(n,n);o!==0?(r[0]=t[0]-a*n[0]/o,r[1]=t[1]-a*n[1]/o,r[2]=t[2]-a*n[2]/o):(r[0]=t[0],r[1]=t[1],r[2]=t[2])}function oO(t,e,n,r){const i={intersection:!1,betweenPoints:!1,t:Number.MAX_VALUE,x:[]},a=[],o=[];is(e,t,a),is(n,t,o);const s=ct(r,o),c=ct(r,a);let l,f;return c<0?l=-c:l=c,s<0?f=-s*I3:f=s*I3,l<=f||(i.t=s/c,i.x[0]=t[0]+i.t*a[0],i.x[1]=t[1]+i.t*a[1],i.x[2]=t[2]+i.t*a[2],i.intersection=!0,i.betweenPoints=i.t>=0&&i.t<=1),i}function sO(t,e,n,r){const i={intersection:!1,l0:[],l1:[],error:null},a=[];yo(e,r,a);const o=a.map(u=>Math.abs(u));if(o[0]+o[1]+o[2]<I3){const u=[];return is(t,n,u),ct(e,u)===0?i.error=eO:i.error=tO,i}let s;o[0]>o[1]&&o[0]>o[2]?s="x":o[1]>o[2]?s="y":s="z";const c=[],l=-ct(e,t),f=-ct(r,n);switch(s){case"x":c[0]=0,c[1]=(f*e[2]-l*r[2])/a[0],c[2]=(l*r[1]-f*e[1])/a[0];break;case"y":c[0]=(l*r[2]-f*e[2])/a[1],c[1]=0,c[2]=(f*e[0]-l*r[0])/a[1];break;case"z":c[0]=(f*e[1]-l*r[1])/a[2],c[1]=(l*r[0]-f*e[0])/a[2],c[2]=0;break}return i.l0=c,th(c,a,i.l1),i.intersection=!0,i}const PB={evaluate:VB,distanceToPlane:nO,projectPoint:rO,projectVector:iO,generalizedProjectPoint:aO,intersectWithLine:oO,intersectWithPlane:sO,DISJOINT:tO,COINCIDE:eO};function NB(t,e){e.classHierarchy.push("vtkPlane"),t.distanceToPlane=n=>nO(n,e.origin,e.normal),t.projectPoint=(n,r)=>{rO(n,e.origin,e.normal,r)},t.projectVector=(n,r)=>iO(n,e.normal,r),t.push=n=>{if(n!==0)for(let r=0;r<3;r++)e.origin[r]+=n*e.normal[r]},t.generalizedProjectPoint=(n,r)=>{aO(n,e.origin,e.normal,r)},t.evaluateFunction=(n,r,i)=>Array.isArray(n)?e.normal[0]*(n[0]-e.origin[0])+e.normal[1]*(n[1]-e.origin[1])+e.normal[2]*(n[2]-e.origin[2]):e.normal[0]*(n-e.origin[0])+e.normal[1]*(r-e.origin[1])+e.normal[2]*(i-e.origin[2]),t.evaluateGradient=n=>[e.normal[0],e.normal[1],e.normal[2]],t.intersectWithLine=(n,r)=>oO(n,r,e.origin,e.normal),t.intersectWithPlane=(n,r)=>sO(n,r,e.origin,e.normal)}const kB={normal:[0,0,1],origin:[0,0,0]};function cO(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,kB,n),IB.extend(t,e,n),P.setGetArray(t,e,["normal","origin"],3),NB(t,e)}const AB=P.newInstance(cO,"vtkPlane");var $r={newInstance:AB,extend:cO,...PB};const h2=[Number.MAX_VALUE,-Number.MAX_VALUE,Number.MAX_VALUE,-Number.MAX_VALUE,Number.MAX_VALUE,-Number.MAX_VALUE];function lO(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]}function vs(t){return(t==null?void 0:t.length)>=6&&t[0]<=t[1]&&t[2]<=t[3]&&t[4]<=t[5]}function q4(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t}function X4(t){return q4(t,h2)}function lh(t,e,n,r){const[i,a,o,s,c,l]=t;return t[0]=i<e?i:e,t[1]=a>e?a:e,t[2]=o<n?o:n,t[3]=s>n?s:n,t[4]=c<r?c:r,t[5]=l>r?l:r,t}function Y4(t,e){if(e.length===0)return t;if(Array.isArray(e[0]))for(let n=0;n<e.length;++n)lh(t,...e[n]);else for(let n=0;n<e.length;n+=3)lh(t,...e.slice(n,n+3));return t}function uO(t,e,n,r,i,a,o){const[s,c,l,f,u,g]=t;return o===void 0?(t[0]=Math.min(e[0],s),t[1]=Math.max(e[1],c),t[2]=Math.min(e[2],l),t[3]=Math.max(e[3],f),t[4]=Math.min(e[4],u),t[5]=Math.max(e[5],g)):(t[0]=Math.min(e,s),t[1]=Math.max(n,c),t[2]=Math.min(r,l),t[3]=Math.max(i,f),t[4]=Math.min(a,u),t[5]=Math.max(o,g)),t}function fO(t,e,n,r){const[i,a,o,s,c,l]=t;return t[0]=e,t[1]=e>a?e:a,t[2]=n,t[3]=n>s?n:s,t[4]=r,t[5]=r>l?r:l,i!==e||o!==n||c!==r}function gO(t,e,n,r){const[i,a,o,s,c,l]=t;return t[0]=e<i?e:i,t[1]=e,t[2]=n<o?n:o,t[3]=n,t[4]=r<c?r:c,t[5]=r,a!==e||s!==n||l!==r}function dO(t,e){return t[0]-=e,t[1]+=e,t[2]-=e,t[3]+=e,t[4]-=e,t[5]+=e,t}function Z4(t,e,n,r){return vs(t)?(e>=0?(t[0]*=e,t[1]*=e):(t[0]=e*t[1],t[1]=e*t[0]),n>=0?(t[2]*=n,t[3]*=n):(t[2]=n*t[3],t[3]=n*t[2]),r>=0?(t[4]*=r,t[5]*=r):(t[4]=r*t[5],t[5]=r*t[4]),!0):!1}function Q4(t){return[.5*(t[0]+t[1]),.5*(t[2]+t[3]),.5*(t[4]+t[5])]}function FB(t,e,n,r){if(!vs(t))return!1;const i=Q4(t);return t[0]-=i[0],t[1]-=i[0],t[2]-=i[1],t[3]-=i[1],t[4]-=i[2],t[5]-=i[2],Z4(t,e,n,r),t[0]+=i[0],t[1]+=i[0],t[2]+=i[1],t[3]+=i[1],t[4]+=i[2],t[5]+=i[2],!0}function ig(t,e){return t[e*2+1]-t[e*2]}function m2(t){return[ig(t,0),ig(t,1),ig(t,2)]}function pO(t){return t.slice(0,2)}function hO(t){return t.slice(2,4)}function mO(t){return t.slice(4,6)}function vO(t){const e=m2(t);return e[0]>e[1]?e[0]>e[2]?e[0]:e[2]:e[1]>e[2]?e[1]:e[2]}function yO(t){if(vs(t)){const e=m2(t);return Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2])}return null}function J4(t){return[t[0],t[2],t[4]]}function ey(t){return[t[1],t[3],t[5]]}function Zd(t,e){return t<=0&&e>=0||t>=0&&e<=0}function ty(t,e){let n=0;for(let r=0;r<2;r++)for(let i=2;i<4;i++)for(let a=4;a<6;a++)e[n++]=[t[r],t[i],t[a]];return e}function TO(t,e,n){return e[0]=t[0],e[1]=t[2],e[2]=t[4],n[0]=t[1],n[1]=t[3],n[2]=t[5],e}function CO(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[];const r=ty(t,[]);for(let i=0;i<r.length;++i)pt(r[i],r[i],e);return X4(n),Y4(n,r)}function wO(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];return e[0]=.5*(t[1]-t[0]),e[1]=.5*(t[3]-t[2]),e[2]=.5*(t[5]-t[4]),e}function xO(t,e,n,r){const i=[].concat(h2),a=t.getData();for(let o=0;o<a.length;o+=3){const s=[a[o],a[o+1],a[o+2]],c=ct(s,e);i[0]=Math.min(c,i[0]),i[1]=Math.max(c,i[1]);const l=ct(s,n);i[2]=Math.min(l,i[2]),i[3]=Math.max(l,i[3]);const f=ct(s,r);i[4]=Math.min(f,i[4]),i[5]=Math.max(f,i[5])}return i}function SO(t,e,n,r,i){let a=!0;const o=[];let s=0;const c=[],l=[0,0,0],f=0,u=1,g=2;for(let d=0;d<3;d++)e[d]<t[2*d]?(o[d]=u,l[d]=t[2*d],a=!1):e[d]>t[2*d+1]?(o[d]=f,l[d]=t[2*d+1],a=!1):o[d]=g;if(a)return r[0]=e[0],r[1]=e[1],r[2]=e[2],i[0]=0,1;for(let d=0;d<3;d++)o[d]!==g&&n[d]!==0?c[d]=(l[d]-e[d])/n[d]:c[d]=-1;for(let d=0;d<3;d++)c[s]<c[d]&&(s=d);if(c[s]>1||c[s]<0)return 0;i[0]=c[s];for(let d=0;d<3;d++)if(s!==d){if(r[d]=e[d]+c[s]*n[d],r[d]<t[2*d]||r[d]>t[2*d+1])return 0}else r[d]=l[d];return 1}function EO(t,e,n){const r=[];let i=0,a=1,o=1;for(let s=4;s<=5;++s){r[2]=t[s];for(let c=2;c<=3;++c){r[1]=t[c];for(let l=0;l<=1;++l)if(r[0]=t[l],i=$r.evaluate(n,e,r),o&&(a=i>=0?1:-1,o=0),i===0||a>0&&i<0||a<0&&i>0)return 1}}return 0}function OO(t,e){if(!(vs(t)&&vs(e)))return!1;const n=[0,0,0,0,0,0];let r;for(let i=0;i<3;i++)if(r=!1,e[i*2]>=t[i*2]&&e[i*2]<=t[i*2+1]?(r=!0,n[i*2]=e[i*2]):t[i*2]>=e[i*2]&&t[i*2]<=e[i*2+1]&&(r=!0,n[i*2]=t[i*2]),e[i*2+1]>=t[i*2]&&e[i*2+1]<=t[i*2+1]?(r=!0,n[i*2+1]=e[2*i+1]):t[i*2+1]>=e[i*2]&&t[i*2+1]<=e[i*2+1]&&(r=!0,n[i*2+1]=t[i*2+1]),!r)return!1;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],!0}function uh(t,e){if(!(vs(t)&&vs(e)))return!1;for(let n=0;n<3;n++)if(!(e[n*2]>=t[n*2]&&e[n*2]<=t[n*2+1])&&!(t[n*2]>=e[n*2]&&t[n*2]<=e[n*2+1])&&!(e[n*2+1]>=t[n*2]&&e[n*2+1]<=t[n*2+1])&&!(t[n*2+1]>=e[n*2]&&t[n*2+1]<=e[n*2+1]))return!1;return!0}function fh(t,e,n,r){return!(e<t[0]||e>t[1]||n<t[2]||n>t[3]||r<t[4]||r>t[5])}function UB(t,e){return!(!uh(t,e)||!fh(t,...J4(e))||!fh(t,...ey(e)))}function DO(t,e,n){const r=[[0,1,2,3,4,5,6,7],[0,1,4,5,2,3,6,7],[0,2,4,6,1,3,5,7]],i=[0,0,0,0,0,0,0,0];let a=0;for(let u=0;u<2;u++)for(let g=2;g<4;g++)for(let d=4;d<6;d++){const h=[t[u],t[g],t[d]];i[a++]=$r.evaluate(n,e,h)}let o=2;for(;o--&&!(Zd(i[r[o][0]],i[r[o][4]])&&Zd(i[r[o][1]],i[r[o][5]])&&Zd(i[r[o][2]],i[r[o][6]])&&Zd(i[r[o][3]],i[r[o][7]])););if(o<0)return!1;const s=Math.sign(n[o]),c=Math.abs((t[o*2+1]-t[o*2])*n[o]);let l=s>0?1:0;for(let u=0;u<4;u++){if(c===0)continue;const g=Math.abs(i[r[o][u]])/c;s>0&&g<l&&(l=g),s<0&&g>l&&(l=g)}const f=(1-l)*t[o*2]+l*t[o*2+1];return s>0?t[o*2]=f:t[o*2+1]=f,!0}class BB{constructor(e){this.bounds=e,this.bounds||(this.bounds=new Float64Array(h2))}getBounds(){return this.bounds}equals(e){return lO(this.bounds,e)}isValid(){return vs(this.bounds)}setBounds(e){return q4(this.bounds,e)}reset(){return X4(this.bounds)}addPoint(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return lh(this.bounds,...n)}addPoints(e){return Y4(this.bounds,e)}addBounds(e,n,r,i,a,o){return uO(this.bounds,e,n,r,i,a,o)}setMinPoint(e,n,r){return fO(this.bounds,e,n,r)}setMaxPoint(e,n,r){return gO(this.bounds,e,n,r)}inflate(e){return dO(this.bounds,e)}scale(e,n,r){return Z4(this.bounds,e,n,r)}getCenter(){return Q4(this.bounds)}getLength(e){return ig(this.bounds,e)}getLengths(){return m2(this.bounds)}getMaxLength(){return vO(this.bounds)}getDiagonalLength(){return yO(this.bounds)}getMinPoint(){return J4(this.bounds)}getMaxPoint(){return ey(this.bounds)}getXRange(){return pO(this.bounds)}getYRange(){return hO(this.bounds)}getZRange(){return mO(this.bounds)}getCorners(e){return ty(this.bounds,e)}computeCornerPoints(e,n){return TO(this.bounds,e,n)}computeLocalBounds(e,n,r){return xO(this.bounds,e,n,r)}transformBounds(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];return CO(this.bounds,e,n)}computeScale3(e){return wO(this.bounds,e)}cutWithPlane(e,n){return DO(this.bounds,e,n)}intersectBox(e,n,r,i){return SO(this.bounds,e,n,r,i)}intersectPlane(e,n){return EO(this.bounds,e,n)}intersect(e){return OO(this.bounds,e)}intersects(e){return uh(this.bounds,e)}containsPoint(e,n,r){return fh(this.bounds,e,n,r)}contains(e){return uh(this.bounds,e)}}function GB(t){const e=t&&t.bounds;return new BB(e)}const $B={equals:lO,isValid:vs,setBounds:q4,reset:X4,addPoint:lh,addPoints:Y4,addBounds:uO,setMinPoint:fO,setMaxPoint:gO,inflate:dO,scale:Z4,scaleAboutCenter:FB,getCenter:Q4,getLength:ig,getLengths:m2,getMaxLength:vO,getDiagonalLength:yO,getMinPoint:J4,getMaxPoint:ey,getXRange:pO,getYRange:hO,getZRange:mO,getCorners:ty,computeCornerPoints:TO,computeLocalBounds:xO,transformBounds:CO,computeScale3:wO,cutWithPlane:DO,intersectBox:SO,intersectPlane:EO,intersect:OO,intersects:uh,containsPoint:fh,contains:UB,INIT_BOUNDS:h2};var Nt={newInstance:GB,...$B};function WB(t,e){t.getBounds=()=>(P.vtkErrorMacro("vtkAbstractMapper3D.getBounds - NOT IMPLEMENTED"),Oc()),t.getCenter=()=>{var r;const n=t.getBounds();return e.center=Nt.isValid(n)?Nt.getCenter(n):null,(r=e.center)==null?void 0:r.slice()},t.getLength=()=>{const n=t.getBounds();return Nt.getDiagonalLength(n)}}const zB=t=>({bounds:[...Nt.INIT_BOUNDS],center:[0,0,0],viewSpecificProperties:{},...t});function jB(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,zB(n)),QE.extend(t,e,n),P.setGet(t,e,["viewSpecificProperties"]),WB(t,e)}var ny={extend:jB};const _a={UNCHANGED:0,SINGLE_POINT:1,X_LINE:2,Y_LINE:3,Z_LINE:4,XY_PLANE:5,YZ_PLANE:6,XZ_PLANE:7,XYZ_GRID:8,EMPTY:9};var RO={StructuredType:_a};const{StructuredType:$o}=RO;function HB(t){let e=0;for(let n=0;n<3;++n)t[n*2]<t[n*2+1]&&e++;return t[0]>t[1]||t[2]>t[3]||t[4]>t[5]?$o.EMPTY:e===3?$o.XYZ_GRID:e===2?t[0]===t[1]?$o.YZ_PLANE:t[2]===t[3]?$o.XZ_PLANE:$o.XY_PLANE:e===1?t[0]<t[1]?$o.X_LINE:t[2]<t[3]?$o.Y_LINE:$o.Z_LINE:$o.SINGLE_POINT}var KB={getDataDescriptionFromExtent:HB,...RO};const{vtkErrorMacro:c0}=P;function qB(t,e){e.classHierarchy.push("vtkImageData"),t.setExtent=function(){if(e.deleted)return c0("instance deleted - cannot call any method"),!1;for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];const a=r.length===1?r[0]:r;if(a.length!==6)return!1;const o=e.extent.some((s,c)=>s!==a[c]);return o&&(e.extent=a.slice(),e.dataDescription=KB.getDataDescriptionFromExtent(e.extent),t.modified()),o},t.setDimensions=function(){let n,r,i;if(e.deleted){c0("instance deleted - cannot call any method");return}if(arguments.length===1){const a=arguments.length<=0?void 0:arguments[0];n=a[0],r=a[1],i=a[2]}else if(arguments.length===3)n=arguments.length<=0?void 0:arguments[0],r=arguments.length<=1?void 0:arguments[1],i=arguments.length<=2?void 0:arguments[2];else{c0("Bad dimension specification");return}t.setExtent(0,n-1,0,r-1,0,i-1)},t.getDimensions=()=>[e.extent[1]-e.extent[0]+1,e.extent[3]-e.extent[2]+1,e.extent[5]-e.extent[4]+1],t.getNumberOfCells=()=>{const n=t.getDimensions();let r=1;for(let i=0;i<3;i++){if(n[i]===0)return 0;n[i]>1&&(r*=n[i]-1)}return r},t.getNumberOfPoints=()=>{const n=t.getDimensions();return n[0]*n[1]*n[2]},t.getPoint=n=>{const r=t.getDimensions();if(r[0]===0||r[1]===0||r[2]===0)return c0("Requesting a point from an empty image."),null;const i=new Float64Array(3);switch(e.dataDescription){case _a.EMPTY:return null;case _a.SINGLE_POINT:break;case _a.X_LINE:i[0]=n;break;case _a.Y_LINE:i[1]=n;break;case _a.Z_LINE:i[2]=n;break;case _a.XY_PLANE:i[0]=n%r[0],i[1]=n/r[0];break;case _a.YZ_PLANE:i[1]=n%r[1],i[2]=n/r[1];break;case _a.XZ_PLANE:i[0]=n%r[0],i[2]=n/r[0];break;case _a.XYZ_GRID:i[0]=n%r[0],i[1]=n/r[0]%r[1],i[2]=n/(r[0]*r[1]);break;default:c0("Invalid dataDescription");break}const a=[0,0,0];return t.indexToWorld(i,a),a},t.getBounds=()=>t.extentToBounds(t.getSpatialExtent()),t.extentToBounds=n=>Nt.transformBounds(n,e.indexToWorld),t.getSpatialExtent=()=>Nt.inflate([...e.extent],.5),t.computeTransforms=()=>{d2(e.indexToWorld,e.origin),e.indexToWorld[0]=e.direction[0],e.indexToWorld[1]=e.direction[1],e.indexToWorld[2]=e.direction[2],e.indexToWorld[4]=e.direction[3],e.indexToWorld[5]=e.direction[4],e.indexToWorld[6]=e.direction[5],e.indexToWorld[8]=e.direction[6],e.indexToWorld[9]=e.direction[7],e.indexToWorld[10]=e.direction[8],ms(e.indexToWorld,e.indexToWorld,e.spacing),Ln(e.worldToIndex,e.indexToWorld)},t.indexToWorld=function(n){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];return pt(r,n,e.indexToWorld),r},t.indexToWorldVec3=t.indexToWorld,t.worldToIndex=function(n){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];return pt(r,n,e.worldToIndex),r},t.worldToIndexVec3=t.worldToIndex,t.indexToWorldBounds=function(n){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];return Nt.transformBounds(n,e.indexToWorld,r)},t.worldToIndexBounds=function(n){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];return Nt.transformBounds(n,e.worldToIndex,r)},t.onModified(t.computeTransforms),t.computeTransforms(),t.getCenter=()=>Nt.getCenter(t.getBounds()),t.computeHistogram=function(n){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;const i=[0,0,0,0,0,0];t.worldToIndexBounds(n,i);const a=[0,0,0],o=[0,0,0];Nt.computeCornerPoints(i,a,o),O3(a,a),O3(o,o);const s=t.getDimensions();R3(a,[0,0,0],[s[0]-1,s[1]-1,s[2]-1],a),R3(o,[0,0,0],[s[0]-1,s[1]-1,s[2]-1],o);const c=s[0],l=s[0]*s[1],f=t.getPointData().getScalars().getData();let u=-1/0,g=1/0,d=0,h=0,p=0;for(let T=a[2];T<=o[2];T++)for(let C=a[1];C<=o[1];C++){let w=a[0]+C*c+T*l;for(let x=a[0];x<=o[0];x++){if(!r||r([x,C,T],i)){const O=f[w];O>u&&(u=O),O<g&&(g=O),d+=O*O,h+=O,p+=1}++w}}const m=p>0?h/p:0,v=p?Math.abs(d/p-m*m):0,y=Math.sqrt(v);return{minimum:g,maximum:u,average:m,variance:v,sigma:y,count:p}},t.computeIncrements=function(n){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;const i=[];let a=r;for(let o=0;o<3;++o)i[o]=a,a*=n[o*2+1]-n[o*2]+1;return i},t.computeOffsetIndex=n=>{let[r,i,a]=n;const o=t.getExtent(),s=t.getPointData().getScalars().getNumberOfComponents(),c=t.computeIncrements(o,s);return Math.floor((Math.round(r)-o[0])*c[0]+(Math.round(i)-o[2])*c[1]+(Math.round(a)-o[4])*c[2])},t.getOffsetIndexFromWorld=n=>{const r=t.getExtent(),i=t.worldToIndex(n);for(let a=0;a<3;++a)if(i[a]<r[a*2]||i[a]>r[a*2+1])return c0(`GetScalarPointer: Pixel ${i} is not in memory. Current extent = ${r}`),NaN;return t.computeOffsetIndex(i)},t.getScalarValueFromWorld=function(n){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;const i=t.getPointData().getScalars().getNumberOfComponents();if(r<0||r>=i)return c0(`GetScalarPointer: Scalar Component ${r} is not within bounds. Current Scalar numberOfComponents: ${i}`),NaN;const a=t.getOffsetIndexFromWorld(n);return Number.isNaN(a)?a:t.getPointData().getScalars().getComponent(a,r)}}const XB={direction:null,indexToWorld:null,worldToIndex:null,spacing:[1,1,1],origin:[0,0,0],extent:[0,-1,0,-1,0,-1],dataDescription:_a.EMPTY};function MO(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,XB,n),Zu.extend(t,e,n),e.direction?Array.isArray(e.direction)&&(e.direction=new Float64Array(e.direction.slice(0,9))):e.direction=ya(new Float64Array(9)),e.indexToWorld=new Float64Array(16),e.worldToIndex=new Float64Array(16),P.get(t,e,["indexToWorld","worldToIndex"]),P.setGetArray(t,e,["origin","spacing"],3),P.setGetArray(t,e,["direction"],9),P.getArray(t,e,["extent"],6),qB(t,e)}const YB=P.newInstance(MO,"vtkImageData");var v2={newInstance:YB,extend:MO};const ZB={MAGNITUDE:0,COMPONENT:1,RGBCOLORS:2},V3={LUMINANCE:1,LUMINANCE_ALPHA:2,RGB:3,RGBA:4};var ry={VectorMode:ZB,ScalarMappingTarget:V3};const QB={DEFAULT:0,MAP_SCALARS:1,DIRECT_SCALARS:2},JB={DEFAULT:0,USE_POINT_DATA:1,USE_CELL_DATA:2,USE_POINT_FIELD_DATA:3,USE_CELL_FIELD_DATA:4,USE_FIELD_DATA:5},eG={BY_ID:0,BY_NAME:1};var y2={ColorMode:QB,GetArray:eG,ScalarMode:JB};const{ScalarMappingTarget:E9,VectorMode:io}=ry,{VtkDataTypes:$s}=nt,{ColorMode:Qd}=y2,{vtkErrorMacro:O9}=P;function tG(t){return t}function D9(t){return Math.floor(t*255+.5)}function nG(t,e){e.classHierarchy.push("vtkScalarsToColors"),t.setVectorModeToMagnitude=()=>t.setVectorMode(io.MAGNITUDE),t.setVectorModeToComponent=()=>t.setVectorMode(io.COMPONENT),t.setVectorModeToRGBColors=()=>t.setVectorMode(io.RGBCOLORS),t.build=()=>{},t.isOpaque=()=>!0,t.setAnnotations=(n,r)=>{if(!(n&&!r||!n&&r)){if(n&&r&&n.length!==r.length){O9("Values and annotations do not have the same number of tuples so ignoring");return}if(e.annotationArray=[],r&&n){const i=r.length;for(let a=0;a<i;a++)e.annotationArray.push({value:n[a],annotation:String(r[a])})}t.updateAnnotatedValueMap(),t.modified()}},t.setAnnotation=(n,r)=>{let i=t.checkForAnnotatedValue(n),a=!1;return i>=0?e.annotationArray[i].annotation!==r&&(e.annotationArray[i].annotation=r,a=!0):(e.annotationArray.push({value:n,annotation:r}),i=e.annotationArray.length-1,a=!0),a&&(t.updateAnnotatedValueMap(),t.modified()),i},t.getNumberOfAnnotatedValues=()=>e.annotationArray.length,t.getAnnotatedValue=n=>n<0||n>=e.annotationArray.length?null:e.annotationArray[n].value,t.getAnnotation=n=>e.annotationArray[n]===void 0?null:e.annotationArray[n].annotation,t.getAnnotatedValueIndex=n=>e.annotationArray.length?t.checkForAnnotatedValue(n):-1,t.removeAnnotation=n=>{const r=t.checkForAnnotatedValue(n),i=r>=0;return i&&(e.annotationArray.splice(r,1),t.updateAnnotatedValueMap(),t.modified()),i},t.resetAnnotations=()=>{e.annotationArray=[],e.annotatedValueMap=[],t.modified()},t.getAnnotationColor=(n,r)=>{if(e.indexedLookup){const i=t.getAnnotatedValueIndex(n);t.getIndexedColor(i,r)}else t.getColor(parseFloat(n),r),r[3]=1},t.checkForAnnotatedValue=n=>t.getAnnotatedValueIndexInternal(n),t.getAnnotatedValueIndexInternal=n=>{if(e.annotatedValueMap[n]!==void 0){const r=e.annotationArray.length;return e.annotatedValueMap[n]%r}return-1},t.getIndexedColor=(n,r)=>{r[0]=0,r[1]=0,r[2]=0,r[3]=0},t.updateAnnotatedValueMap=()=>{e.annotatedValueMap=[];const n=e.annotationArray.length;for(let r=0;r<n;r++)e.annotatedValueMap[e.annotationArray[r].value]=r},t.mapScalars=(n,r,i)=>{const a=n.getNumberOfComponents();let o=null;if(r===Qd.DEFAULT&&(n.getDataType()===$s.UNSIGNED_CHAR||n.getDataType()===$s.UNSIGNED_CHAR_CLAMPED)||r===Qd.DIRECT_SCALARS&&n)o=t.convertToRGBA(n,a,n.getNumberOfTuples());else{const s={type:"vtkDataArray",name:"temp",numberOfComponents:4,dataType:$s.UNSIGNED_CHAR},c=P.newTypedArray(s.dataType,4*n.getNumberOfTuples());s.values=c,s.size=c.length,o=nt.newInstance(s);let l=i;l<0&&a>1?t.mapVectorsThroughTable(n,o,E9.RGBA,-1,-1):(l<0&&(l=0),l>=a&&(l=a-1),t.mapScalarsThroughTable(n,o,E9.RGBA,l))}return o},t.mapVectorsToMagnitude=(n,r,i)=>{const a=n.getNumberOfTuples(),o=n.getNumberOfComponents(),s=r.getData(),c=n.getData();for(let l=0;l<a;l++){let f=0;for(let u=0;u<i;u++)f+=c[l*o+u]*c[l*o+u];s[l]=Math.sqrt(f)}},t.mapVectorsThroughTable=(n,r,i,a,o)=>{let s=t.getVectorMode(),c=o,l=a;const f=n.getNumberOfComponents();s===io.COMPONENT?(l===-1&&(l=t.getVectorComponent()),l<0&&(l=0),l>=f&&(l=f-1)):(c===-1&&(c=t.getVectorSize()),c<=0?(l=0,c=f):(l<0&&(l=0),l>=f&&(l=f-1),l+c>f&&(c=f-l)),s===io.MAGNITUDE&&(f===1||c===1)&&(s=io.COMPONENT));let u=0;switch(l>0&&(u=l),s){case io.COMPONENT:{t.mapScalarsThroughTable(n,r,i,u);break}case io.RGBCOLORS:break;case io.MAGNITUDE:default:{const g=nt.newInstance({numberOfComponents:1,values:new Float32Array(n.getNumberOfTuples())});t.mapVectorsToMagnitude(n,g,c),t.mapScalarsThroughTable(g,r,i,0);break}}},t.luminanceToRGBA=(n,r,i,a)=>{const o=a(i),s=r.getData(),c=n.getData(),l=s.length,f=0,u=1;let g=0;for(let d=f;d<l;d+=u){const h=a(s[d]);c[g*4]=h,c[g*4+1]=h,c[g*4+2]=h,c[g*4+3]=o,g++}},t.luminanceAlphaToRGBA=(n,r,i,a)=>{const o=r.getData(),s=n.getData(),c=o.length,l=0,f=2;let u=0;for(let g=l;g<c;g+=f){const d=a(o[g]);s[u]=d,s[u+1]=d,s[u+2]=d,s[u+3]=a(o[g+1])*i,u+=4}},t.rGBToRGBA=(n,r,i,a)=>{const o=D9(i),s=r.getData(),c=n.getData(),l=s.length,f=0,u=3;let g=0;for(let d=f;d<l;d+=u)c[g*4]=a(s[d]),c[g*4+1]=a(s[d+1]),c[g*4+2]=a(s[d+2]),c[g*4+3]=o,g++},t.rGBAToRGBA=(n,r,i,a)=>{const o=r.getData(),s=n.getData(),c=o.length,l=0,f=4;let u=0;for(let g=l;g<c;g+=f)s[u*4]=a(o[g]),s[u*4+1]=a(o[g+1]),s[u*4+2]=a(o[g+2]),s[u*4+3]=a(o[g+3])*i,u++},t.convertToRGBA=(n,r,i)=>{let{alpha:a}=e;if(r===4&&a>=1&&n.getDataType()===$s.UNSIGNED_CHAR)return n;const o=nt.newInstance({numberOfComponents:4,empty:!0,size:4*i,dataType:$s.UNSIGNED_CHAR});if(i<=0)return o;a=a>0?a:0,a=a<1?a:1;let s=tG;switch((n.getDataType()===$s.FLOAT||n.getDataType()===$s.DOUBLE)&&(s=D9),r){case 1:t.luminanceToRGBA(o,n,a,s);break;case 2:t.luminanceAlphaToRGBA(o,n,s);break;case 3:t.rGBToRGBA(o,n,a,s);break;case 4:t.rGBAToRGBA(o,n,a,s);break;default:return O9("Cannot convert colors"),null}return o},t.usingLogScale=()=>!1,t.getNumberOfAvailableColors=()=>256*256*256,t.setRange=(n,r)=>t.setMappingRange(n,r),t.getRange=()=>t.getMappingRange(),t.areScalarsOpaque=(n,r,i)=>{if(!n)return t.isOpaque();const a=n.getNumberOfComponents();return r===Qd.DEFAULT&&n.getDataType()===$s.UNSIGNED_CHAR||r===Qd.DIRECT_SCALARS?a===3||a===1?e.alpha>=1:n.getRange(a-1)[0]===255:!0}}const rG={alpha:1,vectorComponent:0,vectorSize:-1,vectorMode:io.COMPONENT,mappingRange:null,annotationArray:null,annotatedValueMap:null,indexedLookup:!1};function _O(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,rG,n),P.obj(t,e),e.mappingRange=[0,255],e.annotationArray=[],e.annotatedValueMap=[],P.setGet(t,e,["vectorSize","vectorComponent","vectorMode","alpha","indexedLookup"]),P.setArray(t,e,["mappingRange"],2),P.getArray(t,e,["mappingRange"]),nG(t,e)}const iG=P.newInstance(_O,"vtkScalarsToColors");var T2={newInstance:iG,extend:_O,...ry};const{vtkErrorMacro:R9}=P,M9=0,_9=1,_5=2;function aG(t,e){e.classHierarchy.push("vtkLookupTable"),t.isOpaque=()=>{if(e.opaqueFlagBuildTime.getMTime()<t.getMTime()){let n=!0;e.nanColor[3]<1&&(n=0),e.useBelowRangeColor&&e.belowRangeColor[3]<1&&(n=0),e.useAboveRangeColor&&e.aboveRangeColor[3]<1&&(n=0);for(let r=3;r<e.table.length&&n;r+=4)e.table[r]<255&&(n=!1);e.opaqueFlag=n,e.opaqueFlagBuildTime.modified()}return e.opaqueFlag},t.usingLogScale=()=>!1,t.getNumberOfAvailableColors=()=>e.table.length/4-3,t.linearIndexLookup=(n,r)=>{let i=0;const a=Number(n);return a<r.range[0]?i=r.maxIndex+M9+1.5:a>r.range[1]?i=r.maxIndex+_9+1.5:(i=(a+r.shift)*r.scale,i=i<r.maxIndex?i:r.maxIndex),Math.floor(i)},t.linearLookup=(n,r,i)=>{let a=0;rh(n)?a=Math.floor(i.maxIndex+1.5+_5):a=t.linearIndexLookup(n,i);const o=4*a;return r.slice(o,o+4)},t.indexedLookupFunction=(n,r,i)=>{let a=t.getAnnotatedValueIndexInternal(n);a===-1&&(a=e.numberOfColors+_5);const o=4*a;return[r[o],r[o+1],r[o+2],r[o+3]]},t.lookupShiftAndScale=(n,r)=>{r.shift=-n[0],r.scale=Number.MAX_VALUE,n[1]>n[0]&&(r.scale=(r.maxIndex+1)/(n[1]-n[0]))},t.mapScalarsThroughTable=(n,r,i,a)=>{let o=t.linearLookup;e.indexedLookup&&(o=t.indexedLookupFunction);const s=t.getMappingRange(),c={maxIndex:t.getNumberOfColors()-1,range:s,shift:0,scale:0};t.lookupShiftAndScale(s,c);const l=t.getAlpha(),f=n.getNumberOfTuples(),u=n.getNumberOfComponents(),g=r.getData(),d=n.getData();if(l>=1){if(i===V3.RGBA)for(let h=0;h<f;h++){const p=o(d[h*u+a],e.table,c);g[h*4]=p[0],g[h*4+1]=p[1],g[h*4+2]=p[2],g[h*4+3]=p[3]}}else if(i===V3.RGBA)for(let h=0;h<f;h++){const p=o(d[h*u+a],e.table,c);g[h*4]=p[0],g[h*4+1]=p[1],g[h*4+2]=p[2],g[h*4+3]=Math.floor(p[3]*l+.5)}},t.forceBuild=()=>{let n=0,r=0,i=0,a=0;const o=e.numberOfColors-1;o&&(n=(e.hueRange[1]-e.hueRange[0])/o,r=(e.saturationRange[1]-e.saturationRange[0])/o,i=(e.valueRange[1]-e.valueRange[0])/o,a=(e.alphaRange[1]-e.alphaRange[0])/o),e.table.length=4*o+16;const s=[],c=[];for(let l=0;l<=o;l++)s[0]=e.hueRange[0]+l*n,s[1]=e.saturationRange[0]+l*r,s[2]=e.valueRange[0]+l*i,O0(s,c),c[3]=e.alphaRange[0]+l*a,e.table[l*4]=c[0]*255+.5,e.table[l*4+1]=c[1]*255+.5,e.table[l*4+2]=c[2]*255+.5,e.table[l*4+3]=c[3]*255+.5;t.buildSpecialColors(),e.buildTime.modified()},t.setTable=n=>{if(Array.isArray(n)){const i=n[0].length;e.numberOfColors=n.length;const a=4-i;let o=0;for(let s=0;s<e.numberOfColors;s++)e.table[s*4]=255,e.table[s*4+1]=255,e.table[s*4+2]=255,e.table[s*4+3]=255;for(let s=0;s<n.length;s++){const c=n[s];for(let l=0;l<i;l++)e.table[o++]=c[l];o+=a}return t.buildSpecialColors(),e.insertTime.modified(),t.modified(),!0}if(n.getNumberOfComponents()!==4)return R9("Expected 4 components for RGBA colors"),!1;if(n.getDataType()!==ut.UNSIGNED_CHAR)return R9("Expected unsigned char values for RGBA colors"),!1;e.numberOfColors=n.getNumberOfTuples();const r=n.getData();e.table.length=r.length;for(let i=0;i<r.length;i++)e.table[i]=r[i];return t.buildSpecialColors(),e.insertTime.modified(),t.modified(),!0},t.buildSpecialColors=()=>{const{numberOfColors:n}=e,r=e.table;let i=(n+M9)*4;e.useBelowRangeColor||n===0?(r[i]=e.belowRangeColor[0]*255+.5,r[i+1]=e.belowRangeColor[1]*255+.5,r[i+2]=e.belowRangeColor[2]*255+.5,r[i+3]=e.belowRangeColor[3]*255+.5):(r[i]=r[0],r[i+1]=r[1],r[i+2]=r[2],r[i+3]=r[3]),i=(n+_9)*4,e.useAboveRangeColor||n===0?(r[i]=e.aboveRangeColor[0]*255+.5,r[i+1]=e.aboveRangeColor[1]*255+.5,r[i+2]=e.aboveRangeColor[2]*255+.5,r[i+3]=e.aboveRangeColor[3]*255+.5):(r[i]=r[4*(n-1)+0],r[i+1]=r[4*(n-1)+1],r[i+2]=r[4*(n-1)+2],r[i+3]=r[4*(n-1)+3]),i=(n+_5)*4,r[i]=e.nanColor[0]*255+.5,r[i+1]=e.nanColor[1]*255+.5,r[i+2]=e.nanColor[2]*255+.5,r[i+3]=e.nanColor[3]*255+.5},t.build=()=>{(e.table.length<1||t.getMTime()>e.buildTime.getMTime()&&e.insertTime.getMTime()<=e.buildTime.getMTime())&&t.forceBuild()},e.table.length>0&&(t.buildSpecialColors(),e.insertTime.modified())}const oG={numberOfColors:256,hueRange:[0,.66667],saturationRange:[1,1],valueRange:[1,1],alphaRange:[1,1],nanColor:[.5,0,0,1],belowRangeColor:[0,0,0,1],aboveRangeColor:[1,1,1,1],useAboveRangeColor:!1,useBelowRangeColor:!1,alpha:1};function bO(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,oG,n),T2.extend(t,e,n),e.table||(e.table=[]),e.buildTime={},P.obj(e.buildTime),e.opaqueFlagBuildTime={},P.obj(e.opaqueFlagBuildTime,{mtime:0}),e.insertTime={},P.obj(e.insertTime,{mtime:0}),P.get(t,e,["buildTime"]),P.setGet(t,e,["numberOfColors","useAboveRangeColor","useBelowRangeColor"]),P.setArray(t,e,["alphaRange","hueRange","saturationRange","valueRange"],2),P.setArray(t,e,["nanColor","belowRangeColor","aboveRangeColor"],4),P.getArray(t,e,["hueRange","saturationRange","valueRange","alphaRange","nanColor","belowRangeColor","aboveRangeColor"]),aG(t,e)}const sG=P.newInstance(bO,"vtkLookupTable");var gh={newInstance:sG,extend:bO};const Wa={Off:0,PolygonOffset:1};let P3=Wa.PolygonOffset,dh=Wa.Off;const cG=["VTK_RESOLVE_OFF","VTK_RESOLVE_POLYGON_OFFSET"];function lG(){return P3}function uG(t){const e=P3===t;return P3=t,e}function fG(){return dh}function C2(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;const e=dh===t;return dh=t,e}function gG(){return C2(Wa.Off)}function dG(){return C2(Wa.Off)}function pG(){return C2(Wa.PolygonOffset)}function hG(){return cG[dh]}var N3={Resolve:Wa,getResolveCoincidentTopologyAsString:hG,getResolveCoincidentTopologyPolygonOffsetFaces:lG,getResolveCoincidentTopology:fG,setResolveCoincidentTopology:C2,setResolveCoincidentTopologyPolygonOffsetFaces:uG,setResolveCoincidentTopologyToDefault:gG,setResolveCoincidentTopologyToOff:dG,setResolveCoincidentTopologyToPolygonOffset:pG};function LO(t,e,n){n.forEach(r=>{t[`get${r.method}`]=()=>e[r.key],t[`set${r.method}`]=P.objectSetterMap.object(t,e,{name:r.key,params:["factor","offset"]})})}const iy=["Polygon","Line","Point"],mG={Polygon:{factor:2,offset:0},Line:{factor:1,offset:-1},Point:{factor:0,offset:-2}},vG=()=>{},D0={modified:vG};LO(D0,mG,iy.map(t=>({key:t,method:`ResolveCoincidentTopology${t}OffsetParameters`})));function yG(t,e){e.resolveCoincidentTopology===void 0&&(e.resolveCoincidentTopology=!1),P.setGet(t,e,["resolveCoincidentTopology"]),e.topologyOffset={Polygon:{factor:0,offset:0},Line:{factor:0,offset:0},Point:{factor:0,offset:0}},Object.keys(N3).forEach(n=>{t[n]=N3[n]}),Object.keys(D0).filter(n=>n!=="modified").forEach(n=>{t[n]=D0[n]}),LO(t,e.topologyOffset,iy.map(n=>({key:n,method:`RelativeCoincidentTopology${n}OffsetParameters`}))),t.getCoincidentTopologyPolygonOffsetParameters=()=>{const n=D0.getResolveCoincidentTopologyPolygonOffsetParameters(),r=t.getRelativeCoincidentTopologyPolygonOffsetParameters();return{factor:n.factor+r.factor,offset:n.offset+r.offset}},t.getCoincidentTopologyLineOffsetParameters=()=>{const n=D0.getResolveCoincidentTopologyLineOffsetParameters(),r=t.getRelativeCoincidentTopologyLineOffsetParameters();return{factor:n.factor+r.factor,offset:n.offset+r.offset}},t.getCoincidentTopologyPointOffsetParameter=()=>{const n=D0.getResolveCoincidentTopologyPointOffsetParameters(),r=t.getRelativeCoincidentTopologyPointOffsetParameters();return{factor:n.factor+r.factor,offset:n.offset+r.offset}}}var w2={implementCoincidentTopologyMethods:yG,staticOffsetAPI:D0,otherStaticMethods:N3,CATEGORIES:iy,Resolve:Wa};const{FieldAssociations:b9}=Zu,{staticOffsetAPI:TG,otherStaticMethods:CG}=w2,{ColorMode:Jd,ScalarMode:l0,GetArray:b5}=y2,{VectorMode:wG}=ry,{VtkDataTypes:xG}=nt;function yf(t){return()=>P.vtkErrorMacro(`vtkMapper::${t} - NOT IMPLEMENTED`)}function SG(t,e){const n=t[1]%2===0?1:-1;if(t[0]+=n,t[0]>=e[0]||t[0]<0){const r=t[2]%2===0?1:-1;t[0]-=n,t[1]+=r,(t[1]>=e[1]||t[1]<0)&&(t[1]-=r,t[2]++)}}function EG(t,e){return t[0]+e[0]*(t[1]+e[1]*t[2])}function L9(t,e,n){const r=Math.floor(e),i=r%(2*n[0]);let a,o;i<n[0]?(t[0]=i,a=1,o=t[0]===n[0]-1):(t[0]=2*n[0]-1-i,a=-1,o=t[0]===0);const s=Math.floor(r/n[0]),c=s%(2*n[1]);let l,f;c<n[1]?(t[1]=c,l=1,f=t[1]===n[1]-1):(t[1]=2*n[1]-1-c,l=-1,f=t[1]===0),t[2]=Math.floor(s/n[1]);const u=e-r;o?f?t[2]+=u:t[1]+=l*u:t[0]+=a*u,t[0]=(t[0]+.5)/n[0],t[1]=(t[1]+.5)/n[1],t[2]=(t[2]+.5)/n[2]}const I9=new WeakMap;function OG(t,e,n,r,i,a,o){var z;const s=new Array(arguments.length);for(let X=0;X<arguments.length;++X){const Z=arguments[X];s[X]=((z=Z.getMTime)==null?void 0:z.call(Z))??Z}const c=s.join("/"),l=I9.get(t);if(l&&l.stringHash===c)return l.textureCoordinates;const f=(n[1]-n[0])/(r-1),[u,g]=[n[0]-f,n[1]+f],d=u-.5*f,h=1/(g-u+f),p=u,m=(r+1)/(g-u),v=t.getData(),y=t.getNumberOfTuples(),T=t.getNumberOfComponents(),C=e<0||e>=T,w=i[2]<=1?2:3,x=nt.newInstance({numberOfComponents:w,values:new Float32Array(y*w)}),O=x.getData(),M=[0,0,0];L9(M,r+2,i);let A=0,_=0;const k=[.5,.5,.5];for(let X=0;X<y;++X){let Z;if(C){let ce=0;for(let J=0;J<T;++J){const de=v[A+J];ce+=de*de}Z=Math.sqrt(ce)}else Z=v[A+e];if(A+=T,a&&(Z=gh.applyLogScale(Z,n,n)),rh(Z))k[0]=M[0],k[1]=M[1],k[2]=M[2];else if(o){let ce=(Z-p)*m;ce<1?ce=0:ce>r&&(ce=r+1),L9(k,ce,i)}else{k[1]=.49;const ce=(Z-d)*h;ce>1e3?k[0]=1e3:ce<-1e3?k[0]=-1e3:k[0]=ce}for(let ce=0;ce<w;++ce)O[_++]=k[ce]}return I9.set(t,{stringHash:c,textureCoordinates:x}),x}function DG(t,e){e.classHierarchy.push("vtkMapper"),t.getBounds=()=>{const n=t.getInputData();return n?(e.static||t.update(),e.bounds=n.getBounds()):e.bounds=Oc(),e.bounds},t.setForceCompileOnly=n=>{e.forceCompileOnly=n},t.setSelectionWebGLIdsToVTKIds=n=>{e.selectionWebGLIdsToVTKIds=n},t.createDefaultLookupTable=()=>{e.lookupTable=gh.newInstance()},t.getColorModeAsString=()=>P.enumToString(Jd,e.colorMode),t.setColorModeToDefault=()=>t.setColorMode(0),t.setColorModeToMapScalars=()=>t.setColorMode(1),t.setColorModeToDirectScalars=()=>t.setColorMode(2),t.getScalarModeAsString=()=>P.enumToString(l0,e.scalarMode),t.setScalarModeToDefault=()=>t.setScalarMode(0),t.setScalarModeToUsePointData=()=>t.setScalarMode(1),t.setScalarModeToUseCellData=()=>t.setScalarMode(2),t.setScalarModeToUsePointFieldData=()=>t.setScalarMode(3),t.setScalarModeToUseCellFieldData=()=>t.setScalarMode(4),t.setScalarModeToUseFieldData=()=>t.setScalarMode(5),t.getAbstractScalars=(n,r,i,a,o)=>{if(!n||!e.scalarVisibility)return{scalars:null,cellFlag:!1};let s=null,c=!1;if(r===l0.DEFAULT)s=n.getPointData().getScalars(),s||(s=n.getCellData().getScalars(),c=!0);else if(r===l0.USE_POINT_DATA)s=n.getPointData().getScalars();else if(r===l0.USE_CELL_DATA)s=n.getCellData().getScalars(),c=!0;else if(r===l0.USE_POINT_FIELD_DATA){const l=n.getPointData();i===b5.BY_ID?s=l.getArrayByIndex(a):s=l.getArrayByName(o)}else if(r===l0.USE_CELL_FIELD_DATA){const l=n.getCellData();c=!0,i===b5.BY_ID?s=l.getArrayByIndex(a):s=l.getArrayByName(o)}else if(r===l0.USE_FIELD_DATA){const l=n.getFieldData();i===b5.BY_ID?s=l.getArrayByIndex(a):s=l.getArrayByName(o)}return{scalars:s,cellFlag:c}},t.mapScalars=(n,r)=>{const{scalars:i,cellFlag:a}=t.getAbstractScalars(n,e.scalarMode,e.arrayAccessMode,e.arrayId,e.colorByArrayName);if(e.areScalarsMappedFromCells=a,!i){e.colorCoordinates=null,e.colorTextureMap=null,e.colorMapColors=null;return}const o=`${t.getMTime()}${i.getMTime()}${r}`;if(e.colorBuildString!==o){if(e.useLookupTableScalarRange||t.getLookupTable().setRange(e.scalarRange[0],e.scalarRange[1]),t.canUseTextureMapForColoring(i,a))e.mapScalarsToTexture(i,a,r);else{e.colorCoordinates=null,e.colorTextureMap=null;const s=t.getLookupTable();s&&(s.build(),e.colorMapColors=s.mapScalars(i,e.colorMode,e.fieldDataTupleId))}e.colorBuildString=`${t.getMTime()}${i.getMTime()}${r}`}},e.mapScalarsToTexture=(n,r,i)=>{const a=e.lookupTable.getRange(),o=e.lookupTable.usingLogScale();o&&gh.getLogRange(a,a);const s=e.lookupTable.getAlpha();if(e.colorMapColors=null,e.colorTextureMap==null||t.getMTime()>e.colorTextureMap.getMTime()||e.lookupTable.getMTime()>e.colorTextureMap.getMTime()||e.lookupTable.getAlpha()!==i){e.lookupTable.setAlpha(i),e.colorTextureMap=null,e.lookupTable.build();const l=e.lookupTable.getNumberOfAvailableColors(),f=2048,u=f**3-3,d=4096-2,h=2,p=r?u:d;e.numberOfColorsInRange=Math.min(Math.max(l,h),p);const m=e.numberOfColorsInRange+3,v=e.numberOfColorsInRange+2,y=r?[Math.min(Math.ceil(m/f**0),f),Math.min(Math.ceil(m/f**1),f),Math.min(Math.ceil(m/f**2),f)]:[v,2,1],T=y[0]*y[1]*y[2],C=new Float64Array(T);C.fill(NaN);const w=e.numberOfColorsInRange,x=w+2,O=[0,0,0],M=a[0],A=a[1]-a[0];for(let z=0;z<x;++z){const X=EG(O,y),Z=M+A*(z-1)/(w-1);C[X]=o?10**Z:Z,SG(O,y)}const _=nt.newInstance({numberOfComponents:1,values:C}),k=e.lookupTable.mapScalars(_,e.colorMode,0);e.colorTextureMap=v2.newInstance(),e.colorTextureMap.setDimensions(y),e.colorTextureMap.getPointData().setScalars(k),e.lookupTable.setAlpha(s)}const c=e.lookupTable.getVectorMode()===wG.MAGNITUDE&&n.getNumberOfComponents()>1?-1:e.lookupTable.getVectorComponent();e.colorCoordinates=OG(n,c,a,e.numberOfColorsInRange,e.colorTextureMap.getDimensions(),o,r)},t.getIsOpaque=()=>{const n=t.getInputData(),i=t.getAbstractScalars(n,e.scalarMode,e.arrayAccessMode,e.arrayId,e.colorByArrayName).scalars;if(!e.scalarVisibility||i==null)return!0;const a=t.getLookupTable();return a?(a.build(),a.areScalarsOpaque(i,e.colorMode,-1)):!0},t.canUseTextureMapForColoring=(n,r)=>r&&e.colorMode!==Jd.DIRECT_SCALARS?!0:!(!e.interpolateScalarsBeforeMapping||e.lookupTable&&e.lookupTable.getIndexedLookup()||!n||e.colorMode===Jd.DEFAULT&&n.getDataType()===xG.UNSIGNED_CHAR||e.colorMode===Jd.DIRECT_SCALARS),t.clearColorArrays=()=>{e.colorMapColors=null,e.colorCoordinates=null,e.colorTextureMap=null},t.getLookupTable=()=>(e.lookupTable||t.createDefaultLookupTable(),e.lookupTable),t.getMTime=()=>{let n=e.mtime;if(e.lookupTable!==null){const r=e.lookupTable.getMTime();n=r>n?r:n}return n},t.getPrimitiveCount=()=>{const n=t.getInputData();return{points:n.getPoints().getNumberOfValues()/3,verts:n.getVerts().getNumberOfValues()-n.getVerts().getNumberOfCells(),lines:n.getLines().getNumberOfValues()-2*n.getLines().getNumberOfCells(),triangles:n.getPolys().getNumberOfValues()-3*n.getPolys().getNumberOfCells()}},t.acquireInvertibleLookupTable=yf("AcquireInvertibleLookupTable"),t.valueToColor=yf("ValueToColor"),t.colorToValue=yf("ColorToValue"),t.useInvertibleColorFor=yf("UseInvertibleColorFor"),t.clearInvertibleColor=yf("ClearInvertibleColor"),t.processSelectorPixelBuffers=(n,r)=>{if(!n||!e.selectionWebGLIdsToVTKIds||!e.populateSelectionSettings)return;const i=n.getRawPixelBuffer(ci.ID_LOW24),a=n.getRawPixelBuffer(ci.ID_HIGH24),o=n.getCurrentPass(),s=n.getFieldAssociation();let c=null;s===b9.FIELD_ASSOCIATION_POINTS?c=e.selectionWebGLIdsToVTKIds.points:s===b9.FIELD_ASSOCIATION_CELLS&&(c=e.selectionWebGLIdsToVTKIds.cells),c&&r.forEach(l=>{if(o===ci.ID_LOW24){let f=0;a&&(f+=a[l],f*=256),f+=i[l+2],f*=256,f+=i[l+1],f*=256,f+=i[l];const u=c[f],g=n.getPixelBuffer(ci.ID_LOW24);g[l]=u&255,g[l+1]=(u&65280)>>8,g[l+2]=(u&16711680)>>16}else if(o===ci.ID_HIGH24&&a){let f=0;f+=a[l],f*=256,f+=i[l+2],f*=256,f+=i[l+1],f*=256,f+=i[l];const u=c[f],g=n.getPixelBuffer(ci.ID_HIGH24);g[l]=(u&4278190080)>>24}})}}const RG={colorMapColors:null,areScalarsMappedFromCells:!1,static:!1,lookupTable:null,scalarVisibility:!0,scalarRange:[0,1],useLookupTableScalarRange:!1,colorMode:0,scalarMode:0,arrayAccessMode:1,renderTime:0,colorByArrayName:null,fieldDataTupleId:-1,populateSelectionSettings:!0,selectionWebGLIdsToVTKIds:null,interpolateScalarsBeforeMapping:!1,colorCoordinates:null,colorTextureMap:null,numberOfColorsInRange:0,forceCompileOnly:0,useInvertibleColors:!1,invertibleScalars:null,customShaderAttributes:[]};function IO(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,RG,n),ny.extend(t,e,n),P.get(t,e,["areScalarsMappedFromCells","colorCoordinates","colorMapColors","colorTextureMap","numberOfColorsInRange","selectionWebGLIdsToVTKIds"]),P.setGet(t,e,["colorByArrayName","arrayAccessMode","colorMode","fieldDataTupleId","interpolateScalarsBeforeMapping","lookupTable","populateSelectionSettings","renderTime","scalarMode","scalarVisibility","static","useLookupTableScalarRange","customShaderAttributes"]),P.setGetArray(t,e,["scalarRange"],2),w2.implementCoincidentTopologyMethods(t,e),DG(t,e)}const MG=P.newInstance(IO,"vtkMapper");var J0={newInstance:MG,extend:IO,...TG,...CG,...y2};const _G={DISPLAY:0,WORLD:1};var VO={CoordinateSystem:_G};const{CoordinateSystem:k3}=VO;function V9(t){return()=>P.vtkErrorMacro(`vtkProp::${t} - NOT IMPLEMENTED`)}function bG(t,e){e.classHierarchy.push("vtkProp"),t.getMTime=()=>{let n=e.mtime;for(let r=0;r<e.textures.length;++r){const i=e.textures[r].getMTime();i>n&&(n=i)}return n},t.processSelectorPixelBuffers=(n,r)=>{},t.getNestedProps=()=>null,t.getActors=()=>[],t.getActors2D=()=>[],t.getVolumes=()=>[],t.pick=V9("pick"),t.hasKey=V9("hasKey"),t.getNestedVisibility=()=>e.visibility&&(!e._parentProp||e._parentProp.getNestedVisibility()),t.getNestedPickable=()=>e.pickable&&(!e._parentProp||e._parentProp.getNestedPickable()),t.getNestedDragable=()=>e.dragable&&(!e._parentProp||e._parentProp.getNestedDragable()),t.getRedrawMTime=()=>e.mtime,t.setEstimatedRenderTime=n=>{e.estimatedRenderTime=n,e.savedEstimatedRenderTime=n},t.restoreEstimatedRenderTime=()=>{e.estimatedRenderTime=e.savedEstimatedRenderTime},t.addEstimatedRenderTime=n=>{e.estimatedRenderTime+=n},t.setAllocatedRenderTime=n=>{e.allocatedRenderTime=n,e.savedEstimatedRenderTime=e.estimatedRenderTime,e.estimatedRenderTime=0},t.getSupportsSelection=()=>!1,t.getTextures=()=>e.textures,t.hasTexture=n=>e.textures.indexOf(n)!==-1,t.addTexture=n=>{n&&!t.hasTexture(n)&&(e.textures=e.textures.concat(n),t.modified())},t.removeTexture=n=>{const r=e.textures.filter(i=>i!==n);e.textures.length!==r.length&&(e.textures=r,t.modified())},t.removeAllTextures=()=>{e.textures=[],t.modified()},t.setCoordinateSystemToWorld=()=>t.setCoordinateSystem(k3.WORLD),t.setCoordinateSystemToDisplay=()=>t.setCoordinateSystem(k3.DISPLAY)}const LG={allocatedRenderTime:10,coordinateSystem:k3.WORLD,dragable:!0,estimatedRenderTime:0,paths:null,pickable:!0,renderTimeMultiplier:1,savedEstimatedRenderTime:0,textures:[],useBounds:!0,visibility:!0};function PO(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,LG,n),P.obj(t,e),P.get(t,e,["estimatedRenderTime","allocatedRenderTime"]),P.setGet(t,e,["_parentProp","coordinateSystem","dragable","pickable","renderTimeMultiplier","useBounds","visibility"]),P.moveToProtected(t,e,["parentProp"]),bG(t,e)}const IG=P.newInstance(PO,"vtkProp");var vd={newInstance:IG,extend:PO,...VO},ay=`//VTK::System::Dec

/*=========================================================================

  Program:   Visualization Toolkit
  Module:    vtkPolyDataVS.glsl

  Copyright (c) Ken Martin, Will Schroeder, Bill Lorensen
  All rights reserved.
  See Copyright.txt or http://www.kitware.com/Copyright.htm for details.

     This software is distributed WITHOUT ANY WARRANTY; without even
     the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR
     PURPOSE.  See the above copyright notice for more information.

=========================================================================*/

attribute vec4 vertexMC;

// frag position in VC
//VTK::PositionVC::Dec

// optional normal declaration
//VTK::Normal::Dec

// extra lighting parameters
//VTK::Light::Dec

// Texture coordinates
//VTK::TCoord::Dec

// material property values
//VTK::Color::Dec

// clipping plane vars
//VTK::Clip::Dec

// camera and actor matrix values
//VTK::Camera::Dec

// Apple Bug
//VTK::PrimID::Dec

// picking support
//VTK::Picking::Dec

void main()
{
  //VTK::Color::Impl

  //VTK::Normal::Impl

  //VTK::TCoord::Impl

  //VTK::Clip::Impl

  //VTK::PrimID::Impl

  //VTK::PositionVC::Impl

  //VTK::Light::Impl

  //VTK::Picking::Impl
}
`,yd=`//VTK::System::Dec

/*=========================================================================

  Program:   Visualization Toolkit
  Module:    vtkPolyDataFS.glsl

  Copyright (c) Ken Martin, Will Schroeder, Bill Lorensen
  All rights reserved.
  See Copyright.txt or http://www.kitware.com/Copyright.htm for details.

     This software is distributed WITHOUT ANY WARRANTY; without even
     the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR
     PURPOSE.  See the above copyright notice for more information.

=========================================================================*/
// Template for the polydata mappers fragment shader

uniform int PrimitiveIDOffset;

// VC position of this fragment
//VTK::PositionVC::Dec

// optional color passed in from the vertex shader, vertexColor
//VTK::Color::Dec

// optional surface normal declaration
//VTK::Normal::Dec

// extra lighting parameters
//VTK::Light::Dec

// define vtkImageLabelOutlineOn
//VTK::ImageLabelOutlineOn

// Texture coordinates
//VTK::TCoord::Dec

// picking support
//VTK::Picking::Dec

// Depth Peeling Support
//VTK::DepthPeeling::Dec

// clipping plane vars
//VTK::Clip::Dec

// label outline 
//VTK::LabelOutline::Dec

// the output of this shader
//VTK::Output::Dec

// Apple Bug
//VTK::PrimID::Dec

// handle coincident offsets
//VTK::Coincident::Dec

//VTK::ZBuffer::Dec

//VTK::LabelOutlineHelperFunction

void main()
{
  // VC position of this fragment. This should not branch/return/discard.
  //VTK::PositionVC::Impl

  // Place any calls that require uniform flow (e.g. dFdx) here.
  //VTK::UniformFlow::Impl

  // Set gl_FragDepth here (gl_FragCoord.z by default)
  //VTK::Depth::Impl

  // Early depth peeling abort:
  //VTK::DepthPeeling::PreColor

  // Apple Bug
  //VTK::PrimID::Impl

  //VTK::Clip::Impl

  //VTK::Color::Impl

  // Generate the normal if we are not passed in one
  //VTK::Normal::Impl

  //VTK::TCoord::Impl

  //VTK::Light::Impl

  if (gl_FragData[0].a <= 0.0)
    {
    discard;
    }

  //VTK::DepthPeeling::Impl

  //VTK::Picking::Impl

  // handle coincident offsets
  //VTK::Coincident::Impl

  //VTK::ZBuffer::Impl

  //VTK::RenderPassFragmentShader::Impl
}
`;function VG(t,e){t.replaceShaderCoincidentOffset=(n,r,i)=>{const a=t.getCoincidentParameters(r,i);if(a&&(a.factor!==0||a.offset!==0)){let o=n.Fragment;o=te.substitute(o,"//VTK::Coincident::Dec",["uniform float cfactor;","uniform float coffset;"]).result,e.context.getExtension("EXT_frag_depth")&&(a.factor!==0?(o=te.substitute(o,"//VTK::UniformFlow::Impl",["float cscale = length(vec2(dFdx(gl_FragCoord.z),dFdy(gl_FragCoord.z)));","//VTK::UniformFlow::Impl"],!1).result,o=te.substitute(o,"//VTK::Depth::Impl","gl_FragDepthEXT = gl_FragCoord.z + cfactor*cscale + 0.000016*coffset;").result):o=te.substitute(o,"//VTK::Depth::Impl","gl_FragDepthEXT = gl_FragCoord.z + 0.000016*coffset;").result),e._openGLRenderWindow.getWebgl2()&&(a.factor!==0?(o=te.substitute(o,"//VTK::UniformFlow::Impl",["float cscale = length(vec2(dFdx(gl_FragCoord.z),dFdy(gl_FragCoord.z)));","//VTK::UniformFlow::Impl"],!1).result,o=te.substitute(o,"//VTK::Depth::Impl","gl_FragDepth = gl_FragCoord.z + cfactor*cscale + 0.000016*coffset;").result):o=te.substitute(o,"//VTK::Depth::Impl","gl_FragDepth = gl_FragCoord.z + 0.000016*coffset;").result),n.Fragment=o}}}function PG(t,e){t.applyShaderReplacements=(n,r,i)=>{let a=null;if(r&&(a=r.ShaderReplacements),a)for(let o=0;o<a.length;o++){const s=a[o];if(i&&s.replaceFirst||!i&&!s.replaceFirst){const c=s.shaderType,l=n[c],f=te.substitute(l,s.originalValue,s.replacementValue,s.replaceAll);n[c]=f.result}}},t.buildShaders=(n,r,i)=>{t.getReplacedShaderTemplate(n,r,i),e.lastRenderPassShaderReplacement=e.currentRenderPass?e.currentRenderPass.getShaderReplacement():null,e.lastRenderPassShaderReplacement&&e.lastRenderPassShaderReplacement(n);const a=e.renderable.getViewSpecificProperties().OpenGL;t.applyShaderReplacements(n,a,!0),t.replaceShaderValues(n,r,i),t.applyShaderReplacements(n,a)},t.getReplacedShaderTemplate=(n,r,i)=>{const a=e.renderable.getViewSpecificProperties().OpenGL;t.getShaderTemplate(n,r,i);let o=n.Vertex;if(a){const l=a.VertexShaderCode;l!==void 0&&l!==""&&(o=l)}n.Vertex=o;let s=n.Fragment;if(a){const l=a.FragmentShaderCode;l!==void 0&&l!==""&&(s=l)}n.Fragment=s;let c=n.Geometry;if(a){const l=a.GeometryShaderCode;l!==void 0&&(c=l)}n.Geometry=c}}var To={implementReplaceShaderCoincidentOffset:VG,implementBuildShadersWithReplacements:PG};const{FieldAssociations:L5}=Zu,{primTypes:rr}=Oo,{Representation:Cl,Shading:P9}=Yu,{ScalarMode:e1}=J0,{Filter:N9,Wrap:k9}=Xt,{vtkErrorMacro:u0}=Ir,NG={type:"StartEvent"},kG={type:"EndEvent"},{CoordinateSystem:AG}=vd;function FG(t){const e=t.getSelector();return e?e.getCurrentPass():ci.MIN_KNOWN_PASS-1}function UG(t,e){e.classHierarchy.push("vtkOpenGLPolyDataMapper"),t.buildPass=r=>{r&&(e.currentRenderPass=null,e.openGLActor=t.getFirstAncestorOfType("vtkOpenGLActor"),e._openGLRenderer=e.openGLActor.getFirstAncestorOfType("vtkOpenGLRenderer"),e._openGLRenderWindow=e._openGLRenderer.getLastAncestorOfType("vtkOpenGLRenderWindow"),e.openGLCamera=e._openGLRenderer.getViewNodeFor(e._openGLRenderer.getRenderable().getActiveCamera()))},t.translucentPass=(r,i)=>{r&&(e.currentRenderPass=i,t.render())},t.zBufferPass=r=>{r&&(e.haveSeenDepthRequest=!0,e.renderDepth=!0,t.render(),e.renderDepth=!1)},t.opaqueZBufferPass=r=>t.zBufferPass(r),t.opaquePass=r=>{r&&t.render()},t.render=()=>{const r=e._openGLRenderWindow.getContext();if(e.context!==r){e.context=r;for(let o=rr.Start;o<rr.End;o++)e.primitives[o].setOpenGLRenderWindow(e._openGLRenderWindow)}const i=e.openGLActor.getRenderable(),a=e._openGLRenderer.getRenderable();t.renderPiece(a,i)},t.getShaderTemplate=(r,i,a)=>{r.Vertex=ay,r.Fragment=yd,r.Geometry=""},t.replaceShaderColor=(r,i,a)=>{let o=r.Vertex,s=r.Geometry,c=r.Fragment;const l=e.lastBoundBO.getReferenceByName("lastLightComplexity");let f=["uniform float ambient;","uniform float diffuse;","uniform float specular;","uniform float opacityUniform; // the fragment opacity","uniform vec3 ambientColorUniform;","uniform vec3 diffuseColorUniform;"];l&&(f=f.concat(["uniform vec3 specularColorUniform;","uniform float specularPowerUniform;"]));let u=["vec3 ambientColor;","  vec3 diffuseColor;","  float opacity;"];l&&(u=u.concat(["  vec3 specularColor;","  float specularPower;"])),u=u.concat(["  ambientColor = ambientColorUniform;","  diffuseColor = diffuseColorUniform;","  opacity = opacityUniform;"]),l&&(u=u.concat(["  specularColor = specularColorUniform;","  specularPower = specularPowerUniform;"])),e.lastBoundBO.getCABO().getColorComponents()!==0&&!e.drawingEdges&&(f=f.concat(["varying vec4 vertexColorVSOutput;"]),o=te.substitute(o,"//VTK::Color::Dec",["attribute vec4 scalarColor;","varying vec4 vertexColorVSOutput;"]).result,o=te.substitute(o,"//VTK::Color::Impl",["vertexColorVSOutput =  scalarColor;"]).result,s=te.substitute(s,"//VTK::Color::Dec",["in vec4 vertexColorVSOutput[];","out vec4 vertexColorGSOutput;"]).result,s=te.substitute(s,"//VTK::Color::Impl",["vertexColorGSOutput = vertexColorVSOutput[i];"]).result),e.lastBoundBO.getCABO().getColorComponents()!==0&&!e.drawingEdges?c=te.substitute(c,"//VTK::Color::Impl",u.concat(["  diffuseColor = vertexColorVSOutput.rgb;","  ambientColor = vertexColorVSOutput.rgb;","  opacity = opacity*vertexColorVSOutput.a;"])).result:(e.renderable.getAreScalarsMappedFromCells()||e.renderable.getInterpolateScalarsBeforeMapping())&&e.renderable.getColorCoordinates()&&!e.drawingEdges?c=te.substitute(c,"//VTK::Color::Impl",u.concat(["  vec4 texColor = texture2D(texture1, tcoordVCVSOutput.st);","  diffuseColor = texColor.rgb;","  ambientColor = texColor.rgb;","  opacity = opacity*texColor.a;"])).result:(a.getBackfaceProperty()&&!e.drawingEdges&&(f=f.concat(["uniform float opacityUniformBF; // the fragment opacity","uniform float ambientIntensityBF; // the material ambient","uniform float diffuseIntensityBF; // the material diffuse","uniform vec3 ambientColorUniformBF; // ambient material color","uniform vec3 diffuseColorUniformBF; // diffuse material color"]),l?(f=f.concat(["uniform float specularIntensityBF; // the material specular intensity","uniform vec3 specularColorUniformBF; // intensity weighted color","uniform float specularPowerUniformBF;"]),u=u.concat(["if (gl_FrontFacing == false) {","  ambientColor = ambientIntensityBF * ambientColorUniformBF;","  diffuseColor = diffuseIntensityBF * diffuseColorUniformBF;","  specularColor = specularIntensityBF * specularColorUniformBF;","  specularPower = specularPowerUniformBF;","  opacity = opacityUniformBF; }"])):u=u.concat(["if (gl_FrontFacing == false) {","  ambientColor = ambientIntensityBF * ambientColorUniformBF;","  diffuseColor = diffuseIntensityBF * diffuseColorUniformBF;","  opacity = opacityUniformBF; }"])),e.haveCellScalars&&!e.drawingEdges&&(f=f.concat(["uniform samplerBuffer texture1;"])),c=te.substitute(c,"//VTK::Color::Impl",u).result),c=te.substitute(c,"//VTK::Color::Dec",f).result,r.Vertex=o,r.Geometry=s,r.Fragment=c},t.replaceShaderLight=(r,i,a)=>{let o=r.Fragment;const s="",c=e.lastBoundBO.getReferenceByName("lastLightComplexity"),l=e.lastBoundBO.getReferenceByName("lastLightCount");let f=[];switch(c){case 0:o=te.substitute(o,"//VTK::Light::Impl",["  gl_FragData[0] = vec4(ambientColor * ambient + diffuseColor * diffuse, opacity);","  //VTK::Light::Impl"],!1).result;break;case 1:o=te.substitute(o,"//VTK::Light::Impl",["  float df = max(0.0, normalVCVSOutput.z);","  float sf = pow(df, specularPower);","  vec3 diffuseL = df * diffuseColor;","  vec3 specularL = sf * specularColor;","  gl_FragData[0] = vec4(ambientColor * ambient + diffuseL * diffuse + specularL * specular, opacity);","  //VTK::Light::Impl"],!1).result;break;case 2:for(let u=0;u<l;++u)f=f.concat([`uniform vec3 lightColor${u};`,`uniform vec3 lightDirectionVC${u}; // normalized`,`uniform vec3 lightHalfAngleVC${u}; // normalized`]);o=te.substitute(o,"//VTK::Light::Dec",f).result,f=["vec3 diffuseL = vec3(0,0,0);","  vec3 specularL = vec3(0,0,0);","  float df;"];for(let u=0;u<l;++u)f=f.concat([`  df = max(0.0, dot(normalVCVSOutput, -lightDirectionVC${u}));`,`  diffuseL += ((df${s}) * lightColor${u});`,`  if (dot(normalVCVSOutput, lightDirectionVC${u}) < 0.0)`,"    {",`    float sf = sign(df)*pow(max(1e-5,
                                              dot(reflect(lightDirectionVC${u},normalVCVSOutput),
                                                  normalize(-vertexVC.xyz))),
                                         specularPower);`,`    specularL += (sf${s} * lightColor${u});`,"    }"]);f=f.concat(["  diffuseL = diffuseL * diffuseColor;","  specularL = specularL * specularColor;","  gl_FragData[0] = vec4(ambientColor * ambient + diffuseL * diffuse + specularL * specular, opacity);","  //VTK::Light::Impl"]),o=te.substitute(o,"//VTK::Light::Impl",f,!1).result;break;case 3:for(let u=0;u<l;++u)f=f.concat([`uniform vec3 lightColor${u};`,`uniform vec3 lightDirectionVC${u}; // normalized`,`uniform vec3 lightHalfAngleVC${u}; // normalized`,`uniform vec3 lightPositionVC${u};`,`uniform vec3 lightAttenuation${u};`,`uniform float lightConeAngle${u};`,`uniform float lightExponent${u};`,`uniform int lightPositional${u};`]);o=te.substitute(o,"//VTK::Light::Dec",f).result,f=["vec3 diffuseL = vec3(0,0,0);","  vec3 specularL = vec3(0,0,0);","  vec3 vertLightDirectionVC;","  float attenuation;","  float df;"];for(let u=0;u<l;++u)f=f.concat(["  attenuation = 1.0;",`  if (lightPositional${u} == 0)`,"    {",`      vertLightDirectionVC = lightDirectionVC${u};`,"    }","  else","    {",`    vertLightDirectionVC = vertexVC.xyz - lightPositionVC${u};`,"    float distanceVC = length(vertLightDirectionVC);","    vertLightDirectionVC = normalize(vertLightDirectionVC);","    attenuation = 1.0 /",`      (lightAttenuation${u}.x`,`       + lightAttenuation${u}.y * distanceVC`,`       + lightAttenuation${u}.z * distanceVC * distanceVC);`,"    // per OpenGL standard cone angle is 90 or less for a spot light",`    if (lightConeAngle${u} <= 90.0)`,"      {",`      float coneDot = dot(vertLightDirectionVC, lightDirectionVC${u});`,"      // if inside the cone",`      if (coneDot >= cos(radians(lightConeAngle${u})))`,"        {",`        attenuation = attenuation * pow(coneDot, lightExponent${u});`,"        }","      else","        {","        attenuation = 0.0;","        }","      }","    }","    df = max(0.0, attenuation*dot(normalVCVSOutput, -vertLightDirectionVC));",`    diffuseL += ((df${s}) * lightColor${u});`,"    if (dot(normalVCVSOutput, vertLightDirectionVC) < 0.0)","      {",`      float sf = sign(df)*attenuation*pow(max(1e-5,
                                                           dot(reflect(lightDirectionVC${u},
                                                                       normalVCVSOutput),
                                                               normalize(-vertexVC.xyz))),
                                                       specularPower);`,`    specularL += ((sf${s}) * lightColor${u});`,"    }"]);f=f.concat(["  diffuseL = diffuseL * diffuseColor;","  specularL = specularL * specularColor;","  gl_FragData[0] = vec4(ambientColor * ambient + diffuseL * diffuse + specularL * specular, opacity);","  //VTK::Light::Impl"]),o=te.substitute(o,"//VTK::Light::Impl",f,!1).result;break;default:u0("bad light complexity")}r.Fragment=o},t.replaceShaderNormal=(r,i,a)=>{if(e.lastBoundBO.getReferenceByName("lastLightComplexity")>0){let s=r.Vertex,c=r.Geometry,l=r.Fragment;e.lastBoundBO.getCABO().getNormalOffset()?(s=te.substitute(s,"//VTK::Normal::Dec",["attribute vec3 normalMC;","uniform mat3 normalMatrix;","varying vec3 normalVCVSOutput;"]).result,s=te.substitute(s,"//VTK::Normal::Impl",["normalVCVSOutput = normalMatrix * normalMC;"]).result,c=te.substitute(c,"//VTK::Normal::Dec",["in vec3 normalVCVSOutput[];","out vec3 normalVCGSOutput;"]).result,c=te.substitute(c,"//VTK::Normal::Impl",["normalVCGSOutput = normalVCVSOutput[i];"]).result,l=te.substitute(l,"//VTK::Normal::Dec",["varying vec3 normalVCVSOutput;"]).result,l=te.substitute(l,"//VTK::Normal::Impl",["vec3 normalVCVSOutput = normalize(normalVCVSOutput);","  if (gl_FrontFacing == false) { normalVCVSOutput = -normalVCVSOutput; }"]).result):e.haveCellNormals?(l=te.substitute(l,"//VTK::Normal::Dec",["uniform mat3 normalMatrix;","uniform samplerBuffer textureN;"]).result,l=te.substitute(l,"//VTK::Normal::Impl",["vec3 normalVCVSOutput = normalize(normalMatrix *","    texelFetchBuffer(textureN, gl_PrimitiveID + PrimitiveIDOffset).xyz);","  if (gl_FrontFacing == false) { normalVCVSOutput = -normalVCVSOutput; }"]).result):e.lastBoundBO.getOpenGLMode(a.getProperty().getRepresentation())===e.context.LINES?(l=te.substitute(l,"//VTK::UniformFlow::Impl",["  vec3 fdx = dFdx(vertexVC.xyz);","  vec3 fdy = dFdy(vertexVC.xyz);","  //VTK::UniformFlow::Impl"]).result,l=te.substitute(l,"//VTK::Normal::Impl",["vec3 normalVCVSOutput;","  if (abs(fdx.x) > 0.0)","    { fdx = normalize(fdx); normalVCVSOutput = normalize(cross(vec3(fdx.y, -fdx.x, 0.0), fdx)); }","  else { fdy = normalize(fdy); normalVCVSOutput = normalize(cross(vec3(fdy.y, -fdy.x, 0.0), fdy));}"]).result):(l=te.substitute(l,"//VTK::Normal::Dec",["uniform int cameraParallel;"]).result,l=te.substitute(l,"//VTK::UniformFlow::Impl",["  vec3 fdx = dFdx(vertexVC.xyz);","  vec3 fdy = dFdy(vertexVC.xyz);","  //VTK::UniformFlow::Impl"]).result,l=te.substitute(l,"//VTK::Normal::Impl",["  fdx = normalize(fdx);","  fdy = normalize(fdy);","  vec3 normalVCVSOutput = normalize(cross(fdx,fdy));","  if (cameraParallel == 1 && normalVCVSOutput.z < 0.0) { normalVCVSOutput = -1.0*normalVCVSOutput; }","  if (cameraParallel == 0 && dot(normalVCVSOutput,vertexVC.xyz) > 0.0) { normalVCVSOutput = -1.0*normalVCVSOutput; }"]).result),r.Vertex=s,r.Geometry=c,r.Fragment=l}},t.replaceShaderPositionVC=(r,i,a)=>{e.lastBoundBO.replaceShaderPositionVC(r,i,a);let o=r.Vertex,s=r.Geometry,c=r.Fragment;e.lastBoundBO.getReferenceByName("lastLightComplexity")>0?(o=te.substitute(o,"//VTK::PositionVC::Dec",["varying vec4 vertexVCVSOutput;"]).result,o=te.substitute(o,"//VTK::PositionVC::Impl",["vertexVCVSOutput = MCVCMatrix * vertexMC;","  gl_Position = MCPCMatrix * vertexMC;"]).result,o=te.substitute(o,"//VTK::Camera::Dec",["uniform mat4 MCPCMatrix;","uniform mat4 MCVCMatrix;"]).result,s=te.substitute(s,"//VTK::PositionVC::Dec",["in vec4 vertexVCVSOutput[];","out vec4 vertexVCGSOutput;"]).result,s=te.substitute(s,"//VTK::PositionVC::Impl",["vertexVCGSOutput = vertexVCVSOutput[i];"]).result,c=te.substitute(c,"//VTK::PositionVC::Dec",["varying vec4 vertexVCVSOutput;"]).result,c=te.substitute(c,"//VTK::PositionVC::Impl",["vec4 vertexVC = vertexVCVSOutput;"]).result):(o=te.substitute(o,"//VTK::Camera::Dec",["uniform mat4 MCPCMatrix;"]).result,o=te.substitute(o,"//VTK::PositionVC::Impl",["  gl_Position = MCPCMatrix * vertexMC;"]).result),r.Vertex=o,r.Geometry=s,r.Fragment=c},t.replaceShaderTCoord=(r,i,a)=>{if(e.lastBoundBO.getCABO().getTCoordOffset()){let o=r.Vertex,s=r.Geometry,c=r.Fragment;if(e.drawingEdges)return;o=te.substitute(o,"//VTK::TCoord::Impl","tcoordVCVSOutput = tcoordMC;").result;const l=e.openGLActor.getActiveTextures();let f=2,u=2;if(l&&l.length>0&&(f=l[0].getComponents(),l[0].getTarget()===e.context.TEXTURE_CUBE_MAP&&(u=3)),e.renderable.getColorTextureMap()&&(f=e.renderable.getColorTextureMap().getPointData().getScalars().getNumberOfComponents(),u=2),u===2){if(o=te.substitute(o,"//VTK::TCoord::Dec","attribute vec2 tcoordMC; varying vec2 tcoordVCVSOutput;").result,s=te.substitute(s,"//VTK::TCoord::Dec",["in vec2 tcoordVCVSOutput[];","out vec2 tcoordVCGSOutput;"]).result,s=te.substitute(s,"//VTK::TCoord::Impl","tcoordVCGSOutput = tcoordVCVSOutput[i];").result,c=te.substitute(c,"//VTK::TCoord::Dec",["varying vec2 tcoordVCVSOutput;","uniform sampler2D texture1;"]).result,l&&l.length>=1)switch(f){case 1:c=te.substitute(c,"//VTK::TCoord::Impl",["  vec4 tcolor = texture2D(texture1, tcoordVCVSOutput);","  ambientColor = ambientColor*tcolor.r;","  diffuseColor = diffuseColor*tcolor.r;"]).result;break;case 2:c=te.substitute(c,"//VTK::TCoord::Impl",["  vec4 tcolor = texture2D(texture1, tcoordVCVSOutput);","  ambientColor = ambientColor*tcolor.r;","  diffuseColor = diffuseColor*tcolor.r;","  opacity = opacity * tcolor.g;"]).result;break;default:c=te.substitute(c,"//VTK::TCoord::Impl",["  vec4 tcolor = texture2D(texture1, tcoordVCVSOutput);","  ambientColor = ambientColor*tcolor.rgb;","  diffuseColor = diffuseColor*tcolor.rgb;","  opacity = opacity * tcolor.a;"]).result}}else switch(o=te.substitute(o,"//VTK::TCoord::Dec","attribute vec3 tcoordMC; varying vec3 tcoordVCVSOutput;").result,s=te.substitute(s,"//VTK::TCoord::Dec",["in vec3 tcoordVCVSOutput[];","out vec3 tcoordVCGSOutput;"]).result,s=te.substitute(s,"//VTK::TCoord::Impl","tcoordVCGSOutput = tcoordVCVSOutput[i];").result,c=te.substitute(c,"//VTK::TCoord::Dec",["varying vec3 tcoordVCVSOutput;","uniform samplerCube texture1;"]).result,f){case 1:c=te.substitute(c,"//VTK::TCoord::Impl",["  vec4 tcolor = textureCube(texture1, tcoordVCVSOutput);","  ambientColor = ambientColor*tcolor.r;","  diffuseColor = diffuseColor*tcolor.r;"]).result;break;case 2:c=te.substitute(c,"//VTK::TCoord::Impl",["  vec4 tcolor = textureCube(texture1, tcoordVCVSOutput);","  ambientColor = ambientColor*tcolor.r;","  diffuseColor = diffuseColor*tcolor.r;","  opacity = opacity * tcolor.g;"]).result;break;default:c=te.substitute(c,"//VTK::TCoord::Impl",["  vec4 tcolor = textureCube(texture1, tcoordVCVSOutput);","  ambientColor = ambientColor*tcolor.rgb;","  diffuseColor = diffuseColor*tcolor.rgb;","  opacity = opacity * tcolor.a;"]).result}r.Vertex=o,r.Geometry=s,r.Fragment=c}},t.replaceShaderClip=(r,i,a)=>{let o=r.Vertex,s=r.Fragment;if(e.renderable.getNumberOfClippingPlanes()){const c=e.renderable.getNumberOfClippingPlanes();o=te.substitute(o,"//VTK::Clip::Dec",["uniform int numClipPlanes;",`uniform vec4 clipPlanes[${c}];`,`varying float clipDistancesVSOutput[${c}];`]).result,o=te.substitute(o,"//VTK::Clip::Impl",[`for (int planeNum = 0; planeNum < ${c}; planeNum++)`,"    {","    if (planeNum >= numClipPlanes)","        {","        break;","        }","    clipDistancesVSOutput[planeNum] = dot(clipPlanes[planeNum], vertexMC);","    }"]).result,s=te.substitute(s,"//VTK::Clip::Dec",["uniform int numClipPlanes;",`varying float clipDistancesVSOutput[${c}];`]).result,s=te.substitute(s,"//VTK::Clip::Impl",[`for (int planeNum = 0; planeNum < ${c}; planeNum++)`,"    {","    if (planeNum >= numClipPlanes)","        {","        break;","        }","    if (clipDistancesVSOutput[planeNum] < 0.0) discard;","    }"]).result}r.Vertex=o,r.Fragment=s},t.getCoincidentParameters=(r,i)=>{let a={factor:0,offset:0};const o=i.getProperty();if(e.renderable.getResolveCoincidentTopology()==Wa.PolygonOffset||o.getEdgeVisibility()&&o.getRepresentation()===Cl.SURFACE){const c=e.lastBoundBO.getPrimitiveType();c===rr.Points||o.getRepresentation()===Cl.POINTS?a=e.renderable.getCoincidentTopologyPointOffsetParameter():c===rr.Lines||o.getRepresentation()===Cl.WIREFRAME?a=e.renderable.getCoincidentTopologyLineOffsetParameters():(c===rr.Tris||c===rr.TriStrips)&&(a=e.renderable.getCoincidentTopologyPolygonOffsetParameters()),(c===rr.TrisEdges||c===rr.TriStripsEdges)&&(a=e.renderable.getCoincidentTopologyPolygonOffsetParameters(),a.factor/=2,a.offset/=2)}const s=e._openGLRenderer.getSelector();return s&&s.getFieldAssociation()===L5.FIELD_ASSOCIATION_POINTS&&(a.offset-=2),a},t.replaceShaderPicking=(r,i,a)=>{let o=r.Fragment,s=r.Vertex;if(o=te.substitute(o,"//VTK::Picking::Dec",["uniform int picking;","//VTK::Picking::Dec"]).result,!!e._openGLRenderer.getSelector()){switch((e.lastSelectionState===ci.ID_LOW24||e.lastSelectionState===ci.ID_HIGH24)&&(s=te.substitute(s,"//VTK::Picking::Dec",[`flat out int vertexIDVSOutput;
`,`uniform int VertexIDOffset;
`]).result,s=te.substitute(s,"//VTK::Picking::Impl",`  vertexIDVSOutput = gl_VertexID + VertexIDOffset;
`).result,o=te.substitute(o,"//VTK::Picking::Dec",`flat in int vertexIDVSOutput;
`).result,o=te.substitute(o,"//VTK::Picking::Impl",["  int idx = vertexIDVSOutput;","//VTK::Picking::Impl"]).result),e.lastSelectionState){case ci.ID_LOW24:o=te.substitute(o,"//VTK::Picking::Impl","  gl_FragData[0] = vec4(float(idx%256)/255.0, float((idx/256)%256)/255.0, float((idx/65536)%256)/255.0, 1.0);").result;break;case ci.ID_HIGH24:o=te.substitute(o,"//VTK::Picking::Impl","  gl_FragData[0] = vec4(float((idx/16777216)%256)/255.0, 0.0, 0.0, 1.0);").result;break;default:o=te.substitute(o,"//VTK::Picking::Dec","uniform vec3 mapperIndex;").result,o=te.substitute(o,"//VTK::Picking::Impl","  gl_FragData[0] = picking != 0 ? vec4(mapperIndex,1.0) : gl_FragData[0];").result}r.Fragment=o,r.Vertex=s}},t.replaceShaderValues=(r,i,a)=>{if(t.replaceShaderColor(r,i,a),t.replaceShaderNormal(r,i,a),t.replaceShaderLight(r,i,a),t.replaceShaderTCoord(r,i,a),t.replaceShaderPicking(r,i,a),t.replaceShaderClip(r,i,a),t.replaceShaderCoincidentOffset(r,i,a),t.replaceShaderPositionVC(r,i,a),e.haveSeenDepthRequest){let o=r.Fragment;o=te.substitute(o,"//VTK::ZBuffer::Dec","uniform int depthRequest;").result,o=te.substitute(o,"//VTK::ZBuffer::Impl",["if (depthRequest == 1) {","float iz = floor(gl_FragCoord.z*65535.0 + 0.1);","float rf = floor(iz/256.0)/255.0;","float gf = mod(iz,256.0)/255.0;","gl_FragData[0] = vec4(rf, gf, 0.0, 1.0); }"]).result,r.Fragment=o}},t.getNeedToRebuildShaders=(r,i,a)=>{let o=0,s=0;const c=r.getPrimitiveType(),l=e.currentInput;let f=!1;const u=l.getPointData().getNormals(),g=l.getCellData().getNormals(),d=a.getProperty().getInterpolation()===P9.FLAT,h=a.getProperty().getRepresentation(),p=r.getOpenGLMode(h,c);if((p===e.context.TRIANGLES||g&&!u||!d&&u||!d&&p===e.context.LINES)&&(f=!0),a.getProperty().getLighting()&&f){o=0;const T=i.getLightsByReference();for(let C=0;C<T.length;++C){const w=T[C];w.getSwitch()>0&&(s++,o===0&&(o=1)),o===1&&(s>1||w.getIntensity()!==1||!w.lightTypeIsHeadLight())&&(o=2),o<3&&w.getPositional()&&(o=3)}}let m=!1;const v=e.lastBoundBO.getReferenceByName("lastLightComplexity"),y=e.lastBoundBO.getReferenceByName("lastLightCount");return(v!==o||y!==s)&&(e.lastBoundBO.set({lastLightComplexity:o},!0),e.lastBoundBO.set({lastLightCount:s},!0),m=!0),(!e.currentRenderPass&&e.lastRenderPassShaderReplacement||e.currentRenderPass&&e.currentRenderPass.getShaderReplacement()!==e.lastRenderPassShaderReplacement)&&(m=!0),e.lastHaveSeenDepthRequest!==e.haveSeenDepthRequest||r.getShaderSourceTime().getMTime()<e.renderable.getMTime()||r.getShaderSourceTime().getMTime()<e.currentInput.getMTime()||r.getShaderSourceTime().getMTime()<e.selectionStateChanged.getMTime()||m?(e.lastHaveSeenDepthRequest=e.haveSeenDepthRequest,!0):!1},t.invokeShaderCallbacks=(r,i,a)=>{const o=e.renderable.getViewSpecificProperties().ShadersCallbacks;o&&o.forEach(s=>{s.callback(s.userData,r,i,a)})},t.setMapperShaderParameters=(r,i,a)=>{if(r.getProgram().isUniformUsed("PrimitiveIDOffset")&&r.getProgram().setUniformi("PrimitiveIDOffset",e.primitiveIDOffset),r.getProgram().isUniformUsed("VertexIDOffset")&&r.getProgram().setUniformi("VertexIDOffset",e.vertexIDOffset),r.getCABO().getElementCount()&&(e.VBOBuildTime.getMTime()>r.getAttributeUpdateTime().getMTime()||r.getShaderSourceTime().getMTime()>r.getAttributeUpdateTime().getMTime())){const c=e.lastBoundBO.getReferenceByName("lastLightComplexity");r.getProgram().isAttributeUsed("vertexMC")&&(r.getVAO().addAttributeArray(r.getProgram(),r.getCABO(),"vertexMC",r.getCABO().getVertexOffset(),r.getCABO().getStride(),e.context.FLOAT,3,!1)||u0("Error setting vertexMC in shader VAO.")),r.getProgram().isAttributeUsed("normalMC")&&r.getCABO().getNormalOffset()&&c>0?r.getVAO().addAttributeArray(r.getProgram(),r.getCABO(),"normalMC",r.getCABO().getNormalOffset(),r.getCABO().getStride(),e.context.FLOAT,3,!1)||u0("Error setting normalMC in shader VAO."):r.getVAO().removeAttributeArray("normalMC"),e.renderable.getCustomShaderAttributes().forEach((l,f)=>{r.getProgram().isAttributeUsed(`${l}MC`)&&(r.getVAO().addAttributeArray(r.getProgram(),r.getCABO(),`${l}MC`,r.getCABO().getCustomData()[f].offset,r.getCABO().getStride(),e.context.FLOAT,r.getCABO().getCustomData()[f].components,!1)||u0(`Error setting ${l}MC in shader VAO.`))}),r.getProgram().isAttributeUsed("tcoordMC")&&r.getCABO().getTCoordOffset()?r.getVAO().addAttributeArray(r.getProgram(),r.getCABO(),"tcoordMC",r.getCABO().getTCoordOffset(),r.getCABO().getStride(),e.context.FLOAT,r.getCABO().getTCoordComponents(),!1)||u0("Error setting tcoordMC in shader VAO."):r.getVAO().removeAttributeArray("tcoordMC"),r.getProgram().isAttributeUsed("scalarColor")&&r.getCABO().getColorComponents()?r.getVAO().addAttributeArray(r.getProgram(),r.getCABO().getColorBO(),"scalarColor",r.getCABO().getColorOffset(),r.getCABO().getColorBOStride(),e.context.UNSIGNED_BYTE,4,!0)||u0("Error setting scalarColor in shader VAO."):r.getVAO().removeAttributeArray("scalarColor"),r.getAttributeUpdateTime().modified()}if(e.renderable.getNumberOfClippingPlanes()){const c=e.renderable.getNumberOfClippingPlanes(),l=[],u=r.getCABO().getCoordShiftAndScaleEnabled()?r.getCABO().getInverseShiftAndScaleMatrix():null,g=u?nn(e.tmpMat4,a.getMatrix()):a.getMatrix();u&&(ft(g,g),vt(g,g,u),ft(g,g));for(let d=0;d<c;d++){const h=[];e.renderable.getClippingPlaneInDataCoords(g,d,h);for(let p=0;p<4;p++)l.push(h[p])}r.getProgram().setUniformi("numClipPlanes",c),r.getProgram().setUniform4fv("clipPlanes",l)}e.internalColorTexture&&r.getProgram().isUniformUsed("texture1")&&r.getProgram().setUniformi("texture1",e.internalColorTexture.getTextureUnit());const o=e.openGLActor.getActiveTextures();if(o)for(let c=0;c<o.length;++c){const f=o[c].getTextureUnit(),u=`texture${f+1}`;r.getProgram().isUniformUsed(u)&&r.getProgram().setUniformi(u,f)}if(e.haveSeenDepthRequest&&r.getProgram().setUniformi("depthRequest",e.renderDepth?1:0),r.getProgram().isUniformUsed("coffset")){const c=t.getCoincidentParameters(i,a);r.getProgram().setUniformf("coffset",c.offset),r.getProgram().isUniformUsed("cfactor")&&r.getProgram().setUniformf("cfactor",c.factor)}r.setMapperShaderParameters(i,a,e._openGLRenderer.getTiledSizeAndOrigin());const s=e._openGLRenderer.getSelector();r.getProgram().setUniform3fArray("mapperIndex",s?s.getPropColorValue():[0,0,0]),r.getProgram().setUniformi("picking",s?s.getCurrentPass()+1:0)},t.setLightingShaderParameters=(r,i,a)=>{const o=e.lastBoundBO.getReferenceByName("lastLightComplexity");if(o<2)return;const s=r.getProgram();let c=0;const l=i.getLightsByReference();for(let g=0;g<l.length;++g){const d=l[g];if(d.getSwitch()>0){const p=d.getColorByReference(),m=d.getIntensity();e.lightColor[0]=p[0]*m,e.lightColor[1]=p[1]*m,e.lightColor[2]=p[2]*m;const v=d.getDirection(),y=i.getActiveCamera().getViewMatrix(),T=[...v];d.lightTypeIsSceneLight()&&(T[0]=y[0]*v[0]+y[1]*v[1]+y[2]*v[2],T[1]=y[4]*v[0]+y[5]*v[1]+y[6]*v[2],T[2]=y[8]*v[0]+y[9]*v[1]+y[10]*v[2],Z0(T)),e.lightDirection[0]=T[0],e.lightDirection[1]=T[1],e.lightDirection[2]=T[2],Z0(e.lightDirection),s.setUniform3fArray(`lightColor${c}`,e.lightColor),s.setUniform3fArray(`lightDirectionVC${c}`,e.lightDirection),c++}}if(o<3)return;const u=i.getActiveCamera().getViewMatrix();ft(u,u),c=0;for(let g=0;g<l.length;++g){const d=l[g];if(d.getSwitch()>0){const p=d.getTransformedPosition(),m=new Float64Array(3);pt(m,p,u),s.setUniform3fArray(`lightAttenuation${c}`,d.getAttenuationValuesByReference()),s.setUniformi(`lightPositional${c}`,d.getPositional()),s.setUniformf(`lightExponent${c}`,d.getExponent()),s.setUniformf(`lightConeAngle${c}`,d.getConeAngle()),s.setUniform3fArray(`lightPositionVC${c}`,[m[0],m[1],m[2]]),c++}}};function n(r,i,a){return i.identity(a),r.reduce((o,s,c)=>c===0?s?i.copy(o,s):i.identity(o):s?i.multiply(o,o,s):o,a)}t.setCameraShaderParameters=(r,i,a)=>{const o=r.getProgram(),s=e.openGLCamera.getKeyMatrices(i),c=i.getActiveCamera(),l=e.openGLCamera.getKeyMatrixTime().getMTime(),f=o.getLastCameraMTime(),g=r.getCABO().getCoordShiftAndScaleEnabled()?r.getCABO().getInverseShiftAndScaleMatrix():null,d=a.getIsIdentity(),h=d?{mcwc:null,normalMatrix:null}:e.openGLActor.getKeyMatrices();if(a.getCoordinateSystem()===AG.DISPLAY){const p=e._openGLRenderer.getTiledSizeAndOrigin();Be(e.tmpMat4),e.tmpMat4[0]=2/p.usize,e.tmpMat4[12]=-1,e.tmpMat4[5]=2/p.vsize,e.tmpMat4[13]=-1,vt(e.tmpMat4,e.tmpMat4,g),o.setUniformMatrix("MCPCMatrix",e.tmpMat4)}else o.setUniformMatrix("MCPCMatrix",n([s.wcpc,h.mcwc,g],Bg,e.tmpMat4));o.isUniformUsed("MCVCMatrix")&&o.setUniformMatrix("MCVCMatrix",n([s.wcvc,h.mcwc,g],Bg,e.tmpMat4)),o.isUniformUsed("normalMatrix")&&o.setUniformMatrix3x3("normalMatrix",n([s.normalMatrix,h.normalMatrix],PA,e.tmpMat3)),f!==l&&(o.isUniformUsed("cameraParallel")&&o.setUniformi("cameraParallel",c.getParallelProjection()),o.setLastCameraMTime(l)),d||o.setLastCameraMTime(0)},t.setPropertyShaderParameters=(r,i,a)=>{const o=r.getProgram();let s=a.getProperty(),c=s.getOpacity(),l=e.drawingEdges?s.getEdgeColorByReference():s.getAmbientColorByReference(),f=e.drawingEdges?s.getEdgeColorByReference():s.getDiffuseColorByReference(),u=e.drawingEdges?1:s.getAmbient(),g=e.drawingEdges?0:s.getDiffuse(),d=e.drawingEdges?0:s.getSpecular();const h=s.getSpecularPower();o.setUniformf("opacityUniform",c),o.setUniform3fArray("ambientColorUniform",l),o.setUniform3fArray("diffuseColorUniform",f),o.setUniformf("ambient",u),o.setUniformf("diffuse",g);const p=e.lastBoundBO.getReferenceByName("lastLightComplexity");if(p<1)return;let m=s.getSpecularColorByReference();if(o.setUniform3fArray("specularColorUniform",m),o.setUniformf("specularPowerUniform",h),o.setUniformf("specular",d),o.isUniformUsed("ambientIntensityBF")){if(s=a.getBackfaceProperty(),c=s.getOpacity(),l=s.getAmbientColor(),u=s.getAmbient(),f=s.getDiffuseColor(),g=s.getDiffuse(),m=s.getSpecularColor(),d=s.getSpecular(),o.setUniformf("ambientIntensityBF",u),o.setUniformf("diffuseIntensityBF",g),o.setUniformf("opacityUniformBF",c),o.setUniform3fArray("ambientColorUniformBF",l),o.setUniform3fArray("diffuseColorUniformBF",f),p<1)return;o.setUniformf("specularIntensityBF",d),o.setUniform3fArray("specularColorUniformBF",m),o.setUniformf("specularPowerUniformBF",h)}},t.updateMaximumPointCellIds=(r,i)=>{var s,c,l,f;const a=e._openGLRenderer.getSelector();if(!a)return;if((c=(s=e.selectionWebGLIdsToVTKIds)==null?void 0:s.points)!=null&&c.length){const u=e.selectionWebGLIdsToVTKIds.points.length;a.setMaximumPointId(u-1)}if((f=(l=e.selectionWebGLIdsToVTKIds)==null?void 0:l.cells)!=null&&f.length){const u=e.selectionWebGLIdsToVTKIds.cells.length;a.setMaximumCellId(u-1)}a.getFieldAssociation()===L5.FIELD_ASSOCIATION_POINTS&&(e.pointPicking=!0)},t.renderPieceStart=(r,i)=>{e.primitiveIDOffset=0,e.vertexIDOffset=0;const a=FG(e._openGLRenderer);if(e.lastSelectionState!==a&&(e.selectionStateChanged.modified(),e.lastSelectionState=a),e._openGLRenderer.getSelector())switch(a){default:e._openGLRenderer.getSelector().renderProp(i)}t.updateBufferObjects(r,i),e.renderable.getColorTextureMap()&&e.internalColorTexture.activate(),e.lastBoundBO=null},t.renderPieceDraw=(r,i)=>{const a=i.getProperty().getRepresentation(),o=i.getProperty().getEdgeVisibility()&&a===Cl.SURFACE,s=e._openGLRenderer.getSelector(),c=s&&s.getFieldAssociation()===L5.FIELD_ASSOCIATION_POINTS&&(e.lastSelectionState===ci.ID_LOW24||e.lastSelectionState===ci.ID_HIGH24);for(let l=rr.Start;l<rr.End;l++)e.primitives[l].setPointPicking(c),e.primitives[l].getCABO().getElementCount()&&(e.drawingEdges=o&&(l===rr.TrisEdges||l===rr.TriStripsEdges),(!e.drawingEdges||!(e.renderDepth||e.lastSelectionState>=0))&&(e.lastBoundBO=e.primitives[l],e.primitiveIDOffset+=e.primitives[l].drawArrays(r,i,a,t),e.vertexIDOffset+=e.primitives[l].getCABO().getElementCount()))},t.renderPieceFinish=(r,i)=>{e.LastBoundBO&&e.LastBoundBO.getVAO().release(),e.renderable.getColorTextureMap()&&e.internalColorTexture.deactivate()},t.renderPiece=(r,i)=>{if(t.invokeEvent(NG),e.renderable.getStatic()||e.renderable.update(),e.currentInput=e.renderable.getInputData(),t.invokeEvent(kG),!e.currentInput){u0("No input!");return}if(!e.currentInput.getPoints||!e.currentInput.getPoints().getNumberOfValues())return;const a=e.context,o=i.getProperty().getBackfaceCulling(),s=i.getProperty().getFrontfaceCulling();!o&&!s?e._openGLRenderWindow.disableCullFace():s?(e._openGLRenderWindow.enableCullFace(),a.cullFace(a.FRONT)):(e._openGLRenderWindow.enableCullFace(),a.cullFace(a.BACK)),t.renderPieceStart(r,i),t.renderPieceDraw(r,i),t.renderPieceFinish(r,i)},t.computeBounds=(r,i)=>{if(!t.getInput()){Xu(e.bounds);return}e.bounds=t.getInput().getBounds()},t.updateBufferObjects=(r,i)=>{t.getNeedToRebuildBufferObjects(r,i)&&t.buildBufferObjects(r,i),t.updateMaximumPointCellIds()},t.getNeedToRebuildBufferObjects=(r,i)=>{const a=e.VBOBuildTime.getMTime();return a<t.getMTime()||a<e.renderable.getMTime()||a<i.getMTime()||a<e.currentInput.getMTime()},t.buildBufferObjects=(r,i)=>{const a=e.currentInput;if(a===null)return;e.renderable.mapScalars(a,1);const o=e.renderable.getColorMapColors();e.haveCellScalars=!1;const s=e.renderable.getScalarMode();e.renderable.getScalarVisibility()&&(s===e1.USE_CELL_DATA||s===e1.USE_CELL_FIELD_DATA||s===e1.USE_FIELD_DATA||!a.getPointData().getScalars())&&s!==e1.USE_POINT_FIELD_DATA&&o&&(e.haveCellScalars=!0);let c=i.getProperty().getInterpolation()!==P9.FLAT?a.getPointData().getNormals():null;c===null&&a.getCellData().getNormals()&&(e.haveCellNormals=!0,c=a.getCellData().getNormals());const l=i.getProperty().getRepresentation();let f=a.getPointData().getTCoords();e.openGLActor.getActiveTextures()||(f=null);let u=!1;if(e.renderable.getColorCoordinates()){f=e.renderable.getColorCoordinates(),u=e.renderable.getAreScalarsMappedFromCells(),e.internalColorTexture||(e.internalColorTexture=Xt.newInstance({resizable:!0}));const d=e.internalColorTexture;d.setMinificationFilter(N9.NEAREST),d.setMagnificationFilter(N9.NEAREST),d.setWrapS(k9.CLAMP_TO_EDGE),d.setWrapT(k9.CLAMP_TO_EDGE),d.setOpenGLRenderWindow(e._openGLRenderWindow);const h=e.renderable.getColorTextureMap(),p=h.getExtent(),m=h.getPointData().getScalars();d.create2DFromRaw(p[1]-p[0]+1,p[3]-p[2]+1,m.getNumberOfComponents(),m.getDataType(),m.getData()),d.activate(),d.sendParameters(),d.deactivate()}const g=`${a.getMTime()}A${l}B${a.getMTime()}C${c?c.getMTime():1}D${o?o.getMTime():1}E${i.getProperty().getEdgeVisibility()}F${f?f.getMTime():1}`;if(e.VBOBuildString!==g){const h={points:a.getPoints(),normals:c,tcoords:f,colors:o,cellOffset:0,vertexOffset:0,useTCoordsPerCell:u,haveCellScalars:e.haveCellScalars,haveCellNormals:e.haveCellNormals,customAttributes:e.renderable.getCustomShaderAttributes().map(v=>a.getPointData().getArrayByName(v))};e.renderable.getPopulateSelectionSettings()&&(e.selectionWebGLIdsToVTKIds={points:null,cells:null});const p=[{inRep:"verts",cells:a.getVerts()},{inRep:"lines",cells:a.getLines()},{inRep:"polys",cells:a.getPolys()},{inRep:"strips",cells:a.getStrips()},{inRep:"polys",cells:a.getPolys()},{inRep:"strips",cells:a.getStrips()}],m=i.getProperty().getEdgeVisibility()&&l===Cl.SURFACE;for(let v=rr.Start;v<rr.End;v++)v!==rr.TrisEdges&&v!==rr.TriStripsEdges?(h.cellOffset+=e.primitives[v].getCABO().createVBO(p[v].cells,p[v].inRep,l,h,e.selectionWebGLIdsToVTKIds),h.vertexOffset+=e.primitives[v].getCABO().getElementCount()):m?e.primitives[v].getCABO().createVBO(p[v].cells,p[v].inRep,Cl.WIREFRAME,{...h,tcoords:null,colors:null,haveCellScalars:!1,haveCellNormals:!1}):e.primitives[v].releaseGraphicsResources();e.renderable.getPopulateSelectionSettings()&&e.renderable.setSelectionWebGLIdsToVTKIds(e.selectionWebGLIdsToVTKIds),e.VBOBuildString=g}e.VBOBuildTime.modified()},t.getAllocatedGPUMemoryInBytes=()=>{let r=0;return e.primitives.forEach(i=>{r+=i.getAllocatedGPUMemoryInBytes()}),r}}const BG={context:null,VBOBuildTime:0,VBOBuildString:null,primitives:null,primTypes:null,shaderRebuildString:null,tmpMat4:null,ambientColor:[],diffuseColor:[],specularColor:[],lightColor:[],lightDirection:[],lastHaveSeenDepthRequest:!1,haveSeenDepthRequest:!1,lastSelectionState:ci.MIN_KNOWN_PASS-1,selectionStateChanged:null,selectionWebGLIdsToVTKIds:null,pointPicking:!1};function NO(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,BG,n),Bt.extend(t,e,n),To.implementReplaceShaderCoincidentOffset(t,e,n),To.implementBuildShadersWithReplacements(t,e,n),e.primitives=[],e.primTypes=rr,e.tmpMat3=ya(new Float64Array(9)),e.tmpMat4=Be(new Float64Array(16));for(let r=rr.Start;r<rr.End;r++)e.primitives[r]=Oo.newInstance(),e.primitives[r].setPrimitiveType(r),e.primitives[r].set({lastLightComplexity:0,lastLightCount:0,lastSelectionPass:!1},!0);Vn(t,e,["context"]),e.VBOBuildTime={},zt(e.VBOBuildTime,{mtime:0}),e.selectionStateChanged={},zt(e.selectionStateChanged,{mtime:0}),UG(t,e)}const kO=Rt(NO,"vtkOpenGLPolyDataMapper");var x2={newInstance:kO,extend:NO};Wn("vtkMapper",kO);const{vtkErrorMacro:Tf}=Ir,{Representation:GG}=Yu,{ObjectType:t1}=ns,{PassTypes:$G}=H4,WG={type:"StartEvent"},zG={type:"EndEvent"};function jG(t,e){e.classHierarchy.push("vtkOpenGLGlyph3DMapper");const n={...t};t.renderPiece=(r,i)=>{if(t.invokeEvent(WG),e.renderable.getStatic()||e.renderable.update(),e.currentInput=e.renderable.getInputData(1),t.invokeEvent(zG),!e.currentInput){Tf("No input!");return}if(!e.currentInput.getPoints||!e.currentInput.getPoints().getNumberOfValues())return;const a=e.context;e._openGLRenderWindow.getWebgl2()?(e.hardwareSupport=!0,e.extension=null):e.extension||(e.extension=e.context.getExtension("ANGLE_instanced_arrays"),e.hardwareSupport=!!e.extension);const o=i.getProperty().getBackfaceCulling(),s=i.getProperty().getFrontfaceCulling();!o&&!s?e._openGLRenderWindow.disableCullFace():s?(e._openGLRenderWindow.enableCullFace(),a.cullFace(a.FRONT)):(e._openGLRenderWindow.enableCullFace(),a.cullFace(a.BACK)),t.renderPieceStart(r,i),t.renderPieceDraw(r,i),t.renderPieceFinish(r,i)},t.multiply4x4WithOffset=(r,i,a,o)=>{const s=i[0],c=i[1],l=i[2],f=i[3],u=i[4],g=i[5],d=i[6],h=i[7],p=i[8],m=i[9],v=i[10],y=i[11],T=i[12],C=i[13],w=i[14],x=i[15];let O=a[o],M=a[o+1],A=a[o+2],_=a[o+3];r[0]=O*s+M*u+A*p+_*T,r[1]=O*c+M*g+A*m+_*C,r[2]=O*l+M*d+A*v+_*w,r[3]=O*f+M*h+A*y+_*x,O=a[o+4],M=a[o+5],A=a[o+6],_=a[o+7],r[4]=O*s+M*u+A*p+_*T,r[5]=O*c+M*g+A*m+_*C,r[6]=O*l+M*d+A*v+_*w,r[7]=O*f+M*h+A*y+_*x,O=a[o+8],M=a[o+9],A=a[o+10],_=a[o+11],r[8]=O*s+M*u+A*p+_*T,r[9]=O*c+M*g+A*m+_*C,r[10]=O*l+M*d+A*v+_*w,r[11]=O*f+M*h+A*y+_*x,O=a[o+12],M=a[o+13],A=a[o+14],_=a[o+15],r[12]=O*s+M*u+A*p+_*T,r[13]=O*c+M*g+A*m+_*C,r[14]=O*l+M*d+A*v+_*w,r[15]=O*f+M*h+A*y+_*x},t.replaceShaderNormal=(r,i,a)=>{if(e.hardwareSupport&&e.lastBoundBO.getReferenceByName("lastLightComplexity")>0){let s=r.Vertex;e.lastBoundBO.getCABO().getNormalOffset()&&(s=te.substitute(s,"//VTK::Normal::Dec",["attribute vec3 normalMC;","attribute mat3 gNormal;","uniform mat3 normalMatrix;","varying vec3 normalVCVSOutput;"]).result,s=te.substitute(s,"//VTK::Normal::Impl",["normalVCVSOutput = normalMatrix * gNormal * normalMC;"]).result),r.Vertex=s}n.replaceShaderNormal(r,i,a)},t.replaceShaderColor=(r,i,a)=>{if(e.hardwareSupport&&e.renderable.getColorArray()){let o=r.Vertex,s=r.Geometry,c=r.Fragment;const l=e.lastBoundBO.getReferenceByName("lastLightComplexity");let f=["uniform float ambient;","uniform float diffuse;","uniform float specular;","uniform float opacityUniform; // the fragment opacity"];l&&(f=f.concat(["uniform vec3 specularColorUniform;","uniform float specularPowerUniform;"]));let u=["vec3 ambientColor;","  vec3 diffuseColor;","  float opacity;"];l&&(u=u.concat(["  vec3 specularColor;","  float specularPower;"])),u=u.concat(["  opacity = opacityUniform;"]),l&&(u=u.concat(["  specularColor = specularColorUniform;","  specularPower = specularPowerUniform;"])),e.drawingEdges||(f=f.concat(["varying vec4 vertexColorVSOutput;"]),o=te.substitute(o,"//VTK::Color::Dec",["attribute vec4 gColor;","varying vec4 vertexColorVSOutput;"]).result,o=te.substitute(o,"//VTK::Color::Impl",["vertexColorVSOutput = gColor;"]).result,s=te.substitute(s,"//VTK::Color::Dec",["in vec4 vertexColorVSOutput[];","out vec4 vertexColorGSOutput;"]).result,s=te.substitute(s,"//VTK::Color::Impl",["vertexColorGSOutput = vertexColorVSOutput[i];"]).result,u=u.concat(["  diffuseColor = vertexColorVSOutput.rgb;","  ambientColor = vertexColorVSOutput.rgb;","  opacity = opacity*vertexColorVSOutput.a;"])),c=te.substitute(c,"//VTK::Color::Impl",u).result,c=te.substitute(c,"//VTK::Color::Dec",f).result,r.Vertex=o,r.Geometry=s,r.Fragment=c}n.replaceShaderColor(r,i,a)},t.replaceShaderPositionVC=(r,i,a)=>{if(e.hardwareSupport){let o=r.Vertex;e.lastBoundBO.getReferenceByName("lastLightComplexity")>0?(o=te.substitute(o,"//VTK::PositionVC::Impl",["vec4 gVertexMC = gMatrix * vertexMC;","vertexVCVSOutput = MCVCMatrix * gVertexMC;","  gl_Position = MCPCMatrix * gVertexMC;"]).result,o=te.substitute(o,"//VTK::Camera::Dec",["attribute mat4 gMatrix;","uniform mat4 MCPCMatrix;","uniform mat4 MCVCMatrix;"]).result):(o=te.substitute(o,"//VTK::Camera::Dec",["attribute mat4 gMatrix;","uniform mat4 MCPCMatrix;"]).result,o=te.substitute(o,"//VTK::PositionVC::Impl",["vec4 gVertexMC = gMatrix * vertexMC;","  gl_Position = MCPCMatrix * gVertexMC;"]).result),r.Vertex=o}n.replaceShaderPositionVC(r,i,a)},t.replaceShaderPicking=(r,i,a)=>{if(e.hardwareSupport){let o=r.Fragment,s=r.Vertex;s=te.substitute(s,"//VTK::Picking::Dec",["attribute vec3 mapperIndexVS;","varying vec3 mapperIndexVSOutput;"]).result,s=te.substitute(s,"//VTK::Picking::Impl","  mapperIndexVSOutput = mapperIndexVS;").result,r.Vertex=s,o=te.substitute(o,"//VTK::Picking::Dec",["varying vec3 mapperIndexVSOutput;","uniform vec3 mapperIndex;","uniform int picking;"]).result,o=te.substitute(o,"//VTK::Picking::Impl",["  vec4 pickColor = picking == 2 ? vec4(mapperIndexVSOutput,1.0) : vec4(mapperIndex,1.0);","  gl_FragData[0] = picking != 0 ? pickColor : gl_FragData[0];"]).result,r.Fragment=o}else n.replaceShaderPicking(r,i,a)},t.updateGlyphShaderParameters=(r,i,a,o,s,c,l,f)=>{const u=a.getProgram();if(r){const g=e.normalMatrix,d=c,h=l*9,p=e.tmpMat3,m=g[0],v=g[1],y=g[2],T=g[3],C=g[4],w=g[5],x=g[6],O=g[7],M=g[8],A=d[h],_=d[h+1],k=d[h+2],z=d[h+3],X=d[h+4],Z=d[h+5],ce=d[h+6],J=d[h+7],de=d[h+8];p[0]=A*m+_*T+k*x,p[1]=A*v+_*C+k*O,p[2]=A*y+_*w+k*M,p[3]=z*m+X*T+Z*x,p[4]=z*v+X*C+Z*O,p[5]=z*y+X*w+Z*M,p[6]=ce*m+J*T+de*x,p[7]=ce*v+J*C+de*O,p[8]=ce*y+J*w+de*M,u.setUniformMatrix3x3("normalMatrix",e.tmpMat3)}if(t.multiply4x4WithOffset(e.tmpMat4,e.mcpcMatrix,s,l*16),u.setUniformMatrix("MCPCMatrix",e.tmpMat4),i&&(t.multiply4x4WithOffset(e.tmpMat4,e.mcvcMatrix,s,l*16),u.setUniformMatrix("MCVCMatrix",e.tmpMat4)),o){const g=o.getData();e.tmpColor[0]=g[l*4]/255,e.tmpColor[1]=g[l*4+1]/255,e.tmpColor[2]=g[l*4+2]/255,u.setUniform3fArray("ambientColorUniform",e.tmpColor),u.setUniform3fArray("diffuseColorUniform",e.tmpColor)}f&&u.setUniform3fArray("mapperIndex",f.getPropColorValue())},t.renderPieceDraw=(r,i)=>{const a=i.getProperty().getRepresentation(),o=e.context,s=i.getProperty().getEdgeVisibility()&&a===GG.SURFACE,c=e.openGLCamera.getKeyMatrices(r),l=e.openGLActor.getKeyMatrices();Du(e.normalMatrix,c.normalMatrix,l.normalMatrix),vt(e.mcpcMatrix,c.wcpc,l.mcwc),vt(e.mcvcMatrix,c.wcvc,l.mcwc);const f=e.renderable.getMatrixArray(),u=e.renderable.getNormalArray(),g=e.renderable.getColorArray(),d=f.length/16;let h=!1;e._openGLRenderer.getSelector()&&e._openGLRenderer.getSelector().getCurrentPass()===$G.COMPOSITE_INDEX_PASS&&(h=!0);for(let p=e.primTypes.Start;p<e.primTypes.End;p++){const m=e.primitives[p].getCABO();if(m.getElementCount()){e.drawingEdges=s&&(p===e.primTypes.TrisEdges||p===e.primTypes.TriStripsEdges),e.lastBoundBO=e.primitives[p],e.primitives[p].updateShaders(r,i,t);const v=e.primitives[p].getProgram(),y=e.primitives[p].getOpenGLMode(a),T=v.isUniformUsed("normalMatrix"),C=v.isUniformUsed("MCVCMatrix");if(e.hardwareSupport)e.extension?e.extension.drawArraysInstancedANGLE(y,0,m.getElementCount(),d):o.drawArraysInstanced(y,0,m.getElementCount(),d);else for(let w=0;w<d;++w)h&&e._openGLRenderer.getSelector().renderCompositeIndex(w),t.updateGlyphShaderParameters(T,C,e.primitives[p],g,f,u,w,h?e._openGLRenderer.getSelector():null),o.drawArrays(y,0,m.getElementCount())}}},t.setMapperShaderParameters=(r,i,a)=>{if(r.getCABO().getElementCount()&&(e.glyphBOBuildTime.getMTime()>r.getAttributeUpdateTime().getMTime()||r.getShaderSourceTime().getMTime()>r.getAttributeUpdateTime().getMTime())){r.getProgram().isAttributeUsed("gMatrix")?r.getVAO().addAttributeMatrixWithDivisor(r.getProgram(),e.matrixBuffer,"gMatrix",0,64,e.context.FLOAT,4,!1,1)||Tf("Error setting gMatrix in shader VAO."):r.getVAO().removeAttributeArray("gMatrix"),r.getProgram().isAttributeUsed("gNormal")?r.getVAO().addAttributeMatrixWithDivisor(r.getProgram(),e.normalBuffer,"gNormal",0,36,e.context.FLOAT,3,!1,1)||Tf("Error setting gNormal in shader VAO."):r.getVAO().removeAttributeArray("gNormal"),r.getProgram().isAttributeUsed("gColor")?r.getVAO().addAttributeArrayWithDivisor(r.getProgram(),e.colorBuffer,"gColor",0,4,e.context.UNSIGNED_BYTE,4,!0,1,!1)||Tf("Error setting gColor in shader VAO."):r.getVAO().removeAttributeArray("gColor"),r.getProgram().isAttributeUsed("mapperIndexVS")?r.getVAO().addAttributeArrayWithDivisor(r.getProgram(),e.pickBuffer,"mapperIndexVS",0,4,e.context.UNSIGNED_BYTE,4,!0,1,!1)||Tf("Error setting mapperIndexVS in shader VAO."):r.getVAO().removeAttributeArray("mapperIndexVS"),n.setMapperShaderParameters(r,i,a),r.getAttributeUpdateTime().modified();return}n.setMapperShaderParameters(r,i,a)},t.getNeedToRebuildBufferObjects=(r,i)=>(e.renderable.buildArrays(),e.VBOBuildTime.getMTime()<e.renderable.getBuildTime().getMTime()?!0:n.getNeedToRebuildBufferObjects(r,i)),t.getNeedToRebuildShaders=(r,i,a)=>!!(n.getNeedToRebuildShaders(r,i,a)||r.getShaderSourceTime().getMTime()<e.renderable.getMTime()||r.getShaderSourceTime().getMTime()<e.currentInput.getMTime()),t.buildBufferObjects=(r,i)=>{if(e.hardwareSupport){const a=e.renderable.getMatrixArray(),o=e.renderable.getNormalArray(),s=e.renderable.getColorArray();if(e.matrixBuffer||(e.matrixBuffer=ns.newInstance(),e.matrixBuffer.setOpenGLRenderWindow(e._openGLRenderWindow),e.normalBuffer=ns.newInstance(),e.normalBuffer.setOpenGLRenderWindow(e._openGLRenderWindow),e.colorBuffer=ns.newInstance(),e.colorBuffer.setOpenGLRenderWindow(e._openGLRenderWindow),e.pickBuffer=ns.newInstance(),e.pickBuffer.setOpenGLRenderWindow(e._openGLRenderWindow)),e.renderable.getBuildTime().getMTime()>e.glyphBOBuildTime.getMTime()){e.matrixBuffer.upload(a,t1.ARRAY_BUFFER),e.normalBuffer.upload(o,t1.ARRAY_BUFFER),s?e.colorBuffer.upload(s.getData(),t1.ARRAY_BUFFER):e.colorBuffer.releaseGraphicsResources();const c=a.length/16,l=new Uint8Array(4*c);for(let f=0;f<c;++f){let u=f+1;const g=f*4;l[g]=u%256,u-=l[g],u/=256,l[g+1]=u%256,u-=l[g+1],u/=256,l[g+2]=u%256,l[g+3]=255}e.pickBuffer.upload(l,t1.ARRAY_BUFFER),e.glyphBOBuildTime.modified()}}return n.buildBufferObjects(r,i)}}const HG={normalMatrix:null,mcpcMatrix:null,mcwcMatrix:null};function KG(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,HG,n),x2.extend(t,e,n),e.tmpMat3=ya(new Float64Array(9)),e.normalMatrix=ya(new Float64Array(9)),e.mcpcMatrix=Be(new Float64Array(16)),e.mcvcMatrix=Be(new Float64Array(16)),e.tmpColor=[],e.glyphBOBuildTime={},zt(e.glyphBOBuildTime,{mtime:0}),jG(t,e)}const AO=Rt(KG,"vtkOpenGLGlyph3DMapper");var qG={newInstance:AO};Wn("vtkGlyph3DMapper",AO);const XG={NONE:-1,I:0,J:1,K:2,X:3,Y:4,Z:5};var S2={SlicingMode:XG};const B0={NEAREST:0,LINEAR:1};var YG={InterpolationType:B0};function Co(t,e,n){return t?`${t.getMTime()}-${e}-${n}`:"0"}function oy(t,e){return`${t.getMTime()}A${e.getMTime()}`}const{vtkErrorMacro:wl}=Ir,{SlicingMode:Fi}=S2;function ZG(t){const e=t.split(`
`),n=[];for(let r=0;r<e.length;++r){const i=e[r].trim();i.length>0&&n.push(i)}return n}function QG(t,e){e.classHierarchy.push("vtkOpenGLImageMapper");function n(r){e.openGLTexture.releaseGraphicsResources(r),[e._colorTransferFunc,e._pwFunc,e._labelOutlineThicknessArray].forEach(i=>r.unregisterGraphicsResourceUser(i,t))}t.buildPass=r=>{if(r){e.currentRenderPass=null,e.openGLImageSlice=t.getFirstAncestorOfType("vtkOpenGLImageSlice"),e._openGLRenderer=t.getFirstAncestorOfType("vtkOpenGLRenderer");const i=e._openGLRenderWindow;e._openGLRenderWindow=e._openGLRenderer.getLastAncestorOfType("vtkOpenGLRenderWindow"),i&&!i.isDeleted()&&i!==e._openGLRenderWindow&&n(i),e.context=e._openGLRenderWindow.getContext(),e.tris.setOpenGLRenderWindow(e._openGLRenderWindow);const a=e._openGLRenderer.getRenderable();e.openGLCamera=e._openGLRenderer.getViewNodeFor(a.getActiveCamera()),e.renderable.isA("vtkImageMapper")&&e.renderable.getSliceAtFocalPoint()&&e.renderable.setSliceFromCamera(a.getActiveCamera())}},t.translucentPass=(r,i)=>{r&&(e.currentRenderPass=i,t.render())},t.zBufferPass=r=>{r&&(e.haveSeenDepthRequest=!0,e.renderDepth=!0,t.render(),e.renderDepth=!1)},t.opaqueZBufferPass=r=>t.zBufferPass(r),t.opaquePass=r=>{r&&t.render()},t.getCoincidentParameters=(r,i)=>e.renderable.getResolveCoincidentTopology()==Wa.PolygonOffset?e.renderable.getCoincidentTopologyPolygonOffsetParameters():null,t.render=()=>{const r=e.openGLImageSlice.getRenderable(),i=e._openGLRenderer.getRenderable();t.renderPiece(i,r)},t.getShaderTemplate=(r,i,a)=>{r.Vertex=ay,r.Fragment=yd,r.Geometry=""},t.replaceShaderValues=(r,i,a)=>{let o=r.Vertex,s=r.Fragment;o=te.substitute(o,"//VTK::Camera::Dec",["uniform mat4 MCPCMatrix;"]).result,o=te.substitute(o,"//VTK::PositionVC::Impl",["  gl_Position = MCPCMatrix * vertexMC;"]).result,o=te.substitute(o,"//VTK::TCoord::Impl","tcoordVCVSOutput = tcoordMC;").result,o=te.substitute(o,"//VTK::TCoord::Dec","attribute vec2 tcoordMC; varying vec2 tcoordVCVSOutput;").result;const c=e.openGLTexture.getComponents(),l=a.getProperty().getIndependentComponents();let f=["varying vec2 tcoordVCVSOutput;","uniform float cshift0;","uniform float cscale0;","uniform float pwfshift0;","uniform float pwfscale0;","uniform sampler2D texture1;","uniform sampler2D colorTexture1;","uniform sampler2D pwfTexture1;","uniform sampler2D labelOutlineTexture1;","uniform float opacity;","uniform float outlineOpacity;"];if(l){for(let g=1;g<c;g++)f=f.concat([`uniform float cshift${g};`,`uniform float cscale${g};`,`uniform float pwfshift${g};`,`uniform float pwfscale${g};`]);switch(c){case 1:f=f.concat(["uniform float mix0;","#define height0 0.5"]);break;case 2:f=f.concat(["uniform float mix0;","uniform float mix1;","#define height0 0.25","#define height1 0.75"]);break;case 3:f=f.concat(["uniform float mix0;","uniform float mix1;","uniform float mix2;","#define height0 0.17","#define height1 0.5","#define height2 0.83"]);break;case 4:f=f.concat(["uniform float mix0;","uniform float mix1;","uniform float mix2;","uniform float mix3;","#define height0 0.125","#define height1 0.375","#define height2 0.625","#define height3 0.875"]);break;default:wl("Unsupported number of independent coordinates.")}}if(s=te.substitute(s,"//VTK::TCoord::Dec",f).result,a.getProperty().getUseLabelOutline()===!0&&(s=te.substitute(s,"//VTK::LabelOutline::Dec",["uniform int outlineThickness;","uniform float vpWidth;","uniform float vpHeight;","uniform float vpOffsetX;","uniform float vpOffsetY;","uniform mat4 PCWCMatrix;","uniform mat4 vWCtoIDX;","uniform ivec3 imageDimensions;","uniform int sliceAxis;"]).result,s=te.substitute(s,"//VTK::ImageLabelOutlineOn","#define vtkImageLabelOutlineOn").result,s=te.substitute(s,"//VTK::LabelOutlineHelperFunction",["#ifdef vtkImageLabelOutlineOn","vec3 fragCoordToIndexSpace(vec4 fragCoord) {","  vec4 pcPos = vec4(","    (fragCoord.x / vpWidth - vpOffsetX - 0.5) * 2.0,","    (fragCoord.y / vpHeight - vpOffsetY - 0.5) * 2.0,","    (fragCoord.z - 0.5) * 2.0,","    1.0);","","  vec4 worldCoord = PCWCMatrix * pcPos;","  vec4 vertex = (worldCoord/worldCoord.w);","","  vec3 index = (vWCtoIDX * vertex).xyz;","","  // half voxel fix for labelmapOutline","  return (index + vec3(0.5)) / vec3(imageDimensions);","}","vec2 getSliceCoords(vec3 coord, int axis) {","  if (axis == 0) return coord.yz;","  if (axis == 1) return coord.xz;","  if (axis == 2) return coord.xy;","}","#endif"]).result),l){const g=["r","g","b","a"];let d=["vec4 tvalue = texture2D(texture1, tcoordVCVSOutput);"];for(let h=0;h<c;h++)d=d.concat([`vec3 tcolor${h} = mix${h} * texture2D(colorTexture1, vec2(tvalue.${g[h]} * cscale${h} + cshift${h}, height${h})).rgb;`,`float compWeight${h} = mix${h} * texture2D(pwfTexture1, vec2(tvalue.${g[h]} * pwfscale${h} + pwfshift${h}, height${h})).r;`]);switch(c){case 1:d=d.concat(["gl_FragData[0] = vec4(tcolor0.rgb, opacity);"]);break;case 2:d=d.concat(["float weightSum = compWeight0 + compWeight1;","gl_FragData[0] = vec4(vec3((tcolor0.rgb * (compWeight0 / weightSum)) + (tcolor1.rgb * (compWeight1 / weightSum))), opacity);"]);break;case 3:d=d.concat(["float weightSum = compWeight0 + compWeight1 + compWeight2;","gl_FragData[0] = vec4(vec3((tcolor0.rgb * (compWeight0 / weightSum)) + (tcolor1.rgb * (compWeight1 / weightSum)) + (tcolor2.rgb * (compWeight2 / weightSum))), opacity);"]);break;case 4:d=d.concat(["float weightSum = compWeight0 + compWeight1 + compWeight2 + compWeight3;","gl_FragData[0] = vec4(vec3((tcolor0.rgb * (compWeight0 / weightSum)) + (tcolor1.rgb * (compWeight1 / weightSum)) + (tcolor2.rgb * (compWeight2 / weightSum)) + (tcolor3.rgb * (compWeight3 / weightSum))), opacity);"]);break;default:wl("Unsupported number of independent coordinates.")}s=te.substitute(s,"//VTK::TCoord::Impl",d).result}else switch(c){case 1:s=te.substitute(s,"//VTK::TCoord::Impl",[...ZG(`
                #ifdef vtkImageLabelOutlineOn
                  vec3 centerPosIS = fragCoordToIndexSpace(gl_FragCoord);
                  float centerValue = texture2D(texture1, getSliceCoords(centerPosIS, sliceAxis)).r;
                  bool pixelOnBorder = false;
                  vec3 tColor = texture2D(colorTexture1, vec2(centerValue * cscale0 + cshift0, 0.5)).rgb;
                  float scalarOpacity = texture2D(pwfTexture1, vec2(centerValue * pwfscale0 + pwfshift0, 0.5)).r;
                  float opacityToUse = scalarOpacity * opacity;
                  int segmentIndex = int(centerValue * 255.0);
                  float textureCoordinate = float(segmentIndex - 1) / 1024.0;
                  float textureValue = texture2D(labelOutlineTexture1, vec2(textureCoordinate, 0.5)).r;
                  int actualThickness = int(textureValue * 255.0);

                  if (segmentIndex == 0){
                    gl_FragData[0] = vec4(0.0, 0.0, 0.0, 0.0);
                    return;
                  }

                  for (int i = -actualThickness; i <= actualThickness; i++) {
                    for (int j = -actualThickness; j <= actualThickness; j++) {
                      if (i == 0 || j == 0) {
                        continue;
                      }
                      vec4 neighborPixelCoord = vec4(gl_FragCoord.x + float(i),
                        gl_FragCoord.y + float(j),
                        gl_FragCoord.z, gl_FragCoord.w);
                      vec3 neighborPosIS = fragCoordToIndexSpace(neighborPixelCoord);
                      float value = texture2D(texture1, getSliceCoords(neighborPosIS, sliceAxis)).r;
                      if (value != centerValue) {
                        pixelOnBorder = true;
                        break;
                      }
                    }
                    if (pixelOnBorder == true) {
                      break;
                    }
                  }
                  if (pixelOnBorder == true) {
                    gl_FragData[0] = vec4(tColor, outlineOpacity);
                  }
                  else {
                    gl_FragData[0] = vec4(tColor, opacityToUse);
                  }
                #else
                  float intensity = texture2D(texture1, tcoordVCVSOutput).r;
                  vec3 tcolor = texture2D(colorTexture1, vec2(intensity * cscale0 + cshift0, 0.5)).rgb;
                  float scalarOpacity = texture2D(pwfTexture1, vec2(intensity * pwfscale0 + pwfshift0, 0.5)).r;
                  gl_FragData[0] = vec4(tcolor, scalarOpacity * opacity);
                #endif
                `)]).result;break;case 2:s=te.substitute(s,"//VTK::TCoord::Impl",["vec4 tcolor = texture2D(texture1, tcoordVCVSOutput);","float intensity = tcolor.r*cscale0 + cshift0;","gl_FragData[0] = vec4(texture2D(colorTexture1, vec2(intensity, 0.5)).rgb, pwfscale0*tcolor.g + pwfshift0);"]).result;break;case 3:s=te.substitute(s,"//VTK::TCoord::Impl",["vec4 tcolor = cscale0*texture2D(texture1, tcoordVCVSOutput.st) + cshift0;","gl_FragData[0] = vec4(texture2D(colorTexture1, vec2(tcolor.r,0.5)).r,","  texture2D(colorTexture1, vec2(tcolor.g,0.5)).r,","  texture2D(colorTexture1, vec2(tcolor.b,0.5)).r, opacity);"]).result;break;default:s=te.substitute(s,"//VTK::TCoord::Impl",["vec4 tcolor = cscale0*texture2D(texture1, tcoordVCVSOutput.st) + cshift0;","gl_FragData[0] = vec4(texture2D(colorTexture1, vec2(tcolor.r,0.5)).r,","  texture2D(colorTexture1, vec2(tcolor.g,0.5)).r,","  texture2D(colorTexture1, vec2(tcolor.b,0.5)).r, tcolor.a);"]).result}e.haveSeenDepthRequest&&(s=te.substitute(s,"//VTK::ZBuffer::Dec","uniform int depthRequest;").result,s=te.substitute(s,"//VTK::ZBuffer::Impl",["if (depthRequest == 1) {","float iz = floor(gl_FragCoord.z*65535.0 + 0.1);","float rf = floor(iz/256.0)/255.0;","float gf = mod(iz,256.0)/255.0;","gl_FragData[0] = vec4(rf, gf, 0.0, 1.0); }"]).result),r.Vertex=o,r.Fragment=s,t.replaceShaderClip(r,i,a),t.replaceShaderCoincidentOffset(r,i,a)},t.replaceShaderClip=(r,i,a)=>{let o=r.Vertex,s=r.Fragment;if(e.renderable.getNumberOfClippingPlanes()){let c=e.renderable.getNumberOfClippingPlanes();c>6&&(mt("OpenGL has a limit of 6 clipping planes"),c=6),o=te.substitute(o,"//VTK::Clip::Dec",["uniform int numClipPlanes;","uniform vec4 clipPlanes[6];","varying float clipDistancesVSOutput[6];"]).result,o=te.substitute(o,"//VTK::Clip::Impl",["for (int planeNum = 0; planeNum < 6; planeNum++)","    {","    if (planeNum >= numClipPlanes)","        {","        break;","        }","    clipDistancesVSOutput[planeNum] = dot(clipPlanes[planeNum], vertexMC);","    }"]).result,s=te.substitute(s,"//VTK::Clip::Dec",["uniform int numClipPlanes;","varying float clipDistancesVSOutput[6];"]).result,s=te.substitute(s,"//VTK::Clip::Impl",["for (int planeNum = 0; planeNum < 6; planeNum++)","    {","    if (planeNum >= numClipPlanes)","        {","        break;","        }","    if (clipDistancesVSOutput[planeNum] < 0.0) discard;","    }"]).result}r.Vertex=o,r.Fragment=s},t.getNeedToRebuildShaders=(r,i,a)=>{var l;const o=e.openGLTexture.getComponents(),s=a.getProperty().getIndependentComponents();let c=!1;return(!e.currentRenderPass&&e.lastRenderPassShaderReplacement||e.currentRenderPass&&e.currentRenderPass.getShaderReplacement()!==e.lastRenderPassShaderReplacement)&&(c=!0),c||e.lastHaveSeenDepthRequest!==e.haveSeenDepthRequest||((l=r.getProgram())==null?void 0:l.getHandle())===0||e.lastTextureComponents!==o||e.lastIndependentComponents!==s?(e.lastHaveSeenDepthRequest=e.haveSeenDepthRequest,e.lastTextureComponents=o,e.lastIndependentComponents=s,!0):!1},t.updateShaders=(r,i,a)=>{if(e.lastBoundBO=r,t.getNeedToRebuildShaders(r,i,a)){const o={Vertex:null,Fragment:null,Geometry:null};t.buildShaders(o,i,a);const s=e._openGLRenderWindow.getShaderCache().readyShaderProgramArray(o.Vertex,o.Fragment,o.Geometry);s!==r.getProgram()&&(r.setProgram(s),r.getVAO().releaseGraphicsResources()),r.getShaderSourceTime().modified()}else e._openGLRenderWindow.getShaderCache().readyShaderProgram(r.getProgram());r.getVAO().bind(),t.setMapperShaderParameters(r,i,a),t.setCameraShaderParameters(r,i,a),t.setPropertyShaderParameters(r,i,a)},t.setMapperShaderParameters=(r,i,a)=>{r.getCABO().getElementCount()&&(e.VBOBuildTime>r.getAttributeUpdateTime().getMTime()||r.getShaderSourceTime().getMTime()>r.getAttributeUpdateTime().getMTime())&&(r.getProgram().isAttributeUsed("vertexMC")&&(r.getVAO().addAttributeArray(r.getProgram(),r.getCABO(),"vertexMC",r.getCABO().getVertexOffset(),r.getCABO().getStride(),e.context.FLOAT,3,e.context.FALSE)||wl("Error setting vertexMC in shader VAO.")),r.getProgram().isAttributeUsed("tcoordMC")&&r.getCABO().getTCoordOffset()&&(r.getVAO().addAttributeArray(r.getProgram(),r.getCABO(),"tcoordMC",r.getCABO().getTCoordOffset(),r.getCABO().getStride(),e.context.FLOAT,r.getCABO().getTCoordComponents(),e.context.FALSE)||wl("Error setting tcoordMC in shader VAO.")),r.getAttributeUpdateTime().modified());const o=e.openGLTexture.getTextureUnit();r.getProgram().setUniformi("texture1",o);const s=e.openGLTexture.getComponents(),c=a.getProperty().getIndependentComponents();if(c)for(let h=0;h<s;h++)r.getProgram().setUniformf(`mix${h}`,a.getProperty().getComponentWeight(h));const l=e.openGLTexture.getShiftAndScale();for(let h=0;h<s;h++){let p=a.getProperty().getColorWindow(),m=a.getProperty().getColorLevel();const v=c?h:0,y=a.getProperty().getRGBTransferFunction(v);if(y&&a.getProperty().getUseLookupTableScalarRange()){const w=y.getRange();p=w[1]-w[0],m=.5*(w[1]+w[0])}const T=l.scale/p,C=(l.shift-m)/p+.5;r.getProgram().setUniformf(`cshift${h}`,C),r.getProgram().setUniformf(`cscale${h}`,T)}for(let h=0;h<s;h++){let p=1,m=0;const v=c?h:0,y=a.getProperty().getPiecewiseFunction(v);if(y){const T=y.getRange(),C=T[1]-T[0],w=.5*(T[0]+T[1]);p=l.scale/C,m=(l.shift-w)/C+.5}r.getProgram().setUniformf(`pwfshift${h}`,m),r.getProgram().setUniformf(`pwfscale${h}`,p)}if(e.haveSeenDepthRequest&&r.getProgram().setUniformi("depthRequest",e.renderDepth?1:0),r.getProgram().isUniformUsed("coffset")){const h=t.getCoincidentParameters(i,a);r.getProgram().setUniformf("coffset",h.offset),r.getProgram().isUniformUsed("cfactor")&&r.getProgram().setUniformf("cfactor",h.factor)}const f=e.colorTexture.getTextureUnit();r.getProgram().setUniformi("colorTexture1",f);const u=e.pwfTexture.getTextureUnit();r.getProgram().setUniformi("pwfTexture1",u);const g=e.labelOutlineThicknessTexture.getTextureUnit();if(r.getProgram().setUniformi("labelOutlineTexture1",g),e.renderable.getNumberOfClippingPlanes()){let h=e.renderable.getNumberOfClippingPlanes();h>6&&(mt("OpenGL has a limit of 6 clipping planes"),h=6);const m=r.getCABO().getCoordShiftAndScaleEnabled()?r.getCABO().getInverseShiftAndScaleMatrix():null,v=m?nn(e.imagematinv,a.getMatrix()):a.getMatrix();m&&(ft(v,v),vt(v,v,m),ft(v,v)),ft(e.imagemat,e.currentInput.getIndexToWorld()),vt(e.imagematinv,v,e.imagemat);const y=[];for(let T=0;T<h;T++){const C=[];e.renderable.getClippingPlaneInDataCoords(e.imagematinv,T,C);for(let w=0;w<4;w++)y.push(C[w])}r.getProgram().setUniformi("numClipPlanes",h),r.getProgram().setUniform4fv("clipPlanes",y)}if(a.getProperty().getUseLabelOutline()===!0){const h=a.getProperty().getLabelOutlineOpacity();r.getProgram().setUniformf("outlineOpacity",h)}},t.setCameraShaderParameters=(r,i,a)=>{const o=r.getProgram(),s=e.openGLImageSlice.getKeyMatrices(),c=e.currentInput,l=c.getIndexToWorld();vt(e.imagemat,s.mcwc,l);const f=e.openGLCamera.getKeyMatrices(i);if(vt(e.imagemat,f.wcpc,e.imagemat),r.getCABO().getCoordShiftAndScaleEnabled()){const g=r.getCABO().getInverseShiftAndScaleMatrix();vt(e.imagemat,e.imagemat,g)}if(o.setUniformMatrix("MCPCMatrix",e.imagemat),a.getProperty().getUseLabelOutline()===!0){const g=c.getWorldToIndex(),d=c.getDimensions();let h=e.renderable.getClosestIJKAxis().ijkMode;h===Fi.NONE&&(h=Fi.K),o.setUniform3i("imageDimensions",d[0],d[1],d[2]),o.setUniformi("sliceAxis",h),o.setUniformMatrix("vWCtoIDX",g);const p=e.openGLCamera.getKeyMatrices(i);Ln(e.projectionToWorld,p.wcpc),e.openGLCamera.getKeyMatrices(i),o.setUniformMatrix("PCWCMatrix",e.projectionToWorld);const m=t.getRenderTargetSize();o.setUniformf("vpWidth",m[0]),o.setUniformf("vpHeight",m[1]);const v=t.getRenderTargetOffset();o.setUniformf("vpOffsetX",v[0]/m[0]),o.setUniformf("vpOffsetY",v[1]/m[1])}},t.setPropertyShaderParameters=(r,i,a)=>{const o=r.getProgram(),c=a.getProperty().getOpacity();o.setUniformf("opacity",c)},t.renderPieceStart=(r,i)=>{t.updateBufferObjects(r,i),e.lastBoundBO=null},t.renderPieceDraw=(r,i)=>{const a=e.context;e.openGLTexture.activate(),e.colorTexture.activate(),e.labelOutlineThicknessTexture.activate(),e.pwfTexture.activate(),e.tris.getCABO().getElementCount()&&(t.updateShaders(e.tris,r,i),a.drawArrays(a.TRIANGLES,0,e.tris.getCABO().getElementCount()),e.tris.getVAO().release()),e.openGLTexture.deactivate(),e.colorTexture.deactivate(),e.labelOutlineThicknessTexture.deactivate(),e.pwfTexture.deactivate()},t.renderPieceFinish=(r,i)=>{},t.renderPiece=(r,i)=>{if(t.invokeEvent({type:"StartEvent"}),e.renderable.update(),e.currentInput=e.renderable.getCurrentImage(),t.invokeEvent({type:"EndEvent"}),!e.currentInput){wl("No input!");return}t.renderPieceStart(r,i),t.renderPieceDraw(r,i),t.renderPieceFinish(r,i)},t.computeBounds=(r,i)=>{if(!t.getInput()){Xu(e.bounds);return}e.bounds=t.getInput().getBounds()},t.updateBufferObjects=(r,i)=>{t.getNeedToRebuildBufferObjects(r,i)&&t.buildBufferObjects(r,i)},t.getNeedToRebuildBufferObjects=(r,i)=>{var a,o,s,c;return e.VBOBuildTime.getMTime()<t.getMTime()||e.VBOBuildTime.getMTime()<i.getMTime()||e.VBOBuildTime.getMTime()<e.renderable.getMTime()||e.VBOBuildTime.getMTime()<i.getProperty().getMTime()||e.VBOBuildTime.getMTime()<e.currentInput.getMTime()||!((a=e.openGLTexture)!=null&&a.getHandle())||!((o=e.colorTexture)!=null&&o.getHandle())||!((s=e.labelOutlineThicknessTexture)!=null&&s.getHandle())||!((c=e.pwfTexture)!=null&&c.getHandle())},t.buildBufferObjects=(r,i)=>{var z,X,Z,ce;const a=e.currentInput;if(!a)return;const o=a.getPointData()&&a.getPointData().getScalars();if(!o)return;const s=o.getDataType(),c=o.getNumberOfComponents(),l=i.getProperty(),f=l.getInterpolationType(),u=l.getIndependentComponents(),g=u?c:1,d=u?2*g:1,h=l.getRGBTransferFunction(),p=Co(h,u,g),m=e._openGLRenderWindow.getGraphicsResourceForObject(h);if(!((z=m==null?void 0:m.oglObject)!=null&&z.getHandle())||(m==null?void 0:m.hash)!==p){e.colorTexture=Xt.newInstance({resizable:!0}),e.colorTexture.setOpenGLRenderWindow(e._openGLRenderWindow);const J=1024,de=J*d*3,Q=new Uint8ClampedArray(de);if(f===B0.NEAREST?(e.colorTexture.setMinificationFilter(Ge.NEAREST),e.colorTexture.setMagnificationFilter(Ge.NEAREST)):(e.colorTexture.setMinificationFilter(Ge.LINEAR),e.colorTexture.setMagnificationFilter(Ge.LINEAR)),h){const q=new Float32Array(J*3);for(let j=0;j<g;j++){const ie=l.getRGBTransferFunction(j),ue=ie.getRange();if(ie.getTable(ue[0],ue[1],J,q,1),u)for(let le=0;le<J*3;le++)Q[j*J*6+le]=255*q[le],Q[j*J*6+le+J*3]=255*q[le];else for(let le=0;le<J*3;le++)Q[j*J*6+le]=255*q[le]}e.colorTexture.resetFormatAndType(),e.colorTexture.create2DFromRaw(J,d,3,ut.UNSIGNED_CHAR,Q)}else{for(let q=0;q<J*3;++q)Q[q]=255*q/((J-1)*3),Q[q+1]=255*q/((J-1)*3),Q[q+2]=255*q/((J-1)*3);e.colorTexture.create2DFromRaw(J,1,3,ut.UNSIGNED_CHAR,Q)}h&&(e._openGLRenderWindow.setGraphicsResourceForObject(h,e.colorTexture,p),h!==e._colorTransferFunc&&(e._openGLRenderWindow.registerGraphicsResourceUser(h,t),e._openGLRenderWindow.unregisterGraphicsResourceUser(e._colorTransferFunc,t)),e._colorTransferFunc=h)}else e.colorTexture=m.oglObject;const y=l.getPiecewiseFunction(),T=Co(y,u,g),C=e._openGLRenderWindow.getGraphicsResourceForObject(y);if(!((X=C==null?void 0:C.oglObject)!=null&&X.getHandle())||(C==null?void 0:C.hash)!==T){const de=1024*d,Q=new Uint8ClampedArray(de);if(e.pwfTexture=Xt.newInstance({resizable:!0}),e.pwfTexture.setOpenGLRenderWindow(e._openGLRenderWindow),f===B0.NEAREST?(e.pwfTexture.setMinificationFilter(Ge.NEAREST),e.pwfTexture.setMagnificationFilter(Ge.NEAREST)):(e.pwfTexture.setMinificationFilter(Ge.LINEAR),e.pwfTexture.setMagnificationFilter(Ge.LINEAR)),y){const q=new Float32Array(de),j=new Float32Array(1024);for(let ie=0;ie<g;++ie){const ue=l.getPiecewiseFunction(ie);if(ue===null)q.fill(1);else{const le=ue.getRange();if(ue.getTable(le[0],le[1],1024,j,1),u)for(let Fe=0;Fe<1024;Fe++)q[ie*1024*2+Fe]=j[Fe],q[ie*1024*2+Fe+1024]=j[Fe];else for(let Fe=0;Fe<1024;Fe++)q[ie*1024*2+Fe]=j[Fe]}}e.pwfTexture.resetFormatAndType(),e.pwfTexture.create2DFromRaw(1024,d,1,ut.FLOAT,q)}else Q.fill(255),e.pwfTexture.create2DFromRaw(1024,1,1,ut.UNSIGNED_CHAR,Q);y&&(e._openGLRenderWindow.setGraphicsResourceForObject(y,e.pwfTexture,T),y!==e._pwFunc&&(e._openGLRenderWindow.registerGraphicsResourceUser(y,t),e._openGLRenderWindow.unregisterGraphicsResourceUser(e._pwFunc,t)),e._pwFunc=y)}else e.pwfTexture=C.oglObject;t.updatelabelOutlineThicknessTexture(i);const{ijkMode:x}=e.renderable.getClosestIJKAxis();let O=e.renderable.getSlice();x!==e.renderable.getSlicingMode()&&(O=e.renderable.getSliceAtPosition(O));const M=e.renderable.isA("vtkImageArrayMapper")?e.renderable.getSubSlice():Math.round(O),A=a.getExtent();let _;x===Fi.I&&(_=M-A[0]),x===Fi.J&&(_=M-A[2]),(x===Fi.K||x===Fi.NONE)&&(_=M-A[4]);const k=`${O}A${a.getMTime()}A${o.getMTime()}B${t.getMTime()}C${e.renderable.getSlicingMode()}D${i.getProperty().getInterpolationType()}`;if(e.VBOBuildString!==k){const J=a.getDimensions();e.openGLTexture||(e.openGLTexture=Xt.newInstance({resizable:!0})),e.openGLTexture.setOpenGLRenderWindow(e._openGLRenderWindow),e.openGLTexture.setOglNorm16Ext(e.context.getExtension("EXT_texture_norm16")),f===B0.NEAREST?(new Set([1,3,4]).has(c)&&s===ut.UNSIGNED_CHAR&&!u&&e.openGLTexture.setGenerateMipmap(!0),e.openGLTexture.setMinificationFilter(Ge.NEAREST),e.openGLTexture.setMagnificationFilter(Ge.NEAREST)):(c===4&&s===ut.UNSIGNED_CHAR&&!u?(e.openGLTexture.setGenerateMipmap(!0),e.openGLTexture.setMinificationFilter(Ge.LINEAR_MIPMAP_LINEAR)):e.openGLTexture.setMinificationFilter(Ge.LINEAR),e.openGLTexture.setMagnificationFilter(Ge.LINEAR)),e.openGLTexture.setWrapS(Fg.CLAMP_TO_EDGE),e.openGLTexture.setWrapT(Fg.CLAMP_TO_EDGE);const de=J[0]*J[1]*c,Q=new Float32Array(12),q=new Float32Array(8);for(let dt=0;dt<4;dt++)q[dt*2]=dt%2?1:0,q[dt*2+1]=dt>1?1:0;const j=[Fi.X,Fi.Y,Fi.Z].includes(e.renderable.getSlicingMode())?O:M,ie=a.getSpatialExtent(),ue=o.getData();let le=null;if(x===Fi.I){le=new ue.constructor(J[2]*J[1]*c);let dt=0;for(let _t=0;_t<J[2];_t++)for(let Ke=0;Ke<J[1];Ke++){let Ye=(_+Ke*J[0]+_t*J[0]*J[1])*c;dt=(_t*J[1]+Ke)*c;const Zt=Ye+c;for(;Ye<Zt;)le[dt++]=ue[Ye++]}J[0]=J[1],J[1]=J[2],Q[0]=j,Q[1]=ie[2],Q[2]=ie[4],Q[3]=j,Q[4]=ie[3],Q[5]=ie[4],Q[6]=j,Q[7]=ie[2],Q[8]=ie[5],Q[9]=j,Q[10]=ie[3],Q[11]=ie[5]}else if(x===Fi.J){le=new ue.constructor(J[2]*J[0]*c);let dt=0;for(let _t=0;_t<J[2];_t++)for(let Ke=0;Ke<J[0];Ke++){let Ye=(Ke+_*J[0]+_t*J[0]*J[1])*c;dt=(_t*J[0]+Ke)*c;const Zt=Ye+c;for(;Ye<Zt;)le[dt++]=ue[Ye++]}J[1]=J[2],Q[0]=ie[0],Q[1]=j,Q[2]=ie[4],Q[3]=ie[1],Q[4]=j,Q[5]=ie[4],Q[6]=ie[0],Q[7]=j,Q[8]=ie[5],Q[9]=ie[1],Q[10]=j,Q[11]=ie[5]}else x===Fi.K||x===Fi.NONE?(le=ue.subarray(_*de,(_+1)*de),Q[0]=ie[0],Q[1]=ie[2],Q[2]=j,Q[3]=ie[1],Q[4]=ie[2],Q[5]=j,Q[6]=ie[0],Q[7]=ie[3],Q[8]=j,Q[9]=ie[1],Q[10]=ie[3],Q[11]=j):wl("Reformat slicing not yet supported.");e.openGLTexture.resetFormatAndType(),e.openGLTexture.create2DFilterableFromRaw(J[0],J[1],c,o.getDataType(),le,(ce=(Z=e.renderable).getPreferSizeOverAccuracy)==null?void 0:ce.call(Z)),e.openGLTexture.activate(),e.openGLTexture.sendParameters(),e.openGLTexture.deactivate();const Fe=nt.newInstance({numberOfComponents:3,values:Q});Fe.setName("points");const kt=nt.newInstance({numberOfComponents:2,values:q});kt.setName("tcoords");const lt=new Uint16Array(8);lt[0]=3,lt[1]=0,lt[2]=1,lt[3]=3,lt[4]=3,lt[5]=0,lt[6]=3,lt[7]=2;const yt=nt.newInstance({numberOfComponents:1,values:lt});e.tris.getCABO().createVBO(yt,"polys",_r.SURFACE,{points:Fe,tcoords:kt,cellOffset:0}),e.VBOBuildTime.modified(),e.VBOBuildString=k}},t.updatelabelOutlineThicknessTexture=r=>{var c;const i=r.getProperty().getLabelOutlineThicknessByReference(),a=e._openGLRenderWindow.getGraphicsResourceForObject(i),o=`${i.join("-")}`;if(!((c=a==null?void 0:a.oglObject)!=null&&c.getHandle())||(a==null?void 0:a.hash)!==o){const g=new Uint8Array(1024);for(let d=0;d<1024;++d){const h=typeof i[d]<"u"?i[d]:i[0];g[d]=h}e.labelOutlineThicknessTexture=Xt.newInstance({resizable:!1}),e.labelOutlineThicknessTexture.setOpenGLRenderWindow(e._openGLRenderWindow),e.labelOutlineThicknessTexture.resetFormatAndType(),e.labelOutlineThicknessTexture.setMinificationFilter(Ge.NEAREST),e.labelOutlineThicknessTexture.setMagnificationFilter(Ge.NEAREST),e.labelOutlineThicknessTexture.create2DFromRaw(1024,1,1,ut.UNSIGNED_CHAR,g),i&&(e._openGLRenderWindow.setGraphicsResourceForObject(i,e.labelOutlineThicknessTexture,o),i!==e._labelOutlineThicknessArray&&(e._openGLRenderWindow.registerGraphicsResourceUser(i,t),e._openGLRenderWindow.unregisterGraphicsResourceUser(e._labelOutlineThicknessArray,t)),e._labelOutlineThicknessArray=i)}else e.labelOutlineThicknessTexture=a.oglObject},t.getRenderTargetSize=()=>{if(e._useSmallViewport)return[e._smallViewportWidth,e._smallViewportHeight];const{usize:r,vsize:i}=e._openGLRenderer.getTiledSizeAndOrigin();return[r,i]},t.getRenderTargetOffset=()=>{const{lowerLeftU:r,lowerLeftV:i}=e._openGLRenderer.getTiledSizeAndOrigin();return[r,i]},t.delete=gd(()=>{e._openGLRenderWindow&&n(e._openGLRenderWindow)},t.delete)}const JG={VBOBuildTime:0,VBOBuildString:null,openGLTexture:null,tris:null,imagemat:null,imagematinv:null,colorTexture:null,pwfTexture:null,labelOutlineThicknessTexture:null,labelOutlineThicknessTextureString:null,lastHaveSeenDepthRequest:!1,haveSeenDepthRequest:!1,lastTextureComponents:0};function e$(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,JG,n),Bt.extend(t,e,n),To.implementReplaceShaderCoincidentOffset(t,e,n),To.implementBuildShadersWithReplacements(t,e,n),e.tris=Oo.newInstance(),e.imagemat=Be(new Float64Array(16)),e.imagematinv=Be(new Float64Array(16)),e.projectionToWorld=Be(new Float64Array(16)),e.idxToView=Be(new Float64Array(16)),e.idxNormalMatrix=ya(new Float64Array(9)),e.modelToView=Be(new Float64Array(16)),e.projectionToView=Be(new Float64Array(16)),Vn(t,e,[]),e.VBOBuildTime={},zt(e.VBOBuildTime),QG(t,e)}const FO=Rt(e$,"vtkOpenGLImageMapper");var t$={newInstance:FO};Wn("vtkAbstractImageMapper",FO);const f0={MAX:0,MIN:1,AVERAGE:2},{vtkErrorMacro:n1}=P;function n$(t,e){e.classHierarchy.push("vtkOpenGLImageCPRMapper");function n(r){[e._scalars,e._colorTransferFunc,e._pwFunc].forEach(i=>r.unregisterGraphicsResourceUser(i,t))}t.buildPass=r=>{if(r){e.currentRenderPass=null,e.openGLImageSlice=t.getFirstAncestorOfType("vtkOpenGLImageSlice"),e._openGLRenderer=t.getFirstAncestorOfType("vtkOpenGLRenderer");const i=e._openGLRenderWindow;e._openGLRenderWindow=e._openGLRenderer.getLastAncestorOfType("vtkOpenGLRenderWindow"),i&&!i.isDeleted()&&i!==e._openGLRenderWindow&&n(i),e.context=e._openGLRenderWindow.getContext(),e.openGLCamera=e._openGLRenderer.getViewNodeFor(e._openGLRenderer.getRenderable().getActiveCamera()),e.tris.setOpenGLRenderWindow(e._openGLRenderWindow)}},t.opaquePass=(r,i)=>{r&&(e.currentRenderPass=i,t.render())},t.opaqueZBufferPass=r=>{r&&(e.haveSeenDepthRequest=!0,e.renderDepth=!0,t.render(),e.renderDepth=!1)},t.getCoincidentParameters=(r,i)=>e.renderable.getResolveCoincidentTopology()===Wa.PolygonOffset?e.renderable.getCoincidentTopologyPolygonOffsetParameters():null,t.render=()=>{const r=e.openGLImageSlice.getRenderable(),i=e._openGLRenderer.getRenderable();t.renderPiece(i,r)},t.renderPiece=(r,i)=>{t.invokeEvent({type:"StartEvent"}),e.renderable.update(),t.invokeEvent({type:"EndEvent"}),e.renderable.preRenderCheck()&&(e.currentImageDataInput=e.renderable.getInputData(0),e.currentCenterlineInput=e.renderable.getOrientedCenterline(),t.renderPieceStart(r,i),t.renderPieceDraw(r,i),t.renderPieceFinish(r,i))},t.renderPieceStart=(r,i)=>{t.updateBufferObjects(r,i)},t.renderPieceDraw=(r,i)=>{const a=e.context;e.volumeTexture.activate(),e.colorTexture.activate(),e.pwfTexture.activate(),e.tris.getCABO().getElementCount()&&(t.updateShaders(e.tris,r,i),a.drawArrays(a.TRIANGLES,0,e.tris.getCABO().getElementCount()),e.tris.getVAO().release()),e.volumeTexture.deactivate(),e.colorTexture.deactivate(),e.pwfTexture.deactivate()},t.renderPieceFinish=(r,i)=>{},t.updateBufferObjects=(r,i)=>{t.getNeedToRebuildBufferObjects(r,i)&&t.buildBufferObjects(r,i),i.getProperty().getInterpolationType()===B0.NEAREST?(e.volumeTexture.setMinificationFilter(Ge.NEAREST),e.volumeTexture.setMagnificationFilter(Ge.NEAREST),e.colorTexture.setMinificationFilter(Ge.NEAREST),e.colorTexture.setMagnificationFilter(Ge.NEAREST),e.pwfTexture.setMinificationFilter(Ge.NEAREST),e.pwfTexture.setMagnificationFilter(Ge.NEAREST)):(e.volumeTexture.setMinificationFilter(Ge.LINEAR),e.volumeTexture.setMagnificationFilter(Ge.LINEAR),e.colorTexture.setMinificationFilter(Ge.LINEAR),e.colorTexture.setMagnificationFilter(Ge.LINEAR),e.pwfTexture.setMinificationFilter(Ge.LINEAR),e.pwfTexture.setMagnificationFilter(Ge.LINEAR))},t.getNeedToRebuildBufferObjects=(r,i)=>{var o;const a=e.VBOBuildTime.getMTime();return a<t.getMTime()||a<e.renderable.getMTime()||a<i.getMTime()||a<e.currentImageDataInput.getMTime()||a<e.currentCenterlineInput.getMTime()||!((o=e.volumeTexture)!=null&&o.getHandle())},t.buildBufferObjects=(r,i)=>{var M,A,_,k;const a=e.currentImageDataInput,o=e.currentCenterlineInput,s=(M=a==null?void 0:a.getPointData())==null?void 0:M.getScalars();if(!s)return;const c=e._openGLRenderWindow.getGraphicsResourceForObject(s),l=oy(a,s);if(!((A=c==null?void 0:c.oglObject)!=null&&A.getHandle())||(c==null?void 0:c.hash)!==l){e.volumeTexture=Xt.newInstance(),e.volumeTexture.setOpenGLRenderWindow(e._openGLRenderWindow);const z=a.getDimensions();e.volumeTexture.setOglNorm16Ext(e.context.getExtension("EXT_texture_norm16")),e.volumeTexture.resetFormatAndType(),e.volumeTexture.create3DFilterableFromDataArray(z[0],z[1],z[2],s,e.renderable.getPreferSizeOverAccuracy()),e._openGLRenderWindow.setGraphicsResourceForObject(s,e.volumeTexture,l),s!==e._scalars&&(e._openGLRenderWindow.registerGraphicsResourceUser(s,t),e._openGLRenderWindow.unregisterGraphicsResourceUser(e._scalars,t)),e._scalars=s}else e.volumeTexture=c.oglObject;const u=s.getNumberOfComponents(),g=i.getProperty(),d=g.getIndependentComponents(),h=d?u:1,p=d?2*h:1,m=g.getRGBTransferFunction(),v=Co(m,d,h),y=e._openGLRenderWindow.getGraphicsResourceForObject(m);if(!((_=y==null?void 0:y.oglObject)!=null&&_.getHandle())||(y==null?void 0:y.hash)!==v){const X=1024*p*3,Z=new Uint8ClampedArray(X);if(e.colorTexture=Xt.newInstance(),e.colorTexture.setOpenGLRenderWindow(e._openGLRenderWindow),m){const ce=new Float32Array(3072);for(let J=0;J<h;J++){const de=g.getRGBTransferFunction(J),Q=de.getRange();if(de.getTable(Q[0],Q[1],1024,ce,1),d)for(let q=0;q<1024*3;q++)Z[J*1024*6+q]=255*ce[q],Z[J*1024*6+q+1024*3]=255*ce[q];else for(let q=0;q<1024*3;q++)Z[J*1024*6+q]=255*ce[q]}e.colorTexture.resetFormatAndType(),e.colorTexture.create2DFromRaw(1024,p,3,ut.UNSIGNED_CHAR,Z)}else{for(let ce=0;ce<1024*3;++ce)Z[ce]=255*ce/(1023*3),Z[ce+1]=255*ce/(1023*3),Z[ce+2]=255*ce/(1023*3);e.colorTexture.resetFormatAndType(),e.colorTexture.create2DFromRaw(1024,1,3,ut.UNSIGNED_CHAR,Z)}m&&(e._openGLRenderWindow.setGraphicsResourceForObject(m,e.colorTexture,v),m!==e._colorTransferFunc&&(e._openGLRenderWindow.registerGraphicsResourceUser(m,t),e._openGLRenderWindow.unregisterGraphicsResourceUser(e._colorTransferFunc,t)),e._colorTransferFunc=m)}else e.colorTexture=y.oglObject;const C=g.getPiecewiseFunction(),w=Co(C,d,h),x=e._openGLRenderWindow.getGraphicsResourceForObject(C);if(!((k=x==null?void 0:x.oglObject)!=null&&k.getHandle())||(x==null?void 0:x.hash)!==w){const X=1024*p,Z=new Uint8ClampedArray(X);if(e.pwfTexture=Xt.newInstance(),e.pwfTexture.setOpenGLRenderWindow(e._openGLRenderWindow),C){const ce=new Float32Array(X),J=new Float32Array(1024);for(let de=0;de<h;++de){const Q=g.getPiecewiseFunction(de);if(Q===null)ce.fill(1);else{const q=Q.getRange();if(Q.getTable(q[0],q[1],1024,J,1),d)for(let j=0;j<1024;j++)ce[de*1024*2+j]=J[j],ce[de*1024*2+j+1024]=J[j];else for(let j=0;j<1024;j++)ce[de*1024*2+j]=J[j]}}e.pwfTexture.resetFormatAndType(),e.pwfTexture.create2DFromRaw(1024,p,1,ut.FLOAT,ce)}else Z.fill(255),e.pwfTexture.resetFormatAndType(),e.pwfTexture.create2DFromRaw(1024,1,1,ut.UNSIGNED_CHAR,Z);C&&(e._openGLRenderWindow.setGraphicsResourceForObject(C,e.pwfTexture,w),C!==e._pwFunc&&(e._openGLRenderWindow.registerGraphicsResourceUser(C,t),e._openGLRenderWindow.unregisterGraphicsResourceUser(e._pwFunc,t)),e._pwFunc=C)}else e.pwfTexture=x.oglObject;if(e.VBOBuildTime.getMTime()<e.renderable.getMTime()||e.VBOBuildTime.getMTime()<o.getMTime()){const z=o.getNumberOfPoints(),X=z<=1?0:z-1,Z=o.getDistancesToFirstPoint(),ce=e.renderable.getHeight(),J=4*X,de=new Float32Array(3*J),Q=e.renderable.getWidth();for(let Ke=0,Ye=0;Ke<X;++Ke)de.set([0,ce-Z[Ke],0],Ye),Ye+=3,de.set([Q,ce-Z[Ke],0],Ye),Ye+=3,de.set([Q,ce-Z[Ke+1],0],Ye),Ye+=3,de.set([0,ce-Z[Ke+1],0],Ye),Ye+=3;const q=nt.newInstance({numberOfComponents:3,values:de});q.setName("points");const j=new Uint16Array(5*X);for(let Ke=0,Ye=0,Zt=0;Ke<X;++Ke)j.set([4,Zt+3,Zt+2,Zt+1,Zt],Ye),Ye+=5,Zt+=4;const ie=nt.newInstance({numberOfComponents:1,values:j}),ue=o.getPoints(),le=new Float32Array(3*J),Fe=new Array(3),kt=new Array(3);for(let Ke=0,Ye=0;Ke<X;++Ke)ue.getPoint(Ke,Fe),ue.getPoint(Ke+1,kt),le.set(Fe,Ye),Ye+=3,le.set(Fe,Ye),Ye+=3,le.set(kt,Ye),Ye+=3,le.set(kt,Ye),Ye+=3;const lt=nt.newInstance({numberOfComponents:3,values:le,name:"centerlinePosition"}),yt=new Float32Array(J);for(let Ke=0,Ye=0;Ke<X;++Ke)yt.set([0,1,3,2],Ye),Ye+=4;const dt=nt.newInstance({numberOfComponents:1,values:yt,name:"quadIndex"}),_t=[lt,dt];if(!e.renderable.getUseUniformOrientation()){const Ke=e.renderable.getOrientedCenterline().getOrientations()??[],Ye=new Float32Array(4*J),Zt=new Float32Array(4*J);for(let $t=0;$t<X;++$t){const Pn=Ke[$t],Nn=Ke[$t+1];for(let fn=0;fn<4;++fn){const cr=4*(fn+4*$t);Ye.set(Pn,cr),Zt.set(Nn,cr)}}const jr=nt.newInstance({numberOfComponents:4,values:Ye,name:"centerlineTopOrientation"}),Cr=nt.newInstance({numberOfComponents:4,values:Zt,name:"centerlineBotOrientation"});_t.push(jr,Cr)}e.tris.getCABO().createVBO(ie,"polys",_r.SURFACE,{points:q,customAttributes:_t}),e.VBOBuildTime.modified()}},t.getNeedToRebuildShaders=(r,i,a)=>{const o=e.volumeTexture.getComponents(),s=a.getProperty().getIndependentComponents(),c=!!e.renderable.getCenterPoint(),l=e.renderable.getUseUniformOrientation(),f=e.renderable.isProjectionEnabled()&&e.renderable.getProjectionMode();return r.getProgram()===0||e.lastUseCenterPoint!==c||e.lastUseUniformOrientation!==l||e.lastProjectionMode!==f||e.lastHaveSeenDepthRequest!==e.haveSeenDepthRequest||e.lastTextureComponents!==o||e.lastIndependentComponents!==s?(e.lastUseCenterPoint=c,e.lastUseUniformOrientation=l,e.lastProjectionMode=f,e.lastHaveSeenDepthRequest=e.haveSeenDepthRequest,e.lastTextureComponents=o,e.lastIndependentComponents=s,!0):!1},t.buildShaders=(r,i,a)=>{t.getShaderTemplate(r,i,a),t.replaceShaderValues(r,i,a)},t.replaceShaderValues=(r,i,a)=>{let o=r.Vertex,s=r.Fragment;const c=["vec3 applyQuaternionToVec(vec4 q, vec3 v) {","  float uvx = q.y * v.z - q.z * v.y;","  float uvy = q.z * v.x - q.x * v.z;","  float uvz = q.x * v.y - q.y * v.x;","  float uuvx = q.y * uvz - q.z * uvy;","  float uuvy = q.z * uvx - q.x * uvz;","  float uuvz = q.x * uvy - q.y * uvx;","  float w2 = q.w * 2.0;","  uvx *= w2;","  uvy *= w2;","  uvz *= w2;","  uuvx *= 2.0;","  uuvy *= 2.0;","  uuvz *= 2.0;","  return vec3(v.x + uvx + uuvx, v.y + uvy + uuvy, v.z + uvz + uuvz);","}"];o=te.substitute(o,"//VTK::Camera::Dec",["uniform mat4 MCPCMatrix;"]).result,o=te.substitute(o,"//VTK::PositionVC::Impl",["  gl_Position = MCPCMatrix * vertexMC;"]).result;const l=["attribute vec3 centerlinePosition;","attribute float quadIndex;","uniform float width;","out vec2 quadOffsetVSOutput;","out vec3 centerlinePosVSOutput;"],f=e.renderable.isProjectionEnabled(),u=e.renderable.getUseUniformOrientation();u?(l.push("out vec3 samplingDirVSOutput;","uniform vec4 centerlineOrientation;","uniform vec3 tangentDirection;",...c),f&&l.push("out vec3 projectionDirVSOutput;","uniform vec3 bitangentDirection;")):l.push("out vec4 centerlineTopOrientationVSOutput;","out vec4 centerlineBotOrientationVSOutput;","attribute vec4 centerlineTopOrientation;","attribute vec4 centerlineBotOrientation;"),o=te.substitute(o,"//VTK::Color::Dec",l).result;const g=["quadOffsetVSOutput = vec2(width * (mod(quadIndex, 2.0) == 0.0 ? -0.5 : 0.5), quadIndex > 1.0 ? 0.0 : 1.0);","centerlinePosVSOutput = centerlinePosition;"];u?(g.push("samplingDirVSOutput = applyQuaternionToVec(centerlineOrientation, tangentDirection);"),f&&g.push("projectionDirVSOutput = applyQuaternionToVec(centerlineOrientation, bitangentDirection);")):g.push("centerlineTopOrientationVSOutput = centerlineTopOrientation;","centerlineBotOrientationVSOutput = centerlineBotOrientation;"),o=te.substitute(o,"//VTK::Color::Impl",g).result;const d=e.volumeTexture.getComponents(),h=a.getProperty().getIndependentComponents();let p=["uniform mat4 MCTCMatrix; // Model coordinates to texture coordinates","in vec2 quadOffsetVSOutput;","in vec3 centerlinePosVSOutput;","uniform highp sampler3D volumeTexture;","uniform sampler2D colorTexture1;","uniform sampler2D pwfTexture1;","uniform float opacity;","uniform vec4 backgroundColor;","uniform float cshift0;","uniform float cscale0;","uniform float pwfshift0;","uniform float pwfscale0;"];f&&p.push("uniform vec3 volumeSizeMC;","uniform int projectionSlabNumberOfSamples;","uniform float projectionConstantOffset;","uniform float projectionStepLength;"),u?(p.push("in vec3 samplingDirVSOutput;"),f&&p.push("in vec3 projectionDirVSOutput;")):(p.push("uniform vec3 tangentDirection;","in vec4 centerlineTopOrientationVSOutput;","in vec4 centerlineBotOrientationVSOutput;",...c),f&&p.push("uniform vec3 bitangentDirection;"));const m=e.renderable.getCenterPoint();if(m&&p.push("uniform vec3 globalCenterPoint;"),h){for(let y=1;y<d;y++)p=p.concat([`uniform float cshift${y};`,`uniform float cscale${y};`,`uniform float pwfshift${y};`,`uniform float pwfscale${y};`]);switch(d){case 1:p=p.concat(["uniform float mix0;","#define height0 0.5"]);break;case 2:p=p.concat(["uniform float mix0;","uniform float mix1;","#define height0 0.25","#define height1 0.75"]);break;case 3:p=p.concat(["uniform float mix0;","uniform float mix1;","uniform float mix2;","#define height0 0.17","#define height1 0.5","#define height2 0.83"]);break;case 4:p=p.concat(["uniform float mix0;","uniform float mix1;","uniform float mix2;","uniform float mix3;","#define height0 0.125","#define height1 0.375","#define height2 0.625","#define height3 0.875"]);break;default:n1("Unsupported number of independent coordinates.")}}s=te.substitute(s,"//VTK::TCoord::Dec",p).result;let v=[];if(u?(v.push("vec3 samplingDirection = samplingDirVSOutput;"),f&&v.push("vec3 projectionDirection = projectionDirVSOutput;")):(v.push("vec4 q0 = centerlineBotOrientationVSOutput;","vec4 q1 = centerlineTopOrientationVSOutput;","float qCosAngle = dot(q0, q1);","vec4 interpolatedOrientation;","if (qCosAngle > 0.999 || qCosAngle < -0.999) {","  // Use LERP instead of SLERP when the two quaternions are close or opposite","  interpolatedOrientation = normalize(mix(q0, q1, quadOffsetVSOutput.y));","} else {","  float omega = acos(qCosAngle);","  interpolatedOrientation = normalize(sin((1.0 - quadOffsetVSOutput.y) * omega) * q0 + sin(quadOffsetVSOutput.y * omega) * q1);","}","vec3 samplingDirection = applyQuaternionToVec(interpolatedOrientation, tangentDirection);"),f&&v.push("vec3 projectionDirection = applyQuaternionToVec(interpolatedOrientation, bitangentDirection);")),m?v.push("float baseOffset = dot(samplingDirection, globalCenterPoint - centerlinePosVSOutput);","float horizontalOffset = quadOffsetVSOutput.x + baseOffset;"):v.push("float horizontalOffset = quadOffsetVSOutput.x;"),v.push("vec3 volumePosMC = centerlinePosVSOutput + horizontalOffset * samplingDirection;","vec3 volumePosTC = (MCTCMatrix * vec4(volumePosMC, 1.0)).xyz;","if (any(lessThan(volumePosTC, vec3(0.0))) || any(greaterThan(volumePosTC, vec3(1.0))))","{","  // set the background color and exit","  gl_FragData[0] = backgroundColor;","  return;","}"),f){const y=e.renderable.getProjectionMode();switch(y){case f0.MIN:v.push("const vec4 initialProjectionTextureValue = vec4(1.0);");break;case f0.MAX:case f0.AVERAGE:default:v.push("const vec4 initialProjectionTextureValue = vec4(0.0);");break}switch(v.push("vec3 projectionScaledDirection = projectionDirection / volumeSizeMC;","vec3 projectionStep = projectionStepLength * projectionScaledDirection;","vec3 projectionStartPosition = volumePosTC + projectionConstantOffset * projectionScaledDirection;","vec4 tvalue = initialProjectionTextureValue;","for (int projectionSampleIdx = 0; projectionSampleIdx < projectionSlabNumberOfSamples; ++projectionSampleIdx) {","  vec3 projectionSamplePosition = projectionStartPosition + float(projectionSampleIdx) * projectionStep;","  vec4 sampledTextureValue = texture(volumeTexture, projectionSamplePosition);"),y){case f0.MAX:v.push("  tvalue = max(tvalue, sampledTextureValue);");break;case f0.MIN:v.push("  tvalue = min(tvalue, sampledTextureValue);");break;case f0.AVERAGE:default:v.push("  tvalue = tvalue + sampledTextureValue;");break}v.push("}"),y===f0.AVERAGE&&v.push("tvalue = tvalue / float(projectionSlabNumberOfSamples);")}else v.push("vec4 tvalue = texture(volumeTexture, volumePosTC);");if(h){const y=["r","g","b","a"];for(let T=0;T<d;++T)v=v.concat([`vec3 tcolor${T} = mix${T} * texture2D(colorTexture1, vec2(tvalue.${y[T]} * cscale${T} + cshift${T}, height${T})).rgb;`,`float compWeight${T} = mix${T} * texture2D(pwfTexture1, vec2(tvalue.${y[T]} * pwfscale${T} + pwfshift${T}, height${T})).r;`]);switch(d){case 1:v=v.concat(["gl_FragData[0] = vec4(tcolor0.rgb, compWeight0 * opacity);"]);break;case 2:v=v.concat(["float weightSum = compWeight0 + compWeight1;","gl_FragData[0] = vec4(vec3((tcolor0.rgb * (compWeight0 / weightSum)) + (tcolor1.rgb * (compWeight1 / weightSum))), opacity);"]);break;case 3:v=v.concat(["float weightSum = compWeight0 + compWeight1 + compWeight2;","gl_FragData[0] = vec4(vec3((tcolor0.rgb * (compWeight0 / weightSum)) + (tcolor1.rgb * (compWeight1 / weightSum)) + (tcolor2.rgb * (compWeight2 / weightSum))), opacity);"]);break;case 4:v=v.concat(["float weightSum = compWeight0 + compWeight1 + compWeight2 + compWeight3;","gl_FragData[0] = vec4(vec3((tcolor0.rgb * (compWeight0 / weightSum)) + (tcolor1.rgb * (compWeight1 / weightSum)) + (tcolor2.rgb * (compWeight2 / weightSum)) + (tcolor3.rgb * (compWeight3 / weightSum))), opacity);"]);break;default:n1("Unsupported number of independent coordinates.")}}else switch(d){case 1:v=v.concat(["// Dependent components","float intensity = tvalue.r;","vec3 tcolor = texture2D(colorTexture1, vec2(intensity * cscale0 + cshift0, 0.5)).rgb;","float scalarOpacity = texture2D(pwfTexture1, vec2(intensity * pwfscale0 + pwfshift0, 0.5)).r;","gl_FragData[0] = vec4(tcolor, scalarOpacity * opacity);"]);break;case 2:v=v.concat(["float intensity = tvalue.r*cscale0 + cshift0;","gl_FragData[0] = vec4(texture2D(colorTexture1, vec2(intensity, 0.5)).rgb, pwfscale0*tvalue.g + pwfshift0);"]);break;case 3:v=v.concat(["vec4 tcolor = cscale0*tvalue + cshift0;","gl_FragData[0] = vec4(texture2D(colorTexture1, vec2(tcolor.r,0.5)).r,","  texture2D(colorTexture1, vec2(tcolor.g,0.5)).r,","  texture2D(colorTexture1, vec2(tcolor.b,0.5)).r, opacity);"]);break;default:v=v.concat(["vec4 tcolor = cscale0*tvalue + cshift0;","gl_FragData[0] = vec4(texture2D(colorTexture1, vec2(tcolor.r,0.5)).r,","  texture2D(colorTexture1, vec2(tcolor.g,0.5)).r,","  texture2D(colorTexture1, vec2(tcolor.b,0.5)).r, tcolor.a);"])}s=te.substitute(s,"//VTK::TCoord::Impl",v).result,e.haveSeenDepthRequest&&(s=te.substitute(s,"//VTK::ZBuffer::Dec","uniform int depthRequest;").result,s=te.substitute(s,"//VTK::ZBuffer::Impl",["if (depthRequest == 1) {","float iz = floor(gl_FragCoord.z*65535.0 + 0.1);","float rf = floor(iz/256.0)/255.0;","float gf = mod(iz,256.0)/255.0;","gl_FragData[0] = vec4(rf, gf, 0.0, 1.0); }"]).result),r.Vertex=o,r.Fragment=s,t.replaceShaderClip(r,i,a),t.replaceShaderCoincidentOffset(r,i,a)},t.replaceShaderClip=(r,i,a)=>{let o=r.Vertex,s=r.Fragment;if(e.renderable.getNumberOfClippingPlanes()){let c=e.renderable.getNumberOfClippingPlanes();c>6&&(P.vtkErrorMacro("OpenGL has a limit of 6 clipping planes"),c=6),o=te.substitute(o,"//VTK::Clip::Dec",["uniform int numClipPlanes;","uniform vec4 clipPlanes[6];","varying float clipDistancesVSOutput[6];"]).result,o=te.substitute(o,"//VTK::Clip::Impl",["for (int planeNum = 0; planeNum < 6; planeNum++)","    {","    if (planeNum >= numClipPlanes)","        {","        break;","        }","    clipDistancesVSOutput[planeNum] = dot(clipPlanes[planeNum], vertexMC);","    }"]).result,s=te.substitute(s,"//VTK::Clip::Dec",["uniform int numClipPlanes;","varying float clipDistancesVSOutput[6];"]).result,s=te.substitute(s,"//VTK::Clip::Impl",["for (int planeNum = 0; planeNum < 6; planeNum++)","    {","    if (planeNum >= numClipPlanes)","        {","        break;","        }","    if (clipDistancesVSOutput[planeNum] < 0.0) discard;","    }"]).result}r.Vertex=o,r.Fragment=s},t.getShaderTemplate=(r,i,a)=>{r.Vertex=ay,r.Fragment=yd,r.Geometry=""},t.setMapperShaderParameters=(r,i,a)=>{const o=r.getProgram(),s=r.getCABO();s.getElementCount()&&(e.VBOBuildTime.getMTime()>r.getAttributeUpdateTime().getMTime()||r.getShaderSourceTime().getMTime()>r.getAttributeUpdateTime().getMTime())&&(o.isAttributeUsed("vertexMC")&&(r.getVAO().addAttributeArray(o,s,"vertexMC",s.getVertexOffset(),s.getStride(),e.context.FLOAT,3,e.context.FALSE)||n1("Error setting vertexMC in shader VAO.")),r.getCABO().getCustomData().forEach(d=>{d&&o.isAttributeUsed(d.name)&&!r.getVAO().addAttributeArray(o,s,d.name,d.offset,s.getStride(),e.context.FLOAT,d.components,e.context.FALSE)&&n1(`Error setting ${d.name} in shader VAO.`)}),r.getAttributeUpdateTime().modified());const c=e.volumeTexture.getTextureUnit();if(o.setUniformi("volumeTexture",c),o.setUniformf("width",e.renderable.getWidth()),r.getProgram().setUniform4fv("backgroundColor",e.renderable.getBackgroundColor()),o.isUniformUsed("tangentDirection")){const d=e.renderable.getTangentDirection();r.getProgram().setUniform3fArray("tangentDirection",d)}if(o.isUniformUsed("bitangentDirection")){const d=e.renderable.getBitangentDirection();r.getProgram().setUniform3fArray("bitangentDirection",d)}if(o.isUniformUsed("centerlineOrientation")){const d=e.renderable.getUniformOrientation();r.getProgram().setUniform4fv("centerlineOrientation",d)}if(o.isUniformUsed("globalCenterPoint")){const d=e.renderable.getCenterPoint();o.setUniform3fArray("globalCenterPoint",d)}if(e.renderable.isProjectionEnabled()){const d=e.currentImageDataInput,h=d.getSpacing(),p=d.getDimensions(),m=e.renderable.getProjectionSlabThickness(),v=e.renderable.getProjectionSlabNumberOfSamples(),y=lF([],h,p);o.setUniform3fArray("volumeSizeMC",y),o.setUniformi("projectionSlabNumberOfSamples",v);const T=-.5*m;o.setUniformf("projectionConstantOffset",T);const C=m/(v-1);o.setUniformf("projectionStepLength",C)}const l=e.currentImageDataInput,f=l.getWorldToIndex(),u=U4(new Float32Array(16),hE([],l.getDimensions())),g=ah(u,u,f);if(o.setUniformMatrix("MCTCMatrix",g),e.haveSeenDepthRequest&&r.getProgram().setUniformi("depthRequest",e.renderDepth?1:0),e.renderable.getNumberOfClippingPlanes()){let d=e.renderable.getNumberOfClippingPlanes();d>6&&(P.vtkErrorMacro("OpenGL has a limit of 6 clipping planes"),d=6);const p=s.getCoordShiftAndScaleEnabled()?s.getInverseShiftAndScaleMatrix():null,m=p?nn(e.imagematinv,a.getMatrix()):a.getMatrix();p&&(ft(m,m),vt(m,m,p),ft(m,m)),ft(e.imagemat,e.currentImageDataInput.getIndexToWorld()),vt(e.imagematinv,m,e.imagemat);const v=[];for(let y=0;y<d;y++){const T=[];e.renderable.getClippingPlaneInDataCoords(e.imagematinv,y,T);for(let C=0;C<4;C++)v.push(T[C])}o.setUniformi("numClipPlanes",d),o.setUniform4fv("clipPlanes",v)}if(o.isUniformUsed("coffset")){const d=t.getCoincidentParameters(i,a);o.setUniformf("coffset",d.offset),o.isUniformUsed("cfactor")&&o.setUniformf("cfactor",d.factor)}},t.setCameraShaderParameters=(r,i,a)=>{const o=e.openGLImageSlice.getKeyMatrices().mcwc,s=e.openGLCamera.getKeyMatrices(i).wcpc;if(vt(e.imagemat,s,o),r.getCABO().getCoordShiftAndScaleEnabled()){const c=r.getCABO().getInverseShiftAndScaleMatrix();vt(e.imagemat,e.imagemat,c)}r.getProgram().setUniformMatrix("MCPCMatrix",e.imagemat)},t.setPropertyShaderParameters=(r,i,a)=>{const o=r.getProgram(),s=a.getProperty(),c=s.getOpacity();o.setUniformf("opacity",c);const l=e.volumeTexture.getComponents(),f=s.getIndependentComponents();if(f)for(let h=0;h<l;++h)o.setUniformf(`mix${h}`,s.getComponentWeight(h));const u=e.volumeTexture.getVolumeInfo();for(let h=0;h<l;h++){let p=s.getColorWindow(),m=s.getColorLevel();const v=f?h:0,y=s.getRGBTransferFunction(v);if(y&&s.getUseLookupTableScalarRange()){const w=y.getRange();p=w[1]-w[0],m=.5*(w[1]+w[0])}const T=u.scale[h]/p,C=(u.offset[h]-m)/p+.5;o.setUniformf(`cshift${h}`,C),o.setUniformf(`cscale${h}`,T)}const g=e.colorTexture.getTextureUnit();o.setUniformi("colorTexture1",g);for(let h=0;h<l;h++){let p=1,m=0;const v=f?h:0,y=s.getPiecewiseFunction(v);if(y){const T=y.getRange(),C=T[1]-T[0],w=.5*(T[0]+T[1]);p=u.scale[h]/C,m=(u.offset[h]-w)/C+.5}o.setUniformf(`pwfshift${h}`,m),o.setUniformf(`pwfscale${h}`,p)}const d=e.pwfTexture.getTextureUnit();o.setUniformi("pwfTexture1",d)},t.updateShaders=(r,i,a)=>{if(t.getNeedToRebuildShaders(r,i,a)){const o={Vertex:null,Fragment:null,Geometry:null};t.buildShaders(o,i,a);const s=e._openGLRenderWindow.getShaderCache().readyShaderProgramArray(o.Vertex,o.Fragment,o.Geometry);s!==r.getProgram()&&(r.setProgram(s),r.getVAO().releaseGraphicsResources()),r.getShaderSourceTime().modified()}else e._openGLRenderWindow.getShaderCache().readyShaderProgram(r.getProgram());r.getVAO().bind(),t.setMapperShaderParameters(r,i,a),t.setCameraShaderParameters(r,i,a),t.setPropertyShaderParameters(r,i,a)},t.delete=P.chain(()=>{e._openGLRenderWindow&&n(e._openGLRenderWindow)},t.delete)}const r$={currentRenderPass:null,volumeTexture:null,colorTexture:null,pwfTexture:null,tris:null,lastHaveSeenDepthRequest:!1,haveSeenDepthRequest:!1,lastTextureComponents:0,lastIndependentComponents:0,imagemat:null,imagematinv:null};function i$(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,r$,n),Bt.extend(t,e,n),To.implementReplaceShaderCoincidentOffset(t,e,n),P.algo(t,e,2,0),e.tris=Oo.newInstance(),e.volumeTexture=null,e.colorTexture=null,e.pwfTexture=null,e.imagemat=Be(new Float64Array(16)),e.imagematinv=Be(new Float64Array(16)),e.VBOBuildTime={},P.obj(e.VBOBuildTime,{mtime:0}),n$(t,e)}const UO=P.newInstance(i$,"vtkOpenGLImageCPRMapper"),a$={};var o$={newInstance:UO,...a$};Wn("vtkImageCPRMapper",UO);function s$(t,e){e.classHierarchy.push("vtkOpenGLImageSlice"),t.buildPass=n=>{if(!(!e.renderable||!e.renderable.getVisibility())&&n){if(!e.renderable)return;e._openGLRenderWindow=t.getLastAncestorOfType("vtkOpenGLRenderWindow"),e._openGLRenderer=t.getFirstAncestorOfType("vtkOpenGLRenderer"),e.context=e._openGLRenderWindow.getContext(),t.prepareNodes(),t.addMissingNode(e.renderable.getMapper()),t.removeUnusedNodes()}},t.traverseZBufferPass=n=>{!e.renderable||!e.renderable.getNestedVisibility()||e._openGLRenderer.getSelector()&&!e.renderable.getNestedPickable()||(t.apply(n,!0),e.children.forEach(r=>{r.traverse(n)}),t.apply(n,!1))},t.traverseOpaqueZBufferPass=n=>t.traverseOpaquePass(n),t.traverseOpaquePass=n=>{!e.renderable||!e.renderable.getNestedVisibility()||!e.renderable.getIsOpaque()||e._openGLRenderer.getSelector()&&!e.renderable.getNestedPickable()||(t.apply(n,!0),e.children.forEach(r=>{r.traverse(n)}),t.apply(n,!1))},t.traverseTranslucentPass=n=>{!e.renderable||!e.renderable.getNestedVisibility()||e.renderable.getIsOpaque()||e._openGLRenderer.getSelector()&&!e.renderable.getNestedPickable()||(t.apply(n,!0),e.children.forEach(r=>{r.traverse(n)}),t.apply(n,!1))},t.queryPass=(n,r)=>{if(n){if(!e.renderable||!e.renderable.getVisibility())return;e.renderable.getIsOpaque()?r.incrementOpaqueActorCount():r.incrementTranslucentActorCount()}},t.zBufferPass=(n,r)=>t.opaquePass(n,r),t.opaqueZBufferPass=(n,r)=>t.opaquePass(n,r),t.opaquePass=(n,r)=>{n&&e.context.depthMask(!0)},t.translucentPass=(n,r)=>{e.context.depthMask(!n)},t.getKeyMatrices=()=>(e.renderable.getMTime()>e.keyMatrixTime.getMTime()&&(nn(e.keyMatrices.mcwc,e.renderable.getMatrix()),ft(e.keyMatrices.mcwc,e.keyMatrices.mcwc),e.keyMatrixTime.modified()),e.keyMatrices)}const c$={context:null,keyMatrixTime:null,keyMatrices:null};function l$(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,c$,n),Bt.extend(t,e,n),e.keyMatrixTime={},zt(e.keyMatrixTime,{mtime:0}),e.keyMatrices={mcwc:Be(new Float64Array(16))},Vn(t,e,["context"]),s$(t,e)}const BO=Rt(l$,"vtkOpenGLImageSlice");var u$={newInstance:BO};Wn("vtkImageSlice",BO);const{vtkDebugMacro:f$}=Ir;function g$(t,e){e.classHierarchy.push("vtkOpenGLPixelSpaceCallbackMapper"),t.opaquePass=(n,r)=>{e._openGLRenderer=t.getFirstAncestorOfType("vtkOpenGLRenderer"),e._openGLRenderWindow=e._openGLRenderer.getLastAncestorOfType("vtkOpenGLRenderWindow");const i=e._openGLRenderer.getAspectRatio(),a=e._openGLRenderer?e._openGLRenderer.getRenderable().getActiveCamera():null,o=e._openGLRenderer.getTiledSizeAndOrigin();let s=null;if(e.renderable.getUseZValues()){const c=r.getZBufferTexture(),l=Math.floor(c.getWidth()),f=Math.floor(c.getHeight()),u=e._openGLRenderWindow.getContext();c.bind();const g=r.getFramebuffer();g?g.saveCurrentBindingsAndBuffers():f$("No framebuffer to save/restore");const d=u.createFramebuffer();u.bindFramebuffer(u.FRAMEBUFFER,d),u.framebufferTexture2D(u.FRAMEBUFFER,u.COLOR_ATTACHMENT0,u.TEXTURE_2D,c.getHandle(),0),u.checkFramebufferStatus(u.FRAMEBUFFER)===u.FRAMEBUFFER_COMPLETE&&(s=new Uint8Array(l*f*4),u.viewport(0,0,l,f),u.readPixels(0,0,l,f,u.RGBA,u.UNSIGNED_BYTE,s)),g&&g.restorePreviousBindingsAndBuffers(),u.deleteFramebuffer(d)}e.renderable.invokeCallback(e.renderable.getInputData(),a,i,o,s)},t.queryPass=(n,r)=>{n&&e.renderable.getUseZValues()&&r.requestDepth()}}const d$={};function p$(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,d$,n),Bt.extend(t,e,n),g$(t,e)}const GO=Rt(p$,"vtkOpenGLPixelSpaceCallbackMapper");var h$={newInstance:GO};Wn("vtkPixelSpaceCallbackMapper",GO);const{vtkDebugMacro:m$}=Ir;function v$(t,e){e.classHierarchy.push("vtkOpenGLRenderer"),t.buildPass=n=>{if(n){if(!e.renderable)return;t.updateLights(),t.prepareNodes(),t.addMissingNode(e.renderable.getActiveCamera()),t.addMissingNodes(e.renderable.getViewPropsWithNestedProps()),t.removeUnusedNodes()}},t.updateLights=()=>{let n=0;const r=e.renderable.getLightsByReference();for(let i=0;i<r.length;++i)r[i].getSwitch()>0&&n++;return n||(m$("No lights are on, creating one."),e.renderable.createLight()),n},t.zBufferPass=n=>{if(n){let r=0;const i=e.context;e.renderable.getTransparent()||(e.context.clearColor(1,0,0,1),r|=i.COLOR_BUFFER_BIT),e.renderable.getPreserveDepthBuffer()||(i.clearDepth(1),r|=i.DEPTH_BUFFER_BIT,e.context.depthMask(!0));const a=t.getTiledSizeAndOrigin();i.enable(i.SCISSOR_TEST),i.scissor(a.lowerLeftU,a.lowerLeftV,a.usize,a.vsize),i.viewport(a.lowerLeftU,a.lowerLeftV,a.usize,a.vsize),i.colorMask(!0,!0,!0,!0),r&&i.clear(r),i.enable(i.DEPTH_TEST)}},t.opaqueZBufferPass=n=>t.zBufferPass(n),t.cameraPass=n=>{n&&t.clear()},t.getAspectRatio=()=>{const n=e._parent.getSizeByReference(),r=e.renderable.getViewportByReference();return n[0]*(r[2]-r[0])/((r[3]-r[1])*n[1])},t.getTiledSizeAndOrigin=()=>{const n=e.renderable.getViewportByReference(),r=[0,0,1,1],i=n[0]-r[0],a=n[1]-r[1],o=e._parent.normalizedDisplayToDisplay(i,a),s=Math.round(o[0]),c=Math.round(o[1]),l=n[2]-r[0],f=n[3]-r[1],u=e._parent.normalizedDisplayToDisplay(l,f);let g=Math.round(u[0])-s,d=Math.round(u[1])-c;return g<0&&(g=0),d<0&&(d=0),{usize:g,vsize:d,lowerLeftU:s,lowerLeftV:c}},t.clear=()=>{let n=0;const r=e.context;if(!e.renderable.getTransparent()){const a=e.renderable.getBackgroundByReference();r.clearColor(a[0],a[1],a[2],a[3]),n|=r.COLOR_BUFFER_BIT}e.renderable.getPreserveDepthBuffer()||(r.clearDepth(1),n|=r.DEPTH_BUFFER_BIT,r.depthMask(!0)),r.colorMask(!0,!0,!0,!0);const i=t.getTiledSizeAndOrigin();r.enable(r.SCISSOR_TEST),r.scissor(i.lowerLeftU,i.lowerLeftV,i.usize,i.vsize),r.viewport(i.lowerLeftU,i.lowerLeftV,i.usize,i.vsize),n&&r.clear(n),r.enable(r.DEPTH_TEST)},t.releaseGraphicsResources=()=>{e.selector!==null&&e.selector.releaseGraphicsResources(),e.renderable&&e.renderable.getViewProps().forEach(n=>{n.modified()})},t.setOpenGLRenderWindow=n=>{e._openGLRenderWindow!==n&&(t.releaseGraphicsResources(),e._openGLRenderWindow=n,e.context=null,n&&(e.context=e._openGLRenderWindow.getContext()))}}const y$={context:null,_openGLRenderWindow:null,selector:null};function T$(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,y$,n),Bt.extend(t,e,n),hi(t,e,["shaderCache"]),Vn(t,e,["selector"]),fd(t,e,["openGLRenderWindow"]),v$(t,e)}const $O=Rt(T$,"vtkOpenGLRenderer");var C$={newInstance:$O};Wn("vtkRenderer",$O);const{vtkErrorMacro:A9}=Ir;function w$(t,e){e.classHierarchy.push("vtkOpenGLSkybox"),t.buildPass=n=>{if(n){e._openGLRenderer=t.getFirstAncestorOfType("vtkOpenGLRenderer"),e._openGLRenderWindow=e._openGLRenderer.getParent(),e.context=e._openGLRenderWindow.getContext(),e.tris.setOpenGLRenderWindow(e._openGLRenderWindow),e.openGLTexture.setOpenGLRenderWindow(e._openGLRenderWindow);const r=e._openGLRenderer.getRenderable();e.openGLCamera=e._openGLRenderer.getViewNodeFor(r.getActiveCamera())}},t.queryPass=(n,r)=>{if(n){if(!e.renderable||!e.renderable.getVisibility())return;r.incrementOpaqueActorCount()}},t.opaquePass=(n,r)=>{if(n&&!e._openGLRenderer.getSelector()){t.updateBufferObjects(),e.context.depthMask(!0),e._openGLRenderWindow.getShaderCache().readyShaderProgram(e.tris.getProgram()),e.openGLTexture.render(e._openGLRenderWindow);const i=e.openGLTexture.getTextureUnit();e.tris.getProgram().setUniformi("sbtexture",i);const a=e._openGLRenderer.getRenderable(),o=e.openGLCamera.getKeyMatrices(a),s=new Float64Array(16);if(Ln(s,o.wcpc),e.tris.getProgram().setUniformMatrix("IMCPCMatrix",s),e.lastFormat==="box"){const c=a.getActiveCamera().getPosition();e.tris.getProgram().setUniform3f("camPos",c[0],c[1],c[2])}e.tris.getVAO().bind(),e.context.drawArrays(e.context.TRIANGLES,0,e.tris.getCABO().getElementCount()),e.tris.getVAO().release(),e.openGLTexture.deactivate()}},t.updateBufferObjects=()=>{if(!e.tris.getCABO().getElementCount()){const r=new Float32Array(12);for(let s=0;s<4;s++)r[s*3]=s%2*2-1,r[s*3+1]=s>1?1:-1,r[s*3+2]=1;const i=nt.newInstance({numberOfComponents:3,values:r});i.setName("points");const a=new Uint16Array(8);a[0]=3,a[1]=0,a[2]=1,a[3]=3,a[4]=3,a[5]=0,a[6]=3,a[7]=2;const o=nt.newInstance({numberOfComponents:1,values:a});e.tris.getCABO().createVBO(o,"polys",_r.SURFACE,{points:i,cellOffset:0})}e.renderable.getFormat()!==e.lastFormat&&(e.lastFormat=e.renderable.getFormat(),e.lastFormat==="box"&&e.tris.setProgram(e._openGLRenderWindow.getShaderCache().readyShaderProgramArray(`//VTK::System::Dec
             attribute vec3 vertexMC;
             uniform mat4 IMCPCMatrix;
             varying vec3 TexCoords;
             void main () {
              gl_Position = vec4(vertexMC.xyz, 1.0);
              vec4 wpos = IMCPCMatrix * gl_Position;
              TexCoords = wpos.xyz/wpos.w;
             }`,`//VTK::System::Dec
             //VTK::Output::Dec
             varying vec3 TexCoords;
             uniform samplerCube sbtexture;
             uniform vec3 camPos;
             void main () {
               // skybox looks from inside out
               // which means we have to adjust
               // our tcoords. Otherwise text would
               // be flipped
               vec3 tc = normalize(TexCoords - camPos);
               if (abs(tc.z) < max(abs(tc.x),abs(tc.y)))
               {
                 tc = vec3(1.0, 1.0, -1.0) * tc;
               }
               else
               {
                 tc = vec3(-1.0, 1.0, 1.0) * tc;
               }
               gl_FragData[0] = textureCube(sbtexture, tc);
             }`,"")),e.lastFormat==="background"&&e.tris.setProgram(e._openGLRenderWindow.getShaderCache().readyShaderProgramArray(`//VTK::System::Dec
             attribute vec3 vertexMC;
             uniform mat4 IMCPCMatrix;
             varying vec2 TexCoords;
             void main () {
              gl_Position = vec4(vertexMC.xyz, 1.0);
              vec4 wpos = IMCPCMatrix * gl_Position;
              TexCoords = vec2(vertexMC.x, vertexMC.y)*0.5 + 0.5;
             }`,`//VTK::System::Dec
             //VTK::Output::Dec
             varying vec2 TexCoords;
             uniform sampler2D sbtexture;
             void main () {
               gl_FragData[0] = texture2D(sbtexture, TexCoords);
             }`,"")),e.tris.getShaderSourceTime().modified(),e.tris.getVAO().bind(),e.tris.getVAO().addAttributeArray(e.tris.getProgram(),e.tris.getCABO(),"vertexMC",e.tris.getCABO().getVertexOffset(),e.tris.getCABO().getStride(),e.context.FLOAT,3,e.context.FALSE)||A9("Error setting vertexMC in shader VAO."));const n=e.renderable.getTextures();n.length||A9("vtkSkybox requires a texture map"),e.openGLTexture.getRenderable()!==n[0]&&(e.openGLTexture.releaseGraphicsResources(e._openGLRenderWindow),e.openGLTexture.setRenderable(n[0]))}}const x$={context:null};function S$(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,x$,n),Bt.extend(t,e,n),e.openGLTexture=Xt.newInstance(),e.tris=Oo.newInstance(),e.keyMatrixTime={},zt(e.keyMatrixTime,{mtime:0}),e.keyMatrices={normalMatrix:ya(new Float64Array(9)),mcwc:Be(new Float64Array(16))},Vn(t,e,["context"]),hi(t,e,["activeTextures"]),w$(t,e)}const WO=Rt(S$);var E$={newInstance:WO};Wn("vtkSkybox",WO);var O$=`//VTK::System::Dec

/*=========================================================================

  Program:   Visualization Toolkit
  Module:    vtkSphereMapperVS.glsl

  Copyright (c) Ken Martin, Will Schroeder, Bill Lorensen
  All rights reserved.
  See Copyright.txt or http://www.kitware.com/Copyright.htm for details.

     This software is distributed WITHOUT ANY WARRANTY; without even
     the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR
     PURPOSE.  See the above copyright notice for more information.

=========================================================================*/
// this shader implements imposters in OpenGL for Spheres

attribute vec4 vertexMC;
attribute vec2 offsetMC;

// optional normal declaration
//VTK::Normal::Dec

//VTK::Picking::Dec

// Texture coordinates
//VTK::TCoord::Dec

uniform mat3 normalMatrix; // transform model coordinate directions to view coordinates

// material property values
//VTK::Color::Dec

// clipping plane vars
//VTK::Clip::Dec

// camera and actor matrix values
//VTK::Camera::Dec

varying vec4 vertexVCVSOutput;
varying float radiusVCVSOutput;
varying vec3 centerVCVSOutput;

uniform int cameraParallel;
uniform float scaleFactor;

void main()
{
  //VTK::Picking::Impl

  //VTK::Color::Impl

  //VTK::Normal::Impl

  //VTK::TCoord::Impl

  //VTK::Clip::Impl

  // compute the projected vertex position
  vec2 scaledOffsetMC = scaleFactor * offsetMC;
  vertexVCVSOutput = MCVCMatrix * vertexMC;
  centerVCVSOutput = vertexVCVSOutput.xyz;
  radiusVCVSOutput = length(scaledOffsetMC)*0.5;

  // make the triangle face the camera
  if (cameraParallel == 0)
    {
    vec3 dir = normalize(-vertexVCVSOutput.xyz);
    vec3 base2 = normalize(cross(dir,vec3(1.0,0.0,0.0)));
    vec3 base1 = cross(base2,dir);
    vertexVCVSOutput.xyz = vertexVCVSOutput.xyz + scaledOffsetMC.x*base1 + scaledOffsetMC.y*base2;
    }
  else
    {
    // add in the offset
    vertexVCVSOutput.xy = vertexVCVSOutput.xy + scaledOffsetMC;
    }

  gl_Position = VCPCMatrix * vertexVCVSOutput;
}
`;const{vtkErrorMacro:D$}=Ir;function R$(t,e){e.classHierarchy.push("vtkOpenGLSphereMapper");const n={...t};t.getShaderTemplate=(r,i,a)=>{r.Vertex=O$,r.Fragment=yd,r.Geometry=""},t.replaceShaderValues=(r,i,a)=>{let o=r.Vertex,s=r.Fragment;o=te.substitute(o,"//VTK::Camera::Dec",[`uniform mat4 VCPCMatrix;
`,"uniform mat4 MCVCMatrix;"]).result,s=te.substitute(s,"//VTK::PositionVC::Dec",["varying vec4 vertexVCVSOutput;"]).result,s=te.substitute(s,"//VTK::PositionVC::Impl",[`vec4 vertexVC = vertexVCVSOutput;
`]).result;const c=[`uniform float invertedDepth;
`,`uniform int cameraParallel;
`,`varying float radiusVCVSOutput;
`,`varying vec3 centerVCVSOutput;
`,`uniform mat4 VCPCMatrix;
`];s=te.substitute(s,"//VTK::Normal::Dec",c).result;let l="";e.context.getExtension("EXT_frag_depth")&&(l=`gl_FragDepthEXT = (pos.z / pos.w + 1.0) / 2.0;
`),e._openGLRenderWindow.getWebgl2()&&(l=`gl_FragDepth = (pos.z / pos.w + 1.0) / 2.0;
`),s=te.substitute(s,"//VTK::Depth::Impl",[`  vec3 EyePos;
`,`  vec3 EyeDir;
`,`  if (cameraParallel != 0) {
`,`    EyePos = vec3(vertexVC.x, vertexVC.y, vertexVC.z + 3.0*radiusVCVSOutput);
`,`    EyeDir = vec3(0.0,0.0,-1.0); }
`,`  else {
`,`    EyeDir = vertexVC.xyz;
`,`    EyePos = vec3(0.0,0.0,0.0);
`,`    float lengthED = length(EyeDir);
`,`    EyeDir = normalize(EyeDir);
`,`    if (lengthED > radiusVCVSOutput*3.0) {
`,`      EyePos = vertexVC.xyz - EyeDir*3.0*radiusVCVSOutput; }
`,`    }
`,`  EyePos = EyePos - centerVCVSOutput;
`,`  EyePos = EyePos/radiusVCVSOutput;
`,`  float b = 2.0*dot(EyePos,EyeDir);
`,`  float c = dot(EyePos,EyePos) - 1.0;
`,`  float d = b*b - 4.0*c;
`,`  vec3 normalVCVSOutput = vec3(0.0,0.0,1.0);
`,`  if (d < 0.0) { discard; }
`,`  else {
`,`    float t = (-b - invertedDepth*sqrt(d))*0.5;
`,`    normalVCVSOutput = invertedDepth*normalize(EyePos + t*EyeDir);
`,`    vertexVC.xyz = normalVCVSOutput*radiusVCVSOutput + centerVCVSOutput;
`,`    }
`,`  vec4 pos = VCPCMatrix * vertexVC;
`,l]).result,s=te.substitute(s,"//VTK::Normal::Impl","").result,e.haveSeenDepthRequest&&(s=te.substitute(s,"//VTK::ZBuffer::Impl",["if (depthRequest == 1) {","float computedZ = (pos.z / pos.w + 1.0) / 2.0;","float iz = floor(computedZ * 65535.0 + 0.1);","float rf = floor(iz/256.0)/255.0;","float gf = mod(iz,256.0)/255.0;","gl_FragData[0] = vec4(rf, gf, 0.0, 1.0); }"]).result),r.Vertex=o,r.Fragment=s,n.replaceShaderValues(r,i,a)},t.setMapperShaderParameters=(r,i,a)=>{if(r.getCABO().getElementCount()&&(e.VBOBuildTime>r.getAttributeUpdateTime().getMTime()||r.getShaderSourceTime().getMTime()>r.getAttributeUpdateTime().getMTime())&&r.getProgram().isAttributeUsed("offsetMC")&&(r.getVAO().addAttributeArray(r.getProgram(),r.getCABO(),"offsetMC",12,r.getCABO().getStride(),e.context.FLOAT,2,!1)||D$("Error setting 'offsetMC' in shader VAO.")),r.getProgram().isUniformUsed("invertedDepth")&&r.getProgram().setUniformf("invertedDepth",e.invert?-1:1),r.getProgram().isUniformUsed("scaleFactor")){const s=e.currentInput.getPointData();e.renderable.getScaleArray()!=null&&s.hasArray(e.renderable.getScaleArray())?r.getProgram().setUniformf("scaleFactor",e.renderable.getScaleFactor()):r.getProgram().setUniformf("scaleFactor",1)}n.setMapperShaderParameters(r,i,a)},t.setCameraShaderParameters=(r,i,a)=>{const o=r.getProgram(),s=i.getActiveCamera(),c=e.openGLCamera.getKeyMatrices(i);if(o.isUniformUsed("VCPCMatrix")&&o.setUniformMatrix("VCPCMatrix",c.vcpc),o.isUniformUsed("MCVCMatrix"))if(a.getIsIdentity())o.setUniformMatrix("MCVCMatrix",c.wcvc);else{const l=e.openGLActor.getKeyMatrices(),f=new Float64Array(16);vt(f,c.wcvc,l.mcwc),o.setUniformMatrix("MCVCMatrix",f)}o.isUniformUsed("cameraParallel")&&r.getProgram().setUniformi("cameraParallel",s.getParallelProjection())},t.getOpenGLMode=(r,i)=>e.context.TRIANGLES,t.buildBufferObjects=(r,i)=>{const a=e.currentInput;if(a===null)return;e.renderable.mapScalars(a,1);const o=e.renderable.getColorMapColors(),s=e.primitives[e.primTypes.Tris].getCABO(),c=a.getPointData(),l=a.getPoints(),f=l.getNumberOfPoints(),u=l.getData(),g=5;let d=null;e.renderable.getScaleArray()!=null&&c.hasArray(e.renderable.getScaleArray())&&(d=c.getArray(e.renderable.getScaleArray()).getData());let h=null,p=0,m=null;o?(p=o.getNumberOfComponents(),s.setColorOffset(0),s.setColorBOStride(4),h=o.getData(),m=new Uint8Array(3*f*4),s.getColorBO()||s.setColorBO(ns.newInstance()),s.getColorBO().setOpenGLRenderWindow(e._openGLRenderWindow)):s.getColorBO()&&s.setColorBO(null),s.setColorComponents(p);const v=new Float32Array(g*f*3);s.setStride(g*4);const y=Math.cos(hn(30));let T=0,C=0,w=0,x=0;for(let O=0;O<f;++O){let M=e.renderable.getRadius();d&&(M=d[O]),T=O*3,v[w++]=u[T++],v[w++]=u[T++],v[w++]=u[T++],v[w++]=-2*M*y,v[w++]=-M,h&&(C=O*p,m[x++]=h[C],m[x++]=h[C+1],m[x++]=h[C+2],m[x++]=h[C+3]),T=O*3,v[w++]=u[T++],v[w++]=u[T++],v[w++]=u[T++],v[w++]=2*M*y,v[w++]=-M,h&&(m[x++]=h[C],m[x++]=h[C+1],m[x++]=h[C+2],m[x++]=h[C+3]),T=O*3,v[w++]=u[T++],v[w++]=u[T++],v[w++]=u[T++],v[w++]=0,v[w++]=2*M,h&&(m[x++]=h[C],m[x++]=h[C+1],m[x++]=h[C+2],m[x++]=h[C+3])}s.setElementCount(w/g),s.upload(v,ss.ARRAY_BUFFER),o&&s.getColorBO().upload(m,ss.ARRAY_BUFFER),e.VBOBuildTime.modified()}}const M$={};function _$(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,M$,n),x2.extend(t,e,n),R$(t,e)}const zO=Rt(_$,"vtkOpenGLSphereMapper");var b$={newInstance:zO};Wn("vtkSphereMapper",zO);var L$=`//VTK::System::Dec

/*=========================================================================

  Program:   Visualization Toolkit
  Module:    vtkStickMapperVS.glsl

  Copyright (c) Ken Martin, Will Schroeder, Bill Lorensen
  All rights reserved.
  See Copyright.txt or http://www.kitware.com/Copyright.htm for details.

     This software is distributed WITHOUT ANY WARRANTY; without even
     the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR
     PURPOSE.  See the above copyright notice for more information.

=========================================================================*/
// this shader implements imposters in OpenGL for Sticks

attribute vec4 vertexMC;
attribute vec3 orientMC;
attribute vec4 offsetMC;
attribute float radiusMC;

// optional normal declaration
//VTK::Normal::Dec

//VTK::Picking::Dec

// Texture coordinates
//VTK::TCoord::Dec

uniform mat3 normalMatrix; // transform model coordinate directions to view coordinates

// material property values
//VTK::Color::Dec

// clipping plane vars
//VTK::Clip::Dec

// camera and actor matrix values
//VTK::Camera::Dec

varying vec4 vertexVCVSOutput;
varying float radiusVCVSOutput;
varying float lengthVCVSOutput;
varying vec3 centerVCVSOutput;
varying vec3 orientVCVSOutput;

uniform int cameraParallel;

void main()
{
  //VTK::Picking::Impl

  //VTK::Color::Impl

  //VTK::Normal::Impl

  //VTK::TCoord::Impl

  //VTK::Clip::Impl

  vertexVCVSOutput = MCVCMatrix * vertexMC;
  centerVCVSOutput = vertexVCVSOutput.xyz;
  radiusVCVSOutput = radiusMC;
  lengthVCVSOutput = length(orientMC);
  orientVCVSOutput = normalMatrix * normalize(orientMC);

  // make sure it is pointing out of the screen
  if (orientVCVSOutput.z < 0.0)
    {
    orientVCVSOutput = -orientVCVSOutput;
    }

  // make the basis
  vec3 xbase;
  vec3 ybase;
  vec3 dir = vec3(0.0,0.0,1.0);
  if (cameraParallel == 0)
    {
    dir = normalize(-vertexVCVSOutput.xyz);
    }
  if (abs(dot(dir,orientVCVSOutput)) == 1.0)
    {
    xbase = normalize(cross(vec3(0.0,1.0,0.0),orientVCVSOutput));
    ybase = cross(xbase,orientVCVSOutput);
    }
  else
    {
    xbase = normalize(cross(orientVCVSOutput,dir));
    ybase = cross(orientVCVSOutput,xbase);
    }

  vec3 offsets = offsetMC.xyz*2.0-1.0;
  vertexVCVSOutput.xyz = vertexVCVSOutput.xyz +
    radiusVCVSOutput*offsets.x*xbase +
    radiusVCVSOutput*offsets.y*ybase +
    0.5*lengthVCVSOutput*offsets.z*orientVCVSOutput;

  gl_Position = VCPCMatrix * vertexVCVSOutput;
}
`;const{vtkErrorMacro:r1}=Ir;function I$(t,e){e.classHierarchy.push("vtkOpenGLStickMapper");const n={...t};t.getShaderTemplate=(r,i,a)=>{r.Vertex=L$,r.Fragment=yd,r.Geometry=""},t.replaceShaderValues=(r,i,a)=>{let o=r.Vertex,s=r.Fragment;o=te.substitute(o,"//VTK::Camera::Dec",[`uniform mat4 VCPCMatrix;
`,"uniform mat4 MCVCMatrix;"]).result,s=te.substitute(s,"//VTK::PositionVC::Dec","varying vec4 vertexVCVSOutput;").result,s=te.substitute(s,"//VTK::PositionVC::Impl",`  vec4 vertexVC = vertexVCVSOutput;
`).result;const c=[`uniform int cameraParallel;
`,`varying float radiusVCVSOutput;
`,`varying vec3 orientVCVSOutput;
`,`varying float lengthVCVSOutput;
`,`varying vec3 centerVCVSOutput;
`,`uniform mat4 VCPCMatrix;
`];s=te.substitute(s,"//VTK::Normal::Dec",c).result;let l="";e.context.getExtension("EXT_frag_depth")&&(l=`  gl_FragDepthEXT = (pos.z / pos.w + 1.0) / 2.0;
`),e._openGLRenderWindow.getWebgl2()&&(l=`gl_FragDepth = (pos.z / pos.w + 1.0) / 2.0;
`),s=te.substitute(s,"//VTK::Depth::Impl",[`  vec3 EyePos;
`,`  vec3 EyeDir;
`,`  if (cameraParallel != 0) {
`,`    EyePos = vec3(vertexVC.x, vertexVC.y, vertexVC.z + 3.0*radiusVCVSOutput);
`,`    EyeDir = vec3(0.0,0.0,-1.0); }
`,`  else {
`,`    EyeDir = vertexVC.xyz;
`,`    EyePos = vec3(0.0,0.0,0.0);
`,`    float lengthED = length(EyeDir);
`,`    EyeDir = normalize(EyeDir);
`,`    if (lengthED > radiusVCVSOutput*3.0) {
`,`      EyePos = vertexVC.xyz - EyeDir*3.0*radiusVCVSOutput; }
`,`    }
`,`  EyePos = EyePos - centerVCVSOutput;
`,`  vec3 base1;
`,`  if (abs(orientVCVSOutput.z) < 0.99) {
`,`    base1 = normalize(cross(orientVCVSOutput,vec3(0.0,0.0,1.0))); }
`,`  else {
`,`    base1 = normalize(cross(orientVCVSOutput,vec3(0.0,1.0,0.0))); }
`,`  vec3 base2 = cross(orientVCVSOutput,base1);
`,`  EyePos = vec3(dot(EyePos,base1),dot(EyePos,base2),dot(EyePos,orientVCVSOutput));
`,`  EyeDir = vec3(dot(EyeDir,base1),dot(EyeDir,base2),dot(EyeDir,orientVCVSOutput));
`,`  EyePos = EyePos/radiusVCVSOutput;
`,`  float a = EyeDir.x*EyeDir.x + EyeDir.y*EyeDir.y;
`,`  float b = 2.0*(EyePos.x*EyeDir.x + EyePos.y*EyeDir.y);
`,`  float c = EyePos.x*EyePos.x + EyePos.y*EyePos.y - 1.0;
`,`  float d = b*b - 4.0*a*c;
`,`  vec3 normalVCVSOutput = vec3(0.0,0.0,1.0);
`,`  if (d < 0.0) { discard; }
`,`  else {
`,`    float t =  (-b - sqrt(d))/(2.0*a);
`,`    float tz = EyePos.z + t*EyeDir.z;
`,`    vec3 iPoint = EyePos + t*EyeDir;
`,`    if (abs(iPoint.z)*radiusVCVSOutput > lengthVCVSOutput*0.5) {
`,`      float t2 = (-b + sqrt(d))/(2.0*a);
`,`      float tz2 = EyePos.z + t2*EyeDir.z;
`,`      if (tz2*radiusVCVSOutput > lengthVCVSOutput*0.5 || tz*radiusVCVSOutput < -0.5*lengthVCVSOutput) { discard; }
`,`      else {
`,`        normalVCVSOutput = orientVCVSOutput;
`,`        float t3 = (lengthVCVSOutput*0.5/radiusVCVSOutput - EyePos.z)/EyeDir.z;
`,`        iPoint = EyePos + t3*EyeDir;
`,`        vertexVC.xyz = radiusVCVSOutput*(iPoint.x*base1 + iPoint.y*base2 + iPoint.z*orientVCVSOutput) + centerVCVSOutput;
`,`        }
`,`      }
`,`    else {
`,`      normalVCVSOutput = iPoint.x*base1 + iPoint.y*base2;
`,`      vertexVC.xyz = radiusVCVSOutput*(normalVCVSOutput + iPoint.z*orientVCVSOutput) + centerVCVSOutput;
`,`      }
`,`    }
`,`  vec4 pos = VCPCMatrix * vertexVC;
`,l]).result,s=te.substitute(s,"//VTK::Normal::Impl","").result,e.haveSeenDepthRequest&&(s=te.substitute(s,"//VTK::ZBuffer::Impl",["if (depthRequest == 1) {","float computedZ = (pos.z / pos.w + 1.0) / 2.0;","float iz = floor(computedZ * 65535.0 + 0.1);","float rf = floor(iz/256.0)/255.0;","float gf = mod(iz,256.0)/255.0;","gl_FragData[0] = vec4(rf, gf, 0.0, 1.0); }"]).result),r.Vertex=o,r.Fragment=s,n.replaceShaderValues(r,i,a)},t.setMapperShaderParameters=(r,i,a)=>{r.getCABO().getElementCount()&&(e.VBOBuildTime>r.getAttributeUpdateTime().getMTime()||r.getShaderSourceTime().getMTime()>r.getAttributeUpdateTime().getMTime())&&(r.getProgram().isAttributeUsed("orientMC")&&(r.getVAO().addAttributeArray(r.getProgram(),r.getCABO(),"orientMC",12,r.getCABO().getStride(),e.context.FLOAT,3,!1)||r1("Error setting 'orientMC' in shader VAO.")),r.getProgram().isAttributeUsed("offsetMC")&&(r.getVAO().addAttributeArray(r.getProgram(),r.getCABO().getColorBO(),"offsetMC",0,r.getCABO().getColorBOStride(),e.context.UNSIGNED_BYTE,3,!0)||r1("Error setting 'offsetMC' in shader VAO.")),r.getProgram().isAttributeUsed("radiusMC")&&(r.getVAO().addAttributeArray(r.getProgram(),r.getCABO(),"radiusMC",24,r.getCABO().getStride(),e.context.FLOAT,1,!1)||r1("Error setting 'radiusMC' in shader VAO."))),n.setMapperShaderParameters(r,i,a)},t.setCameraShaderParameters=(r,i,a)=>{const o=r.getProgram(),s=i.getActiveCamera(),c=e.openGLCamera.getKeyMatrices(i);if(o.isUniformUsed("VCPCMatrix")&&o.setUniformMatrix("VCPCMatrix",c.vcpc),a.getIsIdentity())o.isUniformUsed("MCVCMatrix")&&o.setUniformMatrix("MCVCMatrix",c.wcvc),o.isUniformUsed("normalMatrix")&&o.setUniformMatrix3x3("normalMatrix",c.normalMatrix);else{const l=e.openGLActor.getKeyMatrices();if(o.isUniformUsed("MCVCMatrix")){const f=new Float64Array(16);vt(f,c.wcvc,l.mcwc),o.setUniformMatrix("MCVCMatrix",f)}if(o.isUniformUsed("normalMatrix")){const f=new Float64Array(9);Du(f,c.normalMatrix,l.normalMatrix),o.setUniformMatrix3x3("normalMatrix",f)}}o.isUniformUsed("cameraParallel")&&r.getProgram().setUniformi("cameraParallel",s.getParallelProjection())},t.getOpenGLMode=(r,i)=>e.context.TRIANGLES,t.buildBufferObjects=(r,i)=>{const a=e.currentInput;if(a===null)return;e.renderable.mapScalars(a,1);const o=e.renderable.getColorMapColors(),s=e.primitives[e.primTypes.Tris].getCABO(),c=a.getPointData(),l=a.getPoints(),f=l.getNumberOfPoints(),u=l.getData();let g=3;g+=4;let d=null,h=0;s.setColorBOStride(4),s.getColorBO()||s.setColorBO(ns.newInstance()),s.getColorBO().setOpenGLRenderWindow(e._openGLRenderWindow),o&&(h=o.getNumberOfComponents(),s.setColorOffset(4),d=o.getData(),s.setColorBOStride(8)),s.setColorComponents(h),s.setStride(g*4);const p=new Float32Array(g*f*12),m=new Uint8Array(12*f*(d?8:4));let v=null,y=null;e.renderable.getScaleArray()!=null&&c.hasArray(e.renderable.getScaleArray())&&(v=c.getArray(e.renderable.getScaleArray()).getData()),e.renderable.getOrientationArray()!=null&&c.hasArray(e.renderable.getOrientationArray())?y=c.getArray(e.renderable.getOrientationArray()).getData():r1([`Error setting orientationArray.
`,"You have to specify the stick orientation"]);const T=[0,1,3,0,3,2,2,3,5,2,5,4];let C=0,w=0,x=0,O=0;for(let M=0;M<f;++M){let A=e.renderable.getLength(),_=e.renderable.getRadius();v&&(A=v[M*2],_=v[M*2+1]);for(let k=0;k<T.length;++k)C=M*3,p[x++]=u[C++],p[x++]=u[C++],p[x++]=u[C++],C=M*3,p[x++]=y[C++]*A,p[x++]=y[C++]*A,p[x++]=y[C++]*A,p[x++]=_,m[O++]=255*(T[k]%2),m[O++]=T[k]>=4?255:0,m[O++]=T[k]>=2?255:0,m[O++]=255,w=M*h,d&&(m[O++]=d[w],m[O++]=d[w+1],m[O++]=d[w+2],m[O++]=d[w+3])}s.setElementCount(x/g),s.upload(p,ss.ARRAY_BUFFER),s.getColorBO().upload(m,ss.ARRAY_BUFFER),e.VBOBuildTime.modified()}}const V$={};function P$(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,V$,n),x2.extend(t,e,n),I$(t,e)}const jO=Rt(P$,"vtkOpenGLStickMapper");var N$={newInstance:jO};Wn("vtkStickMapper",jO);function k$(t,e){e.classHierarchy.push("vtkOpenGLVolume"),t.buildPass=n=>{!e.renderable||!e.renderable.getVisibility()||n&&(e._openGLRenderWindow=t.getLastAncestorOfType("vtkOpenGLRenderWindow"),e._openGLRenderer=t.getFirstAncestorOfType("vtkOpenGLRenderer"),e.context=e._openGLRenderWindow.getContext(),t.prepareNodes(),t.addMissingNode(e.renderable.getMapper()),t.removeUnusedNodes())},t.queryPass=(n,r)=>{if(n){if(!e.renderable||!e.renderable.getVisibility())return;r.incrementVolumeCount()}},t.traverseVolumePass=n=>{!e.renderable||!e.renderable.getNestedVisibility()||e._openGLRenderer.getSelector()&&!e.renderable.getNestedPickable()||(t.apply(n,!0),e.children[0].traverse(n),t.apply(n,!1))},t.volumePass=n=>{!e.renderable||!e.renderable.getVisibility()||e.context.depthMask(!n)},t.getKeyMatrices=()=>(e.renderable.getMTime()>e.keyMatrixTime.getMTime()&&(e.renderable.computeMatrix(),nn(e.MCWCMatrix,e.renderable.getMatrix()),ft(e.MCWCMatrix,e.MCWCMatrix),e.renderable.getIsIdentity()?ya(e.normalMatrix):(g2(e.normalMatrix,e.MCWCMatrix),md(e.normalMatrix,e.normalMatrix),N4(e.normalMatrix,e.normalMatrix)),e.keyMatrixTime.modified()),{mcwc:e.MCWCMatrix,normalMatrix:e.normalMatrix})}const A$={};function F$(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,A$,n),Bt.extend(t,e,n),e.keyMatrixTime={},zt(e.keyMatrixTime,{mtime:0}),e.normalMatrix=new Float64Array(9),e.MCWCMatrix=new Float64Array(16),Vn(t,e,["context"]),k$(t,e)}const HO=Rt(F$,"vtkOpenGLVolume");var U$={newInstance:HO};Wn("vtkVolume",HO);const A3={NEAREST:0,LINEAR:1,FAST_LINEAR:2},KO={FRACTIONAL:0,PROPORTIONAL:1},op={CUSTOM:0,ADDITIVE:1,COLORIZE:2};var qO={InterpolationType:A3,OpacityMode:KO,ColorMixPreset:op},B$=`//VTK::System::Dec

/*=========================================================================

  Program:   Visualization Toolkit
  Module:    vtkPolyDataVS.glsl

  Copyright (c) Ken Martin, Will Schroeder, Bill Lorensen
  All rights reserved.
  See Copyright.txt or http://www.kitware.com/Copyright.htm for details.

     This software is distributed WITHOUT ANY WARRANTY; without even
     the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR
     PURPOSE.  See the above copyright notice for more information.

=========================================================================*/

attribute vec4 vertexDC;

varying vec3 vertexVCVSOutput;
uniform mat4 PCVCMatrix;

uniform float dcxmin;
uniform float dcxmax;
uniform float dcymin;
uniform float dcymax;

void main()
{
  // dcsmall is the device coords reduced to the
  // x y area covered by the volume
  vec4 dcsmall = vec4(
    dcxmin + 0.5 * (vertexDC.x + 1.0) * (dcxmax - dcxmin),
    dcymin + 0.5 * (vertexDC.y + 1.0) * (dcymax - dcymin),
    vertexDC.z,
    vertexDC.w);
  vec4 vcpos = PCVCMatrix * dcsmall;
  vertexVCVSOutput = vcpos.xyz/vcpos.w;
  gl_Position = dcsmall;
}
`,G$=`//VTK::System::Dec

/*=========================================================================

  Program:   Visualization Toolkit
  Module:    vtkVolumeFS.glsl

  Copyright (c) Ken Martin, Will Schroeder, Bill Lorensen
  All rights reserved.
  See Copyright.txt or http://www.kitware.com/Copyright.htm for details.

     This software is distributed WITHOUT ANY WARRANTY; without even
     the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR
     PURPOSE.  See the above copyright notice for more information.

=========================================================================*/
// Template for the volume mappers fragment shader

// the output of this shader
//VTK::Output::Dec

varying vec3 vertexVCVSOutput;

// first declare the settings from the mapper
// that impact the code paths in here

// always set vtkNumComponents 1,2,3,4
//VTK::NumComponents

// possibly define vtkTrilinearOn
//VTK::TrilinearOn

// possibly define UseIndependentComponents
//VTK::IndependentComponentsOn

// possibly define vtkCustomComponentsColorMix
//VTK::CustomComponentsColorMixOn

// possibly define any "proportional" components
//VTK::vtkProportionalComponents

// possibly define any components that are forced to nearest interpolation
//VTK::vtkForceNearestComponents

// Define the blend mode to use
#define vtkBlendMode //VTK::BlendMode

// Possibly define vtkImageLabelOutlineOn
//VTK::ImageLabelOutlineOn

// Possibly define vtkLabelEdgeProjectionOn
//VTK::LabelEdgeProjectionOn


#ifdef vtkImageLabelOutlineOn
  uniform float outlineOpacity;
  uniform float vpWidth;
  uniform float vpHeight;
  uniform float vpOffsetX;
  uniform float vpOffsetY;
  uniform mat4 PCWCMatrix;
  uniform mat4 vWCtoIDX;

  const int MAX_SEGMENT_INDEX = 256; // Define as per expected maximum
  // bool seenSegmentsByOriginalPos[MAX_SEGMENT_INDEX];
  #define MAX_SEGMENTS 256
  #define UINT_SIZE 32
  #define BITMASK_SIZE ((MAX_SEGMENTS + UINT_SIZE - 1) / UINT_SIZE)

  uint bitmask[BITMASK_SIZE];

  // Set the corresponding bit in the bitmask
  void setBit(int segmentIndex) {
    int index = segmentIndex / UINT_SIZE;
    int bitIndex = segmentIndex % UINT_SIZE;
    bitmask[index] |= 1u << bitIndex;
  }

  // Check if a bit is set in the bitmask
  bool isBitSet(int segmentIndex) {
    int index = segmentIndex / UINT_SIZE;
    int bitIndex = segmentIndex % UINT_SIZE;
    return ((bitmask[index] & (1u << bitIndex)) != 0u);
  }
#endif

// define vtkLightComplexity
//VTK::LightComplexity
#if vtkLightComplexity > 0
uniform float vSpecularPower;
uniform float vAmbient;
uniform float vDiffuse;
uniform float vSpecular;
//VTK::Light::Dec
#endif

//VTK::VolumeShadowOn
//VTK::SurfaceShadowOn
//VTK::localAmbientOcclusionOn
//VTK::LAO::Dec
//VTK::VolumeShadow::Dec

// define vtkComputeNormalFromOpacity
//VTK::vtkComputeNormalFromOpacity

// possibly define vtkGradientOpacityOn
//VTK::GradientOpacityOn
#ifdef vtkGradientOpacityOn
uniform float goscale0;
uniform float goshift0;
uniform float gomin0;
uniform float gomax0;
#ifdef UseIndependentComponents
#if vtkNumComponents > 1
uniform float goscale1;
uniform float goshift1;
uniform float gomin1;
uniform float gomax1;
#if vtkNumComponents > 2
uniform float goscale2;
uniform float goshift2;
uniform float gomin2;
uniform float gomax2;
#if vtkNumComponents > 3
uniform float goscale3;
uniform float goshift3;
uniform float gomin3;
uniform float gomax3;
#endif
#endif
#endif
#endif
#endif

// if you want to see the raw tiled
// data in webgl1 uncomment the following line
// #define debugtile

// camera values
uniform float camThick;
uniform float camNear;
uniform float camFar;
uniform int cameraParallel;

// values describing the volume geometry
uniform vec3 vOriginVC;
uniform vec3 vSpacing;
uniform ivec3 volumeDimensions; // 3d texture dimensions
uniform vec3 vPlaneNormal0;
uniform float vPlaneDistance0;
uniform vec3 vPlaneNormal1;
uniform float vPlaneDistance1;
uniform vec3 vPlaneNormal2;
uniform float vPlaneDistance2;
uniform vec3 vPlaneNormal3;
uniform float vPlaneDistance3;
uniform vec3 vPlaneNormal4;
uniform float vPlaneDistance4;
uniform vec3 vPlaneNormal5;
uniform float vPlaneDistance5;

//VTK::ClipPlane::Dec

// opacity and color textures
uniform sampler2D otexture;
uniform float oshift0;
uniform float oscale0;
uniform sampler2D ctexture;
uniform float cshift0;
uniform float cscale0;

#if vtkNumComponents >= 2
uniform float oshift1;
uniform float oscale1;
uniform float cshift1;
uniform float cscale1;
#endif
#if vtkNumComponents >= 3
uniform float oshift2;
uniform float oscale2;
uniform float cshift2;
uniform float cscale2;
#endif
#if vtkNumComponents >= 4
uniform float oshift3;
uniform float oscale3;
uniform float cshift3;
uniform float cscale3;
#endif

// jitter texture
uniform sampler2D jtexture;
uniform sampler2D ttexture;


// some 3D texture values
uniform float sampleDistance;
uniform vec3 vVCToIJK;
uniform vec3 volumeSpacings; // spacing in the world coorindates


// the heights defined below are the locations
// for the up to four components of the tfuns
// the tfuns have a height of 2XnumComps pixels so the
// values are computed to hit the middle of the two rows
// for that component
#ifdef UseIndependentComponents
#if vtkNumComponents == 1
uniform float mix0;
#define height0 0.5
#endif
#if vtkNumComponents == 2
uniform float mix0;
uniform float mix1;
#define height0 0.25
#define height1 0.75
#endif
#if vtkNumComponents == 3
uniform float mix0;
uniform float mix1;
uniform float mix2;
#define height0 0.17
#define height1 0.5
#define height2 0.83
#endif
#if vtkNumComponents == 4
uniform float mix0;
uniform float mix1;
uniform float mix2;
uniform float mix3;
#define height0 0.125
#define height1 0.375
#define height2 0.625
#define height3 0.875
#endif
#endif

uniform vec4 ipScalarRangeMin;
uniform vec4 ipScalarRangeMax;

// declaration for intermixed geometry
//VTK::ZBuffer::Dec

//=======================================================================
// global and custom variables (a temporary section before photorealistics rendering module is complete)
vec3 rayDirVC;
float sampleDistanceISVS;
float sampleDistanceIS;

#define SQRT3    1.7321
#define INV4PI   0.0796
#define EPSILON  0.001
#define PI       3.1415
#define PI2      9.8696

//=======================================================================
// Webgl2 specific version of functions
#if __VERSION__ == 300

uniform highp sampler3D texture1;

vec4 getTextureValue(vec3 pos)
{
  vec4 tmp = texture(texture1, pos);

  #if defined(vtkComponent0ForceNearest) || \\
      defined(vtkComponent1ForceNearest) || \\
      defined(vtkComponent2ForceNearest) || \\
      defined(vtkComponent3ForceNearest)
    vec3 nearestPos = (floor(pos * vec3(volumeDimensions)) + 0.5) / vec3(volumeDimensions);
    vec4 nearestValue = texture(texture1, nearestPos);
    #ifdef vtkComponent0ForceNearest
      tmp[0] = nearestValue[0];
    #endif
    #ifdef vtkComponent1ForceNearest
      tmp[1] = nearestValue[1];
    #endif
    #ifdef vtkComponent2ForceNearest
      tmp[2] = nearestValue[2];
    #endif
    #ifdef vtkComponent3ForceNearest
      tmp[3] = nearestValue[3];
    #endif
  #endif

  #ifndef UseIndependentComponents
    #if vtkNumComponents == 1
      tmp.a = tmp.r;
    #endif
    #if vtkNumComponents == 2
      tmp.a = tmp.g;
    #endif
    #if vtkNumComponents == 3
      tmp.a = length(tmp.rgb);
    #endif
  #endif

  return tmp;
}

//=======================================================================
// WebGL1 specific version of functions
#else

uniform sampler2D texture1;

uniform float texWidth;
uniform float texHeight;
uniform int xreps;
uniform int xstride;
uniform int ystride;

// if computing trilinear values from multiple z slices
#ifdef vtkTrilinearOn
vec4 getTextureValue(vec3 ijk)
{
  float zoff = 1.0/float(volumeDimensions.z);
  vec4 val1 = getOneTextureValue(ijk);
  vec4 val2 = getOneTextureValue(vec3(ijk.xy, ijk.z + zoff));

  float indexZ = float(volumeDimensions)*ijk.z;
  float zmix =  indexZ - floor(indexZ);

  return mix(val1, val2, zmix);
}

vec4 getOneTextureValue(vec3 ijk)
#else // nearest or fast linear
vec4 getTextureValue(vec3 ijk)
#endif
{
  vec3 tdims = vec3(volumeDimensions);

#ifdef debugtile
  vec2 tpos = vec2(ijk.x, ijk.y);
  vec4 tmp = texture2D(texture1, tpos);
  tmp.a = 1.0;

#else
  int z = int(ijk.z * tdims.z);
  int yz = z / xreps;
  int xz = z - yz*xreps;

  int tileWidth = volumeDimensions.x/xstride;
  int tileHeight = volumeDimensions.y/ystride;

  xz *= tileWidth;
  yz *= tileHeight;

  float ni = float(xz) + (ijk.x*float(tileWidth));
  float nj = float(yz) + (ijk.y*float(tileHeight));

  vec2 tpos = vec2(ni/texWidth, nj/texHeight);

  vec4 tmp = texture2D(texture1, tpos);

#if vtkNumComponents == 1
  tmp.a = tmp.r;
#endif
#if vtkNumComponents == 2
  tmp.g = tmp.a;
#endif
#if vtkNumComponents == 3
  tmp.a = length(tmp.rgb);
#endif
#endif

  return tmp;
}

// End of Webgl1 specific code
//=======================================================================
#endif

//=======================================================================
// transformation between VC and IS space

// convert vector position from idx to vc
#if (vtkLightComplexity > 0) || (defined vtkClippingPlanesOn)
vec3 IStoVC(vec3 posIS){
  vec3 posVC = posIS / vVCToIJK;
  return posVC.x * vPlaneNormal0 +
         posVC.y * vPlaneNormal2 +
         posVC.z * vPlaneNormal4 +
         vOriginVC;
}

// convert vector position from vc to idx
vec3 VCtoIS(vec3 posVC){
  posVC = posVC - vOriginVC;
  posVC = vec3(
    dot(posVC, vPlaneNormal0),
    dot(posVC, vPlaneNormal2),
    dot(posVC, vPlaneNormal4));
  return posVC * vVCToIJK;
}
#endif

//Rotate vector to view coordinate
#if (vtkLightComplexity > 0) || (defined vtkGradientOpacityOn)
void rotateToViewCoord(inout vec3 dirIS){
  dirIS.xyz =
    dirIS.x * vPlaneNormal0 +
    dirIS.y * vPlaneNormal2 +
    dirIS.z * vPlaneNormal4;
}

//Rotate vector to idx coordinate
vec3 rotateToIDX(vec3 dirVC){
  vec3 dirIS;
  dirIS.xyz = vec3(
    dot(dirVC, vPlaneNormal0),
    dot(dirVC, vPlaneNormal2),
    dot(dirVC, vPlaneNormal4));
  return dirIS;
}
#endif

//=======================================================================
// Given a normal compute the gradient opacity factors
float computeGradientOpacityFactor(
  float normalMag, float goscale, float goshift, float gomin, float gomax)
{
  return clamp(normalMag * goscale + goshift, gomin, gomax);
}

//=======================================================================
// compute the normal and gradient magnitude for a position, uses forward difference
#if (vtkLightComplexity > 0) || (defined vtkGradientOpacityOn)
  #ifdef vtkClippingPlanesOn
    void adjustClippedVoxelValues(vec3 pos, vec3 texPos[3], inout vec3 g1)
    {
      vec3 g1VC[3];
      for (int i = 0; i < 3; ++i)
      {
        g1VC[i] = IStoVC(texPos[i]);
      }
      vec3 posVC = IStoVC(pos);
      for (int i = 0; i < clip_numPlanes; ++i)
      {
        for (int j = 0; j < 3; ++j)
        {
          if(dot(vec3(vClipPlaneOrigins[i] - g1VC[j].xyz), vClipPlaneNormals[i]) > 0.0)
          {
            g1[j] = 0.0;
          }
        }
      }
    }
  #endif

  #ifdef vtkComputeNormalFromOpacity
    vec4 computeDensityNormal(vec3 opacityUCoords[2], float opactityTextureHeight, float gradientOpacity) {
      vec3 opacityG1, opacityG2;
      opacityG1.x = texture2D(otexture, vec2(opacityUCoords[0].x, opactityTextureHeight)).r;
      opacityG1.y = texture2D(otexture, vec2(opacityUCoords[0].y, opactityTextureHeight)).r;
      opacityG1.z = texture2D(otexture, vec2(opacityUCoords[0].z, opactityTextureHeight)).r;
      opacityG2.x = texture2D(otexture, vec2(opacityUCoords[1].x, opactityTextureHeight)).r;
      opacityG2.y = texture2D(otexture, vec2(opacityUCoords[1].y, opactityTextureHeight)).r;
      opacityG2.z = texture2D(otexture, vec2(opacityUCoords[1].z, opactityTextureHeight)).r;
      opacityG1.xyz *= gradientOpacity;
      opacityG2.xyz *= gradientOpacity;

      vec4 opacityG = vec4(opacityG1 - opacityG2, 1.0f);
      // divide by spacing
      opacityG.xyz /= vSpacing;
      opacityG.w = length(opacityG.xyz);
      // rotate to View Coords
      rotateToViewCoord(opacityG.xyz);
      if (!all(equal(opacityG.xyz, vec3(0.0)))) {
        return vec4(normalize(opacityG.xyz),opacityG.w);
      } else {
        return vec4(0.0);
      }
    }

    vec4 computeNormalForDensity(vec3 pos, vec3 tstep, out vec3 scalarInterp[2], const int opacityComponent)
    {
      vec3 xvec = vec3(tstep.x, 0.0, 0.0);
      vec3 yvec = vec3(0.0, tstep.y, 0.0);
      vec3 zvec = vec3(0.0, 0.0, tstep.z);
      vec3 texPosPVec[3];
      texPosPVec[0] = pos + xvec;
      texPosPVec[1] = pos + yvec;
      texPosPVec[2] = pos + zvec;
      vec3 texPosNVec[3];
      texPosNVec[0] = pos - xvec;
      texPosNVec[1] = pos - yvec;
      texPosNVec[2] = pos - zvec;
      vec3 g1, g2;

      scalarInterp[0].x = getTextureValue(texPosPVec[0])[opacityComponent];
      scalarInterp[0].y = getTextureValue(texPosPVec[1])[opacityComponent];
      scalarInterp[0].z = getTextureValue(texPosPVec[2])[opacityComponent];
      scalarInterp[1].x = getTextureValue(texPosNVec[0])[opacityComponent];
      scalarInterp[1].y = getTextureValue(texPosNVec[1])[opacityComponent];
      scalarInterp[1].z = getTextureValue(texPosNVec[2])[opacityComponent];

      #ifdef vtkClippingPlanesOn
        adjustClippedVoxelValues(pos, texPosPVec, scalarInterp[0]);
        adjustClippedVoxelValues(pos, texPosNVec, scalarInterp[1]);
      #endif
      vec4 result;
      result.x = scalarInterp[0].x - scalarInterp[1].x;
      result.y = scalarInterp[0].y - scalarInterp[1].y;
      result.z = scalarInterp[0].z - scalarInterp[1].z;
      // divide by spacing
      result.xyz /= vSpacing;
      result.w = length(result.xyz);
      // rotate to View Coords
      rotateToViewCoord(result.xyz);
      if (length(result.xyz) > 0.0) {
        return vec4(normalize(result.xyz),result.w);
      } else {
        return vec4(0.0);
      }
    }
  #endif

  // only works with dependent components
  vec4 computeNormal(vec3 pos, vec3 tstep)
  {
    vec3 xvec = vec3(tstep.x, 0.0, 0.0);
    vec3 yvec = vec3(0.0, tstep.y, 0.0);
    vec3 zvec = vec3(0.0, 0.0, tstep.z);
    vec3 texPosPVec[3];
    texPosPVec[0] = pos + xvec;
    texPosPVec[1] = pos + yvec;
    texPosPVec[2] = pos + zvec;
    vec3 texPosNVec[3];
    texPosNVec[0] = pos - xvec;
    texPosNVec[1] = pos - yvec;
    texPosNVec[2] = pos - zvec;
    vec3 g1, g2;
    g1.x = getTextureValue(texPosPVec[0]).a;
    g1.y = getTextureValue(texPosPVec[1]).a;
    g1.z = getTextureValue(texPosPVec[2]).a;
    g2.x = getTextureValue(texPosNVec[0]).a;
    g2.y = getTextureValue(texPosNVec[1]).a;
    g2.z = getTextureValue(texPosNVec[2]).a;
    #ifdef vtkClippingPlanesOn
      adjustClippedVoxelValues(pos, texPosPVec, g1);
      adjustClippedVoxelValues(pos, texPosNVec, g2);
    #endif
    vec4 result;
    result = vec4(g1 - g2, -1.0);
    // divide by spacing
    result.xyz /= vSpacing;
    result.w = length(result.xyz);
    if (result.w > 0.0){
      // rotate to View Coords
      rotateToViewCoord(result.xyz);
      return vec4(normalize(result.xyz),result.w);
    } else {
      return vec4(0.0);
    }
  }
#endif


#ifdef vtkImageLabelOutlineOn
  vec4 fragCoordToPCPos(vec4 fragCoord) {
    return vec4(
      (fragCoord.x / vpWidth - vpOffsetX - 0.5) * 2.0,
      (fragCoord.y / vpHeight - vpOffsetY - 0.5) * 2.0,
      (fragCoord.z - 0.5) * 2.0,
      1.0);
  }

  vec4 pcPosToWorldCoord(vec4 pcPos) {
    return PCWCMatrix * pcPos;
  }

  vec3 fragCoordToIndexSpace(vec4 fragCoord) {
    vec4 pcPos = fragCoordToPCPos(fragCoord);
    vec4 worldCoord = pcPosToWorldCoord(pcPos);
    vec4 vertex = (worldCoord / worldCoord.w);

    vec3 index = (vWCtoIDX * vertex).xyz;

    // half voxel fix for labelmapOutline
    return (index + vec3(0.5)) / vec3(volumeDimensions);
  }

  vec3 fragCoordToWorld(vec4 fragCoord) {
    vec4 pcPos = fragCoordToPCPos(fragCoord);
    vec4 worldCoord = pcPosToWorldCoord(pcPos);
    return worldCoord.xyz;
  }
#endif

//=======================================================================
// compute the normals and gradient magnitudes for a position
// for independent components
mat4 computeMat4Normal(vec3 pos, vec4 tValue, vec3 tstep)
{
  mat4 result;
  vec4 distX = getTextureValue(pos + vec3(tstep.x, 0.0, 0.0)) - tValue;
  vec4 distY = getTextureValue(pos + vec3(0.0, tstep.y, 0.0)) - tValue;
  vec4 distZ = getTextureValue(pos + vec3(0.0, 0.0, tstep.z)) - tValue;

  // divide by spacing
  distX /= vSpacing.x;
  distY /= vSpacing.y;
  distZ /= vSpacing.z;

  mat3 rot;
  rot[0] = vPlaneNormal0;
  rot[1] = vPlaneNormal2;
  rot[2] = vPlaneNormal4;

#if !defined(vtkComponent0Proportional)
  result[0].xyz = vec3(distX.r, distY.r, distZ.r);
  result[0].a = length(result[0].xyz);
  result[0].xyz *= rot;
  if (result[0].w > 0.0)
  {
    result[0].xyz /= result[0].w;
  }
#endif

// optionally compute the 2nd component
#if vtkNumComponents >= 2 && !defined(vtkComponent1Proportional)
  result[1].xyz = vec3(distX.g, distY.g, distZ.g);
  result[1].a = length(result[1].xyz);
  result[1].xyz *= rot;
  if (result[1].w > 0.0)
  {
    result[1].xyz /= result[1].w;
  }
#endif

// optionally compute the 3rd component
#if vtkNumComponents >= 3 && !defined(vtkComponent2Proportional)
  result[2].xyz = vec3(distX.b, distY.b, distZ.b);
  result[2].a = length(result[2].xyz);
  result[2].xyz *= rot;
  if (result[2].w > 0.0)
  {
    result[2].xyz /= result[2].w;
  }
#endif

// optionally compute the 4th component
#if vtkNumComponents >= 4 && !defined(vtkComponent3Proportional)
  result[3].xyz = vec3(distX.a, distY.a, distZ.a);
  result[3].a = length(result[3].xyz);
  result[3].xyz *= rot;
  if (result[3].w > 0.0)
  {
    result[3].xyz /= result[3].w;
  }
#endif

  return result;
}

//=======================================================================
// global shadow - secondary ray
#if defined(VolumeShadowOn) || defined(localAmbientOcclusionOn)
float random()
{
  float rand = fract(sin(dot(gl_FragCoord.xy,vec2(12.9898,78.233)))*43758.5453123);
  float jitter=texture2D(jtexture,gl_FragCoord.xy/32.).r;
  uint pcg_state = floatBitsToUint(jitter);
  uint state = pcg_state;
  pcg_state = pcg_state * uint(747796405) + uint(2891336453);
  uint word = ((state >> ((state >> uint(28)) + uint(4))) ^ state) * uint(277803737);
  return (float((((word >> uint(22)) ^ word) >> 1 ))/float(2147483647) + rand)/2.0;
}
#endif

#ifdef VolumeShadowOn
// henyey greenstein phase function
float phase_function(float cos_angle)
{
  // divide by 2.0 instead of 4pi to increase intensity
  return ((1.0-anisotropy2)/pow(1.0+anisotropy2-2.0*anisotropy*cos_angle, 1.5))/2.0;
}

// Computes the intersection between a ray and a box
struct Hit
{
  float tmin;
  float tmax;
};

struct Ray
{
  vec3 origin;
  vec3 dir;
  vec3 invDir;
};

bool BBoxIntersect(vec3 boundMin, vec3 boundMax, const Ray r, out Hit hit)
{
  vec3 tbot = r.invDir * (boundMin - r.origin);
  vec3 ttop = r.invDir * (boundMax - r.origin);
  vec3 tmin = min(ttop, tbot);
  vec3 tmax = max(ttop, tbot);
  vec2 t = max(tmin.xx, tmin.yz);
  float t0 = max(t.x, t.y);
  t = min(tmax.xx, tmax.yz);
  float t1 = min(t.x, t.y);
  hit.tmin = t0;
  hit.tmax = t1;
  return t1 > max(t0,0.0);
}

// As BBoxIntersect requires the inverse of the ray coords,
// this function is used to avoid numerical issues
void safe_0_vector(inout Ray ray)
{
  if(abs(ray.dir.x) < EPSILON) ray.dir.x = sign(ray.dir.x) * EPSILON;
  if(abs(ray.dir.y) < EPSILON) ray.dir.y = sign(ray.dir.y) * EPSILON;
  if(abs(ray.dir.z) < EPSILON) ray.dir.z = sign(ray.dir.z) * EPSILON;
}

float volume_shadow(vec3 posIS, vec3 lightDirNormIS)
{
  float shadow = 1.0;
  float opacity = 0.0;

  // modify sample distance with a random number between 1.5 and 3.0
  float sampleDistanceISVS_jitter = sampleDistanceISVS * mix(1.5, 3.0, random());
  float opacityPrev = texture2D(otexture, vec2(getTextureValue(posIS).r * oscale0 + oshift0, 0.5)).r;

  // in case the first sample near surface has a very tiled light ray, we need to offset start position
  posIS += sampleDistanceISVS_jitter * lightDirNormIS;

  // compute the start and end points for the ray
  Ray ray;
  Hit hit;
  ray.origin = posIS;
  ray.dir = lightDirNormIS;
  safe_0_vector(ray);
  ray.invDir = 1.0/ray.dir;

  if(!BBoxIntersect(vec3(0.0),vec3(1.0), ray, hit))
  {
    return 1.0;
  }
  float maxdist = hit.tmax;

  // interpolate shadow ray length between: 1 unit of sample distance in IS to SQRT3, based on globalIlluminationReach
  float maxgi = mix(sampleDistanceISVS_jitter,SQRT3,giReach);
  maxdist = min(maxdist,maxgi);
  if(maxdist < EPSILON) {
    return 1.0;
  }

  float current_dist = 0.0;
  float current_step = length(sampleDistanceISVS_jitter * lightDirNormIS);
  float clamped_step = 0.0;

  vec4 scalar = vec4(0.0);
  while(current_dist < maxdist)
  {
#ifdef vtkClippingPlanesOn
    vec3 posVC = IStoVC(posIS);
    for (int i = 0; i < clip_numPlanes; ++i)
    {
      if (dot(vec3(vClipPlaneOrigins[i] - posVC), vClipPlaneNormals[i]) > 0.0)
      {
        current_dist = maxdist;
      }
    }
#endif
    scalar = getTextureValue(posIS);
    opacity = texture2D(otexture, vec2(scalar.r * oscale0 + oshift0, 0.5)).r;
    #if defined(vtkGradientOpacityOn) && !defined(UseIndependentComponents)
      vec4 normal = computeNormal(posIS, vec3(1.0/vec3(volumeDimensions)));
      opacity *= computeGradientOpacityFactor(normal.w, goscale0, goshift0, gomin0, gomax0);
    #endif
    shadow *= 1.0 - opacity;

    // optimization: early termination
    if (shadow < EPSILON){
      return 0.0;
    }

    clamped_step = min(maxdist - current_dist, current_step);
    posIS += clamped_step * lightDirNormIS;
    current_dist += current_step;
  }

  return shadow;
}

vec3 applyShadowRay(vec3 tColor, vec3 posIS, vec3 viewDirectionVC)
{
  vec3 vertLight = vec3(0.0);
  vec3 secondary_contrib = vec3(0.0);
  // here we assume only positional light, no effect of cones
  for (int i = 0; i < lightNum; i++)
  {
    #if(vtkLightComplexity==3)
      if (lightPositional[i] == 1){
        vertLight = lightPositionVC[i] - IStoVC(posIS);
      }else{
        vertLight = - lightDirectionVC[i];
      }
    #else
      vertLight = - lightDirectionVC[i];
    #endif
    // here we assume achromatic light, only intensity
    float dDotL = dot(viewDirectionVC, normalize(vertLight));
    // isotropic scatter returns 0.5 instead of 1/4pi to increase intensity
    float phase_attenuation = 0.5;
    if (abs(anisotropy) > EPSILON){
      phase_attenuation = phase_function(dDotL);
    }
    float vol_shadow = volume_shadow(posIS, normalize(rotateToIDX(vertLight)));
    secondary_contrib += tColor * vDiffuse * lightColor[i] * vol_shadow * phase_attenuation;
    secondary_contrib += tColor * vAmbient;
  }
  return secondary_contrib;
}
#endif

//=======================================================================
// local ambient occlusion
#ifdef localAmbientOcclusionOn
vec3 sample_direction_uniform(int i)
{
  float rand = random() * 0.5;
  float theta = PI2 * (kernelSample[i][0] + rand);
  float phi = acos(2.0 * (kernelSample[i][1] + rand) -1.0) / 2.5;
  return normalize(vec3(cos(theta)*sin(phi), sin(theta)*sin(phi), cos(phi)));
}

// return a matrix that transform startDir into z axis; startDir should be normalized
mat3 zBaseRotationalMatrix(vec3 startDir){
  vec3 axis = cross(startDir, vec3(0.0,0.0,1.0));
  float cosA = startDir.z;
  float k = 1.0 / (1.0 + cosA);
  mat3 matrix = mat3((axis.x * axis.x * k) + cosA, (axis.y * axis.x * k) - axis.z, (axis.z * axis.x * k) + axis.y,
              (axis.x * axis.y * k) + axis.z, (axis.y * axis.y * k) + cosA, (axis.z * axis.y * k) - axis.x,
              (axis.x * axis.z * k) - axis.y, (axis.y * axis.z * k) + axis.x, (axis.z * axis.z * k) + cosA);
  return matrix;
}

float computeLAO(vec3 posIS, float op, vec3 lightDir, vec4 normal){
  // apply LAO only at selected locations, otherwise return full brightness
  if (normal.w > 0.0 && op > 0.05){
    float total_transmittance = 0.0;
    mat3 inverseRotateBasis = inverse(zBaseRotationalMatrix(normalize(-normal.xyz)));
    vec3 currPos, randomDirStep;
    float weight, transmittance, opacity;
    for (int i = 0; i < kernelSize; i++)
    {
      randomDirStep = inverseRotateBasis * sample_direction_uniform(i) * sampleDistanceIS;
      weight = 1.0 - dot(normalize(lightDir), normalize(randomDirStep));
      currPos = posIS;
      transmittance = 1.0;
      for (int j = 0; j < kernelRadius ; j++){
        currPos += randomDirStep;
        // check if it's at clipping plane, if so return full brightness
        if (all(greaterThan(currPos, vec3(EPSILON))) && all(lessThan(currPos,vec3(1.0-EPSILON)))){
          opacity = texture2D(otexture, vec2(getTextureValue(currPos).r * oscale0 + oshift0, 0.5)).r;
          #ifdef vtkGradientOpacityOn
             opacity *= computeGradientOpacityFactor(normal.w, goscale0, goshift0, gomin0, gomax0);
          #endif
          transmittance *= 1.0 - opacity;
        }
        else{
          break;
        }
      }
      total_transmittance += transmittance / float(kernelRadius) * weight;

      // early termination if fully translucent
      if (total_transmittance > 1.0 - EPSILON){
        return 1.0;
      }
    }
    // average transmittance and reduce variance
    return clamp(total_transmittance / float(kernelSize), 0.3, 1.0);
  } else {
    return 1.0;
  }
}
#endif

//=======================================================================
// surface light contribution
#if vtkLightComplexity > 0
  void applyLighting(inout vec3 tColor, vec4 normal)
  {
    vec3 diffuse = vec3(0.0, 0.0, 0.0);
    vec3 specular = vec3(0.0, 0.0, 0.0);
    float df, sf = 0.0;
    for (int i = 0; i < lightNum; i++){
        df = abs(dot(normal.rgb, -lightDirectionVC[i]));
        diffuse += df * lightColor[i];
        sf = pow( abs(dot(lightHalfAngleVC[i],normal.rgb)), vSpecularPower);
        specular += sf * lightColor[i];
    }
    tColor.rgb = tColor.rgb*(diffuse*vDiffuse + vAmbient) + specular*vSpecular;
  }
  #ifdef SurfaceShadowOn
  #if vtkLightComplexity < 3
    vec3 applyLightingDirectional(vec3 posIS, vec4 tColor, vec4 normal)
    {
      // everything in VC
      vec3 diffuse = vec3(0.0);
      vec3 specular = vec3(0.0);
      #ifdef localAmbientOcclusionOn
        vec3 ambient = vec3(0.0);
      #endif
      vec3 vertLightDirection;
      for (int i = 0; i < lightNum; i++){
        float ndotL,vdotR;
        vertLightDirection = lightDirectionVC[i];
        ndotL = dot(normal.xyz, vertLightDirection);
        if (ndotL < 0.0 && twoSidedLighting)
        {
          ndotL = -ndotL;
        }
        if (ndotL > 0.0)
        {
          diffuse += ndotL * lightColor[i];
          //specular
          vdotR = dot(-rayDirVC, normalize(2.0 * ndotL * -normal.xyz + vertLightDirection));
          if (vdotR > 0.0)
          {
            specular += pow(vdotR, vSpecularPower) * lightColor[i];
          }
        }
        #ifdef localAmbientOcclusionOn
            ambient += computeLAO(posIS, tColor.a, vertLightDirection, normal);
        #endif
      }
      #ifdef localAmbientOcclusionOn
        return tColor.rgb * (diffuse * vDiffuse + vAmbient * ambient) + specular*vSpecular;
      #else
        return tColor.rgb * (diffuse * vDiffuse + vAmbient) + specular*vSpecular;
      #endif
    }
  #else
    vec3 applyLightingPositional(vec3 posIS, vec4 tColor, vec4 normal, vec3 posVC)
    {
      // everything in VC
      vec3 diffuse = vec3(0.0);
      vec3 specular = vec3(0.0);
      #ifdef localAmbientOcclusionOn
        vec3 ambient = vec3(0.0);
      #endif
      vec3 vertLightDirection;
      for (int i = 0; i < lightNum; i++){
        float distance,attenuation,ndotL,vdotR;
        vec3 lightDir;
        if (lightPositional[i] == 1){
          lightDir = lightDirectionVC[i];
          vertLightDirection = posVC - lightPositionVC[i];
          distance = length(vertLightDirection);
          vertLightDirection = normalize(vertLightDirection);
          attenuation = 1.0 / (lightAttenuation[i].x
                              + lightAttenuation[i].y * distance
                              + lightAttenuation[i].z * distance * distance);
          // per OpenGL standard cone angle is 90 or less for a spot light
          if (lightConeAngle[i] <= 90.0){
            float coneDot = dot(vertLightDirection, lightDir);
            if (coneDot >= cos(radians(lightConeAngle[i]))){  // if inside cone
              attenuation = attenuation * pow(coneDot, lightExponent[i]);
            }
            else {
              attenuation = 0.0;
            }
          }
          ndotL = dot(normal.xyz, vertLightDirection);
          if (ndotL < 0.0 && twoSidedLighting)
          {
            ndotL = -ndotL;
          }
          if (ndotL > 0.0)
          {
            diffuse += ndotL * attenuation * lightColor[i];
            //specular
            vdotR = dot(-rayDirVC, normalize(2.0 * ndotL * -normal.xyz + vertLightDirection));
            if (vdotR > 0.0)
            {
              specular += pow(vdotR, vSpecularPower) * attenuation * lightColor[i];
            }
          }
          #ifdef localAmbientOcclusionOn
            ambient += computeLAO(posIS, tColor.a, vertLightDirection, normal);
          #endif
        } else {
          vertLightDirection = lightDirectionVC[i];
          ndotL = dot(normal.xyz, vertLightDirection);
          if (ndotL < 0.0 && twoSidedLighting)
          {
            ndotL = -ndotL;
          }
          if (ndotL > 0.0)
          {
            diffuse += ndotL * lightColor[i];
            //specular
            vdotR = dot(-rayDirVC, normalize(2.0 * ndotL * -normal.xyz + vertLightDirection));
            if (vdotR > 0.0)
            {
              specular += pow(vdotR, vSpecularPower) * lightColor[i];
            }
          }
          #ifdef localAmbientOcclusionOn
            ambient += computeLAO(posIS, tColor.a, vertLightDirection, normal);
          #endif
        }
      }
      #ifdef localAmbientOcclusionOn
        return tColor.rgb * (diffuse * vDiffuse + vAmbient * ambient) + specular*vSpecular;
      #else
        return tColor.rgb * (diffuse * vDiffuse + vAmbient) + specular*vSpecular;
      #endif
    }
  #endif
  #endif
#endif

// LAO of surface shadows and volume shadows only work with dependent components
vec3 applyAllLightning(vec3 tColor, float alpha, vec3 posIS, vec4 normalLight) {
  #if vtkLightComplexity > 0
    // surface shadows if needed
    #ifdef SurfaceShadowOn
      #if vtkLightComplexity < 3
        vec3 tColorS = applyLightingDirectional(posIS, vec4(tColor, alpha), normalLight);
      #else
        vec3 tColorS = applyLightingPositional(posIS, vec4(tColor, alpha), normalLight, IStoVC(posIS));
      #endif
    #endif

    // volume shadows if needed
    #ifdef VolumeShadowOn
      vec3 tColorVS = applyShadowRay(tColor, posIS, rayDirVC);
    #endif

    // merge
    #ifdef VolumeShadowOn
      #ifdef SurfaceShadowOn
        // surface shadows + volumetric shadows
        float vol_coef = volumetricScatteringBlending * (1.0 - alpha / 2.0) * (1.0 - atan(normalLight.w) * INV4PI);
        tColor = (1.0-vol_coef) * tColorS + vol_coef * tColorVS;
      #else
        // volumetric shadows only
        tColor = tColorVS;
      #endif
    #else
      #ifdef SurfaceShadowOn
        // surface shadows only
        tColor = tColorS;
      #else
        // no shadows
        applyLighting(tColor, normal3);
      #endif
    #endif
  #endif
  return tColor;
}

  
vec4 getColorForValue(vec4 tValue, vec3 posIS, vec3 tstep)
{

// If labeloutline and not the edge labelmap, since in the edge labelmap blend
// we need the underlying data to sample through
#if defined(vtkImageLabelOutlineOn) && !defined(vtkLabelEdgeProjectionOn)
  vec3 centerPosIS = fragCoordToIndexSpace(gl_FragCoord); // pos in texture space
  vec4 centerValue = getTextureValue(centerPosIS);
  bool pixelOnBorder = false;
  vec4 tColor = texture2D(ctexture, vec2(centerValue.r * cscale0 + cshift0, 0.5));

  // Get alpha of segment from opacity function.
  tColor.a = texture2D(otexture, vec2(centerValue.r * oscale0 + oshift0, 0.5)).r;

  int segmentIndex = int(centerValue.r * 255.0);
  
  // Use texture sampling for outlineThickness
  float textureCoordinate = float(segmentIndex - 1) / 1024.0;
  float textureValue = texture2D(ttexture, vec2(textureCoordinate, 0.5)).r;

  int actualThickness = int(textureValue * 255.0);


  // If it is the background (segment index 0), we should quickly bail out. 
  // Previously, this was determined by tColor.a, which was incorrect as it
  // prevented the outline from appearing when the fill is 0.
  if (segmentIndex == 0){
    return vec4(0, 0, 0, 0);
  }

  // Only perform outline check on fragments rendering voxels that aren't invisible.
  // Saves a bunch of needless checks on the background.
  // TODO define epsilon when building shader?
  for (int i = -actualThickness; i <= actualThickness; i++) {
    for (int j = -actualThickness; j <= actualThickness; j++) {
      if (i == 0 || j == 0) {
        continue;
      }

      vec4 neighborPixelCoord = vec4(gl_FragCoord.x + float(i),
        gl_FragCoord.y + float(j),
        gl_FragCoord.z, gl_FragCoord.w);

      vec3 neighborPosIS = fragCoordToIndexSpace(neighborPixelCoord);
      vec4 value = getTextureValue(neighborPosIS);

      // If any of my neighbours are not the same value as I
      // am, this means I am on the border of the segment.
      // We can break the loops
      if (any(notEqual(value, centerValue))) {
        pixelOnBorder = true;
        break;
      }
    }

    if (pixelOnBorder == true) {
      break;
    }
  }

  // If I am on the border, I am displayed at full opacity
  if (pixelOnBorder == true) {
    tColor.a = outlineOpacity;
  }

  return tColor;

#else
  // compute the normal and gradient magnitude if needed
  // We compute it as a vec4 if possible otherwise a mat4

  #ifdef UseIndependentComponents

    // sample textures
    vec3 tColor0 = texture2D(ctexture, vec2(tValue.r * cscale0 + cshift0, height0)).rgb;
    float pwfValue0 = texture2D(otexture, vec2(tValue.r * oscale0 + oshift0, height0)).r;

    #if vtkNumComponents > 1
      vec3 tColor1 = texture2D(ctexture, vec2(tValue.g * cscale1 + cshift1, height1)).rgb;
      float pwfValue1 = texture2D(otexture, vec2(tValue.g * oscale1 + oshift1, height1)).r;

      #if vtkNumComponents > 2
        vec3 tColor2 = texture2D(ctexture, vec2(tValue.b * cscale2 + cshift2, height2)).rgb;
        float pwfValue2 = texture2D(otexture, vec2(tValue.b * oscale2 + oshift2, height2)).r;

        #if vtkNumComponents > 3
          vec3 tColor3 = texture2D(ctexture, vec2(tValue.a * cscale3 + cshift3, height3)).rgb;
          float pwfValue3 = texture2D(otexture, vec2(tValue.a * oscale3 + oshift3, height3)).r;
        #endif
      #endif
    #endif

    #if !defined(vtkCustomComponentsColorMix)
      // default path for component color mix

      // compute the normal vectors as needed
      #if (vtkLightComplexity > 0) || defined(vtkGradientOpacityOn)
        mat4 normalMat = computeMat4Normal(posIS, tValue, tstep);
      #endif

      // compute gradient opacity factors as needed
      vec4 goFactor = vec4(1.0, 1.0 ,1.0 ,1.0);
      #if defined(vtkGradientOpacityOn)
        #if !defined(vtkComponent0Proportional)
          goFactor.x =
            computeGradientOpacityFactor(normalMat[0].a, goscale0, goshift0, gomin0, gomax0);
        #endif
        #if vtkNumComponents > 1
          #if !defined(vtkComponent1Proportional)
            goFactor.y =
              computeGradientOpacityFactor(normalMat[1].a, goscale1, goshift1, gomin1, gomax1);
          #endif
          #if vtkNumComponents > 2
            #if !defined(vtkComponent2Proportional)
              goFactor.z =
                computeGradientOpacityFactor(normalMat[2].a, goscale2, goshift2, gomin2, gomax2);
            #endif
            #if vtkNumComponents > 3
              #if !defined(vtkComponent3Proportional)
                goFactor.w =
                  computeGradientOpacityFactor(normalMat[3].a, goscale3, goshift3, gomin3, gomax3);
              #endif
            #endif
          #endif
        #endif
      #endif

      // process color and opacity for each component
      #if !defined(vtkComponent0Proportional)
        float alpha = goFactor.x*mix0*pwfValue0;
        #if vtkLightComplexity > 0
          applyLighting(tColor0, normalMat[0]);
        #endif
      #else
        tColor0 *= pwfValue0;
        float alpha = mix(pwfValue0, 1.0, (1.0 - mix0));
      #endif

      #if vtkNumComponents > 1
        #if !defined(vtkComponent1Proportional)
          alpha += goFactor.y*mix1*pwfValue1;
          #if vtkLightComplexity > 0
            applyLighting(tColor1, normalMat[1]);
          #endif
        #else
          tColor1 *= pwfValue1;
          alpha *= mix(pwfValue1, 1.0, (1.0 - mix1));
        #endif

        #if vtkNumComponents > 2
          #if !defined(vtkComponent2Proportional)
            alpha += goFactor.z*mix2*pwfValue2;
            #if vtkLightComplexity > 0
              applyLighting(tColor2, normalMat[2]);
            #endif
          #else
            tColor2 *= pwfValue2;
            alpha *= mix(pwfValue2, 1.0, (1.0 - mix2));
          #endif
        #endif

        #if vtkNumComponents > 3
          #if !defined(vtkComponent3Proportional)
            alpha += goFactor.w*mix3*pwfValue3;
            #if vtkLightComplexity > 0
              applyLighting(tColor3, normalMat[3]);
            #endif
          #else
            tColor3 *= pwfValue3;
            alpha *= mix(pwfValue3, 1.0, (1.0 - mix3));
          #endif
        #endif
      #endif

      // perform final independent blend
      vec3 tColor = mix0 * tColor0;
      #if vtkNumComponents > 1
        tColor += mix1 * tColor1;
        #if vtkNumComponents > 2
          tColor += mix2 * tColor2;
          #if vtkNumComponents > 3
            tColor += mix3 * tColor3;
          #endif
        #endif
      #endif

      return vec4(tColor, alpha);
    #else
      /*
       * Mix the color information from all the independent components to get a single rgba output
       * Gradient opactity factors and normals are not computed
       *
       * You can compute these using:
       * - computeMat4Normal: always available, compute normal only for non proportional components, used by default independent component mix
       * - computeDensityNormal & computeNormalForDensity: available if ((LightComplexity > 0) || GradientOpacityOn) && ComputeNormalFromOpacity),
       *                                                   used by dependent component color mix, see code for Additive preset in OpenGl/VolumeMapper
       * - computeGradientOpacityFactor: always available, used in a lot of places
       *
       * Using applyAllLightning() is advised for shading but some features don't work well with it (volume shadows, LAO)
       * mix0, mix1, ... are defined for each component that is used and correspond to the componentWeight
       */
      //VTK::CustomComponentsColorMix::Impl
    #endif
  #else
    // dependent components

    // compute normal if needed
    #if (vtkLightComplexity > 0) || defined(vtkGradientOpacityOn)
      // use component 3 of the opacity texture as getTextureValue() sets alpha to the opacity value
      #ifdef vtkComputeNormalFromOpacity
        vec3 scalarInterp[2];
        vec4 normal0 = computeNormalForDensity(posIS, tstep, scalarInterp, 3);
      #else
        vec4 normal0 = computeNormal(posIS, tstep);
      #endif
    #endif

    // compute gradient opacity factor enabled
    #if defined(vtkGradientOpacityOn)
      float gradientOpacity = computeGradientOpacityFactor(normal0.a, goscale0, goshift0, gomin0, gomax0);
    #else
      const float gradientOpacity = 1.0;
    #endif

    // get color and opacity
    #if vtkNumComponents == 1
      vec3 tColor = texture2D(ctexture, vec2(tValue.r * cscale0 + cshift0, 0.5)).rgb;
      float alpha = gradientOpacity*texture2D(otexture, vec2(tValue.r * oscale0 + oshift0, 0.5)).r;
      if (alpha < EPSILON){
        return vec4(0.0);
      }
    #endif
    #if vtkNumComponents == 2
      vec3 tColor = vec3(tValue.r * cscale0 + cshift0);
      float alpha = gradientOpacity*texture2D(otexture, vec2(tValue.a * oscale1 + oshift1, 0.5)).r;
    #endif
    #if vtkNumComponents == 3
      vec3 tColor;
      tColor.r = tValue.r * cscale0 + cshift0;
      tColor.g = tValue.g * cscale1 + cshift1;
      tColor.b = tValue.b * cscale2 + cshift2;
      float alpha = gradientOpacity*texture2D(otexture, vec2(tValue.a * oscale0 + oshift0, 0.5)).r;
    #endif
    #if vtkNumComponents == 4
      vec3 tColor;
      tColor.r = tValue.r * cscale0 + cshift0;
      tColor.g = tValue.g * cscale1 + cshift1;
      tColor.b = tValue.b * cscale2 + cshift2;
      float alpha = gradientOpacity*texture2D(otexture, vec2(tValue.a * oscale3 + oshift3, 0.5)).r;
    #endif

    // lighting
    #if (vtkLightComplexity > 0)
      #ifdef vtkComputeNormalFromOpacity
        vec4 normalLight;
        if (!all(equal(normal0, vec4(0.0)))) {
          scalarInterp[0] = scalarInterp[0] * oscale0 + oshift0;
          scalarInterp[1] = scalarInterp[1] * oscale0 + oshift0;
          normalLight = computeDensityNormal(scalarInterp, 0.5, gradientOpacity);
          if (all(equal(normalLight, vec4(0.0)))) {
            normalLight = normal0;
          }
        }
      #else
        vec4 normalLight = normal0;
      #endif
      tColor = applyAllLightning(tColor, alpha, posIS, normalLight);
    #endif

    return vec4(tColor, alpha);
  #endif // dependent
#endif
}

bool valueWithinScalarRange(vec4 val, vec4 min, vec4 max) {
  bool withinRange = false;
  #if vtkNumComponents == 1
    if (val.r >= min.r && val.r <= max.r) {
      withinRange = true;
    }
  #else
    #ifdef UseIndependentComponents
      #if vtkNumComponents == 2
        if (val.r >= min.r && val.r <= max.r &&
            val.g >= min.g && val.g <= max.g) {
          withinRange = true;
        }
      #else
        if (all(greaterThanEqual(val, ipScalarRangeMin)) &&
            all(lessThanEqual(val, ipScalarRangeMax))) {
          withinRange = true;
        }
      #endif
    #endif
  #endif
  return withinRange;
}

#if vtkBlendMode == 6 
bool checkOnEdgeForNeighbor(int i, int j, int s, vec3 stepIS) {
    vec4 neighborPixelCoord = vec4(gl_FragCoord.x + float(i), gl_FragCoord.y + float(j), gl_FragCoord.z, gl_FragCoord.w);
    vec3 originalNeighborPosIS = fragCoordToIndexSpace(neighborPixelCoord);

    bool justSawIt = false;

    vec3 neighborPosIS = originalNeighborPosIS;

    float stepsTraveled = 0.0;


    // float neighborValue;
    for (int k = 0; k < //VTK::MaximumSamplesValue /2 ; ++k) {
        ivec3 texCoord = ivec3(neighborPosIS * vec3(volumeDimensions));
        vec4 texValue = texelFetch(texture1, texCoord, 0);

        if (int(texValue.g) == s) {
            justSawIt = true;
            break;
        }
        neighborPosIS += stepIS;
    }

    if (justSawIt){
      return false;
    }

   
    neighborPosIS = originalNeighborPosIS;
    for (int k = 0; k < //VTK::MaximumSamplesValue /2 ; ++k) {
        ivec3 texCoord = ivec3(neighborPosIS * vec3(volumeDimensions));
        vec4 texValue = texelFetch(texture1, texCoord, 0);

        if (int(texValue.g) == s) {
            justSawIt = true;
            break;
        }
        neighborPosIS -= stepIS;
    }


    if (!justSawIt) {
        // onedge
        vec3 tColorSegment = texture2D(ctexture, vec2(float(s) * cscale1 + cshift1, height1)).rgb;
        float pwfValueSegment = texture2D(otexture, vec2(float(s) * oscale1 + oshift1, height1)).r;
        gl_FragData[0] = vec4(tColorSegment, pwfValueSegment);
        return true;
    }

    // not on edge
    return false;
}

#endif


//=======================================================================
// Apply the specified blend mode operation along the ray's path.
//
void applyBlend(vec3 posIS, vec3 endIS, vec3 tdims)
{
  vec3 tstep = 1.0/tdims;

  // start slightly inside and apply some jitter
  vec3 delta = endIS - posIS;
  vec3 stepIS = normalize(delta)*sampleDistanceIS;
  float raySteps = length(delta)/sampleDistanceIS;

  // Initialize arrays to false
  // avoid 0.0 jitter
  float jitter = 0.01 + 0.99*texture2D(jtexture, gl_FragCoord.xy/32.0).r;
  float stepsTraveled = jitter;

  // local vars for the loop
  vec4 color = vec4(0.0, 0.0, 0.0, 0.0);
  vec4 tValue;
  vec4 tColor;

  // if we have less than one step then pick the middle point
  // as our value
  // if (raySteps <= 1.0)
  // {
  //   posIS = (posIS + endIS)*0.5;
  // }

  // Perform initial step at the volume boundary
  // compute the scalar
  tValue = getTextureValue(posIS);
  
  #if vtkBlendMode == 6 
    if (raySteps <= 1.0)
    {
      gl_FragData[0] = getColorForValue(tValue, posIS, tstep);
      return;
    }

    vec4 value = tValue;
    posIS += (jitter*stepIS);
    vec3 maxPosIS = posIS; // Store the position of the max value
    int segmentIndex = int(value.g);
    bool originalPosHasSeenNonZero = false;

    uint bitmask = 0u;

    if (segmentIndex != 0) {
      // Tried using the segment index in an boolean array but reading 
      // from the array by dynamic indexing was horrondously slow
      // so use bit masking instead and assign 1 to the bit corresponding to the segment index
      // and later check if the bit is set via bit operations
      setBit(segmentIndex);
    }
    
    // Sample along the ray until MaximumSamplesValue,
    // ending slightly inside the total distance
    for (int i = 0; i < //VTK::MaximumSamplesValue ; ++i)
    {
      // If we have reached the last step, break
      if (stepsTraveled + 1.0 >= raySteps) { break; }

      // compute the scalar
      tValue = getTextureValue(posIS);
      segmentIndex = int(tValue.g);

      if (segmentIndex != 0) {
        originalPosHasSeenNonZero = true;
        setBit(segmentIndex);
      }

      if (tValue.r > value.r) {
        value =  tValue; // Update the max value
        maxPosIS = posIS; // Update the position where max occurred
      }

      // Otherwise, continue along the ray
      stepsTraveled++;
      posIS += stepIS;
    }

    // Perform the last step along the ray using the
    // residual distance
    posIS = endIS;
    tValue = getTextureValue(posIS);

    if (tValue.r > value.r) {
      value = tValue; // Update the max value
      maxPosIS = posIS; // Update the position where max occurred
    }  

    // If we have not seen any non-zero segments, we can return early
    // and grab color from the actual center value first component (image)
    if (!originalPosHasSeenNonZero) {
      gl_FragData[0] = getColorForValue(value, maxPosIS, tstep);
      return;
    }

    // probably we can make this configurable but for now we will use the same
    // sample distance as the original sample distance
    float neighborSampleDistanceIS = sampleDistanceIS;

    vec3 neighborRayStepsIS = stepIS;
    float neighborRaySteps = raySteps;
    bool shouldLookInAllNeighbors = false;

    float minVoxelSpacing = min(volumeSpacings[0], min(volumeSpacings[1], volumeSpacings[2]));
    vec4 base = vec4(gl_FragCoord.x, gl_FragCoord.y, gl_FragCoord.z, gl_FragCoord.w);

    vec4 baseXPlus = vec4(gl_FragCoord.x + 1.0, gl_FragCoord.y, gl_FragCoord.z, gl_FragCoord.w);
    vec4 baseYPlus = vec4(gl_FragCoord.x, gl_FragCoord.y + 1.0, gl_FragCoord.z, gl_FragCoord.w);

    vec3 baseWorld = fragCoordToWorld(base);
    vec3 baseXPlusWorld = fragCoordToWorld(baseXPlus);
    vec3 baseYPlusWorld = fragCoordToWorld(baseYPlus);

    float XPlusDiff = length(baseXPlusWorld - baseWorld);
    float YPlusDiff = length(baseYPlusWorld - baseWorld);

    float minFragSpacingWorld = min(XPlusDiff, YPlusDiff);

    for (int s = 1; s < MAX_SEGMENT_INDEX; s++) {
      // bail out quickly if the segment index has not 
      // been seen by the center segment
      if (!isBitSet(s)) {
       continue;
      }

      // Use texture sampling for outlineThickness so that we can have 
      // per segment thickness
      float textureCoordinate = float(s - 1) / 1024.0;
      float textureValue = texture2D(ttexture, vec2(textureCoordinate, 0.5)).r;

      int actualThickness = int(textureValue * 255.0);

      // check the extreme points in the neighborhood since there is a better
      // chance of finding the edge there, so that we can bail out 
      // faster if we find the edge
      bool onEdge =
          checkOnEdgeForNeighbor(-actualThickness, -actualThickness, s, stepIS) ||
          checkOnEdgeForNeighbor(actualThickness, actualThickness, s, stepIS) ||
          checkOnEdgeForNeighbor(actualThickness, -actualThickness, s, stepIS) ||
          checkOnEdgeForNeighbor(-actualThickness, +actualThickness, s, stepIS);

      if (onEdge) {
        return;
      }

      // since the next step is computationally expensive, we need to perform
      // some optimizations to avoid it if possible. One of the optimizations
      // is to check the whether the minimum of the voxel spacing is greater than 
      // the 2 * the thickness of the outline segment. If that is the case
      // then we can safely skip the next step since we can be sure that the
      // the previous 4 checks on the extreme points would caught the entirety 
      // of the all the fragments inside. i.e., this happens when we zoom out, 
      if (minVoxelSpacing > (2.0 * float(actualThickness) - 1.0) * minFragSpacingWorld) {
        continue;
      }
      
      // Loop through the rest, skipping the processed extremes and the center
      for (int i = -actualThickness; i <= actualThickness; i++) {
            for (int j = -actualThickness; j <= actualThickness; j++) {
                if (i == 0 && j == 0) continue; // Skip the center
                if (abs(i) == actualThickness && abs(j) == actualThickness) continue; // Skip corners
                if (checkOnEdgeForNeighbor(i, j, s, stepIS )) {
                    return;
                }
          }
      }
    }

    vec3 tColor0 = texture2D(ctexture, vec2(value.r * cscale0 + cshift0, height0)).rgb;
    float pwfValue0 = texture2D(otexture, vec2(value.r * oscale0 + oshift0, height0)).r;
    gl_FragData[0] = vec4(tColor0, pwfValue0);
  #endif
  #if vtkBlendMode == 0 // COMPOSITE_BLEND
    // now map through opacity and color
    tColor = getColorForValue(tValue, posIS, tstep);

    // handle very thin volumes
    if (raySteps <= 1.0)
    {
      tColor.a = 1.0 - pow(1.0 - tColor.a, raySteps);
      gl_FragData[0] = tColor;
      return;
    }

    tColor.a = 1.0 - pow(1.0 - tColor.a, jitter);
    color = vec4(tColor.rgb*tColor.a, tColor.a);
    posIS += (jitter*stepIS);

    for (int i = 0; i < //VTK::MaximumSamplesValue ; ++i)
    {
      if (stepsTraveled + 1.0 >= raySteps) { break; }

      // compute the scalar
      tValue = getTextureValue(posIS);

      // now map through opacity and color
      tColor = getColorForValue(tValue, posIS, tstep);

      float mix = (1.0 - color.a);

      // this line should not be needed but nvidia seems to not handle
      // the break correctly on windows/chrome 58 angle
      //mix = mix * sign(max(raySteps - stepsTraveled - 1.0, 0.0));

      color = color + vec4(tColor.rgb*tColor.a, tColor.a)*mix;
      stepsTraveled++;
      posIS += stepIS;
      if (color.a > 0.99) { color.a = 1.0; break; }
    }

    if (color.a < 0.99 && (raySteps - stepsTraveled) > 0.0)
    {
      posIS = endIS;

      // compute the scalar
      tValue = getTextureValue(posIS);

      // now map through opacity and color
      tColor = getColorForValue(tValue, posIS, tstep);
      tColor.a = 1.0 - pow(1.0 - tColor.a, raySteps - stepsTraveled);

      float mix = (1.0 - color.a);
      color = color + vec4(tColor.rgb*tColor.a, tColor.a)*mix;
    }

    gl_FragData[0] = vec4(color.rgb/color.a, color.a);
  #endif
  #if vtkBlendMode == 1 || vtkBlendMode == 2
    // MAXIMUM_INTENSITY_BLEND || MINIMUM_INTENSITY_BLEND
    // Find maximum/minimum intensity along the ray.

    // Define the operation we will use (min or max)
    #if vtkBlendMode == 1
    #define OP max
    #else
    #define OP min
    #endif

    // If the clipping range is shorter than the sample distance
    // we can skip the sampling loop along the ray.
    if (raySteps <= 1.0)
    {
      gl_FragData[0] = getColorForValue(tValue, posIS, tstep);
      return;
    }

    vec4 value = tValue;
    posIS += (jitter*stepIS);

    // Sample along the ray until MaximumSamplesValue,
    // ending slightly inside the total distance
    for (int i = 0; i < //VTK::MaximumSamplesValue ; ++i)
    {
      // If we have reached the last step, break
      if (stepsTraveled + 1.0 >= raySteps) { break; }

      // compute the scalar
      tValue = getTextureValue(posIS);

      // Update the maximum value if necessary
      value = OP(tValue, value);

      // Otherwise, continue along the ray
      stepsTraveled++;
      posIS += stepIS;
    }

    // Perform the last step along the ray using the
    // residual distance
    posIS = endIS;
    tValue = getTextureValue(posIS);
    value = OP(tValue, value);

    // Now map through opacity and color
    gl_FragData[0] = getColorForValue(value, posIS, tstep);
  #endif
  #if vtkBlendMode == 3 || vtkBlendMode == 4 //AVERAGE_INTENSITY_BLEND || ADDITIVE_BLEND
    vec4 sum = vec4(0.);

    if (valueWithinScalarRange(tValue, ipScalarRangeMin, ipScalarRangeMax)) {
      sum += tValue;
    }

    if (raySteps <= 1.0) {
      gl_FragData[0] = getColorForValue(sum, posIS, tstep);
      return;
    }

    posIS += (jitter*stepIS);

    // Sample along the ray until MaximumSamplesValue,
    // ending slightly inside the total distance
    for (int i = 0; i < //VTK::MaximumSamplesValue ; ++i)
    {
      // If we have reached the last step, break
      if (stepsTraveled + 1.0 >= raySteps) { break; }

      // compute the scalar
      tValue = getTextureValue(posIS);

      // One can control the scalar range by setting the AverageIPScalarRange to disregard scalar values, not in the range of interest, from the average computation.
      // Notes:
      // - We are comparing all values in the texture to see if any of them
      //   are outside of the scalar range. In the future we might want to allow
      //   scalar ranges for each component.
      if (valueWithinScalarRange(tValue, ipScalarRangeMin, ipScalarRangeMax)) {
        // Sum the values across each step in the path
        sum += tValue;
      }
      stepsTraveled++;
      posIS += stepIS;
    }

    // Perform the last step along the ray using the
    // residual distance
    posIS = endIS;

    // compute the scalar
    tValue = getTextureValue(posIS);

    // One can control the scalar range by setting the IPScalarRange to disregard scalar values, not in the range of interest, from the average computation
    if (valueWithinScalarRange(tValue, ipScalarRangeMin, ipScalarRangeMax)) {
      sum += tValue;

      stepsTraveled++;
    }

    #if vtkBlendMode == 3 // Average
      sum /= vec4(stepsTraveled, stepsTraveled, stepsTraveled, 1.0);
    #endif

    gl_FragData[0] = getColorForValue(sum, posIS, tstep);
  #endif
  #if vtkBlendMode == 5 // RADON
    float normalizedRayIntensity = 1.0;

    // handle very thin volumes
    if (raySteps <= 1.0)
    {
      tValue = getTextureValue(posIS);
      normalizedRayIntensity = normalizedRayIntensity - sampleDistance*texture2D(otexture, vec2(tValue.r * oscale0 + oshift0, 0.5)).r;
      gl_FragData[0] = texture2D(ctexture, vec2(normalizedRayIntensity, 0.5));
      return;
    }

    posIS += (jitter*stepIS);

    for (int i = 0; i < //VTK::MaximumSamplesValue ; ++i)
    {
      if (stepsTraveled + 1.0 >= raySteps) { break; }

      // compute the scalar value
      tValue = getTextureValue(posIS);

      // Convert scalar value to normalizedRayIntensity coefficient and accumulate normalizedRayIntensity
      normalizedRayIntensity = normalizedRayIntensity - sampleDistance*texture2D(otexture, vec2(tValue.r * oscale0 + oshift0, 0.5)).r;

      posIS += stepIS;
      stepsTraveled++;
    }

    // map normalizedRayIntensity to color
    gl_FragData[0] = texture2D(ctexture, vec2(normalizedRayIntensity , 0.5));

  #endif
}

//=======================================================================
// Compute a new start and end point for a given ray based
// on the provided bounded clipping plane (aka a rectangle)
void getRayPointIntersectionBounds(
  vec3 rayPos, vec3 rayDir,
  vec3 planeDir, float planeDist,
  inout vec2 tbounds, vec3 vPlaneX, vec3 vPlaneY,
  float vSize1, float vSize2)
{
  float result = dot(rayDir, planeDir);
  if (abs(result) < 1e-6)
  {
    return;
  }
  result = -1.0 * (dot(rayPos, planeDir) + planeDist) / result;
  vec3 xposVC = rayPos + rayDir*result;
  vec3 vxpos = xposVC - vOriginVC;
  vec2 vpos = vec2(
    dot(vxpos, vPlaneX),
    dot(vxpos, vPlaneY));

  // on some apple nvidia systems this does not work
  // if (vpos.x < 0.0 || vpos.x > vSize1 ||
  //     vpos.y < 0.0 || vpos.y > vSize2)
  // even just
  // if (vpos.x < 0.0 || vpos.y < 0.0)
  // fails
  // so instead we compute a value that represents in and out
  //and then compute the return using this value
  float xcheck = max(0.0, vpos.x * (vpos.x - vSize1)); //  0 means in bounds
  float check = sign(max(xcheck, vpos.y * (vpos.y - vSize2))); //  0 means in bounds, 1 = out

  tbounds = mix(
   vec2(min(tbounds.x, result), max(tbounds.y, result)), // in value
   tbounds, // out value
   check);  // 0 in 1 out
}

//=======================================================================
// given a
// - ray direction (rayDir)
// - starting point (vertexVCVSOutput)
// - bounding planes of the volume
// - optionally depth buffer values
// - far clipping plane
// compute the start/end distances of the ray we need to cast
vec2 computeRayDistances(vec3 rayDir, vec3 tdims)
{
  vec2 dists = vec2(100.0*camFar, -1.0);

  vec3 vSize = vSpacing*tdims;

  // all this is in View Coordinates
  getRayPointIntersectionBounds(vertexVCVSOutput, rayDir,
    vPlaneNormal0, vPlaneDistance0, dists, vPlaneNormal2, vPlaneNormal4,
    vSize.y, vSize.z);
  getRayPointIntersectionBounds(vertexVCVSOutput, rayDir,
    vPlaneNormal1, vPlaneDistance1, dists, vPlaneNormal2, vPlaneNormal4,
    vSize.y, vSize.z);
  getRayPointIntersectionBounds(vertexVCVSOutput, rayDir,
    vPlaneNormal2, vPlaneDistance2, dists, vPlaneNormal0, vPlaneNormal4,
    vSize.x, vSize.z);
  getRayPointIntersectionBounds(vertexVCVSOutput, rayDir,
    vPlaneNormal3, vPlaneDistance3, dists, vPlaneNormal0, vPlaneNormal4,
    vSize.x, vSize.z);
  getRayPointIntersectionBounds(vertexVCVSOutput, rayDir,
    vPlaneNormal4, vPlaneDistance4, dists, vPlaneNormal0, vPlaneNormal2,
    vSize.x, vSize.y);
  getRayPointIntersectionBounds(vertexVCVSOutput, rayDir,
    vPlaneNormal5, vPlaneDistance5, dists, vPlaneNormal0, vPlaneNormal2,
    vSize.x, vSize.y);

  //VTK::ClipPlane::Impl

  // do not go behind front clipping plane
  dists.x = max(0.0,dists.x);

  // do not go PAST far clipping plane
  float farDist = -camThick/rayDir.z;
  dists.y = min(farDist,dists.y);

  // Do not go past the zbuffer value if set
  // This is used for intermixing opaque geometry
  //VTK::ZBuffer::Impl

  return dists;
}

//=======================================================================
// Compute the index space starting position (pos) and end
// position
//
void computeIndexSpaceValues(out vec3 pos, out vec3 endPos, vec3 rayDir, vec2 dists)
{
  // compute starting and ending values in volume space
  pos = vertexVCVSOutput + dists.x*rayDir;
  pos = pos - vOriginVC;
  // convert to volume basis and origin
  pos = vec3(
    dot(pos, vPlaneNormal0),
    dot(pos, vPlaneNormal2),
    dot(pos, vPlaneNormal4));

  endPos = vertexVCVSOutput + dists.y*rayDir;
  endPos = endPos - vOriginVC;
  endPos = vec3(
    dot(endPos, vPlaneNormal0),
    dot(endPos, vPlaneNormal2),
    dot(endPos, vPlaneNormal4));

  float delta = length(endPos - pos);

  pos *= vVCToIJK;
  endPos *= vVCToIJK;

  float delta2 = length(endPos - pos);
  sampleDistanceIS = sampleDistance*delta2/delta;
  #ifdef VolumeShadowOn
    sampleDistanceISVS = sampleDistanceIS * volumeShadowSamplingDistFactor;
  #endif
}

void main()
{

  if (cameraParallel == 1)
  {
    // Camera is parallel, so the rayDir is just the direction of the camera.
    rayDirVC = vec3(0.0, 0.0, -1.0);
  } else {
    // camera is at 0,0,0 so rayDir for perspective is just the vc coord
    rayDirVC = normalize(vertexVCVSOutput);
  }

  vec3 tdims = vec3(volumeDimensions);

  // compute the start and end points for the ray
  vec2 rayStartEndDistancesVC = computeRayDistances(rayDirVC, tdims);

  // do we need to composite? aka does the ray have any length
  // If not, bail out early
  if (rayStartEndDistancesVC.y <= rayStartEndDistancesVC.x)
  {
    discard;
  }

  // IS = Index Space
  vec3 posIS;
  vec3 endIS;
  computeIndexSpaceValues(posIS, endIS, rayDirVC, rayStartEndDistancesVC);

  // Perform the blending operation along the ray
  applyBlend(posIS, endIS, tdims);
}
`;const{vtkWarningMacro:$$,vtkErrorMacro:I5}=Ir;function W$(t){switch(t){case op.CUSTOM:return"//VTK::CustomColorMix";case op.ADDITIVE:return`
        // compute normals
        mat4 normalMat = computeMat4Normal(posIS, tValue, tstep);
        #if (vtkLightComplexity > 0) && defined(vtkComputeNormalFromOpacity)
          vec3 scalarInterp0[2];
          vec4 normalLight0 = computeNormalForDensity(posIS, tstep, scalarInterp0, 0);
          scalarInterp0[0] = scalarInterp0[0] * oscale0 + oshift0;
          scalarInterp0[1] = scalarInterp0[1] * oscale0 + oshift0;
          normalLight0 = computeDensityNormal(scalarInterp0, height0, 1.0);

          vec3 scalarInterp1[2];
          vec4 normalLight1 = computeNormalForDensity(posIS, tstep, scalarInterp1, 1);
          scalarInterp1[0] = scalarInterp1[0] * oscale1 + oshift1;
          scalarInterp1[1] = scalarInterp1[1] * oscale1 + oshift1;
          normalLight1 = computeDensityNormal(scalarInterp1, height1, 1.0);
        #else
          vec4 normalLight0 = normalMat[0];
          vec4 normalLight1 = normalMat[1];
        #endif

        // compute opacities
        float opacity0 = pwfValue0;
        float opacity1 = pwfValue1;
        #ifdef vtkGradientOpacityOn
          float gof0 = computeGradientOpacityFactor(normalMat[0].a, goscale0, goshift0, gomin0, gomax0);
          opacity0 *= gof0;
          float gof1 = computeGradientOpacityFactor(normalMat[1].a, goscale1, goshift1, gomin1, gomax1);
          opacity1 *= gof1;
        #endif
        float opacitySum = opacity0 + opacity1;
        if (opacitySum <= 0.0) {
          return vec4(0.0);
        }

        // mix the colors and opacities
        tColor0 = applyAllLightning(tColor0, opacity0, posIS, normalLight0);
        tColor1 = applyAllLightning(tColor1, opacity1, posIS, normalLight1);
        vec3 mixedColor = (opacity0 * tColor0 + opacity1 * tColor1) / opacitySum;
        return vec4(mixedColor, min(1.0, opacitySum));
`;case op.COLORIZE:return`
        // compute normals
        mat4 normalMat = computeMat4Normal(posIS, tValue, tstep);
        #if (vtkLightComplexity > 0) && defined(vtkComputeNormalFromOpacity)
          vec3 scalarInterp0[2];
          vec4 normalLight0 = computeNormalForDensity(posIS, tstep, scalarInterp0, 0);
          scalarInterp0[0] = scalarInterp0[0] * oscale0 + oshift0;
          scalarInterp0[1] = scalarInterp0[1] * oscale0 + oshift0;
          normalLight0 = computeDensityNormal(scalarInterp0, height0, 1.0);
        #else
          vec4 normalLight0 = normalMat[0];
        #endif

        // compute opacities
        float opacity0 = pwfValue0;
        #ifdef vtkGradientOpacityOn
          float gof0 = computeGradientOpacityFactor(normalMat[0].a, goscale0, goshift0, gomin0, gomax0);
          opacity0 *= gof0;
        #endif

        // mix the colors and opacities
        vec3 color = tColor0 * mix(vec3(1.0), tColor1, pwfValue1);
        color = applyAllLightning(color, opacity0, posIS, normalLight0);
        return vec4(color, opacity0);
`;default:return null}}function z$(t,e){e.classHierarchy.push("vtkOpenGLVolumeMapper");function n(i){[e._scalars,e._scalarOpacityFunc,e._colorTransferFunc,e._labelOutlineThicknessArray].forEach(a=>i.unregisterGraphicsResourceUser(a,t))}t.buildPass=()=>{e.zBufferTexture=null},t.zBufferPass=(i,a)=>{if(i){const o=a.getZBufferTexture();o!==e.zBufferTexture&&(e.zBufferTexture=o)}},t.opaqueZBufferPass=(i,a)=>t.zBufferPass(i,a),t.volumePass=(i,a)=>{if(i){const o=e._openGLRenderWindow;e._openGLRenderWindow=t.getLastAncestorOfType("vtkOpenGLRenderWindow"),o&&!o.isDeleted()&&o!==e._openGLRenderWindow&&n(o),e.context=e._openGLRenderWindow.getContext(),e.tris.setOpenGLRenderWindow(e._openGLRenderWindow),e.jitterTexture.setOpenGLRenderWindow(e._openGLRenderWindow),e.framebuffer.setOpenGLRenderWindow(e._openGLRenderWindow),e.openGLVolume=t.getFirstAncestorOfType("vtkOpenGLVolume");const s=e.openGLVolume.getRenderable();e._openGLRenderer=t.getFirstAncestorOfType("vtkOpenGLRenderer");const c=e._openGLRenderer.getRenderable();e.openGLCamera=e._openGLRenderer.getViewNodeFor(c.getActiveCamera()),t.renderPiece(c,s)}},t.getShaderTemplate=(i,a,o)=>{i.Vertex=B$,i.Fragment=G$,i.Geometry=""},t.useIndependentComponents=i=>{var l,f;const a=i.getIndependentComponents(),o=e.currentInput,s=(f=(l=o==null?void 0:o.getPointData())==null?void 0:l.getScalars())==null?void 0:f.getNumberOfComponents(),c=i.getColorMixPreset();return a&&s>=2||!!c},t.replaceShaderValues=(i,a,o)=>{const s=o.getProperty();let c=i.Fragment;s.getInterpolationType()===A3.LINEAR&&(c=te.substitute(c,"//VTK::TrilinearOn","#define vtkTrilinearOn").result),t.isLabelmapOutlineRequired(o)===!0&&(c=te.substitute(c,"//VTK::ImageLabelOutlineOn","#define vtkImageLabelOutlineOn").result),e.renderable.getBlendMode()===X1.LABELMAP_EDGE_PROJECTION_BLEND&&(c=te.substitute(c,"//VTK::LabelEdgeProjectionOn","#define vtkLabelEdgeProjectionOn").result);const g=e.scalarTexture.getComponents();c=te.substitute(c,"//VTK::NumComponents",`#define vtkNumComponents ${g}`).result;const d=t.useIndependentComponents(s);d&&(c=te.substitute(c,"//VTK::IndependentComponentsOn","#define UseIndependentComponents").result);const h=[],p=[];for(let O=0;O<g;O++)s.getOpacityMode(O)===KO.PROPORTIONAL&&h.push(`#define vtkComponent${O}Proportional`),s.getForceNearestInterpolation(O)&&p.push(`#define vtkComponent${O}ForceNearest`);c=te.substitute(c,"//VTK::vtkProportionalComponents",h.join(`
`)).result,c=te.substitute(c,"//VTK::vtkForceNearestComponents",p.join(`
`)).result;const m=s.getColorMixPreset(),v=W$(m);v&&(c=te.substitute(c,"//VTK::CustomComponentsColorMixOn","#define vtkCustomComponentsColorMix").result,c=te.substitute(c,"//VTK::CustomComponentsColorMix::Impl",v).result);const y=e.currentInput.getSpatialExtent(),T=e.currentInput.getSpacing(),C=new Float64Array(3);bt(C,(y[1]-y[0])*T[0],(y[3]-y[2])*T[1],(y[5]-y[4])*T[2]);const w=Cc(C)/t.getCurrentSampleDistance(a);c=te.substitute(c,"//VTK::MaximumSamplesValue",`${Math.ceil(w)}`).result,c=te.substitute(c,"//VTK::LightComplexity",`#define vtkLightComplexity ${e.lightComplexity}`).result,e.lightComplexity>0&&(e.renderable.getVolumetricScatteringBlending()>0&&(c=te.substitute(c,"//VTK::VolumeShadowOn","#define VolumeShadowOn").result),e.renderable.getVolumetricScatteringBlending()<1&&(c=te.substitute(c,"//VTK::SurfaceShadowOn","#define SurfaceShadowOn").result),e.renderable.getLocalAmbientOcclusion()&&s.getAmbient()>0&&(c=te.substitute(c,"//VTK::localAmbientOcclusionOn","#define localAmbientOcclusionOn").result));const x=d?g:1;e.gopacity=!1;for(let O=0;!e.gopacity&&O<x;++O)e.gopacity||(e.gopacity=s.getUseGradientOpacity(O));e.gopacity&&(c=te.substitute(c,"//VTK::GradientOpacityOn","#define vtkGradientOpacityOn").result),e.renderable.getComputeNormalFromOpacity()&&(c=te.substitute(c,"//VTK::vtkComputeNormalFromOpacity","#define vtkComputeNormalFromOpacity").result),e.zBufferTexture!==null&&(c=te.substitute(c,"//VTK::ZBuffer::Dec",["uniform sampler2D zBufferTexture;","uniform float vpZWidth;","uniform float vpZHeight;"]).result,c=te.substitute(c,"//VTK::ZBuffer::Impl",["vec4 depthVec = texture2D(zBufferTexture, vec2(gl_FragCoord.x / vpZWidth, gl_FragCoord.y/vpZHeight));","float zdepth = (depthVec.r*256.0 + depthVec.g)/257.0;","zdepth = zdepth * 2.0 - 1.0;","if (cameraParallel == 0) {","zdepth = -2.0 * camFar * camNear / (zdepth*(camFar-camNear)-(camFar+camNear)) - camNear;}","else {",`zdepth = (zdepth + 1.0) * 0.5 * (camFar - camNear);}
`,"zdepth = -zdepth/rayDir.z;","dists.y = min(zdepth,dists.y);"]).result),c=te.substitute(c,"//VTK::BlendMode",`${e.renderable.getBlendMode()}`).result,i.Fragment=c,t.replaceShaderLight(i,a,o),t.replaceShaderClippingPlane(i,a,o)},t.replaceShaderLight=(i,a,o)=>{if(e.lightComplexity===0)return;let s=i.Fragment,c=0;a.getLights().forEach(l=>{l.getSwitch()&&(c+=1)}),s=te.substitute(s,"//VTK::Light::Dec",["uniform int lightNum;","uniform bool twoSidedLighting;",`uniform vec3 lightColor[${c}];`,`uniform vec3 lightDirectionVC[${c}]; // normalized`,`uniform vec3 lightHalfAngleVC[${c}];`,"//VTK::Light::Dec"],!1).result,e.lightComplexity===3&&(s=te.substitute(s,"//VTK::Light::Dec",[`uniform vec3 lightPositionVC[${c}];`,`uniform vec3 lightAttenuation[${c}];`,`uniform float lightConeAngle[${c}];`,`uniform float lightExponent[${c}];`,`uniform int lightPositional[${c}];`],!1).result),e.renderable.getVolumetricScatteringBlending()>0&&(s=te.substitute(s,"//VTK::VolumeShadow::Dec",["uniform float volumetricScatteringBlending;","uniform float giReach;","uniform float volumeShadowSamplingDistFactor;","uniform float anisotropy;","uniform float anisotropy2;"],!1).result),e.renderable.getLocalAmbientOcclusion()&&o.getProperty().getAmbient()>0&&(s=te.substitute(s,"//VTK::LAO::Dec",["uniform int kernelRadius;",`uniform vec2 kernelSample[${e.renderable.getLAOKernelRadius()}];`,"uniform int kernelSize;"],!1).result),i.Fragment=s},t.replaceShaderClippingPlane=(i,a,o)=>{let s=i.Fragment;if(e.renderable.getClippingPlanes().length>0){const c=e.renderable.getClippingPlanes().length;s=te.substitute(s,"//VTK::ClipPlane::Dec",["uniform vec3 vClipPlaneNormals[6];","uniform float vClipPlaneDistances[6];","uniform vec3 vClipPlaneOrigins[6];","uniform int clip_numPlanes;","//VTK::ClipPlane::Dec","#define vtkClippingPlanesOn"],!1).result,s=te.substitute(s,"//VTK::ClipPlane::Impl",[`for(int i = 0; i < ${c}; i++) {`,"  float rayDirRatio = dot(rayDir, vClipPlaneNormals[i]);","  float equationResult = dot(vertexVCVSOutput, vClipPlaneNormals[i]) + vClipPlaneDistances[i];","  if (rayDirRatio == 0.0)","  {","    if (equationResult < 0.0) dists.x = dists.y;","    continue;","  }","  float result = -1.0 * equationResult / rayDirRatio;","  if (rayDirRatio < 0.0) dists.y = min(dists.y, result);","  else dists.x = max(dists.x, result);","}","//VTK::ClipPlane::Impl"],!1).result}i.Fragment=s};const r=(i,a)=>{let o=0;i.getProperty().getShade()&&e.renderable.getBlendMode()===X1.COMPOSITE_BLEND&&(o=0,e.numberOfLights=0,a.forEach(s=>{s.getSwitch()>0&&(e.numberOfLights++,o===0&&(o=1)),o===1&&(e.numberOfLights>1||s.getIntensity()!==1||!s.lightTypeIsHeadLight())&&(o=2),o<3&&s.getPositional()&&(o=3)})),o!==e.lightComplexity&&(e.lightComplexity=o,t.modified())};t.getNeedToRebuildShaders=(i,a,o)=>{var v;const s=o.getProperty();r(o,a.getLights());const c=e.scalarTexture.getComponents(),l=[],f=[];for(let y=0;y<c;y++)l.push(s.getOpacityMode(y)),f.push(s.getForceNearestInterpolation(y));const u=e.currentInput.getSpatialExtent(),g=e.currentInput.getSpacing(),d=new Float64Array(3);bt(d,(u[1]-u[0])*g[0],(u[3]-u[2])*g[1],(u[5]-u[4])*g[2]);const h=Cc(d)/t.getCurrentSampleDistance(a),p=!!e.zBufferTexture,m={iComps:s.getIndependentComponents(),colorMixPreset:s.getColorMixPreset(),interpolationType:s.getInterpolationType(),useLabelOutline:t.isLabelmapOutlineRequired(o),numComp:c,maxSamples:h,useGradientOpacity:s.getUseGradientOpacity(0),blendMode:e.renderable.getBlendMode(),hasZBufferTexture:p,opacityModes:l,forceNearestInterps:f};return((v=i.getProgram())==null?void 0:v.getHandle())===0||i.getShaderSourceTime().getMTime()<t.getMTime()||i.getShaderSourceTime().getMTime()<e.renderable.getMTime()||!e.previousState||!Gx(e.previousState,m)?(e.previousState=m,!0):!1},t.updateShaders=(i,a,o)=>{if(t.getNeedToRebuildShaders(i,a,o)){const s={Vertex:null,Fragment:null,Geometry:null};t.buildShaders(s,a,o);const c=e._openGLRenderWindow.getShaderCache().readyShaderProgramArray(s.Vertex,s.Fragment,s.Geometry);c!==i.getProgram()&&(i.setProgram(c),i.getVAO().releaseGraphicsResources()),i.getShaderSourceTime().modified()}else e._openGLRenderWindow.getShaderCache().readyShaderProgram(i.getProgram());i.getVAO().bind(),t.setMapperShaderParameters(i,a,o),t.setCameraShaderParameters(i,a,o),t.setPropertyShaderParameters(i,a,o),t.getClippingPlaneShaderParameters(i,a,o)},t.setMapperShaderParameters=(i,a,o)=>{var f;const s=i.getProgram();i.getCABO().getElementCount()&&(e.VBOBuildTime.getMTime()>i.getAttributeUpdateTime().getMTime()||i.getShaderSourceTime().getMTime()>i.getAttributeUpdateTime().getMTime())&&(s.isAttributeUsed("vertexDC")&&(i.getVAO().addAttributeArray(s,i.getCABO(),"vertexDC",i.getCABO().getVertexOffset(),i.getCABO().getStride(),e.context.FLOAT,3,e.context.FALSE)||I5("Error setting vertexDC in shader VAO.")),i.getAttributeUpdateTime().modified()),s.setUniformi("texture1",e.scalarTexture.getTextureUnit()),s.setUniformf("sampleDistance",t.getCurrentSampleDistance(a));const c=e.scalarTexture.getVolumeInfo(),l=e.renderable.getIpScalarRange();if((f=c==null?void 0:c.dataComputedScale)!=null&&f.length){const u=[],g=[];for(let d=0;d<4;d++)u[d]=l[0]*c.dataComputedScale[d]+c.dataComputedOffset[d],g[d]=l[1]*c.dataComputedScale[d]+c.dataComputedOffset[d],u[d]=(u[d]-c.offset[d])/c.scale[d],g[d]=(g[d]-c.offset[d])/c.scale[d];s.setUniform4f("ipScalarRangeMin",u[0],u[1],u[2],u[3]),s.setUniform4f("ipScalarRangeMax",g[0],g[1],g[2],g[3])}if(e.zBufferTexture!==null){s.setUniformi("zBufferTexture",e.zBufferTexture.getTextureUnit());const u=e._useSmallViewport?[e._smallViewportWidth,e._smallViewportHeight]:e._openGLRenderWindow.getFramebufferSize();s.setUniformf("vpZWidth",u[0]),s.setUniformf("vpZHeight",u[1])}},t.setCameraShaderParameters=(i,a,o)=>{const s=e.openGLCamera.getKeyMatrices(a),c=e.openGLVolume.getKeyMatrices();vt(e.modelToView,s.wcvc,c.mcwc);const l=i.getProgram(),f=e.openGLCamera.getRenderable(),u=f.getClippingRange();l.setUniformf("camThick",u[1]-u[0]),l.setUniformf("camNear",u[0]),l.setUniformf("camFar",u[1]);const g=e.currentInput.getBounds(),d=e.currentInput.getDimensions(),h=new Float64Array(3),p=new Float64Array(3);let m=1,v=-1,y=1,T=-1;for(let J=0;J<8;++J){if(bt(h,g[J%2],g[2+Math.floor(J/2)%2],g[4+Math.floor(J/4)]),pt(h,h,e.modelToView),!f.getParallelProjection()){wn(p,h);const de=-u[0]/h[2];Br(h,p,de)}pt(h,h,s.vcpc),m=Math.min(h[0],m),v=Math.max(h[0],v),y=Math.min(h[1],y),T=Math.max(h[1],T)}l.setUniformf("dcxmin",m),l.setUniformf("dcxmax",v),l.setUniformf("dcymin",y),l.setUniformf("dcymax",T),l.isUniformUsed("cameraParallel")&&l.setUniformi("cameraParallel",f.getParallelProjection());const C=e.currentInput.getSpatialExtent(),w=e.currentInput.getSpacing(),x=new Float64Array(3);bt(x,(C[1]-C[0])*w[0],(C[3]-C[2])*w[1],(C[5]-C[4])*w[2]),l.setUniform3f("vSpacing",w[0],w[1],w[2]),bt(h,C[0],C[2],C[4]),e.currentInput.indexToWorldVec3(h,h),pt(h,h,e.modelToView),l.setUniform3f("vOriginVC",h[0],h[1],h[2]);const O=e.currentInput.getIndexToWorld();vt(e.idxToView,e.modelToView,O),Du(e.idxNormalMatrix,s.normalMatrix,c.normalMatrix),Du(e.idxNormalMatrix,e.idxNormalMatrix,e.currentInput.getDirectionByReference());const M=Cc(x)/t.getCurrentSampleDistance(a);M>e.renderable.getMaximumSamplesPerRay()&&$$(`The number of steps required ${Math.ceil(M)} is larger than the
        specified maximum number of steps ${e.renderable.getMaximumSamplesPerRay()}.
        Please either change the
        volumeMapper sampleDistance or its maximum number of samples.`);const A=new Float64Array(3);if(bt(A,1,1,1),sF(A,A,x),l.setUniform3f("vVCToIJK",A[0],A[1],A[2]),l.setUniform3i("volumeDimensions",d[0],d[1],d[2]),l.setUniform3f("volumeSpacings",w[0],w[1],w[2]),!e._openGLRenderWindow.getWebgl2()){const J=e.scalarTexture.getVolumeInfo();l.setUniformf("texWidth",e.scalarTexture.getWidth()),l.setUniformf("texHeight",e.scalarTexture.getHeight()),l.setUniformi("xreps",J.xreps),l.setUniformi("xstride",J.xstride),l.setUniformi("ystride",J.ystride)}const _=new Float64Array(3),k=new Float64Array(3);for(let J=0;J<6;++J){switch(J){case 1:bt(_,-1,0,0),bt(k,C[0],C[2],C[4]);break;case 2:bt(_,0,1,0),bt(k,C[1],C[3],C[5]);break;case 3:bt(_,0,-1,0),bt(k,C[0],C[2],C[4]);break;case 4:bt(_,0,0,1),bt(k,C[1],C[3],C[5]);break;case 5:bt(_,0,0,-1),bt(k,C[0],C[2],C[4]);break;case 0:default:bt(_,1,0,0),bt(k,C[1],C[3],C[5]);break}rp(_,_,e.idxNormalMatrix),pt(k,k,e.idxToView);const de=-1*Qe(k,_);l.setUniform3f(`vPlaneNormal${J}`,_[0],_[1],_[2]),l.setUniformf(`vPlaneDistance${J}`,de)}if(t.isLabelmapOutlineRequired(o)){const de=e.currentInput.getWorldToIndex();l.setUniformMatrix("vWCtoIDX",de);const Q=a.getActiveCamera(),[q,j]=Q.getClippingRange(),ie=Q.getDistance();Q.setClippingRange(ie,ie+.1);const ue=e.openGLCamera.getKeyMatrices(a);Ln(e.projectionToWorld,ue.wcpc),Q.setClippingRange(q,j),e.openGLCamera.getKeyMatrices(a),l.setUniformMatrix("PCWCMatrix",e.projectionToWorld);const le=t.getRenderTargetSize();l.setUniformf("vpWidth",le[0]),l.setUniformf("vpHeight",le[1]);const Fe=t.getRenderTargetOffset();l.setUniformf("vpOffsetX",Fe[0]/le[0]),l.setUniformf("vpOffsetY",Fe[1]/le[1])}if(Ln(e.projectionToView,s.vcpc),l.setUniformMatrix("PCVCMatrix",e.projectionToView),e.lightComplexity===0)return;let z=0;const X=[],Z=[],ce=[];if(a.getLights().forEach(J=>{if(J.getSwitch()>0){const Q=J.getColor(),q=J.getIntensity();X[0+z*3]=Q[0]*q,X[1+z*3]=Q[1]*q,X[2+z*3]=Q[2]*q;const j=J.getDirection();bt(_,j[0],j[1],j[2]),rp(_,_,s.normalMatrix),wn(_,_),Z[0+z*3]=_[0],Z[1+z*3]=_[1],Z[2+z*3]=_[2],ce[0+z*3]=-.5*_[0],ce[1+z*3]=-.5*_[1],ce[2+z*3]=-.5*(_[2]-1),z++}}),l.setUniformi("twoSidedLighting",a.getTwoSidedLighting()),l.setUniformi("lightNum",z),l.setUniform3fv("lightColor",X),l.setUniform3fv("lightDirectionVC",Z),l.setUniform3fv("lightHalfAngleVC",ce),e.lightComplexity===3){z=0;const J=[],de=[],Q=[],q=[],j=[];a.getLights().forEach(ie=>{if(ie.getSwitch()>0){const le=ie.getAttenuationValues();de[0+z*3]=le[0],de[1+z*3]=le[1],de[2+z*3]=le[2],q[z]=ie.getExponent(),Q[z]=ie.getConeAngle(),j[z]=ie.getPositional();const Fe=ie.getTransformedPosition();pt(Fe,Fe,e.modelToView),J[0+z*3]=Fe[0],J[1+z*3]=Fe[1],J[2+z*3]=Fe[2],z+=1}}),l.setUniform3fv("lightPositionVC",J),l.setUniform3fv("lightAttenuation",de),l.setUniformfv("lightConeAngle",Q),l.setUniformfv("lightExponent",q),l.setUniformiv("lightPositional",j)}if(e.renderable.getVolumetricScatteringBlending()>0&&(l.setUniformf("giReach",e.renderable.getGlobalIlluminationReach()),l.setUniformf("volumetricScatteringBlending",e.renderable.getVolumetricScatteringBlending()),l.setUniformf("volumeShadowSamplingDistFactor",e.renderable.getVolumeShadowSamplingDistFactor()),l.setUniformf("anisotropy",e.renderable.getAnisotropy()),l.setUniformf("anisotropy2",e.renderable.getAnisotropy()**2)),e.renderable.getLocalAmbientOcclusion()&&o.getProperty().getAmbient()>0){const J=e.renderable.getLAOKernelSize();l.setUniformi("kernelSize",J);const de=[];for(let Q=0;Q<J;Q++)de[Q*2]=Math.random()*.5,de[Q*2+1]=Math.random()*.5;l.setUniform2fv("kernelSample",de),l.setUniformi("kernelRadius",e.renderable.getLAOKernelRadius())}},t.setPropertyShaderParameters=(i,a,o)=>{const s=i.getProgram();s.setUniformi("ctexture",e.colorTexture.getTextureUnit()),s.setUniformi("otexture",e.opacityTexture.getTextureUnit()),s.setUniformi("jtexture",e.jitterTexture.getTextureUnit()),s.setUniformi("ttexture",e.labelOutlineThicknessTexture.getTextureUnit());const c=e.scalarTexture.getVolumeInfo(),l=o.getProperty(),f=e.scalarTexture.getComponents(),u=t.useIndependentComponents(l);if(u)for(let d=0;d<f;d++)s.setUniformf(`mix${d}`,o.getProperty().getComponentWeight(d));for(let d=0;d<f;d++){const h=u?d:0,p=c.scale[d],v=l.getScalarOpacity(h).getRange(),y=p/(v[1]-v[0]),T=(c.offset[d]-v[0])/(v[1]-v[0]);s.setUniformf(`oshift${d}`,T),s.setUniformf(`oscale${d}`,y);const w=l.getRGBTransferFunction(h).getRange(),x=(c.offset[d]-w[0])/(w[1]-w[0]),O=p/(w[1]-w[0]);s.setUniformf(`cshift${d}`,x),s.setUniformf(`cscale${d}`,O)}if(e.gopacity)if(u)for(let d=0;d<f;++d){const h=c.scale[d];if(l.getUseGradientOpacity(d)){const m=l.getGradientOpacityMinimumOpacity(d),v=l.getGradientOpacityMaximumOpacity(d);s.setUniformf(`gomin${d}`,m),s.setUniformf(`gomax${d}`,v);const y=[l.getGradientOpacityMinimumValue(d),l.getGradientOpacityMaximumValue(d)];s.setUniformf(`goscale${d}`,h*(v-m)/(y[1]-y[0])),s.setUniformf(`goshift${d}`,-y[0]*(v-m)/(y[1]-y[0])+m)}else s.setUniformf(`gomin${d}`,1),s.setUniformf(`gomax${d}`,1),s.setUniformf(`goscale${d}`,0),s.setUniformf(`goshift${d}`,1)}else{const d=c.scale[f-1],h=l.getGradientOpacityMinimumOpacity(0),p=l.getGradientOpacityMaximumOpacity(0);s.setUniformf("gomin0",h),s.setUniformf("gomax0",p);const m=[l.getGradientOpacityMinimumValue(0),l.getGradientOpacityMaximumValue(0)];s.setUniformf("goscale0",d*(p-h)/(m[1]-m[0])),s.setUniformf("goshift0",-m[0]*(p-h)/(m[1]-m[0])+h)}if(t.isLabelmapOutlineRequired(o)===!0){const d=o.getProperty().getLabelOutlineOpacity();s.setUniformf("outlineOpacity",d)}e.lightComplexity>0&&(s.setUniformf("vAmbient",l.getAmbient()),s.setUniformf("vDiffuse",l.getDiffuse()),s.setUniformf("vSpecular",l.getSpecular()),s.setUniformf("vSpecularPower",l.getSpecularPower()))},t.getClippingPlaneShaderParameters=(i,a,o)=>{if(e.renderable.getClippingPlanes().length>0){const s=e.openGLCamera.getKeyMatrices(a),c=[],l=[],f=[],u=e.renderable.getClippingPlanes(),g=u.length;for(let h=0;h<g;++h){const p=u[h].getNormal(),m=u[h].getOrigin();rp(p,p,s.normalMatrix),pt(m,m,s.wcvc);const v=-1*Qe(m,p);c.push(p[0]),c.push(p[1]),c.push(p[2]),l.push(v),f.push(m[0]),f.push(m[1]),f.push(m[2])}const d=i.getProgram();d.setUniform3fv("vClipPlaneNormals",c),d.setUniformfv("vClipPlaneDistances",l),d.setUniform3fv("vClipPlaneOrigins",f),d.setUniformi("clip_numPlanes",g)}},t.delete=gd(()=>{e._animationRateSubscription&&(e._animationRateSubscription.unsubscribe(),e._animationRateSubscription=null)},()=>{e._openGLRenderWindow&&n(e._openGLRenderWindow)},t.delete),t.getRenderTargetSize=()=>{if(e._useSmallViewport)return[e._smallViewportWidth,e._smallViewportHeight];const{usize:i,vsize:a}=e._openGLRenderer.getTiledSizeAndOrigin();return[i,a]},t.getRenderTargetOffset=()=>{const{lowerLeftU:i,lowerLeftV:a}=e._openGLRenderer.getTiledSizeAndOrigin();return[i,a]},t.getCurrentSampleDistance=i=>{const a=i.getVTKWindow().getInteractor(),o=e.renderable.getSampleDistance();if(a.isAnimating()){const s=e.renderable.getInteractionSampleDistanceFactor();return o*s}return o},t.renderPieceStart=(i,a)=>{const o=i.getVTKWindow().getInteractor();if(e._lastScale||(e._lastScale=e.renderable.getInitialInteractionScale()),e._useSmallViewport=!1,o.isAnimating()&&e._lastScale>1.5&&(e._useSmallViewport=!0),e._animationRateSubscription||(e._animationRateSubscription=o.onAnimationFrameRateUpdate(()=>{if(e.renderable.getAutoAdjustSampleDistances()){const c=o.getRecentAnimationFrameRate(),l=o.getDesiredUpdateRate()/c;(l>1.15||l<.85)&&(e._lastScale*=l),e._lastScale>400&&(e._lastScale=400),e._lastScale<1.5&&(e._lastScale=1.5)}else e._lastScale=e.renderable.getImageSampleDistance()*e.renderable.getImageSampleDistance()})),e._useSmallViewport){const c=e._openGLRenderWindow.getFramebufferSize(),l=1/Math.sqrt(e._lastScale);if(e._smallViewportWidth=Math.ceil(l*c[0]),e._smallViewportHeight=Math.ceil(l*c[1]),e._smallViewportHeight>c[1]&&(e._smallViewportHeight=c[1]),e._smallViewportWidth>c[0]&&(e._smallViewportWidth=c[0]),e.framebuffer.saveCurrentBindingsAndBuffers(),e.framebuffer.getGLFramebuffer()===null)e.framebuffer.create(c[0],c[1]),e.framebuffer.populateFramebuffer();else{const u=e.framebuffer.getSize();(!u||u[0]!==c[0]||u[1]!==c[1])&&(e.framebuffer.create(c[0],c[1]),e.framebuffer.populateFramebuffer())}e.framebuffer.bind();const f=e.context;f.clearColor(0,0,0,0),f.colorMask(!0,!0,!0,!0),f.clear(f.COLOR_BUFFER_BIT),f.viewport(0,0,e._smallViewportWidth,e._smallViewportHeight),e.fvp=[e._smallViewportWidth/c[0],e._smallViewportHeight/c[1]]}e.context.disable(e.context.DEPTH_TEST),t.updateBufferObjects(i,a),a.getProperty().getInterpolationType()===A3.NEAREST?(e.scalarTexture.setMinificationFilter(Ge.NEAREST),e.scalarTexture.setMagnificationFilter(Ge.NEAREST)):(e.scalarTexture.setMinificationFilter(Ge.LINEAR),e.scalarTexture.setMagnificationFilter(Ge.LINEAR)),e.zBufferTexture!==null&&e.zBufferTexture.activate()},t.renderPieceDraw=(i,a)=>{const o=e.context;e.scalarTexture.activate(),e.opacityTexture.activate(),e.labelOutlineThicknessTexture.activate(),e.colorTexture.activate(),e.jitterTexture.activate(),t.updateShaders(e.tris,i,a),o.drawArrays(o.TRIANGLES,0,e.tris.getCABO().getElementCount()),e.tris.getVAO().release(),e.scalarTexture.deactivate(),e.colorTexture.deactivate(),e.opacityTexture.deactivate(),e.labelOutlineThicknessTexture.deactivate(),e.jitterTexture.deactivate()},t.renderPieceFinish=(i,a)=>{if(e.zBufferTexture!==null&&e.zBufferTexture.deactivate(),e._useSmallViewport){if(e.framebuffer.restorePreviousBindingsAndBuffers(),e.copyShader===null){e.copyShader=e._openGLRenderWindow.getShaderCache().readyShaderProgramArray(["//VTK::System::Dec","attribute vec4 vertexDC;","uniform vec2 tfactor;","varying vec2 tcoord;","void main() { tcoord = vec2(vertexDC.x*0.5 + 0.5, vertexDC.y*0.5 + 0.5) * tfactor; gl_Position = vertexDC; }"].join(`
`),["//VTK::System::Dec","//VTK::Output::Dec","uniform sampler2D texture1;","varying vec2 tcoord;","void main() { gl_FragData[0] = texture2D(texture1,tcoord); }"].join(`
`),"");const l=e.copyShader;e.copyVAO=j4.newInstance(),e.copyVAO.setOpenGLRenderWindow(e._openGLRenderWindow),e.tris.getCABO().bind(),e.copyVAO.addAttributeArray(l,e.tris.getCABO(),"vertexDC",e.tris.getCABO().getVertexOffset(),e.tris.getCABO().getStride(),e.context.FLOAT,3,e.context.FALSE)||I5("Error setting vertexDC in copy shader VAO.")}else e._openGLRenderWindow.getShaderCache().readyShaderProgram(e.copyShader);const o=e._openGLRenderWindow.getFramebufferSize();e.context.viewport(0,0,o[0],o[1]);const s=e.framebuffer.getColorTexture();s.activate(),e.copyShader.setUniformi("texture",s.getTextureUnit()),e.copyShader.setUniform2f("tfactor",e.fvp[0],e.fvp[1]);const c=e.context;c.blendFuncSeparate(c.ONE,c.ONE_MINUS_SRC_ALPHA,c.ONE,c.ONE_MINUS_SRC_ALPHA),e.context.drawArrays(e.context.TRIANGLES,0,e.tris.getCABO().getElementCount()),s.deactivate(),c.blendFuncSeparate(c.SRC_ALPHA,c.ONE_MINUS_SRC_ALPHA,c.ONE,c.ONE_MINUS_SRC_ALPHA)}},t.renderPiece=(i,a)=>{if(t.invokeEvent({type:"StartEvent"}),e.renderable.update(),e.currentInput=e.renderable.getInputData(),t.invokeEvent({type:"EndEvent"}),!e.currentInput){I5("No input!");return}t.renderPieceStart(i,a),t.renderPieceDraw(i,a),t.renderPieceFinish(i,a)},t.computeBounds=(i,a)=>{if(!t.getInput()){Xu(e.Bounds);return}e.bounds=t.getInput().getBounds()},t.updateBufferObjects=(i,a)=>{t.getNeedToRebuildBufferObjects(i,a)&&t.buildBufferObjects(i,a)},t.getNeedToRebuildBufferObjects=(i,a)=>{var o,s,c;return e.VBOBuildTime.getMTime()<t.getMTime()||e.VBOBuildTime.getMTime()<a.getMTime()||e.VBOBuildTime.getMTime()<e.renderable.getMTime()||e.VBOBuildTime.getMTime()<a.getProperty().getMTime()||e.VBOBuildTime.getMTime()<e.currentInput.getMTime()||!((o=e.scalarTexture)!=null&&o.getHandle())||!((s=e.colorTexture)!=null&&s.getHandle())||!((c=e.labelOutlineThicknessTexture)!=null&&c.getHandle())},t.buildBufferObjects=(i,a)=>{var w,x;const o=e.currentInput;if(!o)return;const s=o.getPointData()&&o.getPointData().getScalars();if(!s)return;const c=a.getProperty();if(!e.jitterTexture.getHandle()){const O=new Uint8Array(1024);for(let M=0;M<32*32;++M)O[M]=255*Math.random();e.jitterTexture.setMinificationFilter(Ge.LINEAR),e.jitterTexture.setMagnificationFilter(Ge.LINEAR),e.jitterTexture.create2DFromRaw(32,32,1,ut.UNSIGNED_CHAR,O)}const l=s.getNumberOfComponents(),f=t.useIndependentComponents(c),u=f?l:1,g=c.getScalarOpacity(),d=e._openGLRenderWindow.getGraphicsResourceForObject(g);let h=Co(g,f,u);if(!(d!=null&&d.oglObject)||d.hash!==h){e.opacityTexture=Xt.newInstance(),e.opacityTexture.setOpenGLRenderWindow(e._openGLRenderWindow);const O=1024,M=O*2*u,A=new Float32Array(M),_=new Float32Array(O);for(let k=0;k<u;++k){const z=c.getScalarOpacity(k),X=t.getCurrentSampleDistance(i)/c.getScalarOpacityUnitDistance(k),Z=z.getRange();z.getTable(Z[0],Z[1],O,_,1);for(let ce=0;ce<O;++ce)A[k*O*2+ce]=1-(1-_[ce])**X,A[k*O*2+ce+O]=A[k*O*2+ce]}if(e.opacityTexture.resetFormatAndType(),e.opacityTexture.setMinificationFilter(Ge.LINEAR),e.opacityTexture.setMagnificationFilter(Ge.LINEAR),e._openGLRenderWindow.getWebgl2()||e.context.getExtension("OES_texture_float")&&e.context.getExtension("OES_texture_float_linear"))e.opacityTexture.create2DFromRaw(O,2*u,1,ut.FLOAT,A);else{const k=new Uint8ClampedArray(M);for(let z=0;z<M;++z)k[z]=255*A[z];e.opacityTexture.create2DFromRaw(O,2*u,1,ut.UNSIGNED_CHAR,k)}g&&(e._openGLRenderWindow.setGraphicsResourceForObject(g,e.opacityTexture,h),g!==e._scalarOpacityFunc&&(e._openGLRenderWindow.registerGraphicsResourceUser(g,t),e._openGLRenderWindow.unregisterGraphicsResourceUser(e._scalarOpacityFunc,t)),e._scalarOpacityFunc=g)}else e.opacityTexture=d.oglObject;const m=c.getRGBTransferFunction();h=Co(m,f,u);const v=e._openGLRenderWindow.getGraphicsResourceForObject(m);if(!((w=v==null?void 0:v.oglObject)!=null&&w.getHandle())||(v==null?void 0:v.hash)!==h){e.colorTexture=Xt.newInstance(),e.colorTexture.setOpenGLRenderWindow(e._openGLRenderWindow);const O=1024,M=O*2*u*3,A=new Uint8ClampedArray(M),_=new Float32Array(O*3);for(let k=0;k<u;++k){const z=c.getRGBTransferFunction(k),X=z.getRange();z.getTable(X[0],X[1],O,_,1);for(let Z=0;Z<O*3;++Z)A[k*O*6+Z]=255*_[Z],A[k*O*6+Z+O*3]=255*_[Z]}e.colorTexture.resetFormatAndType(),e.colorTexture.setMinificationFilter(Ge.LINEAR),e.colorTexture.setMagnificationFilter(Ge.LINEAR),e.colorTexture.create2DFromRaw(O,2*u,3,ut.UNSIGNED_CHAR,A),m&&(e._openGLRenderWindow.setGraphicsResourceForObject(m,e.colorTexture,h),m!==e._colorTransferFunc&&(e._openGLRenderWindow.registerGraphicsResourceUser(m,t),e._openGLRenderWindow.unregisterGraphicsResourceUser(e._colorTransferFunc,t)),e._colorTransferFunc=m)}else e.colorTexture=v.oglObject;t.updateLabelOutlineThicknessTexture(a);const T=e._openGLRenderWindow.getGraphicsResourceForObject(s);if(h=oy(o,s),!((x=T==null?void 0:T.oglObject)!=null&&x.getHandle())||(T==null?void 0:T.hash)!==h){e.scalarTexture=Xt.newInstance(),e.scalarTexture.setOpenGLRenderWindow(e._openGLRenderWindow);const O=o.getDimensions();e.scalarTexture.setOglNorm16Ext(e.context.getExtension("EXT_texture_norm16")),e.scalarTexture.resetFormatAndType(),e.scalarTexture.create3DFilterableFromDataArray(O[0],O[1],O[2],s,e.renderable.getPreferSizeOverAccuracy()),s&&(e._openGLRenderWindow.setGraphicsResourceForObject(s,e.scalarTexture,h),s!==e._scalars&&(e._openGLRenderWindow.registerGraphicsResourceUser(s,t),e._openGLRenderWindow.unregisterGraphicsResourceUser(e._scalars,t)),e._scalars=s)}else e.scalarTexture=T.oglObject;if(!e.tris.getCABO().getElementCount()){const O=new Float32Array(12);for(let k=0;k<4;k++)O[k*3]=k%2*2-1,O[k*3+1]=k>1?1:-1,O[k*3+2]=-1;const M=new Uint16Array(8);M[0]=3,M[1]=0,M[2]=1,M[3]=3,M[4]=3,M[5]=0,M[6]=3,M[7]=2;const A=nt.newInstance({numberOfComponents:3,values:O});A.setName("points");const _=nt.newInstance({numberOfComponents:1,values:M});e.tris.getCABO().createVBO(_,"polys",_r.SURFACE,{points:A,cellOffset:0})}e.VBOBuildTime.modified()},t.updateLabelOutlineThicknessTexture=i=>{var l;const a=i.getProperty().getLabelOutlineThickness(),o=e._openGLRenderWindow.getGraphicsResourceForObject(a),s=`${a.join("-")}`;if(!((l=o==null?void 0:o.oglObject)!=null&&l.getHandle())||(o==null?void 0:o.hash)!==s){e.labelOutlineThicknessTexture=Xt.newInstance(),e.labelOutlineThicknessTexture.setOpenGLRenderWindow(e._openGLRenderWindow);const f=1024,u=1,g=f*u,d=new Uint8Array(g);for(let h=0;h<f;++h){const p=typeof a[h]<"u"?a[h]:a[0];d[h]=p}e.labelOutlineThicknessTexture.resetFormatAndType(),e.labelOutlineThicknessTexture.setMinificationFilter(Ge.NEAREST),e.labelOutlineThicknessTexture.setMagnificationFilter(Ge.NEAREST),e.labelOutlineThicknessTexture.create2DFromRaw(f,u,1,ut.UNSIGNED_CHAR,d),a&&(e._openGLRenderWindow.setGraphicsResourceForObject(a,e.labelOutlineThicknessTexture,s),a!==e._labelOutlineThicknessArray&&(e._openGLRenderWindow.registerGraphicsResourceUser(a,t),e._openGLRenderWindow.unregisterGraphicsResourceUser(e._labelOutlineThicknessArray,t)),e._labelOutlineThicknessArray=a)}else e.labelOutlineThicknessTexture=o.oglObject},t.isLabelmapOutlineRequired=i=>{const a=i.getProperty(),o=e.renderable;return a.getUseLabelOutline()||o.getBlendMode()===X1.LABELMAP_EDGE_PROJECTION_BLEND}}const j$={context:null,VBOBuildTime:null,scalarTexture:null,opacityTexture:null,opacityTextureString:null,colorTexture:null,colorTextureString:null,jitterTexture:null,labelOutlineThicknessTexture:null,labelOutlineThicknessTextureString:null,tris:null,framebuffer:null,copyShader:null,copyVAO:null,lastXYF:1,targetXYF:1,zBufferTexture:null,lastZBufferTexture:null,lightComplexity:0,fullViewportTime:1,idxToView:null,idxNormalMatrix:null,modelToView:null,projectionToView:null,avgWindowArea:0,avgFrameTime:0};function XO(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,j$,n),Bt.extend(t,e,n),To.implementBuildShadersWithReplacements(t,e,n),e.VBOBuildTime={},zt(e.VBOBuildTime,{mtime:0}),e.tris=Oo.newInstance(),e.jitterTexture=Xt.newInstance(),e.jitterTexture.setWrapS(Fg.REPEAT),e.jitterTexture.setWrapT(Fg.REPEAT),e.framebuffer=f2.newInstance(),e.idxToView=Be(new Float64Array(16)),e.idxNormalMatrix=ya(new Float64Array(9)),e.modelToView=Be(new Float64Array(16)),e.projectionToView=Be(new Float64Array(16)),e.projectionToWorld=Be(new Float64Array(16)),Vn(t,e,["context"]),z$(t,e)}const YO=Rt(XO,"vtkOpenGLVolumeMapper");var ZO={newInstance:YO,extend:XO};Wn("vtkVolumeMapper",YO);function sy(t,e){switch(t){case"Float32Array":return Float32Array;case"Uint8Array":return Uint8Array;case"Uint16Array":case"Int16Array":return e?(console.debug(`${t} is not supported for volume rendering, switching back to Float32Array`),Float32Array):t==="Uint16Array"?Uint16Array:Int16Array;default:if(t)throw new Error("TargetBuffer should be Float32Array, Uint8Array, Uint16Array, or Int16Array");return Float32Array}}function cy(t,e,n={}){const{isVolumeBuffer:r=!1}=n,i=sy(t,r),a=i.BYTES_PER_ELEMENT;return{numBytes:e*a,TypedArrayConstructor:i}}function dl(t){return Ag.get(t)}function Do(){return Ag.getAll()}const ph=t=>t&&typeof t=="object"&&Object.prototype.toString.call(t)!=="[object RegExp]"&&Object.prototype.toString.call(t)!=="[object Date]",H$=t=>Array.isArray(t)?[]:{},$g=(t,e)=>e&&e.clone===!0&&ph(t)?Li(H$(t),t,e):t,F9=(t,e,n)=>{const r=t.slice();return e.forEach(function(i,a){typeof r[a]>"u"?r[a]=$g(i,n):ph(i)?r[a]=Li(t[a],i,n):t.indexOf(i)===-1&&(r[a]=$g(i,n))}),r},K$=(t,e,n)=>{const r={};return ph(t)&&Object.keys(t).forEach(function(i){r[i]=$g(t[i],n)}),Object.keys(e).forEach(function(i){!ph(e[i])||!t[i]?r[i]=$g(e[i],n):r[i]=Li(t[i],e[i],n)}),r},Li=(t={},e={},n=void 0)=>{const r=Array.isArray(e),a=(n||{arrayMerge:F9}).arrayMerge||F9;return r?Array.isArray(t)?a(t,e,n):$g(e,n):K$(t,e,n)};/**
 * @license
 * Copyright 2019 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const QO=Symbol("Comlink.proxy"),q$=Symbol("Comlink.endpoint"),JO=Symbol("Comlink.releaseProxy"),V5=Symbol("Comlink.finalizer"),sp=Symbol("Comlink.thrown"),eD=t=>typeof t=="object"&&t!==null||typeof t=="function",X$={canHandle:t=>eD(t)&&t[QO],serialize(t){const{port1:e,port2:n}=new MessageChannel;return ly(t,e),[n,[n]]},deserialize(t){return t.start(),F3(t)}},Y$={canHandle:t=>eD(t)&&sp in t,serialize({value:t}){let e;return t instanceof Error?e={isError:!0,value:{message:t.message,name:t.name,stack:t.stack}}:e={isError:!1,value:t},[e,[]]},deserialize(t){throw t.isError?Object.assign(new Error(t.value.message),t.value):t.value}},tD=new Map([["proxy",X$],["throw",Y$]]);function Z$(t,e){for(const n of t)if(e===n||n==="*"||n instanceof RegExp&&n.test(e))return!0;return!1}function ly(t,e=globalThis,n=["*"]){e.addEventListener("message",function r(i){if(!i||!i.data)return;if(!Z$(n,i.origin)){console.warn(`Invalid origin '${i.origin}' for comlink proxy`);return}const{id:a,type:o,path:s}=Object.assign({path:[]},i.data),c=(i.data.argumentList||[]).map(R0);let l;try{const f=s.slice(0,-1).reduce((g,d)=>g[d],t),u=s.reduce((g,d)=>g[d],t);switch(o){case"GET":l=u;break;case"SET":f[s.slice(-1)[0]]=R0(i.data.value),l=!0;break;case"APPLY":l=u.apply(f,c);break;case"CONSTRUCT":{const g=new u(...c);l=aD(g)}break;case"ENDPOINT":{const{port1:g,port2:d}=new MessageChannel;ly(t,d),l=nW(g,[g])}break;case"RELEASE":l=void 0;break;default:return}}catch(f){l={value:f,[sp]:0}}Promise.resolve(l).catch(f=>({value:f,[sp]:0})).then(f=>{const[u,g]=vh(f);e.postMessage(Object.assign(Object.assign({},u),{id:a}),g),o==="RELEASE"&&(e.removeEventListener("message",r),nD(e),V5 in t&&typeof t[V5]=="function"&&t[V5]())}).catch(f=>{const[u,g]=vh({value:new TypeError("Unserializable return value"),[sp]:0});e.postMessage(Object.assign(Object.assign({},u),{id:a}),g)})}),e.start&&e.start()}function Q$(t){return t.constructor.name==="MessagePort"}function nD(t){Q$(t)&&t.close()}function F3(t,e){return U3(t,[],e)}function i1(t){if(t)throw new Error("Proxy has been released and is not useable")}function rD(t){return bl(t,{type:"RELEASE"}).then(()=>{nD(t)})}const hh=new WeakMap,mh="FinalizationRegistry"in globalThis&&new FinalizationRegistry(t=>{const e=(hh.get(t)||0)-1;hh.set(t,e),e===0&&rD(t)});function J$(t,e){const n=(hh.get(e)||0)+1;hh.set(e,n),mh&&mh.register(t,e,t)}function eW(t){mh&&mh.unregister(t)}function U3(t,e=[],n=function(){}){let r=!1;const i=new Proxy(n,{get(a,o){if(i1(r),o===JO)return()=>{eW(i),rD(t),r=!0};if(o==="then"){if(e.length===0)return{then:()=>i};const s=bl(t,{type:"GET",path:e.map(c=>c.toString())}).then(R0);return s.then.bind(s)}return U3(t,[...e,o])},set(a,o,s){i1(r);const[c,l]=vh(s);return bl(t,{type:"SET",path:[...e,o].map(f=>f.toString()),value:c},l).then(R0)},apply(a,o,s){i1(r);const c=e[e.length-1];if(c===q$)return bl(t,{type:"ENDPOINT"}).then(R0);if(c==="bind")return U3(t,e.slice(0,-1));const[l,f]=U9(s);return bl(t,{type:"APPLY",path:e.map(u=>u.toString()),argumentList:l},f).then(R0)},construct(a,o){i1(r);const[s,c]=U9(o);return bl(t,{type:"CONSTRUCT",path:e.map(l=>l.toString()),argumentList:s},c).then(R0)}});return J$(i,t),i}function tW(t){return Array.prototype.concat.apply([],t)}function U9(t){const e=t.map(vh);return[e.map(n=>n[0]),tW(e.map(n=>n[1]))]}const iD=new WeakMap;function nW(t,e){return iD.set(t,e),t}function aD(t){return Object.assign(t,{[QO]:!0})}function vh(t){for(const[e,n]of tD)if(n.canHandle(t)){const[r,i]=n.serialize(t);return[{type:"HANDLER",name:e,value:r},i]}return[{type:"RAW",value:t},iD.get(t)||[]]}function R0(t){switch(t.type){case"HANDLER":return tD.get(t.name).deserialize(t.value);case"RAW":return t.value}}function bl(t,e,n){return new Promise(r=>{const i=rW();t.addEventListener("message",function a(o){!o.data||!o.data.id||o.data.id!==i||(t.removeEventListener("message",a),r(o.data))}),t.start&&t.start(),t.postMessage(Object.assign({id:i},e),n)})}function rW(){return new Array(4).fill(0).map(()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16)).join("-")}class uy{constructor(e){this.numRequests={[ot.Interaction]:0,[ot.Thumbnail]:0,[ot.Prefetch]:0,[ot.Compute]:0},this.id=e||In(),this.requestPool={[ot.Interaction]:{0:[]},[ot.Thumbnail]:{0:[]},[ot.Prefetch]:{0:[]},[ot.Compute]:{0:[]}},this.grabDelay=5,this.awake=!1,this.numRequests={[ot.Interaction]:0,[ot.Thumbnail]:0,[ot.Prefetch]:0,[ot.Compute]:0},this.maxNumRequests={[ot.Interaction]:6,[ot.Thumbnail]:6,[ot.Prefetch]:5,[ot.Compute]:1e3}}setMaxSimultaneousRequests(e,n){this.maxNumRequests[e]=n}getMaxSimultaneousRequests(e){return this.maxNumRequests[e]}destroy(){this.timeoutHandle&&window.clearTimeout(this.timeoutHandle)}addRequest(e,n,r,i=0){const a={requestFn:e,type:n,additionalDetails:r};this.requestPool[n][i]===void 0&&(this.requestPool[n][i]=[]),this.requestPool[n][i].push(a),this.startGrabbing()}filterRequests(e){Object.keys(this.requestPool).forEach(n=>{const r=this.requestPool[n];Object.keys(r).forEach(i=>{r[i]=r[i].filter(a=>e(a))})})}clearRequestStack(e){if(!this.requestPool[e])throw new Error(`No category for the type ${e} found`);this.requestPool[e]={0:[]}}sendRequests(e){const n=this.maxNumRequests[e]-this.numRequests[e];let r=0;for(let i=0;i<n;i++){const a=this.getNextRequest(e);if(a===null)return!1;if(a){this.numRequests[e]++,this.awake=!0;let o;try{o=a.requestFn()}catch(s){console.warn("sendRequest failed",s)}o!=null&&o.finally?o.finally(()=>{this.numRequests[e]--,this.startAgain()}):(this.numRequests[e]--,r++)}}return r&&this.startAgain(),!0}getNextRequest(e){const n=this.getSortedPriorityGroups(e);for(const r of n)if(this.requestPool[e][r].length)return this.requestPool[e][r].shift();return null}startGrabbing(){const e=this.sendRequests(ot.Interaction),n=this.sendRequests(ot.Thumbnail),r=this.sendRequests(ot.Prefetch),i=this.sendRequests(ot.Compute);!e&&!n&&!r&&!i&&(this.awake=!1)}startAgain(){this.awake&&(this.grabDelay!==void 0?this.timeoutHandle||(this.timeoutHandle=window.setTimeout(()=>{this.timeoutHandle=null,this.startGrabbing()},this.grabDelay)):this.startGrabbing())}getSortedPriorityGroups(e){return Object.keys(this.requestPool[e]).map(Number).filter(r=>this.requestPool[e][r].length).sort((r,i)=>r-i)}getRequestPool(){return this.requestPool}}class oD{constructor(){this.workerRegistry={},this.workerPoolManager=new uy("webworker")}registerWorker(e,n,r={}){var c;const{maxWorkerInstances:i=1,overwrite:a=!1,autoTerminateOnIdle:o={enabled:!1,idleTimeThreshold:3e3}}=r;if(this.workerRegistry[e]&&!a){console.warn(`Worker type '${e}' is already registered...`);return}a&&((c=this.workerRegistry[e])!=null&&c.idleCheckIntervalId)&&clearInterval(this.workerRegistry[e].idleCheckIntervalId);const s={workerFn:null,instances:[],loadCounters:[],lastActiveTime:[],nativeWorkers:[],autoTerminateOnIdle:o.enabled,idleCheckIntervalId:null,idleTimeThreshold:o.idleTimeThreshold};s.loadCounters=Array(i).fill(0),s.lastActiveTime=Array(i).fill(null);for(let l=0;l<i;l++){const f=n();s.instances.push(F3(f)),s.nativeWorkers.push(f),s.workerFn=n}this.workerRegistry[e]=s}getNextWorkerAPI(e){const n=this.workerRegistry[e];if(!n)return console.error(`Worker type '${e}' is not registered.`),null;const r=n.instances.filter(o=>o!==null);let i=0,a=n.loadCounters[0]||0;for(let o=1;o<r.length;o++){const s=n.loadCounters[o]||0;s<a&&(i=o,a=s)}if(n.instances[i]===null){const o=n.workerFn();n.instances[i]=F3(o),n.nativeWorkers[i]=o}return n.loadCounters[i]+=1,{api:n.instances[i],index:i}}executeTask(e,n,r={},{requestType:i=ot.Compute,priority:a=0,options:o={},callbacks:s=[]}={}){return new Promise((c,l)=>{const f=async()=>{const{api:u,index:g}=this.getNextWorkerAPI(e);if(!u){const d=new Error(`No available worker instance for '${e}'`);console.error(d),l(d);return}try{let d=[];s.length&&(d=s.map(m=>aD(m)));const h=this.workerRegistry[e];h.processing=!0;const p=await u[n](r,...d);h.processing=!1,h.lastActiveTime[g]=Date.now(),h.autoTerminateOnIdle&&!h.idleCheckIntervalId&&h.idleTimeThreshold&&(h.idleCheckIntervalId=setInterval(()=>{this.terminateIdleWorkers(e,h.idleTimeThreshold)},h.idleTimeThreshold)),c(p)}catch(d){console.error(`Error executing method '${n}' on worker '${e}':`,d),l(d)}finally{this.workerRegistry[e].loadCounters[g]--}};this.workerPoolManager.addRequest(f,i,o,a)})}terminateIdleWorkers(e,n){const r=this.workerRegistry[e];if(r.processing)return;const i=Date.now();r.instances.forEach((a,o)=>{const s=r.lastActiveTime[o],c=s!==null&&r.loadCounters[o]>0,l=i-s;!c&&l>n&&this.terminateWorkerInstance(e,o)})}terminate(e){const n=this.workerRegistry[e];if(!n){console.error(`Worker type '${e}' is not registered.`);return}n.instances.forEach((r,i)=>{this.terminateWorkerInstance(e,i)})}terminateWorkerInstance(e,n){const r=this.workerRegistry[e],i=r.instances[n];i!==null&&(i[JO](),r.nativeWorkers[n].terminate(),r.instances[n]=null,r.lastActiveTime[n]=null)}}const P5=4,iW=5,aW=1,B9=[1,1];function G9({ext:t,filterType:e,texData:n,internalFormat:r,glDataType:i}){try{const a=document.createElement("canvas");a.width=P5,a.height=P5;const o=a.getContext("webgl2");if(!o)return!1;const s=`#version 300 es
    void main() {
      gl_PointSize = ${P5.toFixed(1)};
      gl_Position = vec4(0, 0, 0, 1);
    }
  `,c=`#version 300 es
    precision highp float;
    precision highp int;
    precision highp sampler2D;

    uniform sampler2D u_image;

    out vec4 color;

    void main() {
        vec4 intColor = texture(u_image, gl_PointCoord.xy);
        color = vec4(vec3(intColor.rrr), 1);
    }
    `;let l;if(t&&(l=o.getExtension(t),!l))return!1;const f=o.createShader(o.VERTEX_SHADER);if(o.shaderSource(f,s),o.compileShader(f),!o.getShaderParameter(f,o.COMPILE_STATUS))return!1;const u=o.createShader(o.FRAGMENT_SHADER);if(o.shaderSource(u,c),o.compileShader(u),!o.getShaderParameter(u,o.COMPILE_STATUS))return!1;const g=o.createProgram();if(o.attachShader(g,f),o.attachShader(g,u),o.linkProgram(g),!o.getProgramParameter(g,o.LINK_STATUS))return!1;const d=o.createTexture();o.bindTexture(o.TEXTURE_2D,d),o.texImage2D(o.TEXTURE_2D,0,r(o,l),iW,aW,0,o.RED,i(o,l),n);const h=e==="LINEAR"?o.LINEAR:o.NEAREST;o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MAG_FILTER,h),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MIN_FILTER,h),o.useProgram(g),o.drawArrays(o.POINTS,0,1);const p=new Uint8Array(4);o.readPixels(B9[0],B9[1],1,1,o.RGBA,o.UNSIGNED_BYTE,p);const[m,v,y]=p,T=o.getExtension("WEBGL_lose_context");return T&&T.loseContext(),m===v&&v===y&&m!==0}catch{return!1}}function oW(){const t=new Int16Array([32767,2e3,3e3,4e3,5e3,16784,7e3,8e3,9e3,32767]);return{norm16:G9({ext:"EXT_texture_norm16",filterType:"NEAREST",texData:t,internalFormat:(e,n)=>n.R16_SNORM_EXT,glDataType:e=>e.SHORT}),norm16Linear:G9({ext:"EXT_texture_norm16",filterType:"LINEAR",texData:t,internalFormat:(e,n)=>n.R16_SNORM_EXT,glDataType:e=>e.SHORT})}}let Gf=!1;const B3={gpuTier:{tier:2},isMobile:!1,rendering:{useCPURendering:!1,preferSizeOverAccuracy:!1,strictZSpacingForVolumeViewport:!0},peerImport:t=>null};let P0={...B3,rendering:{...B3.rendering}},ag=null,sD=!1;function sW(){const t=document.createElement("canvas");return t.getContext("webgl2")||t.getContext("webgl")||t.getContext("experimental-webgl")}function cW(){const t=sW();return t instanceof WebGLRenderingContext||t instanceof WebGL2RenderingContext}function lW(){const t=oW();return t.norm16&&t.norm16Linear}function cD(){return/iPad|iPhone|iPod/.test(navigator.platform)?!0:navigator.maxTouchPoints&&navigator.maxTouchPoints>2&&navigator.platform.includes("MacIntel")}function uW(t=P0){var n;return Gf||(sD=lW(),P0=Li(B3,t),cD()&&((n=t.rendering)!=null&&n.preferSizeOverAccuracy?P0.rendering.preferSizeOverAccuracy=!0:console.log("norm16 texture not supported, you can turn on the preferSizeOverAccuracy flag to use native data type, but be aware of the inaccuracy of the rendering in high bits")),cW()?console.log("CornerstoneRender: using GPU rendering"):(console.log("CornerstoneRender: GPU not detected, using CPU rendering"),P0.rendering.useCPURendering=!0),Gf=!0,ag||(ag=new oD),Gf)}function fW(){return sD}function fy(){return!cD()}function og(){return P0.rendering.useCPURendering}function gW(){return Gf}function gy(){return P0}function Ic(){return ag||(ag=new oD),ag}async function dW(t){return P0.peerImport(t)}function pW(t,e){e.classHierarchy.push("vtkStreamingOpenGLVolumeMapper"),t.buildBufferObjects=(n,r)=>{var p;const i=e.currentInput;if(!i)return;const a=r.getProperty();if(!e.jitterTexture.getHandle()){const m=new Uint8Array(1024);for(let v=0;v<32*32;++v)m[v]=255*Math.random();e.jitterTexture.setMinificationFilter(Ge.LINEAR),e.jitterTexture.setMagnificationFilter(Ge.LINEAR),e.jitterTexture.create2DFromRaw(32,32,1,ut.UNSIGNED_CHAR,m)}const{numberOfComponents:o}=i.get("numberOfComponents"),s=t.useIndependentComponents(a),c=a.getScalarOpacity(),l=e._openGLRenderWindow.getGraphicsResourceForObject(c);let f=Co(c,s,o);if(!(l!=null&&l.oglObject)||l.hash!==f){e.opacityTexture=Xt.newInstance(),e.opacityTexture.setOpenGLRenderWindow(e._openGLRenderWindow);const m=1024,v=m*2*o,y=new Float32Array(v),T=new Float32Array(m);for(let C=0;C<o;++C){const w=a.getScalarOpacity(C),x=t.getCurrentSampleDistance(n)/a.getScalarOpacityUnitDistance(C),O=w.getRange();w.getTable(O[0],O[1],m,T,1);for(let M=0;M<m;++M)y[C*m*2+M]=1-(1-T[M])**x,y[C*m*2+M+m]=y[C*m*2+M]}if(e.opacityTexture.resetFormatAndType(),e.opacityTexture.setMinificationFilter(Ge.LINEAR),e.opacityTexture.setMagnificationFilter(Ge.LINEAR),e._openGLRenderWindow.getWebgl2()&&e.context.getExtension("OES_texture_float")&&e.context.getExtension("OES_texture_float_linear"))e.opacityTexture.create2DFromRaw(m,2*o,1,ut.FLOAT,y);else{const C=new Uint8ClampedArray(v);for(let w=0;w<v;++w)C[w]=255*y[w];e.opacityTexture.create2DFromRaw(m,2*o,1,ut.UNSIGNED_CHAR,C)}c&&(e._openGLRenderWindow.setGraphicsResourceForObject(c,e.opacityTexture,f),c!==e._scalarOpacityFunc&&(e._openGLRenderWindow.registerGraphicsResourceUser(c,t),e._openGLRenderWindow.unregisterGraphicsResourceUser(e._scalarOpacityFunc,t)),e._scalarOpacityFunc=c)}else e.opacityTexture=l.oglObject;const g=a.getRGBTransferFunction();f=Co(g,s,o);const d=e._openGLRenderWindow.getGraphicsResourceForObject(g);if(!((p=d==null?void 0:d.oglObject)!=null&&p.getHandle())||(d==null?void 0:d.hash)!==f){e.colorTexture=Xt.newInstance(),e.colorTexture.setOpenGLRenderWindow(e._openGLRenderWindow);const m=1024,v=m*2*o*3,y=new Uint8ClampedArray(v),T=new Float32Array(m*3);for(let C=0;C<o;++C){const w=a.getRGBTransferFunction(C),x=w.getRange();w.getTable(x[0],x[1],m,T,1);for(let O=0;O<m*3;++O)y[C*m*6+O]=255*T[O],y[C*m*6+O+m*3]=255*T[O]}e.colorTexture.resetFormatAndType(),e.colorTexture.setMinificationFilter(Ge.LINEAR),e.colorTexture.setMagnificationFilter(Ge.LINEAR),e.colorTexture.create2DFromRaw(m,2*o,3,ut.UNSIGNED_CHAR,y),g&&(e._openGLRenderWindow.setGraphicsResourceForObject(g,e.colorTexture,f),g!==e._colorTransferFunc&&(e._openGLRenderWindow.registerGraphicsResourceUser(g,t),e._openGLRenderWindow.unregisterGraphicsResourceUser(e._colorTransferFunc,t)),e._colorTransferFunc=g)}else e.colorTexture=d.oglObject;if(t.updateLabelOutlineThicknessTexture(r),f=`${i.getMTime()}-${e.scalarTexture.getMTime()}`,e.scalarTextureString!==f){const m=i.getDimensions();e.scalarTexture.setOpenGLRenderWindow(e._openGLRenderWindow),e.scalarTexture.enableUseHalfFloat(!1);const v=e.scalarTexture.getTextureParameters(),y=i.get("dataType").dataType;let T=!0;if((v==null?void 0:v.dataType)===y&&(v==null?void 0:v.width)===m[0]&&(v==null?void 0:v.height)===m[1]&&(v==null?void 0:v.depth)===m[2]&&(T=!1),T){const C=e.context.getExtension("EXT_texture_norm16");e.scalarTexture.setOglNorm16Ext(fW()?C:null),e.scalarTexture.resetFormatAndType(),e.scalarTexture.setTextureParameters({width:m[0],height:m[1],depth:m[2],numberOfComponents:o,dataType:y}),e.scalarTexture.create3DFromRaw(m[0],m[1],m[2],o,y,null),e.scalarTexture.update3DFromRaw()}else e.scalarTexture.deactivate(),e.scalarTexture.update3DFromRaw();e.scalarTextureString=f}if(!e.tris.getCABO().getElementCount()){const m=new Float32Array(12);for(let C=0;C<4;C++)m[C*3]=C%2*2-1,m[C*3+1]=C>1?1:-1,m[C*3+2]=-1;const v=new Uint16Array(8);v[0]=3,v[1]=0,v[2]=1,v[3]=3,v[4]=3,v[5]=0,v[6]=3,v[7]=2;const y=nt.newInstance({numberOfComponents:3,values:m});y.setName("points");const T=nt.newInstance({numberOfComponents:1,values:v});e.tris.getCABO().createVBO(T,"polys",_r.SURFACE,{points:y,cellOffset:0})}e.VBOBuildTime.modified()},t.getNeedToRebuildBufferObjects=(n,r)=>{var i,a,o,s,c,l;return e.VBOBuildTime.getMTime()<t.getMTime()||e.VBOBuildTime.getMTime()<r.getMTime()||e.VBOBuildTime.getMTime()<e.renderable.getMTime()||e.VBOBuildTime.getMTime()<r.getProperty().getMTime()||e.VBOBuildTime.getMTime()<e.currentInput.getMTime()||e.VBOBuildTime.getMTime()<((i=e.scalarTexture)==null?void 0:i.getMTime())||e.VBOBuildTime.getMTime()<((a=e.colorTexture)==null?void 0:a.getMTime())||e.VBOBuildTime.getMTime()<((o=e.labelOutlineThicknessTexture)==null?void 0:o.getMTime())||!((s=e.scalarTexture)!=null&&s.getHandle())||!((c=e.colorTexture)!=null&&c.getHandle())||!((l=e.labelOutlineThicknessTexture)!=null&&l.getHandle())}}const hW={};function mW(t,e,n={}){Object.assign(e,hW,n),ZO.extend(t,e,n),e.scalarTexture=n.scalarTexture,e.previousState={},pW(t,e)}const vW=P.newInstance(mW,"vtkStreamingOpenGLVolumeMapper"),yW={newInstance:vW},lD=Object.create(null);function pr(t,e){lD[t]=e}function TW(t,e){e.classHierarchy.push("vtkStreamingOpenGLViewNodeFactory"),t.createNode=n=>{if(n.isDeleted())return null;let r=0,i=n.getClassName(r++),a=!1;const o=Object.keys(e.overrides);for(;i&&!a;)o.includes(i)?a=!0:i=n.getClassName(r++);if(!a)return null;const s=e.getModelInitialValues(n),c=e.overrides[i](s);return c.setMyFactory(t),c},e.overrides=lD,e.getModelInitialValues=n=>{const r={};return n.getClassName()==="vtkSharedVolumeMapper"&&(r.scalarTexture=n.getScalarTexture()),r}}const CW={};function uD(t,e,n={}){Object.assign(e,CW,n),I4.extend(t,e,n),TW(t,e),pr("vtkActor",vB.newInstance),pr("vtkActor2D",wB.newInstance),pr("vtkCamera",OB.newInstance),pr("vtkGlyph3DMapper",qG.newInstance),pr("vtkImageMapper",t$.newInstance),pr("vtkImageCPRMapper",o$.newInstance),pr("vtkImageSlice",u$.newInstance),pr("vtkMapper",x2.newInstance),pr("vtkPixelSpaceCallbackMapper",h$.newInstance),pr("vtkRenderer",C$.newInstance),pr("vtkSkybox",E$.newInstance),pr("vtkSphereMapper",b$.newInstance),pr("vtkStickMapper",N$.newInstance),pr("vtkTexture",Xt.newInstance),pr("vtkVolume",U$.newInstance),pr("vtkVolumeMapper",ZO.newInstance),pr("vtkSharedVolumeMapper",yW.newInstance)}const wW=P.newInstance(uD,"vtkStreamingOpenGLViewNodeFactory"),xW={newInstance:wW,extend:uD};function SW(t,e){e.classHierarchy.push("vtkStreamingOpenGLRenderWindow")}function fD(t,e,n={}){Object.assign(e,n),dB.extend(t,e,n),e.myFactory=xW.newInstance(),pr("vtkRenderWindow",gD),SW(t,e)}const gD=P.newInstance(fD,"vtkStreamingOpenGLRenderWindow"),EW={newInstance:gD,extend:fD},{vtkDebugMacro:a1}=P;function OW(t,e){e.classHierarchy.push("vtkCamera");const n=new Float64Array(3),r=new Float64Array([0,0,-1]),i=new Float64Array([0,1,0]),a=Be(new Float64Array(16)),o=Be(new Float64Array(16)),s=new Float64Array(3),c=new Float64Array(3),l=new Float64Array(3),f=Be(new Float64Array(16)),u=Be(new Float64Array(16)),g=new Float64Array(3),d=new Float64Array(3);function h(){e.viewPlaneNormal[0]=-e.directionOfProjection[0],e.viewPlaneNormal[1]=-e.directionOfProjection[1],e.viewPlaneNormal[2]=-e.directionOfProjection[2]}t.orthogonalizeViewUp=()=>{const p=t.getViewMatrix();e.viewUp[0]=p[4],e.viewUp[1]=p[5],e.viewUp[2]=p[6],t.modified()},t.setPosition=(p,m,v)=>{p===e.position[0]&&m===e.position[1]&&v===e.position[2]||(e.position[0]=p,e.position[1]=m,e.position[2]=v,t.computeDistance(),t.modified())},t.setFocalPoint=(p,m,v)=>{p===e.focalPoint[0]&&m===e.focalPoint[1]&&v===e.focalPoint[2]||(e.focalPoint[0]=p,e.focalPoint[1]=m,e.focalPoint[2]=v,t.computeDistance(),t.modified())},t.setDistance=p=>{if(e.distance===p)return;e.distance=p,e.distance<1e-20&&(e.distance=1e-20,a1("Distance is set to minimum."));const m=e.directionOfProjection;e.focalPoint[0]=e.position[0]+m[0]*e.distance,e.focalPoint[1]=e.position[1]+m[1]*e.distance,e.focalPoint[2]=e.position[2]+m[2]*e.distance,t.modified()},t.computeDistance=()=>{const p=e.focalPoint[0]-e.position[0],m=e.focalPoint[1]-e.position[1],v=e.focalPoint[2]-e.position[2];if(e.distance=Math.sqrt(p*p+m*m+v*v),e.distance<1e-20){e.distance=1e-20,a1("Distance is set to minimum.");const y=e.directionOfProjection;e.focalPoint[0]=e.position[0]+y[0]*e.distance,e.focalPoint[1]=e.position[1]+y[1]*e.distance,e.focalPoint[2]=e.position[2]+y[2]*e.distance}e.directionOfProjection[0]=p/e.distance,e.directionOfProjection[1]=m/e.distance,e.directionOfProjection[2]=v/e.distance,h()},t.dolly=p=>{if(p<=0)return;const m=e.distance/p;t.setPosition(e.focalPoint[0]-m*e.directionOfProjection[0],e.focalPoint[1]-m*e.directionOfProjection[1],e.focalPoint[2]-m*e.directionOfProjection[2])},t.roll=p=>{const m=e.position,v=e.focalPoint,y=e.viewUp,T=new Float64Array([y[0],y[1],y[2],0]);Be(f);const C=new Float64Array([v[0]-m[0],v[1]-m[1],v[2]-m[2]]);Ma(f,f,hn(p),C),V0(T,T,f),e.viewUp[0]=T[0],e.viewUp[1]=T[1],e.viewUp[2]=T[2],t.modified()},t.azimuth=p=>{const m=e.focalPoint;Be(u),en(u,u,m),Ma(u,u,hn(p),e.viewUp),en(u,u,[-m[0],-m[1],-m[2]]),pt(g,e.position,u),t.setPosition(g[0],g[1],g[2])},t.yaw=p=>{const m=e.position;Be(u),en(u,u,m),Ma(u,u,hn(p),e.viewUp),en(u,u,[-m[0],-m[1],-m[2]]),pt(d,e.focalPoint,u),t.setFocalPoint(d[0],d[1],d[2])},t.elevation=p=>{const m=e.focalPoint,v=t.getViewMatrix(),y=[-v[0],-v[1],-v[2]];Be(u),en(u,u,m),Ma(u,u,hn(p),y),en(u,u,[-m[0],-m[1],-m[2]]),pt(g,e.position,u),t.setPosition(g[0],g[1],g[2])},t.pitch=p=>{const m=e.position,v=t.getViewMatrix(),y=[v[0],v[1],v[2]];Be(u),en(u,u,m),Ma(u,u,hn(p),y),en(u,u,[-m[0],-m[1],-m[2]]),pt(d,e.focalPoint,u),t.setFocalPoint(...d)},t.zoom=p=>{p<=0||(e.parallelProjection?e.parallelScale/=p:e.viewAngle/=p,t.modified())},t.translate=(p,m,v)=>{const y=[p,m,v];th(e.position,y,e.position),th(e.focalPoint,y,e.focalPoint),t.computeDistance(),t.modified()},t.applyTransform=p=>{const m=[...e.viewUp,1],v=[],y=[],T=[];m[0]+=e.position[0],m[1]+=e.position[1],m[2]+=e.position[2],V0(v,[...e.position,1],p),V0(y,[...e.focalPoint,1],p),V0(T,m,p),T[0]-=v[0],T[1]-=v[1],T[2]-=v[2],t.setPosition(...v.slice(0,3)),t.setFocalPoint(...y.slice(0,3)),t.setViewUp(...T.slice(0,3))},t.getThickness=()=>e.clippingRange[1]-e.clippingRange[0],t.setThickness=p=>{let m=p;m<1e-20&&(m=1e-20,a1("Thickness is set to minimum.")),t.setClippingRange(e.clippingRange[0],e.clippingRange[0]+m)},t.setThicknessFromFocalPoint=p=>{let m=p;m<1e-20&&(m=1e-20,a1("Thickness is set to minimum.")),t.setClippingRange(e.distance-m/2,e.distance+m/2)},t.setRoll=p=>{},t.getRoll=()=>{},t.setObliqueAngles=(p,m)=>{},t.getOrientation=()=>{},t.getOrientationWXYZ=()=>{},t.getFrustumPlanes=p=>{},t.getCameraLightTransformMatrix=p=>(nn(p,e.cameraLightTransform),p),t.computeCameraLightTransform=()=>{nn(a,t.getViewMatrix()),Ln(a,a),U4(o,[e.distance,e.distance,e.distance]),vt(a,a,o),Be(e.cameraLightTransform),en(e.cameraLightTransform,a,[0,0,-1])},t.deepCopy=p=>{},t.physicalOrientationToWorldDirection=p=>{const m=g9(p[0],p[1],p[2],p[3]),v=Q0(),y=g9(0,0,1,0);return pF(v,m),f9(y,m,y),f9(y,y,v),[y[0],y[1],y[2]]},t.getPhysicalToWorldMatrix=p=>{t.getWorldToPhysicalMatrix(p),Ln(p,p)},t.getWorldToPhysicalMatrix=p=>{Be(p);const m=[3];yo(e.physicalViewNorth,e.physicalViewUp,m),p[0]=m[0],p[1]=m[1],p[2]=m[2],p[4]=e.physicalViewUp[0],p[5]=e.physicalViewUp[1],p[6]=e.physicalViewUp[2],p[8]=-e.physicalViewNorth[0],p[9]=-e.physicalViewNorth[1],p[10]=-e.physicalViewNorth[2],ft(p,p),bt(s,1/e.physicalScale,1/e.physicalScale,1/e.physicalScale),ms(p,p,s),en(p,p,e.physicalTranslation)},t.computeViewParametersFromViewMatrix=p=>{Ln(a,p),pt(s,n,a),t.computeDistance();const m=e.distance;t.setPosition(s[0],s[1],s[2]),pt(c,r,a),tn(c,c,s),wn(c,c),t.setDirectionOfProjection(c[0],c[1],c[2]),pt(l,i,a),tn(l,l,s),wn(l,l),t.setViewUp(l[0],l[1],l[2]),t.setDistance(m)},t.computeViewParametersFromPhysicalMatrix=p=>{t.getWorldToPhysicalMatrix(a),vt(a,p,a),t.computeViewParametersFromViewMatrix(a)},t.setViewMatrix=p=>{e.viewMatrix=p,e.viewMatrix&&(nn(a,e.viewMatrix),t.computeViewParametersFromViewMatrix(a),ft(e.viewMatrix,e.viewMatrix))},t.getViewMatrix=()=>{if(e.viewMatrix)return e.viewMatrix;dE(a,e.position,e.focalPoint,e.viewUp),ft(a,a);const p=new Float64Array(16);return nn(p,a),p},t.setProjectionMatrix=p=>{e.projectionMatrix=p},t.getProjectionMatrix=(p,m,v)=>{const y=new Float64Array(16);if(Be(y),e.projectionMatrix){const w=1/e.physicalScale;return bt(s,w,w,w),nn(y,e.projectionMatrix),ms(y,y,s),ft(y,y),y}Be(a);const T=e.clippingRange[1]-e.clippingRange[0],C=[e.clippingRange[0]+(m+1)*T/2,e.clippingRange[0]+(v+1)*T/2];if(e.parallelProjection){const w=e.parallelScale*p,x=e.parallelScale,O=(e.windowCenter[0]-1)*w,M=(e.windowCenter[0]+1)*w,A=(e.windowCenter[1]-1)*x,_=(e.windowCenter[1]+1)*x;G4(a,O,M,A,_,C[0],C[1]),ft(a,a)}else{if(e.useOffAxisProjection)throw new Error("Off-Axis projection is not supported at this time");{const w=Math.tan(hn(e.viewAngle)/2);let x,O;e.useHorizontalViewAngle===!0?(x=e.clippingRange[0]*w,O=e.clippingRange[0]*w/p):(x=e.clippingRange[0]*w*p,O=e.clippingRange[0]*w);const M=(e.windowCenter[0]-1)*x,A=(e.windowCenter[0]+1)*x,_=(e.windowCenter[1]-1)*O,k=(e.windowCenter[1]+1)*O,z=C[0],X=C[1];a[0]=2*z/(A-M),a[5]=2*z/(k-_),a[2]=(M+A)/(A-M),a[6]=(_+k)/(k-_),a[10]=-(z+X)/(X-z),a[14]=-1,a[11]=-2*z*X/(X-z),a[15]=0}}return nn(y,a),y},t.getCompositeProjectionMatrix=(p,m,v)=>{const y=t.getViewMatrix(),T=t.getProjectionMatrix(p,m,v);return vt(T,y,T),T},t.setDirectionOfProjection=(p,m,v)=>{if(e.directionOfProjection[0]===p&&e.directionOfProjection[1]===m&&e.directionOfProjection[2]===v)return;e.directionOfProjection[0]=p,e.directionOfProjection[1]=m,e.directionOfProjection[2]=v;const y=e.directionOfProjection;e.focalPoint[0]=e.position[0]+y[0]*e.distance,e.focalPoint[1]=e.position[1]+y[1]*e.distance,e.focalPoint[2]=e.position[2]+y[2]*e.distance,h()},t.setDeviceAngles=(p,m,v,y)=>{const T=[3];yo(e.physicalViewNorth,e.physicalViewUp,T);const C=Be(new Float64Array(16));Ma(C,C,hn(p),e.physicalViewUp),Ma(C,C,hn(m),T),Ma(C,C,hn(v),e.physicalViewNorth),Ma(C,C,hn(-y),e.physicalViewUp);const w=new Float64Array([-e.physicalViewUp[0],-e.physicalViewUp[1],-e.physicalViewUp[2]]),x=new Float64Array(e.physicalViewNorth);pt(w,w,C),pt(x,x,C),t.setDirectionOfProjection(w[0],w[1],w[2]),t.setViewUp(x[0],x[1],x[2]),t.modified()},t.setOrientationWXYZ=(p,m,v,y)=>{const T=Be(new Float64Array(16));if(p!==0&&(m!==0||v!==0||y!==0)){const x=hn(p),O=Q0();$4(O,[m,v,y],x),ih(T,O)}const C=new Float64Array(3);pt(C,[0,0,-1],T);const w=new Float64Array(3);pt(w,[0,1,0],T),t.setDirectionOfProjection(...C),t.setViewUp(...w),t.modified()},t.computeClippingRange=p=>{let m=null,v=null;m=e.viewPlaneNormal,v=e.position;const y=-m[0],T=-m[1],C=-m[2],w=-(y*v[0]+T*v[1]+C*v[2]),x=[y*p[0]+T*p[2]+C*p[4]+w,1e-18];for(let O=0;O<2;O++)for(let M=0;M<2;M++)for(let A=0;A<2;A++){const _=y*p[A]+T*p[2+M]+C*p[4+O]+w;x[0]=_<x[0]?_:x[0],x[1]=_>x[1]?_:x[1]}return x}}const DW={position:[0,0,1],focalPoint:[0,0,0],viewUp:[0,1,0],directionOfProjection:[0,0,-1],parallelProjection:!1,useHorizontalViewAngle:!1,viewAngle:30,parallelScale:1,clippingRange:[.01,1000.01],windowCenter:[0,0],viewPlaneNormal:[0,0,1],useOffAxisProjection:!1,screenBottomLeft:[-.5,-.5,-.5],screenBottomRight:[.5,-.5,-.5],screenTopRight:[.5,.5,-.5],freezeFocalPoint:!1,projectionMatrix:null,viewMatrix:null,cameraLightTransform:Lc(),physicalTranslation:[0,0,0],physicalScale:1,physicalViewUp:[0,1,0],physicalViewNorth:[0,0,-1]};function dD(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,DW,n),P.obj(t,e),P.get(t,e,["distance"]),P.setGet(t,e,["parallelProjection","useHorizontalViewAngle","viewAngle","parallelScale","useOffAxisProjection","freezeFocalPoint","physicalScale"]),P.getArray(t,e,["directionOfProjection","viewPlaneNormal","position","focalPoint"]),P.setGetArray(t,e,["clippingRange","windowCenter"],2),P.setGetArray(t,e,["viewUp","screenBottomLeft","screenBottomRight","screenTopRight","physicalTranslation","physicalViewUp","physicalViewNorth"],3),OW(t,e)}const RW=P.newInstance(dD,"vtkCamera");var dy={newInstance:RW,extend:dD};function MW(t,e){e.classHierarchy.push("vtkLight");const n=new Float64Array(3);t.getTransformedPosition=()=>(e.transformMatrix?pt(n,e.position,e.transformMatrix):bt(n,e.position[0],e.position[1],e.position[2]),n),t.getTransformedFocalPoint=()=>(e.transformMatrix?pt(n,e.focalPoint,e.transformMatrix):bt(n,e.focalPoint[0],e.focalPoint[1],e.focalPoint[2]),n),t.getDirection=()=>(e.directionMTime<e.mtime&&(_n(e.direction,e.focalPoint,e.position),Z0(e.direction),e.directionMTime=e.mtime),e.direction),t.setDirection=r=>{const i=new Float64Array(3);_n(i,e.position,r),e.focalPoint=i},t.setDirectionAngle=(r,i)=>{const a=hn(r),o=hn(i);t.setPosition(Math.cos(a)*Math.sin(o),Math.sin(a),Math.cos(a)*Math.cos(o)),t.setFocalPoint(0,0,0),t.setPositional(0)},t.setLightTypeToHeadLight=()=>{t.setLightType("HeadLight")},t.setLightTypeToCameraLight=()=>{t.setLightType("CameraLight")},t.setLightTypeToSceneLight=()=>{t.setTransformMatrix(null),t.setLightType("SceneLight")},t.lightTypeIsHeadLight=()=>e.lightType==="HeadLight",t.lightTypeIsSceneLight=()=>e.lightType==="SceneLight",t.lightTypeIsCameraLight=()=>e.lightType==="CameraLight"}const _W={switch:!0,intensity:1,color:[1,1,1],position:[0,0,1],focalPoint:[0,0,0],positional:!1,exponent:1,coneAngle:30,coneFalloff:5,attenuationValues:[1,0,0],transformMatrix:null,lightType:"SceneLight",shadowAttenuation:1,direction:[0,0,0],directionMTime:0};function bW(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,_W,n),P.obj(t,e),P.setGet(t,e,["intensity","switch","positional","exponent","coneAngle","coneFalloff","transformMatrix","lightType","shadowAttenuation","attenuationValues"]),P.setGetArray(t,e,["color","position","focalPoint","attenuationValues"],3),MW(t,e)}const LW=P.newInstance(bW,"vtkLight");var IW={newInstance:LW};const{vtkErrorMacro:cp}=P;function VW(t){return()=>cp(`vtkViewport::${t} - NOT IMPLEMENTED`)}function PW(t,e){e.classHierarchy.push("vtkViewport"),t.getViewProps=()=>e.props,t.hasViewProp=r=>e.props.includes(r),t.addViewProp=r=>{r&&!t.hasViewProp(r)&&e.props.push(r)},t.removeViewProp=r=>{const i=e.props.filter(a=>a!==r);e.props.length!==i.length&&(e.props=i)},t.removeAllViewProps=()=>{e.props=[]};function n(r){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];i.push(r);const a=r.getNestedProps();if(a&&a.length)for(let o=0;o<a.length;o++)n(a[o],i);return i}t.getViewPropsWithNestedProps=()=>{const r=[];for(let i=0;i<e.props.length;i++)n(e.props[i],r);return r},t.addActor2D=t.addViewProp,t.removeActor2D=r=>{t.removeViewProp(r)},t.getActors2D=()=>(e.actors2D=[],e.props.forEach(r=>{e.actors2D=e.actors2D.concat(r.getActors2D())}),e.actors2D),t.displayToView=()=>cp("call displayToView on your view instead"),t.viewToDisplay=()=>cp("callviewtodisplay on your view instead"),t.getSize=()=>cp("call getSize on your View instead"),t.normalizedDisplayToProjection=(r,i,a)=>{const o=t.normalizedDisplayToNormalizedViewport(r,i,a);return t.normalizedViewportToProjection(o[0],o[1],o[2])},t.normalizedDisplayToNormalizedViewport=(r,i,a)=>{const o=[e.viewport[2]-e.viewport[0],e.viewport[3]-e.viewport[1]];return[(r-e.viewport[0])/o[0],(i-e.viewport[1])/o[1],a]},t.normalizedViewportToProjection=(r,i,a)=>[r*2-1,i*2-1,a*2-1],t.projectionToNormalizedDisplay=(r,i,a)=>{const o=t.projectionToNormalizedViewport(r,i,a);return t.normalizedViewportToNormalizedDisplay(o[0],o[1],o[2])},t.normalizedViewportToNormalizedDisplay=(r,i,a)=>{const o=[e.viewport[2]-e.viewport[0],e.viewport[3]-e.viewport[1]];return[r*o[0]+e.viewport[0],i*o[1]+e.viewport[1],a]},t.projectionToNormalizedViewport=(r,i,a)=>[(r+1)*.5,(i+1)*.5,(a+1)*.5],t.PickPropFrom=VW("PickPropFrom")}const NW={background:[0,0,0],background2:[.2,.2,.2],gradientBackground:!1,viewport:[0,0,1,1],aspect:[1,1],pixelAspect:[1,1],props:[],actors2D:[]};function pD(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,NW,n),P.obj(t,e),P.event(t,e,"event"),P.setGetArray(t,e,["viewport"],4),P.setGetArray(t,e,["background","background2"],3),PW(t,e)}const kW=P.newInstance(pD,"vtkViewport");var AW={newInstance:kW,extend:pD};const{vtkDebugMacro:Cf,vtkErrorMacro:Ks,vtkWarningMacro:FW}=Ir;function $9(t){return()=>Ks(`vtkRenderer::${t} - NOT IMPLEMENTED`)}function UW(t,e){e.classHierarchy.push("vtkRenderer");const n={type:"ComputeVisiblePropBoundsEvent",renderer:t},r={type:"ResetCameraClippingRangeEvent",renderer:t},i={type:"ResetCameraEvent",renderer:t};t.updateCamera=()=>(e.activeCamera||(Cf("No cameras are on, creating one."),t.getActiveCameraAndResetIfCreated()),e.activeCamera.render(t),!0),t.updateLightsGeometryToFollowCamera=()=>{const a=t.getActiveCameraAndResetIfCreated();e.lights.forEach(o=>{o.lightTypeIsSceneLight()||(o.lightTypeIsHeadLight()?(o.setPositionFrom(a.getPositionByReference()),o.setFocalPointFrom(a.getFocalPointByReference()),o.modified(a.getMTime())):o.lightTypeIsCameraLight()?o.setTransformMatrix(a.getCameraLightTransformMatrix(Lc())):Ks("light has unknown light type",o.get()))})},t.updateLightGeometry=()=>e.lightFollowCamera?t.updateLightsGeometryToFollowCamera():!0,t.allocateTime=$9("allocateTime"),t.updateGeometry=$9("updateGeometry"),t.getVTKWindow=()=>e._renderWindow,t.setLayer=a=>{Cf(t.getClassName(),t,"setting Layer to ",a),e.layer!==a&&(e.layer=a,t.modified()),t.setPreserveColorBuffer(!!a)},t.setActiveCamera=a=>e.activeCamera===a?!1:(e.activeCamera=a,t.modified(),t.invokeEvent({type:"ActiveCameraEvent",camera:a}),!0),t.makeCamera=()=>{const a=dy.newInstance();return t.invokeEvent({type:"CreateCameraEvent",camera:a}),a},t.getActiveCamera=()=>(e.activeCamera||(e.activeCamera=t.makeCamera()),e.activeCamera),t.getActiveCameraAndResetIfCreated=()=>(e.activeCamera||(t.getActiveCamera(),t.resetCamera()),e.activeCamera),t.getActors=()=>(e.actors=[],e.props.forEach(a=>{e.actors=e.actors.concat(a.getActors())}),e.actors),t.addActor=t.addViewProp,t.removeActor=a=>{e.actors=e.actors.filter(o=>o!==a),t.removeViewProp(a),t.modified()},t.removeAllActors=()=>{t.getActors().forEach(o=>{t.removeViewProp(o)}),e.actors=[],t.modified()},t.getVolumes=()=>(e.volumes=[],e.props.forEach(a=>{e.volumes=e.volumes.concat(a.getVolumes())}),e.volumes),t.addVolume=t.addViewProp,t.removeVolume=a=>{e.volumes=e.volumes.filter(o=>o!==a),t.removeViewProp(a),t.modified()},t.removeAllVolumes=()=>{t.getVolumes().forEach(o=>{t.removeViewProp(o)}),e.volumes=[],t.modified()},t.hasLight=a=>e.lights.includes(a),t.addLight=a=>{a&&!t.hasLight(a)&&(e.lights.push(a),t.modified())},t.removeLight=a=>{e.lights=e.lights.filter(o=>o!==a),t.modified()},t.removeAllLights=()=>{e.lights=[],t.modified()},t.setLightCollection=a=>{e.lights=a,t.modified()},t.makeLight=IW.newInstance,t.createLight=()=>{e.automaticLightCreation&&(e._createdLight&&(t.removeLight(e._createdLight),e._createdLight.delete(),e._createdLight=null),e._createdLight=t.makeLight(),t.addLight(e._createdLight),e._createdLight.setLightTypeToHeadLight(),e._createdLight.setPosition(t.getActiveCamera().getPosition()),e._createdLight.setFocalPoint(t.getActiveCamera().getFocalPoint()))},t.normalizedDisplayToWorld=(a,o,s,c)=>{let l=t.normalizedDisplayToProjection(a,o,s);return l=t.projectionToView(l[0],l[1],l[2],c),t.viewToWorld(l[0],l[1],l[2])},t.worldToNormalizedDisplay=(a,o,s,c)=>{let l=t.worldToView(a,o,s);return l=t.viewToProjection(l[0],l[1],l[2],c),t.projectionToNormalizedDisplay(l[0],l[1],l[2])},t.viewToWorld=(a,o,s)=>{if(e.activeCamera===null)return Ks("ViewToWorld: no active camera, cannot compute view to world, returning 0,0,0"),[0,0,0];const c=e.activeCamera.getViewMatrix();Ln(c,c),ft(c,c);const l=new Float64Array([a,o,s]);return pt(l,l,c),l},t.projectionToView=(a,o,s,c)=>{if(e.activeCamera===null)return Ks("ProjectionToView: no active camera, cannot compute projection to view, returning 0,0,0"),[0,0,0];const l=e.activeCamera.getProjectionMatrix(c,-1,1);Ln(l,l),ft(l,l);const f=new Float64Array([a,o,s]);return pt(f,f,l),f},t.worldToView=(a,o,s)=>{if(e.activeCamera===null)return Ks("WorldToView: no active camera, cannot compute view to world, returning 0,0,0"),[0,0,0];const c=e.activeCamera.getViewMatrix();ft(c,c);const l=new Float64Array([a,o,s]);return pt(l,l,c),l},t.viewToProjection=(a,o,s,c)=>{if(e.activeCamera===null)return Ks("ViewToProjection: no active camera, cannot compute view to projection, returning 0,0,0"),[0,0,0];const l=e.activeCamera.getProjectionMatrix(c,-1,1);ft(l,l);const f=new Float64Array([a,o,s]);return pt(f,f,l),f},t.computeVisiblePropBounds=()=>{e.allBounds[0]=Nt.INIT_BOUNDS[0],e.allBounds[1]=Nt.INIT_BOUNDS[1],e.allBounds[2]=Nt.INIT_BOUNDS[2],e.allBounds[3]=Nt.INIT_BOUNDS[3],e.allBounds[4]=Nt.INIT_BOUNDS[4],e.allBounds[5]=Nt.INIT_BOUNDS[5];let a=!0;t.invokeEvent(n);for(let o=0;o<e.props.length;++o){const s=e.props[o];if(s.getVisibility()&&s.getUseBounds()){const c=s.getBounds();c&&np(c)&&(a=!1,c[0]<e.allBounds[0]&&(e.allBounds[0]=c[0]),c[1]>e.allBounds[1]&&(e.allBounds[1]=c[1]),c[2]<e.allBounds[2]&&(e.allBounds[2]=c[2]),c[3]>e.allBounds[3]&&(e.allBounds[3]=c[3]),c[4]<e.allBounds[4]&&(e.allBounds[4]=c[4]),c[5]>e.allBounds[5]&&(e.allBounds[5]=c[5]))}}return a&&(Xu(e.allBounds),Cf("Can't compute bounds, no 3D props are visible")),e.allBounds},t.resetCamera=function(){const o=(arguments.length>0&&arguments[0]!==void 0?arguments[0]:null)||t.computeVisiblePropBounds(),s=[0,0,0];if(!np(o))return Cf("Cannot reset camera!"),!1;let c=null;if(t.getActiveCamera())c=e.activeCamera.getViewPlaneNormal();else return Ks("Trying to reset non-existent camera"),!1;e.activeCamera.setViewAngle(30),s[0]=(o[0]+o[1])/2,s[1]=(o[2]+o[3])/2,s[2]=(o[4]+o[5])/2;let l=o[1]-o[0],f=o[3]-o[2],u=o[5]-o[4];l*=l,f*=f,u*=u;let g=l+f+u;g=g===0?1:g,g=Math.sqrt(g)*.5;const d=hn(e.activeCamera.getViewAngle()),h=g,p=g/Math.sin(d*.5),m=e.activeCamera.getViewUp();return Math.abs(ct(m,c))>.999&&(FW("Resetting view-up since view plane normal is parallel"),e.activeCamera.setViewUp(-m[2],m[0],m[1])),e.activeCamera.setFocalPoint(s[0],s[1],s[2]),e.activeCamera.setPosition(s[0]+p*c[0],s[1]+p*c[1],s[2]+p*c[2]),t.resetCameraClippingRange(o),e.activeCamera.setParallelScale(h),e.activeCamera.setPhysicalScale(g),e.activeCamera.setPhysicalTranslation(-s[0],-s[1],-s[2]),t.invokeEvent(i),!0},t.resetCameraClippingRange=function(){const o=(arguments.length>0&&arguments[0]!==void 0?arguments[0]:null)||t.computeVisiblePropBounds();if(!np(o))return Cf("Cannot reset camera clipping range!"),!1;if(t.getActiveCameraAndResetIfCreated(),!e.activeCamera)return Ks("Trying to reset clipping range of non-existent camera"),!1;const s=e.activeCamera.computeClippingRange(o);let c=0;if(e.activeCamera.getParallelProjection())c=.2*e.activeCamera.getParallelScale();else{const l=hn(e.activeCamera.getViewAngle());c=.2*Math.tan(l/2)*s[1]}return s[1]-s[0]<c&&(c=c-s[1]+s[0],s[1]+=c/2,s[0]-=c/2),s[0]<0&&(s[0]=0),s[0]=.99*s[0]-(s[1]-s[0])*e.clippingRangeExpansion,s[1]=1.01*s[1]+(s[1]-s[0])*e.clippingRangeExpansion,s[0]=s[0]>=s[1]?.01*s[1]:s[0],e.nearClippingPlaneTolerance||(e.nearClippingPlaneTolerance=.01),s[0]<e.nearClippingPlaneTolerance*s[1]&&(s[0]=e.nearClippingPlaneTolerance*s[1]),e.activeCamera.setClippingRange(s[0],s[1]),t.invokeEvent(r),!1},t.setRenderWindow=a=>{a!==e._renderWindow&&(e._vtkWindow=a,e._renderWindow=a)},t.visibleActorCount=()=>e.props.filter(a=>a.getVisibility()).length,t.visibleVolumeCount=t.visibleActorCount,t.getMTime=()=>{let a=e.mtime;const o=e.activeCamera?e.activeCamera.getMTime():0;o>a&&(a=o);const s=e._createdLight?e._createdLight.getMTime():0;return s>a&&(a=s),a},t.getTransparent=()=>!!e.preserveColorBuffer,t.isActiveCameraCreated=()=>!!e.activeCamera}const BW={pickedProp:null,activeCamera:null,allBounds:[],ambient:[1,1,1],allocatedRenderTime:100,timeFactor:1,automaticLightCreation:!0,twoSidedLighting:!0,lastRenderTimeInSeconds:-1,renderWindow:null,lights:[],actors:[],volumes:[],lightFollowCamera:!0,numberOfPropsRendered:0,propArray:null,pathArray:null,layer:0,preserveColorBuffer:!1,preserveDepthBuffer:!1,computeVisiblePropBounds:Oc(),interactive:!0,nearClippingPlaneTolerance:0,clippingRangeExpansion:.05,erase:!0,draw:!0,useShadows:!1,useDepthPeeling:!1,occlusionRatio:0,maximumNumberOfPeels:4,selector:null,delegate:null,texturedBackground:!1,backgroundTexture:null,environmentTexture:null,environmentTextureDiffuseStrength:1,environmentTextureSpecularStrength:1,useEnvironmentTextureAsBackground:!1,pass:0};function hD(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};for(Object.assign(e,BW,n),AW.extend(t,e,n),e.background||(e.background=[0,0,0,1]);e.background.length<3;)e.background.push(0);e.background.length===3&&e.background.push(1),hi(t,e,["_renderWindow","allocatedRenderTime","timeFactor","lastRenderTimeInSeconds","numberOfPropsRendered","lastRenderingUsedDepthPeeling","selector"]),Vn(t,e,["twoSidedLighting","lightFollowCamera","automaticLightCreation","erase","draw","nearClippingPlaneTolerance","clippingRangeExpansion","backingStore","interactive","layer","preserveColorBuffer","preserveDepthBuffer","useDepthPeeling","occlusionRatio","maximumNumberOfPeels","delegate","backgroundTexture","texturedBackground","environmentTexture","environmentTextureDiffuseStrength","environmentTextureSpecularStrength","useEnvironmentTextureAsBackground","useShadows","pass"]),qu(t,e,["actors","volumes","lights"]),p4(t,e,["background"],4,1),fd(t,e,["renderWindow"]),UW(t,e)}const GW=Rt(hD,"vtkRenderer");var $W={newInstance:GW,extend:hD};const WW={Unknown:0,LeftController:1,RightController:2},zW={Unknown:0,Trigger:1,TrackPad:2,Grip:3,Thumbstick:4,A:5,B:6,ApplicationMenu:7},jW={Unknown:0,TouchpadX:1,TouchpadY:2,ThumbstickX:3,ThumbstickY:4};var mD={Device:WW,Input:zW,Axis:jW};const{Device:o1,Input:w0}=mD,{vtkWarningMacro:s1,vtkErrorMacro:c1,normalizeWheel:HW,vtkOnceErrorMacro:KW}=P,xl={ctrlKey:!1,altKey:!1,shiftKey:!1},N5={"xr-standard":[w0.Trigger,w0.Grip,w0.TrackPad,w0.Thumbstick,w0.A,w0.B]},py=["StartAnimation","Animation","EndAnimation","PointerEnter","PointerLeave","MouseEnter","MouseLeave","StartMouseMove","MouseMove","EndMouseMove","LeftButtonPress","LeftButtonRelease","MiddleButtonPress","MiddleButtonRelease","RightButtonPress","RightButtonRelease","KeyPress","KeyDown","KeyUp","StartMouseWheel","MouseWheel","EndMouseWheel","StartPinch","Pinch","EndPinch","StartPan","Pan","EndPan","StartRotate","Rotate","EndRotate","Button3D","Move3D","StartPointerLock","EndPointerLock","StartInteraction","Interaction","EndInteraction","AnimationFrameRateUpdate"];function wf(t){t.cancelable&&t.preventDefault()}function l1(t){const e=Object.create(null);return t.forEach(n=>{let{pointerId:r,position:i}=n;e[r]=i}),e}function qW(t,e){e.classHierarchy.push("vtkRenderWindowInteractor");const n={...t},r=new Set,i=new Map;let a=1;t.start=()=>{!e.initialized&&(t.initialize(),!e.initialized)||t.startEventLoop()},t.setRenderWindow=p=>{c1("you want to call setView(view) instead of setRenderWindow on a vtk.js interactor")},t.setInteractorStyle=p=>{e.interactorStyle!==p&&(e.interactorStyle!=null&&e.interactorStyle.setInteractor(null),e.interactorStyle=p,e.interactorStyle!=null&&e.interactorStyle.getInteractor()!==t&&e.interactorStyle.setInteractor(t))},t.initialize=()=>{e.initialized=!0,t.enable(),t.render()},t.enable=()=>t.setEnabled(!0),t.disable=()=>t.setEnabled(!1),t.startEventLoop=()=>s1("empty event loop");function o(p,m){e._forcedRenderer||(e.currentRenderer=t.findPokedRenderer(p,m))}t.getCurrentRenderer=()=>(e.currentRenderer||o(0,0),e.currentRenderer);function s(p){const m=e._view.getCanvas(),v=m.getBoundingClientRect(),y=m.width/v.width,T=m.height/v.height,C={x:y*(p.clientX-v.left),y:T*(v.height-p.clientY+v.top),z:0};return(i.size<=1||!e.currentRenderer)&&o(C.x,C.y),C}const c=e._getScreenEventPositionFor||s;function l(p){return{controlKey:p.ctrlKey,altKey:p.altKey,shiftKey:p.shiftKey}}function f(p){const m=l(p);return{key:p.key,keyCode:p.charCode,...m}}function u(p){return p.pointerType||""}const g=()=>{if(e.container===null)return;const{container:p}=e;p.addEventListener("contextmenu",wf),p.addEventListener("wheel",t.handleWheel),p.addEventListener("DOMMouseScroll",t.handleWheel),p.addEventListener("pointerenter",t.handlePointerEnter),p.addEventListener("pointerleave",t.handlePointerLeave),p.addEventListener("pointermove",t.handlePointerMove,{passive:!1}),p.addEventListener("pointerdown",t.handlePointerDown,{passive:!1}),p.addEventListener("pointerup",t.handlePointerUp),p.addEventListener("pointercancel",t.handlePointerCancel),document.addEventListener("keypress",t.handleKeyPress),document.addEventListener("keydown",t.handleKeyDown),document.addEventListener("keyup",t.handleKeyUp),document.addEventListener("pointerlockchange",t.handlePointerLockChange),p.style.touchAction="none",p.style.userSelect="none",p.style.webkitTapHighlightColor="rgba(0,0,0,0)"};t.bindEvents=p=>{if(p===null)return;n.setContainer(p)&&g()};const d=()=>{clearTimeout(e.moveTimeoutID),clearTimeout(e.wheelTimeoutID),e.moveTimeoutID=0,e.wheelTimeoutID=0,a=1;const{container:p}=e;p&&(p.removeEventListener("contextmenu",wf),p.removeEventListener("wheel",t.handleWheel),p.removeEventListener("DOMMouseScroll",t.handleWheel),p.removeEventListener("pointerenter",t.handlePointerEnter),p.removeEventListener("pointerleave",t.handlePointerLeave),p.removeEventListener("pointermove",t.handlePointerMove,{passive:!1}),p.removeEventListener("pointerdown",t.handlePointerDown,{passive:!1}),p.removeEventListener("pointerup",t.handlePointerUp),p.removeEventListener("pointercancel",t.handlePointerCancel)),document.removeEventListener("keypress",t.handleKeyPress),document.removeEventListener("keydown",t.handleKeyDown),document.removeEventListener("keyup",t.handleKeyUp),document.removeEventListener("pointerlockchange",t.handlePointerLockChange),i.clear()};t.unbindEvents=()=>{d(),n.setContainer(null)},t.handleKeyPress=p=>{const m=f(p);t.keyPressEvent(m)},t.handleKeyDown=p=>{const m=f(p);t.keyDownEvent(m)},t.handleKeyUp=p=>{const m=f(p);t.keyUpEvent(m)},t.handlePointerEnter=p=>{const m={...l(p),position:c(p),deviceType:u(p)};t.pointerEnterEvent(m),m.deviceType==="mouse"&&t.mouseEnterEvent(m)},t.handlePointerLeave=p=>{const m={...l(p),position:c(p),deviceType:u(p)};t.pointerLeaveEvent(m),m.deviceType==="mouse"&&t.mouseLeaveEvent(m)},t.handlePointerDown=p=>{if(!(p.button>2||t.isPointerLocked()))switch(e.preventDefaultOnPointerDown&&wf(p),p.target.hasPointerCapture(p.pointerId)&&p.target.releasePointerCapture(p.pointerId),e.container.setPointerCapture(p.pointerId),i.has(p.pointerId)&&s1("[RenderWindowInteractor] duplicate pointerId detected"),i.set(p.pointerId,{pointerId:p.pointerId,position:c(p)}),p.pointerType){case"pen":case"touch":t.handleTouchStart(p);break;case"mouse":default:t.handleMouseDown(p);break}},t.handlePointerUp=p=>{if(i.has(p.pointerId))switch(e.preventDefaultOnPointerUp&&wf(p),i.delete(p.pointerId),e.container.releasePointerCapture(p.pointerId),p.pointerType){case"pen":case"touch":t.handleTouchEnd(p);break;case"mouse":default:t.handleMouseUp(p);break}},t.handlePointerCancel=p=>{if(i.has(p.pointerId))switch(i.delete(p.pointerId),p.pointerType){case"pen":case"touch":t.handleTouchEnd(p);break;case"mouse":default:t.handleMouseUp(p);break}},t.handlePointerMove=p=>{if(i.has(p.pointerId)){const m=i.get(p.pointerId);m.position=c(p)}switch(p.pointerType){case"pen":case"touch":t.handleTouchMove(p);break;case"mouse":default:t.handleMouseMove(p);break}},t.handleMouseDown=p=>{const m={...l(p),position:c(p),deviceType:u(p)};switch(p.button){case 0:t.leftButtonPressEvent(m);break;case 1:t.middleButtonPressEvent(m);break;case 2:t.rightButtonPressEvent(m);break;default:c1(`Unknown mouse button pressed: ${p.button}`);break}},t.requestPointerLock=()=>{e.container&&e.container.requestPointerLock()},t.exitPointerLock=()=>{var p;return(p=document.exitPointerLock)==null?void 0:p.call(document)},t.isPointerLocked=()=>!!e.container&&document.pointerLockElement===e.container,t.handlePointerLockChange=()=>{t.isPointerLocked()?t.startPointerLockEvent():t.endPointerLockEvent()};function h(){e._view&&e.enabled&&e.enableRender&&(e.inRender=!0,e._view.traverseAllPasses(),e.inRender=!1),t.invokeRenderEvent()}t.requestAnimation=p=>{if(p===void 0){c1("undefined requester, can not start animating");return}if(r.has(p)){s1("requester is already registered for animating");return}r.add(p),!e.animationRequest&&r.size===1&&!e.xrAnimation&&(e._animationStartTime=Date.now(),e._animationFrameCount=0,e.animationRequest=requestAnimationFrame(t.handleAnimation),t.startAnimationEvent())},t.extendAnimation=p=>{const m=Date.now()+p;e._animationExtendedEnd=Math.max(e._animationExtendedEnd,m),!e.animationRequest&&r.size===0&&!e.xrAnimation&&(e._animationStartTime=Date.now(),e._animationFrameCount=0,e.animationRequest=requestAnimationFrame(t.handleAnimation),t.startAnimationEvent())},t.isAnimating=()=>e.xrAnimation||e.animationRequest!==null,t.cancelAnimation=function(p){let m=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(!r.has(p)){if(!m){const v=p&&p.getClassName?p.getClassName():p;s1(`${v} did not request an animation`)}return}r.delete(p),e.animationRequest&&r.size===0&&Date.now()>e._animationExtendedEnd&&(cancelAnimationFrame(e.animationRequest),e.animationRequest=null,t.endAnimationEvent(),t.render())},t.switchToXRAnimation=()=>{e.animationRequest&&(cancelAnimationFrame(e.animationRequest),e.animationRequest=null),e.xrAnimation=!0},t.returnFromXRAnimation=()=>{e.xrAnimation=!1,r.size!==0&&(e.recentAnimationFrameRate=10,e.animationRequest=requestAnimationFrame(t.handleAnimation))},t.updateXRGamepads=(p,m,v)=>{p.inputSources.forEach(y=>{const T=y.gripSpace==null?null:m.getPose(y.gripSpace,v),C=y.gripSpace==null?null:m.getPose(y.targetRaySpace,v),w=y.gamepad,x=y.handedness;if(w){w.index in e.lastGamepadValues||(e.lastGamepadValues[w.index]={left:{buttons:{}},right:{buttons:{}},none:{buttons:{}}});for(let O=0;O<w.buttons.length;++O)O in e.lastGamepadValues[w.index][x].buttons||(e.lastGamepadValues[w.index][x].buttons[O]=!1),e.lastGamepadValues[w.index][x].buttons[O]!==w.buttons[O].pressed&&T!=null&&(t.button3DEvent({gamepad:w,position:T.transform.position,orientation:T.transform.orientation,targetPosition:C.transform.position,targetOrientation:C.transform.orientation,pressed:w.buttons[O].pressed,device:y.handedness==="left"?o1.LeftController:o1.RightController,input:N5[w.mapping]&&N5[w.mapping][O]?N5[w.mapping][O]:w0.Trigger}),e.lastGamepadValues[w.index][x].buttons[O]=w.buttons[O].pressed),e.lastGamepadValues[w.index][x].buttons[O]&&T!=null&&t.move3DEvent({gamepad:w,position:T.transform.position,orientation:T.transform.orientation,targetPosition:C.transform.position,targetOrientation:C.transform.orientation,device:y.handedness==="left"?o1.LeftController:o1.RightController})}})},t.handleMouseMove=p=>{const m={...l(p),position:c(p),deviceType:u(p)};e.moveTimeoutID===0?t.startMouseMoveEvent(m):(t.mouseMoveEvent(m),clearTimeout(e.moveTimeoutID)),e.moveTimeoutID=setTimeout(()=>{t.endMouseMoveEvent(),e.moveTimeoutID=0},200)},t.handleAnimation=()=>{const p=Date.now();e._animationFrameCount++,p-e._animationStartTime>1e3&&e._animationFrameCount>1&&(e.recentAnimationFrameRate=1e3*(e._animationFrameCount-1)/(p-e._animationStartTime),e.lastFrameTime=1/e.recentAnimationFrameRate,t.animationFrameRateUpdateEvent(),e._animationStartTime=p,e._animationFrameCount=1),t.animationEvent(),h(),r.size>0||Date.now()<e._animationExtendedEnd?e.animationRequest=requestAnimationFrame(t.handleAnimation):(cancelAnimationFrame(e.animationRequest),e.animationRequest=null,t.endAnimationEvent(),t.render())},t.handleWheel=p=>{wf(p);const m={...HW(p),...l(p),position:c(p),deviceType:u(p)};e.wheelTimeoutID===0&&(Math.abs(m.spinY)>=.3?a=Math.abs(m.spinY):a=1),m.spinY/=a,e.wheelTimeoutID===0?(t.startMouseWheelEvent(m),t.mouseWheelEvent(m)):(t.mouseWheelEvent(m),clearTimeout(e.wheelTimeoutID)),e.mouseScrollDebounceByPass?(t.extendAnimation(600),t.endMouseWheelEvent(),e.wheelTimeoutID=0):e.wheelTimeoutID=setTimeout(()=>{t.extendAnimation(600),t.endMouseWheelEvent(),e.wheelTimeoutID=0},200)},t.handleMouseUp=p=>{const m={...l(p),position:c(p),deviceType:u(p)};switch(p.button){case 0:t.leftButtonReleaseEvent(m);break;case 1:t.middleButtonReleaseEvent(m);break;case 2:t.rightButtonReleaseEvent(m);break;default:c1(`Unknown mouse button released: ${p.button}`);break}},t.handleTouchStart=p=>{const m=[...i.values()];if(e.recognizeGestures&&m.length>1){const v=l1(i);if(m.length===2){const y={...l(xl),position:m[0].position,deviceType:u(p)};t.leftButtonReleaseEvent(y)}t.recognizeGesture("TouchStart",v)}else if(m.length===1){const v={...l(xl),position:c(p),deviceType:u(p)};t.leftButtonPressEvent(v)}},t.handleTouchMove=p=>{const m=[...i.values()];if(e.recognizeGestures&&m.length>1){const v=l1(i);t.recognizeGesture("TouchMove",v)}else if(m.length===1){const v={...l(xl),position:m[0].position,deviceType:u(p)};t.mouseMoveEvent(v)}},t.handleTouchEnd=p=>{const m=[...i.values()];if(e.recognizeGestures)if(m.length===0){const v={...l(xl),position:c(p),deviceType:u(p)};t.leftButtonReleaseEvent(v)}else if(m.length===1){const v=l1(i);t.recognizeGesture("TouchEnd",v);const y={...l(xl),position:m[0].position,deviceType:u(p)};t.leftButtonPressEvent(y)}else{const v=l1(i);t.recognizeGesture("TouchMove",v)}else if(m.length===1){const v={...l(xl),position:m[0].position,deviceType:u(p)};t.leftButtonReleaseEvent(v)}},t.setView=p=>{e._view!==p&&(e._view=p,e._view.getRenderable().setInteractor(t),t.modified())},t.getFirstRenderer=()=>{var p,m,v;return(v=(m=(p=e._view)==null?void 0:p.getRenderable())==null?void 0:m.getRenderersByReference())==null?void 0:v[0]},t.findPokedRenderer=function(){var x,O;let p=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,m=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;if(!e._view)return null;const v=(O=(x=e._view)==null?void 0:x.getRenderable())==null?void 0:O.getRenderers();if(!v||v.length===0)return null;v.sort((M,A)=>M.getLayer()-A.getLayer());let y=null,T=null,C=null,w=v.length;for(;w--;){const M=v[w];if(e._view.isInViewport(p,m,M)&&M.getInteractive()){C=M;break}y===null&&M.getInteractive()&&(y=M),T===null&&e._view.isInViewport(p,m,M)&&(T=M)}return C===null&&(C=y),C===null&&(C=T),C==null&&(C=v[0]),C},t.render=()=>{!t.isAnimating()&&!e.inRender&&h()},py.forEach(p=>{const m=p.charAt(0).toLowerCase()+p.slice(1);t[`${m}Event`]=v=>{if(!e.enabled)return;if(!t.getCurrentRenderer()){KW(`
          Can not forward events without a current renderer on the interactor.
        `);return}const T={type:p,pokedRenderer:e.currentRenderer,firstRenderer:t.getFirstRenderer(),...v};t[`invoke${p}`](T)}}),t.recognizeGesture=(p,m)=>{if(Object.keys(m).length>2)return;if(e.startingEventPositions||(e.startingEventPositions={}),p==="TouchStart"){Object.keys(m).forEach(_=>{e.startingEventPositions[_]=m[_]}),e.currentGesture="Start";return}if(p==="TouchEnd"){e.currentGesture==="Pinch"&&(t.render(),t.endPinchEvent()),e.currentGesture==="Rotate"&&(t.render(),t.endRotateEvent()),e.currentGesture==="Pan"&&(t.render(),t.endPanEvent()),e.currentGesture="Start",e.startingEventPositions={};return}let v=0;const y=[],T=[];Object.keys(m).forEach(_=>{y[v]=m[_],T[v]=e.startingEventPositions[_],v++});const C=Math.sqrt((T[0].x-T[1].x)*(T[0].x-T[1].x)+(T[0].y-T[1].y)*(T[0].y-T[1].y)),w=Math.sqrt((y[0].x-y[1].x)*(y[0].x-y[1].x)+(y[0].y-y[1].y)*(y[0].y-y[1].y));let x=eh(Math.atan2(T[1].y-T[0].y,T[1].x-T[0].x)),O=eh(Math.atan2(y[1].y-y[0].y,y[1].x-y[0].x)),M=O-x;O=O+180>=360?O-180:O+180,x=x+180>=360?x-180:x+180,Math.abs(O-x)<Math.abs(M)&&(M=O-x);const A=[];if(A[0]=(y[0].x-T[0].x+y[1].x-T[1].x)/2,A[1]=(y[0].y-T[0].y+y[1].y-T[1].y)/2,p==="TouchMove")if(e.currentGesture==="Start"){let _=.01*Math.sqrt(e.container.clientWidth*e.container.clientWidth+e.container.clientHeight*e.container.clientHeight);_<15&&(_=15);const k=Math.abs(w-C),z=w*3.1415926*Math.abs(M)/360,X=Math.sqrt(A[0]*A[0]+A[1]*A[1]);if(k>_&&k>z&&k>X){e.currentGesture="Pinch";const Z={scale:1,touches:m};t.startPinchEvent(Z)}else if(z>_&&z>X){e.currentGesture="Rotate";const Z={rotation:0,touches:m};t.startRotateEvent(Z)}else if(X>_){e.currentGesture="Pan";const Z={translation:[0,0],touches:m};t.startPanEvent(Z)}}else{if(e.currentGesture==="Rotate"){const _={rotation:M,touches:m};t.rotateEvent(_)}if(e.currentGesture==="Pinch"){const _={scale:w/C,touches:m};t.pinchEvent(_)}if(e.currentGesture==="Pan"){const _={translation:A,touches:m};t.panEvent(_)}}},t.handleVisibilityChange=()=>{e._animationStartTime=Date.now(),e._animationFrameCount=0},t.setCurrentRenderer=p=>{e._forcedRenderer=!!p,e.currentRenderer=p},t.setContainer=p=>{d();const m=n.setContainer(p??null);return m&&g(),m},t.delete=()=>{for(;r.size;)t.cancelAnimation(r.values().next().value);typeof document.hidden<"u"&&document.removeEventListener("visibilitychange",t.handleVisibilityChange),e.container&&t.setContainer(null),n.delete()},typeof document.hidden<"u"&&document.addEventListener("visibilitychange",t.handleVisibilityChange,!1)}const XW={renderWindow:null,interactorStyle:null,picker:null,pickingManager:null,initialized:!1,enabled:!1,enableRender:!0,currentRenderer:null,lightFollowCamera:!0,desiredUpdateRate:30,stillUpdateRate:2,container:null,recognizeGestures:!0,currentGesture:"Start",animationRequest:null,lastFrameTime:.1,recentAnimationFrameRate:10,wheelTimeoutID:0,moveTimeoutID:0,lastGamepadValues:{},preventDefaultOnPointerDown:!1,preventDefaultOnPointerUp:!1,mouseScrollDebounceByPass:!1};function vD(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,XW,n),P.obj(t,e),e._animationExtendedEnd=0,P.event(t,e,"RenderEvent"),py.forEach(r=>P.event(t,e,r)),P.get(t,e,["initialized","interactorStyle","lastFrameTime","recentAnimationFrameRate","_view"]),P.setGet(t,e,["container","lightFollowCamera","enabled","enableRender","recognizeGestures","desiredUpdateRate","stillUpdateRate","picker","preventDefaultOnPointerDown","preventDefaultOnPointerUp","mouseScrollDebounceByPass"]),P.moveToProtected(t,e,["view"]),qW(t,e)}const YW=P.newInstance(vD,"vtkRenderWindowInteractor");var ZW={newInstance:YW,extend:vD,handledEvents:py,...mD};const{vtkErrorMacro:QW}=P,JW=[1,-1,1,-1,1,-1];function ez(t,e){e.classHierarchy.push("vtkPoints"),t.getNumberOfPoints=t.getNumberOfTuples,t.setNumberOfPoints=function(n){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:3;t.getNumberOfPoints()!==n&&(e.size=n*r,e.values=P.newTypedArray(e.dataType,e.size),t.setNumberOfComponents(r),t.modified())},t.setPoint=function(n){for(var r=arguments.length,i=new Array(r>1?r-1:0),a=1;a<r;a++)i[a-1]=arguments[a];t.setTuple(n,i)},t.getPoint=t.getTuple,t.findPoint=t.findTuple,t.insertNextPoint=(n,r,i)=>t.insertNextTuple([n,r,i]),t.getBounds=()=>{if(t.getNumberOfComponents()===3){const i=t.getRange(0);e.bounds[0]=i[0],e.bounds[1]=i[1];const a=t.getRange(1);e.bounds[2]=a[0],e.bounds[3]=a[1];const o=t.getRange(2);return e.bounds[4]=o[0],e.bounds[5]=o[1],e.bounds}if(t.getNumberOfComponents()!==2)return QW(`getBounds called on an array with components of
        ${t.getNumberOfComponents()}`),JW;const n=t.getRange(0);e.bounds[0]=n[0],e.bounds[1]=n[1];const r=t.getRange(1);return e.bounds[2]=r[0],e.bounds[3]=r[1],e.bounds[4]=0,e.bounds[5]=0,e.bounds},t.computeBounds=t.getBounds,t.setNumberOfComponents(e.numberOfComponents<2?3:e.numberOfComponents)}const tz={empty:!0,numberOfComponents:3,dataType:ut.FLOAT,bounds:[1,-1,1,-1,1,-1]};function yD(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,tz,n),nt.extend(t,e,n),ez(t,e)}const nz=P.newInstance(yD,"vtkPoints");var yh={newInstance:nz,extend:yD};function TD(t){let e=0;return t.filter((n,r)=>r===e?(e+=n+1,!0):!1)}function CD(t){let e=0;for(let n=0;n<t.length;)n+=t[n]+1,e++;return e}const rz={extractCellSizes:TD,getNumberOfCells:CD};function iz(t,e){e.classHierarchy.push("vtkCellArray");const n={...t};t.getNumberOfCells=r=>(e.numberOfCells!==void 0&&!r||(e.cellSizes?e.numberOfCells=e.cellSizes.length:e.numberOfCells=CD(t.getData())),e.numberOfCells),t.getCellSizes=r=>(e.cellSizes!==void 0&&!r||(e.cellSizes=TD(t.getData())),e.cellSizes),t.resize=r=>{const i=t.getNumberOfTuples();n.resize(r);const a=t.getNumberOfTuples();a<i&&(a===0?(e.numberOfCells=0,e.cellSizes=[]):(e.numberOfCells=void 0,e.cellSizes=void 0))},t.setData=r=>{n.setData(r,1),e.numberOfCells=void 0,e.cellSizes=void 0},t.getCell=r=>{let i=r;const a=e.values[i++];return e.values.subarray(i,i+a)},t.insertNextCell=r=>{const i=t.getNumberOfCells();return t.insertNextTuples([r.length,...r]),++e.numberOfCells,e.cellSizes!=null&&e.cellSizes.push(r.length),i}}function az(t){return{empty:!0,numberOfComponents:1,dataType:ut.UNSIGNED_INT,...t}}function wD(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};nt.extend(t,e,az(n)),iz(t,e)}const oz=P.newInstance(wD,"vtkCellArray");var el={newInstance:oz,extend:wD,...rz};function sz(t,e){e.classHierarchy.push("vtkCell"),t.initialize=function(n){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;if(r){e.pointsIds=r;let i=e.points.getData();i.length!==3*e.pointsIds.length&&(i=P.newTypedArray(n.getDataType(),3*e.pointsIds.length));const a=n.getData();e.pointsIds.forEach((o,s)=>{let c=3*o,l=3*s;i[l]=a[c],i[++l]=a[++c],i[++l]=a[++c]}),e.points.setData(i)}else{e.points=n,e.pointsIds=new Array(n.getNumberOfPoints());for(let i=n.getNumberOfPoints()-1;i>=0;--i)e.pointsIds[i]=i}},t.getBounds=()=>{const n=e.points.getNumberOfPoints(),r=[];if(n){e.points.getPoint(0,r),e.bounds[0]=r[0],e.bounds[1]=r[0],e.bounds[2]=r[1],e.bounds[3]=r[1],e.bounds[4]=r[2],e.bounds[5]=r[2];for(let i=1;i<n;i++)e.points.getPoint(i,r),e.bounds[0]=r[0]<e.bounds[0]?r[0]:e.bounds[0],e.bounds[1]=r[0]>e.bounds[1]?r[0]:e.bounds[1],e.bounds[2]=r[1]<e.bounds[2]?r[1]:e.bounds[2],e.bounds[3]=r[1]>e.bounds[3]?r[1]:e.bounds[3],e.bounds[4]=r[2]<e.bounds[4]?r[2]:e.bounds[4],e.bounds[5]=r[2]>e.bounds[5]?r[2]:e.bounds[5]}else Xu(e.bounds);return e.bounds},t.getLength2=()=>{t.getBounds();let n=0,r=0;for(let i=0;i<3;i++)r=e.bounds[2*i+1]-e.bounds[2*i],n+=r*r;return n},t.getParametricDistance=n=>{let r,i=0;for(let a=0;a<3;a++)n[a]<0?r=-n[a]:n[a]>1?r=n[a]-1:r=0,r>i&&(i=r);return i},t.getNumberOfPoints=()=>e.points.getNumberOfPoints(),t.deepCopy=n=>{n.initialize(e.points,e.pointsIds)},t.getCellDimension=()=>{},t.intersectWithLine=(n,r,i,a,o,s,c)=>{},t.evaluatePosition=(n,r,i,a,o,s)=>{P.vtkErrorMacro("vtkCell.evaluatePosition is not implemented.")}}const cz={bounds:[-1,-1,-1,-1,-1,-1],pointsIds:[]};function xD(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,cz,n),P.obj(t,e),e.points||(e.points=yh.newInstance()),P.get(t,e,["points","pointsIds"]),sz(t,e)}const lz=P.newInstance(xD,"vtkCell");var Th={newInstance:lz,extend:xD};function uz(t,e){let n=e;for(e>=t.array.length&&(n+=t.array.length);n>t.array.length;)t.array.push({ncells:0,cells:null});t.array.length=n}function fz(t,e){e.classHierarchy.push("vtkCellLinks"),t.buildLinks=n=>{const r=n.getPoints().getNumberOfPoints(),i=n.getNumberOfCells(),a=new Uint32Array(r);if(n.isA("vtkPolyData")){for(let o=0;o<i;++o){const{cellPointIds:s}=n.getCellPoints(o);s.forEach(c=>{t.incrementLinkCount(c)})}t.allocateLinks(r),e.maxId=r-1;for(let o=0;o<i;++o){const{cellPointIds:s}=n.getCellPoints(o);s.forEach(c=>{t.insertCellReference(c,a[c]++,o)})}}else{for(let o=0;o<i;o++)Th.newInstance().getPointsIds().forEach(c=>{t.incrementLinkCount(c)});t.allocateLinks(r),e.maxId=r-1;for(let o=0;o<i;++o)Th.newInstance().getPointsIds().forEach(c=>{t.insertCellReference(c,a[c]++,o)})}},t.allocate=function(n){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1e3;e.array=Array(n).fill().map(()=>({ncells:0,cells:null})),e.extend=r,e.maxId=-1},t.initialize=()=>{e.array=null},t.getLink=n=>e.array[n],t.getNcells=n=>e.array[n].ncells,t.getCells=n=>e.array[n].cells,t.insertNextPoint=n=>{e.array.push({ncells:n,cells:Array(n)}),++e.maxId},t.insertNextCellReference=(n,r)=>{e.array[n].cells[e.array[n].ncells++]=r},t.deletePoint=n=>{e.array[n].ncells=0,e.array[n].cells=null},t.removeCellReference=(n,r)=>{e.array[r].cells=e.array[r].cells.filter(i=>i!==n),e.array[r].ncells=e.array[r].cells.length},t.addCellReference=(n,r)=>{e.array[r].cells[e.array[r].ncells++]=n},t.resizeCellList=(n,r)=>{e.array[n].cells.length=r},t.squeeze=()=>{uz(e,e.maxId+1)},t.reset=()=>{e.maxId=-1},t.deepCopy=n=>{e.array=[...n.array],e.extend=n.extend,e.maxId=n.maxId},t.incrementLinkCount=n=>{++e.array[n].ncells},t.allocateLinks=n=>{for(let r=0;r<n;++r)e.array[r].cells=new Array(e.array[r].ncells)},t.insertCellReference=(n,r,i)=>{e.array[n].cells[r]=i}}const gz={array:null,maxId:0,extend:0};function SD(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,gz,n),P.obj(t,e),fz(t,e)}const dz=P.newInstance(SD,"vtkCellLinks");var pz={newInstance:dz,extend:SD};const Ht={VTK_EMPTY_CELL:0,VTK_VERTEX:1,VTK_POLY_VERTEX:2,VTK_LINE:3,VTK_POLY_LINE:4,VTK_TRIANGLE:5,VTK_TRIANGLE_STRIP:6,VTK_POLYGON:7,VTK_QUAD:9,VTK_QUADRATIC_EDGE:21,VTK_CONVEX_POINT_SET:41,VTK_POLYHEDRON:42},G3=["vtkEmptyCell","vtkVertex","vtkPolyVertex","vtkLine","vtkPolyLine","vtkTriangle","vtkTriangleStrip","vtkPolygon","vtkPixel","vtkQuad","vtkTetra","vtkVoxel","vtkHexahedron","vtkWedge","vtkPyramid","vtkPentagonalPrism","vtkHexagonalPrism","UnknownClass","UnknownClass","UnknownClass","UnknownClass","vtkQuadraticEdge","vtkQuadraticTriangle","vtkQuadraticQuad","vtkQuadraticTetra","vtkQuadraticHexahedron","vtkQuadraticWedge","vtkQuadraticPyramid","vtkBiQuadraticQuad","vtkTriQuadraticHexahedron","vtkQuadraticLinearQuad","vtkQuadraticLinearWedge","vtkBiQuadraticQuadraticWedge","vtkBiQuadraticQuadraticHexahedron","vtkBiQuadraticTriangle","vtkCubicLine","vtkQuadraticPolygon","UnknownClass","UnknownClass","UnknownClass","UnknownClass","vtkConvexPointSet","UnknownClass","UnknownClass","UnknownClass","UnknownClass","UnknownClass","UnknownClass","UnknownClass","UnknownClass","UnknownClass","vtkParametricCurve","vtkParametricSurface","vtkParametricTriSurface","vtkParametricQuadSurface","vtkParametricTetraRegion","vtkParametricHexRegion","UnknownClass","UnknownClass","UnknownClass","vtkHigherOrderEdge","vtkHigherOrderTriangle","vtkHigherOrderQuad","vtkHigherOrderPolygon","vtkHigherOrderTetrahedron","vtkHigherOrderWedge","vtkHigherOrderPyramid","vtkHigherOrderHexahedron"];function hz(t){return t<G3.length?G3[t]:"UnknownClass"}function mz(t){return G3.findIndex(t)}function vz(t){return t<Ht.VTK_QUADRATIC_EDGE||t===Ht.VTK_CONVEX_POINT_SET||t===Ht.VTK_POLYHEDRON}function yz(t){return t===Ht.VTK_TRIANGLE_STRIP||t===Ht.VTK_POLY_LINE||t===Ht.VTK_POLY_VERTEX}const Tz={getClassNameFromTypeId:hz,getTypeIdFromClassName:mz,isLinear:vz,hasSubCells:yz};function Cz(t,e){e.classHierarchy.push("vtkCellTypes"),t.allocate=function(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:512,r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1e3;e.size=n>0?n:1,e.extend=r>0?r:1,e.maxId=-1,e.typeArray=new Uint8Array(n),e.locationArray=new Uint32Array(n)},t.insertCell=(n,r,i)=>{e.typeArray[n]=r,e.locationArray[n]=i,n>e.maxId&&(e.maxId=n)},t.insertNextCell=(n,r)=>(t.insertCell(++e.maxId,n,r),e.maxId),t.setCellTypes=(n,r,i)=>{e.size=n,e.typeArray=r,e.locationArray=i,e.maxId=n-1},t.getCellLocation=n=>e.locationArray[n],t.deleteCell=n=>{e.typeArray[n]=Ht.VTK_EMPTY_CELL},t.getNumberOfTypes=()=>e.maxId+1,t.isType=n=>{const r=t.getNumberOfTypes();for(let i=0;i<r;++i)if(n===t.getCellType(i))return!0;return!1},t.insertNextType=n=>t.insertNextCell(n,-1),t.getCellType=n=>e.typeArray[n],t.reset=()=>{e.maxId=-1},t.deepCopy=n=>{t.allocate(n.getSize(),n.getExtend()),e.typeArray.set(n.getTypeArray()),e.locationArray.set(n.getLocationArray()),e.maxId=n.getMaxId()}}const wz={size:0,maxId:-1,extend:1e3};function ED(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,wz,n),P.obj(t,e),P.get(t,e,["size","maxId","extend"]),P.getArray(t,e,["typeArray","locationArray"]),Cz(t,e)}const xz=P.newInstance(ED,"vtkCellTypes");var Sz={newInstance:xz,extend:ED,...Tz};const Ez={NO_INTERSECTION:0,YES_INTERSECTION:1,ON_LINE:2};var OD={IntersectionState:Ez};const{IntersectionState:lp}=OD;function Wl(t,e,n){let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null;const i={t:Number.MIN_VALUE,distance:0},a=[];let o;a[0]=n[0]-e[0],a[1]=n[1]-e[1],a[2]=n[2]-e[2];const s=a[0]*(t[0]-e[0])+a[1]*(t[1]-e[1])+a[2]*(t[2]-e[2]),c=ct(a,a);let l=1e-5*s;return c!==0&&(i.t=s/c),l<0&&(l=-l),-l<c&&c<l||c<=0||i.t<0?o=e:i.t>1?o=n:(o=a,a[0]=e[0]+i.t*a[0],a[1]=e[1]+i.t*a[1],a[2]=e[2]+i.t*a[2]),r&&(r[0]=o[0],r[1]=o[1],r[2]=o[2]),i.distance=oo(o,t),i}function DD(t,e,n,r,i,a){const o=[],s=[],c=[];i[0]=0,a[0]=0,is(e,t,o),is(r,n,s),is(n,t,c);const l=[ct(o,o),-ct(o,s),-ct(o,s),ct(s,s)],f=[];if(f[0]=ct(o,c),f[1]=-ct(s,c),US(l,f,2)===0){let u=Number.MAX_VALUE;const g=[t,e,n,r],d=[n,n,t,t],h=[r,r,e,e];a[0],a[0],i[0],i[0],i[0],i[0],a[0],a[0];let p;for(let m=0;m<4;m++)p=Wl(g[m],d[m],h[m]),p.distance<u&&(u=p.distance);return lp.ON_LINE}return i[0]=f[0],a[0]=f[1],i[0]>=0&&i[0]<=1&&a[0]>=0&&a[0]<=1?lp.YES_INTERSECTION:lp.NO_INTERSECTION}const Oz={distanceToLine:Wl,intersection:DD};function Dz(t,e){e.classHierarchy.push("vtkLine");function n(r){return r>=0&&r<=1}t.getCellDimension=()=>1,t.intersectWithLine=(r,i,a,o,s)=>{const c={intersect:0,t:Number.MAX_VALUE,subId:0,betweenPoints:null};s[1]=0,s[2]=0;const l=[],f=[],u=[];e.points.getPoint(0,f),e.points.getPoint(1,u);const g=[],d=[],h=DD(r,i,f,u,g,d);if(c.t=g[0],c.betweenPoints=n(c.t),s[0]=d[0],h===lp.YES_INTERSECTION){for(let p=0;p<3;p++)o[p]=f[p]+s[0]*(u[p]-f[p]),l[p]=r[p]+c.t*(i[p]-r[p]);if(oo(o,l)<=a*a)return c.intersect=1,c}else{let p;if(c.t<0)return p=Wl(r,f,u,o),p.distance<=a*a&&(c.t=0,c.intersect=1,c.betweenPoints=!0),c;if(c.t>1)return p=Wl(i,f,u,o),p.distance<=a*a&&(c.t=1,c.intersect=1,c.betweenPoints=!0),c;if(s[0]<0)return s[0]=0,p=Wl(f,r,i,o),c.t=p.t,p.distance<=a*a&&(c.intersect=1),c;if(s[0]>1)return s[0]=1,p=Wl(u,r,i,o),c.t=p.t,p.distance<=a*a&&(c.intersect=1),c}return c},t.evaluateLocation=(r,i,a)=>{const o=[],s=[];e.points.getPoint(0,o),e.points.getPoint(1,s);for(let c=0;c<3;c++)i[c]=o[c]+r[0]*(s[c]-o[c]);a[0]=1-r[0],a[1]=r[0]},t.evaluateOrientation=(r,i,a)=>e.orientations?(ip(i,e.orientations[0],e.orientations[1],r[0]),a[0]=1-r[0],a[1]=r[0],!0):!1}const Rz={orientations:null};function RD(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Rz,n),Th.extend(t,e,n),P.setGet(t,e,["orientations"]),Dz(t,e)}const Mz=P.newInstance(RD,"vtkLine");var aa={newInstance:Mz,extend:RD,...Oz,...OD};function _z(t,e){e.classHierarchy.push("vtkPointSet"),e.points?e.points=Fa(e.points):e.points=yh.newInstance(),t.getNumberOfPoints=()=>e.points.getNumberOfPoints(),t.getBounds=()=>e.points.getBounds(),t.computeBounds=()=>{t.getBounds()};const n=t.shallowCopy;t.shallowCopy=function(r){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;n(r,i),e.points=yh.newInstance(),e.points.shallowCopy(r.getPoints())}}const bz={};function MD(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,bz,n),Zu.extend(t,e,n),P.setGet(t,e,["points"]),_z(t,e)}const Lz=P.newInstance(MD,"vtkPointSet");var Iz={newInstance:Lz,extend:MD};function hy(t,e,n,r){const i=n[0]-e[0],a=n[1]-e[1],o=n[2]-e[2],s=t[0]-e[0],c=t[1]-e[1],l=t[2]-e[2];r[0]=a*l-o*c,r[1]=o*s-i*l,r[2]=i*c-a*s}function Ch(t,e,n,r){hy(t,e,n,r);const i=Math.sqrt(r[0]*r[0]+r[1]*r[1]+r[2]*r[2]);i!==0&&(r[0]/=i,r[1]/=i,r[2]/=i)}function Vz(t,e,n,r,i,a){let o=arguments.length>6&&arguments[6]!==void 0?arguments[6]:1e-6,s=!1;const c=[],l=[],f=[],u=[],g=[];Ch(t,e,n,u),Ch(r,i,a,g);const d=-ct(u,t),h=-ct(g,r),p=[ct(g,t)+h,ct(g,e)+h,ct(g,n)+h];if(p[0]*p[1]>o&&p[0]*p[2]>o)return{intersect:!1,coplanar:s,pt1:c,pt2:l,surfaceId:f};const m=[ct(u,r)+d,ct(u,i)+d,ct(u,a)+d];if(m[0]*m[1]>o&&m[0]*m[2]>o)return{intersect:!1,coplanar:s,pt1:c,pt2:l,surfaceId:f};if(Math.abs(u[0]-g[0])<1e-9&&Math.abs(u[1]-g[1])<1e-9&&Math.abs(u[2]-g[2])<1e-9&&Math.abs(d-h)<1e-9)return s=!0,{intersect:!1,coplanar:s,pt1:c,pt2:l,surfaceId:f};const v=[t,e,n],y=[r,i,a],T=ct(u,g),C=(d-h*T)/(T*T-1),w=(h-d*T)/(T*T-1),x=[C*u[0]+w*g[0],C*u[1]+w*g[1],C*u[2]+w*g[2]],O=yo(u,g,[]);Z0(O);let M=0,A=0;const _=[],k=[];let z=50,X=50;for(let J=0;J<3;J++){const de=J,Q=(J+1)%3,q=$r.intersectWithLine(v[de],v[Q],r,g);q.intersection&&q.t>0-o&&q.t<1+o&&(q.t<1+o&&q.t>1-o&&(z=M),_[M++]=ct(q.x,O)-ct(x,O));const j=$r.intersectWithLine(y[de],y[Q],t,u);j.intersection&&j.t>0-o&&j.t<1+o&&(j.t<1+o&&j.t>1-o&&(X=A),k[A++]=ct(j.x,O)-ct(x,O))}if(M>2){M--;const J=_[2];_[2]=_[z],_[z]=J}if(A>2){A--;const J=k[2];k[2]=k[X],k[X]=J}if(M!==2||A!==2)return{intersect:!1,coplanar:s,pt1:c,pt2:l,surfaceId:f};if(Number.isNaN(_[0])||Number.isNaN(_[1])||Number.isNaN(k[0])||Number.isNaN(k[1]))return{intersect:!1,coplanar:s,pt1:c,pt2:l,surfaceId:f};if(_[0]>_[1]){const J=_[1];_[1]=_[0],_[0]=J}if(k[0]>k[1]){const J=k[1];k[1]=k[0],k[0]=J}let Z,ce;return _[1]<k[0]||k[1]<_[0]?{intersect:!1,coplanar:s,pt1:c,pt2:l,surfaceId:f}:(_[0]<k[0]?_[1]<k[1]?(f[0]=2,f[1]=1,Z=k[0],ce=_[1]):(f[0]=2,f[1]=2,Z=k[0],ce=k[1]):_[1]<k[1]?(f[0]=1,f[1]=1,Z=_[0],ce=_[1]):(f[0]=1,f[1]=2,Z=_[0],ce=k[1]),x3(x,O,Z,c),x3(x,O,ce,l),{intersect:!0,coplanar:s,pt1:c,pt2:l,surfaceId:f})}const Pz={computeNormalDirection:hy,computeNormal:Ch,intersectWithTriangle:Vz};function Nz(t,e){e.classHierarchy.push("vtkTriangle"),t.getCellDimension=()=>2,t.intersectWithLine=(n,r,i,a,o)=>{const s={subId:0,t:Number.MAX_VALUE,intersect:0,betweenPoints:!1};o[2]=0;const c=[],l=i*i,f=[],u=[],g=[];e.points.getPoint(0,f),e.points.getPoint(1,u),e.points.getPoint(2,g);const d=[],h=[];if(Ch(f,u,g,d),d[0]!==0||d[1]!==0||d[2]!==0){const T=$r.intersectWithLine(n,r,f,d);if(s.betweenPoints=T.betweenPoints,s.t=T.t,a[0]=T.x[0],a[1]=T.x[1],a[2]=T.x[2],!T.intersection)return o[0]=0,o[1]=0,s.intersect=0,s;const C=t.evaluatePosition(a,c,o,h);if(C.evaluation>=0)return C.dist2<=l?(s.intersect=1,s):(s.intersect=C.evaluation,s)}const p=oo(f,u),m=oo(u,g),v=oo(g,f);e.line||(e.line=aa.newInstance()),p>m&&p>v?(e.line.getPoints().setPoint(0,f),e.line.getPoints().setPoint(1,u)):m>v&&m>p?(e.line.getPoints().setPoint(0,u),e.line.getPoints().setPoint(1,g)):(e.line.getPoints().setPoint(0,g),e.line.getPoints().setPoint(1,f));const y=e.line.intersectWithLine(n,r,i,a,o);if(s.betweenPoints=y.betweenPoints,s.t=y.t,y.intersect){const T=[],C=[],w=[];for(let x=0;x<3;x++)T[x]=f[x]-g[x],C[x]=u[x]-g[x],w[x]=a[x]-g[x];return o[0]=ct(w,T)/v,o[1]=ct(w,C)/m,s.intersect=1,s}return o[0]=0,o[1]=0,s.intersect=0,s},t.evaluatePosition=(n,r,i,a)=>{const o={subId:0,dist2:0,evaluation:-1};let s,c;const l=[],f=[],u=[],g=[];let d;const h=[],p=[],m=[];let v=0,y=0;const T=[];let C,w,x,O=[];const M=[],A=[],_=[];o.subId=0,i[2]=0,e.points.getPoint(1,l),e.points.getPoint(2,f),e.points.getPoint(0,u),hy(l,f,u,g),$r.generalizedProjectPoint(n,l,g,_);let k=0;for(s=0;s<3;s++)g[s]<0?d=-g[s]:d=g[s],d>k&&(k=d,y=s);for(c=0,s=0;s<3;s++)s!==y&&(T[c++]=s);for(s=0;s<2;s++)h[s]=_[T[s]]-u[T[s]],p[s]=l[T[s]]-u[T[s]],m[s]=f[T[s]]-u[T[s]];if(v=vn(p,m),v===0)return i[0]=0,i[1]=0,o.evaluation=-1,o;if(i[0]=vn(h,m)/v,i[1]=vn(p,h)/v,a[0]=1-(i[0]+i[1]),a[1]=i[0],a[2]=i[1],a[0]>=0&&a[0]<=1&&a[1]>=0&&a[1]<=1&&a[2]>=0&&a[2]<=1)r&&(o.dist2=oo(_,n),r[0]=_[0],r[1]=_[1],r[2]=_[2]),o.evaluation=1;else{let z;if(r){if(a[1]<0&&a[2]<0)for(C=oo(n,u),w=aa.distanceToLine(n,l,u,z,M),x=aa.distanceToLine(n,u,f,z,A),C<w?(o.dist2=C,O=u):(o.dist2=w,O=M),x<o.dist2&&(o.dist2=x,O=A),s=0;s<3;s++)r[s]=O[s];else if(a[2]<0&&a[0]<0)for(C=oo(n,l),w=aa.distanceToLine(n,l,u,z,M),x=aa.distanceToLine(n,l,f,z,A),C<w?(o.dist2=C,O=l):(o.dist2=w,O=M),x<o.dist2&&(o.dist2=x,O=A),s=0;s<3;s++)r[s]=O[s];else if(a[1]<0&&a[0]<0)for(C=oo(n,f),w=aa.distanceToLine(n,f,u,z,M),x=aa.distanceToLine(n,l,f,z,A),C<w?(o.dist2=C,O=f):(o.dist2=w,O=M),x<o.dist2&&(o.dist2=x,O=A),s=0;s<3;s++)r[s]=O[s];else if(a[0]<0){const X=aa.distanceToLine(n,l,f,r);o.dist2=X.distance}else if(a[1]<0){const X=aa.distanceToLine(n,f,u,r);o.dist2=X.distance}else if(a[2]<0){const X=aa.distanceToLine(n,l,u,r);o.dist2=X.distance}}o.evaluation=0}return o},t.evaluateLocation=(n,r,i)=>{const a=[],o=[],s=[];e.points.getPoint(0,a),e.points.getPoint(1,o),e.points.getPoint(2,s);const c=1-n[0]-n[1];for(let l=0;l<3;l++)r[l]=a[l]*c+o[l]*n[0]+s[l]*n[1];i[0]=c,i[1]=n[0],i[2]=n[1]},t.getParametricDistance=n=>{let r,i=0;const a=[];a[0]=n[0],a[1]=n[1],a[2]=1-n[0]-n[1];for(let o=0;o<3;o++)a[o]<0?r=-a[o]:a[o]>1?r=a[o]-1:r=0,r>i&&(i=r);return i}}const kz={};function _D(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,kz,n),Th.extend(t,e,n),Nz(t,e)}const Az=P.newInstance(_D,"vtkTriangle");var Fz={newInstance:Az,extend:_D,...Pz};const k5=["verts","lines","polys","strips"],{vtkWarningMacro:W9}=P,Uz={[Ht.VTK_LINE]:aa,[Ht.VTK_POLY_LINE]:aa,[Ht.VTK_TRIANGLE]:Fz};function Bz(t,e){e.classHierarchy.push("vtkPolyData");function n(i){return i.replace(/(?:^\w|[A-Z]|\b\w)/g,a=>a.toUpperCase()).replace(/\s+/g,"")}k5.forEach(i=>{t[`getNumberOf${n(i)}`]=()=>e[i].getNumberOfCells(),e[i]?e[i]=Fa(e[i]):e[i]=el.newInstance()}),t.getNumberOfCells=()=>k5.reduce((i,a)=>i+e[a].getNumberOfCells(),0);const r=t.shallowCopy;t.shallowCopy=function(i){let a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;r(i,a),k5.forEach(o=>{e[o]=el.newInstance(),e[o].shallowCopy(i.getReferenceByName(o))})},t.buildCells=()=>{const i=t.getNumberOfVerts(),a=t.getNumberOfLines(),o=t.getNumberOfPolys(),s=t.getNumberOfStrips(),c=i+a+o+s,l=new Uint8Array(c);let f=l;const u=new Uint32Array(c);let g=u;if(i){let d=0;e.verts.getCellSizes().forEach((h,p)=>{g[p]=d,f[p]=h>1?Ht.VTK_POLY_VERTEX:Ht.VTK_VERTEX,d+=h+1}),g=g.subarray(i),f=f.subarray(i)}if(a){let d=0;e.lines.getCellSizes().forEach((h,p)=>{g[p]=d,f[p]=h>2?Ht.VTK_POLY_LINE:Ht.VTK_LINE,h===1&&W9("Building VTK_LINE ",p," with only one point, but VTK_LINE needs at least two points. Check the input."),d+=h+1}),g=g.subarray(a),f=f.subarray(a)}if(o){let d=0;e.polys.getCellSizes().forEach((h,p)=>{switch(g[p]=d,h){case 3:f[p]=Ht.VTK_TRIANGLE;break;case 4:f[p]=Ht.VTK_QUAD;break;default:f[p]=Ht.VTK_POLYGON;break}h<3&&W9("Building VTK_TRIANGLE ",p," with less than three points, but VTK_TRIANGLE needs at least three points. Check the input."),d+=h+1}),g+=g.subarray(o),f+=f.subarray(o)}if(s){let d=0;f.fill(Ht.VTK_TRIANGLE_STRIP,0,s),e.strips.getCellSizes().forEach((h,p)=>{g[p]=d,d+=h+1})}e.cells=Sz.newInstance(),e.cells.setCellTypes(c,l,u)},t.buildLinks=function(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;e.cells===void 0&&t.buildCells(),e.links=pz.newInstance(),i>0?e.links.allocate(i):e.links.allocate(t.getPoints().getNumberOfPoints()),e.links.buildLinks(t)},t.getCellType=i=>e.cells.getCellType(i),t.getCellPoints=i=>{const a=t.getCellType(i);let o=null;switch(a){case Ht.VTK_VERTEX:case Ht.VTK_POLY_VERTEX:o=e.verts;break;case Ht.VTK_LINE:case Ht.VTK_POLY_LINE:o=e.lines;break;case Ht.VTK_TRIANGLE:case Ht.VTK_QUAD:case Ht.VTK_POLYGON:o=e.polys;break;case Ht.VTK_TRIANGLE_STRIP:o=e.strips;break;default:return o=null,{type:0,cellPointIds:null}}const s=e.cells.getCellLocation(i),c=o.getCell(s);return{cellType:a,cellPointIds:c}},t.getPointCells=i=>e.links.getCells(i),t.getCellEdgeNeighbors=(i,a,o)=>{const s=e.links.getLink(a),c=e.links.getLink(o);return s.cells.filter(l=>l!==i&&c.cells.indexOf(l)!==-1)},t.getCell=function(i){let a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;const o=t.getCellPoints(i),s=a||Uz[o.cellType].newInstance();return s.initialize(t.getPoints(),o.cellPointIds),s}}const Gz={};function bD(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Gz,n),Iz.extend(t,e,n),P.get(t,e,["cells","links"]),P.setGet(t,e,["verts","lines","polys","strips"]),Bz(t,e)}const $z=P.newInstance(bD,"vtkPolyData");var Ii={newInstance:$z,extend:bD};const Wz=1e-6;function zz(t,e){e.classHierarchy.push("vtkProp3D"),t.addPosition=r=>{e.position=e.position.map((i,a)=>i+r[a]),t.modified()},t.getOrientationWXYZ=()=>{const r=Q0();b3(r,e.rotation);const i=new Float64Array(3),a=dF(i,r);return[eh(a),i[0],i[1],i[2]]},t.getOrientationQuaternion=function(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];return b3(r,e.rotation)},t.rotateX=r=>{r!==0&&(k4(e.rotation,e.rotation,hn(r)),t.modified())},t.rotateY=r=>{r!==0&&(A4(e.rotation,e.rotation,hn(r)),t.modified())},t.rotateZ=r=>{r!==0&&(F4(e.rotation,e.rotation,hn(r)),t.modified())},t.rotateWXYZ=(r,i,a,o)=>{if(r===0||i===0&&a===0&&o===0)return;const s=hn(r),c=Q0();$4(c,[i,a,o],s);const l=new Float64Array(16);ih(l,c),vt(e.rotation,e.rotation,l),t.modified()},t.rotateQuaternion=r=>{if(Math.abs(r[3])>=1-Wz)return;const i=ih(new Float64Array(16),r);vt(e.rotation,e.rotation,i),t.modified()},t.setOrientation=(r,i,a)=>r===e.orientation[0]&&i===e.orientation[1]&&a===e.orientation[2]?!1:(e.orientation=[r,i,a],Be(e.rotation),t.rotateZ(a),t.rotateX(r),t.rotateY(i),t.modified(),!0),t.setUserMatrix=r=>pd(e.userMatrix,r)?!1:(nn(e.userMatrix,r),t.modified(),!0),t.getMatrix=()=>(t.computeMatrix(),e.matrix),t.computeMatrix=()=>{if(t.getMTime()>e.matrixMTime.getMTime()){Be(e.matrix),e.userMatrix&&vt(e.matrix,e.matrix,e.userMatrix),en(e.matrix,e.matrix,e.origin),en(e.matrix,e.matrix,e.position),vt(e.matrix,e.matrix,e.rotation),ms(e.matrix,e.matrix,e.scale),en(e.matrix,e.matrix,[-e.origin[0],-e.origin[1],-e.origin[2]]),ft(e.matrix,e.matrix),e.isIdentity=!0;for(let r=0;r<4;++r)for(let i=0;i<4;++i)(r===i?1:0)!==e.matrix[r+i*4]&&(e.isIdentity=!1);e.matrixMTime.modified()}},t.getCenter=()=>Nt.getCenter(e.bounds),t.getLength=()=>Nt.getLength(e.bounds),t.getXRange=()=>Nt.getXRange(e.bounds),t.getYRange=()=>Nt.getYRange(e.bounds),t.getZRange=()=>Nt.getZRange(e.bounds),t.getUserMatrix=()=>e.userMatrix;function n(){t.computeMatrix()}t.onModified(n)}const jz={origin:[0,0,0],position:[0,0,0],orientation:[0,0,0],rotation:null,scale:[1,1,1],bounds:[1,-1,1,-1,1,-1],userMatrix:null,userMatrixMTime:null,cachedProp3D:null,isIdentity:!0,matrixMTime:null};function LD(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,jz,n),vd.extend(t,e,n),e.matrixMTime={},P.obj(e.matrixMTime),P.get(t,e,["bounds","isIdentity"]),P.getArray(t,e,["orientation"]),P.setGetArray(t,e,["origin","position","scale"],3),e.matrix=Be(new Float64Array(16)),e.rotation=Be(new Float64Array(16)),e.userMatrix=Be(new Float64Array(16)),e.transform=null,zz(t,e)}const Hz=P.newInstance(LD,"vtkProp3D");var my={newInstance:Hz,extend:LD};const{vtkDebugMacro:Kz}=P;function qz(t,e){e.classHierarchy.push("vtkActor");const n={...t};t.getActors=()=>[t],t.getIsOpaque=()=>{if(e.forceOpaque)return!0;if(e.forceTranslucent)return!1;e.property||t.getProperty();let r=e.property.getOpacity()>=1;return r=r&&(!e.texture||!e.texture.isTranslucent()),r=r&&(!e.mapper||e.mapper.getIsOpaque()),r},t.hasTranslucentPolygonalGeometry=()=>e.mapper===null?!1:(e.property===null&&t.setProperty(t.makeProperty()),!t.getIsOpaque()),t.makeProperty=Yu.newInstance,t.getProperty=()=>(e.property===null&&(e.property=t.makeProperty()),e.property),t.getBounds=()=>{if(e.mapper===null)return e.bounds;const r=e.mapper.getBounds();if(!r||r.length!==6)return r;if(r[0]>r[1])return e.mapperBounds=r.concat(),e.bounds=[1,-1,1,-1,1,-1],e.boundsMTime.modified(),r;if(!e.mapperBounds||r[0]!==e.mapperBounds[0]||r[1]!==e.mapperBounds[1]||r[2]!==e.mapperBounds[2]||r[3]!==e.mapperBounds[3]||r[4]!==e.mapperBounds[4]||r[5]!==e.mapperBounds[5]||t.getMTime()>e.boundsMTime.getMTime()){Kz("Recomputing bounds..."),e.mapperBounds=r.concat();const i=[];Nt.getCorners(r,i),t.computeMatrix();const a=new Float64Array(16);ft(a,e.matrix),i.forEach(o=>pt(o,o,a)),e.bounds[0]=e.bounds[2]=e.bounds[4]=Number.MAX_VALUE,e.bounds[1]=e.bounds[3]=e.bounds[5]=-Number.MAX_VALUE,e.bounds=e.bounds.map((o,s)=>s%2===0?i.reduce((c,l)=>c>l[s/2]?l[s/2]:c,o):i.reduce((c,l)=>c<l[(s-1)/2]?l[(s-1)/2]:c,o)),e.boundsMTime.modified()}return e.bounds},t.getMTime=()=>{let r=n.getMTime();if(e.property!==null){const i=e.property.getMTime();r=i>r?i:r}if(e.backfaceProperty!==null){const i=e.backfaceProperty.getMTime();r=i>r?i:r}return r},t.getRedrawMTime=()=>{let r=e.mtime;if(e.mapper!==null){let i=e.mapper.getMTime();r=i>r?i:r,e.mapper.getInput()!==null&&(e.mapper.getInputAlgorithm().update(),i=e.mapper.getInput().getMTime(),r=i>r?i:r)}return r},t.getSupportsSelection=()=>e.mapper?e.mapper.getSupportsSelection():!1,t.processSelectorPixelBuffers=(r,i)=>{e.mapper&&e.mapper.processSelectorPixelBuffers&&e.mapper.processSelectorPixelBuffers(r,i)}}const Xz={mapper:null,property:null,backfaceProperty:null,forceOpaque:!1,forceTranslucent:!1,bounds:[1,-1,1,-1,1,-1]};function ID(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Xz,n),my.extend(t,e,n),e.boundsMTime={},P.obj(e.boundsMTime),P.set(t,e,["property"]),P.setGet(t,e,["backfaceProperty","forceOpaque","forceTranslucent","mapper"]),qz(t,e)}const Yz=P.newInstance(ID,"vtkActor");var tl={newInstance:Yz,extend:ID};function Zz(t,e){const n=t.invokeResize;delete t.invokeResize,e.renderWindow=gN.newInstance(),e.rendererMap={},e.openGLRenderWindow=EW.newInstance(),e.renderWindow.addView(e.openGLRenderWindow),e.interactor=ZW.newInstance(),e.interactor.setView(e.openGLRenderWindow),e.interactor.initialize(),t.addRenderer=({viewport:r,id:i,background:a})=>{const o=$W.newInstance({viewport:r,background:a||e.background});e.renderWindow.addRenderer(o),e.rendererMap[i]=o},t.destroy=()=>{e.renderWindow.getInteractor().delete()},t.removeRenderer=r=>{const i=t.getRenderer(r);e.renderWindow.removeRenderer(i),i.delete(),delete e.rendererMap[r]},t.getRenderer=r=>e.rendererMap[r],t.getRenderers=()=>{const{rendererMap:r}=e;return Object.keys(r).map(a=>({id:a,renderer:r[a]}))},t.resize=()=>{if(e.container){const{width:r,height:i}=e.container;e.openGLRenderWindow.setSize(Math.floor(r),Math.floor(i)),n(),e.renderWindow.render()}},t.setContainer=r=>{e.container=r,e.openGLRenderWindow.setContainer(e.container)},t.delete=P.chain(t.setContainer,t.destroy,e.openGLRenderWindow.delete,t.delete),t.resize()}const Qz={background:[0,0,0],container:null};function VD(t,e,n={}){Object.assign(e,Qz,n),P.obj(t,e),P.get(t,e,["renderWindow","openGLRenderWindow","interactor","container"]),P.event(t,e,"resize"),Zz(t,e)}const Jz=P.newInstance(VD),ej={newInstance:Jz,extend:VD},{vtkErrorMacro:u1}=P;function tj(t,e){e.classHierarchy.push("vtkPiecewiseFunction"),t.getSize=()=>e.nodes.length,t.getType=()=>{let n,r=0,i=0;e.nodes.length>0&&(r=e.nodes[0].y);for(let a=1;a<e.nodes.length;a++){if(n=e.nodes[a].y,n!==r)if(n>r)switch(i){case 0:case 1:i=1;break;case 2:default:i=3;break}else switch(i){case 0:case 2:i=2;break;case 1:default:i=3;break}if(r=n,i===3)break}switch(i){case 0:return"Constant";case 1:return"NonDecreasing";case 2:return"NonIncreasing";case 3:default:return"Varied"}},t.getDataPointer=()=>{const n=e.nodes.length;if(e.function=null,n>0){e.function=[];for(let r=0;r<n;r++)e.function[2*r]=e.nodes[r].x,e.function[2*r+1]=e.nodes[r].y}return e.function},t.getFirstNonZeroValue=()=>{if(e.nodes.length===0)return 0;let n=1,r=0,i=0;for(;i<e.nodes.length;i++)if(e.nodes[i].y!==0){n=0;break}return n?r=Number.MAX_VALUE:i>0?r=e.nodes[i-1].x:e.clamping?r=-Number.MAX_VALUE:r=e.nodes[0].x,r},t.getNodeValue=(n,r)=>{const i=e.nodes.length;return n<0||n>=i?(u1("Index out of range!"),-1):(r[0]=e.nodes[n].x,r[1]=e.nodes[n].y,r[2]=e.nodes[n].midpoint,r[3]=e.nodes[n].sharpness,1)},t.setNodeValue=(n,r)=>{const i=e.nodes.length;if(n<0||n>=i)return u1("Index out of range!"),-1;const a=e.nodes[n].x;return e.nodes[n].x=r[0],e.nodes[n].y=r[1],e.nodes[n].midpoint=r[2],e.nodes[n].sharpness=r[3],a!==r[0]?t.sortAndUpdateRange():t.modified(),1},t.addPoint=(n,r)=>t.addPointLong(n,r,.5,0),t.addPointLong=(n,r,i,a)=>{if(i<0||i>1)return u1("Midpoint outside range [0.0, 1.0]"),-1;if(a<0||a>1)return u1("Sharpness outside range [0.0, 1.0]"),-1;e.allowDuplicateScalars||t.removePoint(n);const o={x:n,y:r,midpoint:i,sharpness:a};e.nodes.push(o),t.sortAndUpdateRange();let s;for(s=0;s<e.nodes.length&&e.nodes[s].x!==n;s++);return s<e.nodes.length?s:-1},t.setNodes=n=>{e.nodes!==n&&(e.nodes=n,t.sortAndUpdateRange())},t.sortAndUpdateRange=()=>{e.nodes.sort((r,i)=>r.x-i.x),t.updateRange()||t.modified()},t.updateRange=()=>{const n=e.range.slice(),r=e.nodes.length;return r?(e.range[0]=e.nodes[0].x,e.range[1]=e.nodes[r-1].x):(e.range[0]=0,e.range[1]=0),n[0]===e.range[0]&&n[1]===e.range[1]?!1:(t.modified(),!0)},t.removePoint=n=>{let r;for(r=0;r<e.nodes.length&&e.nodes[r].x!==n;r++);if(r>=e.nodes.length)return-1;const i=r;let a=!1;return e.nodes.splice(r,1),(r===0||r===e.nodes.length)&&(a=t.updateRange()),a||t.modified(),i},t.removeAllPoints=()=>{e.nodes=[],t.sortAndUpdateRange()},t.addSegment=(n,r,i,a)=>{t.sortAndUpdateRange();for(let o=0;o<e.nodes.length;)e.nodes[o].x>=n&&e.nodes[o].x<=i?e.nodes.splice(o,1):o++;t.addPoint(n,r,.5,0),t.addPoint(i,a,.5,0)},t.getValue=n=>{const r=[];return t.getTable(n,n,1,r),r[0]},t.adjustRange=n=>{if(n.length<2)return 0;const r=t.getRange();r[0]<n[0]?t.addPoint(n[0],t.getValue(n[0])):t.addPoint(n[0],t.getValue(r[0])),r[1]>n[1]?t.addPoint(n[1],t.getValue(n[1])):t.addPoint(n[1],t.getValue(r[1])),t.sortAndUpdateRange();for(let i=0;i<e.nodes.length;)e.nodes[i].x>=n[0]&&e.nodes[i].x<=n[1]?e.nodes.splice(i,1):++i;return t.sortAndUpdateRange(),1},t.estimateMinNumberOfSamples=(n,r)=>{const i=t.findMinimumXDistance();return Math.ceil((r-n)/i)},t.findMinimumXDistance=()=>{const n=e.nodes.length;if(n<2)return-1;let r=e.nodes[1].x-e.nodes[0].x;for(let i=0;i<n-1;i++){const a=e.nodes[i+1].x-e.nodes[i].x;a<r&&(r=a)}return r},t.getTable=function(n,r,i,a){let o=arguments.length>4&&arguments[4]!==void 0?arguments[4]:1,s,c=0;const l=e.nodes.length;let f=0;l!==0&&(f=e.nodes[l-1].y);let u=0,g=0,d=0,h=0,p=0,m=0,v=0;for(s=0;s<i;s++){const y=o*s;for(i>1?u=n+s/(i-1)*(r-n):u=.5*(n+r);c<l&&u>e.nodes[c].x;)c++,c<l&&(g=e.nodes[c-1].x,d=e.nodes[c].x,h=e.nodes[c-1].y,p=e.nodes[c].y,m=e.nodes[c-1].midpoint,v=e.nodes[c-1].sharpness,m<1e-5&&(m=1e-5),m>.99999&&(m=.99999));if(c>=l)a[y]=e.clamping?f:0;else if(c===0)a[y]=e.clamping?e.nodes[0].y:0;else{let T=(u-g)/(d-g);if(T<m?T=.5*T/m:T=.5+.5*(T-m)/(1-m),v>.99)if(T<.5){a[y]=h;continue}else{a[y]=p;continue}if(v<.01){a[y]=(1-T)*h+T*p;continue}T<.5?T=.5*(T*2)**(1+10*v):T>.5&&(T=1-.5*((1-T)*2)**(1+10*v));const C=T*T,w=C*T,x=2*w-3*C+1,O=-2*w+3*C,M=w-2*C+T,A=w-C,_=p-h,k=(1-v)*_;a[y]=x*h+O*p+M*k+A*k;const z=h<p?h:p,X=h>p?h:p;a[y]=a[y]<z?z:a[y],a[y]=a[y]>X?X:a[y]}}}}const nj={range:[0,0],clamping:!0,allowDuplicateScalars:!1};function PD(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,nj,n),P.obj(t,e),e.nodes=[],P.setGet(t,e,["allowDuplicateScalars","clamping"]),P.setArray(t,e,["range"],2),P.getArray(t,e,["range"]),tj(t,e)}const rj=P.newInstance(PD,"vtkPiecewiseFunction");var Mu={newInstance:rj,extend:PD};const{BlendMode:qs,FilterMode:$f}=Ax;function ij(t,e,n,r,i){let a=null;return i?(a=i,a.removeAllPoints()):a=Mu.newInstance(),a.addPointLong(-1024,0,1,1),a.addPoint(t,e),a.addPoint(n,r),a}const aj={createRadonTransferFunction:ij};function oj(t,e){e.classHierarchy.push("vtkVolumeMapper");const n={...t};t.getBounds=()=>{const r=t.getInputData();return r?(e.static||t.update(),e.bounds=r.getBounds()):e.bounds=Oc(),e.bounds},t.update=()=>{t.getInputData()},t.setBlendModeToComposite=()=>{t.setBlendMode(qs.COMPOSITE_BLEND)},t.setBlendModeToMaximumIntensity=()=>{t.setBlendMode(qs.MAXIMUM_INTENSITY_BLEND)},t.setBlendModeToMinimumIntensity=()=>{t.setBlendMode(qs.MINIMUM_INTENSITY_BLEND)},t.setBlendModeToAverageIntensity=()=>{t.setBlendMode(qs.AVERAGE_INTENSITY_BLEND)},t.setBlendModeToAdditiveIntensity=()=>{t.setBlendMode(qs.ADDITIVE_INTENSITY_BLEND)},t.setBlendModeToRadonTransform=()=>{t.setBlendMode(qs.RADON_TRANSFORM_BLEND)},t.getBlendModeAsString=()=>P.enumToString(qs,e.blendMode),t.setAverageIPScalarRange=(r,i)=>{console.warn("setAverageIPScalarRange is deprecated use setIpScalarRange"),t.setIpScalarRange(r,i)},t.getFilterModeAsString=()=>P.enumToString($f,e.filterMode),t.setFilterModeToOff=()=>{t.setFilterMode($f.OFF)},t.setFilterModeToNormalized=()=>{t.setFilterMode($f.NORMALIZED)},t.setFilterModeToRaw=()=>{t.setFilterMode($f.RAW)},t.setGlobalIlluminationReach=r=>n.setGlobalIlluminationReach(Ua(r,0,1)),t.setVolumetricScatteringBlending=r=>n.setVolumetricScatteringBlending(Ua(r,0,1)),t.setVolumeShadowSamplingDistFactor=r=>n.setVolumeShadowSamplingDistFactor(r>=1?r:1),t.setAnisotropy=r=>n.setAnisotropy(Ua(r,-.99,.99)),t.setLAOKernelSize=r=>n.setLAOKernelSize(M4(Ua(r,1,32))),t.setLAOKernelRadius=r=>n.setLAOKernelRadius(r>=1?r:1)}const sj={bounds:[1,-1,1,-1,1,-1],sampleDistance:1,imageSampleDistance:1,maximumSamplesPerRay:1e3,autoAdjustSampleDistances:!0,initialInteractionScale:1,interactionSampleDistanceFactor:1,blendMode:qs.COMPOSITE_BLEND,ipScalarRange:[-1e6,1e6],filterMode:$f.OFF,preferSizeOverAccuracy:!1,computeNormalFromOpacity:!1,volumetricScatteringBlending:0,globalIlluminationReach:0,volumeShadowSamplingDistFactor:5,anisotropy:0,localAmbientOcclusion:!1,LAOKernelSize:15,LAOKernelRadius:7};function ND(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,sj,n),ny.extend(t,e,n),P.setGet(t,e,["sampleDistance","imageSampleDistance","maximumSamplesPerRay","autoAdjustSampleDistances","initialInteractionScale","interactionSampleDistanceFactor","blendMode","filterMode","preferSizeOverAccuracy","computeNormalFromOpacity","volumetricScatteringBlending","globalIlluminationReach","volumeShadowSamplingDistFactor","anisotropy","localAmbientOcclusion","LAOKernelSize","LAOKernelRadius"]),P.setGetArray(t,e,["ipScalarRange"],2),P.event(t,e,"lightingActivated"),oj(t,e)}const cj=P.newInstance(ND,"vtkVolumeMapper");var kD={newInstance:cj,extend:ND,...aj};function lj(t,e){e.classHierarchy.push("vtkSharedVolumeMapper");const n=t.delete;t.delete=()=>{e.scalarTexture=null,n()}}const uj={scalarTexture:null};function AD(t,e,n={}){Object.assign(e,uj,n),kD.extend(t,e,n),P.setGet(t,e,["scalarTexture"]),lj(t,e)}const fj=P.newInstance(AD,"vtkSharedVolumeMapper"),gj={newInstance:fj,extend:AD};function gi(t){const e=t.indexOf(":");return t.substring(e+1)}const dj=1073741824;class pj{constructor(){this._imageCache=new Map,this._volumeCache=new Map,this._geometryCache=new Map,this._imageCacheSize=0,this._maxCacheSize=3*dj,this._geometryCacheSize=0,this.setMaxCacheSize=e=>{if(!e||typeof e!="number"){const n=`New max cacheSize ${this._maxCacheSize} should be defined and should be a number.`;throw new Error(n)}this._maxCacheSize=e},this.isCacheable=e=>{const n=this.getBytesAvailable(),r=Array.from(this._imageCache.values()).reduce((a,o)=>o.sharedCacheKey?a:a+o.sizeInBytes,0);return n+r>=e},this.getMaxCacheSize=()=>this._maxCacheSize,this.getCacheSize=()=>this._imageCacheSize,this._decacheImage=(e,n=!1)=>{const r=this._imageCache.get(e);if(!r)return;if(r.sharedCacheKey&&!n)throw new Error("Cannot decache an image with a shared cache key. You need to manually decache the volume first.");const{imageLoadObject:i}=r;i!=null&&i.cancelFn&&i.cancelFn(),i!=null&&i.decache&&i.decache(),this._imageCache.delete(e)},this._decacheVolume=e=>{const n=this._volumeCache.get(e);if(!n)return;const{volumeLoadObject:r,volume:i}=n;i&&(i.cancelLoading&&i.cancelLoading(),i.imageData&&i.imageData.delete(),r.cancelFn&&r.cancelFn(),i.imageIds&&i.imageIds.forEach(a=>{const o=this._imageCache.get(a);o&&o.sharedCacheKey===e&&(o.sharedCacheKey=void 0)}),this._volumeCache.delete(e))},this.purgeCache=()=>{const e=this._imageCache.keys();for(this.purgeVolumeCache();;){const{value:n,done:r}=e.next();if(r)break;this.removeImageLoadObject(n,{force:!0}),De(Ee,Oe.IMAGE_CACHE_IMAGE_REMOVED,{imageId:n})}},this.purgeVolumeCache=()=>{const e=this._volumeCache.keys();for(;;){const{value:n,done:r}=e.next();if(r)break;this.removeVolumeLoadObject(n),De(Ee,Oe.VOLUME_CACHE_VOLUME_REMOVED,{volumeId:n})}},this.getVolumeLoadObject=e=>{if(e===void 0)throw new Error("getVolumeLoadObject: volumeId must not be undefined");const n=this._volumeCache.get(e);if(n)return n.timeStamp=Date.now(),n.volumeLoadObject},this.putGeometryLoadObject=(e,n)=>{if(e===void 0)throw new Error("putGeometryLoadObject: geometryId must not be undefined");if(n.promise===void 0)throw new Error("putGeometryLoadObject: geometryLoadObject.promise must not be undefined");if(this._geometryCache.has(e))throw new Error("putGeometryLoadObject: geometryId already present in geometryCache");if(n.cancelFn&&typeof n.cancelFn!="function")throw new Error("putGeometryLoadObject: geometryLoadObject.cancel must be a function");const r={loaded:!1,geometryId:e,geometryLoadObject:n,timeStamp:Date.now(),sizeInBytes:0};return this._geometryCache.set(e,r),n.promise.then(i=>{try{this._putGeometryCommon(e,i,r)}catch(a){throw console.debug(`Error in _putGeometryCommon for geometry ${e}:`,a),a}}).catch(i=>{throw console.debug(`Error caching geometry ${e}:`,i),this._geometryCache.delete(e),i})},this.getGeometry=e=>{if(e===void 0)throw new Error("getGeometry: geometryId must not be undefined");const n=this._geometryCache.get(e);if(n)return n.timeStamp=Date.now(),n.geometry},this.removeGeometryLoadObject=e=>{if(e===void 0)throw new Error("removeGeometryLoadObject: geometryId must not be undefined");const n=this._geometryCache.get(e);if(!n)throw new Error("removeGeometryLoadObject: geometryId was not present in geometryCache");this.decrementGeometryCacheSize(n.sizeInBytes);const r={geometry:n,geometryId:e};De(Ee,Oe.GEOMETRY_CACHE_GEOMETRY_REMOVED,r),this._decacheGeometry(e)},this._decacheGeometry=e=>{const n=this._geometryCache.get(e);if(!n)return;const{geometryLoadObject:r}=n;r.cancelFn&&r.cancelFn(),r.decache&&r.decache(),this._geometryCache.delete(e)},this.incrementGeometryCacheSize=e=>{this._geometryCacheSize+=e},this.decrementGeometryCacheSize=e=>{this._geometryCacheSize-=e},this.getImage=(e,n=Wi.FAR_REPLICATE)=>{var i;if(e===void 0)throw new Error("getImage: imageId must not be undefined");const r=this._imageCache.get(e);if(r&&(r.timeStamp=Date.now(),!(((i=r.image)==null?void 0:i.imageQualityStatus)<n)))return r.image},this.getVolume=(e,n=!1)=>{var i;if(e===void 0)throw new Error("getVolume: volumeId must not be undefined");const r=this._volumeCache.get(e);return r?(r.timeStamp=Date.now(),r.volume):n?(i=[...this._volumeCache.values()].find(a=>a.volumeId.includes(e)))==null?void 0:i.volume:void 0},this.getVolumes=()=>Array.from(this._volumeCache.values()).map(n=>n.volume),this.filterVolumesByReferenceId=e=>this.getVolumes().filter(r=>r.referencedVolumeId===e),this.removeImageLoadObject=(e,{force:n=!1}={})=>{if(e===void 0)throw new Error("removeImageLoadObject: imageId must not be undefined");const r=this._imageCache.get(e);if(!r)throw new Error("removeImageLoadObject: imageId was not present in imageCache");this._decacheImage(e,n),this.incrementImageCacheSize(-r.sizeInBytes);const i={image:r,imageId:e};De(Ee,Oe.IMAGE_CACHE_IMAGE_REMOVED,i)},this.removeVolumeLoadObject=e=>{if(e===void 0)throw new Error("removeVolumeLoadObject: volumeId must not be undefined");const n=this._volumeCache.get(e);if(!n)throw new Error("removeVolumeLoadObject: volumeId was not present in volumeCache");const r={volume:n,volumeId:e};De(Ee,Oe.VOLUME_CACHE_VOLUME_REMOVED,r),this._decacheVolume(e)},this.incrementImageCacheSize=e=>{this._imageCacheSize+=e},this.decrementImageCacheSize=e=>{this._imageCacheSize-=e},this.getGeometryLoadObject=e=>{if(e===void 0)throw new Error("getGeometryLoadObject: geometryId must not be undefined");const n=this._geometryCache.get(e);if(n)return n.timeStamp=Date.now(),n.geometryLoadObject}}getBytesAvailable(){return this.getMaxCacheSize()-this.getCacheSize()}decacheIfNecessaryUntilBytesAvailable(e,n){let r=this.getBytesAvailable();if(r>=e)return r;const i=Array.from(this._imageCache.values()).filter(c=>!c.sharedCacheKey);function a(c,l){return c.timeStamp>l.timeStamp?1:c.timeStamp<l.timeStamp?-1:0}i.sort(a);const o=i.map(c=>c.imageId);let s=o;n&&(s=o.filter(c=>!n.includes(c)));for(const c of s)if(this.removeImageLoadObject(c),De(Ee,Oe.IMAGE_CACHE_IMAGE_REMOVED,{imageId:c}),r=this.getBytesAvailable(),r>=e)return r;for(const c of o)if(this.removeImageLoadObject(c),De(Ee,Oe.IMAGE_CACHE_IMAGE_REMOVED,{imageId:c}),r=this.getBytesAvailable(),r>=e)return r}_putImageCommon(e,n,r){if(!this._imageCache.has(e)){console.warn("The image was purged from the cache before it completed loading.");return}if(!n){console.warn("Image is undefined");return}if(n.sizeInBytes===void 0||Number.isNaN(n.sizeInBytes))throw new Error("_putImageCommon: image.sizeInBytes must not be undefined");if(n.sizeInBytes.toFixed===void 0)throw new Error("_putImageCommon: image.sizeInBytes is not a number");if(!this.isCacheable(n.sizeInBytes))throw new Error(Oe.CACHE_SIZE_EXCEEDED);this.decacheIfNecessaryUntilBytesAvailable(n.sizeInBytes),r.loaded=!0,r.image=n,r.sizeInBytes=n.sizeInBytes,this.incrementImageCacheSize(r.sizeInBytes);const i={image:r};De(Ee,Oe.IMAGE_CACHE_IMAGE_ADDED,i),r.sharedCacheKey=n.sharedCacheKey}async putImageLoadObject(e,n){if(e===void 0)throw console.error("putImageLoadObject: imageId must not be undefined"),new Error("putImageLoadObject: imageId must not be undefined");if(n.promise===void 0)throw console.error("putImageLoadObject: imageLoadObject.promise must not be undefined"),new Error("putImageLoadObject: imageLoadObject.promise must not be undefined");const r=this._imageCache.get(e);if(r!=null&&r.imageLoadObject)throw console.warn(`putImageLoadObject: imageId ${e} already in cache`),new Error("putImageLoadObject: imageId already in cache");if(n.cancelFn&&typeof n.cancelFn!="function")throw console.error("putImageLoadObject: imageLoadObject.cancel must be a function"),new Error("putImageLoadObject: imageLoadObject.cancel must be a function");const i={...r,loaded:!1,imageId:e,sharedCacheKey:void 0,imageLoadObject:n,timeStamp:Date.now(),sizeInBytes:0};return this._imageCache.set(e,i),this._imageCache.set(e,i),n.promise.then(a=>{try{this._putImageCommon(e,a,i)}catch(o){throw console.debug(`Error in _putImageCommon for image ${e}:`,o),o}}).catch(a=>{throw console.debug(`Error caching image ${e}:`,a),this._imageCache.delete(e),a})}putImageSync(e,n){if(e===void 0)throw new Error("putImageSync: imageId must not be undefined");if(this._imageCache.has(e))throw new Error("putImageSync: imageId already in cache");const r={loaded:!1,imageId:e,sharedCacheKey:void 0,imageLoadObject:{promise:Promise.resolve(n)},timeStamp:Date.now(),sizeInBytes:0};this._imageCache.set(e,r);try{this._putImageCommon(e,n,r)}catch(i){throw this._imageCache.delete(e),i}}getImageLoadObject(e){if(e===void 0)throw new Error("getImageLoadObject: imageId must not be undefined");const n=this._imageCache.get(e);if(n)return n.timeStamp=Date.now(),n.imageLoadObject}isLoaded(e){const n=this._imageCache.get(e);return n?n.loaded:!1}getVolumeContainingImageId(e){const n=Array.from(this._volumeCache.keys()),r=gi(e);for(const i of n){const a=this._volumeCache.get(i);if(!a)return;const{volume:o}=a;if(!o.imageIds.length)return;const s=o.getImageURIIndex(r);if(s>-1)return{volume:o,imageIdIndex:s}}}getCachedImageBasedOnImageURI(e){const n=gi(e),i=Array.from(this._imageCache.keys()).find(a=>gi(a)===n);if(i)return this._imageCache.get(i)}_putVolumeCommon(e,n,r){var a;if(!this._volumeCache.get(e)){console.warn("The volume was purged from the cache before it completed loading.");return}r.loaded=!0,r.volume=n,(a=n.imageIds)==null||a.forEach(o=>{const s=this._imageCache.get(o);s&&(s.sharedCacheKey=e)});const i={volume:r};De(Ee,Oe.VOLUME_CACHE_VOLUME_ADDED,i)}putVolumeSync(e,n){if(e===void 0)throw new Error("putVolumeSync: volumeId must not be undefined");if(this._volumeCache.has(e))throw new Error("putVolumeSync: volumeId already in cache");const r={loaded:!1,volumeId:e,volumeLoadObject:{promise:Promise.resolve(n)},timeStamp:Date.now(),sizeInBytes:0};this._volumeCache.set(e,r);try{this._putVolumeCommon(e,n,r)}catch(i){throw this._volumeCache.delete(e),i}}async putVolumeLoadObject(e,n){if(e===void 0)throw new Error("putVolumeLoadObject: volumeId must not be undefined");if(n.promise===void 0)throw new Error("putVolumeLoadObject: volumeLoadObject.promise must not be undefined");if(this._volumeCache.has(e))throw new Error(`putVolumeLoadObject: volumeId:${e} already in cache`);if(n.cancelFn&&typeof n.cancelFn!="function")throw new Error("putVolumeLoadObject: volumeLoadObject.cancel must be a function");const r={loaded:!1,volumeId:e,volumeLoadObject:n,timeStamp:Date.now(),sizeInBytes:0};return this._volumeCache.set(e,r),n.promise.then(i=>{try{this._putVolumeCommon(e,i,r)}catch(a){throw console.error(`Error in _putVolumeCommon for volume ${e}:`,a),this._volumeCache.delete(e),a}}).catch(i=>{throw this._volumeCache.delete(e),i})}_putGeometryCommon(e,n,r){if(!this._geometryCache.get(e)){console.warn("The geometry was purged from the cache before it completed loading.");return}if(!n){console.warn("Geometry is undefined");return}if(n.sizeInBytes===void 0||Number.isNaN(n.sizeInBytes))throw new Error("_putGeometryCommon: geometry.sizeInBytes must not be undefined");if(n.sizeInBytes.toFixed===void 0)throw new Error("_putGeometryCommon: geometry.sizeInBytes is not a number");if(!this.isCacheable(n.sizeInBytes))throw new Error(Oe.CACHE_SIZE_EXCEEDED);this.decacheIfNecessaryUntilBytesAvailable(n.sizeInBytes),r.loaded=!0,r.geometry=n,r.sizeInBytes=n.sizeInBytes,this.incrementGeometryCacheSize(r.sizeInBytes);const i={geometry:r};De(Ee,Oe.GEOMETRY_CACHE_GEOMETRY_ADDED,i)}putGeometrySync(e,n){if(e===void 0)throw new Error("putGeometrySync: geometryId must not be undefined");if(this._geometryCache.has(e))throw new Error("putGeometrySync: geometryId already in cache");const r={loaded:!1,geometryId:e,geometryLoadObject:{promise:Promise.resolve(n)},timeStamp:Date.now(),sizeInBytes:0};this._geometryCache.set(e,r);try{this._putGeometryCommon(e,n,r)}catch(i){throw this._geometryCache.delete(e),i}}setPartialImage(e,n){const r=this._imageCache.get(e);if(!r){n&&this._imageCache.set(e,{image:n,imageId:e,loaded:!1,timeStamp:Date.now(),sizeInBytes:0});return}r.loaded&&(r.loaded=!1,r.imageLoadObject=null,this.incrementImageCacheSize(-r.sizeInBytes),r.sizeInBytes=0),r.image=n||r.image}getImageQuality(e){var r;const n=(r=this._imageCache.get(e))==null?void 0:r.image;return n?n.imageQualityStatus||Wi.FULL_RESOLUTION:void 0}}const Me=new pj;function z9(t,e){const n=sy(e),r=new n(t.length);return r.set(t),r}function hj(t,e){e.classHierarchy.push("vtkStreamingOpenGLTexture"),e.updatedFrames=[],e.volumeId=null;const n=t.create3DFilterableFromRaw;t.create3DFilterableFromRaw=(s,c,l,f,u,g,d)=>{e.inputDataType=u,e.inputNumComps=f,n(s,c,l,f,u,g,d)};const r=t.updateVolumeInfoForGL;t.updateVolumeInfoForGL=(s,c)=>{const l=r(s,c);return e.volumeInfo.dataComputedScale=[1],e.volumeInfo.dataComputedOffset=[0],l},t.update3DFromRaw=()=>{const{volumeId:s}=e;if(!s)return;const c=Me.getVolume(s);if(e._openGLRenderWindow.activateTexture(t),t.createTexture(),t.bind(),c.isDynamicVolume()){o();return}return t.hasUpdatedFrames()&&a()};const i=t.modified;t.setUpdatedFrame=s=>{e.updatedFrames[s]=!0,i()},t.modified=()=>{i();const s=Me.getVolume(e.volumeId);if(!s)return;const c=s.imageIds;for(let l=0;l<c.length;l++)e.updatedFrames[l]=!0};function a(){const s=Me.getVolume(e.volumeId),c=s.imageIds;for(let l=0;l<e.updatedFrames.length;l++)if(e.updatedFrames[l]){const f=Me.getImage(c[l]);if(!f)continue;let u=f.voxelManager.getScalarData();const g=e.context;s.dataType!==u.constructor.name&&(u=z9(u,s.dataType));const[d]=t.updateArrayDataTypeForGL(s.dataType,[u]);t.bind();const h=l;g.texSubImage3D(e.target,0,0,0,h,e.width,e.height,1,e.format,e.openGLDataType,d),t.deactivate(),e.updatedFrames[l]=null}return e.generateMipmap&&e.context.generateMipmap(e.target),t.deactivate(),!0}function o(){const s=Me.getVolume(e.volumeId),c=s.getCurrentDimensionGroupImageIds();if(!c.length)return!1;let l;for(let f=0;f<c.length;f++){const u=c[f],g=Me.getImage(u);let d;g?(d=g.voxelManager.getScalarData(),l=d.constructor):(l=sy(s.dataType,!0),d=new l(e.width*e.height));const h=e.context;s.dataType!==d.constructor.name&&(d=z9(d,s.dataType));const[p]=t.updateArrayDataTypeForGL(s.dataType,[d]);t.bind();let m=f;h.texSubImage3D(e.target,0,0,0,m,e.width,e.height,1,e.format,e.openGLDataType,p),t.deactivate()}return e.generateMipmap&&e.context.generateMipmap(e.target),t.deactivate(),!0}t.hasUpdatedFrames=()=>!e.updatedFrames.length||e.updatedFrames.some(s=>s),t.getUpdatedFrames=()=>e.updatedFrames,t.setVolumeId=s=>{e.volumeId=s},t.getVolumeId=()=>e.volumeId,t.setTextureParameters=({width:s,height:c,depth:l,numberOfComponents:f,dataType:u})=>{e.width??(e.width=s),e.height??(e.height=c),e.depth??(e.depth=l),e.inputNumComps??(e.inputNumComps=f),e.inputDataType??(e.inputDataType=u)},t.getTextureParameters=()=>({width:e.width,height:e.height,depth:e.depth,numberOfComponents:e.inputNumComps,dataType:e.inputDataType})}const mj={updatedFrames:[]};function FD(t,e,n={}){Object.assign(e,mj,n),Xt.extend(t,e,n),hj(t,e)}const vj=P.newInstance(FD,"vtkStreamingOpenGLTexture"),yj={newInstance:vj,extend:FD},Tj={isPerformingCoordinateTransformation:!1};function UD(t,e,n={}){Object.assign(e,Tj,n),dy.extend(t,e,n),P.setGet(t,e,["isPerformingCoordinateTransformation"]),wj(t,e)}const Cj=P.newInstance(UD,"vtkSlabCamera");function wj(t,e){e.classHierarchy.push("vtkSlabCamera");const n=Be(new Float64Array(16)),r=new Float64Array(3);t.getProjectionMatrix=(i,a,o)=>{const s=Lc();if(e.projectionMatrix){const g=1/e.physicalScale;return bt(r,g,g,g),nn(s,e.projectionMatrix),ms(s,s,r),ft(s,s),s}Be(n);let c=e.clippingRange[0],l=e.clippingRange[1];e.isPerformingCoordinateTransformation&&(c=e.distance,l=e.distance+.1);const f=l-c,u=[c+(a+1)*f/2,c+(o+1)*f/2];if(e.parallelProjection){const g=e.parallelScale*i,d=e.parallelScale,h=(e.windowCenter[0]-1)*g,p=(e.windowCenter[0]+1)*g,m=(e.windowCenter[1]-1)*d,v=(e.windowCenter[1]+1)*d;G4(n,h,p,m,v,u[0],u[1]),ft(n,n)}else{if(e.useOffAxisProjection)throw new Error("Off-Axis projection is not supported at this time");{const g=Math.tan(fa.radiansFromDegrees(e.viewAngle)/2);let d,h;e.useHorizontalViewAngle===!0?(d=c*g,h=c*g/i):(d=c*g*i,h=c*g);const p=(e.windowCenter[0]-1)*d,m=(e.windowCenter[0]+1)*d,v=(e.windowCenter[1]-1)*h,y=(e.windowCenter[1]+1)*h,T=u[0],C=u[1];n[0]=2*T/(m-p),n[5]=2*T/(y-v),n[2]=(p+m)/(m-p),n[6]=(v+y)/(y-v),n[10]=-(T+C)/(C-T),n[14]=-1,n[11]=-2*T*C/(C-T),n[15]=0}}return nn(s,n),s}}const xj={newInstance:Cj,extend:UD};function co(t){return Vi(t,"vtkVolume")||Vi(t,"vtkImageSlice")}function Vi(t,e){const n="isA"in t?t:t.actor;return n?!!n.isA(e):!1}const fo=[];function Qu(t,e=0){let n;for(n=0;n<fo.length&&!(fo[n].priority<=e);n++);fo.splice(n,0,{priority:e,provider:t})}function Sj(t){for(let e=0;e<fo.length;e++)if(fo[e].provider===t){fo.splice(e,1);break}}function Ej(){for(;fo.length>0;)fo.pop()}function Ve(t,...e){for(let n=0;n<fo.length;n++){const r=fo[n].provider(t,...e);if(r!==void 0)return r}}const Oj=Object.freeze(Object.defineProperty({__proto__:null,addProvider:Qu,get:Ve,removeAllProviders:Ej,removeProvider:Sj},Symbol.toStringTag,{value:"Module"}));function Td(t,e){const{direction:n,spacing:r}=t,i=n.slice(0,3),a=n.slice(3,6),o=n.slice(6,9),s=[Qe(i,e),Qe(a,e),Qe(o,e)],c=Le();return bt(c,s[0]*r[0],s[1]*r[1],s[2]*r[2]),Cc(c)}function Wg(t,e,n){const{direction:r,spacing:i,imageIds:a}=t;if(!a.length)return;const o=r.slice(6,9),s=Qe(o,n);if(Math.abs(s)<1-mo)return;const l=Td({direction:r,spacing:i},n)/2;let f;for(let u=0;u<a.length;u++){const g=a[u],{imagePositionPatient:d}=Ve("imagePlaneModule",g),h=Le();_n(h,e,d);const p=Qe(h,n);Math.abs(p)<l&&(f=g)}return f}const Dj=t=>t,j9=1e-6;let BD=class{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1;this.matrix=Be(new Float64Array(16)),this.tmp=new Float64Array(3),this.angleConv=e?fA:Dj}rotateFromDirections(e,n){const r=new Float64Array(3),i=new Float64Array(3),a=new Float64Array(16);bt(r,e[0],e[1],e[2]),bt(i,n[0],n[1],n[2]),wn(r,r),wn(i,i);const o=Qe(r,i);return o>=1?this:(an(this.tmp,r,i),Cc(this.tmp)<j9&&(an(this.tmp,[1,0,0],e),Cc(this.tmp)<j9&&an(this.tmp,[0,1,0],e)),B4(a,Math.acos(o),this.tmp),vt(this.matrix,this.matrix,a),this)}rotate(e,n){return bt(this.tmp,...n),wn(this.tmp,this.tmp),Ma(this.matrix,this.matrix,this.angleConv(e),this.tmp),this}rotateX(e){return k4(this.matrix,this.matrix,this.angleConv(e)),this}rotateY(e){return A4(this.matrix,this.matrix,this.angleConv(e)),this}rotateZ(e){return F4(this.matrix,this.matrix,this.angleConv(e)),this}translate(e,n,r){return bt(this.tmp,e,n,r),en(this.matrix,this.matrix,this.tmp),this}scale(e,n,r){return bt(this.tmp,e,n,r),ms(this.matrix,this.matrix,this.tmp),this}multiply(e){return vt(this.matrix,this.matrix,e),this}multiply3x3(e){return vt(this.matrix,this.matrix,[e[0],e[1],e[2],0,e[3],e[4],e[5],0,e[6],e[7],e[8],0,0,0,0,1]),this}invert(){return Ln(this.matrix,this.matrix),this}identity(){return Be(this.matrix),this}apply(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:-1;if(pd(O4,this.matrix))return this;const i=r===-1?e.length:n+r*3;for(let a=n;a<i;a+=3)bt(this.tmp,e[a],e[a+1],e[a+2]),pt(this.tmp,this.tmp,this.matrix),e[a]=this.tmp[0],e[a+1]=this.tmp[1],e[a+2]=this.tmp[2];return this}getMatrix(){return this.matrix}setMatrix(e){return e&&e.length===16&&nn(this.matrix,e),this}};function Rj(){return new BD(!0)}function Mj(){return new BD(!1)}var N0={buildFromDegree:Rj,buildFromRadian:Mj};function GD(t){const e=t.getMapper().getInputData(),n=e.extentToBounds(e.getExtent());return[[n[0],n[2],n[4]],[n[0],n[2],n[5]],[n[0],n[3],n[4]],[n[0],n[3],n[5]],[n[1],n[2],n[4]],[n[1],n[2],n[5]],[n[1],n[3],n[4]],[n[1],n[3],n[5]]]}const _j=mo*mo,A5=t=>Math.abs(Math.abs(t)-1)<_j,F5=(t,e)=>A5(t[e])||A5(t[e+1])||A5(t[e+2]),bj=t=>F5(t,0)&&F5(t,3)&&F5(t,6);function E2(t,e,n){const r=t.getMapper().getInputData();let i;const a=r.getDirection();if(bj(a))i=GD(t);else{const[u,g,d]=r.getDimensions();i=[[0,0,0],[u-1,0,0],[0,g-1,0],[u-1,g-1,0],[0,0,d-1],[u-1,0,d-1],[0,g-1,d-1],[u-1,g-1,d-1]].map(p=>r.indexToWorld(p))}const o=N0.buildFromDegree().identity().rotateFromDirections(e,[1,0,0]);i.forEach(u=>o.apply(u));const s=[...n];o.apply(s);const c=s[0];let l=1/0,f=-1/0;for(let u=0;u<8;u++){const g=i[u][0];g>f&&(f=g),g<l&&(l=g)}return{min:l,max:f,current:c,actor:t,viewPlaneNormal:e,focalPoint:n}}function ou(t,e,n,r,i,a){const{min:o,max:s,current:c}=n,l=Le();_n(l,e,t);const f=Math.round((s-o)/i),g=(c-o)/(s-o)*f;let d=Math.round(g),h=[t[0]-r[0]*g*i,t[1]-r[1]*g*i,t[2]-r[2]*g*i];d+=a,d>f?d=f:d<0&&(d=0);const p=d*i;h=[h[0]+r[0]*p,h[1]+r[1]*p,h[2]+r[2]*p];const m=[h[0]+l[0],h[1]+l[1],h[2]+l[2]];return{newFocalPoint:h,newPosition:m}}const Lj={RGB:0,HSV:1,LAB:2,DIVERGING:3},Ij={LINEAR:0,LOG10:1};var $D={ColorSpace:Lj,Scale:Ij};const{ColorSpace:oa,Scale:vy}=$D,{ScalarMappingTarget:f1}=T2,{vtkDebugMacro:Vj,vtkErrorMacro:Wo,vtkWarningMacro:Pj}=P;function H9(t,e){const n=t[0],r=t[1],i=t[2],a=Math.sqrt(n*n+r*r+i*i),o=a>.001?Math.acos(n/a):0,s=o>.001?Math.atan2(i,r):0;e[0]=a,e[1]=o,e[2]=s}function Nj(t,e){const n=t[0],r=t[1],i=t[2];e[0]=n*Math.cos(r),e[1]=n*Math.sin(r)*Math.cos(i),e[2]=n*Math.sin(r)*Math.sin(i)}function K9(t,e){if(t[0]>=e-.1)return t[2];const n=t[1]*Math.sqrt(e*e-t[0]*t[0])/(t[0]*Math.sin(t[1]));return t[2]>-.3*Math.PI?t[2]+n:t[2]-n}function kj(t,e){let n=t-e;for(n<0&&(n=-n);n>=2*Math.PI;)n-=2*Math.PI;return n>Math.PI&&(n=2*Math.PI-n),n}function q9(t,e,n,r){const i=[],a=[];I0(e,i),I0(n,a);const o=[],s=[];H9(i,o),H9(a,s);let c=t;if(o[1]>.05&&s[1]>.05&&kj(o[2],s[2])>.33*Math.PI){let u=Math.max(o[0],s[0]);u=Math.max(88,u),t<.5?(s[0]=u,s[1]=0,s[2]=0,c*=2):(o[0]=u,o[1]=0,o[2]=0,c=2*c-1)}o[1]<.05&&s[1]>.05?o[2]=K9(s,o[0]):s[1]<.05&&o[1]>.05&&(s[2]=K9(o,s[0]));const l=[];l[0]=(1-c)*o[0]+c*s[0],l[1]=(1-c)*o[1]+c*s[1],l[2]=(1-c)*o[2]+c*s[2];const f=[];Nj(l,f),nh(f,r)}function Aj(t,e){e.classHierarchy.push("vtkColorTransferFunction"),t.getSize=()=>e.nodes.length,t.addRGBPoint=(n,r,i,a)=>t.addRGBPointLong(n,r,i,a,.5,0),t.addRGBPointLong=function(n,r,i,a){let o=arguments.length>4&&arguments[4]!==void 0?arguments[4]:.5,s=arguments.length>5&&arguments[5]!==void 0?arguments[5]:0;if(o<0||o>1)return Wo("Midpoint outside range [0.0, 1.0]"),-1;if(s<0||s>1)return Wo("Sharpness outside range [0.0, 1.0]"),-1;e.allowDuplicateScalars||t.removePoint(n);const c={x:n,r,g:i,b:a,midpoint:o,sharpness:s};e.nodes.push(c),t.sortAndUpdateRange();let l=0;for(;l<e.nodes.length&&e.nodes[l].x!==n;l++);return l<e.nodes.length?l:-1},t.addHSVPoint=(n,r,i,a)=>t.addHSVPointLong(n,r,i,a,.5,0),t.addHSVPointLong=function(n,r,i,a){let o=arguments.length>4&&arguments[4]!==void 0?arguments[4]:.5,s=arguments.length>5&&arguments[5]!==void 0?arguments[5]:0;const c=[];return O0([r,i,a],c),t.addRGBPoint(n,c[0],c[1],c[2],o,s)},t.setNodes=n=>{if(e.nodes!==n){const r=JSON.stringify(e.nodes);e.nodes=n;const i=JSON.stringify(e.nodes);if(t.sortAndUpdateRange()||r!==i)return t.modified(),!0}return!1},t.sortAndUpdateRange=()=>{const n=JSON.stringify(e.nodes);e.nodes.sort((a,o)=>a.x-o.x);const r=JSON.stringify(e.nodes),i=t.updateRange();return!i&&n!==r?(t.modified(),!0):i},t.updateRange=()=>{const n=[2];n[0]=e.mappingRange[0],n[1]=e.mappingRange[1];const r=e.nodes.length;return r?(e.mappingRange[0]=e.nodes[0].x,e.mappingRange[1]=e.nodes[r-1].x):(e.mappingRange[0]=0,e.mappingRange[1]=0),n[0]===e.mappingRange[0]&&n[1]===e.mappingRange[1]?!1:(t.modified(),!0)},t.removePoint=n=>{let r=0;for(;r<e.nodes.length&&e.nodes[r].x!==n;r++);const i=r;if(r>=e.nodes.length)return-1;let a=!1;return e.nodes.splice(r,1),(r===0||r===e.nodes.length)&&(a=t.updateRange()),a||t.modified(),i},t.movePoint=(n,r)=>{if(n!==r){t.removePoint(r);for(let i=0;i<e.nodes.length;i++)if(e.nodes[i].x===n){e.nodes[i].x=r,t.sortAndUpdateRange();break}}},t.removeAllPoints=()=>{e.nodes=[],t.sortAndUpdateRange()},t.addRGBSegment=(n,r,i,a,o,s,c,l)=>{t.sortAndUpdateRange();for(let f=0;f<e.nodes.length;)e.nodes[f].x>=n&&e.nodes[f].x<=o?e.nodes.splice(f,1):f++;t.addRGBPointLong(n,r,i,a,.5,0),t.addRGBPointLong(o,s,c,l,.5,0),t.modified()},t.addHSVSegment=(n,r,i,a,o,s,c,l)=>{const f=[r,i,a],u=[s,c,l],g=[],d=[];O0(f,g),O0(u,d),t.addRGBSegment(n,g[0],g[1],g[2],o,d[0],d[1],d[2])},t.mapValue=n=>{const r=[];return t.getColor(n,r),[Math.floor(255*r[0]+.5),Math.floor(255*r[1]+.5),Math.floor(255*r[2]+.5),255]},t.getColor=(n,r)=>{if(e.indexedLookup){const i=t.getSize(),a=t.getAnnotatedValueIndexInternal(n);if(a<0||i===0){const o=t.getNanColorByReference();r[0]=o[0],r[1]=o[1],r[2]=o[2]}else{const o=[];t.getNodeValue(a%i,o),r[0]=o[1],r[1]=o[2],r[2]=o[3]}return}t.getTable(n,n,1,r)},t.getRedValue=n=>{const r=[];return t.getColor(n,r),r[0]},t.getGreenValue=n=>{const r=[];return t.getColor(n,r),r[1]},t.getBlueValue=n=>{const r=[];return t.getColor(n,r),r[2]},t.getTable=(n,r,i,a)=>{const o=Number(n),s=Number(r);if(rh(o)||rh(s)){for(let A=0;A<i;A++)a[A*3+0]=e.nanColor[0],a[A*3+1]=e.nanColor[1],a[A*3+2]=e.nanColor[2];return}let c=0;const l=e.nodes.length;let f=0,u=0,g=0;l!==0&&(f=e.nodes[l-1].r,u=e.nodes[l-1].g,g=e.nodes[l-1].b);let d=0,h=0,p=0;const m=[0,0,0],v=[0,0,0];let y=0,T=0;const C=[];let w=e.scale===vy.LOG10;w&&(w=e.mappingRange[0]>0);let x=0,O=0,M=0;w&&(x=Math.log10(o),O=Math.log10(s));for(let A=0;A<i;A++){const _=3*A;if(i>1?w?(M=x+A/(i-1)*(O-x),d=10**M):d=o+A/(i-1)*(s-o):w?(M=.5*(x+O),d=10**M):d=.5*(o+s),e.discretize){const k=e.mappingRange;if(d>=k[0]&&d<=k[1]){const z=e.numberOfValues,X=k[1]-k[0];if(z<=1)d=k[0]+X/2;else{const Z=(d-k[0])/X,ce=M4(z*Z);d=k[0]+ce/(z-1)*X}}}for(;c<l&&d>e.nodes[c].x;)c++,c<l&&(h=e.nodes[c-1].x,p=e.nodes[c].x,w&&(h=Math.log10(h),p=Math.log10(p)),m[0]=e.nodes[c-1].r,v[0]=e.nodes[c].r,m[1]=e.nodes[c-1].g,v[1]=e.nodes[c].g,m[2]=e.nodes[c-1].b,v[2]=e.nodes[c].b,y=e.nodes[c-1].midpoint,T=e.nodes[c-1].sharpness,y<1e-5&&(y=1e-5),y>.99999&&(y=.99999));if(d>e.mappingRange[1])a[_]=0,a[_+1]=0,a[_+2]=0,e.clamping&&(t.getUseAboveRangeColor()?(a[_]=e.aboveRangeColor[0],a[_+1]=e.aboveRangeColor[1],a[_+2]=e.aboveRangeColor[2]):(a[_]=f,a[_+1]=u,a[_+2]=g));else if(d<e.mappingRange[0]||jS(d)&&d<0)a[_]=0,a[_+1]=0,a[_+2]=0,e.clamping&&(t.getUseBelowRangeColor()?(a[_]=e.belowRangeColor[0],a[_+1]=e.belowRangeColor[1],a[_+2]=e.belowRangeColor[2]):l>0&&(a[_]=e.nodes[0].r,a[_+1]=e.nodes[0].g,a[_+2]=e.nodes[0].b));else if(c===0&&(Math.abs(d-o)<1e-6||e.discretize))l>0?(a[_]=e.nodes[0].r,a[_+1]=e.nodes[0].g,a[_+2]=e.nodes[0].b):(a[_]=0,a[_+1]=0,a[_+2]=0);else{let k=0;if(w?k=(M-h)/(p-h):k=(d-h)/(p-h),k<y?k=.5*k/y:k=.5+.5*(k-y)/(1-y),T>.99)if(k<.5){a[_]=m[0],a[_+1]=m[1],a[_+2]=m[2];continue}else{a[_]=v[0],a[_+1]=v[1],a[_+2]=v[2];continue}if(T<.01){if(e.colorSpace===oa.RGB)a[_]=(1-k)*m[0]+k*v[0],a[_+1]=(1-k)*m[1]+k*v[1],a[_+2]=(1-k)*m[2]+k*v[2];else if(e.colorSpace===oa.HSV){const j=[],ie=[];Af(m,j),Af(v,ie),e.hSVWrap&&(j[0]-ie[0]>.5||ie[0]-j[0]>.5)&&(j[0]>ie[0]?j[0]-=1:ie[0]-=1);const ue=[];ue[0]=(1-k)*j[0]+k*ie[0],ue[0]<0&&(ue[0]+=1),ue[1]=(1-k)*j[1]+k*ie[1],ue[2]=(1-k)*j[2]+k*ie[2],O0(ue,C),a[_]=C[0],a[_+1]=C[1],a[_+2]=C[2]}else if(e.colorSpace===oa.LAB){const j=[],ie=[];I0(m,j),I0(v,ie);const ue=[];ue[0]=(1-k)*j[0]+k*ie[0],ue[1]=(1-k)*j[1]+k*ie[1],ue[2]=(1-k)*j[2]+k*ie[2],nh(ue,C),a[_]=C[0],a[_+1]=C[1],a[_+2]=C[2]}else e.colorSpace===oa.DIVERGING?(q9(k,m,v,C),a[_]=C[0],a[_+1]=C[1],a[_+2]=C[2]):Wo("ColorSpace set to invalid value.",e.colorSpace);continue}k<.5?k=.5*(k*2)**(1+10*T):k>.5&&(k=1-.5*((1-k)*2)**(1+10*T));const z=k*k,X=z*k,Z=2*X-3*z+1,ce=-2*X+3*z,J=X-2*z+k,de=X-z;let Q,q;if(e.colorSpace===oa.RGB)for(let j=0;j<3;j++)Q=v[j]-m[j],q=(1-T)*Q,a[_+j]=Z*m[j]+ce*v[j]+J*q+de*q;else if(e.colorSpace===oa.HSV){const j=[],ie=[];Af(m,j),Af(v,ie),e.hSVWrap&&(j[0]-ie[0]>.5||ie[0]-j[0]>.5)&&(j[0]>ie[0]?j[0]-=1:ie[0]-=1);const ue=[];for(let le=0;le<3;le++)Q=ie[le]-j[le],q=(1-T)*Q,ue[le]=Z*j[le]+ce*ie[le]+J*q+de*q,le===0&&ue[le]<0&&(ue[le]+=1);O0(ue,C),a[_]=C[0],a[_+1]=C[1],a[_+2]=C[2]}else if(e.colorSpace===oa.LAB){const j=[],ie=[];I0(m,j),I0(v,ie);const ue=[];for(let le=0;le<3;le++)Q=ie[le]-j[le],q=(1-T)*Q,ue[le]=Z*j[le]+ce*ie[le]+J*q+de*q;nh(ue,C),a[_]=C[0],a[_+1]=C[1],a[_+2]=C[2]}else e.colorSpace===oa.DIVERGING?(q9(k,m,v,C),a[_]=C[0],a[_+1]=C[1],a[_+2]=C[2]):Wo("ColorSpace set to invalid value.");for(let j=0;j<3;j++)a[_+j]=a[_+j]<0?0:a[_+j],a[_+j]=a[_+j]>1?1:a[_+j]}}},t.getUint8Table=function(n,r,i){let a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;if(t.getMTime()<=e.buildTime&&e.tableSize===i&&e.tableWithAlpha!==a)return e.table;if(e.nodes.length===0)return Wo("Attempting to lookup a value with no points in the function"),e.table;const o=a?4:3;(e.tableSize!==i||e.tableWithAlpha!==a)&&(e.table=new Uint8Array(i*o),e.tableSize=i,e.tableWithAlpha=a);const s=[];t.getTable(n,r,i,s);for(let c=0;c<i;c++)e.table[c*o+0]=Math.floor(s[c*3+0]*255+.5),e.table[c*o+1]=Math.floor(s[c*3+1]*255+.5),e.table[c*o+2]=Math.floor(s[c*3+2]*255+.5),a&&(e.table[c*o+3]=255);return e.buildTime.modified(),e.table},t.buildFunctionFromArray=n=>{t.removeAllPoints();const r=n.getNumberOfComponents();for(let i=0;i<n.getNumberOfTuples();i++)switch(r){case 3:{e.nodes.push({x:i,r:n.getComponent(i,0),g:n.getComponent(i,1),b:n.getComponent(i,2),midpoint:.5,sharpness:0});break}case 4:{e.nodes.push({x:n.getComponent(i,0),r:n.getComponent(i,1),g:n.getComponent(i,2),b:n.getComponent(i,3),midpoint:.5,sharpness:0});break}case 5:{e.nodes.push({x:i,r:n.getComponent(i,0),g:n.getComponent(i,1),b:n.getComponent(i,2),midpoint:n.getComponent(i,4),sharpness:n.getComponent(i,5)});break}case 6:{e.nodes.push({x:n.getComponent(i,0),r:n.getComponent(i,1),g:n.getComponent(i,2),b:n.getComponent(i,3),midpoint:n.getComponent(i,4),sharpness:n.getComponent(i,5)});break}}t.sortAndUpdateRange()},t.buildFunctionFromTable=(n,r,i,a)=>{let o=0;t.removeAllPoints(),i>1&&(o=(r-n)/(i-1));for(let s=0;s<i;s++){const c={x:n+o*s,r:a[s*3],g:a[s*3+1],b:a[s*3+2],sharpness:0,midpoint:.5};e.nodes.push(c)}t.sortAndUpdateRange()},t.getNodeValue=(n,r)=>n<0||n>=e.nodes.length?(Wo("Index out of range!"),-1):(r[0]=e.nodes[n].x,r[1]=e.nodes[n].r,r[2]=e.nodes[n].g,r[3]=e.nodes[n].b,r[4]=e.nodes[n].midpoint,r[5]=e.nodes[n].sharpness,1),t.setNodeValue=(n,r)=>{if(n<0||n>=e.nodes.length)return Wo("Index out of range!"),-1;const i=e.nodes[n].x;return e.nodes[n].x=r[0],e.nodes[n].r=r[1],e.nodes[n].g=r[2],e.nodes[n].b=r[3],e.nodes[n].midpoint=r[4],e.nodes[n].sharpness=r[5],i!==r[0]?t.sortAndUpdateRange():t.modified(),1},t.getNumberOfAvailableColors=()=>{var r;if(e.indexedLookup&&t.getSize())return t.getSize();if(e.tableSize)return e.tableSize;const n=((r=e.nodes)==null?void 0:r.length)??0;return Math.max(4094,n)},t.getIndexedColor=(n,r)=>{const i=t.getSize();if(i>0&&n>=0){const o=[];t.getNodeValue(n%i,o);for(let s=0;s<3;++s)r[s]=o[s+1];r[3]=1;return}const a=t.getNanColorByReference();r[0]=a[0],r[1]=a[1],r[2]=a[2],r[3]=1},t.fillFromDataPointer=(n,r)=>{if(!(n<=0||!r)){t.removeAllPoints();for(let i=0;i<n;i++)t.addRGBPoint(r[i*4],r[i*4+1],r[i*4+2],r[i*4+3])}},t.setMappingRange=(n,r)=>{const i=[n,r],a=t.getRange();if(a[1]===i[1]&&a[0]===i[0])return;if(i[1]===i[0]){Wo("attempt to set zero width color range");return}const o=(i[1]-i[0])/(a[1]-a[0]),s=i[0]-a[0]*o;for(let c=0;c<e.nodes.length;++c)e.nodes[c].x=e.nodes[c].x*o+s;e.mappingRange[0]=i[0],e.mappingRange[1]=i[1],t.modified()},t.adjustRange=n=>{const r=t.getRange(),i=[];r[0]<n[0]?(t.getColor(n[0],i),t.addRGBPoint(n[0],i[0],i[1],i[2])):(t.getColor(r[0],i),t.addRGBPoint(n[0],i[0],i[1],i[2])),r[1]>n[1]?(t.getColor(n[1],i),t.addRGBPoint(n[1],i[0],i[1],i[2])):(t.getColor(r[1],i),t.addRGBPoint(n[1],i[0],i[1],i[2])),t.sortAndUpdateRange();for(let a=0;a<e.nodes.length;)e.nodes[a].x>=n[0]&&e.nodes[a].x<=n[1]?e.nodes.splice(a,1):++a;return 1},t.estimateMinNumberOfSamples=(n,r)=>{const i=t.findMinimumXDistance();return Math.ceil((r-n)/i)},t.findMinimumXDistance=()=>{if(e.nodes.length<2)return-1;let n=Number.MAX_VALUE;for(let r=0;r<e.nodes.length-1;r++){const i=e.nodes[r+1].x-e.nodes[r].x;i<n&&(n=i)}return n},t.mapScalarsThroughTable=(n,r,i,a)=>{if(t.getSize()===0){Vj("Transfer Function Has No Points!");return}e.indexedLookup?t.mapDataIndexed(n,r,i,a):t.mapData(n,r,i,a)},t.mapData=(n,r,i,a)=>{if(t.getSize()===0){Pj("Transfer Function Has No Points!");return}const o=Math.floor(t.getAlpha()*255+.5),s=n.getNumberOfTuples(),c=n.getNumberOfComponents(),l=r.getData(),f=n.getData(),u=[];if(i===f1.RGBA)for(let g=0;g<s;g++){const d=f[g*c+a];t.getColor(d,u),l[g*4]=Math.floor(u[0]*255+.5),l[g*4+1]=Math.floor(u[1]*255+.5),l[g*4+2]=Math.floor(u[2]*255+.5),l[g*4+3]=o}if(i===f1.RGB)for(let g=0;g<s;g++){const d=f[g*c+a];t.getColor(d,u),l[g*3]=Math.floor(u[0]*255+.5),l[g*3+1]=Math.floor(u[1]*255+.5),l[g*3+2]=Math.floor(u[2]*255+.5)}if(i===f1.LUMINANCE)for(let g=0;g<s;g++){const d=f[g*c+a];t.getColor(d,u),l[g]=Math.floor(u[0]*76.5+u[1]*150.45+u[2]*28.05+.5)}if(i===f1.LUMINANCE_ALPHA)for(let g=0;g<s;g++){const d=f[g*c+a];t.getColor(d,u),l[g*2]=Math.floor(u[0]*76.5+u[1]*150.45+u[2]*28.05+.5),l[g*2+1]=o}},t.applyColorMap=n=>{const r=JSON.stringify(e.colorSpace);n.ColorSpace&&(e.colorSpace=oa[n.ColorSpace.toUpperCase()],e.colorSpace===void 0&&(Wo(`ColorSpace ${n.ColorSpace} not supported, using RGB instead`),e.colorSpace=oa.RGB));let i=r!==JSON.stringify(e.colorSpace);const a=i||JSON.stringify(e.nanColor);if(n.NanColor)for(e.nanColor=[].concat(n.NanColor);e.nanColor.length<4;)e.nanColor.push(1);i=i||a!==JSON.stringify(e.nanColor);const o=i||JSON.stringify(e.nodes);if(n.RGBPoints){const l=n.RGBPoints.length;e.nodes=[];const f=.5,u=0;for(let g=0;g<l;g+=4)e.nodes.push({x:n.RGBPoints[g],r:n.RGBPoints[g+1],g:n.RGBPoints[g+2],b:n.RGBPoints[g+3],midpoint:f,sharpness:u})}const s=t.sortAndUpdateRange(),c=!s&&(i||o!==JSON.stringify(e.nodes));return c&&t.modified(),s||c}}const Fj={clamping:!0,colorSpace:oa.RGB,hSVWrap:!0,scale:vy.LINEAR,nanColor:null,belowRangeColor:null,aboveRangeColor:null,useAboveRangeColor:!1,useBelowRangeColor:!1,allowDuplicateScalars:!1,table:null,tableSize:0,buildTime:null,nodes:null,discretize:!1,numberOfValues:256};function WD(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Fj,n),T2.extend(t,e,n),e.table=[],e.nodes=[],e.nanColor=[.5,0,0,1],e.belowRangeColor=[0,0,0,1],e.aboveRangeColor=[1,1,1,1],e.buildTime={},P.obj(e.buildTime),P.get(t,e,["buildTime","mappingRange"]),P.setGet(t,e,["useAboveRangeColor","useBelowRangeColor","discretize","numberOfValues",{type:"enum",name:"colorSpace",enum:oa},{type:"enum",name:"scale",enum:vy}]),P.setArray(t,e,["nanColor","belowRangeColor","aboveRangeColor"],4),P.getArray(t,e,["nanColor","belowRangeColor","aboveRangeColor"]),Aj(t,e)}const Uj=P.newInstance(WD,"vtkColorTransferFunction");var Dc={newInstance:Uj,extend:WD,...$D},Bj=[{Name:"KAAMS",IndexedColors:[1,1,1,1,0,0,0,1,0,0,0,1,1,1,0,1,0,1,0,1,1,.63,.63,1,.67,.5,.33,1,.5,.75,.53,.35,.7,1,.75,.5],Annotations:[0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11]},{ColorSpace:"Diverging",Name:"Cool to Warm",NanColor:[1,1,0],RGBPoints:[0,.23137254902,.298039215686,.752941176471,.5,.865,.865,.865,1,.705882352941,.0156862745098,.149019607843]},{ColorSpace:"Lab",Creator:"Francesca Samsel",Name:"Cool to Warm (Extended)",NanColor:[.25,0,0],RGBPoints:[0,0,0,.34902,.03125,.039216,.062745,.380392,.0625,.062745,.117647,.411765,.09375,.090196,.184314,.45098,.125,.12549,.262745,.501961,.15625,.160784,.337255,.541176,.1875,.2,.396078,.568627,.21875,.239216,.454902,.6,.25,.286275,.521569,.65098,.28125,.337255,.592157,.701961,.3125,.388235,.654902,.74902,.34375,.466667,.737255,.819608,.375,.572549,.819608,.878431,.40625,.654902,.866667,.909804,.4375,.752941,.917647,.941176,.46875,.823529,.956863,.968627,.5,.988235,.960784,.901961,.5,.941176,.984314,.988235,.52,.988235,.945098,.85098,.54,.980392,.898039,.784314,.5625,.968627,.835294,.698039,.59375,.94902,.733333,.588235,.625,.929412,.65098,.509804,.65625,.909804,.564706,.435294,.6875,.878431,.458824,.352941,.71875,.839216,.388235,.286275,.75,.760784,.294118,.211765,.78125,.701961,.211765,.168627,.8125,.65098,.156863,.129412,.84375,.6,.094118,.094118,.875,.54902,.066667,.098039,.90625,.501961,.05098,.12549,.9375,.45098,.054902,.172549,.96875,.4,.054902,.192157,1,.34902,.070588,.211765]},{ColorSpace:"Diverging",Name:"Warm to Cool",NanColor:[1,1,0],RGBPoints:[0,.705882352941,.0156862745098,.149019607843,.5,.865,.865,.865,1,.23137254902,.298039215686,.752941176471]},{ColorSpace:"Lab",Creator:"Francesca Samsel",Name:"Warm to Cool (Extended)",NanColor:[.250004,0,0],RGBPoints:[0,.34902,0,.129412,.025,.4,.00392157,.101961,.05,.470588,.0156863,.0901961,.075,.54902,.027451,.0705882,.1,.619608,.0627451,.0431373,.125,.690196,.12549,.0627451,.15,.741176,.184314,.0745098,.175,.788235,.266667,.0941176,.2,.811765,.345098,.113725,.225,.831373,.411765,.133333,.25,.85098,.47451,.145098,.275,.870588,.54902,.156863,.3,.878431,.619608,.168627,.325,.890196,.658824,.196078,.35,.909804,.717647,.235294,.375,.929412,.776471,.278431,.395522,.94902,.823529,.321569,.418905,.968627,.87451,.407843,.444278,.980392,.917647,.509804,.470149,.988235,.956863,.643137,.483582,.992157,.964706,.713725,.499,.988235,.980392,.870588,.5,1,1,1,.501,.913725,.988235,.937255,.516418,.827451,.980392,.886275,.531343,.764706,.980392,.866667,.546766,.658824,.980392,.843137,.564179,.572549,.964706,.835294,.587562,.423529,.941176,.87451,.60597,.262745,.901961,.862745,.629851,.0705882,.854902,.870588,.651741,.0509804,.8,.85098,.681592,.0235294,.709804,.831373,.712935,.0313725,.615686,.811765,.75,.0313725,.537255,.788235,.775,.0392157,.466667,.768627,.8,.0509804,.396078,.741176,.825,.054902,.317647,.709804,.85,.054902,.243137,.678431,.875,.0431373,.164706,.639216,.9,.0313725,.0980392,.6,.925,.0392157,.0392157,.560784,.95,.105882,.0509804,.509804,.975,.113725,.0235294,.45098,1,.12549,0,.380392]},{ColorSpace:"RGB",Name:"Rainbow Desaturated",NanColor:[1,1,0],RGBPoints:[0,.278431372549,.278431372549,.858823529412,.143,0,0,.360784313725,.285,0,1,1,.429,0,.501960784314,0,.571,1,1,0,.714,1,.380392156863,0,.857,.419607843137,0,0,1,.878431372549,.301960784314,.301960784314]},{ColorSpace:"RGB",Name:"Cold and Hot",NanColor:[1,1,0],RGBPoints:[0,0,1,1,.45,0,0,1,.5,0,0,.501960784314,.55,1,0,0,1,1,1,0]},{ColorSpace:"RGB",Name:"Black-Body Radiation",NanColor:[0,.498039215686,1],RGBPoints:[0,0,0,0,.4,.901960784314,0,0,.8,.901960784314,.901960784314,0,1,1,1,1]},{ColorSpace:"RGB",Name:"X Ray",NanColor:[1,0,0],RGBPoints:[0,1,1,1,1,0,0,0]},{ColorSpace:"RGB",Name:"Grayscale",NanColor:[1,0,0],RGBPoints:[0,0,0,0,1,1,1,1]},{ColorSpace:"RGB",Name:"BkRd",NanColor:[0,1,1],RGBPoints:[0,0,0,0,1,1,0,0]},{ColorSpace:"RGB",Name:"BkGn",NanColor:[1,0,1],RGBPoints:[0,0,0,0,1,0,1,0]},{ColorSpace:"RGB",Name:"BkBu",NanColor:[1,1,0],RGBPoints:[0,0,0,0,1,0,0,1]},{ColorSpace:"RGB",Name:"BkMa",NanColor:[0,1,0],RGBPoints:[0,0,0,0,1,1,0,1]},{ColorSpace:"RGB",Name:"BkCy",NanColor:[0,1,1],RGBPoints:[0,0,0,0,1,0,1,1]},{ColorSpace:"RGB",Name:"Black, Blue and White",NanColor:[1,1,0],RGBPoints:[0,0,0,0,.333,0,0,.501960784314,.666,0,.501960784314,1,1,1,1,1]},{ColorSpace:"RGB",Name:"Black, Orange and White",NanColor:[1,1,0],RGBPoints:[0,0,0,0,.333,.501960784314,0,0,.666,1,.501960784314,0,1,1,1,1]},{ColorSpace:"Lab",Creator:"Francesca Samsel",Name:"Linear YGB 1211g",NanColor:[.25,0,0],RGBPoints:[0,1,.988235,.968627,.02,1,.952941,.878431,.05,.968627,.905882,.776471,.1,.94902,.898039,.647059,.15,.901961,.878431,.556863,.2,.847059,.858824,.482353,.25,.690196,.819608,.435294,.3,.513725,.768627,.384314,.35,.337255,.721569,.337255,.4,.278431,.658824,.392157,.45,.231373,.639216,.435294,.5,.203922,.6,.486275,.55,.172549,.568627,.537255,.6,.141176,.517647,.54902,.65,.133333,.458824,.541176,.7,.12549,.396078,.529412,.75,.117647,.321569,.521569,.8,.121569,.258824,.509804,.85,.133333,.227451,.501961,.9,.145098,.192157,.490196,.95,.188235,.164706,.470588,1,.258824,.196078,.439216]},{ColorSpace:"CIELAB",Creator:"Francesca Samsel",Name:"Linear Green (Gr4L)",NanColor:[.25,0,0],RGBPoints:[0,.054902,.109804,.121569,.05,.07451,.172549,.180392,.1,.086275,.231373,.219608,.15,.094118,.278431,.25098,.2,.109804,.34902,.278431,.25,.113725,.4,.278431,.3,.117647,.45098,.270588,.35,.117647,.490196,.243137,.4,.113725,.521569,.203922,.45,.109804,.54902,.152941,.5,.082353,.588235,.082353,.55,.109804,.631373,.05098,.6,.211765,.678431,.082353,.65,.317647,.721569,.113725,.7,.431373,.760784,.160784,.75,.556863,.8,.239216,.8,.666667,.839216,.294118,.85,.784314,.878431,.396078,.9,.886275,.921569,.533333,.95,.960784,.94902,.670588,1,1,.984314,.901961]},{ColorSpace:"Lab",Creator:"Francesca Samsel",Name:"Linear Blue (8_31f)",NanColor:[.25,0,0],RGBPoints:[0,.960784,1,.980392,.05,.815686,.960784,.913725,.1,.670588,.929412,.870588,.15,.556863,.901961,.843137,.2,.478431,.870588,.823529,.25,.439216,.831373,.803922,.3,.4,.8,.788235,.35,.376471,.768627,.768627,.4,.34902,.709804,.729412,.45,.32549,.654902,.690196,.5,.301961,.607843,.658824,.55,.247059,.545098,.619608,.6,.239216,.494118,.580392,.65,.227451,.439216,.541176,.7,.227451,.403922,.521569,.75,.231373,.368627,.501961,.8,.227451,.321569,.470588,.85,.219608,.282353,.439216,.9,.192157,.235294,.4,.95,.160784,.184314,.34902,1,.133333,.12549,.301961]},{ColorSpace:"HSV",Name:"Blue to Red Rainbow",NanColor:[.498039215686,.498039215686,.498039215686],RGBPoints:[0,0,0,1,1,1,0,0]},{ColorSpace:"HSV",Name:"Red to Blue Rainbow",NanColor:[.498039215686,.498039215686,.498039215686],RGBPoints:[0,1,0,0,1,0,0,1]},{ColorSpace:"RGB",Name:"Rainbow Blended White",NanColor:[1,1,0],RGBPoints:[0,1,1,1,.17,0,0,1,.34,0,1,1,.5,0,1,0,.67,1,1,0,.84,1,0,0,1,.878431372549,0,1]},{ColorSpace:"RGB",Name:"Rainbow Blended Grey",NanColor:[1,1,0],RGBPoints:[0,.317647058824,.341176470588,.43137254902,.17,0,0,1,.34,0,1,1,.5,0,1,0,.67,1,1,0,.84,1,0,0,1,.878431372549,0,1]},{ColorSpace:"RGB",Name:"Rainbow Blended Black",NanColor:[1,1,0],RGBPoints:[0,0,0,0,.17,0,0,1,.34,0,1,1,.5,0,1,0,.67,1,1,0,.84,1,0,0,1,.878431372549,0,1]},{ColorSpace:"RGB",Name:"Blue to Yellow",NanColor:[1,0,0],RGBPoints:[0,.0392156862745,.0392156862745,.949019607843,1,.949019607843,.949019607843,.0392156862745]},{ColorSpace:"HSV",Name:"blot",RGBPoints:[0,0,0,1,.166,0,0,1,.167,1,0,1,.332,1,0,1,.333,0,1,1,.5,0,1,1,.501,0,1,0,.666,0,1,0,.667,1,1,0,.832,1,1,0,.833,1,0,0,1,1,0,0]},{ColorSpace:"Lab",Name:"CIELab Blue to Red",NanColor:[1,1,0],RGBPoints:[0,0,.6,.749019607843,1,.76862745098,.466666666667,.341176470588]},{ColorSpace:"RGB",Name:"jet",RGBPoints:[-1,0,0,.5625,-.777778,0,0,1,-.269841,0,1,1,-.015873,.5,1,.5,.238095,1,1,0,.746032,1,0,0,1,.5,0,0]},{ColorSpace:"RGB",Name:"rainbow",RGBPoints:[-1,0,0,1,-.5,0,1,1,0,0,1,0,.5,1,1,0,1,1,0,0]},{ColorSpace:"Lab",Name:"erdc_rainbow_bright",RGBPoints:[-1,.32549,.14902,.960784,-.866221,.297047,.375586,.963836,-.732441,.180302,.536818,.964627,-.598662,.1302,.649207,.929647,-.464883,.0445143,.749654,.855998,-.331104,.0271325,.830713,.721527,-.197324,.259504,.866145,.543555,-.0635452,.428364,.890725,.329819,.0702341,.568503,.898508,.187623,.204013,.738259,.890317,.0825461,.337793,.84546,.86136,.0147555,.471572,.912191,.808018,0,.605351,.962848,.710445,0,.73913,.999469,.600258,.0176284,.87291,.994156,.445975,.193912,1,.980407,.247105,.262699]},{ColorSpace:"Lab",Name:"erdc_rainbow_dark",RGBPoints:[-1,0,0,.423499,-.866221,0,.119346,.529237,-.732441,0,.238691,.634976,-.598662,0,.346852,.68788,-.464883,0,.45022,.718141,-.331104,0,.553554,.664839,-.197324,0,.651082,.519303,-.0635452,.115841,.72479,.352857,.0702341,.326771,.781195,.140187,.204013,.522765,.798524,.0284624,.337793,.703162,.788685,.00885756,.471572,.845118,.751133,0,.605351,.955734,.690825,0,.73913,.995402,.567916,.0618524,.87291,.987712,.403398,.164851,1,.980407,.247105,.262699]},{ColorSpace:"Lab",Name:"nic_CubicL",RGBPoints:[-1,.479965,.0118108,.5307,-.87451,.522213,.0551282,.706919,-.74902,.50839,.237278,.867764,-.623529,.451617,.373834,.987255,-.498039,.39365,.497255,.97506,-.372549,.328631,.599639,.891843,-.247059,.250043,.690286,.778553,-.121569,.249656,.764905,.645857,.00392157,.297954,.821466,.50449,.129412,.337509,.872595,.358447,.254902,.430011,.913789,.297079,.380392,.587191,.931381,.333353,.505882,.727937,.93591,.353742,.631373,.826403,.921081,.365066,.756863,.893201,.846317,.372662,.882353,.965347,.73884,.378506,1,.983235,.597451,.366856]},{ColorSpace:"Lab",Name:"nic_CubicYF",RGBPoints:[-1,.5151,.0482,.6697,-.87451,.520711,.168955,.800574,-.74902,.493694,.278596,.911824,-.623529,.440026,.369475,.984978,-.498039,.398932,.457593,.987053,-.372549,.350651,.540644,.929608,-.247059,.298827,.615625,.857729,-.121569,.239928,.685061,.769531,.00392157,.228832,.739349,.673287,.129412,.263297,.78608,.569988,.254902,.298107,.828337,.460214,.380392,.33092,.864071,.352674,.505882,.38306,.898169,.287309,.631373,.49023,.917481,.307961,.756863,.62372,.926026,.332309,.882353,.717458,.92527,.342476,1,.8,.9255,.3529]},{ColorSpace:"Lab",Name:"gist_earth",RGBPoints:[-1,0,0,0,-.87451,.239216,.027451,.415686,-.74902,.0901961,.254902,.556863,-.623529,.0941176,.352941,.54902,-.498039,.105882,.435294,.533333,-.372549,.12549,.52549,.501961,-.247059,.156863,.596078,.443137,-.121569,.196078,.65098,.380392,.00392157,.282353,.717647,.301961,.129412,.466667,.772549,.27451,.254902,.678431,.784314,.309804,.380392,.901961,.756863,.376471,.505882,.992157,.705882,.521569,.631373,1,.721569,.701961,.756863,1,.784314,.784314,.882353,1,.866667,.866667,1,1,1,1]},{ColorSpace:"Lab",Name:"2hot",RGBPoints:[-1,.0416667,0,0,-.873016,.208333,0,0,-.746032,.375,0,0,-.619048,.541667,0,0,-.492063,.708333,0,0,-.365079,.854137,0,0,-.238095,.937488,.039062,0,-.111111,1,.208333,0,.015873,1,.375,0,.142857,1,.541667,0,.269841,1,.708333,0,.396825,1,.858805,.03125,.52381,1,.947392,.15625,.650794,1,1,.3125,.777778,1,1,.5625,.904762,1,1,.8125,1,1,1,1]},{ColorSpace:"Lab",Name:"erdc_red2yellow_BW",RGBPoints:[-1,754296e-12,0,109827e-10,-.87451,.18285,.0264094,0,-.74902,.3066,0,0,-.623529,.422841,0,0,-.498039,.522945,0,0,-.372549,.605721,0,0,-.247059,.672502,.14168,0,-.121569,.728167,.244025,0,.00392157,.781215,.333454,0,.129412,.825,.423586,0,.254902,.855893,.516793,0,.380392,.880491,.608846,0,.505882,.910305,.695505,0,.631373,.94109,.779067,.223528,.756863,.967873,.858572,.473521,.882353,.986815,.933211,.751583,1,1,1,.999997]},{ColorSpace:"Lab",Name:"erdc_marine2gold_BW",RGBPoints:[-1,111641e-12,0,162551e-11,-.87451,.0413146,.0619808,.209857,-.74902,.0185557,.101341,.350684,-.623529,.00486405,.149847,.461054,-.498039,.0836345,.210845,.517906,-.372549,.173222,.276134,.541793,-.247059,.259857,.343877,.535869,-.121569,.362299,.408124,.504293,.00392157,.468266,.468276,.468257,.129412,.582781,.527545,.374914,.254902,.691591,.585251,.274266,.380392,.784454,.645091,.247332,.505882,.862299,.710383,.27518,.631373,.920863,.782923,.351563,.756863,.955792,.859699,.533541,.882353,.976162,.93433,.780671,1,1,1,.999983]},{ColorSpace:"Lab",Name:"erdc_blue2gold_BW",RGBPoints:[-1,0,0,0,-.87451,.0742735,.0440331,.230013,-.74902,.125276,.0258685,.415826,-.623529,.143879,.0163031,.591346,-.498039,.212261,.0627855,.705239,-.372549,.306048,.141178,.763636,-.247059,.391537,.232286,.773263,-.121569,.461734,.336633,.708321,.00392157,.54209,.427581,.590007,.129412,.61704,.508623,.460978,.254902,.702703,.579586,.309117,.380392,.790336,.644811,.170397,.505882,.870173,.710733,.117134,.631373,.93656,.781991,.157144,.756863,.965672,.862068,.409836,.882353,.985751,.936296,.714162,1,1,1,.999999]},{ColorSpace:"Lab",Name:"erdc_sapphire2gold_BW",RGBPoints:[-1,.107704,.107708,.107694,-.87451,.1851,.112354,.308554,-.74902,.236782,.114233,.48788,-.623529,.28296,.126187,.639464,-.498039,.344787,.171643,.739713,-.372549,.413325,.242371,.76913,-.247059,.481863,.3131,.719841,-.121569,.550402,.383829,.612222,.00392157,.61894,.454558,.51126,.129412,.687478,.525287,.39993,.254902,.756017,.596016,.289923,.380392,.824555,.666745,.255498,.505882,.892979,.736822,.27696,.631373,.938851,.804966,.351734,.756863,.966491,.874853,.53572,.882353,.982105,.94153,.782579,1,1,1,.999986]},{ColorSpace:"Lab",Name:"erdc_red2purple_BW",RGBPoints:[-1,0,0,0,-.87451,.167793,.0166271,.0431278,-.74902,.262608,.0107595,.0791181,-.623529,.351902,.0101858,.100926,-.498039,.441257,.0160835,.131919,-.372549,.5221,.0555972,.195625,-.247059,.593852,.104294,.310234,-.121569,.654628,.158115,.448486,.00392157,.707443,.220914,.570253,.129412,.749504,.293268,.67897,.254902,.781587,.370517,.779269,.380392,.809951,.451099,.855831,.505882,.84424,.531462,.900451,.631373,.865174,.620901,.91606,.756863,.875041,.714054,.910284,.882353,.880764,.80554,.896276,1,.887572,.887591,.887556]},{ColorSpace:"Lab",Name:"erdc_purple2pink_BW",RGBPoints:[-1,0,0,0,-.87451,.117562,.0291202,.175876,-.74902,.178368,.0458476,.285454,-.623529,.237731,.0680173,.387717,-.498039,.300877,.0956291,.484802,-.372549,.370929,.136858,.554985,-.247059,.449033,.189273,.58863,-.121569,.529971,.245796,.598587,.00392157,.609914,.300643,.610244,.129412,.697079,.351286,.616371,.254902,.785858,.401991,.617376,.380392,.862517,.45745,.64463,.505882,.91359,.525462,.705336,.631373,.932583,.61064,.767412,.756863,.922478,.706966,.817522,.882353,.901302,.803071,.856311,1,.887571,.887591,.887549]},{ColorSpace:"Lab",Name:"erdc_pbj_lin",RGBPoints:[-1,0,0,0,-.87451,.091821,.0611476,.10617,-.74902,.160311,.0900022,.192713,-.623529,.22484,.12126,.272128,-.498039,.291263,.157469,.340828,-.372549,.360015,.200388,.388903,-.247059,.437497,.250058,.387201,-.121569,.512636,.304969,.355955,.00392157,.582603,.360874,.33488,.129412,.655126,.416374,.306351,.254902,.725889,.473329,.279051,.380392,.778125,.537928,.302697,.505882,.815894,.606931,.382431,.631373,.839159,.679308,.497608,.756863,.854748,.751666,.631792,.882353,.869483,.822508,.768592,1,.887572,.887589,.887565]},{ColorSpace:"Lab",Name:"erdc_blue2green_muted",RGBPoints:[-1,.107704,.107708,.107695,-.87451,.141522,.13066,.270741,-.74902,.180123,.146119,.42308,-.623529,.210161,.169674,.551795,-.498039,.239701,.212939,.634969,-.372549,.253916,.282947,.653641,-.247059,.242791,.366933,.608521,-.121569,.226302,.446776,.52693,.00392157,.236237,.514689,.458798,.129412,.274641,.577589,.376069,.254902,.349625,.633993,.288131,.380392,.4437,.683677,.260497,.505882,.536247,.731214,.285424,.631373,.628472,.777128,.349151,.756863,.718259,.819287,.496825,.882353,.804768,.856164,.703299,1,.887571,.887591,.887548]},{ColorSpace:"Lab",Name:"erdc_blue2green_BW",RGBPoints:[-1,363578e-12,0,529374e-11,-.87451,.0539915,.0577948,.212806,-.74902,.0620393,.0758942,.388959,-.623529,.0697499,.102032,.54177,-.498039,.113295,.156156,.64334,-.372549,.152047,.243196,.670283,-.247059,.158096,.344084,.622864,-.121569,.151142,.43922,.532767,.00392157,.17155,.521588,.457719,.129412,.225861,.599141,.363997,.254902,.32328,.67007,.259083,.380392,.442344,.733697,.223754,.505882,.558409,.794941,.257411,.631373,.673875,.854344,.340822,.756863,.787244,.909326,.524717,.882353,.896483,.958063,.775914,1,1,1,.999982]},{ColorSpace:"Lab",Name:"GREEN-WHITE_LINEAR",RGBPoints:[-1,0,0,0,-.87451,0,.062745,0,-.74902,0,.12549,0,-.623529,0,.188235,0,-.498039,0,.25098,0,-.372549,0,.313725,0,-.247059,0,.376471,0,-.121569,.094118,.439216,0,.00392157,.196078,.501961,0,.129412,.294118,.564706,0,.254902,.396078,.627451,0,.380392,.498039,.690196,0,.505882,.6,.752941,.145098,.631373,.701961,.815686,.364706,.756863,.8,.878431,.580392,.882353,.901961,.941176,.796078,1,1,1,1]},{ColorSpace:"Lab",Name:"erdc_green2yellow_BW",RGBPoints:[-1,0,0,0,-.87451,0,.105542,.0603919,-.74902,0,.159454,.104148,-.623529,0,.219502,.15542,-.498039,0,.282276,.203811,-.372549,0,.346331,.235652,-.247059,0,.411765,.235428,-.121569,0,.477177,.217977,.00392157,.0593644,.541635,.21361,.129412,.233081,.604722,.210591,.254902,.369803,.664942,.226536,.380392,.498446,.722367,.288237,.505882,.601929,.782244,.380815,.631373,.703207,.840497,.512134,.756863,.803186,.896433,.674462,.882353,.903834,.950266,.846715,1,1,1,.999981]},{ColorSpace:"Lab",Name:"blue2cyan",RGBPoints:[-1,0,0,0,-.87451,0,.152941,.364706,-.74902,0,.254902,.470588,-.623529,0,.34902,.572549,-.498039,0,.443137,.670588,-.372549,0,.537255,.772549,-.247059,0,.627451,.870588,-.121569,0,.717647,.964706,.00392157,.0784314,.772549,1,.129412,.207843,.858824,1,.254902,.32549,.941176,1,.380392,.45098,1,1,.505882,.560784,1,1,.631373,.662745,1,1,.756863,.760784,1,1,.882353,.870588,1,1,1,1,1,1]},{ColorSpace:"Lab",Name:"erdc_blue2cyan_BW",RGBPoints:[-1,405298e-12,0,59012e-10,-.87451,.0207526,.0740933,.18093,-.74902,0,.121033,.30343,-.623529,0,.166892,.416095,-.498039,0,.216768,.524796,-.372549,.0164769,.275471,.608585,-.247059,.0544527,.344824,.659267,-.121569,.0880643,.419118,.688675,.00392157,.127938,.492556,.720256,.129412,.149476,.566946,.756918,.254902,.188961,.641333,.792122,.380392,.245482,.715336,.827609,.505882,.329216,.786235,.874761,.631373,.453558,.852803,.918466,.756863,.626281,.910493,.954,.882353,.82257,.958709,.980146,1,1,1,.999989]},{ColorSpace:"Lab",Name:"erdc_blue_BW",RGBPoints:[-1,0,0,0,-.87451,.0425591,.0763529,.150682,-.74902,.0569472,.119154,.275403,-.623529,.0635978,.164772,.395427,-.498039,.0774342,.213851,.510014,-.372549,.106815,.267034,.615102,-.247059,.122093,.324649,.720068,-.121569,.160851,.387068,.806956,.00392157,.213754,.453516,.878012,.129412,.26722,.524656,.932436,.254902,.326844,.599279,.968038,.380392,.403403,.674712,.984784,.505882,.499703,.745519,1,.631373,.615055,.813983,1,.756863,.74405,.879228,1,.882353,.877909,.941913,1,1,1,1,.999996]},{ColorSpace:"Lab",Name:"BLUE-WHITE",RGBPoints:[-1,0,0,0,-.87451,0,0,.082353,-.74902,0,0,.168627,-.623529,0,0,.254902,-.498039,0,0,.337255,-.372549,0,0,.423529,-.247059,0,0,.509804,-.121569,0,.101961,.592157,.00392157,0,.203922,.678431,.129412,0,.301961,.764706,.254902,0,.403922,.85098,.380392,0,.505882,.933333,.505882,0,.603922,1,.631373,.254902,.705882,1,.756863,.509804,.807843,1,.882353,.764706,.905882,1,1,1,1,1]},{ColorSpace:"Lab",Name:"erdc_purple_BW",RGBPoints:[-1,4264e-11,0,620844e-12,-.87451,.100579,.0593111,.145666,-.74902,.167794,.0889224,.254953,-.623529,.231446,.123339,.360511,-.498039,.296699,.163027,.461278,-.372549,.363211,.209286,.55306,-.247059,.431136,.260776,.637195,-.121569,.498202,.320012,.705799,.00392157,.567456,.380459,.778091,.129412,.629381,.445284,.8448,.254902,.688373,.517374,.895694,.380392,.74891,.590906,.93976,.505882,.805017,.667956,.977626,.631373,.850914,.752618,.992396,.756863,.89724,.838454,.994093,.882353,.948461,.922603,.994449,1,1,1,.999967]},{ColorSpace:"Lab",Name:"erdc_magenta_BW",RGBPoints:[-1,0,0,254023e-10,-.87451,.128696,.0456782,.11635,-.74902,.228133,.0476299,.201452,-.623529,.327273,.0374065,.282107,-.498039,.420953,.0408166,.35709,-.372549,.511562,.0642203,.430511,-.247059,.599552,.102686,.504257,-.121569,.684646,.150536,.579429,.00392157,.765817,.205978,.656062,.129412,.839176,.27229,.731807,.254902,.89536,.357594,.797309,.380392,.930238,.457825,.846984,.505882,.945921,.564536,.880571,.631373,.948995,.670753,.902279,.756863,.947124,.772819,.918171,.882353,.947265,.869424,.934352,1,.954719,.95475,.954726]},{ColorSpace:"Lab",Name:"magenta",RGBPoints:[-1,0,0,0,-.87451,.364706,0,.152941,-.74902,.470588,0,.254902,-.623529,.572549,0,.34902,-.498039,.670588,0,.443137,-.372549,.772549,0,.537255,-.247059,.870588,0,.627451,-.121569,.964706,0,.717647,.00392157,1,.0784314,.772549,.129412,1,.207843,.858824,.254902,1,.32549,.941176,.380392,1,.45098,1,.505882,1,.560784,1,.631373,1,.662745,1,.756863,1,.760784,1,.882353,1,.870588,1,1,1,1,1]},{ColorSpace:"Lab",Name:"RED-PURPLE",RGBPoints:[-1,0,0,0,-.87451,.188235,0,.007843,-.74902,.345098,0,.035294,-.623529,.439216,0,.098039,-.498039,.533333,0,.152941,-.372549,.627451,.015686,.211765,-.247059,.721569,.031373,.266667,-.121569,.8,.047059,.329412,.00392157,.862745,.047059,.403922,.129412,.941176,.062745,.466667,.254902,.988235,.078431,.54902,.380392,.988235,.141176,.643137,.505882,.988235,.25098,.729412,.631373,.988235,.376471,.811765,.756863,.988235,.54902,.886275,.882353,.988235,.752941,.952941,1,.996078,.996078,.996078]},{ColorSpace:"Lab",Name:"erdc_red_BW",RGBPoints:[-1,0,0,0,-.87451,.147204,.0480135,.0401815,-.74902,.253411,.0617478,.0301333,-.623529,.356059,.0746331,.0446897,-.498039,.457731,.0934935,.0636931,-.372549,.557199,.122714,.0860013,-.247059,.665179,.144238,.105585,-.121569,.763833,.187056,.138326,.00392157,.847035,.254558,.189407,.129412,.905663,.345937,.258215,.254902,.941431,.447111,.346277,.380392,.962608,.546927,.457571,.505882,.987833,.637276,.569944,.631373,.994202,.732176,.687958,.756863,.993304,.826268,.800567,.882353,.994413,.917205,.906393,1,1,1,.999979]},{ColorSpace:"Lab",Name:"RED_TEMPERATURE",RGBPoints:[-1,0,0,0,-.87451,.090196,0,0,-.74902,.180392,0,0,-.623529,.270588,0,0,-.498039,.360784,0,0,-.372549,.45098,0,0,-.247059,.545098,0,0,-.121569,.635294,0,0,.00392157,.72549,.058824,0,.129412,.815686,.176471,0,.254902,.905882,.294118,0,.380392,1,.411765,0,.505882,1,.533333,.027451,.631373,1,.65098,.27451,.756863,1,.768627,.521569,.882353,1,.886275,.768627,1,1,1,1]},{ColorSpace:"Lab",Name:"erdc_orange_BW",RGBPoints:[-1,0,0,253806e-10,-.87451,.135871,.0593824,0,-.74902,.224328,.0907216,0,-.623529,.318083,.119647,0,-.498039,.414443,.150246,0,-.372549,.511077,.184884,0,-.247059,.605501,.226033,0,-.121569,.695274,.275491,0,.00392157,.777826,.334445,0,.129412,.851498,.402441,0,.254902,.915899,.47759,602975e-9,.380392,.971984,.557882,.0361443,.505882,1,.641287,.135967,.631373,1,.725198,.27997,.756863,1,.808205,.438135,.882353,1,.89306,.587036,1,1,.977928,.721599]},{ColorSpace:"Lab",Name:"heated_object",RGBPoints:[-1,0,0,0,-.87451,.34902,.0862745,0,-.74902,.45098,.172549,0,-.623529,.52549,.231373,0,-.498039,.580392,.278431,0,-.372549,.623529,.313725,0,-.247059,.670588,.352941,0,-.121569,.717647,.392157,0,.00392157,.772549,.439216,0,.129412,.839216,.494118,0,.254902,.901961,.541176,0,.380392,.968627,.6,0,.505882,1,.658824,0,.631373,1,.721569,0,.756863,1,.827451,.298039,.882353,1,.976471,.72549,1,1,1,1]},{ColorSpace:"Lab",Name:"erdc_gold_BW",RGBPoints:[-1,0,0,190933e-10,-.87451,.128363,.0636265,0,-.74902,.193795,.111057,0,-.623529,.25976,.15987,0,-.498039,.328546,.210589,0,-.372549,.399726,.26332,0,-.247059,.472969,.318261,0,-.121569,.546245,.375827,0,.00392157,.61745,.436719,0,.129412,.685545,.501113,0,.254902,.749578,.568799,0,.380392,.80962,.6394,0,.505882,.865572,.712699,.10257,.631373,.917709,.787569,.233665,.756863,.966914,.863138,.369608,.882353,1,.939405,.496104,1,.999225,1,.612275]},{ColorSpace:"Lab",Name:"erdc_brown_BW",RGBPoints:[-1,33216e-11,0,483629e-11,-.87451,.14693,.0518172,0,-.74902,.225806,.0814996,0,-.623529,.301681,.111452,0,-.498039,.370487,.150664,0,-.372549,.43108,.199477,0,-.247059,.4849,.255107,0,-.121569,.536798,.313486,0,.00392157,.59286,.371167,0,.129412,.653119,.428135,0,.254902,.714589,.485917,.0379541,.380392,.774667,.54565,.116634,.505882,.831222,.608047,.183895,.631373,.880305,.674199,.260298,.756863,.922314,.742472,.367086,.882353,.959408,.811222,.497258,1,.993548,.875183,.622093]},{ColorSpace:"Lab",Name:"copper_Matlab",RGBPoints:[-1,0,0,0,-.87451,.0784314,.0501961,.0313725,-.74902,.156863,.100392,.0627451,-.623529,.235294,.150588,.0941176,-.498039,.313725,.200784,.12549,-.372549,.392157,.25098,.156863,-.247059,.470588,.301176,.188235,-.121569,.54902,.351373,.219608,.00392157,.627451,.401569,.25098,.129412,.705882,.451765,.282353,.254902,.784314,.501961,.313725,.380392,.862745,.552157,.345098,.505882,.941176,.602353,.376471,.631373,1,.652549,.407843,.756863,1,.702745,.439216,.882353,1,.752941,.470588,1,1,.8,.5]},{ColorSpace:"Lab",Name:"pink_Matlab",RGBPoints:[-1,0,0,0,-.87451,.312416,.204524,.204524,-.74902,.441822,.289241,.289241,-.623529,.54112,.354246,.354246,-.498039,.624831,.409048,.409048,-.372549,.698582,.45733,.45733,-.247059,.764404,.502282,.500979,-.121569,.791292,.591516,.54112,.00392157,.817297,.66895,.578481,.129412,.842499,.738308,.613572,.254902,.866968,.801687,.646762,.380392,.890766,.86041,.678329,.505882,.913944,.913944,.711254,.631373,.936549,.936549,.79459,.756863,.958621,.958621,.869979,.882353,.980196,.980196,.939336,1,1,1,1]},{ColorSpace:"Lab",Name:"bone_Matlab",RGBPoints:[-1,0,0,0,-.87451,.054902,.054902,.075817,-.74902,.109804,.109804,.151634,-.623529,.164706,.164706,.227451,-.498039,.219608,.219608,.303268,-.372549,.27451,.27451,.379085,-.247059,.329412,.329902,.454412,-.121569,.384314,.405719,.509314,.00392157,.439216,.481536,.564216,.129412,.494118,.557353,.619118,.254902,.54902,.63317,.67402,.380392,.603922,.708987,.728922,.505882,.660294,.783824,.783824,.631373,.746569,.838725,.838725,.756863,.832843,.893627,.893627,.882353,.919118,.948529,.948529,1,1,1,1]},{ColorSpace:"Lab",Name:"gray_Matlab",RGBPoints:[-1,0,0,0,-.87451,.0627451,.0627451,.0627451,-.74902,.12549,.12549,.12549,-.623529,.188235,.188235,.188235,-.498039,.25098,.25098,.25098,-.372549,.313725,.313725,.313725,-.247059,.376471,.376471,.376471,-.121569,.439216,.439216,.439216,.00392157,.501961,.501961,.501961,.129412,.564706,.564706,.564706,.254902,.627451,.627451,.627451,.380392,.690196,.690196,.690196,.505882,.752941,.752941,.752941,.631373,.815686,.815686,.815686,.756863,.878431,.878431,.878431,.882353,.941176,.941176,.941176,1,1,1,1]},{ColorSpace:"Lab",Name:"Purples",RGBPoints:[-1,.247059,0,.490196,-.87451,.288397,.07677,.525629,-.74902,.32975,.153587,.561092,-.623529,.373057,.236263,.600461,-.498039,.416363,.319,.639923,-.372549,.459669,.405613,.685198,-.247059,.503345,.491534,.730058,-.121569,.562399,.54862,.757616,.00392157,.621453,.606075,.785544,.129412,.680508,.674971,.824914,.254902,.739562,.743406,.863899,.380392,.798616,.800492,.893426,.505882,.85684,.856655,.922491,.631373,.898178,.894056,.942176,.756863,.938654,.930919,.961646,.882353,.964245,.958478,.977393,1,.988235,.984314,.992157]},{ColorSpace:"Lab",Name:"Blues",RGBPoints:[-1,.031373,.188235,.419608,-.87451,.031373,.253195,.516063,-.74902,.031757,.318139,.612149,-.623529,.080969,.38113,.661361,-.498039,.130427,.444152,.710327,-.372549,.195386,.509112,.743791,-.247059,.260715,.573841,.777209,-.121569,.341423,.628958,.808704,.00392157,.422745,.684075,.839892,.129412,.523137,.739193,.861546,.254902,.622684,.793464,.883429,.380392,.701423,.826928,.910988,.505882,.778685,.8603,.937993,.631373,.825928,.891795,.953741,.756863,.87328,.923291,.969489,.882353,.922491,.954787,.985236,1,.968627,.984314,1]},{ColorSpace:"Lab",Name:"Greens",RGBPoints:[-1,0,.266667,.105882,-.87451,0,.347374,.139346,-.74902,538e-6,.427912,.172933,-.623529,.069435,.486967,.222145,-.498039,.138178,.546082,.271326,-.372549,.197232,.609073,.31857,-.247059,.257255,.671742,.365859,-.121569,.357647,.720953,.415071,.00392157,.45767,.769919,.465021,.129412,.546251,.811257,.537855,.254902,.634295,.852211,.610688,.380392,.709097,.883706,.683522,.505882,.78316,.914833,.755894,.631373,.842215,.938454,.818885,.756863,.899977,.961538,.880692,.882353,.935409,.975317,.92203,1,.968627,.988235,.960784]},{ColorSpace:"Lab",Name:"PuBu",RGBPoints:[-1,.301961,0,.294118,-.87451,.404321,.029527,.390573,-.74902,.50599,.059592,.486782,-.623529,.519769,.158016,.551742,-.498039,.533456,.256194,.616301,-.372549,.54133,.33887,.655671,-.247059,.54902,.421592,.695087,-.121569,.54902,.506236,.736424,.00392157,.550127,.590573,.777701,.129412,.585559,.665375,.81707,.254902,.622145,.739023,.855825,.380392,.687105,.784298,.879446,.505882,.752065,.829758,.903253,.631373,.817024,.87897,.930811,.756863,.880907,.927213,.957832,.882353,.926182,.958708,.975548,1,.968627,.988235,.992157]},{ColorSpace:"Lab",Name:"BuPu",RGBPoints:[-1,.007843,.219608,.345098,-.87451,.01178,.286536,.449427,-.74902,.015702,.35328,.553479,-.623529,.01767,.396586,.622376,-.498039,.021115,.4402,.690688,-.372549,.11757,.503191,.722184,-.247059,.214625,.565859,.753633,-.121569,.336671,.615071,.78316,.00392157,.457978,.663975,.812503,.129412,.556401,.703345,.836125,.254902,.65421,.742714,.859669,.380392,.736886,.782084,.881323,.505882,.81827,.821638,.903068,.631373,.873387,.864944,.92669,.756863,.927536,.907605,.949988,.882353,.964937,.9391,.967705,1,1,.968627,.984314]},{ColorSpace:"Lab",Name:"BuGn",RGBPoints:[-1,.031373,.25098,.505882,-.87451,.031373,.329719,.590527,-.74902,.031911,.408397,.674787,-.623529,.100807,.479262,.710219,-.498039,.169704,.550219,.745744,-.372549,.238601,.62699,.787082,-.247059,.307958,.703114,.826759,-.121569,.39654,.752326,.797232,.00392157,.485121,.801046,.767705,.129412,.573702,.83451,.738178,.254902,.661592,.867743,.711034,.380392,.732457,.895302,.74253,.505882,.801845,.922307,.774579,.631373,.841215,.938055,.817885,.756863,.880907,.95391,.861084,.882353,.926182,.971626,.902422,1,.968627,.988235,.941176]},{ColorSpace:"Lab",Name:"GnBu",RGBPoints:[-1,0,.266667,.105882,-.87451,0,.347374,.139346,-.74902,538e-6,.427912,.172933,-.623529,.069435,.486967,.222145,-.498039,.138178,.546175,.272095,-.372549,.197232,.615071,.368551,-.247059,.256609,.683276,.464867,-.121569,.329443,.722645,.555417,.00392157,.403137,.762138,.645413,.129412,.503529,.805444,.718247,.254902,.603922,.848597,.790465,.380392,.704314,.887966,.847551,.505882,.802307,.926321,.903714,.631373,.851519,.944037,.941115,.756863,.899977,.961538,.976901,.882353,.935409,.975317,.984775,1,.968627,.988235,.992157]},{ColorSpace:"Lab",Name:"GnBuPu",RGBPoints:[-1,.003922,.27451,.211765,-.87451,.003922,.349312,.280661,-.74902,.003937,.423852,.349773,-.623529,.005905,.46519,.446228,-.498039,.009443,.506344,.542837,-.372549,.111803,.535871,.649135,-.247059,.214025,.565859,.753633,-.121569,.310481,.615071,.78316,.00392157,.407797,.663975,.812503,.129412,.531811,.703345,.836125,.254902,.65421,.742714,.859669,.380392,.736886,.782084,.881323,.505882,.81827,.821176,.902884,.631373,.873387,.854641,.922568,.756863,.927536,.888535,.942361,.882353,.964937,.929873,.964014,1,1,.968627,.984314]},{ColorSpace:"Lab",Name:"BuGnYl",RGBPoints:[-1,.031373,.113725,.345098,-.87451,.088458,.159,.463206,-.74902,.145052,.204567,.5807,-.623529,.139146,.287243,.620069,-.498039,.13318,.370196,.659562,-.372549,.123337,.470588,.706805,-.247059,.115386,.570335,.753126,-.121569,.186251,.643168,.761,.00392157,.258716,.71514,.768074,.129412,.380761,.760415,.750358,.254902,.503576,.806075,.732795,.380392,.645306,.861192,.719016,.505882,.783899,.91511,.705606,.631373,.858701,.944637,.6997,.756863,.931349,.973303,.698424,.882353,.966782,.987082,.777163,1,1,1,.85098]},{ColorSpace:"Lab",Name:"PuRd",RGBPoints:[-1,.286275,0,.415686,-.87451,.38273,.001968,.441276,-.74902,.479231,.003922,.466774,-.623529,.581592,.003922,.480554,-.498039,.683799,.00549,.494887,-.372549,.776317,.105882,.544098,-.247059,.867866,.206321,.592618,-.121569,.919047,.308681,.612303,.00392157,.968812,.411226,.632603,.129412,.974717,.519493,.671972,.254902,.980546,.626451,.71065,.380392,.984483,.701253,.732303,.505882,.988328,.77504,.755617,.631373,.990296,.828189,.812703,.756863,.992372,.880907,.869035,.882353,.996309,.926182,.912341,1,1,.968627,.952941]},{ColorSpace:"Lab",Name:"RdPu",RGBPoints:[-1,.403922,0,.121569,-.87451,.500377,0,.192434,-.74902,.596909,277e-6,.263037,-.623529,.703206,.035709,.300438,-.498039,.808612,.071296,.338854,-.372549,.857824,.116571,.441215,-.247059,.905513,.163552,.54293,-.121569,.889765,.281661,.617732,.00392157,.873156,.39897,.691611,.129412,.82985,.491488,.736886,.254902,.789081,.583237,.781853,.380392,.810734,.656071,.819254,.505882,.833126,.729181,.85684,.631373,.870527,.80792,.898178,.756863,.907605,.884398,.938331,.882353,.9391,.921799,.958016,1,.968627,.956863,.976471]},{ColorSpace:"Lab",Name:"Oranges",RGBPoints:[-1,.498039,.152941,.015686,-.87451,.57481,.182468,.013718,-.74902,.651765,.212042,.011734,-.623529,.752157,.247474,.007797,-.498039,.851719,.283368,.004475,-.372549,.898962,.348328,.039908,-.247059,.945652,.413426,.076401,-.121569,.969273,.484291,.157109,.00392157,.992157,.554971,.238185,.129412,.992157,.619931,.330704,.254902,.992157,.684967,.423837,.380392,.992157,.751895,.532103,.505882,.992249,.817716,.639354,.631373,.994218,.861023,.725967,.756863,.996186,.903576,.810965,.882353,.998155,.933103,.868051,1,1,.960784,.921569]},{ColorSpace:"Lab",Name:"Reds",RGBPoints:[-1,.403922,0,.05098,-.87451,.525967,.029527,.066728,-.74902,.647643,.058962,.082476,-.623529,.722445,.076678,.098224,-.498039,.797186,.095194,.114187,-.372549,.868051,.164091,.143714,-.247059,.937809,.233541,.173933,-.121569,.96143,.326059,.232987,.00392157,.984375,.418147,.292657,.129412,.986344,.496886,.371396,.254902,.988235,.575702,.450673,.380392,.988235,.656409,.543191,.505882,.98842,.736747,.635894,.631373,.992357,.809581,.732349,.756863,.996186,.880692,.826759,.882353,.998155,.92203,.885813,1,1,.960784,.941176]},{ColorSpace:"Lab",Name:"RdOr",RGBPoints:[-1,.498039,0,0,-.87451,.6004,0,0,-.74902,.702514,738e-6,477e-6,-.623529,.773379,.095225,.061499,-.498039,.843875,.189865,.12283,-.372549,.891119,.294195,.203537,-.247059,.937855,.397924,.283137,-.121569,.963445,.476663,.316601,.00392157,.988297,.555771,.351665,.129412,.990265,.646321,.436309,.254902,.992157,.735256,.519646,.380392,.992157,.784468,.570827,.505882,.992249,.833218,.623483,.631373,.994218,.872587,.706159,.756863,.996186,.911419,.788189,.882353,.998155,.940946,.859054,1,1,.968627,.92549]},{ColorSpace:"Lab",Name:"BrOrYl",RGBPoints:[-1,.4,.145098,.023529,-.87451,.500392,.174625,.019592,-.74902,.600784,.204291,.015656,-.623529,.701176,.251534,.011719,-.498039,.800984,.299146,.008397,-.372549,.863975,.370012,.043829,-.247059,.926321,.441107,.0794,-.121569,.961753,.521815,.120738,.00392157,.996078,.602645,.163122,.129412,.996078,.68729,.237924,.254902,.996078,.771011,.314879,.380392,.996078,.832034,.444798,.505882,.996171,.892042,.572595,.631373,.998139,.931411,.65724,.756863,1,.969489,.741669,.882353,1,.985236,.822376,1,1,1,.898039]},{ColorSpace:"Lab",Name:"RdOrYl",RGBPoints:[-1,.501961,0,.14902,-.87451,.622038,0,.14902,-.74902,.741761,4e-4,.148866,-.623529,.816563,.05158,.129181,-.498039,.890965,.10356,.110235,-.372549,.940177,.205921,.137793,-.247059,.988281,.308789,.165536,-.121569,.99025,.432803,.200969,.00392157,.992218,.555217,.236278,.129412,.994187,.628051,.267774,.254902,.996078,.701038,.301269,.380392,.996078,.777809,.383945,.505882,.996171,.852826,.466621,.631373,.998139,.892195,.549296,.756863,1,.931349,.632188,.882353,1,.966782,.7188,1,1,1,.8]},{ColorSpace:"Lab",Name:"CIELab_blue2red",RGBPoints:[-1,0,.6,.74902,1,.76863,.46667,.34118]},{ColorSpace:"Lab",Name:"blue2yellow",RGBPoints:[-1,0,0,1,0,.5,.5,.5,1,1,1,0]},{ColorSpace:"Lab",Name:"erdc_blue2gold",RGBPoints:[-1,.175119,.0438468,1,-.874016,.22383,.159771,.94557,-.748031,.27254,.233611,.891216,-.622047,.321251,.296526,.836857,-.496063,.369962,.354296,.782359,-.370079,.418672,.409139,.72754,-.244094,.467383,.462152,.672148,-.11811,.51609,.51396,.615825,.00787402,.572863,.55452,.559172,.133858,.630269,.593822,.517729,.259843,.689588,.624668,.47446,.385827,.745394,.656113,.428638,.511811,.798624,.688104,.379105,.637795,.849926,.720593,.323834,.76378,.899765,.753543,.258657,.889764,.948487,.78692,.171778,1,.990413,.816451,.00729848]},{ColorSpace:"Lab",Name:"erdc_blue2yellow",RGBPoints:[-1,.0830122,0,.495617,-.87451,.141973,.0551288,.57363,-.74902,.193048,.110258,.604561,-.623529,.234231,.165386,.57643,-.498039,.275413,.220515,.548299,-.372549,.316596,.275644,.520169,-.247059,.357778,.330773,.492038,-.121569,.398961,.385901,.463908,.00392157,.449929,.438487,.426815,.129412,.511572,.488299,.379944,.254902,.581222,.53603,.325741,.380392,.650871,.583761,.271538,.505882,.720521,.631493,.217335,.631373,.79017,.679224,.163132,.756863,.85982,.726955,.108929,.882353,.910254,.774159,.14112,1,.927513,.81759,.306289]},{ColorSpace:"Lab",Name:"erdc_cyan2orange",RGBPoints:[-1,.0471513,.213874,.414329,-.87451,.0674702,.256648,.439027,-.74902,.0959957,.299331,.462089,-.623529,.132428,.341872,.483212,-.498039,.188743,.38277,.500597,-.372549,.268511,.420229,.512179,-.247059,.352945,.455602,.519101,-.121569,.43893,.489368,.521538,.00392157,.522445,.522495,.522436,.129412,.600089,.555682,.53205,.254902,.67988,.587981,.539163,.380392,.761011,.619586,.544439,.505882,.84278,.650741,.548567,.631373,.910713,.687347,.557822,.756863,.952232,.734972,.577775,.882353,.975642,.789858,.604868,1,.990752,.843643,.632857]},{ColorSpace:"Lab",Name:"erdc_purple2green",RGBPoints:[-1,.235006,.0483128,.530899,-.87451,.302968,.108419,.552391,-.74902,.360241,.166059,.569502,-.623529,.406746,.226782,.579373,-.498039,.444073,.28964,.582094,-.372549,.473648,.353774,.577947,-.247059,.497636,.418154,.567911,-.121569,.519086,.481741,.553968,.00392157,.542884,.542914,.542875,.129412,.566303,.603989,.527499,.254902,.595218,.662965,.516857,.380392,.628641,.720701,.510673,.505882,.665373,.777849,.508165,.631373,.704182,.834921,.508303,.756863,.743846,.892328,.50999,.882353,.783158,.950422,.512181,1,.818617,1,.513888]},{ColorSpace:"Lab",Name:"erdc_purple2green_dark",RGBPoints:[-1,.107656,0,.428682,-.87451,.1924,0,.449799,-.74902,.255118,.0648939,.466726,-.623529,.304256,.133066,.476703,-.498039,.343202,.19716,.479793,-.372549,.373876,.260353,.476241,-.247059,.398497,.322872,.466953,-.121569,.420016,.384252,.453785,.00392157,.44319,.443216,.443186,.129412,.465553,.502139,.428233,.254902,.492959,.559151,.417591,.380392,.524654,.615092,.411016,.505882,.55959,.670583,.40779,.631373,.596614,.726102,.406948,.756863,.634544,.782032,.407439,.882353,.672183,.838703,.408237,1,.706131,.892759,.408452]},{ColorSpace:"Lab",Name:"coolwarm",RGBPoints:[-1,.229806,.298718,.753683,-.875,.303869,.406535,.844959,-.75,.383013,.509419,.917388,-.625,.466667,.604563,.968155,-.5,.552953,.688929,.995376,-.375,.639176,.7596,.998151,-.25,.722193,.813953,.976575,-.125,.798692,.849786,.931689,0,.865395,.86541,.865396,.125,.924128,.827385,.774508,.25,.958853,.769768,.678008,.375,.969954,.694267,.579375,.5,.958003,.602842,.481776,.625,.923945,.497309,.38797,.75,.869187,.378313,.300267,.875,.795632,.241284,.220526,1,.705673,.0155562,.150233]},{ColorSpace:"Lab",Name:"BuRd",RGBPoints:[-1,.019608,.188235,.380392,-.87451,.088504,.321107,.564937,-.74902,.163399,.444983,.697501,-.623529,.247059,.555709,.754095,-.498039,.420684,.676432,.818685,-.372549,.606459,.789773,.880277,-.247059,.761476,.868512,.924567,-.121569,.878047,.925721,.951942,.00392157,.969089,.966474,.964937,.129412,.983852,.897578,.846828,.254902,.982468,.800692,.706113,.380392,.960323,.66782,.536332,.505882,.894579,.503806,.399769,.631373,.81707,.33218,.281046,.756863,.728489,.155017,.197386,.882353,.576932,.055363,.14925,1,.403922,0,.121569]},{ColorSpace:"Lab",Name:"Spectral_lowBlue",RGBPoints:[-1,.368627,.309804,.635294,-.87451,.260361,.450058,.70173,-.74902,.248058,.591311,.717186,-.623529,.376009,.734025,.658132,-.498039,.537947,.814764,.64506,-.372549,.702345,.879585,.636678,-.247059,.84752,.938639,.607151,-.121569,.940408,.976163,.656055,.00392157,.999923,.997616,.745021,.129412,.997463,.921338,.61707,.254902,.995002,.824606,.499885,.380392,.992541,.701576,.39654,.505882,.973472,.547405,.318108,.631373,.937793,.398539,.270127,.756863,.861515,.282891,.299654,.882353,.746482,.144637,.288812,1,.619608,.003922,.258824]},{ColorSpace:"Lab",Name:"GnRP",RGBPoints:[-1,0,.266667,.105882,-.87451,.066436,.394617,.174779,-.74902,.168858,.524567,.25767,-.623529,.323875,.657439,.361015,-.498039,.504883,.772318,.506344,-.372549,.678431,.870127,.654902,-.247059,.803922,.921799,.780392,-.121569,.897116,.951942,.882814,.00392157,.967397,.965936,.967474,.129412,.928028,.879815,.930565,.254902,.866052,.780777,.882891,.380392,.77501,.665129,.821376,.505882,.675663,.537024,.737024,.631373,.57847,.396155,.645982,.756863,.492349,.223914,.547559,.882353,.375548,.096886,.423299,1,.25098,0,.294118]},{ColorSpace:"Lab",Name:"GYPi",RGBPoints:[-1,.152941,.392157,.098039,-.87451,.246444,.505344,.117724,-.74902,.351942,.614533,.161399,-.623529,.474971,.717878,.240138,-.498039,.611995,.811226,.392849,-.372549,.746328,.893118,.565321,-.247059,.859516,.94233,.747405,-.121569,.928105,.96386,.875663,.00392157,.969089,.966859,.968012,.129412,.983852,.910265,.948328,.254902,.979239,.833218,.914648,.380392,.949712,.729873,.862976,.505882,.905652,.58293,.763552,.631373,.85521,.410073,.652211,.756863,.793695,.183699,.531642,.882353,.683737,.063899,.420761,1,.556863,.003922,.321569]},{ColorSpace:"Lab",Name:"GnYlRd",RGBPoints:[-1,0,.407843,.215686,-.87451,.063975,.525952,.277201,-.74902,.177932,.633064,.332718,-.623529,.364937,.724106,.379469,-.498039,.527951,.797155,.40223,-.372549,.678431,.862822,.433449,-.247059,.803922,.916955,.514648,-.121569,.909419,.961861,.625067,.00392157,.999923,.997616,.745021,.129412,.997463,.921338,.61707,.254902,.995002,.824606,.499885,.380392,.992541,.701576,.39654,.505882,.973472,.547405,.318108,.631373,.939023,.389927,.245521,.756863,.867666,.239831,.176624,.882353,.762399,.110727,.151326,1,.647059,0,.14902]},{ColorSpace:"Lab",Name:"GBBr",RGBPoints:[-1,0,.235294,.188235,-.87451,.002461,.338639,.301423,-.74902,.055902,.448981,.417609,-.623529,.183852,.56955,.538178,-.498039,.357785,.700115,.660746,-.372549,.540177,.819531,.77624,-.247059,.714879,.890888,.864821,-.121569,.851134,.934564,.922645,.00392157,.960861,.959785,.95694,.129412,.963322,.927797,.83391,.254902,.939946,.868897,.68935,.380392,.883353,.775394,.517109,.505882,.808074,.625836,.324106,.631373,.717647,.476355,.15494,.756863,.592157,.358247,.06882,.882353,.458593,.26436,.031142,1,.329412,.188235,.019608]},{ColorSpace:"Lab",Name:"PuOr",RGBPoints:[-1,.498039,.231373,.031373,-.87451,.62599,.30273,.026451,-.74902,.746943,.387082,.037524,-.623529,.85767,.490427,.071972,-.498039,.936409,.617762,.236371,-.372549,.992695,.743099,.43291,-.247059,.995156,.841523,.63714,-.121569,.985313,.913802,.813687,.00392157,.966244,.966398,.967705,.129412,.889965,.89504,.938178,.254902,.806151,.804306,.894656,.380392,.712649,.688658,.833141,.505882,.594233,.554325,.744637,.631373,.474894,.404229,.652364,.756863,.366628,.217224,.563783,.882353,.266436,.089965,.434833,1,.176471,0,.294118]},{ColorSpace:"Lab",Name:"PRGn",RGBPoints:[-1,.25098,0,.294118,-.87451,.383852,.103345,.431911,-.74902,.497732,.234679,.55371,-.623529,.583852,.40692,.652134,-.498039,.681968,.545175,.742561,-.372549,.7807,.672357,.825221,-.247059,.871742,.788005,.886736,-.121569,.930488,.885198,.932872,.00392157,.966321,.968089,.965859,.129412,.892503,.950865,.877278,.254902,.796078,.91857,.772549,.380392,.670588,.866897,.647059,.505882,.493195,.765398,.496655,.631373,.314187,.649135,.354556,.756863,.15917,.516263,.251211,.882353,.062284,.386621,.170473,1,0,.266667,.105882]},{ColorSpace:"Lab",Name:"PiYG",RGBPoints:[-1,.556863,.003922,.321569,-.87451,.692195,.067897,.427374,-.74902,.797539,.197847,.539177,-.623529,.859054,.424221,.659746,-.498039,.908574,.592618,.770319,-.372549,.951557,.736332,.866205,-.247059,.981084,.839677,.917878,-.121569,.98293,.913802,.949558,.00392157,.96732,.968474,.965629,.129412,.92549,.963552,.869666,.254902,.852441,.939254,.736025,.380392,.739254,.890042,.553941,.505882,.60323,.805536,.382238,.631373,.467282,.711419,.235217,.756863,.344252,.608074,.156478,.882353,.2406,.49827,.116494,1,.152941,.392157,.098039]},{ColorSpace:"Lab",Name:"OrPu",RGBPoints:[-1,.176471,0,.294118,-.87451,.272434,.095963,.444214,-.74902,.373395,.228912,.56932,-.623529,.481661,.415917,.657901,-.498039,.601922,.562937,.750481,-.372549,.718493,.695886,.836986,-.247059,.811995,.811534,.898501,-.121569,.894733,.8995,.940023,.00392157,.969166,.966859,.963629,.129412,.98639,.910265,.803691,.254902,.995002,.835371,.624375,.380392,.992541,.736947,.420146,.505882,.931949,.609458,.224221,.631373,.85075,.483968,.069819,.756863,.740023,.380623,.035371,.882353,.617993,.29827,.026759,1,.498039,.231373,.031373]},{ColorSpace:"Lab",Name:"BrBG",RGBPoints:[-1,.329412,.188235,.019608,-.87451,.467205,.269435,.031911,-.74902,.6,.365629,.074202,-.623529,.72549,.483737,.160323,-.498039,.812995,.635832,.336409,-.372549,.88689,.781238,.527874,-.247059,.943483,.87474,.700115,-.121569,.963168,.929796,.841599,.00392157,.957247,.959938,.959554,.129412,.84406,.932872,.920185,.254902,.70396,.886428,.859285,.380392,.529258,.815071,.770704,.505882,.346251,.691811,.653057,.631373,.175855,.562015,.530642,.756863,.047905,.441446,.410073,.882353,.002307,.33218,.294348,1,0,.235294,.188235]},{ColorSpace:"Lab",Name:"GyRd",RGBPoints:[-1,.101961,.101961,.101961,-.87451,.227451,.227451,.227451,-.74902,.359939,.359939,.359939,-.623529,.502653,.502653,.502653,-.498039,.631373,.631373,.631373,-.372549,.749865,.749865,.749865,-.247059,.843368,.843368,.843368,-.121569,.926105,.926105,.926105,.00392157,.999846,.997232,.995694,.129412,.994925,.908651,.857901,.254902,.982468,.800692,.706113,.380392,.960323,.66782,.536332,.505882,.894579,.503806,.399769,.631373,.81707,.33218,.281046,.756863,.728489,.155017,.197386,.882353,.576932,.055363,.14925,1,.403922,0,.121569]},{ColorSpace:"Lab",Name:"erdc_divHi_purpleGreen",RGBPoints:[-1,.297553,0,.489074,-.87451,.40259,.151146,.567754,-.74902,.516038,.284843,.658231,-.623529,.629783,.423646,.750938,-.498039,.735198,.563697,.835956,-.372549,.82408,.695541,.903582,-.247059,.889091,.807454,.944862,-.121569,.92334,.886917,.951839,.00392157,.921045,.921084,.921003,.129412,.877324,.907455,.845381,.254902,.797649,.849713,.734695,.380392,.691646,.75964,.600532,.505882,.568981,.649159,.453807,.631373,.438945,.529756,.304259,.756863,.30973,.412001,.158303,.882353,.187078,.305111,.00251458,1,.101655,.220836,0]},{ColorSpace:"Lab",Name:"erdc_divHi_purpleGreen_dim",RGBPoints:[-1,.404088,.131038,.592767,-.87451,.486469,.230957,.651243,-.74902,.575165,.339335,.717723,-.623529,.662741,.454332,.784263,-.498039,.742071,.570213,.842918,-.372549,.806935,.678992,.886227,-.247059,.852219,.771315,.90763,-.121569,.873345,.837327,.901572,.00392157,.866783,.86682,.866745,.129412,.82839,.858225,.796812,.254902,.762578,.814287,.700202,.380392,.676429,.744229,.585735,.505882,.577033,.65732,.461526,.631373,.47128,.562476,.33476,.756863,.365461,.467957,.21076,.882353,.264758,.381138,.0878313,1,.182591,.312249,0]},{ColorSpace:"Lab",Name:"erdc_divLow_icePeach",RGBPoints:[-1,.480048,.817441,.998056,-.87451,.425898,.726921,.883187,-.74902,.366682,.629445,.761936,-.623529,.308756,.531002,.640217,-.498039,.258021,.43705,.523433,-.372549,.219244,.352381,.416348,-.247059,.195127,.281032,.322979,-.121569,.186286,.22627,.246525,.00392157,.192352,.19236,.192364,.129412,.255927,.214469,.191756,.254902,.340459,.254426,.206666,.380392,.444655,.309315,.234029,.505882,.565353,.376004,.270969,.631373,.697917,.450748,.314293,.756863,.836657,.529064,.360227,.882353,.972695,.614884,.413123,1,1,.705904,.472699]},{ColorSpace:"Lab",Name:"erdc_divLow_purpleGreen",RGBPoints:[-1,.956034,.666487,.952663,-.87451,.874457,.572698,.936352,-.74902,.753465,.488253,.909063,-.623529,.63309,.413507,.763833,-.498039,.514491,.345878,.620015,-.372549,.405008,.288141,.484376,-.247059,.311388,.241986,.363556,-.121569,.238722,.209044,.263449,.00392157,.192352,.192366,.192362,.129412,.200379,.233201,.168618,.254902,.230151,.291737,.165227,.380392,.279481,.366076,.178607,.505882,.344927,.453267,.205703,.631373,.421554,.549449,.242643,.756863,.503334,.649999,.284377,.882353,.583497,.749672,.324969,1,.650705,.837228,.356264]},{ColorSpace:"Lab",Name:"Haze_green",RGBPoints:[-1,1,.835294,.886275,-.87451,.937255,.756863,.870443,-.74902,.875817,.666376,.857807,-.623529,.778359,.583007,.808134,-.498039,.676253,.494118,.745098,-.372549,.561365,.390123,.682353,-.247059,.438344,.262745,.621496,-.121569,.321133,.141031,.558751,.00392157,.203922,.0217865,.495861,.129412,.265505,.129412,.433261,.254902,.311692,.255338,.37008,.380392,.356282,.377342,.310821,.505882,.39971,.488889,.258243,.631373,.442556,.604357,.205519,.756863,.48671,.71968,.152941,.882353,.529847,.830356,.100944,1,.572549,.933333,.054902]},{ColorSpace:"Lab",Name:"Haze_lime",RGBPoints:[-1,.704034,.784196,1,-.87451,.633111,.691418,.956078,-.74902,.564021,.600606,.912157,-.623529,.496827,.51189,.868235,-.498039,.43157,.425416,.824314,-.372549,.368248,.341347,.780392,-.247059,.306767,.259855,.736471,-.121569,.246862,.181069,.692549,.00392157,.191619,.109542,.648627,.129412,.257404,.194031,.604706,.254902,.321794,.278775,.560784,.380392,.387909,.364617,.516863,.505882,.456569,.451881,.472941,.631373,.527424,.540773,.42902,.756863,.599759,.631427,.385098,.882353,.673065,.723898,.341176,1,.742751,.812252,.3]},{ColorSpace:"RGB",Name:"Haze",RGBPoints:[-1,1,.835294,.996078,-.00392157,.023529,.141176,.498039,.00392157,.015686,.137255,.494118,1,.984314,.764706,0]},{ColorSpace:"Lab",Name:"Haze_cyan",RGBPoints:[-1,.956863,1,.835294,-.87451,.933188,.921714,.760784,-.74902,.870588,.803486,.671605,-.623529,.807843,.684096,.583297,-.498039,.745098,.569208,.494118,-.372549,.682353,.437763,.390123,-.247059,.621496,.288163,.262745,-.121569,.558751,.144517,.141031,.00392157,.495861,.0217865,.0413943,.129412,.433261,.137255,.129412,.254902,.37008,.263181,.255338,.380392,.306318,.381845,.372694,.505882,.243137,.503994,.494263,.631373,.180392,.629484,.619753,.756863,.117647,.754975,.747131,.882353,.054902,.876398,.866812,1,0,.988235,.976471]},{ColorSpace:"Lab",Name:"nic_Edge",RGBPoints:[-1,.191208,.191208,.191208,-.87451,.239484,.00545035,.614821,-.74902,.220593,.0617459,.863547,-.623529,.17509,.278988,.97794,-.498039,.143526,.576069,.998553,-.372549,.166456,.871883,.96594,-.247059,.376202,.993555,.981833,-.121569,.681996,.991297,.999239,.00392157,.954172,.952734,.94374,.129412,.999735,.99301,.662896,.254902,.979399,.991466,.357973,.380392,.968771,.854967,.162659,.505882,.999245,.556697,.144323,.631373,.973959,.26223,.177946,.756863,.852358,.0526707,.222974,.882353,.593889,.00912724,.238855,1,.191208,.191208,.191208]},{ColorSpace:"Lab",Name:"erdc_iceFire_H",RGBPoints:[-1,405432e-12,0,590122e-11,-.87451,0,.120401,.302675,-.74902,0,.216583,.524574,-.623529,.0552475,.345025,.6595,-.498039,.128047,.492588,.720288,-.372549,.188955,.641309,.792092,-.247059,.327673,.784935,.873434,-.121569,.60824,.892164,.935547,.00392157,.881371,.912178,.818099,.129412,.951407,.835621,.449279,.254902,.904481,.690489,0,.380392,.85407,.510864,0,.505882,.777093,.33018,88199e-8,.631373,.672862,.139087,.00269398,.756863,.508815,0,0,.882353,.299417,366289e-9,547829e-9,1,.0157519,.00332021,455569e-13]},{ColorSpace:"Lab",Name:"erdc_iceFire_L",RGBPoints:[-1,.870485,.913768,.832905,-.87451,.586919,.887865,.934003,-.74902,.31583,.776442,.867858,-.623529,.18302,.632034,.787722,-.498039,.117909,.484134,.713825,-.372549,.0507239,.335979,.654741,-.247059,0,.209874,.511832,-.121569,0,.114689,.28935,.00392157,.0157519,.00332021,455569e-13,.129412,.312914,0,0,.254902,.520865,0,0,.380392,.680105,.15255,.0025996,.505882,.785109,.339479,797922e-9,.631373,.857354,.522494,0,.756863,.910974,.699774,0,.882353,.951921,.842817,.478545,1,.881371,.912178,.818099]},{ColorSpace:"RGB",Name:"hsv",RGBPoints:[-1,1,0,0,-.666666,1,0,1,-.333333,0,0,1,0,0,1,1,.33333,0,1,0,.66666,1,1,0,1,1,0,0]},{ColorSpace:"Lab",Name:"hue_L60",RGBPoints:[-1,.964784,.400592,.349549,-.87451,.964915,.372498,.53785,-.74902,.892353,.401039,.759569,-.623529,.79263,.446956,.903017,-.498039,.682208,.49954,.966673,-.372549,.56392,.553082,.968836,-.247059,.442031,.606396,.901601,-.121569,.305499,.65701,.765784,.00392157,.197251,.687914,.620914,.129412,.193882,.701887,.472654,.254902,.249866,.706123,.320005,.380392,.35132,.697417,.202919,.505882,.498097,.669467,.125232,.631373,.637477,.626239,.107431,.756863,.762115,.56872,.155812,.882353,.889434,.481116,.240445,1,.964784,.400592,.349549]},{IndexedColors:[0,0,0,.8941176470588236,.1019607843137255,.1098039215686274,.2156862745098039,.4941176470588236,.7215686274509804,.3019607843137255,.6862745098039216,.2901960784313726,.596078431372549,.3058823529411765,.6392156862745098,1,.4980392156862745,0,.6509803921568628,.3372549019607843,.1568627450980392],Name:"Spectrum",NanColor:[.6509803921568628,.3372549019607843,.1568627450980392]},{IndexedColors:[.4745098039215686,.09019607843137255,.09019607843137255,.7098039215686275,.00392156862745098,.00392156862745098,.9372549019607843,.2784313725490196,.09803921568627451,.9764705882352941,.5137254901960784,.1411764705882353,1,.7058823529411765,0,1,.8980392156862745,.02352941176470588],Name:"Warm",NanColor:[1,.8980392156862745,.02352941176470588]},{IndexedColors:[.4588235294117647,.6941176470588235,.00392156862745098,.3450980392156863,.5019607843137255,.1607843137254902,.3137254901960784,.8431372549019608,.7490196078431373,.1098039215686274,.5843137254901961,.803921568627451,.2313725490196079,.407843137254902,.6705882352941176,.6039215686274509,.407843137254902,1,.3725490196078431,.2,.5019607843137255],Name:"Cool",NanColor:[.3725490196078431,.2,.5019607843137255]},{IndexedColors:[.2313725490196079,.407843137254902,.6705882352941176,.1098039215686274,.5843137254901961,.803921568627451,.3058823529411765,.8509803921568627,.9176470588235294,.4509803921568628,.6039215686274509,.8352941176470589,.2588235294117647,.2392156862745098,.6627450980392157,.3137254901960784,.3294117647058823,.5294117647058824,.06274509803921569,.1647058823529412,.3215686274509804],Name:"Blues",NanColor:[.06274509803921569,.1647058823529412,.3215686274509804]},{IndexedColors:[.1098039215686274,.5843137254901961,.803921568627451,.2313725490196079,.407843137254902,.6705882352941176,.4,.2431372549019608,.7176470588235294,.6352941176470588,.3294117647058823,.8117647058823529,.8705882352941177,.3803921568627451,.807843137254902,.8627450980392157,.3803921568627451,.5843137254901961,.2392156862745098,.06274509803921569,.3215686274509804],Name:"Wild Flower",NanColor:[.2392156862745098,.06274509803921569,.3215686274509804]},{IndexedColors:[.396078431372549,.4862745098039216,.2156862745098039,.4588235294117647,.6941176470588235,.00392156862745098,.6980392156862745,.7294117647058823,.1882352941176471,1,.8980392156862745,.02352941176470588,1,.7058823529411765,0,.9764705882352941,.5137254901960784,.1411764705882353],Name:"Citrus",NanColor:[.9764705882352941,.5137254901960784,.1411764705882353]},{IndexedColors:[.4980392156862745,.2313725490196079,.03137254901960784,.7019607843137254,.3450980392156863,.02352941176470588,.8784313725490196,.5098039215686274,.0784313725490196,.9921568627450981,.7215686274509804,.3882352941176471,.996078431372549,.8784313725490196,.7137254901960784,.9686274509803922,.9686274509803922,.9686274509803922,.8470588235294118,.8549019607843137,.9215686274509803,.6980392156862745,.6705882352941176,.8235294117647058,.5019607843137255,.4509803921568628,.6745098039215687,.3294117647058823,.1529411764705882,.5333333333333333,.1764705882352941,0,.2941176470588235],Name:"Brewer Diverging Purple-Orange (11)",NanColor:[.1764705882352941,0,.2941176470588235]},{IndexedColors:[.4980392156862745,.2313725490196079,.03137254901960784,.7019607843137254,.3450980392156863,.02352941176470588,.8784313725490196,.5098039215686274,.0784313725490196,.9921568627450981,.7215686274509804,.3882352941176471,.996078431372549,.8784313725490196,.7137254901960784,.8470588235294118,.8549019607843137,.9215686274509803,.6980392156862745,.6705882352941176,.8235294117647058,.5019607843137255,.4509803921568628,.6745098039215687,.3294117647058823,.1529411764705882,.5333333333333333,.1764705882352941,0,.2941176470588235],Name:"Brewer Diverging Purple-Orange (10)",NanColor:[.1764705882352941,0,.2941176470588235]},{IndexedColors:[.7019607843137254,.3450980392156863,.02352941176470588,.8784313725490196,.5098039215686274,.0784313725490196,.9921568627450981,.7215686274509804,.3882352941176471,.996078431372549,.8784313725490196,.7137254901960784,.9686274509803922,.9686274509803922,.9686274509803922,.8470588235294118,.8549019607843137,.9215686274509803,.6980392156862745,.6705882352941176,.8235294117647058,.5019607843137255,.4509803921568628,.6745098039215687,.3294117647058823,.1529411764705882,.5333333333333333],Name:"Brewer Diverging Purple-Orange (9)",NanColor:[.3294117647058823,.1529411764705882,.5333333333333333]},{IndexedColors:[.7019607843137254,.3450980392156863,.02352941176470588,.8784313725490196,.5098039215686274,.0784313725490196,.9921568627450981,.7215686274509804,.3882352941176471,.996078431372549,.8784313725490196,.7137254901960784,.8470588235294118,.8549019607843137,.9215686274509803,.6980392156862745,.6705882352941176,.8235294117647058,.5019607843137255,.4509803921568628,.6745098039215687,.3294117647058823,.1529411764705882,.5333333333333333],Name:"Brewer Diverging Purple-Orange (8)",NanColor:[.3294117647058823,.1529411764705882,.5333333333333333]},{IndexedColors:[.7019607843137254,.3450980392156863,.02352941176470588,.9450980392156862,.6392156862745098,.2509803921568627,.996078431372549,.8784313725490196,.7137254901960784,.9686274509803922,.9686274509803922,.9686274509803922,.8470588235294118,.8549019607843137,.9215686274509803,.6,.5568627450980392,.7647058823529411,.3294117647058823,.1529411764705882,.5333333333333333],Name:"Brewer Diverging Purple-Orange (7)",NanColor:[.3294117647058823,.1529411764705882,.5333333333333333]},{IndexedColors:[.7019607843137254,.3450980392156863,.02352941176470588,.9450980392156862,.6392156862745098,.2509803921568627,.996078431372549,.8784313725490196,.7137254901960784,.8470588235294118,.8549019607843137,.9215686274509803,.6,.5568627450980392,.7647058823529411,.3294117647058823,.1529411764705882,.5333333333333333],Name:"Brewer Diverging Purple-Orange (6)",NanColor:[.3294117647058823,.1529411764705882,.5333333333333333]},{IndexedColors:[.9019607843137255,.3803921568627451,.00392156862745098,.9921568627450981,.7215686274509804,.3882352941176471,.9686274509803922,.9686274509803922,.9686274509803922,.6980392156862745,.6705882352941176,.8235294117647058,.3686274509803922,.2352941176470588,.6],Name:"Brewer Diverging Purple-Orange (5)",NanColor:[.3686274509803922,.2352941176470588,.6]},{IndexedColors:[.9019607843137255,.3803921568627451,.00392156862745098,.9921568627450981,.7215686274509804,.3882352941176471,.6980392156862745,.6705882352941176,.8235294117647058,.3686274509803922,.2352941176470588,.6],Name:"Brewer Diverging Purple-Orange (4)",NanColor:[.3686274509803922,.2352941176470588,.6]},{IndexedColors:[.9450980392156862,.6392156862745098,.2509803921568627,.9686274509803922,.9686274509803922,.9686274509803922,.6,.5568627450980392,.7647058823529411],Name:"Brewer Diverging Purple-Orange (3)",NanColor:[.6,.5568627450980392,.7647058823529411]},{IndexedColors:[.6196078431372549,.00392156862745098,.2588235294117647,.8352941176470589,.2431372549019608,.3098039215686275,.9568627450980393,.4274509803921568,.2627450980392157,.9921568627450981,.6823529411764706,.3803921568627451,.996078431372549,.8784313725490196,.5450980392156862,1,1,.7490196078431373,.9019607843137255,.9607843137254902,.596078431372549,.6705882352941176,.8666666666666667,.6431372549019608,.4,.7607843137254902,.6470588235294118,.196078431372549,.5333333333333333,.7411764705882353,.3686274509803922,.3098039215686275,.6352941176470588],Name:"Brewer Diverging Spectral (11)",NanColor:[.3686274509803922,.3098039215686275,.6352941176470588]},{IndexedColors:[.6196078431372549,.00392156862745098,.2588235294117647,.8352941176470589,.2431372549019608,.3098039215686275,.9568627450980393,.4274509803921568,.2627450980392157,.9921568627450981,.6823529411764706,.3803921568627451,.996078431372549,.8784313725490196,.5450980392156862,.9019607843137255,.9607843137254902,.596078431372549,.6705882352941176,.8666666666666667,.6431372549019608,.4,.7607843137254902,.6470588235294118,.196078431372549,.5333333333333333,.7411764705882353,.3686274509803922,.3098039215686275,.6352941176470588],Name:"Brewer Diverging Spectral (10)",NanColor:[.3686274509803922,.3098039215686275,.6352941176470588]},{IndexedColors:[.8352941176470589,.2431372549019608,.3098039215686275,.9568627450980393,.4274509803921568,.2627450980392157,.9921568627450981,.6823529411764706,.3803921568627451,.996078431372549,.8784313725490196,.5450980392156862,1,1,.7490196078431373,.9019607843137255,.9607843137254902,.596078431372549,.6705882352941176,.8666666666666667,.6431372549019608,.4,.7607843137254902,.6470588235294118,.196078431372549,.5333333333333333,.7411764705882353],Name:"Brewer Diverging Spectral (9)",NanColor:[.196078431372549,.5333333333333333,.7411764705882353]},{IndexedColors:[.8352941176470589,.2431372549019608,.3098039215686275,.9568627450980393,.4274509803921568,.2627450980392157,.9921568627450981,.6823529411764706,.3803921568627451,.996078431372549,.8784313725490196,.5450980392156862,.9019607843137255,.9607843137254902,.596078431372549,.6705882352941176,.8666666666666667,.6431372549019608,.4,.7607843137254902,.6470588235294118,.196078431372549,.5333333333333333,.7411764705882353],Name:"Brewer Diverging Spectral (8)",NanColor:[.196078431372549,.5333333333333333,.7411764705882353]},{IndexedColors:[.8352941176470589,.2431372549019608,.3098039215686275,.9882352941176471,.5529411764705883,.3490196078431372,.996078431372549,.8784313725490196,.5450980392156862,1,1,.7490196078431373,.9019607843137255,.9607843137254902,.596078431372549,.6,.8352941176470589,.5803921568627451,.196078431372549,.5333333333333333,.7411764705882353],Name:"Brewer Diverging Spectral (7)",NanColor:[.196078431372549,.5333333333333333,.7411764705882353]},{IndexedColors:[.8352941176470589,.2431372549019608,.3098039215686275,.9882352941176471,.5529411764705883,.3490196078431372,.996078431372549,.8784313725490196,.5450980392156862,.9019607843137255,.9607843137254902,.596078431372549,.6,.8352941176470589,.5803921568627451,.196078431372549,.5333333333333333,.7411764705882353],Name:"Brewer Diverging Spectral (6)",NanColor:[.196078431372549,.5333333333333333,.7411764705882353]},{IndexedColors:[.8431372549019608,.09803921568627451,.1098039215686274,.9921568627450981,.6823529411764706,.3803921568627451,1,1,.7490196078431373,.6705882352941176,.8666666666666667,.6431372549019608,.1686274509803922,.5137254901960784,.7294117647058823],Name:"Brewer Diverging Spectral (5)",NanColor:[.1686274509803922,.5137254901960784,.7294117647058823]},{IndexedColors:[.8431372549019608,.09803921568627451,.1098039215686274,.9921568627450981,.6823529411764706,.3803921568627451,.6705882352941176,.8666666666666667,.6431372549019608,.1686274509803922,.5137254901960784,.7294117647058823],Name:"Brewer Diverging Spectral (4)",NanColor:[.1686274509803922,.5137254901960784,.7294117647058823]},{IndexedColors:[.9882352941176471,.5529411764705883,.3490196078431372,1,1,.7490196078431373,.6,.8352941176470589,.5803921568627451],Name:"Brewer Diverging Spectral (3)",NanColor:[.6,.8352941176470589,.5803921568627451]},{IndexedColors:[.3294117647058823,.1882352941176471,.0196078431372549,.5490196078431373,.3176470588235294,.0392156862745098,.7490196078431373,.5058823529411764,.1764705882352941,.8745098039215686,.7607843137254902,.4901960784313725,.9647058823529412,.9098039215686274,.7647058823529411,.9607843137254902,.9607843137254902,.9607843137254902,.7803921568627451,.9176470588235294,.8980392156862745,.5019607843137255,.803921568627451,.7568627450980392,.207843137254902,.592156862745098,.5607843137254902,.00392156862745098,.4,.3686274509803922,0,.2352941176470588,.1882352941176471],Name:"Brewer Diverging Brown-Blue-Green (11)",NanColor:[0,.2352941176470588,.1882352941176471]},{IndexedColors:[.3294117647058823,.1882352941176471,.0196078431372549,.5490196078431373,.3176470588235294,.0392156862745098,.7490196078431373,.5058823529411764,.1764705882352941,.8745098039215686,.7607843137254902,.4901960784313725,.9647058823529412,.9098039215686274,.7647058823529411,.7803921568627451,.9176470588235294,.8980392156862745,.5019607843137255,.803921568627451,.7568627450980392,.207843137254902,.592156862745098,.5607843137254902,.00392156862745098,.4,.3686274509803922,0,.2352941176470588,.1882352941176471],Name:"Brewer Diverging Brown-Blue-Green (10)",NanColor:[0,.2352941176470588,.1882352941176471]},{IndexedColors:[.5490196078431373,.3176470588235294,.0392156862745098,.7490196078431373,.5058823529411764,.1764705882352941,.8745098039215686,.7607843137254902,.4901960784313725,.9647058823529412,.9098039215686274,.7647058823529411,.9607843137254902,.9607843137254902,.9607843137254902,.7803921568627451,.9176470588235294,.8980392156862745,.5019607843137255,.803921568627451,.7568627450980392,.207843137254902,.592156862745098,.5607843137254902,.00392156862745098,.4,.3686274509803922],Name:"Brewer Diverging Brown-Blue-Green (9)",NanColor:[.00392156862745098,.4,.3686274509803922]},{IndexedColors:[.5490196078431373,.3176470588235294,.0392156862745098,.7490196078431373,.5058823529411764,.1764705882352941,.8745098039215686,.7607843137254902,.4901960784313725,.9647058823529412,.9098039215686274,.7647058823529411,.7803921568627451,.9176470588235294,.8980392156862745,.5019607843137255,.803921568627451,.7568627450980392,.207843137254902,.592156862745098,.5607843137254902,.00392156862745098,.4,.3686274509803922],Name:"Brewer Diverging Brown-Blue-Green (8)",NanColor:[.00392156862745098,.4,.3686274509803922]},{IndexedColors:[.5490196078431373,.3176470588235294,.0392156862745098,.8470588235294118,.7019607843137254,.396078431372549,.9647058823529412,.9098039215686274,.7647058823529411,.9607843137254902,.9607843137254902,.9607843137254902,.7803921568627451,.9176470588235294,.8980392156862745,.3529411764705883,.7058823529411765,.6745098039215687,.00392156862745098,.4,.3686274509803922],Name:"Brewer Diverging Brown-Blue-Green (7)",NanColor:[.00392156862745098,.4,.3686274509803922]},{IndexedColors:[.5490196078431373,.3176470588235294,.0392156862745098,.8470588235294118,.7019607843137254,.396078431372549,.9647058823529412,.9098039215686274,.7647058823529411,.7803921568627451,.9176470588235294,.8980392156862745,.3529411764705883,.7058823529411765,.6745098039215687,.00392156862745098,.4,.3686274509803922],Name:"Brewer Diverging Brown-Blue-Green (6)",NanColor:[.00392156862745098,.4,.3686274509803922]},{IndexedColors:[.6509803921568628,.3803921568627451,.1019607843137255,.8745098039215686,.7607843137254902,.4901960784313725,.9607843137254902,.9607843137254902,.9607843137254902,.5019607843137255,.803921568627451,.7568627450980392,.00392156862745098,.5215686274509804,.4431372549019608],Name:"Brewer Diverging Brown-Blue-Green (5)",NanColor:[.00392156862745098,.5215686274509804,.4431372549019608]},{IndexedColors:[.6509803921568628,.3803921568627451,.1019607843137255,.8745098039215686,.7607843137254902,.4901960784313725,.5019607843137255,.803921568627451,.7568627450980392,.00392156862745098,.5215686274509804,.4431372549019608],Name:"Brewer Diverging Brown-Blue-Green (4)",NanColor:[.00392156862745098,.5215686274509804,.4431372549019608]},{IndexedColors:[.8470588235294118,.7019607843137254,.396078431372549,.9607843137254902,.9607843137254902,.9607843137254902,.3529411764705883,.7058823529411765,.6745098039215687],Name:"Brewer Diverging Brown-Blue-Green (3)",NanColor:[.3529411764705883,.7058823529411765,.6745098039215687]},{IndexedColors:[.9686274509803922,.9882352941176471,.9921568627450981,.8980392156862745,.9607843137254902,.9764705882352941,.8,.9254901960784314,.9019607843137255,.6,.8470588235294118,.788235294117647,.4,.7607843137254902,.6431372549019608,.2549019607843137,.6823529411764706,.4627450980392157,.1372549019607843,.5450980392156862,.2705882352941176,0,.4274509803921568,.1725490196078431,0,.2666666666666667,.1058823529411765],Name:"Brewer Sequential Blue-Green (9)",NanColor:[0,.2666666666666667,.1058823529411765]},{IndexedColors:[.9686274509803922,.9882352941176471,.9921568627450981,.8980392156862745,.9607843137254902,.9764705882352941,.8,.9254901960784314,.9019607843137255,.6,.8470588235294118,.788235294117647,.4,.7607843137254902,.6431372549019608,.2549019607843137,.6823529411764706,.4627450980392157,.1372549019607843,.5450980392156862,.2705882352941176,0,.3450980392156863,.1411764705882353],Name:"Brewer Sequential Blue-Green (8)",NanColor:[0,.3450980392156863,.1411764705882353]},{IndexedColors:[.9294117647058824,.9725490196078431,.984313725490196,.8,.9254901960784314,.9019607843137255,.8,.9254901960784314,.9019607843137255,.4,.7607843137254902,.6431372549019608,.2549019607843137,.6823529411764706,.4627450980392157,.1372549019607843,.5450980392156862,.2705882352941176,0,.3450980392156863,.1411764705882353],Name:"Brewer Sequential Blue-Green (7)",NanColor:[0,.3450980392156863,.1411764705882353]},{IndexedColors:[.9294117647058824,.9725490196078431,.984313725490196,.8,.9254901960784314,.9019607843137255,.6,.8470588235294118,.788235294117647,.4,.7607843137254902,.6431372549019608,.1725490196078431,.6352941176470588,.3725490196078431,0,.4274509803921568,.1725490196078431],Name:"Brewer Sequential Blue-Green (6)",NanColor:[0,.4274509803921568,.1725490196078431]},{IndexedColors:[.9294117647058824,.9725490196078431,.984313725490196,.6980392156862745,.8862745098039215,.8862745098039215,.4,.7607843137254902,.6431372549019608,.1725490196078431,.6352941176470588,.3725490196078431,0,.4274509803921568,.1725490196078431],Name:"Brewer Sequential Blue-Green (5)",NanColor:[0,.4274509803921568,.1725490196078431]},{IndexedColors:[.9294117647058824,.9725490196078431,.984313725490196,.6980392156862745,.8862745098039215,.8862745098039215,.4,.7607843137254902,.6431372549019608,.1372549019607843,.5450980392156862,.2705882352941176],Name:"Brewer Sequential Blue-Green (4)",NanColor:[.1372549019607843,.5450980392156862,.2705882352941176]},{IndexedColors:[.8980392156862745,.9607843137254902,.9764705882352941,.6,.8470588235294118,.788235294117647,.1725490196078431,.6352941176470588,.3725490196078431],Name:"Brewer Sequential Blue-Green (3)",NanColor:[.1725490196078431,.6352941176470588,.3725490196078431]},{IndexedColors:[1,1,.8980392156862745,1,.9686274509803922,.7372549019607844,.996078431372549,.8901960784313725,.5686274509803921,.996078431372549,.7686274509803922,.3098039215686275,.996078431372549,.6,.1607843137254902,.9254901960784314,.4392156862745098,.0784313725490196,.8,.2980392156862745,.00784313725490196,.6,.203921568627451,.01568627450980392,.4,.1450980392156863,.02352941176470588],Name:"Brewer Sequential Yellow-Orange-Brown (9)",NanColor:[.4,.1450980392156863,.02352941176470588]},{IndexedColors:[1,1,.8980392156862745,1,.9686274509803922,.7372549019607844,.996078431372549,.8901960784313725,.5686274509803921,.996078431372549,.7686274509803922,.3098039215686275,.996078431372549,.6,.1607843137254902,.9254901960784314,.4392156862745098,.0784313725490196,.8,.2980392156862745,.00784313725490196,.5490196078431373,.1764705882352941,.01568627450980392],Name:"Brewer Sequential Yellow-Orange-Brown (8)",NanColor:[.5490196078431373,.1764705882352941,.01568627450980392]},{IndexedColors:[1,1,.8313725490196079,.996078431372549,.8901960784313725,.5686274509803921,.996078431372549,.7686274509803922,.3098039215686275,.996078431372549,.6,.1607843137254902,.9254901960784314,.4392156862745098,.0784313725490196,.8,.2980392156862745,.00784313725490196,.5490196078431373,.1764705882352941,.01568627450980392],Name:"Brewer Sequential Yellow-Orange-Brown (7)",NanColor:[.5490196078431373,.1764705882352941,.01568627450980392]},{IndexedColors:[1,1,.8313725490196079,.996078431372549,.8901960784313725,.5686274509803921,.996078431372549,.7686274509803922,.3098039215686275,.996078431372549,.6,.1607843137254902,.8509803921568627,.3725490196078431,.05490196078431372,.6,.203921568627451,.01568627450980392],Name:"Brewer Sequential Yellow-Orange-Brown (6)",NanColor:[.6,.203921568627451,.01568627450980392]},{IndexedColors:[1,1,.8313725490196079,.996078431372549,.8509803921568627,.5568627450980392,.996078431372549,.6,.1607843137254902,.8509803921568627,.3725490196078431,.05490196078431372,.6,.203921568627451,.01568627450980392],Name:"Brewer Sequential Yellow-Orange-Brown (5)",NanColor:[.6,.203921568627451,.01568627450980392]},{IndexedColors:[1,1,.8313725490196079,.996078431372549,.8509803921568627,.5568627450980392,.996078431372549,.6,.1607843137254902,.8,.2980392156862745,.00784313725490196],Name:"Brewer Sequential Yellow-Orange-Brown (4)",NanColor:[.8,.2980392156862745,.00784313725490196]},{IndexedColors:[1,.9686274509803922,.7372549019607844,.996078431372549,.7686274509803922,.3098039215686275,.8509803921568627,.3725490196078431,.05490196078431372],Name:"Brewer Sequential Yellow-Orange-Brown (3)",NanColor:[.8509803921568627,.3725490196078431,.05490196078431372]},{IndexedColors:[.9686274509803922,.9882352941176471,.9921568627450981,.8784313725490196,.9254901960784314,.9568627450980393,.7490196078431373,.8274509803921568,.9019607843137255,.6196078431372549,.7372549019607844,.8549019607843137,.5490196078431373,.5882352941176471,.7764705882352941,.5490196078431373,.4196078431372549,.6941176470588235,.5333333333333333,.2549019607843137,.615686274509804,.5058823529411764,.05882352941176471,.4862745098039216,.3019607843137255,0,.2941176470588235],Name:"Brewer Sequential Blue-Purple (9)",NanColor:[.3019607843137255,0,.2941176470588235]},{IndexedColors:[.9686274509803922,.9882352941176471,.9921568627450981,.8784313725490196,.9254901960784314,.9568627450980393,.7490196078431373,.8274509803921568,.9019607843137255,.6196078431372549,.7372549019607844,.8549019607843137,.5490196078431373,.5882352941176471,.7764705882352941,.5490196078431373,.4196078431372549,.6941176470588235,.5333333333333333,.2549019607843137,.615686274509804,.4313725490196079,.00392156862745098,.4196078431372549],Name:"Brewer Sequential Blue-Purple (8)",NanColor:[.4313725490196079,.00392156862745098,.4196078431372549]},{IndexedColors:[.9294117647058824,.9725490196078431,.984313725490196,.7490196078431373,.8274509803921568,.9019607843137255,.6196078431372549,.7372549019607844,.8549019607843137,.5490196078431373,.5882352941176471,.7764705882352941,.5490196078431373,.4196078431372549,.6941176470588235,.5333333333333333,.2549019607843137,.615686274509804,.4313725490196079,.00392156862745098,.4196078431372549],Name:"Brewer Sequential Blue-Purple (7)",NanColor:[.4313725490196079,.00392156862745098,.4196078431372549]},{IndexedColors:[.9294117647058824,.9725490196078431,.984313725490196,.7490196078431373,.8274509803921568,.9019607843137255,.6196078431372549,.7372549019607844,.8549019607843137,.5490196078431373,.5882352941176471,.7764705882352941,.5333333333333333,.3372549019607843,.6549019607843137,.5058823529411764,.05882352941176471,.4862745098039216],Name:"Brewer Sequential Blue-Purple (6)",NanColor:[.5058823529411764,.05882352941176471,.4862745098039216]},{IndexedColors:[.9294117647058824,.9725490196078431,.984313725490196,.7019607843137254,.803921568627451,.8901960784313725,.5490196078431373,.5882352941176471,.7764705882352941,.5333333333333333,.3372549019607843,.6549019607843137,.5058823529411764,.05882352941176471,.4862745098039216],Name:"Brewer Sequential Blue-Purple (5)",NanColor:[.5058823529411764,.05882352941176471,.4862745098039216]},{IndexedColors:[.9294117647058824,.9725490196078431,.984313725490196,.7019607843137254,.803921568627451,.8901960784313725,.5490196078431373,.5882352941176471,.7764705882352941,.5333333333333333,.2549019607843137,.615686274509804],Name:"Brewer Sequential Blue-Purple (4)",NanColor:[.5333333333333333,.2549019607843137,.615686274509804]},{IndexedColors:[.8784313725490196,.9254901960784314,.9568627450980393,.6196078431372549,.7372549019607844,.8549019607843137,.5333333333333333,.3372549019607843,.6549019607843137],Name:"Brewer Sequential Blue-Purple (3)",NanColor:[.5333333333333333,.3372549019607843,.6549019607843137]},{IndexedColors:[.4980392156862745,.788235294117647,.4980392156862745,.7450980392156863,.6823529411764706,.8313725490196079,.9921568627450981,.7529411764705882,.5254901960784314,1,1,.6,.2196078431372549,.4235294117647059,.6901960784313725,.9411764705882353,.00784313725490196,.4980392156862745,.7490196078431373,.3568627450980392,.09019607843137255,.4,.4,.4],Name:"Brewer Qualitative Accent",NanColor:[.4,.4,.4]},{IndexedColors:[.1058823529411765,.6196078431372549,.4666666666666667,.8509803921568627,.3725490196078431,.00784313725490196,.4588235294117647,.4392156862745098,.7019607843137254,.9058823529411765,.1607843137254902,.5411764705882353,.4,.6509803921568628,.1176470588235294,.9019607843137255,.6705882352941176,.00784313725490196,.6509803921568628,.4627450980392157,.1137254901960784,.4,.4,.4],Name:"Brewer Qualitative Dark2",NanColor:[.4,.4,.4]},{IndexedColors:[.4,.7607843137254902,.6470588235294118,.9882352941176471,.5529411764705883,.3843137254901961,.5529411764705883,.6274509803921569,.796078431372549,.9058823529411765,.5411764705882353,.7647058823529411,.6509803921568628,.8470588235294118,.3294117647058823,1,.8509803921568627,.1843137254901961,.8980392156862745,.7686274509803922,.5803921568627451,.7019607843137254,.7019607843137254,.7019607843137254],Name:"Brewer Qualitative Set2",NanColor:[.7019607843137254,.7019607843137254,.7019607843137254]},{IndexedColors:[.7019607843137254,.8862745098039215,.803921568627451,.9921568627450981,.803921568627451,.6745098039215687,.796078431372549,.8352941176470589,.9098039215686274,.9568627450980393,.792156862745098,.8941176470588236,.9019607843137255,.9607843137254902,.788235294117647,1,.9490196078431372,.6823529411764706,.9450980392156862,.8862745098039215,.8,.8,.8,.8],Name:"Brewer Qualitative Pastel2",NanColor:[.8,.8,.8]},{IndexedColors:[.984313725490196,.7058823529411765,.6823529411764706,.7019607843137254,.803921568627451,.8901960784313725,.8,.9215686274509803,.7725490196078432,.8705882352941177,.796078431372549,.8941176470588236,.996078431372549,.8509803921568627,.6509803921568628,1,1,.8,.8980392156862745,.8470588235294118,.7411764705882353,.9921568627450981,.8549019607843137,.9254901960784314,.9490196078431372,.9490196078431372,.9490196078431372],Name:"Brewer Qualitative Pastel1",NanColor:[.9490196078431372,.9490196078431372,.9490196078431372]},{IndexedColors:[.8941176470588236,.1019607843137255,.1098039215686274,.2156862745098039,.4941176470588236,.7215686274509804,.3019607843137255,.6862745098039216,.2901960784313726,.596078431372549,.3058823529411765,.6392156862745098,1,.4980392156862745,0,1,1,.2,.6509803921568628,.3372549019607843,.1568627450980392,.9686274509803922,.5058823529411764,.7490196078431373,.6,.6,.6],Name:"Brewer Qualitative Set1",NanColor:[.6,.6,.6]},{IndexedColors:[.6509803921568628,.807843137254902,.8901960784313725,.1215686274509804,.4705882352941176,.7058823529411765,.6980392156862745,.8745098039215686,.5411764705882353,.2,.6274509803921569,.1725490196078431,.984313725490196,.6039215686274509,.6,.8901960784313725,.1019607843137255,.1098039215686274,.9921568627450981,.7490196078431373,.4352941176470588,1,.4980392156862745,0,.792156862745098,.6980392156862745,.8392156862745098,.4156862745098039,.2392156862745098,.6039215686274509,1,1,.6],Name:"Brewer Qualitative Paired",NanColor:[1,1,.6]},{IndexedColors:[.5529411764705883,.8274509803921568,.7803921568627451,1,1,.7019607843137254,.7450980392156863,.7294117647058823,.8549019607843137,.984313725490196,.5019607843137255,.4470588235294118,.5019607843137255,.6941176470588235,.8274509803921568,.9921568627450981,.7058823529411765,.3843137254901961,.7019607843137254,.8705882352941177,.4117647058823529,.9882352941176471,.803921568627451,.8980392156862745,.8509803921568627,.8509803921568627,.8509803921568627,.7372549019607844,.5019607843137255,.7411764705882353,.8,.9215686274509803,.7725490196078432,1,.9294117647058824,.4352941176470588],Name:"Brewer Qualitative Set3",NanColor:[1,.9294117647058824,.4352941176470588]},{IndexedColors:[1,0,0,1,.862745,0,0,.695201,0],Name:"Traffic Lights",NanColor:[.803922,0,.803922]},{IndexedColors:[.908659,.604013,.581857,1,.862745,0,0,.695201,0],Name:"Traffic Lights For Deuteranopes",NanColor:[.803922,0,.803922]},{IndexedColors:[.4196078431372549,0,.07058823529411765,.9019607843137255,.9411764705882353,.0196078431372549,.01568627450980392,.6196078431372549,.00784313725490196],Name:"Traffic Lights For Deuteranopes 2",NanColor:[.803922,0,.803922]},{ColorSpace:"Lab",Creator:"Francesca Samsel",Name:"Muted Blue-Green",NanColor:[.25,0,0],RGBPoints:[0,.109804,.27451,.301961,.02,.129412,.309804,.341176,.05,.14902,.341176,.380392,.1,.188235,.403922,.458824,.15,.227451,.447059,.521569,.2,.290196,.494118,.588235,.25,.368627,.552941,.670588,.3,.458824,.619608,.74902,.35,.588235,.713725,.85098,.4,.72549,.815686,.941176,.45,.831373,.882353,.980392,.475,.909804,.933333,1,.5,.980392,.984314,1,.5,.996078,1,.94902,.5,1,1,.980392,.5,.980392,.984314,1,.525,.972549,.988235,.890196,.55,.917647,.960784,.835294,.6,.835294,.921569,.772549,.65,.768627,.901961,.737255,.7,.670588,.831373,.654902,.75,.576471,.760784,.584314,.8,.498039,.678431,.521569,.85,.392157,.560784,.427451,.9,.294118,.45098,.333333,.95,.211765,.34902,.254902,1,.152941,.278431,.196078]},{ColorSpace:"Lab",Creator:"Francesca Samsel",Name:"Green-Blue Asymmetric Divergent (62Blbc)",NanColor:[.25,0,0],RGBPoints:[0,.121569,.2,.145098,.05,.196078,.301961,.223529,.1,.258824,.4,.278431,.2,.341176,.54902,.341176,.25,.419608,.619608,.376471,.3,.545098,.701961,.392157,.35,.643137,.780392,.403922,.4,.729412,.819608,.45098,.45,.811765,.870588,.521569,.5,.898039,.909804,.564706,.55,.941176,.92549,.686275,.6,.960784,.94902,.776471,.64,1,1,1,.65,.890196,.988235,.972549,.7,.721569,.894118,.901961,.75,.631373,.823529,.839216,.8,.517647,.662745,.701961,.85,.384314,.494118,.54902,.9,.298039,.360784,.45098,.95,.223529,.25098,.34902,.99,.156863,.172549,.25098,1,.137255,.137255,.188235]},{ColorSpace:"Lab",Creator:"Francesca Samsel",Name:"Asymmtrical Earth Tones (6_21b)",NanColor:[.25,0,0],RGBPoints:[0,.141176,.14902,.2,.05,.215686,.258824,.321569,.1,.243137,.368627,.380392,.15,.27451,.439216,.4,.2,.32549,.501961,.384314,.25,.403922,.6,.419608,.3,.486275,.701961,.454902,.35,.556863,.74902,.494118,.4,.670588,.8,.545098,.5,.854902,.901961,.631373,.55,.92549,.941176,.694118,.6,.960784,.94902,.776471,.65,.988235,.968627,.909804,.7,.839216,.815686,.772549,.75,.701961,.662745,.615686,.8,.6,.529412,.478431,.85,.501961,.403922,.360784,.9,.439216,.313725,.290196,1,.301961,.164706,.176471]},{ColorSpace:"Lab",Creator:"Francesca Samsel",Name:"Yellow 15",NanColor:[.25,0,0],RGBPoints:[0,1,1,.988235,.002,1,1,.988235,.05,.984314,.988235,.843137,.1,.988235,.988235,.741176,.15,.980392,.968627,.654902,.2,.980392,.945098,.576471,.25,.968627,.905882,.486275,.3,.968627,.862745,.388235,.35,.960784,.803922,.286275,.4,.94902,.741176,.219608,.45,.941176,.678431,.14902,.5,.929412,.607843,.094118,.55,.921569,.545098,.054902,.6,.909804,.486275,.035294,.65,.890196,.411765,.019608,.7,.8,.305882,0,.75,.760784,.239216,0,.8,.678431,.180392,.011765,.85,.6,.121569,.023529,.9,.501961,.054902,.031373,.95,.4,.039216,.058824,1,.301961,.047059,.090196]},{ColorSpace:"Diverging",Name:"Magma (matplotlib)",NanColor:[0,1,0],Source:"https://github.com/BIDS/colormap/blob/master/colormaps.py",License:"CC0",Creator:"Nathaniel J. Smith & Stefan van der Walt",RGBPoints:[0,.001462,466e-6,.013866,.003922,.002258,.001295,.018331,.007843,.003279,.002305,.023708,.011765,.004512,.00349,.029965,.015686,.00595,.004843,.03713,.019608,.007588,.006356,.044973,.023529,.009426,.008022,.052844,.027451,.011465,.009828,.06075,.031373,.013708,.011771,.068667,.035294,.016156,.01384,.076603,.039216,.018815,.016026,.084584,.043137,.021692,.01832,.09261,.047059,.024792,.020715,.100676,.05098,.028123,.023201,.108787,.054902,.031696,.025765,.116965,.058824,.03552,.028397,.125209,.062745,.039608,.03109,.133515,.066667,.04383,.03383,.141886,.070588,.048062,.036607,.150327,.07451,.05232,.039407,.158841,.078431,.056615,.04216,.167446,.082353,.060949,.044794,.176129,.086275,.06533,.047318,.184892,.090196,.069764,.049726,.193735,.094118,.074257,.052017,.20266,.098039,.078815,.054184,.211667,.101961,.083446,.056225,.220755,.105882,.088155,.058133,.229922,.109804,.092949,.059904,.239164,.113725,.097833,.061531,.248477,.117647,.102815,.06301,.257854,.121569,.107899,.064335,.267289,.12549,.113094,.065492,.276784,.129412,.118405,.066479,.286321,.133333,.123833,.067295,.295879,.137255,.12938,.067935,.305443,.141176,.135053,.068391,.315,.145098,.140858,.068654,.324538,.14902,.146785,.068738,.334011,.152941,.152839,.068637,.343404,.156863,.159018,.068354,.352688,.160784,.165308,.067911,.361816,.164706,.171713,.067305,.370771,.168627,.178212,.066576,.379497,.172549,.184801,.065732,.387973,.176471,.19146,.064818,.396152,.180392,.198177,.063862,.404009,.184314,.204935,.062907,.411514,.188235,.211718,.061992,.418647,.192157,.218512,.061158,.425392,.196078,.225302,.060445,.431742,.2,.232077,.059889,.437695,.203922,.238826,.059517,.443256,.207843,.245543,.059352,.448436,.211765,.25222,.059415,.453248,.215686,.258857,.059706,.45771,.219608,.265447,.060237,.46184,.223529,.271994,.060994,.46566,.227451,.278493,.061978,.46919,.231373,.284951,.063168,.472451,.235294,.291366,.064553,.475462,.239216,.29774,.066117,.478243,.243137,.304081,.067835,.480812,.247059,.310382,.069702,.483186,.25098,.316654,.07169,.48538,.254902,.322899,.073782,.487408,.258824,.329114,.075972,.489287,.262745,.335308,.078236,.491024,.266667,.341482,.080564,.492631,.270588,.347636,.082946,.494121,.27451,.353773,.085373,.495501,.278431,.359898,.087831,.496778,.282353,.366012,.090314,.49796,.286275,.372116,.092816,.499053,.290196,.378211,.095332,.500067,.294118,.384299,.097855,.501002,.298039,.390384,.100379,.501864,.301961,.396467,.102902,.502658,.305882,.402548,.10542,.503386,.309804,.408629,.10793,.504052,.313725,.414709,.110431,.504662,.317647,.420791,.11292,.505215,.321569,.426877,.115395,.505714,.32549,.432967,.117855,.50616,.329412,.439062,.120298,.506555,.333333,.445163,.122724,.506901,.337255,.451271,.125132,.507198,.341176,.457386,.127522,.507448,.345098,.463508,.129893,.507652,.34902,.46964,.132245,.507809,.352941,.47578,.134577,.507921,.356863,.481929,.136891,.507989,.360784,.488088,.139186,.508011,.364706,.494258,.141462,.507988,.368627,.500438,.143719,.50792,.372549,.506629,.145958,.507806,.376471,.512831,.148179,.507648,.380392,.519045,.150383,.507443,.384314,.52527,.152569,.507192,.388235,.531507,.154739,.506895,.392157,.537755,.156894,.506551,.396078,.544015,.159033,.506159,.4,.550287,.161158,.505719,.403922,.556571,.163269,.50523,.407843,.562866,.165368,.504692,.411765,.569172,.167454,.504105,.415686,.57549,.16953,.503466,.419608,.581819,.171596,.502777,.423529,.588158,.173652,.502035,.427451,.594508,.175701,.501241,.431373,.600868,.177743,.500394,.435294,.607238,.179779,.499492,.439216,.613617,.181811,.498536,.443137,.620005,.18384,.497524,.447059,.626401,.185867,.496456,.45098,.632805,.187893,.495332,.454902,.639216,.189921,.49415,.458824,.645633,.191952,.49291,.462745,.652056,.193986,.491611,.466667,.658483,.196027,.490253,.470588,.664915,.198075,.488836,.47451,.671349,.200133,.487358,.478431,.677786,.202203,.485819,.482353,.684224,.204286,.484219,.486275,.690661,.206384,.482558,.490196,.697098,.208501,.480835,.494118,.703532,.210638,.479049,.498039,.709962,.212797,.477201,.501961,.716387,.214982,.47529,.505882,.722805,.217194,.473316,.509804,.729216,.219437,.471279,.513725,.735616,.221713,.46918,.517647,.742004,.224025,.467018,.521569,.748378,.226377,.464794,.52549,.754737,.228772,.462509,.529412,.761077,.231214,.460162,.533333,.767398,.233705,.457755,.537255,.773695,.236249,.455289,.541176,.779968,.238851,.452765,.545098,.786212,.241514,.450184,.54902,.792427,.244242,.447543,.552941,.798608,.24704,.444848,.556863,.804752,.249911,.442102,.560784,.810855,.252861,.439305,.564706,.816914,.255895,.436461,.568627,.822926,.259016,.433573,.572549,.828886,.262229,.430644,.576471,.834791,.26554,.427671,.580392,.840636,.268953,.424666,.584314,.846416,.272473,.421631,.588235,.852126,.276106,.418573,.592157,.857763,.279857,.415496,.596078,.86332,.283729,.412403,.6,.868793,.287728,.409303,.603922,.874176,.291859,.406205,.607843,.879464,.296125,.403118,.611765,.884651,.30053,.400047,.615686,.889731,.305079,.397002,.619608,.8947,.309773,.393995,.623529,.899552,.314616,.391037,.627451,.904281,.31961,.388137,.631373,.908884,.324755,.385308,.635294,.913354,.330052,.382563,.639216,.917689,.3355,.379915,.643137,.921884,.341098,.377376,.647059,.925937,.346844,.374959,.65098,.929845,.352734,.372677,.654902,.933606,.358764,.370541,.658824,.937221,.364929,.368567,.662745,.940687,.371224,.366762,.666667,.944006,.377643,.365136,.670588,.94718,.384178,.363701,.67451,.95021,.39082,.362468,.678431,.953099,.397563,.361438,.682353,.955849,.4044,.360619,.686275,.958464,.411324,.360014,.690196,.960949,.418323,.35963,.694118,.96331,.42539,.359469,.698039,.965549,.432519,.359529,.701961,.967671,.439703,.35981,.705882,.96968,.446936,.360311,.709804,.971582,.45421,.36103,.713725,.973381,.46152,.361965,.717647,.975082,.468861,.363111,.721569,.97669,.476226,.364466,.72549,.97821,.483612,.366025,.729412,.979645,.491014,.367783,.733333,.981,.498428,.369734,.737255,.982279,.505851,.371874,.741176,.983485,.51328,.374198,.745098,.984622,.520713,.376698,.74902,.985693,.528148,.379371,.752941,.9867,.535582,.38221,.756863,.987646,.543015,.38521,.760784,.988533,.550446,.388365,.764706,.989363,.557873,.391671,.768627,.990138,.565296,.395122,.772549,.990871,.572706,.398714,.776471,.991558,.580107,.402441,.780392,.992196,.587502,.406299,.784314,.992785,.594891,.410283,.788235,.993326,.602275,.41439,.792157,.993834,.609644,.418613,.796078,.994309,.616999,.42295,.8,.994738,.62435,.427397,.803922,.995122,.631696,.431951,.807843,.99548,.639027,.436607,.811765,.99581,.646344,.441361,.815686,.996096,.653659,.446213,.819608,.996341,.660969,.45116,.823529,.99658,.668256,.456192,.827451,.996775,.675541,.461314,.831373,.996925,.682828,.466526,.835294,.997077,.690088,.471811,.839216,.997186,.697349,.477182,.843137,.997254,.704611,.482635,.847059,.997325,.711848,.488154,.85098,.997351,.719089,.493755,.854902,.997351,.726324,.499428,.858824,.997341,.733545,.505167,.862745,.997285,.740772,.510983,.866667,.997228,.747981,.516859,.870588,.997138,.75519,.522806,.87451,.997019,.762398,.528821,.878431,.996898,.769591,.534892,.882353,.996727,.776795,.541039,.886275,.996571,.783977,.547233,.890196,.996369,.791167,.553499,.894118,.996162,.798348,.55982,.898039,.995932,.805527,.566202,.901961,.99568,.812706,.572645,.905882,.995424,.819875,.57914,.909804,.995131,.827052,.585701,.913725,.994851,.834213,.592307,.917647,.994524,.841387,.598983,.921569,.994222,.84854,.605696,.92549,.993866,.855711,.612482,.929412,.993545,.862859,.619299,.933333,.99317,.870024,.626189,.937255,.992831,.877168,.633109,.941176,.99244,.88433,.640099,.945098,.992089,.89147,.647116,.94902,.991688,.898627,.654202,.952941,.991332,.905763,.661309,.956863,.99093,.912915,.668481,.960784,.99057,.920049,.675675,.964706,.990175,.927196,.682926,.968627,.989815,.934329,.690198,.972549,.989434,.94147,.697519,.976471,.989077,.948604,.704863,.980392,.988717,.955742,.712242,.984314,.988367,.962878,.719649,.988235,.988033,.970012,.727077,.992157,.987691,.977154,.734536,.996078,.987387,.984288,.742002,1,.987053,.991438,.749504]},{ColorSpace:"Diverging",Name:"Inferno (matplotlib)",NanColor:[0,1,0],Source:"https://github.com/BIDS/colormap/blob/master/colormaps.py",License:"CC0",Creator:"Nathaniel J. Smith & Stefan van der Walt",RGBPoints:[0,.001462,466e-6,.013866,.003922,.002267,.00127,.01857,.007843,.003299,.002249,.024239,.011765,.004547,.003392,.030909,.015686,.006006,.004692,.038558,.019608,.007676,.006136,.046836,.023529,.009561,.007713,.055143,.027451,.011663,.009417,.06346,.031373,.013995,.011225,.071862,.035294,.016561,.013136,.080282,.039216,.019373,.015133,.088767,.043137,.022447,.017199,.097327,.047059,.025793,.019331,.10593,.05098,.029432,.021503,.114621,.054902,.033385,.023702,.123397,.058824,.037668,.025921,.132232,.062745,.042253,.028139,.141141,.066667,.046915,.030324,.150164,.070588,.051644,.032474,.159254,.07451,.056449,.034569,.168414,.078431,.06134,.03659,.177642,.082353,.066331,.038504,.186962,.086275,.071429,.040294,.196354,.090196,.076637,.041905,.205799,.094118,.081962,.043328,.215289,.098039,.087411,.044556,.224813,.101961,.09299,.045583,.234358,.105882,.098702,.046402,.243904,.109804,.104551,.047008,.25343,.113725,.110536,.047399,.262912,.117647,.116656,.047574,.272321,.121569,.122908,.047536,.281624,.12549,.129285,.047293,.290788,.129412,.135778,.046856,.299776,.133333,.142378,.046242,.308553,.137255,.149073,.045468,.317085,.141176,.15585,.044559,.325338,.145098,.162689,.043554,.333277,.14902,.169575,.042489,.340874,.152941,.176493,.041402,.348111,.156863,.183429,.040329,.354971,.160784,.190367,.039309,.361447,.164706,.197297,.0384,.367535,.168627,.204209,.037632,.373238,.172549,.211095,.03703,.378563,.176471,.217949,.036615,.383522,.180392,.224763,.036405,.388129,.184314,.231538,.036405,.3924,.188235,.238273,.036621,.396353,.192157,.244967,.037055,.400007,.196078,.25162,.037705,.403378,.2,.258234,.038571,.406485,.203922,.26481,.039647,.409345,.207843,.271347,.040922,.411976,.211765,.27785,.042353,.414392,.215686,.284321,.043933,.416608,.219608,.290763,.045644,.418637,.223529,.297178,.04747,.420491,.227451,.303568,.049396,.422182,.231373,.309935,.051407,.423721,.235294,.316282,.05349,.425116,.239216,.32261,.055634,.426377,.243137,.328921,.057827,.427511,.247059,.335217,.06006,.428524,.25098,.3415,.062325,.429425,.254902,.347771,.064616,.430217,.258824,.354032,.066925,.430906,.262745,.360284,.069247,.431497,.266667,.366529,.071579,.431994,.270588,.372768,.073915,.4324,.27451,.379001,.076253,.432719,.278431,.385228,.078591,.432955,.282353,.391453,.080927,.433109,.286275,.397674,.083257,.433183,.290196,.403894,.08558,.433179,.294118,.410113,.087896,.433098,.298039,.416331,.090203,.432943,.301961,.422549,.092501,.432714,.305882,.428768,.09479,.432412,.309804,.434987,.097069,.432039,.313725,.441207,.099338,.431594,.317647,.447428,.101597,.43108,.321569,.453651,.103848,.430498,.32549,.459875,.106089,.429846,.329412,.4661,.108322,.429125,.333333,.472328,.110547,.428334,.337255,.478558,.112764,.427475,.341176,.484789,.114974,.426548,.345098,.491022,.117179,.425552,.34902,.497257,.119379,.424488,.352941,.503493,.121575,.423356,.356863,.50973,.123769,.422156,.360784,.515967,.12596,.420887,.364706,.522206,.12815,.419549,.368627,.528444,.130341,.418142,.372549,.534683,.132534,.416667,.376471,.54092,.134729,.415123,.380392,.547157,.136929,.413511,.384314,.553392,.139134,.411829,.388235,.559624,.141346,.410078,.392157,.565854,.143567,.408258,.396078,.572081,.145797,.406369,.4,.578304,.148039,.404411,.403922,.584521,.150294,.402385,.407843,.590734,.152563,.40029,.411765,.59694,.154848,.398125,.415686,.603139,.157151,.395891,.419608,.60933,.159474,.393589,.423529,.615513,.161817,.391219,.427451,.621685,.164184,.388781,.431373,.627847,.166575,.386276,.435294,.633998,.168992,.383704,.439216,.640135,.171438,.381065,.443137,.64626,.173914,.378359,.447059,.652369,.176421,.375586,.45098,.658463,.178962,.372748,.454902,.66454,.181539,.369846,.458824,.670599,.184153,.366879,.462745,.676638,.186807,.363849,.466667,.682656,.189501,.360757,.470588,.688653,.192239,.357603,.47451,.694627,.195021,.354388,.478431,.700576,.197851,.351113,.482353,.7065,.200728,.347777,.486275,.712396,.203656,.344383,.490196,.718264,.206636,.340931,.494118,.724103,.20967,.337424,.498039,.729909,.212759,.333861,.501961,.735683,.215906,.330245,.505882,.741423,.219112,.326576,.509804,.747127,.222378,.322856,.513725,.752794,.225706,.319085,.517647,.758422,.229097,.315266,.521569,.76401,.232554,.311399,.52549,.769556,.236077,.307485,.529412,.775059,.239667,.303526,.533333,.780517,.243327,.299523,.537255,.785929,.247056,.295477,.541176,.791293,.250856,.29139,.545098,.796607,.254728,.287264,.54902,.801871,.258674,.283099,.552941,.807082,.262692,.278898,.556863,.812239,.266786,.274661,.560784,.817341,.270954,.27039,.564706,.822386,.275197,.266085,.568627,.827372,.279517,.26175,.572549,.832299,.283913,.257383,.576471,.837165,.288385,.252988,.580392,.841969,.292933,.248564,.584314,.846709,.297559,.244113,.588235,.851384,.30226,.239636,.592157,.855992,.307038,.235133,.596078,.860533,.311892,.230606,.6,.865006,.316822,.226055,.603922,.869409,.321827,.221482,.607843,.873741,.326906,.216886,.611765,.878001,.33206,.212268,.615686,.882188,.337287,.207628,.619608,.886302,.342586,.202968,.623529,.890341,.347957,.198286,.627451,.894305,.353399,.193584,.631373,.898192,.358911,.18886,.635294,.902003,.364492,.184116,.639216,.905735,.37014,.17935,.643137,.90939,.375856,.174563,.647059,.912966,.381636,.169755,.65098,.916462,.387481,.164924,.654902,.919879,.393389,.16007,.658824,.923215,.399359,.155193,.662745,.92647,.405389,.150292,.666667,.929644,.411479,.145367,.670588,.932737,.417627,.140417,.67451,.935747,.423831,.13544,.678431,.938675,.430091,.130438,.682353,.941521,.436405,.125409,.686275,.944285,.442772,.120354,.690196,.946965,.449191,.115272,.694118,.949562,.45566,.110164,.698039,.952075,.462178,.105031,.701961,.954506,.468744,.099874,.705882,.956852,.475356,.094695,.709804,.959114,.482014,.089499,.713725,.961293,.488716,.084289,.717647,.963387,.495462,.079073,.721569,.965397,.502249,.073859,.72549,.967322,.509078,.068659,.729412,.969163,.515946,.063488,.733333,.970919,.522853,.058367,.737255,.97259,.529798,.053324,.741176,.974176,.53678,.048392,.745098,.975677,.543798,.043618,.74902,.977092,.55085,.03905,.752941,.978422,.557937,.034931,.756863,.979666,.565057,.031409,.760784,.980824,.572209,.028508,.764706,.981895,.579392,.02625,.768627,.982881,.586606,.024661,.772549,.983779,.593849,.02377,.776471,.984591,.601122,.023606,.780392,.985315,.608422,.024202,.784314,.985952,.61575,.025592,.788235,.986502,.623105,.027814,.792157,.986964,.630485,.030908,.796078,.987337,.63789,.034916,.8,.987622,.64532,.039886,.803922,.987819,.652773,.045581,.807843,.987926,.66025,.05175,.811765,.987945,.667748,.058329,.815686,.987874,.675267,.065257,.819608,.987714,.682807,.072489,.823529,.987464,.690366,.07999,.827451,.987124,.697944,.087731,.831373,.986694,.70554,.095694,.835294,.986175,.713153,.103863,.839216,.985566,.720782,.112229,.843137,.984865,.728427,.120785,.847059,.984075,.736087,.129527,.85098,.983196,.743758,.138453,.854902,.982228,.751442,.147565,.858824,.981173,.759135,.156863,.862745,.980032,.766837,.166353,.866667,.978806,.774545,.176037,.870588,.977497,.782258,.185923,.87451,.976108,.789974,.196018,.878431,.974638,.797692,.206332,.882353,.973088,.805409,.216877,.886275,.971468,.813122,.227658,.890196,.969783,.820825,.238686,.894118,.968041,.828515,.249972,.898039,.966243,.836191,.261534,.901961,.964394,.843848,.273391,.905882,.962517,.851476,.285546,.909804,.960626,.859069,.29801,.913725,.95872,.866624,.31082,.917647,.956834,.874129,.323974,.921569,.954997,.881569,.337475,.92549,.953215,.888942,.351369,.929412,.951546,.896226,.365627,.933333,.950018,.903409,.380271,.937255,.948683,.910473,.395289,.941176,.947594,.917399,.410665,.945098,.946809,.924168,.426373,.94902,.946392,.930761,.442367,.952941,.946403,.937159,.458592,.956863,.946903,.943348,.47497,.960784,.947937,.949318,.491426,.964706,.949545,.955063,.50786,.968627,.95174,.960587,.524203,.972549,.954529,.965896,.540361,.976471,.957896,.971003,.556275,.980392,.961812,.975924,.571925,.984314,.966249,.980678,.587206,.988235,.971162,.985282,.602154,.992157,.976511,.989753,.61676,.996078,.982257,.994109,.631017,1,.988362,.998364,.644924]},{ColorSpace:"Diverging",Name:"Plasma (matplotlib)",NanColor:[0,1,0],Source:"https://github.com/BIDS/colormap/blob/master/colormaps.py",License:"CC0",Creator:"Nathaniel J. Smith & Stefan van der Walt",RGBPoints:[0,.050383,.029803,.527975,.003922,.063536,.028426,.533124,.007843,.075353,.027206,.538007,.011765,.086222,.026125,.542658,.015686,.096379,.025165,.547103,.019608,.10598,.024309,.551368,.023529,.115124,.023556,.555468,.027451,.123903,.022878,.559423,.031373,.132381,.022258,.56325,.035294,.140603,.021687,.566959,.039216,.148607,.021154,.570562,.043137,.156421,.020651,.574065,.047059,.16407,.020171,.577478,.05098,.171574,.019706,.580806,.054902,.17895,.019252,.584054,.058824,.186213,.018803,.587228,.062745,.193374,.018354,.59033,.066667,.200445,.017902,.593364,.070588,.207435,.017442,.596333,.07451,.21435,.016973,.599239,.078431,.221197,.016497,.602083,.082353,.227983,.016007,.604867,.086275,.234715,.015502,.607592,.090196,.241396,.014979,.610259,.094118,.248032,.014439,.612868,.098039,.254627,.013882,.615419,.101961,.261183,.013308,.617911,.105882,.267703,.012716,.620346,.109804,.274191,.012109,.622722,.113725,.280648,.011488,.625038,.117647,.287076,.010855,.627295,.121569,.293478,.010213,.62949,.12549,.299855,.009561,.631624,.129412,.30621,.008902,.633694,.133333,.312543,.008239,.6357,.137255,.318856,.007576,.63764,.141176,.32515,.006915,.639512,.145098,.331426,.006261,.641316,.14902,.337683,.005618,.643049,.152941,.343925,.004991,.64471,.156863,.35015,.004382,.646298,.160784,.356359,.003798,.64781,.164706,.362553,.003243,.649245,.168627,.368733,.002724,.650601,.172549,.374897,.002245,.651876,.176471,.381047,.001814,.653068,.180392,.387183,.001434,.654177,.184314,.393304,.001114,.655199,.188235,.399411,859e-6,.656133,.192157,.405503,678e-6,.656977,.196078,.41158,577e-6,.65773,.2,.417642,564e-6,.65839,.203922,.423689,646e-6,.658956,.207843,.429719,831e-6,.659425,.211765,.435734,.001127,.659797,.215686,.441732,.00154,.660069,.219608,.447714,.00208,.66024,.223529,.453677,.002755,.66031,.227451,.459623,.003574,.660277,.231373,.46555,.004545,.660139,.235294,.471457,.005678,.659897,.239216,.477344,.00698,.659549,.243137,.48321,.00846,.659095,.247059,.489055,.010127,.658534,.25098,.494877,.01199,.657865,.254902,.500678,.014055,.657088,.258824,.506454,.016333,.656202,.262745,.512206,.018833,.655209,.266667,.517933,.021563,.654109,.270588,.523633,.024532,.652901,.27451,.529306,.027747,.651586,.278431,.534952,.031217,.650165,.282353,.54057,.03495,.64864,.286275,.546157,.038954,.64701,.290196,.551715,.043136,.645277,.294118,.557243,.047331,.643443,.298039,.562738,.051545,.641509,.301961,.568201,.055778,.639477,.305882,.573632,.060028,.637349,.309804,.579029,.064296,.635126,.313725,.584391,.068579,.632812,.317647,.589719,.072878,.630408,.321569,.595011,.07719,.627917,.32549,.600266,.081516,.625342,.329412,.605485,.085854,.622686,.333333,.610667,.090204,.619951,.337255,.615812,.094564,.61714,.341176,.620919,.098934,.614257,.345098,.625987,.103312,.611305,.34902,.631017,.107699,.608287,.352941,.636008,.112092,.605205,.356863,.640959,.116492,.602065,.360784,.645872,.120898,.598867,.364706,.650746,.125309,.595617,.368627,.65558,.129725,.592317,.372549,.660374,.134144,.588971,.376471,.665129,.138566,.585582,.380392,.669845,.142992,.582154,.384314,.674522,.147419,.578688,.388235,.67916,.151848,.575189,.392157,.683758,.156278,.57166,.396078,.688318,.160709,.568103,.4,.69284,.165141,.564522,.403922,.697324,.169573,.560919,.407843,.701769,.174005,.557296,.411765,.706178,.178437,.553657,.415686,.710549,.182868,.550004,.419608,.714883,.187299,.546338,.423529,.719181,.191729,.542663,.427451,.723444,.196158,.538981,.431373,.72767,.200586,.535293,.435294,.731862,.205013,.531601,.439216,.736019,.209439,.527908,.443137,.740143,.213864,.524216,.447059,.744232,.218288,.520524,.45098,.748289,.222711,.516834,.454902,.752312,.227133,.513149,.458824,.756304,.231555,.509468,.462745,.760264,.235976,.505794,.466667,.764193,.240396,.502126,.470588,.76809,.244817,.498465,.47451,.771958,.249237,.494813,.478431,.775796,.253658,.491171,.482353,.779604,.258078,.487539,.486275,.783383,.2625,.483918,.490196,.787133,.266922,.480307,.494118,.790855,.271345,.476706,.498039,.794549,.27577,.473117,.501961,.798216,.280197,.469538,.505882,.801855,.284626,.465971,.509804,.805467,.289057,.462415,.513725,.809052,.293491,.45887,.517647,.812612,.297928,.455338,.521569,.816144,.302368,.451816,.52549,.819651,.306812,.448306,.529412,.823132,.311261,.444806,.533333,.826588,.315714,.441316,.537255,.830018,.320172,.437836,.541176,.833422,.324635,.434366,.545098,.836801,.329105,.430905,.54902,.840155,.33358,.427455,.552941,.843484,.338062,.424013,.556863,.846788,.342551,.420579,.560784,.850066,.347048,.417153,.564706,.853319,.351553,.413734,.568627,.856547,.356066,.410322,.572549,.85975,.360588,.406917,.576471,.862927,.365119,.403519,.580392,.866078,.36966,.400126,.584314,.869203,.374212,.396738,.588235,.872303,.378774,.393355,.592157,.875376,.383347,.389976,.596078,.878423,.387932,.3866,.6,.881443,.392529,.383229,.603922,.884436,.397139,.37986,.607843,.887402,.401762,.376494,.611765,.89034,.406398,.37313,.615686,.89325,.411048,.369768,.619608,.896131,.415712,.366407,.623529,.898984,.420392,.363047,.627451,.901807,.425087,.359688,.631373,.904601,.429797,.356329,.635294,.907365,.434524,.35297,.639216,.910098,.439268,.34961,.643137,.9128,.444029,.346251,.647059,.915471,.448807,.34289,.65098,.918109,.453603,.339529,.654902,.920714,.458417,.336166,.658824,.923287,.463251,.332801,.662745,.925825,.468103,.329435,.666667,.928329,.472975,.326067,.670588,.930798,.477867,.322697,.67451,.933232,.48278,.319325,.678431,.93563,.487712,.315952,.682353,.93799,.492667,.312575,.686275,.940313,.497642,.309197,.690196,.942598,.502639,.305816,.694118,.944844,.507658,.302433,.698039,.947051,.512699,.299049,.701961,.949217,.517763,.295662,.705882,.951344,.52285,.292275,.709804,.953428,.52796,.288883,.713725,.95547,.533093,.28549,.717647,.957469,.53825,.282096,.721569,.959424,.543431,.278701,.72549,.961336,.548636,.275305,.729412,.963203,.553865,.271909,.733333,.965024,.559118,.268513,.737255,.966798,.564396,.265118,.741176,.968526,.5697,.261721,.745098,.970205,.575028,.258325,.74902,.971835,.580382,.254931,.752941,.973416,.585761,.25154,.756863,.974947,.591165,.248151,.760784,.976428,.596595,.244767,.764706,.977856,.602051,.241387,.768627,.979233,.607532,.238013,.772549,.980556,.613039,.234646,.776471,.981826,.618572,.231287,.780392,.983041,.624131,.227937,.784314,.984199,.629718,.224595,.788235,.985301,.63533,.221265,.792157,.986345,.640969,.217948,.796078,.987332,.646633,.214648,.8,.98826,.652325,.211364,.803922,.989128,.658043,.2081,.807843,.989935,.663787,.204859,.811765,.990681,.669558,.201642,.815686,.991365,.675355,.198453,.819608,.991985,.681179,.195295,.823529,.992541,.68703,.19217,.827451,.993032,.692907,.189084,.831373,.993456,.69881,.186041,.835294,.993814,.704741,.183043,.839216,.994103,.710698,.180097,.843137,.994324,.716681,.177208,.847059,.994474,.722691,.174381,.85098,.994553,.728728,.171622,.854902,.994561,.734791,.168938,.858824,.994495,.74088,.166335,.862745,.994355,.746995,.163821,.866667,.994141,.753137,.161404,.870588,.993851,.759304,.159092,.87451,.993482,.765499,.156891,.878431,.993033,.77172,.154808,.882353,.992505,.777967,.152855,.886275,.991897,.784239,.151042,.890196,.991209,.790537,.149377,.894118,.990439,.796859,.14787,.898039,.989587,.803205,.146529,.901961,.988648,.809579,.145357,.905882,.987621,.815978,.144363,.909804,.986509,.822401,.143557,.913725,.985314,.828846,.142945,.917647,.984031,.835315,.142528,.921569,.982653,.841812,.142303,.92549,.98119,.848329,.142279,.929412,.979644,.854866,.142453,.933333,.977995,.861432,.142808,.937255,.976265,.868016,.143351,.941176,.974443,.874622,.144061,.945098,.97253,.88125,.144923,.94902,.970533,.887896,.145919,.952941,.968443,.894564,.147014,.956863,.966271,.901249,.14818,.960784,.964021,.90795,.14937,.964706,.961681,.914672,.15052,.968627,.959276,.921407,.151566,.972549,.956808,.928152,.152409,.976471,.954287,.934908,.152921,.980392,.951726,.941671,.152925,.984314,.949151,.948435,.152178,.988235,.946602,.95519,.150328,.992157,.944152,.961916,.146861,.996078,.941896,.96859,.140956,1,.940015,.975158,.131326]},{ColorSpace:"Diverging",Name:"Viridis (matplotlib)",NanColor:[1,0,0],Source:"https://github.com/BIDS/colormap/blob/master/colormaps.py",License:"CC0",Creator:"Eric Firing",RGBPoints:[0,.267004,.004874,.329415,.003922,.26851,.009605,.335427,.007843,.269944,.014625,.341379,.011765,.271305,.019942,.347269,.015686,.272594,.025563,.353093,.019608,.273809,.031497,.358853,.023529,.274952,.037752,.364543,.027451,.276022,.044167,.370164,.031373,.277018,.050344,.375715,.035294,.277941,.056324,.381191,.039216,.278791,.062145,.386592,.043137,.279566,.067836,.391917,.047059,.280267,.073417,.397163,.05098,.280894,.078907,.402329,.054902,.281446,.08432,.407414,.058824,.281924,.089666,.412415,.062745,.282327,.094955,.417331,.066667,.282656,.100196,.42216,.070588,.28291,.105393,.426902,.07451,.283091,.110553,.431554,.078431,.283197,.11568,.436115,.082353,.283229,.120777,.440584,.086275,.283187,.125848,.44496,.090196,.283072,.130895,.449241,.094118,.282884,.13592,.453427,.098039,.282623,.140926,.457517,.101961,.28229,.145912,.46151,.105882,.281887,.150881,.465405,.109804,.281412,.155834,.469201,.113725,.280868,.160771,.472899,.117647,.280255,.165693,.476498,.121569,.279574,.170599,.479997,.12549,.278826,.17549,.483397,.129412,.278012,.180367,.486697,.133333,.277134,.185228,.489898,.137255,.276194,.190074,.493001,.141176,.275191,.194905,.496005,.145098,.274128,.199721,.498911,.14902,.273006,.20452,.501721,.152941,.271828,.209303,.504434,.156863,.270595,.214069,.507052,.160784,.269308,.218818,.509577,.164706,.267968,.223549,.512008,.168627,.26658,.228262,.514349,.172549,.265145,.232956,.516599,.176471,.263663,.237631,.518762,.180392,.262138,.242286,.520837,.184314,.260571,.246922,.522828,.188235,.258965,.251537,.524736,.192157,.257322,.25613,.526563,.196078,.255645,.260703,.528312,.2,.253935,.265254,.529983,.203922,.252194,.269783,.531579,.207843,.250425,.27429,.533103,.211765,.248629,.278775,.534556,.215686,.246811,.283237,.535941,.219608,.244972,.287675,.53726,.223529,.243113,.292092,.538516,.227451,.241237,.296485,.539709,.231373,.239346,.300855,.540844,.235294,.237441,.305202,.541921,.239216,.235526,.309527,.542944,.243137,.233603,.313828,.543914,.247059,.231674,.318106,.544834,.25098,.229739,.322361,.545706,.254902,.227802,.326594,.546532,.258824,.225863,.330805,.547314,.262745,.223925,.334994,.548053,.266667,.221989,.339161,.548752,.270588,.220057,.343307,.549413,.27451,.21813,.347432,.550038,.278431,.21621,.351535,.550627,.282353,.214298,.355619,.551184,.286275,.212395,.359683,.55171,.290196,.210503,.363727,.552206,.294118,.208623,.367752,.552675,.298039,.206756,.371758,.553117,.301961,.204903,.375746,.553533,.305882,.203063,.379716,.553925,.309804,.201239,.38367,.554294,.313725,.19943,.387607,.554642,.317647,.197636,.391528,.554969,.321569,.19586,.395433,.555276,.32549,.1941,.399323,.555565,.329412,.192357,.403199,.555836,.333333,.190631,.407061,.556089,.337255,.188923,.41091,.556326,.341176,.187231,.414746,.556547,.345098,.185556,.41857,.556753,.34902,.183898,.422383,.556944,.352941,.182256,.426184,.55712,.356863,.180629,.429975,.557282,.360784,.179019,.433756,.55743,.364706,.177423,.437527,.557565,.368627,.175841,.44129,.557685,.372549,.174274,.445044,.557792,.376471,.172719,.448791,.557885,.380392,.171176,.45253,.557965,.384314,.169646,.456262,.55803,.388235,.168126,.459988,.558082,.392157,.166617,.463708,.558119,.396078,.165117,.467423,.558141,.4,.163625,.471133,.558148,.403922,.162142,.474838,.55814,.407843,.160665,.47854,.558115,.411765,.159194,.482237,.558073,.415686,.157729,.485932,.558013,.419608,.15627,.489624,.557936,.423529,.154815,.493313,.55784,.427451,.153364,.497,.557724,.431373,.151918,.500685,.557587,.435294,.150476,.504369,.55743,.439216,.149039,.508051,.55725,.443137,.147607,.511733,.557049,.447059,.14618,.515413,.556823,.45098,.144759,.519093,.556572,.454902,.143343,.522773,.556295,.458824,.141935,.526453,.555991,.462745,.140536,.530132,.555659,.466667,.139147,.533812,.555298,.470588,.13777,.537492,.554906,.47451,.136408,.541173,.554483,.478431,.135066,.544853,.554029,.482353,.133743,.548535,.553541,.486275,.132444,.552216,.553018,.490196,.131172,.555899,.552459,.494118,.129933,.559582,.551864,.498039,.128729,.563265,.551229,.501961,.127568,.566949,.550556,.505882,.126453,.570633,.549841,.509804,.125394,.574318,.549086,.513725,.124395,.578002,.548287,.517647,.123463,.581687,.547445,.521569,.122606,.585371,.546557,.52549,.121831,.589055,.545623,.529412,.121148,.592739,.544641,.533333,.120565,.596422,.543611,.537255,.120092,.600104,.54253,.541176,.119738,.603785,.5414,.545098,.119512,.607464,.540218,.54902,.119423,.611141,.538982,.552941,.119483,.614817,.537692,.556863,.119699,.61849,.536347,.560784,.120081,.622161,.534946,.564706,.120638,.625828,.533488,.568627,.12138,.629492,.531973,.572549,.122312,.633153,.530398,.576471,.123444,.636809,.528763,.580392,.12478,.640461,.527068,.584314,.126326,.644107,.525311,.588235,.128087,.647749,.523491,.592157,.130067,.651384,.521608,.596078,.132268,.655014,.519661,.6,.134692,.658636,.517649,.603922,.137339,.662252,.515571,.607843,.14021,.665859,.513427,.611765,.143303,.669459,.511215,.615686,.146616,.67305,.508936,.619608,.150148,.676631,.506589,.623529,.153894,.680203,.504172,.627451,.157851,.683765,.501686,.631373,.162016,.687316,.499129,.635294,.166383,.690856,.496502,.639216,.170948,.694384,.493803,.643137,.175707,.6979,.491033,.647059,.180653,.701402,.488189,.65098,.185783,.704891,.485273,.654902,.19109,.708366,.482284,.658824,.196571,.711827,.479221,.662745,.202219,.715272,.476084,.666667,.20803,.718701,.472873,.670588,.214,.722114,.469588,.67451,.220124,.725509,.466226,.678431,.226397,.728888,.462789,.682353,.232815,.732247,.459277,.686275,.239374,.735588,.455688,.690196,.24607,.73891,.452024,.694118,.252899,.742211,.448284,.698039,.259857,.745492,.444467,.701961,.266941,.748751,.440573,.705882,.274149,.751988,.436601,.709804,.281477,.755203,.432552,.713725,.288921,.758394,.428426,.717647,.296479,.761561,.424223,.721569,.304148,.764704,.419943,.72549,.311925,.767822,.415586,.729412,.319809,.770914,.411152,.733333,.327796,.77398,.40664,.737255,.335885,.777018,.402049,.741176,.344074,.780029,.397381,.745098,.35236,.783011,.392636,.74902,.360741,.785964,.387814,.752941,.369214,.788888,.382914,.756863,.377779,.791781,.377939,.760784,.386433,.794644,.372886,.764706,.395174,.797475,.367757,.768627,.404001,.800275,.362552,.772549,.412913,.803041,.357269,.776471,.421908,.805774,.35191,.780392,.430983,.808473,.346476,.784314,.440137,.811138,.340967,.788235,.449368,.813768,.335384,.792157,.458674,.816363,.329727,.796078,.468053,.818921,.323998,.8,.477504,.821444,.318195,.803922,.487026,.823929,.312321,.807843,.496615,.826376,.306377,.811765,.506271,.828786,.300362,.815686,.515992,.831158,.294279,.819608,.525776,.833491,.288127,.823529,.535621,.835785,.281908,.827451,.545524,.838039,.275626,.831373,.555484,.840254,.269281,.835294,.565498,.84243,.262877,.839216,.575563,.844566,.256415,.843137,.585678,.846661,.249897,.847059,.595839,.848717,.243329,.85098,.606045,.850733,.236712,.854902,.616293,.852709,.230052,.858824,.626579,.854645,.223353,.862745,.636902,.856542,.21662,.866667,.647257,.8584,.209861,.870588,.657642,.860219,.203082,.87451,.668054,.861999,.196293,.878431,.678489,.863742,.189503,.882353,.688944,.865448,.182725,.886275,.699415,.867117,.175971,.890196,.709898,.868751,.169257,.894118,.720391,.87035,.162603,.898039,.730889,.871916,.156029,.901961,.741388,.873449,.149561,.905882,.751884,.874951,.143228,.909804,.762373,.876424,.137064,.913725,.772852,.877868,.131109,.917647,.783315,.879285,.125405,.921569,.79376,.880678,.120005,.92549,.804182,.882046,.114965,.929412,.814576,.883393,.110347,.933333,.82494,.88472,.106217,.937255,.83527,.886029,.102646,.941176,.845561,.887322,.099702,.945098,.85581,.888601,.097452,.94902,.866013,.889868,.095953,.952941,.876168,.891125,.09525,.956863,.886271,.892374,.095374,.960784,.89632,.893616,.096335,.964706,.906311,.894855,.098125,.968627,.916242,.896091,.100717,.972549,.926106,.89733,.104071,.976471,.935904,.89857,.108131,.980392,.945636,.899815,.112838,.984314,.9553,.901065,.118128,.988235,.964894,.902323,.123941,.992157,.974417,.90359,.130215,.996078,.983868,.904867,.136897,1,.993248,.906157,.143936]},{ShowIndexedColorActiveValues:1,IndexedColors:[.07,.5,.7,1,1,1,.85,1,1,.8,.5,1,.76,1,0,1,.71,.71,.5,.5,.5,.05,.05,1,1,.05,.05,.7,1,1,.7,.89,.96,.67,.36,.95,.54,1,0,.75,.65,.65,.5,.6,.6,1,.5,0,1,1,.19,.12,.94,.12,.5,.82,.89,.56,.25,.83,.24,1,0,.9,.9,.9,.75,.76,.78,.65,.65,.67,.54,.6,.78,.61,.48,.78,.5,.48,.78,.44,.48,.78,.36,.48,.76,1,.48,.38,.49,.5,.69,.76,.56,.56,.4,.56,.56,.74,.5,.89,1,.63,0,.65,.16,.16,.36,.72,.82,.44,.18,.69,0,1,0,.58,1,1,.58,.88,.88,.45,.76,.79,.33,.71,.71,.23,.62,.62,.14,.56,.56,.04,.49,.55,0,.41,.52,.88,.88,1,1,.85,.56,.65,.46,.45,.4,.5,.5,.62,.39,.71,.83,.48,0,.58,0,.58,.26,.62,.69,.34,.09,.56,0,.79,0,.44,.83,1,1,1,.78,.85,1,.78,.78,1,.78,.64,1,.78,.56,1,.78,.38,1,.78,.27,1,.78,.19,1,.78,.12,1,.78,0,1,.61,0,.9,.46,0,.83,.32,0,.75,.22,0,.67,.14,.3,.76,1,.3,.65,1,.13,.58,.84,.15,.49,.67,.15,.4,.59,.09,.33,.53,.96,.93,.82,.8,.82,.12,.71,.71,.76,.65,.33,.3,.34,.35,.38,.62,.31,.71,.67,.36,0,.46,.31,.27,.26,.51,.59,.26,0,.4,0,.49,0,.44,.67,.98,0,.73,1,0,.63,1,0,.56,1,0,.5,1,0,.42,1,.33,.36,.95,.47,.36,.89,.54,.31,.89,.63,.21,.83,.7,.12,.83,.7,.12,.73,.7,.05,.65,.74,.05,.53,.78,0,.4,.8,0,.35,.82,0,.31,.85,0,.27,.88,0,.22,.9,0,.18,.91,0,.15,.92,0,.14,.93,0,.13,.94,0,.12,.95,0,.11,.96,0,.1,.97,0,.09,.98,0,.08,.99,0,.07,1,0,.06],Annotations:[0,"Xx",1,"H",2,"He",3,"Li",4,"Be",5,"B",6,"C",7,"N",8,"O",9,"F",10,"Ne",11,"Na",12,"Mg",13,"Al",14,"Si",15,"P",16,"S",17,"Cl",18,"Ar",19,"K",20,"Ca",21,"Sc",22,"Ti",23,"V",24,"Cr",25,"Mn",26,"Fe",27,"Co",28,"Ni",29,"Cu",30,"Zn",31,"Ga",32,"Ge",33,"As",34,"Se",35,"Br",36,"Kr",37,"Rb",38,"Sr",39,"Y",40,"Zr",41,"Nb",42,"Mo",43,"Tc",44,"Ru",45,"Rh",46,"Pd",47,"Ag",48,"Cd",49,"In",50,"Sn",51,"Sb",52,"Te",53,"I",54,"Xe",55,"Cs",56,"Ba",57,"La",58,"Ce",59,"Pr",60,"Nd",61,"Pm",62,"Sm",63,"Eu",64,"Gd",65,"Tb",66,"Dy",67,"Ho",68,"Er",69,"Tm",70,"Yb",71,"Lu",72,"Hf",73,"Ta",74,"W",75,"Re",76,"Os",77,"Ir",78,"Pt",79,"Au",80,"Hg",81,"Tl",82,"Pb",83,"Bi",84,"Po",85,"At",86,"Rn",87,"Fr",88,"Ra",89,"Ac",90,"Th",91,"Pa",92,"U",93,"Np",94,"Pu",95,"Am",96,"Cm",97,"Bk",98,"Cf",99,"Es",100,"Fm",101,"Md",102,"No",103,"Lr",104,"Rf",105,"Db",106,"Sg",107,"Bh",108,"Hs",109,"Mt",110,"Ds",111,"Rg",112,"Cn",113,"Uut",114,"Uuq",115,"Uup",116,"Uuh",117,"Uus",118,"Uuo"],Name:"BlueObeliskElements"}];const _u=Object.create(null);Bj.filter(t=>t.RGBPoints).filter(t=>t.ColorSpace!=="CIELAB").forEach(t=>{_u[t.Name]=t});const bu=Object.keys(_u);bu.sort();function Gj(t){return _u[t]}function $j(t){!t.RGBPoints||t.ColorSpace==="CIELAB"||(_u[t.Name]||(bu.push(t.Name),bu.sort()),_u[t.Name]=t)}function Wj(t){const e=bu.indexOf(t);e>-1&&bu.splice(e,1),delete _u[t]}var wh={addPreset:$j,removePresetByName:Wj,getPresetByName:Gj,rgbPresetNames:bu};function zD(t,e,n){return Math.abs(t-e)<=n}function zj(t,e,n=1e-5){if(t.length!==e.length)return!1;for(let r=0;r<t.length;r++)if(!zD(t[r],e[r],n))return!1;return!0}function X9(t){return typeof t=="number"}function Y9(t){return t&&typeof t=="object"&&"length"in t&&typeof t.length=="number"&&t.length>0&&typeof t[0]=="number"}function Mn(t,e,n=1e-5){return typeof t!=typeof e||t===null||e===null?!1:X9(t)&&X9(e)?zD(t,e,n):Y9(t)&&Y9(e)?zj(t,e,n):!1}const jD=t=>typeof t=="number"?-t:t!=null&&t.map?t.map(jD):!t,$3=t=>typeof t=="number"?Math.abs(t):t!=null&&t.map?t.map($3):t,HD=(t,e,n=void 0)=>Mn(t,jD(e),n),jj=(t,e,n=void 0)=>Mn($3(t),$3(e),n),yy=new Map;function Hj(t){yy.set(t.Name,t)}function zg(t){return yy.get(t)}function KD(){return Array.from(yy.keys())}function Ty(t,e){const n=wh.rgbPresetNames.map(s=>wh.getPresetByName(s)),r=KD().map(s=>zg(s)),a=n.concat(r).find(s=>{const{RGBPoints:c}=s;if(c.length!==t.length)return!1;for(let l=0;l<c.length;l+=4)if(!Mn(c.slice(l+1,l+4),t.slice(l+1,l+4)))return!1;return!0});if(!a)return null;const o=[];if(Vi(e,"vtkVolume")){const s=e.getProperty().getScalarOpacity(0).getDataPointer();if(!s)return{name:a.Name};for(let c=0;c<s.length;c+=2)o.push({value:s[c],opacity:s[c+1]})}return{name:a.Name,opacity:o}}const Kj=Object.freeze(Object.defineProperty({__proto__:null,findMatchingColormap:Ty,getColormap:zg,getColormapNames:KD,registerColormap:Hj},Symbol.toStringTag,{value:"Module"}));function sg(t){if(!t)return;const e=t.getSize();for(let n=0;n<e;n++){const r=[];t.getNodeValue(n,r),r[1]=1-r[1],r[2]=1-r[2],r[3]=1-r[3],t.setNodeValue(n,r)}}const W3=(t,e,n)=>e-n/4*Math.log((1-t)/t);function Cy(t,e){const n=Math.abs(e-t)+1,r=(t+e+1)/2;return{windowWidth:n,windowCenter:r}}function cg(t,e,n=ui.LINEAR){if(n===ui.LINEAR)return{lower:e-.5-(t-1)/2,upper:e-.5+(t-1)/2};if(n===ui.LINEAR_EXACT)return{lower:e-t/2,upper:e+t/2};if(n===ui.SAMPLED_SIGMOID){const r=W3(.01,e,t),i=W3(.99,e,t);return{lower:r,upper:i}}else throw new Error("Invalid VOI LUT function")}const qj=Object.freeze(Object.defineProperty({__proto__:null,toLowHighRange:cg,toWindowLevel:Cy},Symbol.toStringTag,{value:"Module"}));function wy(t,e=1024){const{windowWidth:n,windowCenter:r}=Cy(t.lower,t.upper),a=Array.from({length:e},(s,c)=>(c+1)/(e+2)).flatMap(s=>[W3(s,r,n),s,s,s,.5,0]),o=Dc.newInstance();return o.buildFunctionFromArray(nt.newInstance({values:a,numberOfComponents:6})),o}function Qo(t,e){return t.worldToIndex(e).map(Math.round)}function up(t,e){return t.worldToIndex(e)}function xh(t){const e=t.getSize(),n=[];for(let r=0;r<e;r++){const i=[];t.getNodeValue(r,i),n.push(i)}return n}function O2(t,e){e!=null&&e.length&&(t.removeAllPoints(),e.forEach(n=>{t.addRGBPoint(...n)}))}const Xj=Object.freeze(Object.defineProperty({__proto__:null,getTransferFunctionNodes:xh,setTransferFunctionNodes:O2},Symbol.toStringTag,{value:"Module"})),{InterpolationType:Wf,OpacityMode:Yj}=qO,{vtkErrorMacro:U5}=P,fp=4;function Zj(t,e){e.classHierarchy.push("vtkVolumeProperty"),t.getMTime=()=>{let i=e.mtime,a;for(let o=0;o<fp;o++)e.componentData[o].colorChannels===1?e.componentData[o].grayTransferFunction&&(a=e.componentData[o].grayTransferFunction.getMTime(),i=i>a?i:a):e.componentData[o].colorChannels===3&&e.componentData[o].rGBTransferFunction&&(a=e.componentData[o].rGBTransferFunction.getMTime(),i=i>a?i:a),e.componentData[o].scalarOpacity&&(a=e.componentData[o].scalarOpacity.getMTime(),i=i>a?i:a),e.componentData[o].gradientOpacity&&(e.componentData[o].disableGradientOpacity||(a=e.componentData[o].gradientOpacity.getMTime(),i=i>a?i:a));return i},t.getColorChannels=i=>i<0||i>3?(U5("Bad index - must be between 0 and 3"),0):e.componentData[i].colorChannels,t.setGrayTransferFunction=function(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,o=!1;return e.componentData[i].grayTransferFunction!==a&&(e.componentData[i].grayTransferFunction=a,o=!0),e.componentData[i].colorChannels!==1&&(e.componentData[i].colorChannels=1,o=!0),o&&t.modified(),o},t.getGrayTransferFunction=function(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return e.componentData[i].grayTransferFunction===null&&(e.componentData[i].grayTransferFunction=Mu.newInstance(),e.componentData[i].grayTransferFunction.addPoint(0,0),e.componentData[i].grayTransferFunction.addPoint(1024,1),e.componentData[i].colorChannels!==1&&(e.componentData[i].colorChannels=1),t.modified()),e.componentData[i].grayTransferFunction},t.setRGBTransferFunction=function(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,o=!1;return e.componentData[i].rGBTransferFunction!==a&&(e.componentData[i].rGBTransferFunction=a,o=!0),e.componentData[i].colorChannels!==3&&(e.componentData[i].colorChannels=3,o=!0),o&&t.modified(),o},t.getRGBTransferFunction=function(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return e.componentData[i].rGBTransferFunction===null&&(e.componentData[i].rGBTransferFunction=Dc.newInstance(),e.componentData[i].rGBTransferFunction.addRGBPoint(0,0,0,0),e.componentData[i].rGBTransferFunction.addRGBPoint(1024,1,1,1),e.componentData[i].colorChannels!==3&&(e.componentData[i].colorChannels=3),t.modified()),e.componentData[i].rGBTransferFunction},t.setScalarOpacity=function(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;return e.componentData[i].scalarOpacity!==a?(e.componentData[i].scalarOpacity=a,t.modified(),!0):!1},t.getScalarOpacity=function(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return e.componentData[i].scalarOpacity===null&&(e.componentData[i].scalarOpacity=Mu.newInstance(),e.componentData[i].scalarOpacity.addPoint(0,1),e.componentData[i].scalarOpacity.addPoint(1024,1),t.modified()),e.componentData[i].scalarOpacity},t.setComponentWeight=function(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;if(i<0||i>=fp)return U5("Invalid index"),!1;const o=Math.min(1,Math.max(0,a));return e.componentData[i].componentWeight!==o?(e.componentData[i].componentWeight=o,t.modified(),!0):!1},t.getComponentWeight=function(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return i<0||i>=fp?(U5("Invalid index"),0):e.componentData[i].componentWeight},t.setInterpolationTypeToNearest=()=>t.setInterpolationType(Wf.NEAREST),t.setInterpolationTypeToLinear=()=>t.setInterpolationType(Wf.LINEAR),t.setInterpolationTypeToFastLinear=()=>t.setInterpolationType(Wf.FAST_LINEAR),t.getInterpolationTypeAsString=()=>P.enumToString(Wf,e.interpolationType),["useGradientOpacity","scalarOpacityUnitDistance","gradientOpacityMinimumValue","gradientOpacityMinimumOpacity","gradientOpacityMaximumValue","gradientOpacityMaximumOpacity","opacityMode","forceNearestInterpolation"].forEach(i=>{const a=P.capitalize(i);t[`set${a}`]=(o,s)=>e.componentData[o][`${i}`]!==s?(e.componentData[o][`${i}`]=s,t.modified(),!0):!1}),["useGradientOpacity","scalarOpacityUnitDistance","gradientOpacityMinimumValue","gradientOpacityMinimumOpacity","gradientOpacityMaximumValue","gradientOpacityMaximumOpacity","opacityMode","forceNearestInterpolation"].forEach(i=>{const a=P.capitalize(i);t[`get${a}`]=o=>e.componentData[o][`${i}`]})}const Qj={colorMixPreset:null,independentComponents:!0,interpolationType:Wf.FAST_LINEAR,shade:!1,ambient:.1,diffuse:.7,specular:.2,specularPower:10,useLabelOutline:!1,labelOutlineThickness:[1],labelOutlineOpacity:1};function Jj(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(Object.assign(e,Qj,n),P.obj(t,e),!e.componentData){e.componentData=[];for(let r=0;r<fp;++r)e.componentData.push({colorChannels:1,grayTransferFunction:null,rGBTransferFunction:null,scalarOpacity:null,scalarOpacityUnitDistance:1,opacityMode:Yj.FRACTIONAL,gradientOpacityMinimumValue:0,gradientOpacityMinimumOpacity:0,gradientOpacityMaximumValue:1,gradientOpacityMaximumOpacity:1,useGradientOpacity:!1,componentWeight:1,forceNearestInterpolation:!1})}P.setGet(t,e,["colorMixPreset","independentComponents","interpolationType","shade","ambient","diffuse","specular","specularPower","useLabelOutline","labelOutlineOpacity"]),P.setGetArray(t,e,["labelOutlineThickness"]),Zj(t,e)}const eH=P.newInstance(Jj,"vtkVolumeProperty");var tH={newInstance:eH,...qO};const{vtkDebugMacro:nH}=P;function rH(t,e){e.classHierarchy.push("vtkVolume"),t.getVolumes=()=>t,t.makeProperty=tH.newInstance,t.getProperty=()=>(e.property===null&&(e.property=t.makeProperty()),e.property),t.getBounds=()=>{if(e.mapper===null)return e.bounds;const n=e.mapper.getBounds();if(!n||n.length!==6)return n;if(n[0]>n[1])return e.mapperBounds=n.concat(),e.bounds=[1,-1,1,-1,1,-1],e.boundsMTime.modified(),n;const r=i=>i[0].map((a,o)=>i.map(s=>s[o]));if(!e.mapperBounds||!r([n,e.mapperBounds]).reduce((i,a)=>i&&a[0]===a[1],!0)||t.getMTime()>e.boundsMTime.getMTime()){nH("Recomputing bounds..."),e.mapperBounds=n.map(o=>o);const i=[];Nt.getCorners(n,i),t.computeMatrix();const a=new Float64Array(16);ft(a,e.matrix),i.forEach(o=>pt(o,o,a)),e.bounds[0]=e.bounds[2]=e.bounds[4]=Number.MAX_VALUE,e.bounds[1]=e.bounds[3]=e.bounds[5]=-Number.MAX_VALUE,e.bounds=e.bounds.map((o,s)=>s%2===0?i.reduce((c,l)=>c>l[s/2]?l[s/2]:c,o):i.reduce((c,l)=>c<l[(s-1)/2]?l[(s-1)/2]:c,o)),e.boundsMTime.modified()}return e.bounds},t.getMTime=()=>{let n=e.mtime;if(e.property!==null){const r=e.property.getMTime();n=r>n?r:n}return n},t.getRedrawMTime=()=>{let n=e.mtime;if(e.mapper!==null){let r=e.mapper.getMTime();n=r>n?r:n,e.mapper.getInput()!==null&&(e.mapper.getInputAlgorithm().update(),r=e.mapper.getInput().getMTime(),n=r>n?r:n)}return n}}const iH={mapper:null,property:null,bounds:[1,-1,1,-1,1,-1]};function qD(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,iH,n),my.extend(t,e,n),e.boundsMTime={},P.obj(e.boundsMTime),P.set(t,e,["property"]),P.setGet(t,e,["mapper"]),P.getArray(t,e,["bounds"],6),rH(t,e)}const aH=P.newInstance(qD,"vtkVolume");var oH={newInstance:aH,extend:qD};const{vtkErrorMacro:sH}=P;class cH{constructor(){this.segmentMapping={},this.segments=[null],this.faces=[]}addSegment(e){const n=e[0],r=e[e.length-1];if(n===r||e.length<2)return;const i=this.segmentMapping[n],a=this.segmentMapping[r];if(i!==void 0&&a!==void 0)if(Math.abs(i)===Math.abs(a)){const o=i<a?a:i,s=this.segments[o];if(i>0)for(let c=1;c<e.length-1;c++)s.push(e[c]);else for(let c=1;c<e.length-1;c++)s.unshift(e[e.length-1-c]);this.faces.push(s),this.segments[o]=null,this.segmentMapping[n]=void 0,this.segmentMapping[r]=void 0}else{const o=Math.abs(i),s=Math.abs(a),c=this.segments[o],l=this.segments[s];this.segments[o]=null,this.segments[s]=null,this.segmentMapping[c[0]]=void 0,this.segmentMapping[l[0]]=void 0,this.segmentMapping[c[c.length-1]]=void 0,this.segmentMapping[l[l.length-1]]=void 0,this.addSegment(e),this.addSegment(c),this.addSegment(l)}else if(i!==void 0){if(i>0){const o=this.segments[i];for(let s=1;s<e.length;s++)o.push(e[s]);this.segmentMapping[r]=i}else{const o=this.segments[-i];this.segmentMapping[r]=i;for(let s=1;s<e.length;s++)o.unshift(e[s])}this.segmentMapping[n]=void 0}else if(a!==void 0){if(a>0){const o=this.segments[a];for(let s=1;s<e.length;s++)o.push(e[e.length-1-s]);this.segmentMapping[n]=a}else{const o=this.segments[-a];this.segmentMapping[n]=a;for(let s=1;s<e.length;s++)o.unshift(e[e.length-s-1])}this.segmentMapping[r]=void 0}else{const o=this.segments.length;this.segments.push(e),this.segmentMapping[n]=-o,this.segmentMapping[r]=o}}}function lH(t,e){e.classHierarchy.push("vtkClosedPolyLineToSurfaceFilter"),t.requestData=(n,r)=>{const i=n[0];if(!i){sH("Invalid or missing input");return}const a=Ii.newInstance();a.shallowCopy(i);const o=new cH,s=i.getLines().getData();let c=0;for(;c<s.length;){const g=s[c++],d=[];for(let h=0;h<g;h++)d.push(s[c+h]);o.addSegment(d),c+=g}const{faces:l}=o;let f=l.length;for(let g=0;g<l.length;g++)f+=l[g].length;const u=new Uint16Array(f);c=0;for(let g=0;g<l.length;g++){const d=l[g];u[c++]=d.length;for(let h=0;h<d.length;h++)u[c++]=d[h]}a.setPolys(el.newInstance({values:u,name:"faces"})),r[0]=a}}const uH={};function XD(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,uH,n),P.obj(t,e),P.algo(t,e,1,1),lH(t,e)}const fH=P.newInstance(XD,"vtkClosedPolyLineToSurfaceFilter");var gH={newInstance:fH,extend:XD};const{vtkErrorMacro:Z9}=Ir;function dH(t){const e=t.getPolys().getData(),n=t.getStrips().getData(),r={cellSize:0,cell:[],done:!1,polyIdx:0,stripIdx:0,remainingStripLength:0,next(){if(r.polyIdx<e.length){r.cellSize=e[r.polyIdx];const i=r.polyIdx+1,a=i+r.cellSize;r.polyIdx=a;let o=0;for(let s=i;s<a;++s)r.cell[o++]=e[s]}else if(r.stripIdx<n.length){r.cellSize=3,r.remainingStripLength===0&&(r.remainingStripLength=n[r.stripIdx]-2,r.stripIdx+=3);const i=r.stripIdx-2,a=r.stripIdx+1;r.stripIdx++,r.remainingStripLength--;let o=0;for(let s=i;s<a;++s)r.cell[o++]=n[s]}else if(!r.done)r.done=!0;else throw new Error("Iterator is done")}};return r.next(),r}function pH(t,e){e.classHierarchy.push("vtkCutter");const n={...t};t.getMTime=()=>{let i=n.getMTime();return e.cutFunction&&(i=Math.max(i,e.cutFunction.getMTime())),i};function r(i,a){const o=i.getPoints(),s=o.getData(),c=o.getNumberOfPoints(),l=[],f=[],u=[];(!e.cutScalars||e.cutScalars.length<c)&&(e.cutScalars=new Float32Array(c));let g=0,d=0;for(;g<s.length;)e.cutScalars[d++]=e.cutFunction.evaluateFunction(s[g++],s[g++],s[g++]);const h=[],p=new Array(3),m=new Array(3),v=[];for(const T=dH(i);!T.done;T.next()){if(T.cellSize<=2)continue;for(let M=0;M<T.cellSize;)v[M]=e.cutScalars[T.cell[M++]];const C=v[0]>0;let w=!0;for(let M=1;M<T.cell.length;M++)if(v[M]>0!==C){w=!1;break}if(w)continue;const x=[];for(let M=0;M<T.cellSize;M++){const A=M+1===T.cellSize?0:M+1,_=v[M]>0;if(v[A]>0===_)continue;let z=M,X=A,Z=v[X]-v[z];Z<=0&&(z=A,X=M,Z*=-1);let ce=0;Z!==0&&(ce=(e.cutValue-v[z])/Z);const J=T.cell[z],de=T.cell[X];p[0]=s[J*3],p[1]=s[J*3+1],p[2]=s[J*3+2],m[0]=s[de*3],m[1]=s[de*3+1],m[2]=s[de*3+2];const Q=[p[0]+ce*(m[0]-p[0]),p[1]+ce*(m[1]-p[1]),p[2]+ce*(m[2]-p[2])];x.push({pointEdge1:J,pointEdge2:de,intersectedPoint:Q,newPointID:-1})}for(let M=0;M<x.length;M++){const A=x[M];let _=!1;for(let k=0;k<h.length;k++){const z=h[k],X=A.pointEdge1===z.pointEdge1&&A.pointEdge2===z.pointEdge2,Z=A.intersectedPoint[0]===z.intersectedPoint[0]&&A.intersectedPoint[1]===z.intersectedPoint[1]&&A.intersectedPoint[2]===z.intersectedPoint[2];if(X||Z){_=!0,x[M].newPointID=h[k].newPointID;break}}_||(l.push(A.intersectedPoint[0]),l.push(A.intersectedPoint[1]),l.push(A.intersectedPoint[2]),x[M].newPointID=l.length/3-1,h.push(x[M]))}const O=x.length;O===2?f.push(O,x[0].newPointID,x[1].newPointID):O>2&&(u.push(O),x.forEach(M=>{u.push(M.newPointID)}))}a.getPoints().setData(c2(o.getDataType(),l),3),f.length!==0&&a.getLines().setData(Uint16Array.from(f)),u.length!==0&&a.getPolys().setData(Uint16Array.from(u))}t.requestData=(i,a)=>{const o=i[0];if(!o){Z9("Invalid or missing input");return}if(!e.cutFunction){Z9("Missing cut function");return}const s=Ii.newInstance();r(o,s),a[0]=s}}const hH={cutFunction:null,cutScalars:null,cutValue:0};function YD(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,hH,n),zt(t,e),h4(t,e,1,1),Vn(t,e,["cutFunction","cutValue"]),pH(t,e)}const mH=Rt(YD,"vtkCutter");var vH={newInstance:mH,extend:YD};const yH=[2,0,1,2,2,3,2,4,5,2,6,7,2,0,2,2,1,3,2,4,6,2,5,7,2,0,4,2,1,5,2,2,6,2,3,7],TH=[4,0,1,3,2,4,4,6,7,5,4,8,10,11,9,4,12,13,15,14,4,16,18,19,17,4,20,21,23,22];function CH(t,e){e.classHierarchy.push("vtkCubeSource");function n(r,i){if(e.deleted)return;const a=Ii.newInstance();i[0]=a;const o=24,s=P.newTypedArray(e.pointType,o*3);a.getPoints().setData(s,3);const c=P.newTypedArray(e.pointType,o*3),l=nt.newInstance({name:"Normals",values:c,numberOfComponents:3});a.getPointData().setNormals(l);let f=2;e.generate3DTextureCoordinates===!0&&(f=3);const u=P.newTypedArray(e.pointType,o*f),g=nt.newInstance({name:"TextureCoordinates",values:u,numberOfComponents:f});a.getPointData().setTCoords(g);const d=[0,0,0],h=[0,0,0],p=[0,0];let m=0;d[0]=-e.xLength/2,h[0]=-1,h[1]=0,h[2]=0;for(let v=0;v<2;v++){d[1]=-e.yLength/2;for(let y=0;y<2;y++){p[1]=d[1]+.5,d[2]=-e.zLength/2;for(let T=0;T<2;T++)p[0]=(d[2]+.5)*(1-2*v),s[m*3]=d[0],s[m*3+1]=d[1],s[m*3+2]=d[2],c[m*3]=h[0],c[m*3+1]=h[1],c[m*3+2]=h[2],f===2?(u[m*f]=p[0],u[m*f+1]=p[1]):(u[m*f]=2*v-1,u[m*f+1]=2*y-1,u[m*f+2]=2*T-1),m++,d[2]+=e.zLength;d[1]+=e.yLength}d[0]+=e.xLength,h[0]+=2}d[1]=-e.yLength/2,h[1]=-1,h[0]=0,h[2]=0;for(let v=0;v<2;v++){d[0]=-e.xLength/2;for(let y=0;y<2;y++){p[0]=(d[0]+.5)*(2*v-1),d[2]=-e.zLength/2;for(let T=0;T<2;T++)p[1]=(d[2]+.5)*-1,s[m*3]=d[0],s[m*3+1]=d[1],s[m*3+2]=d[2],c[m*3]=h[0],c[m*3+1]=h[1],c[m*3+2]=h[2],f===2?(u[m*f]=p[0],u[m*f+1]=p[1]):(u[m*f]=2*y-1,u[m*f+1]=2*v-1,u[m*f+2]=2*T-1),m++,d[2]+=e.zLength;d[0]+=e.xLength}d[1]+=e.yLength,h[1]+=2}d[2]=-e.zLength/2,h[2]=-1,h[0]=0,h[1]=0;for(let v=0;v<2;v++){d[1]=-e.yLength/2;for(let y=0;y<2;y++){p[1]=d[1]+.5,d[0]=-e.xLength/2;for(let T=0;T<2;T++)p[0]=(d[0]+.5)*(2*v-1),s[m*3]=d[0],s[m*3+1]=d[1],s[m*3+2]=d[2],c[m*3]=h[0],c[m*3+1]=h[1],c[m*3+2]=h[2],f===2?(u[m*f]=p[0],u[m*f+1]=p[1]):(u[m*f]=2*T-1,u[m*f+1]=2*y-1,u[m*f+2]=2*v-1),m++,d[0]+=e.xLength;d[1]+=e.yLength}d[2]+=e.zLength,h[2]+=2}if(e.rotations&&N0.buildFromDegree().rotateX(e.rotations[0]).rotateY(e.rotations[1]).rotateZ(e.rotations[2]).apply(s).apply(c),e.center&&N0.buildFromRadian().translate(...e.center).apply(s),e.matrix){N0.buildFromRadian().setMatrix(e.matrix).apply(s);const v=[e.matrix[0],e.matrix[1],e.matrix[2],0,e.matrix[4],e.matrix[5],e.matrix[6],0,e.matrix[8],e.matrix[9],e.matrix[10],0,0,0,0,1];N0.buildFromRadian().setMatrix(v).apply(c)}e.generateFaces?a.getPolys().deepCopy(e._polys):a.getPolys().initialize(),e.generateLines?(a.getLines().deepCopy(e._lineCells),a.getPointData().setNormals(null)):a.getLines().initialize(),a.modified()}t.setBounds=function(){let r=[];if(Array.isArray(arguments.length<=0?void 0:arguments[0]))r=arguments.length<=0?void 0:arguments[0];else for(let i=0;i<arguments.length;i++)r.push(i<0||arguments.length<=i?void 0:arguments[i]);r.length===6&&(t.setXLength(r[1]-r[0]),t.setYLength(r[3]-r[2]),t.setZLength(r[5]-r[4]),t.setCenter([(r[0]+r[1])/2,(r[2]+r[3])/2,(r[4]+r[5])/2]))},t.requestData=n}const wH={xLength:1,yLength:1,zLength:1,pointType:"Float64Array",generate3DTextureCoordinates:!1,generateFaces:!0,generateLines:!1};function ZD(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,wH,n),P.obj(t,e),P.setGet(t,e,["xLength","yLength","zLength","generate3DTextureCoordinates","generateFaces","generateLines"]),P.setGetArray(t,e,["center","rotations"],3),P.setGetArray(t,e,["matrix"],16),e._polys=el.newInstance({values:Uint16Array.from(TH)}),e._lineCells=el.newInstance({values:Uint16Array.from(yH)}),P.moveToProtected(t,e,["polys","lineCells"]),P.algo(t,e,0,1),CH(t,e)}const xH=P.newInstance(ZD,"vtkCubeSource");var SH={newInstance:xH,extend:ZD};const{vtkErrorMacro:Q9}=P;function EH(t,e){e.classHierarchy.push("vtkImageDataOutlineFilter");const n={...t};t.requestData=(r,i)=>{const a=r[0];if(!a||!a.isA("vtkImageData")){Q9("Invalid or missing input");return}const o=a.getSpatialExtent();if(!o){Q9("Unable to fetch spatial extents of input image.");return}e._cubeSource.setBounds(o),e._cubeSource.setMatrix(a.getIndexToWorld()),i[0]=e._cubeSource.getOutputData()},t.getMTime=()=>Math.max(n.getMTime(),e._cubeSource.getMTime()),t.setGenerateFaces=e._cubeSource.setGenerateFaces,t.setGenerateLines=e._cubeSource.setGenerateLines,t.getGenerateFaces=e._cubeSource.getGenerateFaces,t.getGenerateLines=e._cubeSource.getGenerateLines}const OH={};function QD(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,OH,n),P.obj(t,e),P.algo(t,e,1,1),e._cubeSource=SH.newInstance(),P.moveToProtected(t,e,["cubeSource","tmpOut"]),EH(t,e)}const DH=P.newInstance(QD,"vtkImageDataOutlineFilter");var RH={newInstance:DH,extend:QD};let xy;function MH(t,e){e.classHierarchy.push("vtkAbstractTransform","vtkHomogeneousTransform","vtkTransform"),t.transformPoint=(n,r)=>(pt(r,n,e.matrix),r),t.transformPoints=(n,r)=>{const i=new Float64Array(3),a=new Float64Array(3);for(let o=0;o<n.length;o+=3)i[0]=n[o],i[1]=n[o+1],i[2]=n[o+2],pt(a,i,e.matrix),r[o]=a[0],r[o+1]=a[1],r[o+2]=a[2];return r},t.preMultiply=()=>{t.setPreMultiplyFlag(!0)},t.postMultiply=()=>{t.setPreMultiplyFlag(!1)},t.transformMatrix=(n,r)=>(e.preMultiplyFlag?vt(r,e.matrix,n):vt(r,n,e.matrix),r),t.transformMatrices=(n,r)=>{const i=new Float64Array(16),a=new Float64Array(16),o=e.preMultiplyFlag?()=>vt(a,e.matrix,i):()=>vt(a,i,e.matrix);for(let s=0;s<n.length;s+=16){for(let c=0;c<16;++c)i[c]=n[s+c];o();for(let c=0;c<16;++c)r[s+c]=a[c]}return r},t.getInverse=()=>xy({matrix:fa.invertMatrix(Array.from(e.matrix),[],4),preMultiplyFlag:e.preMultiplyFlag})}const _H={preMultiplyFlag:!1,matrix:[...O4]};function JD(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,_H,n),P.obj(t,e),P.setGet(t,e,["preMultiplyFlag"]),P.setGetArray(t,e,["matrix"],16),MH(t,e)}xy=P.newInstance(JD,"vtkTransform");var bH={newInstance:xy,extend:JD},LH=`//VTK::System::Dec

/*=========================================================================

  Program:   Visualization Toolkit
  Module:    vtkImageResliceMapperVS.glsl

  Copyright (c) Ken Martin, Will Schroeder, Bill Lorensen
  All rights reserved.
  See Copyright.txt or http://www.kitware.com/Copyright.htm for details.

     This software is distributed WITHOUT ANY WARRANTY; without even
     the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR
     PURPOSE.  See the above copyright notice for more information.

=========================================================================*/

// all variables that represent positions or directions have a suffix
// indicating the coordinate system they are in. The possible values are
// MC - Model coordinates
// WC - World coordinates
// VC - View coordinates
// DC - Display coordinates
// TC - Texture coordinates

// frag position in VC
//VTK::PositionVC::Dec

// Texture coordinates
//VTK::TCoord::Dec

// picking support
//VTK::Picking::Dec

// camera and actor matrix values
//VTK::Camera::Dec

void main()
{
  //VTK::PositionVC::Impl

  //VTK::TCoord::Impl

  //VTK::Picking::Impl
}
`,IH=`//VTK::System::Dec

/*=========================================================================

  Program:   Visualization Toolkit
  Module:    vtkImageResliceMapperFS.glsl

  Copyright (c) Ken Martin, Will Schroeder, Bill Lorensen
  All rights reserved.
  See Copyright.txt or http://www.kitware.com/Copyright.htm for details.

     This software is distributed WITHOUT ANY WARRANTY; without even
     the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR
     PURPOSE.  See the above copyright notice for more information.

=========================================================================*/
// Template for the gpu image mapper fragment shader

// VC position of this fragment
//VTK::PositionVC::Dec

// Texture coordinates
//VTK::TCoord::Dec

// picking support
//VTK::Picking::Dec

// handle coincident offsets
//VTK::Coincident::Dec

//VTK::ZBuffer::Dec

// the output of this shader
//VTK::Output::Dec

void main()
{
  // VC position of this fragment. This should not branch/return/discard.
  //VTK::PositionVC::Impl

  // Place any calls that require uniform flow (e.g. dFdx) here.
  //VTK::UniformFlow::Impl

  // Set gl_FragDepth here (gl_FragCoord.z by default)
  //VTK::Depth::Impl

  // Early depth peeling abort:
  //VTK::DepthPeeling::PreColor

  //VTK::TCoord::Impl

  if (gl_FragData[0].a <= 0.0)
    {
    discard;
    }

  //VTK::DepthPeeling::Impl

  //VTK::Picking::Impl

  // handle coincident offsets
  //VTK::Coincident::Impl

  //VTK::ZBuffer::Impl

  //VTK::RenderPassFragmentShader::Impl
}
`;const{vtkErrorMacro:g0}=Ir;function J9(t,e,n){return e.identity(n),t.reduce((r,i,a)=>a===0?i?e.copy(r,i):e.identity(r):i?e.multiply(r,r,i):r,n)}function VH(t,e){e.classHierarchy.push("vtkOpenGLImageResliceMapper");function n(i){[e._scalars,e._colorTransferFunc,e._pwFunc].forEach(a=>i.unregisterGraphicsResourceUser(a,t))}t.buildPass=i=>{if(i){e.currentRenderPass=null,e._openGLImageSlice=t.getFirstAncestorOfType("vtkOpenGLImageSlice"),e._openGLRenderer=t.getFirstAncestorOfType("vtkOpenGLRenderer");const a=e._openGLRenderer.getRenderable();e._openGLCamera=e._openGLRenderer.getViewNodeFor(a.getActiveCamera());const o=e._openGLRenderWindow;e._openGLRenderWindow=e._openGLRenderer.getLastAncestorOfType("vtkOpenGLRenderWindow"),o&&!o.isDeleted()&&o!==e._openGLRenderWindow&&n(o),e.context=e._openGLRenderWindow.getContext(),e.tris.setOpenGLRenderWindow(e._openGLRenderWindow)}},t.translucentPass=(i,a)=>{i&&(e.currentRenderPass=a,t.render())},t.zBufferPass=i=>{i&&(e.haveSeenDepthRequest=!0,e.renderDepth=!0,t.render(),e.renderDepth=!1)},t.opaqueZBufferPass=i=>t.zBufferPass(i),t.opaquePass=i=>{i&&t.render()},t.getCoincidentParameters=(i,a)=>e.renderable.getResolveCoincidentTopology()==Wa.PolygonOffset?e.renderable.getCoincidentTopologyPolygonOffsetParameters():null,t.render=()=>{const i=e._openGLImageSlice.getRenderable(),a=e._openGLRenderer.getRenderable();t.renderPiece(a,i)},t.renderPiece=(i,a)=>{if(t.invokeEvent({type:"StartEvent"}),e.renderable.update(),e.currentInput=e.renderable.getInputData(),!e.currentInput){g0("No input!");return}t.updateResliceGeometry(),t.renderPieceStart(i,a),t.renderPieceDraw(i,a),t.renderPieceFinish(i,a),t.invokeEvent({type:"EndEvent"})},t.renderPieceStart=(i,a)=>{t.updateBufferObjects(i,a),a.getProperty().getInterpolationType()===B0.NEAREST?(e.openGLTexture.setMinificationFilter(Ge.NEAREST),e.openGLTexture.setMagnificationFilter(Ge.NEAREST),e.colorTexture.setMinificationFilter(Ge.NEAREST),e.colorTexture.setMagnificationFilter(Ge.NEAREST),e.pwfTexture.setMinificationFilter(Ge.NEAREST),e.pwfTexture.setMagnificationFilter(Ge.NEAREST)):(e.openGLTexture.setMinificationFilter(Ge.LINEAR),e.openGLTexture.setMagnificationFilter(Ge.LINEAR),e.colorTexture.setMinificationFilter(Ge.LINEAR),e.colorTexture.setMagnificationFilter(Ge.LINEAR),e.pwfTexture.setMinificationFilter(Ge.LINEAR),e.pwfTexture.setMagnificationFilter(Ge.LINEAR)),e.lastBoundBO=null},t.renderPieceDraw=(i,a)=>{const o=e.context;e.openGLTexture.activate(),e.colorTexture.activate(),e.pwfTexture.activate(),t.updateShaders(e.tris,i,a),o.drawArrays(o.TRIANGLES,0,e.tris.getCABO().getElementCount()),e.tris.getVAO().release(),e.openGLTexture.deactivate(),e.colorTexture.deactivate(),e.pwfTexture.deactivate()},t.renderPieceFinish=(i,a)=>{},t.updateBufferObjects=(i,a)=>{t.getNeedToRebuildBufferObjects(i,a)&&t.buildBufferObjects(i,a)},t.getNeedToRebuildBufferObjects=(i,a)=>{var o,s,c;return e.VBOBuildTime.getMTime()<t.getMTime()||e.VBOBuildTime.getMTime()<a.getMTime()||e.VBOBuildTime.getMTime()<e.renderable.getMTime()||e.VBOBuildTime.getMTime()<a.getProperty().getMTime()||e.VBOBuildTime.getMTime()<e.currentInput.getMTime()||e.VBOBuildTime.getMTime()<e.resliceGeom.getMTime()||!((o=e.openGLTexture)!=null&&o.getHandle())||!((s=e.colorTexture)!=null&&s.getHandle())||!((c=e.pwfTexture)!=null&&c.getHandle())},t.buildBufferObjects=(i,a)=>{var O,M,A,_;const o=e.currentInput;if(!o)return;const s=(O=o.getPointData())==null?void 0:O.getScalars();if(!s)return;const c=s.getNumberOfComponents();let l=oy(o,s);const f=e._openGLRenderWindow.getGraphicsResourceForObject(s);if(!((M=f==null?void 0:f.oglObject)!=null&&M.getHandle())||(f==null?void 0:f.hash)!==l){e.openGLTexture=Xt.newInstance(),e.openGLTexture.setOpenGLRenderWindow(e._openGLRenderWindow);const k=o.getDimensions();e.openGLTexture.setOglNorm16Ext(e.context.getExtension("EXT_texture_norm16")),e.openGLTexture.resetFormatAndType(),e.openGLTexture.create3DFilterableFromDataArray(k[0],k[1],k[2],s),e._openGLRenderWindow.setGraphicsResourceForObject(s,e.openGLTexture,l),s!==e._scalars&&(e._openGLRenderWindow.registerGraphicsResourceUser(s,t),e._openGLRenderWindow.unregisterGraphicsResourceUser(e._scalars,t)),e._scalars=s}else e.openGLTexture=f.oglObject;const g=a.getProperty(),d=g.getIndependentComponents(),h=d?c:1,p=d?2*h:1,m=g.getRGBTransferFunction();l=Co(m,d,h);const v=e._openGLRenderWindow.getGraphicsResourceForObject(m);if(!((A=v==null?void 0:v.oglObject)!=null&&A.getHandle())||(v==null?void 0:v.hash)!==l){const z=1024*p*3,X=new Uint8ClampedArray(z);if(e.colorTexture=Xt.newInstance(),e.colorTexture.setOpenGLRenderWindow(e._openGLRenderWindow),m){const Z=new Float32Array(3072);for(let ce=0;ce<h;ce++){const J=g.getRGBTransferFunction(ce),de=J.getRange();if(J.getTable(de[0],de[1],1024,Z,1),d)for(let Q=0;Q<1024*3;Q++)X[ce*1024*6+Q]=255*Z[Q],X[ce*1024*6+Q+1024*3]=255*Z[Q];else for(let Q=0;Q<1024*3;Q++)X[ce*1024*6+Q]=255*Z[Q]}e.colorTexture.resetFormatAndType(),e.colorTexture.create2DFromRaw(1024,p,3,ut.UNSIGNED_CHAR,X)}else{for(let Z=0;Z<1024*3;++Z)X[Z]=255*Z/(1023*3),X[Z+1]=255*Z/(1023*3),X[Z+2]=255*Z/(1023*3);e.colorTexture.resetFormatAndType(),e.colorTexture.create2DFromRaw(1024,1,3,ut.UNSIGNED_CHAR,X)}m&&(e._openGLRenderWindow.setGraphicsResourceForObject(m,e.colorTexture,l),m!==e._colorTransferFunc&&(e._openGLRenderWindow.registerGraphicsResourceUser(m,t),e._openGLRenderWindow.unregisterGraphicsResourceUser(e._colorTransferFunc,t)),e._colorTransferFunc=m)}else e.colorTexture=v.oglObject;const T=g.getPiecewiseFunction();l=Co(T,d,h);const C=e._openGLRenderWindow.getGraphicsResourceForObject(T);if(!((_=C==null?void 0:C.oglObject)!=null&&_.getHandle())||(C==null?void 0:C.hash)!==l){const z=1024*p,X=new Uint8ClampedArray(z);if(e.pwfTexture=Xt.newInstance(),e.pwfTexture.setOpenGLRenderWindow(e._openGLRenderWindow),T){const Z=new Float32Array(z),ce=new Float32Array(1024);for(let J=0;J<h;++J){const de=g.getPiecewiseFunction(J);if(de===null)Z.fill(1);else{const Q=de.getRange();if(de.getTable(Q[0],Q[1],1024,ce,1),d)for(let q=0;q<1024;q++)Z[J*1024*2+q]=ce[q],Z[J*1024*2+q+1024]=ce[q];else for(let q=0;q<1024;q++)Z[J*1024*2+q]=ce[q]}}e.pwfTexture.resetFormatAndType(),e.pwfTexture.create2DFromRaw(1024,p,1,ut.FLOAT,Z)}else X.fill(255),e.pwfTexture.resetFormatAndType(),e.pwfTexture.create2DFromRaw(1024,1,1,ut.UNSIGNED_CHAR,X);T&&(e._openGLRenderWindow.setGraphicsResourceForObject(T,e.pwfTexture,l),T!==e._pwFunc&&(e._openGLRenderWindow.registerGraphicsResourceUser(T,t),e._openGLRenderWindow.unregisterGraphicsResourceUser(e._pwFunc,t)),e._pwFunc=T)}else e.pwfTexture=C.oglObject;const x=`${e.resliceGeom.getMTime()}A${e.renderable.getSlabThickness()}`;if(!e.tris.getCABO().getElementCount()||e.VBOBuildString!==x){const k=nt.newInstance({numberOfComponents:3,values:e.resliceGeom.getPoints().getData()});k.setName("points");const z=nt.newInstance({numberOfComponents:1,values:e.resliceGeom.getPolys().getData()}),X={points:k,cellOffset:0};if(e.renderable.getSlabThickness()>0){const Z=e.resliceGeom.getPointData().getNormals();Z?X.normals=Z:g0("Slab mode requested without normals")}e.tris.getCABO().createVBO(z,"polys",_r.SURFACE,X)}e.VBOBuildString=x,e.VBOBuildTime.modified()},t.updateShaders=(i,a,o)=>{if(e.lastBoundBO=i,t.getNeedToRebuildShaders(i,a,o)){const s={Vertex:null,Fragment:null,Geometry:null};t.buildShaders(s,a,o);const c=e._openGLRenderWindow.getShaderCache().readyShaderProgramArray(s.Vertex,s.Fragment,s.Geometry);c!==i.getProgram()&&(i.setProgram(c),i.getVAO().releaseGraphicsResources()),i.getShaderSourceTime().modified()}else e._openGLRenderWindow.getShaderCache().readyShaderProgram(i.getProgram());i.getVAO().bind(),t.setMapperShaderParameters(i,a,o),t.setCameraShaderParameters(i,a,o),t.setPropertyShaderParameters(i,a,o)},t.setMapperShaderParameters=(i,a,o)=>{const s=i.getProgram();if(i.getCABO().getElementCount()&&(e.VBOBuildTime.getMTime()>i.getAttributeUpdateTime().getMTime()||i.getShaderSourceTime().getMTime()>i.getAttributeUpdateTime().getMTime())){s.isUniformUsed("texture1")&&s.setUniformi("texture1",e.openGLTexture.getTextureUnit()),s.isAttributeUsed("vertexWC")&&(i.getVAO().addAttributeArray(s,i.getCABO(),"vertexWC",i.getCABO().getVertexOffset(),i.getCABO().getStride(),e.context.FLOAT,3,e.context.FALSE)||g0("Error setting vertexWC in shader VAO.")),s.isAttributeUsed("normalWC")&&(i.getVAO().addAttributeArray(s,i.getCABO(),"normalWC",i.getCABO().getNormalOffset(),i.getCABO().getStride(),e.context.FLOAT,3,e.context.FALSE)||g0("Error setting normalWC in shader VAO.")),s.isUniformUsed("slabThickness")&&s.setUniformf("slabThickness",e.renderable.getSlabThickness()),s.isUniformUsed("spacing")&&s.setUniform3fv("spacing",e.currentInput.getSpacing()),s.isUniformUsed("slabType")&&s.setUniformi("slabType",e.renderable.getSlabType()),s.isUniformUsed("slabType")&&s.setUniformi("slabType",e.renderable.getSlabType()),s.isUniformUsed("slabTrapezoid")&&s.setUniformi("slabTrapezoid",e.renderable.getSlabTrapezoidIntegration());const l=i.getCABO().getCoordShiftAndScaleEnabled()?i.getCABO().getInverseShiftAndScaleMatrix():null;if(s.isUniformUsed("WCTCMatrix")){const f=e.currentInput,u=f.getDimensions();nn(e.tmpMat4,f.getIndexToWorld()),en(e.tmpMat4,e.tmpMat4,[-.5,-.5,-.5]),ms(e.tmpMat4,e.tmpMat4,u),Ln(e.tmpMat4,e.tmpMat4),l&&vt(e.tmpMat4,e.tmpMat4,l),s.setUniformMatrix("WCTCMatrix",e.tmpMat4)}s.isUniformUsed("vboScaling")&&s.setUniform3fv("vboScaling",i.getCABO().getCoordScale()??[1,1,1]),i.getAttributeUpdateTime().modified()}if(e.haveSeenDepthRequest&&i.getProgram().setUniformi("depthRequest",e.renderDepth?1:0),i.getProgram().isUniformUsed("coffset")){const c=t.getCoincidentParameters(a,o);i.getProgram().setUniformf("coffset",c.offset),i.getProgram().isUniformUsed("cfactor")&&i.getProgram().setUniformf("cfactor",c.factor)}},t.setCameraShaderParameters=(i,a,o)=>{const s=e._openGLCamera.getKeyMatrices(a),c=e._openGLImageSlice.getKeyMatrices(),f=i.getCABO().getCoordShiftAndScaleEnabled()?i.getCABO().getInverseShiftAndScaleMatrix():null,u=i.getProgram();u.isUniformUsed("MCPCMatrix")&&(Be(e.tmpMat4),u.setUniformMatrix("MCPCMatrix",J9([s.wcpc,c.mcwc,f],Bg,e.tmpMat4))),u.isUniformUsed("MCVCMatrix")&&(Be(e.tmpMat4),u.setUniformMatrix("MCVCMatrix",J9([s.wcvc,c.mcwc,f],Bg,e.tmpMat4)))},t.setPropertyShaderParameters=(i,a,o)=>{const s=i.getProgram(),c=o.getProperty(),l=c.getOpacity();s.setUniformf("opacity",l);const f=e.openGLTexture.getComponents(),u=c.getIndependentComponents();if(u)for(let p=0;p<f;++p)s.setUniformf(`mix${p}`,c.getComponentWeight(p));const g=e.openGLTexture.getVolumeInfo();for(let p=0;p<f;p++){let m=c.getColorWindow(),v=c.getColorLevel();const y=u?p:0,T=c.getRGBTransferFunction(y);if(T&&c.getUseLookupTableScalarRange()){const x=T.getRange();m=x[1]-x[0],v=.5*(x[1]+x[0])}const C=g.scale[p]/m,w=(g.offset[p]-v)/m+.5;s.setUniformf(`cshift${p}`,w),s.setUniformf(`cscale${p}`,C)}const d=e.colorTexture.getTextureUnit();s.setUniformi("colorTexture1",d);for(let p=0;p<f;p++){let m=1,v=0;const y=u?p:0,T=c.getPiecewiseFunction(y);if(T){const C=T.getRange(),w=C[1]-C[0],x=.5*(C[0]+C[1]);m=g.scale[p]/w,v=(g.offset[p]-x)/w+.5}s.setUniformf(`pwfshift${p}`,v),s.setUniformf(`pwfscale${p}`,m)}const h=e.pwfTexture.getTextureUnit();s.setUniformi("pwfTexture1",h),s.setUniform4fv("backgroundColor",e.renderable.getBackgroundColor())},t.getNeedToRebuildShaders=(i,a,o)=>{var d;const s=e.openGLTexture.getComponents(),c=o.getProperty().getIndependentComponents(),l=e.renderable.getSlabThickness(),f=e.renderable.getSlabType(),u=e.renderable.getSlabTrapezoidIntegration();let g=!1;return(!e.currentRenderPass&&e.lastRenderPassShaderReplacement||e.currentRenderPass&&e.currentRenderPass.getShaderReplacement()!==e.lastRenderPassShaderReplacement)&&(g=!0),g||e.lastHaveSeenDepthRequest!==e.haveSeenDepthRequest||((d=i.getProgram())==null?void 0:d.getHandle())===0||e.lastTextureComponents!==s||e.lastIndependentComponents!==c||e.lastSlabThickness!==l||e.lastSlabType!==f||e.lastSlabTrapezoidIntegration!==u?(e.lastHaveSeenDepthRequest=e.haveSeenDepthRequest,e.lastTextureComponents=s,e.lastIndependentComponents=c,e.lastSlabThickness=l,e.lastSlabType=f,e.lastSlabTrapezoidIntegration=u,!0):!1},t.getShaderTemplate=(i,a,o)=>{i.Vertex=LH,i.Fragment=IH,i.Geometry=""},t.replaceShaderValues=(i,a,o)=>{if(t.replaceShaderTCoord(i,a,o),t.replaceShaderPositionVC(i,a,o),e.haveSeenDepthRequest){let s=i.Fragment;s=te.substitute(s,"//VTK::ZBuffer::Dec","uniform int depthRequest;").result,s=te.substitute(s,"//VTK::ZBuffer::Impl",["if (depthRequest == 1) {","float iz = floor(gl_FragCoord.z*65535.0 + 0.1);","float rf = floor(iz/256.0)/255.0;","float gf = mod(iz,256.0)/255.0;","gl_FragData[0] = vec4(rf, gf, 0.0, 1.0); }"]).result,i.Fragment=s}t.replaceShaderCoincidentOffset(i,a,o)},t.replaceShaderTCoord=(i,a,o)=>{let s=i.Vertex;const c=i.Geometry;let l=i.Fragment;const f=["uniform mat4 WCTCMatrix;","out vec3 fragTexCoord;"],u=e.renderable.getSlabThickness();s=te.substitute(s,"//VTK::TCoord::Dec",f).result;const g=["fragTexCoord = (WCTCMatrix * vertexWC).xyz;"];s=te.substitute(s,"//VTK::TCoord::Impl",g).result;const d=e.openGLTexture.getComponents(),h=o.getProperty().getIndependentComponents();let p=["in vec3 fragTexCoord;","uniform highp sampler3D texture1;","uniform mat4 WCTCMatrix;","uniform float cshift0;","uniform float cscale0;","uniform float pwfshift0;","uniform float pwfscale0;","uniform sampler2D colorTexture1;","uniform sampler2D pwfTexture1;","uniform float opacity;","uniform vec4 backgroundColor;"];if(h){for(let v=1;v<d;v++)p=p.concat([`uniform float cshift${v};`,`uniform float cscale${v};`,`uniform float pwfshift${v};`,`uniform float pwfscale${v};`]);switch(d){case 1:p=p.concat(["uniform float mix0;","#define height0 0.5"]);break;case 2:p=p.concat(["uniform float mix0;","uniform float mix1;","#define height0 0.25","#define height1 0.75"]);break;case 3:p=p.concat(["uniform float mix0;","uniform float mix1;","uniform float mix2;","#define height0 0.17","#define height1 0.5","#define height2 0.83"]);break;case 4:p=p.concat(["uniform float mix0;","uniform float mix1;","uniform float mix2;","uniform float mix3;","#define height0 0.125","#define height1 0.375","#define height2 0.625","#define height3 0.875"]);break;default:g0("Unsupported number of independent coordinates.")}}u>0&&(p=p.concat(["uniform vec3 spacing;","uniform float slabThickness;","uniform int slabType;","uniform int slabTrapezoid;","uniform vec3 vboScaling;"]),p=p.concat(["vec4 compositeValue(vec4 currVal, vec4 valToComp, int trapezoid)","{","  vec4 retVal = vec4(1.0);","  if (slabType == 0) // min","  {","    retVal = min(currVal, valToComp);","  }","  else if (slabType == 1) // max","  {","    retVal = max(currVal, valToComp);","  }","  else if (slabType == 3) // sum","  {","    retVal = currVal + (trapezoid > 0 ? 0.5 * valToComp : valToComp); ","  }","  else // mean","  {","    retVal = currVal + (trapezoid > 0 ? 0.5 * valToComp : valToComp); ","  }","  return retVal;","}"])),l=te.substitute(l,"//VTK::TCoord::Dec",p).result;let m=["if (any(greaterThan(fragTexCoord, vec3(1.0))) || any(lessThan(fragTexCoord, vec3(0.0))))","{","  // set the background color and exit","  gl_FragData[0] = backgroundColor;","  return;","}","vec4 tvalue = texture(texture1, fragTexCoord);"];if(u>0&&(m=m.concat(["// Get the first and last samples","int numSlices = 1;","float scaling = min(min(spacing.x, spacing.y), spacing.z) * 0.5;","vec3 normalxspacing = scaling * normalWCVSOutput;","float distTraveled = length(normalxspacing);","int trapezoid = 0;","while (distTraveled < slabThickness * 0.5)","{","  distTraveled += length(normalxspacing);","  float fnumSlices = float(numSlices);","  if (distTraveled > slabThickness * 0.5)","  {","    // Before stepping outside the slab, sample at the boundaries","    normalxspacing = normalWCVSOutput * slabThickness * 0.5 / fnumSlices;","    trapezoid = slabTrapezoid;","  }","  vec3 fragTCoordNeg = (WCTCMatrix * vec4(vertexWCVSOutput.xyz - fnumSlices * normalxspacing * vboScaling, 1.0)).xyz;","  if (!any(greaterThan(fragTCoordNeg, vec3(1.0))) && !any(lessThan(fragTCoordNeg, vec3(0.0))))","  {","    vec4 newVal = texture(texture1, fragTCoordNeg);","    tvalue = compositeValue(tvalue, newVal, trapezoid);","    numSlices += 1;","  }","  vec3 fragTCoordPos = (WCTCMatrix * vec4(vertexWCVSOutput.xyz + fnumSlices * normalxspacing * vboScaling, 1.0)).xyz;","  if (!any(greaterThan(fragTCoordNeg, vec3(1.0))) && !any(lessThan(fragTCoordNeg, vec3(0.0))))","  {","    vec4 newVal = texture(texture1, fragTCoordPos);","    tvalue = compositeValue(tvalue, newVal, trapezoid);","    numSlices += 1;","  }","}","// Finally, if slab type is *mean*, divide the sum by the numSlices","if (slabType == 2)","{","  tvalue = tvalue / float(numSlices);","}"])),h){const v=["r","g","b","a"];for(let y=0;y<d;++y)m=m.concat([`vec3 tcolor${y} = mix${y} * texture2D(colorTexture1, vec2(tvalue.${v[y]} * cscale${y} + cshift${y}, height${y})).rgb;`,`float compWeight${y} = mix${y} * texture2D(pwfTexture1, vec2(tvalue.${v[y]} * pwfscale${y} + pwfshift${y}, height${y})).r;`]);switch(d){case 1:m=m.concat(["gl_FragData[0] = vec4(tcolor0.rgb, compWeight0 * opacity);"]);break;case 2:m=m.concat(["float weightSum = compWeight0 + compWeight1;","gl_FragData[0] = vec4(vec3((tcolor0.rgb * (compWeight0 / weightSum)) + (tcolor1.rgb * (compWeight1 / weightSum))), opacity);"]);break;case 3:m=m.concat(["float weightSum = compWeight0 + compWeight1 + compWeight2;","gl_FragData[0] = vec4(vec3((tcolor0.rgb * (compWeight0 / weightSum)) + (tcolor1.rgb * (compWeight1 / weightSum)) + (tcolor2.rgb * (compWeight2 / weightSum))), opacity);"]);break;case 4:m=m.concat(["float weightSum = compWeight0 + compWeight1 + compWeight2 + compWeight3;","gl_FragData[0] = vec4(vec3((tcolor0.rgb * (compWeight0 / weightSum)) + (tcolor1.rgb * (compWeight1 / weightSum)) + (tcolor2.rgb * (compWeight2 / weightSum)) + (tcolor3.rgb * (compWeight3 / weightSum))), opacity);"]);break;default:g0("Unsupported number of independent coordinates.")}}else switch(d){case 1:m=m.concat(["// Dependent components","float intensity = tvalue.r;","vec3 tcolor = texture2D(colorTexture1, vec2(intensity * cscale0 + cshift0, 0.5)).rgb;","float scalarOpacity = texture2D(pwfTexture1, vec2(intensity * pwfscale0 + pwfshift0, 0.5)).r;","gl_FragData[0] = vec4(tcolor, scalarOpacity * opacity);"]);break;case 2:m=m.concat(["float intensity = tvalue.r*cscale0 + cshift0;","gl_FragData[0] = vec4(texture2D(colorTexture1, vec2(intensity, 0.5)).rgb, pwfscale0*tvalue.g + pwfshift0);"]);break;case 3:m=m.concat(["vec4 tcolor = cscale0*tvalue + cshift0;","gl_FragData[0] = vec4(texture2D(colorTexture1, vec2(tcolor.r,0.5)).r,","  texture2D(colorTexture1, vec2(tcolor.g,0.5)).r,","  texture2D(colorTexture1, vec2(tcolor.b,0.5)).r, opacity);"]);break;default:m=m.concat(["vec4 tcolor = cscale0*tvalue + cshift0;","gl_FragData[0] = vec4(texture2D(colorTexture1, vec2(tcolor.r,0.5)).r,","  texture2D(colorTexture1, vec2(tcolor.g,0.5)).r,","  texture2D(colorTexture1, vec2(tcolor.b,0.5)).r, tcolor.a);"])}l=te.substitute(l,"//VTK::TCoord::Impl",m).result,i.Vertex=s,i.Fragment=l,i.Geometry=c},t.replaceShaderPositionVC=(i,a,o)=>{let s=i.Vertex;const c=i.Geometry;let l=i.Fragment;const f=e.renderable.getSlabThickness();let u=["attribute vec4 vertexWC;"];u=u.concat([`//${t.getMTime()}${e.resliceGeomUpdateString}`]),f>0&&(u=u.concat(["attribute vec3 normalWC;","varying vec3 normalWCVSOutput;","varying vec4 vertexWCVSOutput;"])),s=te.substitute(s,"//VTK::PositionVC::Dec",u).result;let g=["gl_Position = MCPCMatrix * vertexWC;"];f>0&&(g=g.concat(["normalWCVSOutput = normalWC;","vertexWCVSOutput = vertexWC;"])),s=te.substitute(s,"//VTK::PositionVC::Impl",g).result,s=te.substitute(s,"//VTK::Camera::Dec",["uniform mat4 MCPCMatrix;","uniform mat4 MCVCMatrix;"]).result;let d=[];f>0&&(d=d.concat(["varying vec3 normalWCVSOutput;","varying vec4 vertexWCVSOutput;"])),l=te.substitute(l,"//VTK::PositionVC::Dec",d).result,i.Vertex=s,i.Geometry=c,i.Fragment=l};function r(i){fa.normalize(i);const a=[0,0,0];for(let o=0;o<3;++o){cF(a),a[o]=1;const s=fa.dot(i,a);if(s<-.999999||s>.999999)return[!0,o]}return[!1,2]}t.updateResliceGeometry=()=>{var u;let i="";const a=e.currentInput,o=a==null?void 0:a.getBounds();let s=!0,c=2;const l=e.renderable.getSlicePolyData(),f=e.renderable.getSlicePlane();if(l)i=i.concat(`PolyData${l.getMTime()}`);else if(f){i=i.concat(`Plane${f.getMTime()}`);const g=P4();a&&(i=i.concat(`Image${a.getMTime()}`),aE(g,...a.getDirection()),md(g,g));const d=[...f.getNormal()];rp(d,d,g),[s,c]=r(d)}else{const g=$r.newInstance();g.setNormal(0,0,1);let d=[0,1,0,1,0,1];a&&(d=o),g.setOrigin(d[0],d[2],.5*(d[5]+d[4])),e.renderable.setSlicePlane(g),i=i.concat(`Plane${f==null?void 0:f.getMTime()}`),a&&(i=i.concat(`Image${a.getMTime()}`))}if(!e.resliceGeom||e.resliceGeomUpdateString!==i){if(l)e.resliceGeom||(e.resliceGeom=Ii.newInstance()),e.resliceGeom.getPoints().setData(l.getPoints().getData(),3),e.resliceGeom.getPolys().setData(l.getPolys().getData(),1),e.resliceGeom.getPointData().setNormals(l.getPointData().getNormals());else if(f)if(s){const g=new Float32Array(12),d=a.worldToIndex(f.getOrigin(),[0,0,0]),h=[(c+1)%3,(c+2)%3].sort(),p=a.getSpatialExtent();let m=0;for(let w=0;w<2;++w)for(let x=0;x<2;++x)g[m+c]=d[c],g[m+h[0]]=p[2*h[0]+x],g[m+h[1]]=p[2*h[1]+w],m+=3;e.transform.setMatrix(a.getIndexToWorld()),e.transform.transformPoints(g,g);const v=new Uint16Array(8);v[0]=3,v[1]=0,v[2]=1,v[3]=3,v[4]=3,v[5]=0,v[6]=3,v[7]=2;const y=f.getNormal();fa.normalize(y);const T=new Float32Array(12);for(let w=0;w<4;++w)T[3*w]=y[0],T[3*w+1]=y[1],T[3*w+2]=y[2];e.resliceGeom||(e.resliceGeom=Ii.newInstance()),e.resliceGeom.getPoints().setData(g,3),e.resliceGeom.getPolys().setData(v,1);const C=nt.newInstance({numberOfComponents:3,values:T,name:"Normals"});e.resliceGeom.getPointData().setNormals(C)}else{e.outlineFilter.setInputData(a),e.cutter.setInputConnection(e.outlineFilter.getOutputPort()),e.cutter.setCutFunction(f),e.lineToSurfaceFilter.setInputConnection(e.cutter.getOutputPort()),e.lineToSurfaceFilter.update(),e.resliceGeom||(e.resliceGeom=Ii.newInstance());const g=e.lineToSurfaceFilter.getOutputData();e.resliceGeom.getPoints().setData(g.getPoints().getData(),3),e.resliceGeom.getPolys().setData(g.getPolys().getData(),1),e.resliceGeom.getPointData().setNormals(g.getPointData().getNormals());const d=f.getNormal(),h=e.resliceGeom.getNumberOfPoints();fa.normalize(d);const p=new Float32Array(h*3);for(let v=0;v<h;++v)p[3*v]=d[0],p[3*v+1]=d[1],p[3*v+2]=d[2];const m=nt.newInstance({numberOfComponents:3,values:p,name:"Normals"});e.resliceGeom.getPointData().setNormals(m)}else g0("Something went wrong.","A default slice plane should have been created in the beginning of","updateResliceGeometry.");e.resliceGeomUpdateString=i,(u=e.resliceGeom)==null||u.modified()}},t.setOpenGLTexture=i=>{i&&(e.openGLTexture=i,e._externalOpenGLTexture=!0)},t.delete=gd(()=>{e._openGLRenderWindow&&n(e._openGLRenderWindow)},t.delete)}const PH={VBOBuildTime:{},VBOBuildString:null,haveSeenDepthRequest:!1,lastHaveSeenDepthRequest:!1,lastIndependentComponents:!1,lastTextureComponents:0,lastSlabThickness:0,lastSlabTrapezoidIntegration:0,lastSlabType:-1,openGLTexture:null,colorTextureString:null,pwfTextureString:null,resliceGeom:null,resliceGeomUpdateString:null,tris:null,colorTexture:null,pwfTexture:null,_externalOpenGLTexture:!1};function NH(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,PH,n),Bt.extend(t,e,n),To.implementReplaceShaderCoincidentOffset(t,e,n),To.implementBuildShadersWithReplacements(t,e,n),e.tris=Oo.newInstance(),e.openGLTexture=null,e.colorTexture=null,e.pwfTexture=null,e.VBOBuildTime={},zt(e.VBOBuildTime),e.tmpMat4=Be(new Float64Array(16)),e.outlineFilter=RH.newInstance(),e.outlineFilter.setGenerateFaces(!0),e.outlineFilter.setGenerateLines(!1),e.cubePolyData=Ii.newInstance(),e.cutter=vH.newInstance(),e.lineToSurfaceFilter=gH.newInstance(),e.transform=bH.newInstance(),hi(t,e,["openGLTexture"]),VH(t,e)}const kH=Rt(NH,"vtkOpenGLImageResliceMapper");Wn("vtkImageResliceMapper",kH);const eR=Object.create(null);function Ta(t,e){eR[t]=e}function AH(t,e){e.classHierarchy.push("vtkWebGPUViewNodeFactory")}const FH={};function UH(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,FH,n),e.overrides=eR,I4.extend(t,e,n),AH(t,e)}P.newInstance(UH,"vtkWebGPUViewNodeFactory");function BH(t,e){e.classHierarchy.push("vtkWebGPUCamera"),t.getProjectionMatrix=(n,r,i,a)=>{if(Be(n),e.renderable.getParallelProjection()){const o=e.renderable.getParallelScale(),s=o*r,c=o,l=(a[0]-1)*s,f=(a[0]+1)*s,u=(a[1]-1)*c,g=(a[1]+1)*c,d=1/(f-l),h=1/(g-u);n[0]=2*d,n[5]=2*h,n[10]=1/(i[1]-i[0]),n[12]=(f+l)*d,n[13]=(g+u)*h,n[14]=i[1]/(i[1]-i[0])}else{const o=Math.tan(Math.PI*e.renderable.getViewAngle()/360);let s,c;e.renderable.getUseHorizontalViewAngle()===!0?(s=i[0]*o,c=i[0]*o/r):(s=i[0]*o*r,c=i[0]*o);const l=(a[0]-1)*s,f=(a[0]+1)*s,u=(a[1]-1)*c,g=(a[1]+1)*c;n[0]=2*i[0]/(f-l),n[5]=2*i[0]/(g-u),n[12]=(l+f)/(f-l),n[13]=(u+g)/(g-u),n[10]=0,n[14]=i[0],n[11]=-1,n[15]=0}},t.convertToOpenGLDepth=n=>{if(e.renderable.getParallelProjection())return 1-n;const r=e.renderable.getClippingRangeByReference();let i=-r[0]/n;return i=(r[0]+r[1])/(r[1]-r[0])+2*r[0]*r[1]/(i*(r[1]-r[0])),.5*i+.5},t.getKeyMatrices=n=>{const r=n.getRenderable(),i=n.getParent();if(Math.max(i.getMTime(),t.getMTime(),r.getMTime(),e.renderable.getMTime(),n.getStabilizedTime())>e.keyMatrixTime.getMTime()){const a=e.renderable.getViewMatrix();nn(e.keyMatrices.normalMatrix,a),e.keyMatrices.normalMatrix[3]=0,e.keyMatrices.normalMatrix[7]=0,e.keyMatrices.normalMatrix[11]=0,Ln(e.keyMatrices.normalMatrix,e.keyMatrices.normalMatrix),ft(e.keyMatrices.wcvc,a);const o=n.getStabilizedCenterByReference();en(e.keyMatrices.scvc,e.keyMatrices.wcvc,o);const s=n.getAspectRatio(),c=e.renderable.getClippingRangeByReference();t.getProjectionMatrix(e.keyMatrices.vcpc,s,c,e.renderable.getWindowCenterByReference()),vt(e.keyMatrices.scpc,e.keyMatrices.vcpc,e.keyMatrices.scvc),Ln(e.keyMatrices.pcsc,e.keyMatrices.scpc),e.keyMatrixTime.modified()}return e.keyMatrices}}const GH={keyMatrixTime:null,keyMatrices:null};function $H(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,GH,n),Bt.extend(t,e,n),e.keyMatrixTime={},P.obj(e.keyMatrixTime),e.keyMatrices={normalMatrix:new Float64Array(16),vcpc:new Float64Array(16),pcsc:new Float64Array(16),wcvc:new Float64Array(16),scpc:new Float64Array(16),scvc:new Float64Array(16)},P.setGet(t,e,["keyMatrixTime"]),BH(t,e)}const WH=P.newInstance($H);Ta("vtkCamera",WH);function zH(t,e){e.classHierarchy.push("vtkWebGPUBindGroup"),t.setBindables=n=>{if(e.bindables.length===n.length){let r=!0;for(let i=0;i<e.bindables.length;i++)e.bindables[i]!==n[i]&&(r=!1);if(r)return}e.bindables=n,t.modified()},t.getBindGroupLayout=n=>{const r=[];for(let i=0;i<e.bindables.length;i++){const a=e.bindables[i].getBindGroupLayoutEntry();a.binding=i,r.push(a)}return n.getBindGroupLayout({entries:r})},t.getBindGroup=n=>{let r=t.getMTime();for(let a=0;a<e.bindables.length;a++){const o=e.bindables[a].getBindGroupTime().getMTime();r=o>r?o:r}if(r<e.bindGroupTime.getMTime())return e.bindGroup;const i=[];for(let a=0;a<e.bindables.length;a++){const o=e.bindables[a].getBindGroupEntry();o.binding=a,i.push(o)}return e.bindGroup=n.getHandle().createBindGroup({layout:t.getBindGroupLayout(n),entries:i,label:e.label}),e.bindGroupTime.modified(),e.bindGroup},t.getShaderCode=n=>{const r=[],i=n.getBindGroupLayoutCount(e.label);for(let a=0;a<e.bindables.length;a++)r.push(e.bindables[a].getShaderCode(a,i));return r.join(`
`)}}const jH={device:null,handle:null,label:null};function tR(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,jH,n),P.obj(t,e),e.bindables=[],e.bindGroupTime={},P.obj(e.bindGroupTime,{mtime:0}),P.get(t,e,["bindGroupTime","handle","sizeInBytes","usage"]),P.setGet(t,e,["label","device","arrayInformation"]),zH(t,e)}const HH=P.newInstance(tR);var nR={newInstance:HH,extend:tR};function KH(t,e){e.classHierarchy.push("vtkWebGPUShaderModule"),t.initialize=(n,r)=>{e.device=n,e.handle=e.device.getHandle().createShaderModule({code:r.getCode()})}}const qH={device:null,handle:null};function rR(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,qH,n),P.obj(t,e),P.get(t,e,["lastCameraMTime"]),P.setGet(t,e,["device","handle"]),KH(t,e)}const XH=P.newInstance(rR,"vtkWebGPUShaderModule");var YH={newInstance:XH,extend:rR};function ZH(t,e,n){let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!0;const i=Array.isArray(n)?n.join(`
`):n;let a=!1;t.search(e)!==-1&&(a=!0);let o="";r&&(o="g");const s=new RegExp(e,o),c=t.replace(s,i);return{replace:a,result:c}}function QH(t,e){e.classHierarchy.push("vtkWebGPUShaderCache"),t.getShaderModule=n=>{const r=n.getType(),i=n.getHash(),a=e._shaderModules.keys();for(let s=0;s<a.length;s++){const c=a[s];if(c.getHash()===i&&c.getType()===r)return e._shaderModules.get(c)}const o=YH.newInstance();return o.initialize(e.device,n),e._shaderModules.set(n,o),o}}const JH={shaderModules:null,device:null,window:null};function iR(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,JH,n),e._shaderModules=new Map,P.obj(t,e),P.setGet(t,e,["device","window"]),QH(t,e)}const eK=P.newInstance(iR,"vtkWebGPUShaderCache");var Ut={newInstance:eK,extend:iR,substitute:ZH};function tK(t,e){e.classHierarchy.push("vtkWebGPUPipeline"),t.getShaderDescriptions=()=>e.shaderDescriptions,t.initialize=(n,r)=>{e.pipelineDescription=e.renderEncoder.getPipelineSettings(),e.pipelineDescription.primitive.topology=e.topology,e.pipelineDescription.vertex=e.vertexState,e.pipelineDescription.label=r;const i=[];for(let a=0;a<e.layouts.length;a++)i.push(e.layouts[a].layout);e.pipelineLayout=n.getHandle().createPipelineLayout({bindGroupLayouts:i}),e.pipelineDescription.layout=e.pipelineLayout;for(let a=0;a<e.shaderDescriptions.length;a++){const o=e.shaderDescriptions[a],s=n.getShaderModule(o);o.getType()==="vertex"&&(e.pipelineDescription.vertex.module=s.getHandle(),e.pipelineDescription.vertex.entryPoint="main"),o.getType()==="fragment"&&(e.pipelineDescription.fragment.module=s.getHandle(),e.pipelineDescription.fragment.entryPoint="main")}e.handle=n.getHandle().createRenderPipeline(e.pipelineDescription)},t.getShaderDescription=n=>{for(let r=0;r<e.shaderDescriptions.length;r++)if(e.shaderDescriptions[r].getType()===n)return e.shaderDescriptions[r];return null},t.addBindGroupLayout=n=>{n&&e.layouts.push({layout:n.getBindGroupLayout(e.device),label:n.getLabel()})},t.getBindGroupLayout=n=>e.layouts[n].layout,t.getBindGroupLayoutCount=n=>{for(let r=0;r<e.layouts.length;r++)if(e.layouts[r].label===n)return r;return 0},t.bindVertexInput=(n,r)=>{r.bindBuffers(n)}}const nK={handle:null,layouts:null,renderEncoder:null,shaderDescriptions:null,vertexState:null,topology:null,pipelineDescription:null};function aR(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,nK,n),zt(t,e),e.layouts=[],e.shaderDescriptions=[],hi(t,e,["handle","pipelineDescription"]),Vn(t,e,["device","renderEncoder","topology","vertexState"]),tK(t,e)}const rK=Rt(aR,"vtkWebGPUPipeline");var iK={newInstance:rK,extend:aR};function aK(t,e){e.classHierarchy.push("vtkWebGPUShaderDescription"),t.hasOutput=n=>e.outputNames.includes(n),t.addOutput=function(n,r){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:void 0;e.outputTypes.push(n),e.outputNames.push(r),e.outputInterpolations.push(i)},t.addBuiltinOutput=(n,r)=>{e.builtinOutputTypes.push(n),e.builtinOutputNames.push(r)},t.addBuiltinInput=(n,r)=>{e.builtinInputTypes.push(n),e.builtinInputNames.push(r)},t.replaceShaderCode=(n,r)=>{const i=[];let a=[];if(r&&i.push(r.getShaderCode()),n||e.builtinInputNames.length){const o=[];if(o.push(`struct ${e.type}Input
{`),n){const s=n.getOutputNamesByReference(),c=n.getOutputTypesByReference(),l=n.getOutputInterpolationsByReference();for(let f=0;f<s.length;f++)l[f]!==void 0?o.push(`  @location(${f}) @interpolate(${l[f]}) ${s[f]} : ${c[f]},`):o.push(`  @location(${f}) ${s[f]} : ${c[f]},`)}for(let s=0;s<e.builtinInputNames.length;s++)o.push(`  ${e.builtinInputNames[s]} : ${e.builtinInputTypes[s]},`);o.length>1&&(o.push("};"),a=o,i[i.length-1]+=",",i.push(`input: ${e.type}Input`))}if(i.length&&(e.code=Ut.substitute(e.code,"//VTK::IOStructs::Input",i).result),e.outputNames.length+e.builtinOutputNames.length){const o=[`struct ${e.type}Output
{`];for(let s=0;s<e.outputNames.length;s++)e.outputInterpolations[s]!==void 0?o.push(`  @location(${s}) @interpolate(${e.outputInterpolations[s]}) ${e.outputNames[s]} : ${e.outputTypes[s]},`):o.push(`  @location(${s}) ${e.outputNames[s]} : ${e.outputTypes[s]},`);for(let s=0;s<e.builtinOutputNames.length;s++)o.push(`  ${e.builtinOutputNames[s]} : ${e.builtinOutputTypes[s]},`);o.push("};"),a=a.concat(o),e.code=Ut.substitute(e.code,"//VTK::IOStructs::Output",[`-> ${e.type}Output`]).result}e.code=Ut.substitute(e.code,"//VTK::IOStructs::Dec",a).result}}const oK={type:null,hash:null,code:null,outputNames:null,outputTypes:null};function oR(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,oK,n),e.outputNames=[],e.outputTypes=[],e.outputInterpolations=[],e.builtinOutputNames=[],e.builtinOutputTypes=[],e.builtinInputNames=[],e.builtinInputTypes=[],P.obj(t,e),P.setGet(t,e,["type","hash","code"]),P.getArray(t,e,["outputTypes","outputNames","outputInterpolations"]),aK(t,e)}const sK=P.newInstance(oR,"vtkWebGPUShaderDescription");var e7={newInstance:sK,extend:oR};const t7={r8unorm:{numComponents:1,nativeType:Uint8Array,stride:1,elementSize:1,sampleType:"float"},r8snorm:{numComponents:1,nativeType:Int8Array,stride:1,elementSize:1,sampleType:"float"},r8uint:{numComponents:1,nativeType:Uint8Array,stride:1,elementSize:1,sampleType:"uint"},r8sint:{numComponents:1,nativeType:Int8Array,stride:1,elementSize:1,sampleType:"sint"},r16uint:{numComponents:1,nativeType:Uint16Array,stride:2,elementSize:2,sampleType:"uint"},r16sint:{numComponents:1,nativeType:Int16Array,stride:2,elementSize:2,sampleType:"sint"},r16float:{numComponents:1,nativeType:Float32Array,stride:2,elementSize:2,sampleType:"float"},rg8unorm:{numComponents:2,nativeType:Uint8Array,stride:2,elementSize:1,sampleType:"float"},rg8snorm:{numComponents:2,nativeType:Int8Array,stride:2,elementSize:1,sampleType:"float"},rg8uint:{numComponents:2,nativeType:Uint8Array,stride:2,elementSize:1,sampleType:"uint"},rg8sint:{numComponents:2,nativeType:Int8Array,stride:2,elementSize:1,sampleType:"sint"},r32uint:{numComponents:1,nativeType:Uint32Array,stride:4,elementSize:4,sampleType:"uint"},r32sint:{numComponents:1,nativeType:Int32Array,stride:4,elementSize:4,sampleType:"sint"},r32float:{numComponents:1,nativeType:Float32Array,stride:4,elementSize:4,sampleType:"unfilterable-float"},rg16uint:{numComponents:2,nativeType:Uint16Array,stride:4,elementSize:2,sampleType:"uint"},rg16sint:{numComponents:2,nativeType:Int16Array,stride:4,elementSize:2,sampleType:"sint"},rg16float:{numComponents:2,nativeType:Float32Array,stride:4,elementSize:2,sampleType:"float"},rgba8unorm:{numComponents:4,nativeType:Uint8Array,stride:4,elementSize:1,sampleType:"float"},"rgba8unorm-srgb":{numComponents:4,nativeType:Uint8Array,stride:4,elementSize:1,sampleType:"float"},rgba8snorm:{numComponents:4,nativeType:Int8Array,stride:4,elementSize:1,sampleType:"float"},rgba8uint:{numComponents:4,nativeType:Uint8Array,stride:4,elementSize:1,sampleType:"uint"},rgba8sint:{numComponents:4,nativeType:Int8Array,stride:4,elementSize:1,sampleType:"sint"},bgra8unorm:{numComponents:4,nativeType:Uint8Array,stride:4,elementSize:1,sampleType:"float"},"bgra8unorm-srgb":{numComponents:4,nativeType:Uint8Array,stride:4,elementSize:1,sampleType:"float"},rgb9e5ufloat:{numComponents:4,nativeType:Uint32Array,stride:4,sampleType:"float"},rgb10a2unorm:{numComponents:4,nativeType:Uint32Array,stride:4,sampleType:"float"},rg11b10ufloat:{numComponents:4,nativeType:Float32Array,stride:4,sampleType:"float"},rg32uint:{numComponents:2,nativeType:Uint32Array,stride:8,elementSize:4,sampleType:"uint"},rg32sint:{numComponents:2,nativeType:Int32Array,stride:8,elementSize:4,sampleType:"sint"},rg32float:{numComponents:2,nativeType:Float32Array,stride:8,elementSize:4,sampleType:"unfilterable-float"},rgba16uint:{numComponents:4,nativeType:Uint16Array,stride:8,elementSize:2,sampleType:"uint"},rgba16sint:{numComponents:4,nativeType:Int16Array,stride:8,elementSize:2,sampleType:"sint"},rgba16float:{numComponents:4,nativeType:Float32Array,stride:8,elementSize:2,sampleType:"float"},rgba32uint:{numComponents:4,nativeType:Uint32Array,stride:16,elementSize:4,sampleType:"uint"},rgba32sint:{numComponents:4,nativeType:Int32Array,stride:16,elementSize:4,sampleType:"sint"},rgba32float:{numComponents:4,nativeType:Float32Array,stride:16,elementSize:4,sampleType:"unfilterable-float"},stencil8:{numComponents:1,nativeType:Uint8Array,stride:1,elementSize:1,sampleType:"uint"},depth16unorm:{numComponents:1,nativeType:Uint16Array,stride:2,elementSize:2,sampleType:"depth"},depth24plus:{numComponents:1,nativeType:Uint32Array,stride:4,elementSize:3,sampleType:"depth"},"depth24plus-stencil8":{numComponents:2,nativeType:Uint32Array,stride:4,sampleType:"mixed"},depth32float:{numComponents:1,nativeType:Float32Array,stride:4,elementSize:4,sampleType:"depth"}};function cK(t){return!t||t.length<6?0:t in t7?t7[t]:(mt(`unknown format ${t}`),null)}function lK(t){if(!t||t.length<5)return 0;let e=1;t[t.length-2]==="x"&&(e=Number(t[t.length-1]));const n=e===1?t.length-1:t.length-3,r=Number(t[n]);if(Number.isNaN(r))return mt(`unknown format ${t}`),0;const i=5-r/2;return e*i}function uK(t){if(!t||t.length<5)return 0;let e=1;return t[t.length-2]==="x"&&(e=Number(t[t.length-1])),e}function fK(t){if(!t||t.length<5)return 0;let e;if(t[0]==="f")e="Float";else if(t[0]==="s")e="Int";else if(t[0]==="u")e="Uint";else{mt(`unknown format ${t}`);return}const n=t.split("x")[0],r=Number(n[n.length-1]);if(Number.isNaN(r)){mt(`unknown format ${t}`);return}return e+=8*(5-r/2),e+="Array",e}function gK(t){let e;if(t[0]==="f"||t[1]==="n")e="f32";else if(t[0]==="s"&&t[1]==="i")e="i32";else if(t[0]==="u"&&t[1]==="i")e="u32";else{mt(`unknown format ${t}`);return}let n=1;return t[t.length-2]==="x"&&(n=Number(t[t.length-1])),n===4?`vec4<${e}>`:n===3?`vec3<${e}>`:n===2?`vec2<${e}>`:e}function dK(t){if(!t)return 0;let e=1;return t.substring(0,3)==="vec"?e=Number(t[3]):t.substring(0,3)==="mat"&&(e=t[3]*t[5]),e*4}function pK(t){if(t){if(t.includes("f32"))return"Float32Array";if(t.includes("i32"))return"Int32Array";if(t.includes("u32"))return"Uint32Array";mt(`unknown format ${t}`)}}var Mr={getDetailsFromTextureFormat:cK,getByteStrideFromBufferFormat:lK,getNumberOfComponentsFromBufferFormat:uK,getNativeTypeFromBufferFormat:fK,getShaderTypeFromBufferFormat:gK,getByteStrideFromShaderFormat:dK,getNativeTypeFromShaderFormat:pK};function hK(t,e){if(t===e)return!0;if(t==null||e==null||t.length!==e.length)return!1;for(let n=0;n<t.length;++n)if(!e.includes(t[n]))return!1;return!0}function mK(t,e){e.classHierarchy.push("vtkWebGPUVertexInput"),t.addBuffer=function(n,r){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"vertex",a=r;Array.isArray(a)||(a=[a]);for(let o=0;o<e.inputs.length;o++)if(hK(e.inputs[o].names,a)){if(e.inputs[o].buffer===n)return;e.inputs[o].buffer=n;return}e.inputs.push({buffer:n,stepMode:i,names:a}),e.inputs=e.inputs.sort((o,s)=>o.names[0]<s.names[0]?-1:o.names[0]>s.names[0]?1:0)},t.removeBufferIfPresent=n=>{for(let r=0;r<e.inputs.length;r++)e.inputs[r].names.includes(n)&&e.inputs.splice(r,1)},t.getBuffer=n=>{for(let r=0;r<e.inputs.length;r++)if(e.inputs[r].names.includes(n))return e.inputs[r].buffer;return null},t.hasAttribute=n=>{for(let r=0;r<e.inputs.length;r++)if(e.inputs[r].names.includes(n))return!0;return!1},t.getAttributeTime=n=>{for(let r=0;r<e.inputs.length;r++)if(e.inputs[r].names.includes(n))return e.inputs[r].buffer.getSourceTime();return 0},t.getShaderCode=()=>{let n="",r=0;for(let i=0;i<e.inputs.length;i++)for(let a=0;a<e.inputs[i].names.length;a++){const o=e.inputs[i].buffer.getArrayInformation()[a],s=Mr.getShaderTypeFromBufferFormat(o.format);r>0&&(n+=`,
`),n=`${n}  @location(${r}) ${e.inputs[i].names[a]} : ${s}`,r++}return n},t.getVertexInputInformation=()=>{const n={};if(e.inputs.length){const r=[];let i=0;for(let a=0;a<e.inputs.length;a++){const o=e.inputs[a].buffer,s={arrayStride:o.getStrideInBytes(),stepMode:e.inputs[a].stepMode,attributes:[]},c=o.getArrayInformation();for(let l=0;l<e.inputs[a].names.length;l++)s.attributes.push({shaderLocation:i,offset:c[l].offset,format:c[l].format}),i++;r.push(s)}n.buffers=r}return n},t.bindBuffers=n=>{for(let r=0;r<e.inputs.length;r++)n.setVertexBuffer(r,e.inputs[r].buffer.getHandle());e.indexBuffer&&n.setIndexBuffer(e.indexBuffer.getHandle(),e.indexBuffer.getArrayInformation()[0].format)},t.getReady=()=>{},t.releaseGraphicsResources=()=>{e.created&&(e.inputs=[],e.bindingDescriptions=[],e.attributeDescriptions=[])}}const vK={inputs:null,bindingDescriptions:!1,attributeDescriptions:null,indexBuffer:null};function sR(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,vK,n),zt(t,e),e.bindingDescriptions=[],e.attributeDescriptions=[],e.inputs=[],Vn(t,e,["created","device","handle","indexBuffer"]),mK(t,e)}const yK=Rt(sR,"vtkWebGPUVertexInput");var TK={newInstance:yK,extend:sR};const CK=`
//VTK::Renderer::Dec

//VTK::Color::Dec

//VTK::Normal::Dec

//VTK::TCoord::Dec

//VTK::Select::Dec

//VTK::Mapper::Dec

//VTK::IOStructs::Dec

@vertex
fn main(
//VTK::IOStructs::Input
)
//VTK::IOStructs::Output
{
  var output : vertexOutput;

  // var vertex: vec4<f32> = vertexBC;

  //VTK::Color::Impl

  //VTK::Normal::Impl

  //VTK::TCoord::Impl

  //VTK::Select::Impl

  //VTK::Position::Impl

  return output;
}
`,wK=`
//VTK::Renderer::Dec

//VTK::Color::Dec

//VTK::Normal::Dec

//VTK::TCoord::Dec

//VTK::Select::Dec

//VTK::RenderEncoder::Dec

//VTK::Mapper::Dec

//VTK::IOStructs::Dec

@fragment
fn main(
//VTK::IOStructs::Input
)
//VTK::IOStructs::Output
{
  var output : fragmentOutput;

  //VTK::Color::Impl

  //VTK::Normal::Impl

  //VTK::Light::Impl

  //VTK::TCoord::Impl

  //VTK::Select::Impl

  // var computedColor:vec4<f32> = vec4<f32>(1.0,0.5,0.5,1.0);

  //VTK::RenderEncoder::Impl
  return output;
}
`;function xK(t,e){e.classHierarchy.push("vtkWebGPUSimpleMapper"),t.generateShaderDescriptions=(n,r,i)=>{const a=e7.newInstance({type:"vertex",hash:n,code:e.vertexShaderTemplate}),o=e7.newInstance({type:"fragment",hash:n,code:e.fragmentShaderTemplate}),s=r.getShaderDescriptions();s.push(a),s.push(o);const c=e.vertexShaderTemplate+e.fragmentShaderTemplate,l=new RegExp("//VTK::[^:]*::","g"),u=c.match(l).filter((g,d,h)=>h.indexOf(g)===d).map(g=>`replaceShader${g.substring(7,g.length-2)}`);for(let g=0;g<u.length;g++){const d=u[g];d!=="replaceShaderIOStructs"&&e.shaderReplacements.has(d)&&e.shaderReplacements.get(d)(n,r,i)}t.replaceShaderIOStructs(n,r,i)},t.replaceShaderIOStructs=(n,r,i)=>{const a=r.getShaderDescription("vertex");a.replaceShaderCode(null,i),r.getShaderDescription("fragment").replaceShaderCode(a)},t.replaceShaderRenderEncoder=(n,r,i)=>{e.renderEncoder.replaceShaderCode(r)},e.shaderReplacements.set("replaceShaderRenderEncoder",t.replaceShaderRenderEncoder),t.replaceShaderRenderer=(n,r,i)=>{if(!e.WebGPURenderer)return;const a=e.WebGPURenderer.getBindGroup().getShaderCode(r),o=r.getShaderDescription("vertex");let s=o.getCode();s=Ut.substitute(s,"//VTK::Renderer::Dec",[a]).result,o.setCode(s);const c=r.getShaderDescription("fragment");s=c.getCode(),s=Ut.substitute(s,"//VTK::Renderer::Dec",[a]).result,c.setCode(s)},e.shaderReplacements.set("replaceShaderRenderer",t.replaceShaderRenderer),t.replaceShaderMapper=(n,r,i)=>{const a=e.bindGroup.getShaderCode(r),o=r.getShaderDescription("vertex");let s=o.getCode();s=Ut.substitute(s,"//VTK::Mapper::Dec",[a]).result,o.setCode(s);const c=r.getShaderDescription("fragment");c.addBuiltinInput("bool","@builtin(front_facing) frontFacing"),s=c.getCode(),s=Ut.substitute(s,"//VTK::Mapper::Dec",[a]).result,c.setCode(s)},e.shaderReplacements.set("replaceShaderMapper",t.replaceShaderMapper),t.replaceShaderPosition=(n,r,i)=>{const a=r.getShaderDescription("vertex");a.addBuiltinOutput("vec4<f32>","@builtin(position) Position");let o=a.getCode();o=Ut.substitute(o,"//VTK::Position::Impl",["    output.Position = rendererUBO.SCPCMatrix*vertexBC;"]).result,a.setCode(o)},e.shaderReplacements.set("replaceShaderPosition",t.replaceShaderPosition),t.replaceShaderTCoord=(n,r,i)=>{r.getShaderDescription("vertex").addOutput("vec2<f32>","tcoordVS")},e.shaderReplacements.set("replaceShaderTCoord",t.replaceShaderTCoord),t.addTextureView=n=>{e.textureViews.includes(n)||e.textureViews.push(n)},t.prepareToDraw=n=>{e.renderEncoder=n,t.updateInput(),t.updateBuffers(),t.updateBindings(),t.updatePipeline()},t.updateInput=()=>{},t.updateBuffers=()=>{},t.updateBindings=()=>{e.bindGroup.setBindables(t.getBindables())},t.computePipelineHash=()=>{},t.registerDrawCallback=n=>{n.registerDrawCallback(e.pipeline,t.draw)},t.prepareAndDraw=n=>{t.prepareToDraw(n),n.setPipeline(e.pipeline),t.draw(n)},t.draw=n=>{const r=n.getBoundPipeline();n.activateBindGroup(e.bindGroup),e.WebGPURenderer&&e.WebGPURenderer.bindUBO(n),r.bindVertexInput(n,e.vertexInput);const i=e.vertexInput.getIndexBuffer();i?n.drawIndexed(i.getIndexCount(),e.numberOfInstances,0,0,0):n.draw(e.numberOfVertices,e.numberOfInstances,0,0)},t.getBindables=()=>{const n=[...e.additionalBindables];e.UBO&&n.push(e.UBO),e.SSBO&&n.push(e.SSBO);for(let r=0;r<e.textureViews.length;r++){n.push(e.textureViews[r]);const i=e.textureViews[r].getSampler();i&&n.push(i)}return n},t.updatePipeline=()=>{t.computePipelineHash(),e.pipeline=e.device.getPipeline(e.pipelineHash),e.pipeline||(e.pipeline=iK.newInstance(),e.pipeline.setDevice(e.device),e.WebGPURenderer&&e.pipeline.addBindGroupLayout(e.WebGPURenderer.getBindGroup()),e.pipeline.addBindGroupLayout(e.bindGroup),t.generateShaderDescriptions(e.pipelineHash,e.pipeline,e.vertexInput),e.pipeline.setTopology(e.topology),e.pipeline.setRenderEncoder(e.renderEncoder),e.pipeline.setVertexState(e.vertexInput.getVertexInputInformation()),e.device.createPipeline(e.pipelineHash,e.pipeline))}}const SK={additionalBindables:void 0,bindGroup:null,device:null,fragmentShaderTemplate:null,numberOfInstances:1,numberOfVertices:0,pipelineHash:null,shaderReplacements:null,SSBO:null,textureViews:null,topology:"triangle-list",UBO:null,vertexShaderTemplate:null,WebGPURenderer:null};function cR(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,SK,n),Bt.extend(t,e,n),e.textureViews=[],e.vertexInput=TK.newInstance(),e.bindGroup=nR.newInstance({label:"mapperBG"}),e.additionalBindables=[],e.fragmentShaderTemplate=e.fragmentShaderTemplate||wK,e.vertexShaderTemplate=e.vertexShaderTemplate||CK,e.shaderReplacements=new Map,P.get(t,e,["pipeline","vertexInput"]),P.setGet(t,e,["additionalBindables","device","fragmentShaderTemplate","interpolate","numberOfInstances","numberOfVertices","pipelineHash","shaderReplacements","SSBO","textureViews","topology","UBO","vertexShaderTemplate","WebGPURenderer"]),xK(t,e)}const EK=P.newInstance(cR,"vtkWebGPUSimpleMapper");var lR={newInstance:EK,extend:cR};function OK(t,e){e.classHierarchy.push("vtkWebGPUFullScreenQuad"),t.replaceShaderPosition=(n,r,i)=>{const a=r.getShaderDescription("vertex");a.addBuiltinOutput("vec4<f32>","@builtin(position) Position"),a.addOutput("vec4<f32>","vertexVC");let o=a.getCode();o=Ut.substitute(o,"//VTK::Position::Impl",["output.tcoordVS = vec2<f32>(vertexBC.x * 0.5 + 0.5, 1.0 - vertexBC.y * 0.5 - 0.5);","output.Position = vec4<f32>(vertexBC, 1.0);","output.vertexVC = vec4<f32>(vertexBC, 1);"]).result,a.setCode(o)},e.shaderReplacements.set("replaceShaderPosition",t.replaceShaderPosition),t.updateBuffers=()=>{const n=e.device.getBufferManager().getFullScreenQuadBuffer();e.vertexInput.addBuffer(n,["vertexBC"]),e.numberOfVertices=6}}const DK={};function uR(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,DK,n),lR.extend(t,e,n),OK(t,e)}const RK=P.newInstance(uR,"vtkWebGPUFullScreenQuad");var z3={newInstance:RK,extend:uR};const MK={Verts:0,Lines:1,Triangles:2,Strips:3,LinesFromStrips:4,LinesFromTriangles:5,Points:6,UniformArray:7,PointArray:8,NormalsFromPoints:9,Texture:10,RawVertex:11,Storage:12,Index:13},_K={Start:0,Points:0,Lines:1,Triangles:2,TriangleStrips:3,TriangleEdges:4,TriangleStripEdges:5,End:6};var Cd={BufferUsage:MK,PrimitiveTypes:_K};const B5=["getMappedRange","mapAsync","unmap"];function bK(t,e,n,r){const i=r.byteLength,a=t.createBuffer({size:i,usage:GPUBufferUsage.COPY_SRC,mappedAtCreation:!0}),o=a.getMappedRange(0,i);new Uint8Array(o).set(new Uint8Array(r)),a.unmap();const s=t.createCommandEncoder();s.copyBufferToBuffer(a,0,e,n,i);const c=s.finish();t.queue.submit([c]),a.destroy()}function LK(t,e){e.classHierarchy.push("vtkWebGPUBuffer"),t.create=(n,r)=>{e.handle=e.device.getHandle().createBuffer({size:n,usage:r,label:e.label}),e.sizeInBytes=n,e.usage=r},t.write=n=>{bK(e.device.getHandle(),e.handle,0,n.buffer)},t.createAndWrite=(n,r)=>{e.handle=e.device.getHandle().createBuffer({size:n.byteLength,usage:r,mappedAtCreation:!0,label:e.label}),e.sizeInBytes=n.byteLength,e.usage=r,new Uint8Array(e.handle.getMappedRange()).set(new Uint8Array(n.buffer)),e.handle.unmap()};for(let n=0;n<B5.length;n++)t[B5[n]]=function(){return e.handle[B5[n]](...arguments)}}const IK={device:null,handle:null,sizeInBytes:0,strideInBytes:0,arrayInformation:null,usage:null,label:null,sourceTime:null};function fR(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,IK,n),P.obj(t,e),P.get(t,e,["handle","sizeInBytes","usage"]),P.setGet(t,e,["strideInBytes","device","arrayInformation","label","sourceTime"]),LK(t,e)}const VK=P.newInstance(fR);var j3={newInstance:VK,extend:fR,...Cd};const{Representation:n7}=Yu,{PrimitiveTypes:Zs}=Cd;class PK{constructor(){this.keys=new Uint32Array(10),this.values=new Uint32Array(10),this.count=0}clear(){this.count=0}has(e){for(let n=0;n<this.count;n++)if(this.keys[n]===e)return!0}get(e){for(let n=0;n<this.count;n++)if(this.keys[n]===e)return this.values[n]}set(e,n){this.count<9&&(this.keys[this.count]=e,this.values[this.count++]=n)}}function NK(t){switch(t){case Zs.Points:return"points";case Zs.Lines:return"lines";case Zs.Triangles:case Zs.TriangleEdges:return"polys";case Zs.TriangleStripEdges:case Zs.TriangleStrips:return"strips";default:return""}}function g1(t,e,n){let r=t.pointIdToFlatId[e];return r<0&&(r=t.flatId,t.pointIdToFlatId[e]=r,t.flatIdToPointId[t.flatId]=e,t.flatIdToCellId[t.flatId]=n,t.flatId++),r}function kK(t,e,n){const r=t.length;for(let o=0;o<r;o++){let s=t[o];if(n.cellProvokedMap.has(s)){n.ibo[n.iboId++]=n.cellProvokedMap.get(s);for(let c=o+1;c<o+r;c++){s=t[c%r];const l=g1(n,s,e);n.ibo[n.iboId++]=l}return}}for(let o=0;o<r;o++){let s=t[o];if(!n.provokedPointIds[s]){let c=g1(n,s,e);n.provokedPointIds[s]=1,n.cellProvokedMap.set(s,c),n.flatIdToCellId[c]=e,n.ibo[n.iboId++]=c;for(let l=o+1;l<o+r;l++)s=t[l%r],c=g1(n,s,e),n.ibo[n.iboId++]=c;return}}let i=t[0],a=n.flatId;n.cellProvokedMap.set(i,a),n.flatIdToPointId[n.flatId]=i,n.flatIdToCellId[n.flatId]=e,n.flatId++,n.ibo[n.iboId++]=a;for(let o=1;o<r;o++)i=t[o],a=g1(n,i,e),n.ibo[n.iboId++]=a}function AK(t,e,n){const r=t.length;n.iboSize+=r;for(let i=0;i<r;i++){const a=t[i];if(n.cellProvokedMap.has(a))return}for(let i=0;i<r;i++){const a=t[i];if(!n.provokedPointIds[a]){n.provokedPointIds[a]=1,n.cellProvokedMap.set(a,1);return}}n.cellProvokedMap.set(t[0],1),n.extraPoints++}let Ko;const r7=new Uint32Array(1),ia=new Uint32Array(2),Ws=new Uint32Array(3),G5={anythingToPoints(t,e,n,r,i){for(let a=0;a<t;++a)r7[0]=e[n+a],Ko(r7,r,i)},linesToWireframe(t,e,n,r,i){for(let a=0;a<t-1;++a)ia[0]=e[n+a],ia[1]=e[n+a+1],Ko(ia,r,i)},polysToWireframe(t,e,n,r,i){if(t>2)for(let a=0;a<t;++a)ia[0]=e[n+a],ia[1]=e[n+(a+1)%t],Ko(ia,r,i)},stripsToWireframe(t,e,n,r,i){if(t>2){for(let a=0;a<t-1;++a)ia[0]=e[n+a],ia[1]=e[n+a+1],Ko(ia,r,i);for(let a=0;a<t-2;a++)ia[0]=e[n+a],ia[1]=e[n+a+2],Ko(ia,r,i)}},polysToSurface(t,e,n,r,i){for(let a=0;a<t-2;a++)Ws[0]=e[n],Ws[1]=e[n+a+1],Ws[2]=e[n+a+2],Ko(Ws,r,i)},stripsToSurface(t,e,n,r,i){for(let a=0;a<t-2;a++)Ws[0]=e[n+a],Ws[1]=e[n+a+1+a%2],Ws[2]=e[n+a+1+(a+1)%2],Ko(Ws,r,i)}};function FK(t,e){e.classHierarchy.push("vtkWebGPUIndexBuffer"),t.buildIndexBuffer=n=>{const r=n.cells,i=n.primitiveType,a=n.representation,o=n.cellOffset,s=r.getData(),c=s.length,l=NK(i),f=n.numberOfPoints,u={provokedPointIds:new Uint8Array(f),extraPoints:0,iboSize:0,flatId:0,iboId:0,cellProvokedMap:new PK};let g=null;a===n7.POINTS||i===Zs.Points?g=G5.anythingToPoints:a===n7.WIREFRAME||i===Zs.Lines?g=G5[`${l}ToWireframe`]:g=G5[`${l}ToSurface`],Ko=AK;let d=o||0;for(let h=0;h<c;)u.cellProvokedMap.clear(),g(s[h],s,h+1,d,u),h+=s[h]+1,d++;f<=65535?u.flatIdToPointId=new Uint16Array(f+u.extraPoints):u.flatIdToPointId=new Uint32Array(f+u.extraPoints),f+u.extraPoints<36863?u.pointIdToFlatId=new Int16Array(f):u.pointIdToFlatId=new Int32Array(f),f+u.extraPoints<=65535?(u.ibo=new Uint16Array(u.iboSize),n.format="uint16"):(u.ibo=new Uint32Array(u.iboSize),n.format="uint32"),d<=65535?u.flatIdToCellId=new Uint16Array(f+u.extraPoints):u.flatIdToCellId=new Uint32Array(f+u.extraPoints),u.pointIdToFlatId.fill(-1),u.provokedPointIds.fill(0),Ko=kK,d=o||0;for(let h=0;h<c;)u.cellProvokedMap.clear(),g(s[h],s,h+1,d,u),h+=s[h]+1,d++;delete u.provokedPointIds,delete u.pointIdToFlatId,n.nativeArray=u.ibo,e.flatIdToPointId=u.flatIdToPointId,e.flatIdToCellId=u.flatIdToCellId,e.flatSize=u.flatId,e.indexCount=u.iboId}}const UK={flatIdToPointId:null,flatIdToCellId:null,flatSize:0,indexCount:0};function gR(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,UK,n),j3.extend(t,e,n),P.setGet(t,e,["flatIdToPointId","flatIdToCellId","flatSize","indexCount"]),FK(t,e)}const BK=P.newInstance(gR);var GK={newInstance:BK,extend:gR,...Cd};const{BufferUsage:zs}=Cd,{vtkErrorMacro:$K}=Ir,{VtkDataTypes:d0}=nt,WK={};function zK(t){let e;switch(t.getDataType()){case d0.UNSIGNED_CHAR:e="uint8";break;case d0.FLOAT:e="float32";break;case d0.UNSIGNED_INT:e="uint32";break;case d0.INT:e="sint32";break;case d0.DOUBLE:e="float32";break;case d0.UNSIGNED_SHORT:e="uint16";break;case d0.SHORT:e="sin16";break;default:e="float32";break}switch(t.getNumberOfComponents()){case 2:e+="x2";break;case 3:e.includes("32")||$K(`unsupported x3 type for ${e}`),e+="x3";break;case 4:e+="x4";break}return e}function i7(t,e,n,r,i){const a={},o=t.getFlatSize();if(!o)return a;let s=[0,0,0,0];i.shift&&(i.shift.length?s=i.shift:s.fill(i.shift));let c=[1,1,1,1];i.scale&&(i.scale.length?c=i.scale:c.fill(i.scale));const l=Object.prototype.hasOwnProperty.call(i,"packExtra")?i.packExtra:!1;let f,u=0;const g=n+(l?1:0),d=Ku(r,o*g);let h=t.getFlatIdToPointId();i.cellData&&(h=t.getFlatIdToCellId()),n===1?f=function(m){d[u++]=c[0]*e[m]+s[0]}:n===2?f=function(m){d[u++]=c[0]*e[m]+s[0],d[u++]=c[1]*e[m+1]+s[1]}:n===3&&!l?f=function(m){d[u++]=c[0]*e[m]+s[0],d[u++]=c[1]*e[m+1]+s[1],d[u++]=c[2]*e[m+2]+s[2]}:n===3&&l?f=function(m){d[u++]=c[0]*e[m]+s[0],d[u++]=c[1]*e[m+1]+s[1],d[u++]=c[2]*e[m+2]+s[2],d[u++]=c[3]*1+s[3]}:n===4&&(f=function(m){d[u++]=c[0]*e[m]+s[0],d[u++]=c[1]*e[m+1]+s[1],d[u++]=c[2]*e[m+2]+s[2],d[u++]=c[3]*e[m+3]+s[3]});for(let p=0;p<o;p++){const m=n*h[p];f(m)}return a.nativeArray=d,a}function jK(t,e,n,r){const i=[t[r*3]-t[n*3],t[r*3+1]-t[n*3+1],t[r*3+2]-t[n*3+2]],a=[t[e*3]-t[n*3],t[e*3+1]-t[n*3+1],t[e*3+2]-t[n*3+2]],o=[];return yo(i,a,o),Z0(o),o}function HK(t,e){const n=e.getData(),r=t.getData();if(!r||!n)return null;const i=new Int8Array(t.getNumberOfCells()*4),a=r.length;let o=0;for(let s=0;s<a;){const c=jK(n,r[s+1],r[s+2],r[s+3]);i[o++]=127*c[0],i[o++]=127*c[1],i[o++]=127*c[2],i[o++]=127,s+=r[s]+1}return i}function KK(t,e){e.classHierarchy.push("vtkWebGPUBufferManager");function n(r){r.dataArray&&!r.nativeArray&&(r.nativeArray=r.dataArray.getData());let i,a;if(r.usage===zs.Index&&(i=GK.newInstance({label:r.label}),i.setDevice(e.device),a=GPUBufferUsage.INDEX|GPUBufferUsage.COPY_DST,i.buildIndexBuffer(r),i.createAndWrite(r.nativeArray,a),i.setArrayInformation([{format:r.format}])),i||(i=j3.newInstance({label:r.label}),i.setDevice(e.device)),r.usage===zs.UniformArray&&(a=GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST,i.createAndWrite(r.nativeArray,a)),r.usage===zs.Storage&&(a=GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_DST,i.createAndWrite(r.nativeArray,a)),r.usage===zs.Texture&&(a=GPUBufferUsage.COPY_SRC,i.createAndWrite(r.nativeArray,a)),r.usage===zs.PointArray){a=GPUBufferUsage.VERTEX;const o=Mr.getNativeTypeFromBufferFormat(r.format),s=i7(r.indexBuffer,r.dataArray.getData(),r.dataArray.getNumberOfComponents(),o,{packExtra:r.packExtra,shift:r.shift,scale:r.scale,cellData:r.cellData,cellOffset:r.cellOffset});i.createAndWrite(s.nativeArray,a),i.setStrideInBytes(Mr.getByteStrideFromBufferFormat(r.format)),i.setArrayInformation([{offset:0,format:r.format,interpolation:r.cellData?"flat":"perspective"}])}if(r.usage===zs.NormalsFromPoints){a=GPUBufferUsage.VERTEX;const o=Mr.getNativeTypeFromBufferFormat(r.format),s=HK(r.cells,r.dataArray),c=i7(r.indexBuffer,s,4,o,{cellData:!0});i.createAndWrite(c.nativeArray,a),i.setStrideInBytes(Mr.getByteStrideFromBufferFormat(r.format)),i.setArrayInformation([{offset:0,format:r.format,interpolation:"flat"}])}return r.usage===zs.RawVertex&&(a=GPUBufferUsage.VERTEX,i.createAndWrite(r.nativeArray,a),i.setStrideInBytes(Mr.getByteStrideFromBufferFormat(r.format)),i.setArrayInformation([{offset:0,format:r.format}])),i.setSourceTime(r.time),i}t.hasBuffer=r=>e.device.hasCachedObject(r),t.getBuffer=r=>r.hash?e.device.getCachedObject(r.hash,n,r):n(r),t.getBufferForPointArray=(r,i)=>{const a=zK(r),o={hash:`${r.getMTime()}I${i.getMTime()}${a}`,usage:zs.PointArray,format:a,dataArray:r,indexBuffer:i};return t.getBuffer(o)},t.getFullScreenQuadBuffer=()=>{if(e.fullScreenQuadBuffer)return e.fullScreenQuadBuffer;e.fullScreenQuadBuffer=j3.newInstance(),e.fullScreenQuadBuffer.setDevice(e.device);const r=new Float32Array([-1,-1,0,1,-1,0,1,1,0,-1,-1,0,1,1,0,-1,1,0]);return e.fullScreenQuadBuffer.createAndWrite(r,GPUBufferUsage.VERTEX),e.fullScreenQuadBuffer.setStrideInBytes(12),e.fullScreenQuadBuffer.setArrayInformation([{offset:0,format:"float32x3"}]),e.fullScreenQuadBuffer}}const qK={device:null,fullScreenQuadBuffer:null};function XK(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,qK,n),zt(t,e),Vn(t,e,["device"]),KK(t,e)}Rt(XK);var Ju={...WK,...Cd};const{BufferUsage:YK}=Ju,{vtkErrorMacro:Sl}=P;function ZK(t,e){e.classHierarchy.push("vtkWebGPUStorageBuffer"),t.addEntry=(n,r)=>{if(e._bufferEntryNames.has(n)){Sl(`entry named ${n} already exists`);return}e._bufferEntryNames.set(n,e.bufferEntries.length);const i=Mr.getByteStrideFromShaderFormat(r);e.bufferEntries.push({name:n,type:r,sizeInBytes:i,offset:e.sizeInBytes,nativeType:Mr.getNativeTypeFromShaderFormat(r)}),e.sizeInBytes+=i},t.send=n=>{if(!e._buffer){const r={nativeArray:e.Float32Array,usage:YK.Storage,label:e.label};e._buffer=n.getBufferManager().getBuffer(r),e.bindGroupTime.modified(),e._sendTime.modified();return}n.getHandle().queue.writeBuffer(e._buffer.getHandle(),0,e.arrayBuffer,0,e.sizeInBytes*e.numberOfInstances),e._sendTime.modified()},t.createView=n=>{n in e||(e.arrayBuffer||(e.arrayBuffer=new ArrayBuffer(e.sizeInBytes*e.numberOfInstances)),e[n]=P.newTypedArray(n,e.arrayBuffer))},t.setValue=(n,r,i)=>{const a=e._bufferEntryNames.get(n);if(a===void 0){Sl(`entry named ${n} not found in UBO`);return}const o=e.bufferEntries[a];t.createView(o.nativeType);const s=e[o.nativeType];s[(o.offset+r*e.sizeInBytes)/s.BYTES_PER_ELEMENT]=i},t.setArray=(n,r,i)=>{const a=e._bufferEntryNames.get(n);if(a===void 0){Sl(`entry named ${n} not found in UBO`);return}const o=e.bufferEntries[a];t.createView(o.nativeType);const s=e[o.nativeType],c=(o.offset+r*e.sizeInBytes)/s.BYTES_PER_ELEMENT;for(let l=0;l<i.length;l++)s[c+l]=i[l]},t.setAllInstancesFromArray=(n,r)=>{const i=e._bufferEntryNames.get(n);if(i===void 0){Sl(`entry named ${n} not found in UBO`);return}const a=e.bufferEntries[i];t.createView(a.nativeType);const o=e[a.nativeType],s=r.length/e.numberOfInstances;for(let c=0;c<e.numberOfInstances;c++){const l=(a.offset+c*e.sizeInBytes)/o.BYTES_PER_ELEMENT;for(let f=0;f<s;f++)o[l+f]=r[c*s+f]}},t.setAllInstancesFromArrayColorToFloat=(n,r)=>{const i=e._bufferEntryNames.get(n);if(i===void 0){Sl(`entry named ${n} not found in UBO`);return}const a=e.bufferEntries[i];t.createView(a.nativeType);const o=e[a.nativeType],s=r.length/e.numberOfInstances;for(let c=0;c<e.numberOfInstances;c++){const l=(a.offset+c*e.sizeInBytes)/o.BYTES_PER_ELEMENT;for(let f=0;f<s;f++)o[l+f]=r[c*s+f]/255}},t.setAllInstancesFromArray3x3To4x4=(n,r)=>{const i=e._bufferEntryNames.get(n);if(i===void 0){Sl(`entry named ${n} not found in UBO`);return}const a=e.bufferEntries[i];t.createView(a.nativeType);const o=e[a.nativeType],s=9;for(let c=0;c<e.numberOfInstances;c++){const l=(a.offset+c*e.sizeInBytes)/o.BYTES_PER_ELEMENT;for(let f=0;f<3;f++)for(let u=0;u<3;u++)o[l+f*4+u]=r[c*s+f*3+u]}},t.getSendTime=()=>e._sendTime.getMTime(),t.getShaderCode=(n,r)=>{const i=[`struct ${e.label}StructEntry
{`];for(let a=0;a<e.bufferEntries.length;a++){const o=e.bufferEntries[a];i.push(`  ${o.name}: ${o.type},`)}return i.push(`
};
struct ${e.label}Struct
{
  values: array<${e.label}StructEntry>,
};
@binding(${n}) @group(${r}) var<storage, read> ${e.label}: ${e.label}Struct;
`),i.join(`
`)},t.getBindGroupEntry=()=>({resource:{buffer:e._buffer.getHandle()}}),t.clearData=()=>{e.numberOfInstances=0,e.sizeInBytes=0,e.bufferEntries=[],e._bufferEntryNames=new Map,e._buffer=null,delete e.arrayBuffer,delete e.Float32Array}}const QK={bufferEntries:null,bufferEntryNames:null,sizeInBytes:0,label:null,numberOfInstances:1};function dR(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,QK,n),P.obj(t,e),e._bufferEntryNames=new Map,e.bufferEntries=[],e._sendTime={},P.obj(e._sendTime,{mtime:0}),e.bindGroupTime={},P.obj(e.bindGroupTime,{mtime:0}),e.bindGroupLayoutEntry=e.bindGroupLayoutEntry||{buffer:{type:"read-only-storage"}},P.get(t,e,["bindGroupTime"]),P.setGet(t,e,["device","bindGroupLayoutEntry","label","numberOfInstances","sizeInBytes"]),ZK(t,e)}const JK=P.newInstance(dR,"vtkWebGPUStorageBuffer");var eq={newInstance:JK,extend:dR};const{BufferUsage:tq}=Ju,{vtkErrorMacro:$5}=P;function nq(t,e){e.classHierarchy.push("vtkWebGPUUniformBuffer"),t.addEntry=(n,r)=>{if(e._bufferEntryNames.has(n)){$5(`entry named ${n} already exists`);return}e.sortDirty=!0,e._bufferEntryNames.set(n,e.bufferEntries.length),e.bufferEntries.push({name:n,type:r,sizeInBytes:Mr.getByteStrideFromShaderFormat(r),offset:-1,nativeType:Mr.getNativeTypeFromShaderFormat(r),packed:!1})},t.sortBufferEntries=()=>{if(!e.sortDirty)return;let n=0;const r=[];let i=4;for(let a=0;a<e.bufferEntries.length;a++){const o=e.bufferEntries[a];o.sizeInBytes%16===0&&(i=Math.max(16,i)),o.sizeInBytes%8===0&&(i=Math.max(8,i))}for(let a=0;a<e.bufferEntries.length;a++){const o=e.bufferEntries[a];o.packed===!1&&o.sizeInBytes%16===0&&(o.packed=!0,o.offset=n,r.push(o),n+=o.sizeInBytes)}for(let a=0;a<e.bufferEntries.length;a++){const o=e.bufferEntries[a];if(o.packed===!1&&o.sizeInBytes===12)for(let s=0;s<e.bufferEntries.length;s++){const c=e.bufferEntries[s];if(c.packed===!1&&c.sizeInBytes===4){o.packed=!0,o.offset=n,r.push(o),n+=o.sizeInBytes,c.packed=!0,c.offset=n,r.push(c),n+=c.sizeInBytes;break}}}for(let a=0;a<e.bufferEntries.length;a++){const o=e.bufferEntries[a];if(!o.packed&&o.sizeInBytes%8===0)for(let s=a+1;s<e.bufferEntries.length;s++){const c=e.bufferEntries[s];if(!c.packed&&c.sizeInBytes%8===0){o.packed=!0,o.offset=n,r.push(o),n+=o.sizeInBytes,c.packed=!0,c.offset=n,r.push(c),n+=c.sizeInBytes;break}}}for(let a=0;a<e.bufferEntries.length;a++){const o=e.bufferEntries[a];if(!o.packed&&o.sizeInBytes%8===0){let s=!1;for(let c=0;!s&&c<e.bufferEntries.length;c++){const l=e.bufferEntries[c];if(!l.packed&&l.sizeInBytes===4)for(let f=c+1;f<e.bufferEntries.length;f++){const u=e.bufferEntries[f];if(!u.packed&&u.sizeInBytes===4){o.packed=!0,o.offset=n,r.push(o),n+=o.sizeInBytes,l.packed=!0,l.offset=n,r.push(l),n+=l.sizeInBytes,u.packed=!0,u.offset=n,r.push(u),n+=u.sizeInBytes,s=!0;break}}}}}for(let a=0;a<e.bufferEntries.length;a++){const o=e.bufferEntries[a];!o.packed&&o.sizeInBytes>4&&(o.packed=!0,o.offset=n,r.push(o),n+=o.sizeInBytes)}for(let a=0;a<e.bufferEntries.length;a++){const o=e.bufferEntries[a];o.packed||(o.packed=!0,o.offset=n,r.push(o),n+=o.sizeInBytes)}e.bufferEntries=r,e._bufferEntryNames.clear();for(let a=0;a<e.bufferEntries.length;a++)e._bufferEntryNames.set(e.bufferEntries[a].name,a);e.sizeInBytes=n,e.sizeInBytes=i*Math.ceil(e.sizeInBytes/i),e.sortDirty=!1},t.sendIfNeeded=n=>{if(!e.UBO){const r={nativeArray:e.Float32Array,usage:tq.UniformArray,label:e.label};e.UBO=n.getBufferManager().getBuffer(r),e.bindGroupTime.modified(),e.sendDirty=!1}e.sendDirty&&(n.getHandle().queue.writeBuffer(e.UBO.getHandle(),0,e.arrayBuffer,0,e.sizeInBytes),e.sendDirty=!1),e.sendTime.modified()},t.createView=n=>{n in e||(e.arrayBuffer||(e.arrayBuffer=new ArrayBuffer(e.sizeInBytes)),e[n]=P.newTypedArray(n,e.arrayBuffer))},t.setValue=(n,r)=>{t.sortBufferEntries();const i=e._bufferEntryNames.get(n);if(i===void 0){$5(`entry named ${n} not found in UBO`);return}const a=e.bufferEntries[i];t.createView(a.nativeType);const o=e[a.nativeType];a.lastValue!==r&&(o[a.offset/o.BYTES_PER_ELEMENT]=r,e.sendDirty=!0),a.lastValue=r},t.setArray=(n,r)=>{t.sortBufferEntries();const i=e._bufferEntryNames.get(n);if(i===void 0){$5(`entry named ${n} not found in UBO`);return}const a=e.bufferEntries[i];t.createView(a.nativeType);const o=e[a.nativeType];let s=!1;for(let c=0;c<r.length;c++)(!a.lastValue||a.lastValue[c]!==r[c])&&(o[a.offset/o.BYTES_PER_ELEMENT+c]=r[c],s=!0);s&&(e.sendDirty=!0,a.lastValue=[...r])},t.getBindGroupEntry=()=>({resource:{buffer:e.UBO.getHandle()}}),t.getSendTime=()=>e.sendTime.getMTime(),t.getShaderCode=(n,r)=>{t.sortBufferEntries();const i=[`struct ${e.label}Struct
{`];for(let a=0;a<e.bufferEntries.length;a++){const o=e.bufferEntries[a];i.push(`  ${o.name}: ${o.type},`)}return i.push(`};
@binding(${n}) @group(${r}) var<uniform> ${e.label}: ${e.label}Struct;`),i.join(`
`)}}const rq={bufferEntries:null,bufferEntryNames:null,sizeInBytes:0,label:null,bindGroupLayoutEntry:null,bindGroupEntry:null};function pR(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,rq,n),P.obj(t,e),e._bufferEntryNames=new Map,e.bufferEntries=[],e.bindGroupLayoutEntry=e.bindGroupLayoutEntry||{buffer:{type:"uniform"}},e.sendTime={},P.obj(e.sendTime,{mtime:0}),e.bindGroupTime={},P.obj(e.bindGroupTime,{mtime:0}),e.sendDirty=!0,e.sortDirty=!0,P.get(t,e,["binding","bindGroupTime"]),P.setGet(t,e,["bindGroupLayoutEntry","device","label","sizeInBytes"]),nq(t,e)}const iq=P.newInstance(pR,"vtkWebGPUUniformBuffer");var su={newInstance:iq,extend:pR};const{vtkDebugMacro:aq}=Ir,a7=`
//VTK::Renderer::Dec

//VTK::Mapper::Dec

//VTK::TCoord::Dec

//VTK::RenderEncoder::Dec

//VTK::IOStructs::Dec

@fragment
fn main(
//VTK::IOStructs::Input
)
//VTK::IOStructs::Output
{
  var output: fragmentOutput;

  var computedColor: vec4<f32> = mapperUBO.BackgroundColor;

  //VTK::RenderEncoder::Impl
  return output;
}
`,oq=`
fn vecToRectCoord(dir: vec3<f32>) -> vec2<f32> {
  var tau: f32 = 6.28318530718;
  var pi: f32 = 3.14159265359;
  var out: vec2<f32> = vec2<f32>(0.0);

  out.x = atan2(dir.z, dir.x) / tau;
  out.x += 0.5;

  var phix: f32 = length(vec2(dir.x, dir.z));
  out.y = atan2(dir.y, phix) / pi + 0.5;

  return out;
}

//VTK::Renderer::Dec

//VTK::Mapper::Dec

//VTK::TCoord::Dec

//VTK::RenderEncoder::Dec

//VTK::IOStructs::Dec

@fragment
fn main(
//VTK::IOStructs::Input
)
//VTK::IOStructs::Output
{
  var output: fragmentOutput;

  var tcoord: vec4<f32> = vec4<f32>(input.vertexVC.xy, -1, 1);
  var V: vec4<f32> = normalize(mapperUBO.FSQMatrix * tcoord); // vec2<f32>((input.tcoordVS.x - 0.5) * 2, -(input.tcoordVS.y - 0.5) * 2);
  // textureSampleLevel gets rid of some ugly artifacts
  var background = textureSampleLevel(EnvironmentTexture, EnvironmentTextureSampler, vecToRectCoord(V.xyz), 0.0);
  var computedColor: vec4<f32> = vec4<f32>(background.rgb, 1);

  //VTK::RenderEncoder::Impl
  return output;
}
`,d1=new Float64Array(16),o7=new Float64Array(16);function sq(t){return t.getPositional()?t.getConeAngle()>=90?0:2:1}function cq(t,e){e.classHierarchy.push("vtkWebGPURenderer"),t.buildPass=n=>{if(n){if(!e.renderable)return;e.camera=e.renderable.getActiveCamera(),t.updateLights(),t.prepareNodes(),t.addMissingNode(e.camera),t.addMissingNodes(e.renderable.getViewPropsWithNestedProps()),t.removeUnusedNodes(),e.webgpuCamera=t.getViewNodeFor(e.camera),t.updateStabilizedMatrix()}},t.updateStabilizedMatrix=()=>{const n=e.camera.getClippingRange(),r=e.camera.getPositionByReference(),i=e.camera.getDirectionOfProjectionByReference(),a=[],o=[];Br(o,i,.5*(n[0]+n[1])),da(a,r,o),_n(o,a,e.stabilizedCenter),oh(o)/(n[1]-n[0])>e.recenterThreshold&&(e.stabilizedCenter=a,e.stabilizedTime.modified())},t.updateLights=()=>{let n=0;const r=e.renderable.getLightsByReference();for(let i=0;i<r.length;++i)r[i].getSwitch()>0&&n++;return n||(aq("No lights are on, creating one."),e.renderable.createLight()),n},t.updateUBO=()=>{var r;const n=e.UBO.getSendTime();if(e._parent.getMTime()>n||t.getMTime()>n||e.camera.getMTime()>n||e.renderable.getMTime()>n){const i=e.webgpuCamera.getKeyMatrices(t);e.UBO.setArray("WCVCMatrix",i.wcvc),e.UBO.setArray("SCPCMatrix",i.scpc),e.UBO.setArray("PCSCMatrix",i.pcsc),e.UBO.setArray("SCVCMatrix",i.scvc),e.UBO.setArray("VCPCMatrix",i.vcpc),e.UBO.setArray("WCVCNormals",i.normalMatrix),e.UBO.setValue("LightCount",e.renderable.getLights().length),e.UBO.setValue("MaxEnvironmentMipLevel",(r=e.renderable.getEnvironmentTexture())==null?void 0:r.getMipLevel()),e.UBO.setValue("BackgroundDiffuseStrength",e.renderable.getEnvironmentTextureDiffuseStrength()),e.UBO.setValue("BackgroundSpecularStrength",e.renderable.getEnvironmentTextureSpecularStrength());const a=t.getYInvertedTiledSizeAndOrigin();e.UBO.setArray("viewportSize",[a.usize,a.vsize]),e.UBO.setValue("cameraParallel",e.camera.getParallelProjection());const o=e._parent.getDevice();e.UBO.sendIfNeeded(o)}},t.updateSSBO=()=>{const n=e.renderable.getLights(),r=e.webgpuCamera.getKeyMatrices(t);let i=`${e.renderable.getMTime()}`;for(let a=0;a<n.length;a++)i+=n[a].getMTime();if(i!==e.lightTimeString){const a=new Float32Array(n.length*4),o=new Float32Array(n.length*4),s=new Float32Array(n.length*4),c=new Float32Array(n.length*4);for(let f=0;f<n.length;f++){const u=f*4,g=n[f].getPosition();pt(g,g,r.wcvc),a[u]=g[0],a[u+1]=g[1],a[u+2]=g[2],a[u+3]=0,o[u]=-n[f].getDirection()[0],o[u+1]=-n[f].getDirection()[1],o[u+2]=-n[f].getDirection()[2],o[u+3]=0,s[u]=n[f].getColor()[0],s[u+1]=n[f].getColor()[1],s[u+2]=n[f].getColor()[2],s[u+3]=n[f].getIntensity()*5,c[u]=sq(n[f]),c[u+1]=Math.cos(hn(n[f].getConeAngle())),c[u+2]=Math.cos(hn(n[f].getConeAngle()+n[f].getConeFalloff())),c[u+3]=0}e.SSBO.clearData(),e.SSBO.setNumberOfInstances(n.length),e.SSBO.addEntry("LightPos","vec4<f32>"),e.SSBO.addEntry("LightDir","vec4<f32>"),e.SSBO.addEntry("LightColor","vec4<f32>"),e.SSBO.addEntry("LightData","vec4<f32>"),e.SSBO.setAllInstancesFromArray("LightPos",a),e.SSBO.setAllInstancesFromArray("LightDir",o),e.SSBO.setAllInstancesFromArray("LightColor",s),e.SSBO.setAllInstancesFromArray("LightData",c);const l=e._parent.getDevice();e.SSBO.send(l)}e.lightTimeString=i},t.scissorAndViewport=n=>{const r=t.getYInvertedTiledSizeAndOrigin();n.getHandle().setViewport(r.lowerLeftU,r.lowerLeftV,r.usize,r.vsize,0,1),n.getHandle().setScissorRect(r.lowerLeftU,r.lowerLeftV,r.usize,r.vsize)},t.bindUBO=n=>{n.activateBindGroup(e.bindGroup)},t.opaquePass=n=>{n?(e.renderEncoder.begin(e._parent.getCommandEncoder()),t.updateUBO(),t.updateSSBO()):(t.scissorAndViewport(e.renderEncoder),t.clear(),e.renderEncoder.end())},t.clear=()=>{var a;if(e.renderable.getTransparent()||e.suppressClear)return;const n=e._parent.getDevice();if(!e.clearFSQ){e.clearFSQ=z3.newInstance(),e.clearFSQ.setDevice(n),e.clearFSQ.setPipelineHash("clearfsq"),e.clearFSQ.setFragmentShaderTemplate(a7);const o=su.newInstance({label:"mapperUBO"});o.addEntry("FSQMatrix","mat4x4<f32>"),o.addEntry("BackgroundColor","vec4<f32>"),e.clearFSQ.setUBO(o),e.backgroundTex=e.renderable.getEnvironmentTexture()}if(e.clearFSQ.getPipelineHash()!=="clearfsqwithtexture"&&e.renderable.getUseEnvironmentTextureAsBackground()&&((a=e.backgroundTex)!=null&&a.getImageLoaded())){e.clearFSQ.setFragmentShaderTemplate(oq);const o=su.newInstance({label:"mapperUBO"});o.addEntry("FSQMatrix","mat4x4<f32>"),o.addEntry("BackgroundColor","vec4<f32>"),e.clearFSQ.setUBO(o);const s=n.getTextureManager().getTextureForVTKTexture(e.backgroundTex);if(s.getReady()){const c=s.createView("EnvironmentTexture");e.clearFSQ.setTextureViews([c]),e.backgroundTexLoaded=!0;const l=e.backgroundTex.getInterpolate()?"linear":"nearest";c.addSampler(n,{addressModeU:"repeat",addressModeV:"clamp-to-edge",addressModeW:"repeat",minFilter:l,magFilter:l,mipmapFilter:"linear"})}e.clearFSQ.setPipelineHash("clearfsqwithtexture")}else if(e.clearFSQ.getPipelineHash()==="clearfsqwithtexture"&&!e.renderable.getUseEnvironmentTextureAsBackground()){e.clearFSQ=z3.newInstance(),e.clearFSQ.setDevice(n),e.clearFSQ.setPipelineHash("clearfsq"),e.clearFSQ.setFragmentShaderTemplate(a7);const o=su.newInstance({label:"mapperUBO"});o.addEntry("FSQMatrix","mat4x4<f32>"),o.addEntry("BackgroundColor","vec4<f32>"),e.clearFSQ.setUBO(o)}const r=e.webgpuCamera.getKeyMatrices(t),i=e.renderable.getBackgroundByReference();e.clearFSQ.getUBO().setArray("BackgroundColor",i),ft(o7,r.normalMatrix),ah(d1,r.scvc,r.pcsc),ah(d1,o7,d1),e.clearFSQ.getUBO().setArray("FSQMatrix",d1),e.clearFSQ.getUBO().sendIfNeeded(n),e.clearFSQ.prepareAndDraw(e.renderEncoder)},t.translucentPass=n=>{n?e.renderEncoder.begin(e._parent.getCommandEncoder()):(t.scissorAndViewport(e.renderEncoder),e.renderEncoder.end())},t.volumeDepthRangePass=n=>{n?e.renderEncoder.begin(e._parent.getCommandEncoder()):(t.scissorAndViewport(e.renderEncoder),e.renderEncoder.end())},t.getAspectRatio=()=>{const n=e._parent.getSizeByReference(),r=e.renderable.getViewportByReference();return n[0]*(r[2]-r[0])/((r[3]-r[1])*n[1])},t.convertToOpenGLDepth=n=>e.webgpuCamera.convertToOpenGLDepth(n),t.getYInvertedTiledSizeAndOrigin=()=>{const n=t.getTiledSizeAndOrigin(),r=e._parent.getSizeByReference();return n.lowerLeftV=r[1]-n.vsize-n.lowerLeftV,n},t.getTiledSizeAndOrigin=()=>{const n=e.renderable.getViewportByReference(),r=[0,0,1,1],i=n[0]-r[0],a=n[1]-r[1],o=e._parent.normalizedDisplayToDisplay(i,a),s=Math.round(o[0]),c=Math.round(o[1]),l=n[2]-r[0],f=n[3]-r[1],u=e._parent.normalizedDisplayToDisplay(l,f);let g=Math.round(u[0])-s,d=Math.round(u[1])-c;return g<0&&(g=0),d<0&&(d=0),{usize:g,vsize:d,lowerLeftU:s,lowerLeftV:c}},t.getPropFromID=n=>{for(let r=0;r<e.children.length;r++)if((e.children[r].getPropID?e.children[r].getPropID():-1)===n)return e.children[r];return null},t.getStabilizedTime=()=>e.stabilizedTime.getMTime(),t.releaseGraphicsResources=()=>{e.selector!==null&&e.selector.releaseGraphicsResources()}}const lq={bindGroup:null,selector:null,renderEncoder:null,recenterThreshold:20,suppressClear:!1,stabilizedCenter:[0,0,0]};function uq(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,lq,n),Bt.extend(t,e,n),e.UBO=su.newInstance({label:"rendererUBO"}),e.UBO.addEntry("WCVCMatrix","mat4x4<f32>"),e.UBO.addEntry("SCPCMatrix","mat4x4<f32>"),e.UBO.addEntry("PCSCMatrix","mat4x4<f32>"),e.UBO.addEntry("SCVCMatrix","mat4x4<f32>"),e.UBO.addEntry("VCPCMatrix","mat4x4<f32>"),e.UBO.addEntry("WCVCNormals","mat4x4<f32>"),e.UBO.addEntry("viewportSize","vec2<f32>"),e.UBO.addEntry("LightCount","i32"),e.UBO.addEntry("MaxEnvironmentMipLevel","f32"),e.UBO.addEntry("BackgroundDiffuseStrength","f32"),e.UBO.addEntry("BackgroundSpecularStrength","f32"),e.UBO.addEntry("cameraParallel","u32"),e.SSBO=eq.newInstance({label:"rendererLightSSBO"}),e.lightTimeString="",e.bindGroup=nR.newInstance({label:"rendererBG"}),e.bindGroup.setBindables([e.UBO,e.SSBO]),e.tmpMat4=Be(new Float64Array(16)),e.stabilizedTime={},zt(e.stabilizedTime,{mtime:0}),hi(t,e,["bindGroup","stabilizedTime"]),qu(t,e,["stabilizedCenter"]),Vn(t,e,["renderEncoder","selector","suppressClear","UBO"]),cq(t,e)}const fq=Rt(uq,"vtkWebGPURenderer");Ta("vtkRenderer",fq);function gq(t,e){e.classHierarchy.push("vtkWebGPUSampler"),t.create=function(n){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};e.device=n,e.options.addressModeU=r.addressModeU?r.addressModeU:"clamp-to-edge",e.options.addressModeV=r.addressModeV?r.addressModeV:"clamp-to-edge",e.options.addressModeW=r.addressModeW?r.addressModeW:"clamp-to-edge",e.options.magFilter=r.magFilter?r.magFilter:"nearest",e.options.minFilter=r.minFilter?r.minFilter:"nearest",e.options.mipmapFilter=r.mipmapFilter?r.mipmapFilter:"nearest",e.options.label=e.label,e.handle=e.device.getHandle().createSampler(e.options),e.bindGroupTime.modified()},t.getShaderCode=(n,r)=>`@binding(${n}) @group(${r}) var ${e.label}: sampler;`,t.getBindGroupEntry=()=>({resource:e.handle})}const dq={device:null,handle:null,label:null,options:null};function hR(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,dq,n),P.obj(t,e),e.options={},e.bindGroupLayoutEntry={visibility:GPUShaderStage.VERTEX|GPUShaderStage.FRAGMENT,sampler:{}},e.bindGroupTime={},P.obj(e.bindGroupTime,{mtime:0}),P.get(t,e,["bindGroupTime","handle","options"]),P.setGet(t,e,["bindGroupLayoutEntry","device","label"]),gq(t,e)}const pq=P.newInstance(hR);var mR={newInstance:pq,extend:hR};const{SlicingMode:s7}=S2,hq=`
//VTK::Renderer::Dec

//VTK::Mapper::Dec

//VTK::TCoord::Dec

//VTK::Image::Dec

//VTK::RenderEncoder::Dec

//VTK::IOStructs::Dec

@fragment
fn main(
//VTK::IOStructs::Input
)
//VTK::IOStructs::Output
{
  var output: fragmentOutput;

  //VTK::Image::Sample

  // var computedColor: vec4<f32> = vec4<f32>(1.0,0.7, 0.5, 1.0);

//VTK::RenderEncoder::Impl

  return output;
}
`;function mq(t,e,n){if(e.apply(t)){const i=t.getIndependentComponents();return`${t.getMTime()}-${i}-${n}`}return"0"}const Ui=new Float64Array(16),ro=new Float64Array(16),p1=new Float64Array(16),zo=new Float64Array(4),Yn=new Float64Array(4);function vq(t,e){e.classHierarchy.push("vtkWebGPUImageMapper"),t.buildPass=i=>{if(i){e.WebGPUImageSlice=t.getFirstAncestorOfType("vtkWebGPUImageSlice"),e.WebGPURenderer=e.WebGPUImageSlice.getFirstAncestorOfType("vtkWebGPURenderer"),e.WebGPURenderWindow=e.WebGPURenderer.getParent(),e.device=e.WebGPURenderWindow.getDevice();const a=e.WebGPURenderer.getRenderable();e.renderable.getSliceAtFocalPoint()&&e.renderable.setSliceFromCamera(a.getActiveCamera())}},t.translucentPass=i=>{i&&t.render()},t.opaquePass=i=>{i&&t.render()},t.render=()=>{e.renderable.update(),e.currentInput=e.renderable.getInputData(),t.prepareToDraw(e.WebGPURenderer.getRenderEncoder()),e.renderEncoder.registerDrawCallback(e.pipeline,t.draw)},t.computePipelineHash=()=>{const i=e.currentInput.getExtent();i[0]===i[1]||i[2]===i[3]||i[4]===i[5]?(e.dimensions=2,e.pipelineHash="img2"):(e.dimensions=3,e.pipelineHash="img3")},t.updateUBO=()=>{const i=e.UBO.getSendTime(),a=e.WebGPUImageSlice.getRenderable(),o=a.getMapper();if(t.getMTime()>i||e.renderable.getMTime()>i||a.getProperty().getMTime()>i){const s=o.getInputData(),c=e.WebGPURenderer.getStabilizedCenterByReference();Be(Ui),en(Ui,Ui,c);const l=a.getMatrix();ft(ro,l),Ln(ro,ro),vt(Ui,ro,Ui);const f=s.getWorldToIndex();vt(Ui,f,Ui),Ln(p1,Ui),d2(ro,[.5,.5,.5]),vt(Ui,ro,Ui);const u=s.getDimensions();Be(ro),ms(ro,ro,[1/u[0],1/u[1],1/u[2]]),vt(Ui,ro,Ui),e.UBO.setArray("SCTCMatrix",Ui);const g=e.currentInput.getExtent(),{ijkMode:d}=e.renderable.getClosestIJKAxis();let h=e.renderable.getSlice();d!==e.renderable.getSlicingMode()&&(h=e.renderable.getSliceAtPosition(h));let p=2,m=0,v=1;d===s7.I?(p=0,m=1,v=2):d===s7.J&&(p=1,m=2,v=0),zo[p]=h,zo[m]=g[m*2]-.5,zo[v]=g[v*2]-.5,zo[3]=1,V0(zo,zo,p1),e.UBO.setArray("Origin",zo),Yn[p]=h,Yn[m]=g[m*2+1]+.5,Yn[v]=g[v*2]-.5,Yn[3]=1,V0(Yn,Yn,p1),u9(Yn,Yn,zo),Yn[3]=1,e.UBO.setArray("Axis1",Yn),Yn[p]=h,Yn[m]=g[m*2]-.5,Yn[v]=g[v*2+1]+.5,Yn[3]=1,V0(Yn,Yn,p1),u9(Yn,Yn,zo),Yn[3]=1,e.UBO.setArray("Axis2",Yn);const y=[1,1,1,1],T=[0,0,0,0],C=e.textureViews[0],w=C.getTexture().getScale(),x=C.getTexture().getNumberOfComponents();for(let O=0;O<x;O++){let M=a.getProperty().getColorWindow(),A=a.getProperty().getColorLevel();const k=a.getProperty().getRGBTransferFunction(0);if(k){const z=k.getRange();M=z[1]-z[0],A=.5*(z[1]+z[0])}y[O]=w/M,T[O]=-A/M+.5}e.UBO.setArray("cScale",y),e.UBO.setArray("cShift",T),e.UBO.sendIfNeeded(e.device)}},t.updateLUTImage=()=>{const i=e.WebGPUImageSlice.getRenderable().getProperty();t.getTextureViews()[0].getTexture().getNumberOfComponents();const o=1,s=mq(i,i.getRGBTransferFunction,o);if(e.colorTextureString!==s){e.numRows=o;const c=new Uint8ClampedArray(e.numRows*2*e.rowLength*4);let l=i.getRGBTransferFunction();if(l){const f=new Float32Array(e.rowLength*3);for(let u=0;u<o;u++){l=i.getRGBTransferFunction(u);const g=l.getRange();l.getTable(g[0],g[1],e.rowLength,f,1);for(let d=0;d<e.rowLength;d++){const h=u*e.rowLength*8+d*4;c[h]=255*f[d*3],c[h+1]=255*f[d*3+1],c[h+2]=255*f[d*3+2],c[h+3]=255;for(let p=0;p<4;p++)c[h+e.rowLength*4+p]=c[h+p]}}}else for(let f=0;f<e.rowLength;++f){const u=255*f/(e.rowLength-1);c[f*4]=u,c[f*4+1]=u,c[f*4+2]=u,c[f*4+3]=255;for(let g=0;g<4;g++)c[f*4+e.rowLength*4+g]=c[f*4+g]}{const f={nativeArray:c,width:e.rowLength,height:e.numRows*2,depth:1,format:"rgba8unorm"},g=e.device.getTextureManager().getTexture(f).createView("tfunTexture");e.textureViews[1]=g}e.colorTextureString=s}};const n=t.updateBuffers;t.updateBuffers=()=>{n();const i=e.device.getTextureManager().getTextureForImageData(e.currentInput),a=e.textureViews;if(!a[0]||a[0].getTexture()!==i){const c=i.createView("imgTexture");a[0]=c}t.updateLUTImage(),t.updateUBO();const s=e.WebGPUImageSlice.getRenderable().getProperty().getInterpolationType()===B0.NEAREST?"nearest":"linear";(!e.clampSampler||s!==e.clampSampler.getOptions().minFilter)&&(e.clampSampler=mR.newInstance({label:"clampSampler"}),e.clampSampler.create(e.device,{minFilter:s,magFilter:s}),e.additionalBindables=[e.clampSampler])};const r=t.getShaderReplacements();t.replaceShaderPosition=(i,a,o)=>{const s=a.getShaderDescription("vertex");s.addBuiltinOutput("vec4<f32>","@builtin(position) Position");let c=s.getCode();const l=["var pos: vec4<f32> = mapperUBO.Origin +","   (vertexBC.x * 0.5 + 0.5) * mapperUBO.Axis1 + (vertexBC.y * 0.5 + 0.5) * mapperUBO.Axis2;","pos.w = 1.0;"];e.dimensions===2?l.push("var tcoord : vec2<f32> = (mapperUBO.SCTCMatrix * pos).xy;"):l.push("var tcoord : vec3<f32> = (mapperUBO.SCTCMatrix * pos).xyz;"),l.push("output.tcoordVS = tcoord;","output.Position = rendererUBO.SCPCMatrix * pos;"),c=Ut.substitute(c,"//VTK::Position::Impl",l).result,s.setCode(c)},r.set("replaceShaderPosition",t.replaceShaderPosition),t.replaceShaderTCoord=(i,a,o)=>{const s=a.getShaderDescription("vertex");e.dimensions===2?s.addOutput("vec2<f32>","tcoordVS"):s.addOutput("vec3<f32>","tcoordVS")},r.set("replaceShaderTCoord",t.replaceShaderTCoord),t.replaceShaderImage=(i,a,o)=>{const s=a.getShaderDescription("fragment");let c=s.getCode();e.dimensions===3?c=Ut.substitute(c,"//VTK::Image::Sample",["    var computedColor: vec4<f32> =","      textureSampleLevel(imgTexture, clampSampler, input.tcoordVS, 0.0);","//VTK::Image::Sample"]).result:c=Ut.substitute(c,"//VTK::Image::Sample",["    var computedColor: vec4<f32> =","      textureSampleLevel(imgTexture, clampSampler, input.tcoordVS, 0.0);","//VTK::Image::Sample"]).result,c=Ut.substitute(c,"//VTK::Image::Sample",["    var coord: vec2<f32> =","      vec2<f32>(computedColor.r * mapperUBO.cScale.r + mapperUBO.cShift.r, 0.5);","    computedColor = textureSampleLevel(tfunTexture, clampSampler, coord, 0.0);"]).result,s.setCode(c)},r.set("replaceShaderImage",t.replaceShaderImage)}const yq={rowLength:1024};function Tq(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,yq,n),z3.extend(t,e,n),t.setFragmentShaderTemplate(hq),e.UBO=su.newInstance({label:"mapperUBO"}),e.UBO.addEntry("SCTCMatrix","mat4x4<f32>"),e.UBO.addEntry("Origin","vec4<f32>"),e.UBO.addEntry("Axis2","vec4<f32>"),e.UBO.addEntry("Axis1","vec4<f32>"),e.UBO.addEntry("cScale","vec4<f32>"),e.UBO.addEntry("cShift","vec4<f32>"),e.lutBuildTime={},zt(e.lutBuildTime,{mtime:0}),e.imagemat=Be(new Float64Array(16)),e.imagematinv=Be(new Float64Array(16)),e.VBOBuildTime={},zt(e.VBOBuildTime),vq(t,e)}const Cq=Rt(Tq,"vtkWebGPUImageMapper");Ta("vtkImageMapper",Cq);function wq(t,e){e.classHierarchy.push("vtkWebGPUImageSlice"),t.buildPass=n=>{if(!(!e.renderable||!e.renderable.getVisibility())&&n){if(!e.renderable)return;e.WebGPURenderer=t.getFirstAncestorOfType("vtkWebGPURenderer"),e.WebGPURenderWindow=e.WebGPURenderer.getFirstAncestorOfType("vtkWebGPURenderWindow"),e.propID===void 0&&(e.propID=e.WebGPURenderWindow.getUniquePropID()),t.prepareNodes(),t.addMissingNode(e.renderable.getMapper()),t.removeUnusedNodes()}},t.traverseOpaquePass=n=>{!e.renderable||!e.renderable.getNestedVisibility()||!e.renderable.getIsOpaque()||e.WebGPURenderer.getSelector()&&!e.renderable.getNestedPickable()||(t.apply(n,!0),e.children.forEach(r=>{r.traverse(n)}),t.apply(n,!1))},t.traverseTranslucentPass=n=>{!e.renderable||!e.renderable.getNestedVisibility()||e.renderable.getIsOpaque()||e.WebGPURenderer.getSelector()&&!e.renderable.getNestedPickable()||(t.apply(n,!0),e.children.forEach(r=>{r.traverse(n)}),t.apply(n,!1))},t.queryPass=(n,r)=>{if(n){if(!e.renderable||!e.renderable.getVisibility())return;e.renderable.getIsOpaque()?r.incrementOpaqueActorCount():r.incrementTranslucentActorCount()}},t.getBufferShift=n=>(t.getKeyMatrices(n),e.bufferShift),t.getKeyMatrices=n=>{if(Math.max(e.renderable.getMTime(),n.getStabilizedTime())>e.keyMatricesTime.getMTime()){e.renderable.computeMatrix();const r=e.renderable.getMatrix(),i=n.getStabilizedCenterByReference();e.bufferShift[0]=r[3]-i[0],e.bufferShift[1]=r[7]-i[1],e.bufferShift[2]=r[11]-i[2],ft(e.keyMatrices.bcwc,r),e.renderable.getIsIdentity()?Be(e.keyMatrices.normalMatrix):(nn(e.keyMatrices.normalMatrix,e.keyMatrices.bcwc),e.keyMatrices.normalMatrix[3]=0,e.keyMatrices.normalMatrix[7]=0,e.keyMatrices.normalMatrix[11]=0,Ln(e.keyMatrices.normalMatrix,e.keyMatrices.normalMatrix),ft(e.keyMatrices.normalMatrix,e.keyMatrices.normalMatrix)),en(e.keyMatrices.bcwc,e.keyMatrices.bcwc,[-e.bufferShift[0],-e.bufferShift[1],-e.bufferShift[2]]),en(e.keyMatrices.bcsc,e.keyMatrices.bcwc,[-i[0],-i[1],-i[2]]),e.keyMatricesTime.modified()}return e.keyMatrices}}const xq={bufferShift:void 0,keyMatrixTime:null,keyMatrices:null,propID:void 0};function Sq(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,xq,n),Bt.extend(t,e,n),e.keyMatricesTime={},zt(e.keyMatricesTime,{mtime:0}),e.keyMatrices={normalMatrix:new Float64Array(16),bcwc:new Float64Array(16),bcsc:new Float64Array(16)},e.keyMatrixTime={},zt(e.keyMatrixTime,{mtime:0}),e.keyMatrices={mcwc:Be(new Float64Array(16))},e.bufferShift=[0,0,0,0],hi(t,e,["propID","keyMatricesTime"]),wq(t,e)}const Eq=Rt(Sq,"vtkWebGPUImageSlice");Ta("vtkImageSlice",Eq);function Oq(t,e){e.classHierarchy.push("vtkWebGPUVolume"),t.buildPass=i=>{!e.renderable||!e.renderable.getVisibility()||i&&(e.WebGPURenderer=t.getFirstAncestorOfType("vtkWebGPURenderer"),e.WebGPURenderWindow=e.WebGPURenderer.getFirstAncestorOfType("vtkWebGPURenderWindow"),e.propID===void 0&&(e.propID=e.WebGPURenderWindow.getUniquePropID()),e.renderable.getMapper().update())},t.queryPass=(i,a)=>{if(i){if(!e.renderable||!e.renderable.getVisibility())return;const o=e.renderable.getMapper().getBounds();if(!o||o.length!==6||o[0]>o[1])return;a.addVolume(t)}};const n=new Float64Array(3),r=new Float64Array(3);t.getBoundingCubePoints=(i,a)=>{const o=e.renderable.getMapper().getInputData();if(!o)return;const s=o.getExtent(),c=e.renderable.getMatrix();let l=0;for(let f=4;f<6;f++){n[2]=s[f];for(let u=2;u<4;u++){n[1]=s[u];for(let g=0;g<2;g++){n[0]=s[g],o.indexToWorld(n,r);let d=a+l*3;i[d++]=c[0]*r[0]+c[1]*r[1]+c[2]*r[2]+c[3],i[d++]=c[4]*r[0]+c[5]*r[1]+c[6]*r[2]+c[7],i[d++]=c[8]*r[0]+c[9]*r[1]+c[10]*r[2]+c[11],l++}}}},t.getKeyMatrices=i=>{if(Math.max(e.renderable.getMTime(),i.getStabilizedTime())>e.keyMatricesTime.getMTime()){e.renderable.computeMatrix();const a=e.renderable.getMatrix(),o=i.getStabilizedCenterByReference();ft(e.keyMatrices.bcwc,a),en(e.keyMatrices.bcsc,e.keyMatrices.bcwc,[-o[0],-o[1],-o[2]]),e.keyMatricesTime.modified()}return e.keyMatrices}}const Dq={propID:void 0,keyMatricesTime:null};function Rq(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Dq,n),Bt.extend(t,e,n),e.keyMatricesTime={},P.obj(e.keyMatricesTime,{mtime:0}),e.keyMatrices={bcwc:new Float64Array(16),bcsc:new Float64Array(16)},P.get(t,e,["propID","keyMatricesTime"]),Oq(t,e)}const Mq=P.newInstance(Rq,"vtkWebGPUVolume");Ta("vtkVolume",Mq);function _q(t,e){e.classHierarchy.push("vtkWebGPUPixelSpaceCallbackMapper"),t.opaquePass=(n,r)=>{e.WebGPURenderer=t.getFirstAncestorOfType("vtkWebGPURenderer"),e.WebGPURenderWindow=e.WebGPURenderer.getParent();const i=e.WebGPURenderer.getAspectRatio(),a=e.WebGPURenderer?e.WebGPURenderer.getRenderable().getActiveCamera():null,o=e.WebGPURenderer.getTiledSizeAndOrigin(),s=null;e.renderable.getUseZValues(),e.renderable.invokeCallback(e.renderable.getInputData(),a,i,o,s)}}const bq={};function Lq(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,bq,n),Bt.extend(t,e,n),_q(t,e)}const Iq=P.newInstance(Lq,"vtkWebGPUPixelSpaceCallbackMapper");Ta("vtkPixelSpaceCallbackMapper",Iq);const c7=[[0,-1,0],[0,1,0],[0,0,-1],[0,0,1]],l7=[[0,-1,0],[0,1,0]],Vq=[[0,-1,0],[0,1,0],[0,0,-1]],Pq=[[0,-1,0],[0,1,0],[0,0,1]],L8=class L8{static copyMap(e,n){for(const[r,i]of n.rows)e.rows.set(r,structuredClone(i))}constructor(e,n,r=1){this.rows=new Map,this.height=1,this.width=1,this.depth=1,this.jMultiple=1,this.kMultiple=1,this.numComps=1,this.pixelDataConstructor=Uint8Array,this.updateScalarData=function(i){i.fill(0);const a=(o,s,c)=>{const{start:l,end:f,value:u}=s;for(let g=l;g<f;g++)i[o+g]=u};this.forEach(a)},this.get=i=>{const a=i%this.jMultiple,o=(i-a)/this.jMultiple,s=this.getRLE(a,o);return(s==null?void 0:s.value)??this.defaultValue},this.getRun=(i,a)=>{const o=i+a*this.height;return this.rows.get(o)},this.set=(i,a)=>{if(a===void 0)return;const o=i%this.width,s=(i-o)/this.width,c=this.rows.get(s);if(!c){this.rows.set(s,[{start:o,end:o+1,value:a}]);return}const l=this.findIndex(c,o),f=c[l],u=c[l-1];if(!f){if(!u||u.value!==a||u.end!==o){c[l]={start:o,end:o+1,value:a};return}u.end++;return}const{start:g,end:d,value:h}=f;if(a===h&&o>=g)return;const p={start:o,end:o+1,value:a},m=o>g,v=m?l+1:l,y=m?f:u;let T=m?c[l+1]:f;if((y==null?void 0:y.value)===a&&(y==null?void 0:y.end)===o){y.end++,(T==null?void 0:T.value)===a&&T.start===o+1?(y.end=T.end,c.splice(l,1)):(T==null?void 0:T.start)===o&&(T.start++,T.start===T.end&&(c.splice(l,1),T=c[l],(T==null?void 0:T.start)===o+1&&T.value===a&&(y.end=T.end,c.splice(l,1))));return}if((T==null?void 0:T.value)===a&&T.start===o+1){T.start--,(y==null?void 0:y.end)>o&&(y.end=o,y.end===y.start&&c.splice(l,1));return}if((T==null?void 0:T.start)===o&&T.end===o+1){T.value=a;const C=c[l+1];(C==null?void 0:C.start)==o+1&&C.value===a&&(c.splice(l+1,1),T.end=C.end);return}o===(T==null?void 0:T.start)&&T.start++,m&&d>o+1?c.splice(v,0,p,{start:o+1,end:y.end,value:y.value}):c.splice(v,0,p),(y==null?void 0:y.end)>o&&(y.end=o)},this.width=e,this.height=n,this.depth=r,this.jMultiple=e,this.kMultiple=this.jMultiple*n}toIJK(e){const n=e%this.jMultiple,r=(e-n)/this.jMultiple%this.height,i=Math.floor(e/this.kMultiple);return[n,r,i]}toIndex([e,n,r]){return e+r*this.kMultiple+n*this.jMultiple}getRLE(e,n,r=0){const i=this.rows.get(n+r*this.height);if(!i)return;const a=this.findIndex(i,e),o=i[a];return e>=(o==null?void 0:o.start)?o:void 0}has(e){const n=e%this.jMultiple,r=(e-n)/this.jMultiple,i=this.getRLE(n,r);return(i==null?void 0:i.value)!==void 0}delete(e){const n=e%this.width,r=(e-n)/this.width,i=this.rows.get(r);if(!i)return;const a=this.findIndex(i,n),o=i[a];if(!o||o.start>n)return;if(o.end===n+1){o.end--,o.start>=o.end&&(i.splice(a,1),i.length||this.rows.delete(r));return}if(o.start===n){o.start++;return}const s={value:o.value,start:n+1,end:o.end};o.end=n,i.splice(a+1,0,s)}findIndex(e,n){for(let r=0;r<e.length;r++){const{end:i}=e[r];if(n<i)return r}return e.length}forEach(e,n){const r=n==null?void 0:n.rowModified;for(const[i,a]of this.rows){const o=r?[...a]:a;for(const s of o)e(i*this.width,s,a)}}forEachRow(e){for(const[n,r]of this.rows)e(n*this.width,r)}clear(){this.rows.clear()}keys(){return[...this.rows.keys()]}getPixelData(e=0,n){n?n.fill(0):n=new this.pixelDataConstructor(this.width*this.height*this.numComps);const{width:r,height:i,numComps:a}=this;for(let o=0;o<i;o++){const s=this.getRun(o,e);if(s)if(a===1)for(const c of s){const l=o*r,{start:f,end:u,value:g}=c;for(let d=f;d<u;d++)n[l+d]=g}else for(const c of s){const l=o*r*a,{start:f,end:u,value:g}=c;for(let d=f;d<u;d+=a)for(let h=0;h<a;h++)n[l+d+h]=g[h]}}return n}floodFill(e,n,r,i,a){const o=this.getRLE(e,n,r);if(!o)throw new Error(`Initial point ${e},${n},${r} isn't in the RLE`);const s=[[o,n,r]],c=o.value;if(c===i)throw new Error(`source (${c}) and destination (${i}) are identical`);return this.flood(s,c,i,a)}flood(e,n,r,i){let a=0;const{planar:o=!0,diagonals:s=!0,singlePlane:c=!1}=i||{},l={planar:o,diagonals:s,singlePlane:c};for(;e.length;){const f=e.pop(),[u]=f;if(u.value!==n)continue;u.value=r,a+=u.end-u.start;const g=this.findAdjacents(f,l).filter(d=>d&&d[0].value===n);e.push(...g)}return a}fillFrom(e,n){for(let r=n[2][0];r<=n[2][1];r++)for(let i=n[1][0];i<=n[1][1];i++){let a,o;for(let s=n[0][0];s<=n[0][1];s++){const c=e(s,i,r);if(c===void 0){a=void 0;continue}o||(o=[],this.rows.set(i+r*this.height,o)),a&&a.value!==c&&(a=void 0),a||(a={start:s,end:s,value:c},o.push(a)),a.end++}}}findAdjacents(e,{diagonals:n=!0,planar:r=!0,singlePlane:i=!1}){const[a,o,s,c]=e,{start:l,end:f}=a,u=l>0&&this.getRLE(l-1,o,s),g=f<this.width&&this.getRLE(f,o,s),d=n?[l>0?l-1:l,f<this.width?f+1:f]:[l,f],h=[];u&&h.push([u,o,s]),g&&h.push([g,o,s]);for(const p of c||(i?l7:c7)){const[,m,v]=p,y=m+o,T=v+s;if(y<0||y>=this.height||T<0||T>=this.depth)continue;const C=this.getRun(y,T);if(C)for(const w of C){const x=c||i&&l7||r&&v>0&&Pq||r&&v<0&&Vq||c7;w.end<=d[0]||w.start>=d[1]||h.push([w,y,T,x])}}return h}};L8.getScalarData=function(e=Uint8ClampedArray){const n=new e(this.frameSize);return this.map.updateScalarData(n),n};let nc=L8,gp=class zf{constructor(e={}){this._dimensions=3,this._length=0,this._byteSize=4,this.growSize=128;const{initialSize:n=1024,dimensions:r=3,growSize:i=128}=e,a=n*r;this.growSize=i,this.array=new ArrayBuffer(a*this._byteSize),this.data=new Float32Array(this.array),this._dimensions=r}forEach(e){for(let n=0;n<this._length;n++)e(this.getPoint(n),n)}get length(){return this._length}get dimensions(){return this._dimensions}get dimensionLength(){return this._length*this._dimensions}getPoint(e){if(e<0&&(e+=this._length),e<0||e>=this._length)return;const n=this._dimensions*e;return this.data.subarray(n,n+this._dimensions)}getPointArray(e){const n=[];if(e<0&&(e+=this._length),e<0||e>=this._length)return;const r=this._dimensions*e;for(let i=0;i<this._dimensions;i++)n.push(this.data[i+r]);return n}grow(e=1,n=this.growSize){if(this.dimensionLength+e*this._dimensions<=this.data.length)return;const r=this.data.length+n,i=new ArrayBuffer(r*this._dimensions*this._byteSize),a=new Float32Array(i);a.set(this.data),this.data=a,this.array=i}reverse(){const e=Math.floor(this._length/2);for(let n=0;n<e;n++){const r=n*this._dimensions,i=(this._length-1-n)*this._dimensions;for(let a=0;a<this._dimensions;a++){const o=this.data[r+a];this.data[r+a]=this.data[i+a],this.data[i+a]=o}}}getTypedArray(){return this.data}push(e){this.grow(1);const n=this.length*this._dimensions;for(let r=0;r<this._dimensions;r++)this.data[r+n]=e[r];this._length++}map(e){const n=[];for(let r=0;r<this._length;r++)n.push(e(this.getPoint(r),r));return n}get points(){return this.map(e=>e)}toXYZ(){const e={x:[],y:[]};this._dimensions>=3&&(e.z=[]);const{x:n,y:r,z:i}=e;return this.forEach(a=>{n.push(a[0]),r.push(a[1]),i&&i.push(a[2])}),e}static fromXYZ({x:e,y:n,z:r}){const i=zf.create3(e.length);let a=0;for(let o=0;o<e.length;o++)i.data[a++]=e[o],i.data[a++]=n[o],i.data[a++]=r?r[o]:0;return i._length=e.length,i}subselect(e=10,n=0){const r=new zf({initialSize:e,dimensions:this._dimensions});for(let i=0;i<e;i++){const a=(n+Math.floor(this.length*i/e))%this.length;r.push(this.getPoint(a))}return r}static create3(e=128,n){e=Math.max(e,(n==null?void 0:n.length)||0);const r=new zf({initialSize:e,dimensions:3});return n&&n.forEach(i=>r.push(i)),r}static create2(e=128){return new zf({initialSize:e,dimensions:2})}};function vR(t){const e=Le(),n=t.getDimensions(),r=gp.create3(n[0]),i=gp.create3(n[1]),a=gp.create3(n[2]),o=t.getDirection(),s=o.slice(0,3),c=o.slice(3,6),l=o.slice(6,9),f=t.getSpacing(),[u,g,d]=f,h=t.indexToWorld([0,0,0]),p=Cn(s[0]*u,s[1]*u,s[2]*u),m=Cn(c[0]*g,c[1]*g,c[2]*g),v=Cn(l[0]*d,l[1]*d,l[2]*d),y=Le();for(let x=0;x<n[0];x++)r.push(da(y,h,Br(y,p,x)));for(let x=0;x<n[1];x++)i.push(Br(y,m,x));for(let x=0;x<n[2];x++)a.push(Br(y,v,x));const T=r.getTypedArray(),C=i.getTypedArray(),w=a.getTypedArray();return(x,O=e)=>{const[M,A,_]=x,k=M*3,z=A*3,X=_*3;return O[0]=T[k]+C[z]+w[X],O[1]=T[k+1]+C[z+1]+w[X+1],O[2]=T[k+2]+C[z+2]+w[X+2],O}}function Sy(t,e){const{pointInShapeFn:n,callback:r,boundsIJK:i,returnPoints:a=!1}=e;let o;t.getScalarData?o=t.getScalarData():o=t.getPointData().getScalars().getData();const s=t.getDimensions(),c=[[0,s[0]],[0,s[1]],[0,s[2]]],f=Nq({imageData:t,bounds:i||c,scalarData:o,pointInShapeFn:n,callback:r});return a?f:void 0}function Nq({imageData:t,bounds:e,scalarData:n,pointInShapeFn:r,callback:i}){const[[a,o],[s,c],[l,f]]=e,{numComps:u}=t,g=t.getDimensions(),d=vR(t),h=[0,0,0],p=u||n.length/g[2]/g[1]/g[0],m=g[0]*p,v=g[1]*m,y=[];for(let T=l;T<=f;T++){h[2]=T;const C=T*v;for(let w=s;w<=c;w++){h[1]=w;const x=C+w*m;for(let O=a;O<=o;O++){h[0]=O;const M=d(h);if(r(M,h)){const A=x+O*p;let _;p>2?_=[n[A],n[A+1],n[A+2]]:_=n[A],y.push({value:_,index:A,pointIJK:h,pointLPS:M.slice()}),i({value:_,index:A,pointIJK:h,pointLPS:M})}}}}return y}function kq({voxelManager:t,bounds:e,imageData:n,pointInShapeFn:r,callback:i,returnPoints:a}){const[[o,s],[c,l],[f,u]]=e,g=vR(n),d=[0,0,0],h=[];for(let p=f;p<=u;p++){d[2]=p;for(let m=c;m<=l;m++){d[1]=m;for(let v=o;v<=s;v++){d[0]=v;const y=g(d);if(r(y,d)){const T=t.toIndex(d),C=t.getAtIndex(T);a&&h.push({value:C,index:T,pointIJK:[...d],pointLPS:y.slice()}),i==null||i({value:C,index:T,pointIJK:d,pointLPS:y})}}}}return h}const Aq=5*1024;class Wt{constructor(e,n){this.modifiedSlices=new Set,this.boundsIJK=[[1/0,-1/0],[1/0,-1/0],[1/0,-1/0]],this.scalarData=null,this._sliceDataCache=null,this.getAtIJK=(r,i,a)=>{const o=this.toIndex([r,i,a]);return this._get(o)},this.setAtIJK=(r,i,a,o)=>{const s=this.toIndex([r,i,a]),c=this._set(s,o);return c!==!1&&(this.modifiedSlices.add(a),Wt.addBounds(this.boundsIJK,[r,i,a])),c},this.getAtIJKPoint=([r,i,a])=>this.getAtIJK(r,i,a),this.setAtIJKPoint=([r,i,a],o)=>{this.setAtIJK(r,i,a,o)},this.getAtIndex=r=>this._get(r),this.setAtIndex=(r,i)=>{const a=this._set(r,i);if(a!==!1){const o=this.toIJK(r);this.modifiedSlices.add(o[2]),Wt.addBounds(this.boundsIJK,o)}return a},this.getMiddleSliceData=()=>{const r=Math.floor(this.dimensions[2]/2);return this.getSliceData({sliceIndex:r,slicePlane:2})},this.forEach=(r,i={})=>{const a=i.boundsIJK||this.getBoundsIJK(),o=i.isInObject||this.isInObject||(()=>!0),s=i.returnPoints||!1,c=i.imageData,l=Math.min(a[0][0],a[0][1]),f=Math.max(a[0][0],a[0][1]),u=Math.min(a[1][0],a[1][1]),g=Math.max(a[1][0],a[1][1]),d=Math.min(a[2][0],a[2][1]),h=Math.max(a[2][0],a[2][1]),p=[];if(c)return kq({voxelManager:this,imageData:i.imageData,bounds:[[l,f],[u,g],[d,h]],pointInShapeFn:o,callback:r,returnPoints:s});if(this.map){if(this.map instanceof nc)return this.rleForEach(r,i);for(const m of this.map.keys()){const v=this.toIJK(m);if(!o(null,v))continue;const y=this._get(m);s&&p.push({value:y,index:m,pointIJK:v,pointLPS:null}),r({value:y,index:m,pointIJK:v,pointLPS:null})}return p}else{for(let m=d;m<=h;m++){const v=m*this.frameSize;for(let y=u;y<=g;y++){const T=v+y*this.width;for(let C=l,w=T+C;C<=f;C++,w++){const x=this.getAtIndex(w),O=[C,y,m];o(null,O)&&(s&&p.push({value:x,index:w,pointIJK:O,pointLPS:null}),r({value:x,index:w,pointIJK:[C,y,m],pointLPS:null}))}}}return p}},this.getSliceData=({sliceIndex:r,slicePlane:i})=>{const[a,o,s]=this.dimensions,c=a*o,l=r*c;let f;const u=this.getConstructor();function g(h){return typeof h=="function"}if(!g(u))return new Uint8Array(0);let d;switch(i){case 0:f=o*s,d=new u(f);for(let h=0;h<o;h++)for(let p=0;p<s;p++){const m=r+h*a+p*c;this.setSliceDataValue(d,h*s+p,this._get(m))}break;case 1:f=a*s,d=new u(f);for(let h=0;h<a;h++)for(let p=0;p<s;p++){const m=h+r*a+p*c;this.setSliceDataValue(d,h+p*a,this._get(m))}break;case 2:f=a*o,d=new u(f);for(let h=0;h<f;h++)this.setSliceDataValue(d,h,this._get(l+h));break;default:throw new Error("Oblique plane - todo - implement as ortho normal vector")}return d},this.dimensions=e,this.width=e[0],this.frameSize=this.width*e[1],this._get=n._get,this._set=n._set,this._id=n._id||"",this._getConstructor=n._getConstructor,this.numberOfComponents=this.numberOfComponents||1,this.scalarData=n.scalarData,this._getScalarData=n._getScalarData,this._updateScalarData=n._updateScalarData}getMinMax(){let e,n;const r=({value:i})=>{const a=Array.isArray(i);if(e===void 0&&(e=a?[...i]:i,n=a?[...i]:i),a)for(let o=0;o<i.length;o++)e[o]=Math.min(e[o],i[o]),n[o]=Math.max(n[o],i[o]);else e=Math.min(e,i),n=Math.max(n,i)};return this.forEach(r,{boundsIJK:this.getDefaultBounds()}),{min:e,max:n}}toIJK(e){return[e%this.width,Math.floor(e%this.frameSize/this.width),Math.floor(e/this.frameSize)]}toIndex(e){return e[0]+e[1]*this.width+e[2]*this.frameSize}getDefaultBounds(){return this.dimensions.map(e=>[0,e-1])}getBoundsIJK(){return this.boundsIJK[0][0]<this.dimensions[0]?this.boundsIJK:this.getDefaultBounds()}rleForEach(e,n){const r=(n==null?void 0:n.boundsIJK)||this.getBoundsIJK(),{isWithinObject:i}=n||{},a=this.map;a.defaultValue=void 0;for(let o=r[2][0];o<=r[2][1];o++)for(let s=r[1][0];s<=r[1][1];s++){const c=a.getRun(s,o);if(c)for(const l of c){const{start:f,end:u,value:g}=l,d=this.toIndex([0,s,o]);for(let h=f;h<u;h++){const p={value:g,index:d+h,pointIJK:[h,s,o]};(i==null?void 0:i(p))!==!1&&e(p)}}}}getScalarData(e=!1){var n;if(this.scalarData)return(n=this._updateScalarData)==null||n.call(this,this.scalarData),this.scalarData;if(this._getScalarData){const r=this._getScalarData();return e&&console.log("Not transient, should store value",r),r}throw new Error("No scalar data available")}setScalarData(e){this.scalarData=e}getScalarDataLength(){if(this.scalarData)return this.scalarData.length;if(this._getScalarDataLength)return this._getScalarDataLength();throw new Error("No scalar data available")}get sizeInBytes(){return this.getScalarDataLength()*this.bytePerVoxel}get bytePerVoxel(){return this.scalarData?this.scalarData.BYTES_PER_ELEMENT:this._get(0).BYTES_PER_ELEMENT}clear(){var e,n;(e=this.map)==null||e.clear(),this.boundsIJK.map(r=>{r[0]=1/0,r[1]=-1/0}),this.modifiedSlices.clear(),(n=this.points)==null||n.clear()}getConstructor(){return this.scalarData?this.scalarData.constructor:this._getConstructor?this._getConstructor():(console.warn("No scalar data available or can be used to get the constructor"),Float32Array)}getArrayOfModifiedSlices(){return Array.from(this.modifiedSlices)}resetModifiedSlices(){this.modifiedSlices.clear()}static addBounds(e,n){e||(e=[[1/0,-1/0],[1/0,-1/0],[1/0,-1/0]]),e[0][0]=Math.min(n[0],e[0][0]),e[0][1]=Math.max(n[0],e[0][1]),e[1][0]=Math.min(n[1],e[1][0]),e[1][1]=Math.max(n[1],e[1][1]),e[2][0]=Math.min(n[2],e[2][0]),e[2][1]=Math.max(n[2],e[2][1])}addPoint(e){const n=Array.isArray(e)?e[0]+this.width*e[1]+this.frameSize*e[2]:e;this.points||(this.points=new Set),this.points.add(n)}getPoints(){return this.points?[...this.points].map(e=>this.toIJK(e)):[]}setSliceDataValue(e,n,r){if(Array.isArray(r))for(let i=0;i<r.length;i++)e[n*r.length+i]=this.toNumber(r[i]);else e[n]=this.toNumber(r)}toNumber(e){return typeof e=="number"?e:Array.isArray(e)&&e[0]||0}static _createRGBScalarVolumeVoxelManager({dimensions:e,scalarData:n,numberOfComponents:r=3}){const i=new Wt(e,{_get:a=>(a*=r,[n[a++],n[a++],n[a++]]),_id:"_createRGBScalarVolumeVoxelManager",_set:(a,o)=>{a*=3;const s=!Mn(n[a],o);return n[a++]=o[0],n[a++]=o[1],n[a++]=o[2],s},numberOfComponents:r,scalarData:n});return i.clear=()=>{n.fill(0)},i}static createImageVolumeVoxelManager({dimensions:e,imageIds:n,numberOfComponents:r=1}){const i=e[0]*e[1];function a(f){const u=Math.floor(f/i);if(u<0||u>=e[2])return{};const g=n[u];if(!g)return console.warn(`ImageId not found for sliceIndex: ${u}`),{pixelData:null,pixelIndex:null};const d=Me.getImage(g);if(!d)return console.warn(`Image not found for imageId: ${g}`),{pixelData:null,pixelIndex:null};const h=d.voxelManager,p=f%i;return{voxelManager:h,pixelIndex:p}}function o(f){const{voxelManager:u,pixelIndex:g}=a(f);return!u||g===null?null:u.getAtIndex(g)}function s(f,u){const{voxelManager:g,pixelIndex:d}=a(f);if(!g||d===null)return!1;const h=g.getAtIndex(d),p=!Mn(u,h);return p&&(g.setAtIndex(d,u),!0)}const c=()=>{const{voxelManager:f,pixelIndex:u}=a(0);return!f||u===null?null:f.getConstructor()},l=new Wt(e,{_get:o,_set:s,numberOfComponents:r,_getConstructor:c,_id:"createImageVolumeVoxelManager"});return l.getMiddleSliceData=()=>{const f=Math.floor(e[2]/2);return l.getSliceData({sliceIndex:f,slicePlane:2})},l.clear=()=>{for(const f of n)Me.getImage(f).voxelManager.clear()},l.getRange=()=>{let f=1/0,u=-1/0;for(const g of n){const d=Me.getImage(g);d&&(d.minPixelValue<f&&(f=d.minPixelValue),d.maxPixelValue>u&&(u=d.maxPixelValue))}return f===1/0&&u===-1/0?[0,0]:[f,u]},l._getScalarDataLength=()=>{const{voxelManager:f,pixelIndex:u}=a(0);return!f||u===null?0:f.getScalarDataLength()*e[2]},l.getCompleteScalarDataArray=()=>{const f=l._getConstructor();if(!f)return new Uint8Array(0);const u=l.getScalarDataLength(),g=new f(u),d=e[0]*e[1]*r;for(let h=0;h<e[2];h++){const{voxelManager:p,pixelIndex:m}=a(h*d/r);if(p&&m!==null){const v=h*d,y=p.getScalarData();if(r===1)g.set(y,v);else for(let T=0;T<y.length;T+=r)for(let C=0;C<r;C++)g[v+T+C]=y[T+C]}}return g},l.setCompleteScalarDataArray=f=>{const u=e[0]*e[1]*r,g=l._getConstructor();let d=1/0,h=-1/0;for(let p=0;p<e[2];p++){const{voxelManager:m}=a(p*u/r);if(m&&g){const v=p*u,y=v+u,T=new g(u);T.set(f.subarray(v,y)),m.scalarData=T;for(let x=0;x<T.length;x++){const O=T[x];d=Math.min(d,O),h=Math.max(h,O)}const C=n[p],w=Me.getImage(C);w&&(w.minPixelValue=d,w.maxPixelValue=h)}}for(let p=0;p<e[2];p++)l.modifiedSlices.add(p);l.boundsIJK=[[0,e[0]-1],[0,e[1]-1],[0,e[2]-1]]},l}static createScalarVolumeVoxelManager({dimensions:e,scalarData:n,numberOfComponents:r=1}){if(e.length!==3)throw new Error("Dimensions must be provided as [number, number, number] for [width, height, depth]");if(!r&&(r=n.length/e[0]/e[1]/e[2],r>4||r<1||r===2))throw new Error(`Number of components ${r} must be 1, 3 or 4`);return r>1?Wt._createRGBScalarVolumeVoxelManager({dimensions:e,scalarData:n,numberOfComponents:r}):Wt._createNumberVolumeVoxelManager({dimensions:e,scalarData:n})}static createScalarDynamicVolumeVoxelManager({imageIdGroups:e,dimensions:n,dimensionGroupNumber:r=1,timePoint:i=0,numberOfComponents:a=1}){let o=0;if(r!==void 0?o=r-1:i!==void 0&&(console.warn("Warning: timePoint parameter is deprecated. Please use dimensionGroupNumber instead. timePoint is zero-based while dimensionGroupNumber starts at 1."),o=i),!a){const l=Me.getImage(e[0][0]);if(!l)throw new Error("Unable to determine number of components: No image found");if(a=l.getPixelData().length/(n[0]*n[1]),a>4||a<1||a===2)throw new Error(`Number of components ${a} must be 1, 3 or 4`)}const s=e.map(l=>Wt.createImageVolumeVoxelManager({dimensions:n,imageIds:l,numberOfComponents:a})),c=new Wt(n,{_get:l=>s[o]._get(l),_set:(l,f)=>s[o]._set(l,f),numberOfComponents:a,_id:"createScalarDynamicVolumeVoxelManager"});return c.getScalarDataLength=()=>s[o].getScalarDataLength(),c.getConstructor=()=>s[o].getConstructor(),c.getRange=()=>s[o].getRange(),c.getMiddleSliceData=()=>s[o].getMiddleSliceData(),c.setTimePoint=l=>{console.warn("Warning: setTimePoint is deprecated. Please use setDimensionGroupNumber instead. Note that timePoint is zero-based while dimensionGroupNumber starts at 1."),c.setDimensionGroupNumber(l+1)},c.setDimensionGroupNumber=l=>{o=l-1,c._get=f=>s[o]._get(f),c._set=(f,u)=>s[o]._set(f,u)},c.getAtIndexAndTimePoint=(l,f)=>(console.warn("Warning: getAtIndexAndTimePoint is deprecated. Please use getAtIndexAndDimensionGroup instead. Note that timePoint is zero-based while dimensionGroupNumber starts at 1."),c.getAtIndexAndDimensionGroup(l,f+1)),c.getAtIndexAndDimensionGroup=(l,f)=>s[f-1]._get(l),c.getTimePointScalarData=l=>(console.warn("Warning: getTimePointScalarData is deprecated. Please use getDimensionGroupScalarData instead. Note that timePoint is zero-based while dimensionGroupNumber starts at 1."),c.getDimensionGroupScalarData(l+1)),c.getDimensionGroupScalarData=l=>s[l-1].getCompleteScalarDataArray(),c.getCurrentTimePointScalarData=()=>(console.warn("Warning: getCurrentTimePointScalarData is deprecated. Please use getCurrentDimensionGroupScalarData instead."),c.getCurrentDimensionGroupScalarData()),c.getCurrentDimensionGroupScalarData=()=>s[o].getCompleteScalarDataArray(),c.getCurrentTimePoint=()=>(console.warn("Warning: getCurrentTimePoint is deprecated. Please use getCurrentDimensionGroupNumber instead. Note that timePoint is zero-based while dimensionGroupNumber starts at 1."),o),c.getCurrentDimensionGroupNumber=()=>o+1,c}static createImageVoxelManager({width:e,height:n,scalarData:r,numberOfComponents:i=1}){const a=[e,n,1];if(!i&&(i=r.length/e/n,i>4||i<1||i===2))throw new Error(`Number of components ${i} must be 1, 3 or 4`);return i>1?Wt._createRGBScalarVolumeVoxelManager({dimensions:a,scalarData:r,numberOfComponents:i}):Wt._createNumberVolumeVoxelManager({dimensions:a,scalarData:r})}static _createNumberVolumeVoxelManager({dimensions:e,scalarData:n}){const r=new Wt(e,{_get:i=>n[i],_set:(i,a)=>{const o=n[i]!==a;return n[i]=a,o},_getConstructor:()=>n.constructor,_id:"_createNumberVolumeVoxelManager"});return r.scalarData=n,r.clear=()=>{r.scalarData.fill(0)},r.getMiddleSliceData=()=>{const i=Math.floor(e[2]/2);return r.getSliceData({sliceIndex:i,slicePlane:2})},r}static createMapVoxelManager({dimension:e}){const n=new Map,r=new Wt(e,{_get:n.get.bind(n),_set:(i,a)=>n.set(i,a)&&!0,_id:"createMapVoxelManager"});return r.map=n,r}static createHistoryVoxelManager({sourceVoxelManager:e}){const n=new Map,{dimensions:r}=e,i=new Wt(r,{_get:a=>n.get(a),_set:function(a,o){if(n.has(a))o===n.get(a)&&n.delete(a);else{const s=this.sourceVoxelManager.getAtIndex(a);if(s===o)return!1;n.set(a,s)}this.sourceVoxelManager.setAtIndex(a,o)},_id:"createHistoryVoxelManager"});return i.map=n,i.scalarData=e.scalarData,i.sourceVoxelManager=e,i}static createRLEHistoryVoxelManager(e){const{dimensions:n}=e,r=new nc(n[0],n[1],n[2]),i=new Wt(n,{_get:a=>r.get(a),_set:function(a,o){const s=r.get(a);if(s===void 0){const c=this.sourceVoxelManager.getAtIndex(a);if(c===o||c===void 0&&o===0||o===null)return!1;r.set(a,c??0)}else(o===s||o===null)&&(r.delete(a),o=s);this.sourceVoxelManager.setAtIndex(a,o)},_getScalarData:nc.getScalarData,_updateScalarData:a=>(r.updateScalarData(a),a),_id:"createRLEHistoryVoxelManager"});return i.map=r,i.sourceVoxelManager=e,i}static createLazyVoxelManager({dimensions:e,planeFactory:n}){const r=new Map,[i,a]=e,o=i*a,s=new Wt(e,{_get:c=>r.get(Math.floor(c/o))[c%o],_set:(c,l)=>{const f=Math.floor(c/o);let u=r.get(f);return u||(u=n(i,a),r.set(f,u)),u[c%o]=l,!0},_id:"createLazyVoxelManager"});return s.map=r,s}static createRLEVolumeVoxelManager({dimensions:e}){const[n,r,i]=e,a=new nc(n,r,i),o=new Wt(e,{_get:s=>a.get(s),_set:(s,c)=>(a.set(s,c),!0),_getScalarData:nc.getScalarData,_updateScalarData:s=>(a.updateScalarData(s),s),_id:"createRLEVolumeVoxelManager"});return o.map=a,o.getPixelData=a.getPixelData.bind(a),o}static createRLEImageVoxelManager({dimensions:e}){const[n,r]=e;return Wt.createRLEVolumeVoxelManager({dimensions:[n,r,1]})}static addInstanceToImage(e){const{width:n,height:r}=e,i=e.voxelManager.getScalarData();if(i.length>=n*r){e.voxelManager=Wt.createScalarVolumeVoxelManager({dimensions:[n,r,1],scalarData:i});return}e.voxelManager=Wt.createRLEVolumeVoxelManager({dimensions:[n,r,1]}),e.getPixelData=e.voxelManager.getPixelData,e.sizeInBytes=Aq}}class wd{constructor(e){this._imageIdsIndexMap=new Map,this._imageURIsIndexMap=new Map,this.cornerstoneImageMetaData=null,this.isPreScaled=!1,this.numTimePoints=null,this.numFrames=null;const{imageIds:n,scaling:r,dimensions:i,spacing:a,origin:o,direction:s,dataType:c,volumeId:l,referencedVolumeId:f,metadata:u,referencedImageIds:g,additionalDetails:d,voxelManager:h,numberOfComponents:p}=e;if(!c)throw new Error('Data type is required, please provide a data type as string such as "Uint8Array", "Float32Array", etc.');let{imageData:m}=e;this.imageIds=n,this.volumeId=l,this.metadata=u,this.dimensions=i,this.spacing=a,this.origin=o,this.direction=s,this.dataType=c,this.vtkOpenGLTexture=yj.newInstance(),this.vtkOpenGLTexture.setVolumeId(l),this.voxelManager=h??Wt.createImageVolumeVoxelManager({dimensions:i,imageIds:n,numberOfComponents:p}),this.numVoxels=this.dimensions[0]*this.dimensions[1]*this.dimensions[2],m||(m=v2.newInstance(),m.setDimensions(i),m.setSpacing(a),m.setDirection(s),m.setOrigin(o)),m.set({dataType:c,voxelManager:this.voxelManager,id:l,numberOfComponents:p||1}),m.set({hasScalarVolume:!1}),this.imageData=m,this.numFrames=this._getNumFrames(),this._reprocessImageIds(),r&&(this.scaling=r),f&&(this.referencedVolumeId=f),g&&(this.referencedImageIds=g),d&&(this.additionalDetails=d)}get sizeInBytes(){return this.voxelManager.sizeInBytes}get imageIds(){return this._imageIds}set imageIds(e){this._imageIds=e,this._reprocessImageIds()}_reprocessImageIds(){this._imageIdsIndexMap.clear(),this._imageURIsIndexMap.clear(),this._imageIds.forEach((e,n)=>{const r=gi(e);this._imageIdsIndexMap.set(e,n),this._imageURIsIndexMap.set(r,n)})}isDynamicVolume(){return this.numTimePoints>1}getImageIdIndex(e){return this._imageIdsIndexMap.get(e)}getImageIdByIndex(e){return this._imageIds[e]}getImageURIIndex(e){return this._imageURIsIndexMap.get(e)}load(e){}destroy(){this.imageData.delete(),this.imageData=null,this.voxelManager.clear(),this.vtkOpenGLTexture.releaseGraphicsResources(),this.vtkOpenGLTexture.delete()}invalidate(){for(let e=0;e<this.imageIds.length;e++)this.vtkOpenGLTexture.setUpdatedFrame(e);this.imageData.modified()}modified(){this.imageData.modified(),this.vtkOpenGLTexture.modified(),this.numFrames=this._getNumFrames()}removeFromCache(){Me.removeVolumeLoadObject(this.volumeId)}getScalarDataLength(){return this.voxelManager.getScalarDataLength()}_getNumFrames(){return this.isDynamicVolume()?this.numTimePoints:this.imageIds.length}imageIdIndexToFrameIndex(e){return e%this.numFrames}getCornerstoneImages(){const{imageIds:e}=this;return e.map(n=>Me.getImage(n))}}let xf={};const lc={add:(t,e)=>{lc.addRaw(t,{...e,metadata:structuredClone(e.metadata)})},addRaw:(t,e)=>{const n=e.type;xf[t]||(xf[t]={}),xf[t][n]=e.metadata},get:(t,e)=>{var n;return(n=xf[e])==null?void 0:n[t]},clear:()=>{xf={}}};Qu(lc.get);const wo=new uy("imageLoadPool");wo.grabDelay=0;wo.setMaxSimultaneousRequests(ot.Interaction,1e3);wo.setMaxSimultaneousRequests(ot.Thumbnail,1e3);wo.setMaxSimultaneousRequests(ot.Prefetch,1e3);const yR={};let Fq;function TR(t,e){const n=Me.getImageLoadObject(t);if(n)return u7(n.promise,t),n;const r=t.split(":")[0],i=yR[r]||Fq;if(!i)throw new Error(`loadImageFromImageLoader: No image loader found for scheme '${r}'`);const a=i(t,e);return u7(a.promise,t),a}function u7(t,e){Promise.resolve(t).then(n=>{Uq(n),De(Ee,Oe.IMAGE_LOADED,{image:n})}).catch(n=>{const r={imageId:e,error:n};De(Ee,Oe.IMAGE_LOAD_FAILED,r)})}function Uq(t){if(!t.voxelManager){const{width:e,height:n,numberOfComponents:r}=t,i=Wt.createImageVoxelManager({scalarData:t.getPixelData(),width:e,height:n,numberOfComponents:r});t.voxelManager=i,t.getPixelData=()=>i.getScalarData(),delete t.imageFrame.pixelData}}function Bq(t,e={priority:0,requestType:"prefetch"}){if(t===void 0)throw new Error("loadImage: parameter imageId must not be undefined");return TR(t,e).promise}function Lu(t,e={priority:0,requestType:"prefetch"}){if(t===void 0)throw new Error("loadAndCacheImage: parameter imageId must not be undefined");const n=TR(t,e);return Me.getImageLoadObject(t)||Me.putImageLoadObject(t,n),n.promise}function Gq(t,e={}){var p;if(t===void 0)throw new Error("createAndCacheDerivedImage: parameter imageId must not be undefined");e.imageId===void 0&&(e.imageId=`derived:${In()}`);const{imageId:n,skipCreateBuffer:r,onCacheAdd:i,voxelRepresentation:a}=e,o=Ve("imagePlaneModule",t),s=o.rows*o.columns,{TypedArrayConstructor:c}=cy((p=e.targetBuffer)==null?void 0:p.type,s),l=new c(r?1:s),f=n,u=Ve("imagePlaneModule",t);lc.add(f,{type:"imagePlaneModule",metadata:u});const g=Ve("generalSeriesModule",t);lc.add(f,{type:"generalSeriesModule",metadata:g}),lc.add(f,{type:"generalImageModule",metadata:{instanceNumber:e.instanceNumber}});const d=Ve("imagePixelModule",t);lc.add(f,{type:"imagePixelModule",metadata:{...d,bitsAllocated:8,bitsStored:8,highBit:7,samplesPerPixel:1,pixelRepresentation:0}});const h=wR(n,{scalarData:l,onCacheAdd:i,skipCreateBuffer:r,targetBuffer:{type:l.constructor.name},voxelRepresentation:a,dimensions:[o.columns,o.rows],spacing:[o.columnPixelSpacing,o.rowPixelSpacing],origin:o.imagePositionPatient,direction:o.imageOrientationPatient,frameOfReferenceUID:o.frameOfReferenceUID});return h.referencedImageId=t,Me.getImageLoadObject(n)||Me.putImageSync(n,h),h}function CR(t,e={}){if(t.length===0)throw new Error("createAndCacheDerivedImages: parameter imageIds must be list of image Ids");return t.map((r,i)=>{var o;const a={imageId:((o=e==null?void 0:e.getDerivedImageId)==null?void 0:o.call(e,r))||`derived:${In()}`,...e};return Gq(r,{...a,instanceNumber:i+1})})}function wR(t,e){const{scalarData:n,origin:r,direction:i,targetBuffer:a,skipCreateBuffer:o,onCacheAdd:s,frameOfReferenceUID:c,voxelRepresentation:l}=e,f=e.dimensions,u=e.spacing;if(!f||!u)throw new Error("createAndCacheLocalImage: dimensions and spacing are required");const g=f[0],d=f[1],h=u[0],p=u[1],m={frameOfReferenceUID:c,rows:d,columns:g,imageOrientationPatient:i??[1,0,0,0,1,0],rowCosines:i?i.slice(0,3):[1,0,0],columnCosines:i?i.slice(3,6):[0,1,0],imagePositionPatient:r??[0,0,0],pixelSpacing:[p,h],rowPixelSpacing:p,columnPixelSpacing:h},v=g*d,y=n.length/v;let T;if(n){if(!(n instanceof Uint8Array||n instanceof Float32Array||n instanceof Uint16Array||n instanceof Int16Array))throw new Error("createAndCacheLocalImage: scalarData must be of type Uint8Array, Uint16Array, Int16Array or Float32Array");T=n}else if(!o){const{TypedArrayConstructor:X}=cy(a==null?void 0:a.type,v);T=new X(v)}let C,w,x;if(T instanceof Uint8Array)C=8,w=8,x=7;else if(T instanceof Uint16Array)C=16,w=16,x=15;else if(T instanceof Int16Array)C=16,w=16,x=15;else if(T instanceof Float32Array)C=32,w=32,x=31;else throw new Error("Unsupported scalarData type");const O={samplesPerPixel:1,photometricInterpretation:T.length>f[0]*f[1]?"RGB":"MONOCHROME2",rows:d,columns:g,bitsAllocated:C,bitsStored:w,highBit:x},M={imagePlaneModule:m,imagePixelModule:O};["imagePlaneModule","imagePixelModule"].forEach(X=>{lc.add(t,{type:X,metadata:M[X]||{}})});const A=l===Yp.RLE&&Wt.createRLEImageVoxelManager({dimensions:f})||Wt.createImageVoxelManager({height:d,width:g,numberOfComponents:y,scalarData:T});let _=T[0],k=T[0];for(let X=1;X<T.length;X++)T[X]<_&&(_=T[X]),T[X]>k&&(k=T[X]);const z={imageId:t,intercept:0,windowCenter:0,windowWidth:0,color:O.photometricInterpretation==="RGB",numberOfComponents:O.samplesPerPixel,dataType:a==null?void 0:a.type,slope:1,minPixelValue:_,maxPixelValue:k,rows:O.rows,columns:O.columns,getCanvas:void 0,height:O.rows,width:O.columns,rgba:void 0,columnPixelSpacing:m.columnPixelSpacing,rowPixelSpacing:m.rowPixelSpacing,FrameOfReferenceUID:m.frameOfReferenceUID,invert:!1,getPixelData:()=>A.getScalarData(),voxelManager:A,sizeInBytes:n.byteLength};return s==null||s(z),Me.putImageSync(z.imageId,z),z}function dp(t,e){yR[t]=e}function xR(t,e={}){return CR(t,{...e,targetBuffer:{type:"Uint8Array"}})}function SR(t){const e=t[0],{pixelRepresentation:n,bitsAllocated:r,bitsStored:i,highBit:a,photometricInterpretation:o,samplesPerPixel:s}=Ve("imagePixelModule",e),c=[],l=Ve("voiLutModule",e);let f;if(l){const{windowWidth:y,windowCenter:T}=l;if(f=l==null?void 0:l.voiLUTFunction,Array.isArray(y))for(let C=0;C<y.length;C++)c.push({windowWidth:y[C],windowCenter:T[C]});else c.push({windowWidth:y,windowCenter:T})}else c.push({windowWidth:void 0,windowCenter:void 0});const{modality:u,seriesInstanceUID:g}=Ve("generalSeriesModule",e),{imageOrientationPatient:d,pixelSpacing:h,frameOfReferenceUID:p,columns:m,rows:v}=Ve("imagePlaneModule",e);return{BitsAllocated:r,BitsStored:i,SamplesPerPixel:s,HighBit:a,PhotometricInterpretation:o,PixelRepresentation:n,Modality:u,ImageOrientationPatient:d,PixelSpacing:h,FrameOfReferenceUID:p,Columns:m,Rows:v,voiLut:c,VOILUTFunction:f,SeriesInstanceUID:g}}function ER(t,e){const{imagePositionPatient:n,imageOrientationPatient:r}=Ve("imagePlaneModule",t[0]);if(!e){const h=Cn(r[0],r[1],r[2]),p=Cn(r[3],r[4],r[5]);e=Le(),an(e,h,p)}const i=Le(),a=t[0].split(":")[0]==="wadouri";bt(i,n[0],n[1],n[2]);let o,s;function c(h){const{imagePositionPatient:p}=Ve("imagePlaneModule",h),m=Le();return _n(m,n,p),Qe(m,e)}if(a){const h=[t[0],t[Math.floor(t.length/2)]];o=t;const p=c(h[0]),m=c(h[1]);p-m<0&&o.reverse();const v=Ve("imagePlaneModule",h[1]);if(!v)throw new Error("Incomplete metadata required for volume construction.");const y=Le();_n(y,n,v.imagePositionPatient);const T=Qe(y,e);s=Math.abs(T)/Math.floor(t.length/2)}else{const h=t.map(m=>({distance:c(m),imageId:m}));h.sort((m,v)=>v.distance-m.distance),o=h.map(m=>m.imageId);const p=h.length;s=Math.abs(h[p-1].distance-h[0].distance)/(p-1)}const{imagePositionPatient:l,sliceThickness:f,spacingBetweenSlices:u}=Ve("imagePlaneModule",o[0]),{strictZSpacingForVolumeViewport:g}=gy().rendering;return s===0&&!g&&(u?(console.log("Could not calculate zSpacing. Using spacingBetweenSlices"),s=u):f?(console.log("Could not calculate zSpacing and no spacingBetweenSlices. Using sliceThickness"),s=f):(console.log("Could not calculate zSpacing. The VolumeViewport visualization is compromised. Setting zSpacing to 1 to render"),s=1)),{zSpacing:s,origin:l,sortedImageIds:o}}function OR(t){const e=Ve("modalityLutModule",t)||{},n=Ve("generalSeriesModule",t)||{},{modality:r}=n,i={rescaleSlope:e.rescaleSlope||1,rescaleIntercept:e.rescaleIntercept??0,modality:r},a=Ve("scalingModule",t)||{};return{...i,...r==="PT"&&{suvbw:a.suvbw,suvbsa:a.suvbsa,suvlbm:a.suvlbm}}}const Ey=t=>Object.values(t).some(n=>typeof n=="number"&&!Number.isInteger(n)),f7={Uint8Array:"Uint8Array",Int16Array:"Int16Array",Uint16Array:"Uint16Array",Float32Array:"Float32Array"};function Oy(t,e){const n=SR(t),{ImageOrientationPatient:r,PixelSpacing:i,Columns:a,Rows:o}=n,s=Cn(r[0],r[1],r[2]),c=Cn(r[3],r[4],r[5]),l=Le();an(l,s,c);const{zSpacing:f,origin:u,sortedImageIds:g}=ER(t,l),d=t.length,h=[i[1],i[0],f],p=[a,o,d].map(v=>Math.floor(v)),m=[...s,...c,...l];return{dimensions:p,spacing:h,origin:u,dataType:$q(g,n),direction:m,metadata:n,imageIds:g,volumeId:e,voxelManager:null,numberOfComponents:n.PhotometricInterpretation==="RGB"?3:1}}function $q(t,e){const{BitsAllocated:n,PixelRepresentation:r}=e,i=r===1,a=Wq(t);if(a)return a;const[o,s,c]=[0,Math.floor(t.length/2),t.length-1],l=[o,s,c].map(d=>OR(t[d])),f=l.some(d=>d.rescaleIntercept<0||d.rescaleSlope<0),u=l.some(d=>Ey(d)),g=fy();switch(n){case 8:return"Uint8Array";case 16:return g&&u?"Float32Array":i||f?"Int16Array":!i&&!f?"Uint16Array":"Float32Array";case 24:return"Uint8Array";case 32:return"Float32Array";default:throw new Error(`Bits allocated of ${n} is not defined to generate scalarData for the volume.`)}}function Wq(t){const n=[0,Math.floor(t.length/2),t.length-1].map(i=>Me.getImage(t[i]));if(!n.every(Boolean))return null;const r=n[0].getPixelData().constructor.name;return n.every(i=>i.getPixelData().constructor.name===r)&&r in f7?f7[r]:null}let Sh=class DR{constructor(e){this.name=e||"unknown"}static as(e){if(e.iterator)return e.iterator;const n=new DR("as iterator");return e.then(r=>{try{n.add(r,!0)}catch(i){n.reject(i)}},r=>{n.reject(r)}),n}add(e,n=!1){this.nextValue=e,this.done||(this.done=n),this.waiting&&(this.waiting.resolve(e),this.waiting=void 0)}resolve(){this.done=!0,this.waiting&&(this.waiting.resolve(this.nextValue),this.waiting=void 0)}reject(e){var n;this.rejectReason=e,(n=this.waiting)==null||n.reject(e)}getRecent(){if(this.rejectReason)throw this.rejectReason;return this.nextValue}async*[Symbol.asyncIterator](){for(;!this.done;){if(this.rejectReason)throw this.rejectReason;if(this.nextValue!==void 0&&(yield this.nextValue,this.done))break;this.waiting||(this.waiting={},this.waiting.promise=new Promise((e,n)=>{this.waiting.resolve=e,this.waiting.reject=n})),await this.waiting.promise}yield this.nextValue}async forEach(e,n){let r=0;try{for await(const i of this){const{done:a}=this;try{await e(i,a,r),r++}catch(o){if(!a){console.warn("Caught exception in intermediate value",o);continue}if(n)n(o,a);else throw o}}}catch(i){if(n)n(i,!0);else throw i}}generate(e,n){return e(this,this.reject.bind(this)).then(()=>{this.done||this.resolve()},r=>{this.reject(r),n?n(r):console.warn("Couldn't process because",r)})}async nextPromise(){for await(const e of this)if(e)return e;return this.nextValue}async donePromise(){for await(const e of this);return this.nextValue}getNextPromise(){const e=this.nextPromise();return e.iterator=this,e}getDonePromise(){const e=this.donePromise();return e.iterator=this,e}};const El=new Map,g7="imageRetrieveConfiguration",jg={IMAGE_RETRIEVE_CONFIGURATION:g7,clear:()=>{El.clear()},add:(t,e)=>{El.set(t,e)},clone:()=>new Map(El),restore:t=>{El.clear(),t.forEach((e,n)=>{El.set(n,e)})},get:(t,...e)=>{if(t===g7)return e.map(n=>El.get(n)).find(n=>n!==void 0)}};Qu(jg.get.bind(jg));function Dy(t){const e=Do(),n=[];return e.forEach(r=>{const a=r.getVolumeViewports().filter(o=>o.hasVolumeId(t));n.push(...a)}),n}const H3=t=>{const e=zq(t);e!=null&&e.length&&e.forEach(({renderingEngine:n,viewportIds:r})=>{n.hasBeenDestroyed||n.renderViewports(r)})};function zq(t){const e=Do(),n=[];return e.forEach(r=>{const i=Dy(t);i.length&&n.push({renderingEngine:r,viewportIds:i.map(a=>a.id)})}),n}const d7=[{id:"initialImages",retrieveType:"single"}],jq=[{id:"lossySequential",retrieveType:"singleFast"},{id:"finalSequential",retrieveType:"singleFinal"}],W5=[{offset:-1,imageQualityStatus:Wi.ADJACENT_REPLICATE},{offset:1,imageQualityStatus:Wi.ADJACENT_REPLICATE},{offset:2,imageQualityStatus:Wi.FAR_REPLICATE}],Hq=[{id:"initialImages",positions:[.5,0,-1],retrieveType:"default",requestType:ot.Thumbnail,priority:5,nearbyFrames:W5},{id:"quarterThumb",decimate:4,offset:3,requestType:ot.Thumbnail,retrieveType:"multipleFast",priority:6,nearbyFrames:W5},{id:"halfThumb",decimate:4,offset:1,priority:7,requestType:ot.Thumbnail,retrieveType:"multipleFast",nearbyFrames:W5},{id:"quarterFull",decimate:4,offset:2,priority:8,requestType:ot.Thumbnail,retrieveType:"multipleFinal"},{id:"halfFull",decimate:4,offset:0,priority:9,requestType:ot.Thumbnail,retrieveType:"multipleFinal"},{id:"threeQuarterFull",decimate:4,offset:1,priority:10,requestType:ot.Thumbnail,retrieveType:"multipleFinal"},{id:"finalFull",decimate:4,offset:3,priority:11,requestType:ot.Thumbnail,retrieveType:"multipleFinal"},{id:"errorRetrieve"}];function RR(t,e,n=0){const r=[];for(let i=n;i<t.length;i+=e)r.push(i);return r}function Kq(t,e,n){var r;if((r=e==null?void 0:e.nearbyRequests)!=null&&r.length)for(const i of e.nearbyRequests)try{const{itemId:a,imageQualityStatus:o}=i,s=Me.getImageQuality(a);if(s!==void 0&&s>=o)continue;const c={...n,imageId:a,imageQualityStatus:o};Me.setPartialImage(a,c),t.successCallback(a,c)}catch(a){console.warn("Couldn't fill nearby item ",i.itemId,a)}}const Yl=class Yl{constructor(e){this.stages=e.stages||d7,this.retrieveOptions=e.retrieveOptions||{}}loadImages(e,n){return new qq(this,e,n).loadImages()}};Yl.createProgressive=MR,Yl.interleavedRetrieveStages={stages:Hq},Yl.singleRetrieveStages={stages:d7},Yl.sequentialRetrieveStages={stages:jq};let Eh=Yl;class qq{constructor(e,n,r){this.outstandingRequests=0,this.stageStatusMap=new Map,this.displayedIterator=new Sh("displayed"),this.stages=e.stages,this.retrieveOptions=e.retrieveOptions,this.imageIds=n,this.listener=r}async loadImages(){const e=this.createStageRequests();this.outstandingRequests=e.length;for(const n of e)this.addRequest(n);return this.outstandingRequests===0?Promise.resolve(null):this.displayedIterator.getDonePromise()}sendRequest(e,n){const{imageId:r,next:i}=e,a=(f,u)=>{this.listener.errorCallback(r,c||!i,f),u&&this.updateStageStatus(e.stage,f)},o=(n.loader||Lu)(r,n),s=Sh.as(o);let c=!1;return s.forEach(async(f,u)=>{const g=Me.getImageQuality(r);if(!f){console.warn("No image retrieved",r);return}const{imageQualityStatus:d}=f;if(c||(c=d===Wi.FULL_RESOLUTION),g!==void 0&&g>d){this.updateStageStatus(e.stage,null,!0);return}this.listener.successCallback(r,f),this.displayedIterator.add(f),u&&this.updateStageStatus(e.stage),Kq(this.listener,e,f)},a).finally(()=>{if(!c&&i)Me.setPartialImage(r),this.addRequest(i,n.streamingData);else{c||this.listener.errorCallback(r,!0,"Couldn't decode"),this.outstandingRequests--;for(let f=i;f;f=f.next)this.updateStageStatus(f.stage,null,!0)}this.outstandingRequests<=0&&this.displayedIterator.resolve()}),s.getDonePromise().catch(f=>null)}addRequest(e,n={}){const{imageId:r,stage:i}=e,a=this.listener.getLoaderImageOptions(r);if(!a)return;const{retrieveType:o="default"}=i,{retrieveOptions:s}=this,c=s[o]||s.default,l={...a,retrieveType:o,retrieveOptions:c,streamingData:n},f=i.priority??-5,u=i.requestType||ot.Interaction,g={imageId:r};wo.addRequest(this.sendRequest.bind(this,e,l),u,g,f)}updateStageStatus(e,n,r=!1){const{id:i}=e,a=this.stageStatusMap.get(i);if(a&&(a.imageLoadPendingCount--,n?a.imageLoadFailedCount++:r||a.totalImageCount++,!r&&!a.stageStartTime&&(a.stageStartTime=Date.now()),!a.imageLoadPendingCount)){const{imageLoadFailedCount:o,totalImageCount:s,stageStartTime:c=Date.now(),startTime:l}=a,f={stageId:i,numberOfFailures:o,numberOfImages:s,stageDurationInMS:c?Date.now()-c:null,startDurationInMS:Date.now()-l};De(Ee,Oe.IMAGE_RETRIEVAL_STAGE,f),this.stageStatusMap.delete(i)}}createStageRequests(){const e=new Array,n=new Map,r=(i,a)=>{const o=a<0?this.imageIds.length+a:a<1?Math.floor((this.imageIds.length-1)*a):a,s=this.imageIds[o];if(!s)throw new Error(`No value found to add to requests at ${a}`);const c={imageId:s,stage:i,index:o,nearbyRequests:this.findNearbyRequests(o,i)};this.addStageStatus(i);const l=n.get(s);l?l.next=c:e.push(c),n.set(s,c)};for(const i of this.stages)(i.positions||RR(this.imageIds,i.decimate||1,i.offset??0)).forEach(o=>{r(i,o)});return e}findNearbyRequests(e,n){const r=new Array;if(!n.nearbyFrames)return r;for(const i of n.nearbyFrames){const a=e+i.offset;a<0||a>=this.imageIds.length||r.push({itemId:this.imageIds[a],imageQualityStatus:i.imageQualityStatus,index:a})}return r}addStageStatus(e){const{id:n}=e,r=this.stageStatusMap.get(n)||{stageId:n,startTime:Date.now(),stageStartTime:null,totalImageCount:0,imageLoadFailedCount:0,imageLoadPendingCount:0};return r.imageLoadPendingCount++,this.stageStatusMap.set(n,r),r}}function MR(t){return new Eh(t)}const p7=ot.Prefetch;class Xq extends wd{constructor(e,n){super(e),this.framesLoaded=0,this.framesProcessed=0,this.framesUpdated=0,this.autoRenderOnLoad=!0,this.cachedFrames=[],this.reRenderTarget=0,this.reRenderFraction=2,this.imagesLoader=this,this.cancelLoading=()=>{const{loadStatus:r}=this;if(!r||!r.loading)return;r.loading=!1,r.cancelled=!0,this.clearLoadCallbacks();const i=({additionalDetails:a})=>a.volumeId!==this.volumeId;wo.filterRequests(i)},this.loadStatus=n.loadStatus}invalidateVolume(e){const{vtkOpenGLTexture:n}=this,{numFrames:r}=this;for(let i=0;i<r;i++)n.setUpdatedFrame(i);this.modified(),e&&H3(this.volumeId)}clearLoadCallbacks(){this.loadStatus.callbacks=[]}callLoadStatusCallback(e){const{framesUpdated:n,framesProcessed:r,totalNumFrames:i}=e,{volumeId:a,reRenderFraction:o,loadStatus:s,metadata:c}=this,{FrameOfReferenceUID:l}=c;if(this.autoRenderOnLoad&&(n>this.reRenderTarget||r===i)&&(this.reRenderTarget+=o,H3(a)),r===i){s.callbacks.forEach(u=>u(e));const f={FrameOfReferenceUID:l,volumeId:a};De(Ee,Oe.IMAGE_VOLUME_LOADING_COMPLETED,f)}}updateTextureAndTriggerEvents(e,n,r=Wi.FULL_RESOLUTION){const i=this.imageIdIndexToFrameIndex(e),{cachedFrames:a,numFrames:o,totalNumFrames:s}=this,{FrameOfReferenceUID:c}=this.metadata;if(a[i]>r||a[i]===Wi.FULL_RESOLUTION)return;const f=r===Wi.FULL_RESOLUTION;a[e]=r,this.framesUpdated++,f&&(this.framesLoaded++,this.framesProcessed++);const u={FrameOfReferenceUID:c,volumeId:this.volumeId,numberOfFrames:o,framesProcessed:this.framesProcessed};De(Ee,Oe.IMAGE_VOLUME_MODIFIED,u),f&&this.framesProcessed===this.totalNumFrames&&(this.loadStatus.loaded=!0,this.loadStatus.loading=!1),this.callLoadStatusCallback({success:!0,imageIdIndex:e,imageId:n,framesLoaded:this.framesLoaded,framesProcessed:this.framesProcessed,framesUpdated:this.framesUpdated,numFrames:o,totalNumFrames:s,complete:f,imageQualityStatus:r}),this.vtkOpenGLTexture.setUpdatedFrame(i),this.loadStatus.loaded&&(this.loadStatus.callbacks=[])}successCallback(e,n){const r=this.getImageIdIndex(e),{imageQualityStatus:i}=n;if(this.loadStatus.cancelled){console.warn("volume load cancelled, returning for imageIdIndex: ",r);return}this.updateTextureAndTriggerEvents(r,e,i),this.isDynamicVolume()&&this.checkDimensionGroupCompletion(r)}errorCallback(e,n,r){if(!n)return;const{totalNumFrames:i,numFrames:a}=this,o=this.getImageIdIndex(e);this.framesProcessed++,this.framesProcessed===i&&(this.loadStatus.loaded=!0,this.loadStatus.loading=!1),this.callLoadStatusCallback({success:!1,imageId:e,imageIdIndex:o,error:r,framesLoaded:this.framesLoaded,framesProcessed:this.framesProcessed,framesUpdated:this.framesUpdated,numFrames:a,totalNumFrames:i}),this.loadStatus.loaded&&(this.loadStatus.callbacks=[]);const s={error:r,imageIdIndex:o,imageId:e};De(Ee,Oe.IMAGE_LOAD_ERROR,s)}load(e){const{imageIds:n,loadStatus:r,numFrames:i}=this,{transferSyntaxUID:a}=Ve("transferSyntax",n[0])||{},o=Ve(jg.IMAGE_RETRIEVE_CONFIGURATION,this.volumeId,a,"volume");if(this.imagesLoader=this.isDynamicVolume()?this:o?(o.create||Eh.createProgressive)(o):this,r.loading===!0)return;const{loaded:s}=this.loadStatus,c=n.length;if(s){e&&e({success:!0,framesLoaded:c,framesProcessed:c,numFrames:i,totalNumFrames:c});return}e&&this.loadStatus.callbacks.push(e),this._prefetchImageIds()}getLoaderImageOptions(e){const{transferSyntaxUID:n}=Ve("transferSyntax",e)||{},r=Ve("imagePlaneModule",e)||{},{rows:i,columns:a}=r,o=this.getImageIdIndex(e),s=Ve("modalityLutModule",e)||{},c=Ve("generalSeriesModule",e)||{},l={rescaleSlope:s.rescaleSlope,rescaleIntercept:s.rescaleIntercept,modality:c.modality};if(l.modality==="PT"){const d=Ve("scalingModule",e);d&&(this._addScalingToVolume(d),l.suvbw=d.suvbw)}const f=Ey(l),u=fy();if(this.isPreScaled=!0,l&&l.rescaleSlope!==void 0&&l.rescaleIntercept!==void 0){const{rescaleSlope:d,rescaleIntercept:h}=l;this.isPreScaled=typeof d=="number"&&typeof h=="number"}return!u&&f&&(this.isPreScaled=!1),{targetBuffer:{type:this.dataType,rows:i,columns:a},allowFloatRendering:u,preScale:{enabled:this.isPreScaled,scalingParameters:l},transferPixelData:!0,requestType:p7,transferSyntaxUID:n,additionalDetails:{imageId:e,imageIdIndex:o,volumeId:this.volumeId}}}callLoadImage(e,n,r){const{cachedFrames:i}=this;if(i[n]===Wi.FULL_RESOLUTION)return;const a=s=>{const{image:c}=s.detail;c.imageId===e&&(this.vtkOpenGLTexture.setUpdatedFrame(n),Ee.removeEventListener(Oe.IMAGE_CACHE_IMAGE_ADDED,a))};return Ee.addEventListener(Oe.IMAGE_CACHE_IMAGE_ADDED,a),Sh.as(Lu(e,r)).forEach(s=>{this.successCallback(e,s)},this.errorCallback.bind(this,n,e))}getImageIdsRequests(e,n){this.totalNumFrames=this.imageIds.length;const r=2;return this.autoRenderOnLoad&&(this.reRenderFraction=this.totalNumFrames*(r/100),this.reRenderTarget=this.reRenderFraction),e.map(a=>{const o=this.getImageIdIndex(a),s=p7,c=n,l=this.getLoaderImageOptions(a);return{callLoadImage:this.callLoadImage.bind(this),imageId:a,imageIdIndex:o,options:l,priority:c,requestType:s,additionalDetails:{volumeId:this.volumeId}}})}getImageLoadRequests(e){throw new Error("Abstract method")}getImageIdsToLoad(){throw new Error("Abstract method")}loadImages(){return this.loadStatus.loading=!0,this.getImageLoadRequests(5).reverse().forEach(n=>{if(!n)return;const{callLoadImage:r,imageId:i,imageIdIndex:a,options:o,priority:s,requestType:c,additionalDetails:l}=n;wo.addRequest(r.bind(this,i,a,o),c,l,s)}),Promise.resolve(!0)}_prefetchImageIds(){this.loadStatus.loading=!0;const e=[...this.getImageIdsToLoad()];this.totalNumFrames=this.imageIds.length;const n=2;return this.autoRenderOnLoad&&(this.reRenderFraction=this.totalNumFrames*(n/100),this.reRenderTarget=this.reRenderFraction),this.imagesLoader.loadImages(e,this).catch(r=>{console.debug("progressive loading failed to complete",r)})}_addScalingToVolume(e){if(this.scaling)return;const{suvbw:n,suvlbm:r,suvbsa:i}=e,a={};r&&(a.suvbwToSuvlbm=r/n),i&&(a.suvbwToSuvbsa=i/n),n&&(a.suvbw=n),this.scaling={PT:a}}checkDimensionGroupCompletion(e){}}class Yq extends Xq{constructor(e,n){e.imageIds||(e.imageIds=n.imageIds),super(e,n),this.getImageIdsToLoad=()=>{const{imageIds:r}=this;return this.numFrames=r.length,r}}getScalarData(){return this.voxelManager.getScalarData()}getImageLoadRequests(e){const{imageIds:n}=this;return this.getImageIdsRequests(n,e)}}function _R(t,e){if(!e||!e.imageIds||!e.imageIds.length)throw new Error("ImageIds must be provided to create a streaming image volume");async function n(){if(e.imageIds[0].split(":")[0]==="wadouri"){const[h,p]=[Math.floor(e.imageIds.length/2),e.imageIds.length-1],m=[0,h,p];await Promise.all(m.map(v=>Me.isLoaded(e.imageIds[v])?Promise.resolve(!0):new Promise((y,T)=>{const C=e.imageIds[v];wo.addRequest(async()=>{Bq(C).then(()=>{console.log(`Prefetched imageId: ${C}`),y(!0)}).catch(w=>{T(w)})},ot.Prefetch,{volumeId:t},1)}))).catch(console.error)}const i=Oy(e.imageIds,t),{dimensions:a,spacing:o,origin:s,direction:c,metadata:l,imageIds:f,dataType:u,numberOfComponents:g}=i;return new Yq({volumeId:t,metadata:l,dimensions:a,spacing:o,origin:s,direction:c,imageIds:f,dataType:u,numberOfComponents:g},{imageIds:f,loadStatus:{loaded:!1,loading:!1,cancelled:!1,cachedFrames:[],callbacks:[]}})}const r=n();return{promise:r,decache:()=>{r.then(i=>{i.destroy(),i=null})},cancel:()=>{r.then(i=>{i.cancelLoading()})}}}const bR={};let cu=_R;function LR(t,e){const n=t.indexOf(":"),r=t.substring(0,n);let i=bR[r];if(i==null){if(cu==null||typeof cu!="function")throw new Error(`No volume loader for scheme ${r} has been registered`);i=cu}const a=i(t,e);return a.promise.then(function(o){De(Ee,Oe.VOLUME_LOADED,{volume:o})},function(o){const s={volumeId:t,error:o};De(Ee,Oe.VOLUME_LOADED_FAILED,s)}),a}function IR(t,e={imageIds:[]}){if(t===void 0)throw new Error("loadVolume: parameter volumeId must not be undefined");let n=Me.getVolumeLoadObject(t);return n!==void 0?n.promise:(n=LR(t,e),n.promise.then(r=>r))}async function VR(t,e){if(t===void 0)throw new Error("createAndCacheVolume: parameter volumeId must not be undefined");let n=Me.getVolumeLoadObject(t);return n!==void 0||(n=LR(t,e),Me.putVolumeLoadObject(t,n)),n.promise}function Zq(t,e){const n=Me.getVolume(t);if(!n)throw new Error(`Cannot created derived volume: Referenced volume with id ${t} does not exist.`);let{volumeId:r}=e;const{voxelRepresentation:i}=e;r===void 0&&(r=In());const{metadata:a,dimensions:o,spacing:s,origin:c,direction:l}=n,f=n.isDynamicVolume()?n.getCurrentDimensionGroupImageIds():n.imageIds??[],u=CR(f,{targetBuffer:e.targetBuffer,voxelRepresentation:i}),g=u[0].dataType,d=u.map(p=>p.imageId),h=new wd({volumeId:r,dataType:g,metadata:structuredClone(a),dimensions:[o[0],o[1],o[2]],spacing:s,origin:c,direction:l,referencedVolumeId:t,imageIds:d,referencedImageIds:n.imageIds??[]});return Me.putVolumeSync(r,h),h}async function Ry(t,e){if(e===void 0)throw new Error("createAndCacheVolumeFromImages: parameter imageIds must not be undefined");if(t===void 0)throw new Error("createAndCacheVolumeFromImages: parameter volumeId must not be undefined");const n=Me.getVolume(t);return n||(e.filter(a=>!Me.getImage(a)).length===0?Qq(t,e):await VR(t,{imageIds:e}))}function Qq(t,e){if(e===void 0)throw new Error("createAndCacheVolumeFromImagesSync: parameter imageIds must not be undefined");if(t===void 0)throw new Error("createAndCacheVolumeFromImagesSync: parameter volumeId must not be undefined");const n=Me.getVolume(t);if(n)return n;const r=Oy(e,t),i=new wd({volumeId:t,dataType:r.dataType,metadata:structuredClone(r.metadata),dimensions:r.dimensions,spacing:r.spacing,origin:r.origin,direction:r.direction,referencedVolumeId:r.referencedVolumeId,imageIds:r.imageIds,referencedImageIds:r.referencedImageIds});return Me.putVolumeSync(t,i),i}function Jq(t,e={}){const{metadata:n,dimensions:r,spacing:i,origin:a,direction:o,scalarData:s,targetBuffer:c,preventCache:l=!1}=e,f=Me.getVolume(t);if(f)return f;const u=r[0]*r[1],g=s?s.constructor.name:(c==null?void 0:c.type)??"Float32Array",d=u*r[2];let h;switch(g){case"Uint8Array":case"Int8Array":h=d;break;case"Uint16Array":case"Int16Array":h=d*2;break;case"Float32Array":h=d*4;break}if(!Me.isCacheable(h))throw new Error(`Cannot created derived volume: Volume with id ${t} is not cacheable.`);const m=[];for(let T=0;T<r[2];T++){const C=`${t}_slice_${T}`;m.push(C);const w=s.subarray(T*u,(T+1)*u);wR(C,{scalarData:w,dimensions:[r[0],r[1]],spacing:[i[0],i[1]],origin:a,direction:o,targetBuffer:{type:g}})}const v=new wd({volumeId:t,metadata:structuredClone(n),dimensions:[r[0],r[1],r[2]],spacing:i,origin:a,direction:o,imageIds:m,dataType:g}),y=Wt.createImageVolumeVoxelManager({imageIds:m,dimensions:r,numberOfComponents:1});return v.voxelManager=y,l||Me.putVolumeSync(t,v),v}function eX(){return Object.keys(bR)}function tX(t){const e=cu;return cu=t,e}function nX(){return cu.name}function PR(t,e={}){return Zq(t,{...e,targetBuffer:{type:"Uint8Array",...e==null?void 0:e.targetBuffer}})}function rX(t,e){const n=gj.newInstance();gy().rendering.preferSizeOverAccuracy&&n.setPreferSizeOverAccuracy(!0),n.setInputData(t);const r=t.getSpacing(),i=(r[0]+r[1]+r[2])/6;return n.setMaximumSamplesPerRay(4e3),n.setSampleDistance(i),n.setScalarTexture(e),n}function iX(t){const e=kD.newInstance();e.setBlendMode(t.getBlendMode());const n=t.getInputData(),{voxelManager:r}=n.get("voxelManager"),i=r.getCompleteScalarDataArray(),a=nt.newInstance({name:"Pixels",values:i});return n.getPointData().setScalars(a),e.setInputData(n),e.setMaximumSamplesPerRay(t.getMaximumSamplesPerRay()),e.setSampleDistance(t.getSampleDistance()),e}const aX=0,oX=ot.Prefetch;async function My(t,e){let n=cX(e);!n&&e.imageIds.length&&(n=await lX(e),n=sX(e,n)),!(n.lower===0&&n.upper===0||n.lower===void 0||n.upper===void 0)&&t.getProperty().getRGBTransferFunction(0).setMappingRange(n.lower,n.upper)}function sX(t,e){const n=t.imageIds,r=Math.floor(n.length/2),i=n[r],a=Ve("generalSeriesModule",i)||{};return uX(a.modality,t)?{lower:0,upper:5}:e}function cX(t){const{imageIds:e,metadata:n}=t;let r;if(e!=null&&e.length){const i=Math.floor(e.length/2),a=e[i],o=Ve("voiLutModule",a);if(o&&o.windowWidth&&o.windowCenter){o!=null&&o.voiLUTFunction&&(r={},r.voiLUTFunction=o==null?void 0:o.voiLUTFunction);const{windowWidth:s,windowCenter:c}=o,l=Array.isArray(s)?s[0]:s,f=Array.isArray(c)?c[0]:c;l!==0&&(r={windowWidth:l,windowCenter:f})}}else r=n.voiLut[0];if(r&&(r.windowWidth!==0||r.windowCenter!==0)){const{lower:i,upper:a}=cg(Number(r.windowWidth),Number(r.windowCenter),r.voiLUTFunction);return{lower:i,upper:a}}}async function lX(t){var d;const{imageIds:e}=t,n=Math.floor(e.length/2),r=t.imageIds[n],i=Ve("generalSeriesModule",r)||{},{modality:a}=i,o=Ve("modalityLutModule",r)||{},s={rescaleSlope:o.rescaleSlope,rescaleIntercept:o.rescaleIntercept,modality:a};let c;if(a==="PT"){const h=Ve("scalingModule",r);h&&(c={...s,suvbw:h.suvbw})}const l={priority:aX,requestType:oX,preScale:{scalingParameters:c}};let f=Me.getImage(r);(d=t.referencedImageIds)!=null&&d.length||(f=await Lu(r,{...l,ignoreCache:!0}));let{min:u,max:g}=f.voxelManager.getMinMax();return(u==null?void 0:u.length)>1&&(u=Math.min(...u),g=Math.max(...g)),{lower:u,upper:g}}function uX(t,e){var n;return!(t!=="PT"||!e.isPreScaled||!((n=e.scaling)!=null&&n.PT.suvbw))}async function K3(t,e,n,r=!1){const{volumeId:i,callback:a,blendMode:o}=t,s=await IR(i);if(!s)throw new Error(`imageVolume with id: ${s.volumeId} does not exist`);const{imageData:c,vtkOpenGLTexture:l}=s,f=rX(c,l);o&&f.setBlendMode(o);const u=oH.newInstance();u.setMapper(f);const{numberOfComponents:g}=c.get("numberOfComponents");return u.getProperty().set({viewportId:n}),g===3&&u.getProperty().setIndependentComponents(!1),await My(u,s),a&&a({volumeActor:u,volumeId:i}),r||fX(e,n,u,i),u}function fX(t,e,n,r){const i=n.getProperty().getRGBTransferFunction(0).getRange(),a={viewportId:e,range:{lower:i[0],upper:i[1]},volumeId:r};De(t,Oe.VOI_MODIFIED,a)}const ef=t=>{const e="volumeId:",n=t.includes(e)?t.substring(e.length):t,r=n.indexOf("sliceIndex=");return r===-1?n:n.substring(0,r-1)},gX=1+mo,dX=(t,e)=>e===t.substring(0,Math.min(t.length,e.length)),h7=t=>!!eX().find(e=>dX(t.volumeId,e));function xd(t,e,n,r=!1){const{viewPlaneNormal:i}=e,a=t.getActors();if(!a.length)return{spacingInNormalDirection:null,imageVolume:null,actorUID:null};const o=a.map(l=>{const f=l.referencedId??l.uid;return Me.getVolume(f)}).filter(l=>!!l);if(n){const l=ef(n),f=o.findIndex(h=>l.includes(h.volumeId)),u=o[f],{uid:g}=a[f],d=m7(u,i,t,r);return{imageVolume:u,spacingInNormalDirection:d,actorUID:g}}if(!o.length)return{spacingInNormalDirection:null,imageVolume:null,actorUID:null};const s={spacingInNormalDirection:1/0,imageVolume:null,actorUID:null},c=o.find(h7);for(let l=0;l<o.length;l++){const f=o[l];if(c&&!h7(f))continue;const u=m7(f,i,t);u*gX<s.spacingInNormalDirection&&(s.spacingInNormalDirection=u,s.imageVolume=f,s.actorUID=a[l].uid)}return s}function m7(t,e,n,r=!1){const{slabThickness:i}=n.getProperties();let a=i;return(!i||!r)&&(a=Td(t,e)),a}function Oh(t){const e=t.getCamera(),{spacingInNormalDirection:n,imageVolume:r}=xd(t,e);if(!r)return;const{viewPlaneNormal:i,focalPoint:a}=e,o=t.getActors().find(h=>h.referencedId===r.volumeId||h.uid===r.volumeId);o||console.warn("No actor found for with actorUID of",r.volumeId);const s=o.actor,c=E2(s,i,a),{min:l,max:f,current:u}=c,g=Math.round((f-l)/n)+1;let d=(u-l)/(f-l)*g;return d=Math.floor(d),d>g-1?d=g-1:d<0&&(d=0),{numberOfSlices:g,imageIndex:d}}const zl={};function pX(t){zl[t]!==void 0&&delete zl[t]}function hX(t){const{renderingEngineId:e,viewportId:n}=t.detail,i=dl(e).getViewport(n);if(!("setVolumes"in i))throw new Error("volumeNewImageEventDispatcher: viewport does not have setVolumes method");zl[i.id]===void 0&&(zl[i.id]=0);const a=Oh(i);if(!a){console.warn(`volumeNewImageEventDispatcher: sliceData is undefined for viewport ${i.id}`);return}const{numberOfSlices:o,imageIndex:s}=a;if(zl[i.id]===s)return;zl[i.id]=s;const c={imageIndex:s,viewportId:n,renderingEngineId:e,numberOfSlices:o};De(i.element,Oe.VOLUME_NEW_IMAGE,c)}function NR(t,e,n){const[r,i,a]=t,[o,s,c]=e,[l,f,u,g]=n,d=o-r,h=s-i,p=c-a,m=-1*(l*r+f*i+u*a-g)/(l*d+f*h+u*p),v=d*m+r,y=h*m+i,T=p*m+a;return[v,y,T]}function kR(t,e,n=!1){const[r,i,a]=t,o=r*e[0]+i*e[1]+a*e[2];if(n){const s=Math.sqrt(r*r+i*i+a*a);return[r/s,i/s,a/s,o/s]}return[r,i,a,o]}function mX(t,e,n){const[r,i,a,o]=t,[s,c,l,f]=e,[u,g,d,h]=n,p=Ff(r,s,u,i,c,g,a,l,d),m=Ff(o,f,h,i,c,g,a,l,d),v=Ff(r,s,u,o,f,h,a,l,d),y=Ff(r,s,u,i,c,g,o,f,h),T=C0(m)/C0(p),C=C0(v)/C0(p),w=C0(y)/C0(p);return[T,C,w]}function AR(t,e,n=!1){const[r,i,a,o]=t,[s,c,l]=e,f=r*s+i*c+a*l-o,u=Math.abs(f)/Math.sqrt(r*r+i*i+a*a);return(n?Math.sign(f):1)*u}const vX=Object.freeze(Object.defineProperty({__proto__:null,linePlaneIntersection:NR,planeDistanceToPoint:AR,planeEquation:kR,threePlaneIntersection:mX},Symbol.toStringTag,{value:"Module"}));function q3(t){return Array.isArray(t)?t.some(e=>Number.isNaN(e)):Number.isNaN(t)}function ka(t){if(t===null||typeof t!="object"||typeof t=="function"||typeof structuredClone=="function")return t;if(Array.isArray(t))return t.map(ka);{const e={};for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=ka(t[n]));return e}}const mg=class mg{constructor(e){this.insetImageMultiplier=1.1,this.flipHorizontal=!1,this.flipVertical=!1,this.viewportStatus=si.NO_DATA,this._suppressCameraModifiedEvents=!1,this.hasPixelSpacing=!0,this.getProperties=()=>({}),this.setRotation=n=>{},this.viewportWidgets=new Map,this.addWidget=(n,r)=>{this.viewportWidgets.set(n,r)},this.getWidget=n=>this.viewportWidgets.get(n),this.getWidgets=()=>Array.from(this.viewportWidgets.values()),this.removeWidgets=()=>{this.getWidgets().forEach(r=>{if(r.getEnabled()&&r.setEnabled(!1),r.getActor&&r.getRenderer){const i=r.getActor(),a=r.getRenderer();a&&i&&a.removeActor(i)}})},this.id=e.id,this.renderingEngineId=e.renderingEngineId,this.type=e.type,this.element=e.element,this.canvas=e.canvas,this.sx=e.sx,this.sy=e.sy,this.sWidth=e.sWidth,this.sHeight=e.sHeight,this._actors=new Map,this.element.setAttribute("data-viewport-uid",this.id),this.element.setAttribute("data-rendering-engine-uid",this.renderingEngineId),this.defaultOptions=ka(e.defaultOptions),this.suppressEvents=e.defaultOptions.suppressEvents?e.defaultOptions.suppressEvents:!1,this.options=ka(e.defaultOptions),this.isDisabled=!1}static get useCustomRenderingPipeline(){return!1}setRendered(){this.viewportStatus===si.NO_DATA||this.viewportStatus===si.LOADING||(this.viewportStatus=si.RENDERED)}getRenderingEngine(){return Ag.get(this.renderingEngineId)}getRenderer(){var n;const e=this.getRenderingEngine();if(!e||e.hasBeenDestroyed)throw new Error("Rendering engine has been destroyed");return(n=e.offscreenMultiRenderWindow)==null?void 0:n.getRenderer(this.id)}render(){this.getRenderingEngine().renderViewport(this.id)}setOptions(e,n=!1){var r,i;this.options=structuredClone(e),(r=this.options)!=null&&r.displayArea&&this.setDisplayArea((i=this.options)==null?void 0:i.displayArea),n&&this.render()}reset(e=!1){this.options=structuredClone(this.defaultOptions),e&&this.render()}getSliceViewInfo(){throw new Error("Method not implemented.")}flip({flipHorizontal:e,flipVertical:n}){const r=this.getDefaultImageData();if(!r)return;const i=this.getCamera(),{viewPlaneNormal:a,viewUp:o,focalPoint:s,position:c}=i,l=an(Le(),a,o);let f=aF(Le(),o);const u=as(Le(),a),g=Gg(c,s),h=r.getDimensions().map(w=>Math.floor(w/2)),p=[h[0],h[1],h[2]],m=r.indexToWorld(p,Le()),v=this._getFocalPointForResetCamera(m,i,{resetPan:!0,resetToCenter:!1}),y=tn(Le(),s,v),T=Cc(y),C=w=>{const x=Br(Le(),w,2*Qe(y,w));return tn(x,x,y),wn(x,x),x};if(e){const w=C(f),x=vr(Le(),v,w,T),O=vr(Le(),x,u,g);this.setCamera({viewPlaneNormal:u,position:O,focalPoint:x}),this.flipHorizontal=!this.flipHorizontal}if(n){f=as(f,o);const w=C(l),x=vr(Le(),v,w,T),O=vr(Le(),x,u,g);this.setCamera({focalPoint:x,viewPlaneNormal:u,viewUp:f,position:O}),this.flipVertical=!this.flipVertical}this.render()}getDefaultImageData(){const e=this.getDefaultActor();if(e&&co(e))return e.actor.getMapper().getInputData()}getDefaultActor(){return this.getActors()[0]}getActors(){return Array.from(this._actors.values())}getActorUIDs(){return Array.from(this._actors.keys())}getActor(e){return this._actors.get(e)}getImageActor(e){const n=this.getActors();let r=n[0];return e&&(r=n.find(a=>a.referencedId===e)),!r||!co(r)?null:r.actor}getActorUIDByIndex(e){const n=this.getActors()[e];if(n)return n.uid}getActorByIndex(e){return this.getActors()[e]}setActors(e){this.removeAllActors(),this.addActors(e,{resetCamera:!0})}_removeActor(e){const n=this.getActor(e);if(!n){console.warn(`Actor ${e} does not exist for this viewport`);return}this.getRenderer().removeViewProp(n.actor),this._actors.delete(e)}removeActors(e){e.forEach(n=>{this._removeActor(n)})}addActors(e,n={}){const{resetCamera:r=!1}=n,i=this.getRenderingEngine();if(!i||i.hasBeenDestroyed){console.warn("Viewport::addActors::Rendering engine has not been initialized or has been destroyed");return}e.forEach(s=>{this.addActor(s)});const a=this.getViewPresentation(),o=this.getViewReference();this.resetCamera(),r||(this.setViewReference(o),this.setViewPresentation(a))}addActor(e){const{uid:n,actor:r}=e,i=this.getRenderingEngine();if(!i||i.hasBeenDestroyed){console.warn(`Cannot add actor UID of ${n} Rendering Engine has been destroyed`);return}if(!n||!r)throw new Error("Actors should have uid and vtk Actor properties");if(this.getActor(n)){console.warn(`Actor ${n} already exists for this viewport`);return}const a=this.getRenderer();a==null||a.addActor(r),this._actors.set(n,Object.assign({},e)),this.updateCameraClippingPlanesAndRange()}removeAllActors(){var e;(e=this.getRenderer())==null||e.removeAllViewProps(),this._actors=new Map}resetCameraNoEvent(){this._suppressCameraModifiedEvents=!0,this.resetCamera(),this._suppressCameraModifiedEvents=!1}setCameraNoEvent(e){this._suppressCameraModifiedEvents=!0,this.setCamera(e),this._suppressCameraModifiedEvents=!1}_getViewImageDataIntersections(e,n,r){const i=r[0],a=r[1],o=r[2],s=i*n[0]+a*n[1]+o*n[2],c=e.getBounds(),l=this._getEdges(c),f=[];for(const u of l){const[[g,d,h],[p,m,v]]=u;if(i*(p-g)+a*(m-d)+o*(v-h)===0)continue;const y=NR([g,d,h],[p,m,v],[i,a,o,s]);this._isInBounds(y,c)&&f.push(y)}return f}setInterpolationType(e,n){}setDisplayArea(e,n=!1){var o;if(!e)return;const{storeAsInitialCamera:r,type:i}=e;r&&(this.options.displayArea=e);const{_suppressCameraModifiedEvents:a}=this;if(this._suppressCameraModifiedEvents=!0,this.setCamera(this.fitToCanvasCamera),i==="SCALE"?this.setDisplayAreaScale(e):(this.setInterpolationType(((o=this.getProperties())==null?void 0:o.interpolationType)??ts.LINEAR),this.setDisplayAreaFit(e)),r&&(this.initialCamera=this.getCamera()),this._suppressCameraModifiedEvents=a,!n&&!a){const s={viewportId:this.id,displayArea:e,storeAsInitialCamera:r};De(this.element,Oe.DISPLAY_AREA_MODIFIED,s),this.setCamera(this.getCamera())}}setDisplayAreaScale(e){const{scale:n=1}=e,r=this.canvas,i=r.height,a=r.width;if(i<8||a<8)return;const c=this.getDefaultImageData().getSpacing()[1];this.setInterpolationType(ts.NEAREST),this.setCamera({parallelScale:i*c/(2*n)}),delete e.imageArea,this.setDisplayAreaFit(e);const{focalPoint:l,position:f,viewUp:u,viewPlaneNormal:g}=this.getCamera(),d=Le();if(r.height%2&&vr(d,d,u,n*.5*c),r.width%2){const h=an(Le(),u,g);vr(d,d,h,n*.5*c)}!d[0]&&!d[1]&&!d[2]||this.setCamera({focalPoint:da(Le(),l,d),position:da(Le(),f,d)})}setDisplayAreaFit(e){const{imageArea:n,imageCanvasPoint:r}=e,i=(window==null?void 0:window.devicePixelRatio)||1,a=this.getDefaultImageData();if(!a)return;const o=this.sWidth/i,s=this.sHeight/i,c=a.getDimensions(),l=this.worldToCanvas(a.indexToWorld([0,0,0])),f=this.worldToCanvas(a.indexToWorld([c[0],c[1],c[2]])),u=[Math.abs(f[0]-l[0]),Math.abs(f[1]-l[1])],[g,d]=u;let h=this.getZoom()/this.insetImageMultiplier;if(n){const[p,m]=n,v=Math.max(Math.abs(g/o),Math.abs(d/s)),y=Math.abs(p*g/o),T=Math.abs(m*d/s),C=this.getZoom(),w=this.getZoom(this.fitToCanvasCamera);h=(y>T?v/y:v/T)*C/w,this.setZoom(this.insetImageMultiplier*h,!1)}if(r){console.log("Starting pan update zoom=",h);const{imagePoint:p,canvasPoint:m=p||[.5,.5]}=r,[v,y]=m,T=o*(v-.5),C=s*(y-.5),[w,x]=p||m,O=h,M=this.insetImageMultiplier*O*g*(.5-w),A=this.insetImageMultiplier*O*d*(.5-x),_=M+T,k=A+C,z=[_,k];console.log("delta point",_,this.getPan()[0],M,T),W4(z,z,this.getPan()),this.setPan(z,!1)}}getDisplayArea(){var e;return(e=this.options)==null?void 0:e.displayArea}resetCamera(e){const{resetPan:n=!0,resetZoom:r=!0,resetToCenter:i=!0,storeAsInitialCamera:a=!0}=e||{},o=this.getRenderer();this.setCameraNoEvent({flipHorizontal:!1,flipVertical:!1});const s=this.getCamera(),c=o.computeVisiblePropBounds(),l=[0,0,0],f=this.getDefaultImageData();if(f){const X=f.getSpacing();c[0]=c[0]+X[0]/2,c[1]=c[1]-X[0]/2,c[2]=c[2]+X[1]/2,c[3]=c[3]-X[1]/2,c[4]=c[4]+X[2]/2,c[5]=c[5]-X[2]/2}const u=this.getVtkActiveCamera(),g=u.getViewPlaneNormal(),d=u.getViewUp();if(l[0]=(c[0]+c[1])/2,l[1]=(c[2]+c[3])/2,l[2]=(c[4]+c[5])/2,f){const Z=f.getDimensions().map(J=>Math.floor(J/2)),ce=[Z[0],Z[1],Z[2]];f.indexToWorld(ce,l)}const{widthWorld:h,heightWorld:p}=this._getWorldDistanceViewUpAndViewRight(c,d,g),m=[this.sWidth,this.sHeight],v=h/p,y=m[0]/m[1],T=v/y,C=T<1?this.insetImageMultiplier*p/2:this.insetImageMultiplier*p*T/2,w=mg.boundsRadius(c)*(this.type===un.VOLUME_3D?10:1),x=this.insetImageMultiplier*w,O=Math.abs(fa.dot(d,g))>.999?[-d[2],d[0],d[1]]:d,M=this._getFocalPointForResetCamera(l,s,{resetPan:n,resetToCenter:i}),A=[M[0]+x*g[0],M[1]+x*g[1],M[2]+x*g[2]];o.resetCameraClippingRange(c);const _=[-mn.MAXIMUM_RAY_DISTANCE,mn.MAXIMUM_RAY_DISTANCE];u.setPhysicalScale(w),u.setPhysicalTranslation(-M[0],-M[1],-M[2]),this.setCamera({parallelScale:r?C:s.parallelScale,focalPoint:M,position:A,viewAngle:90,viewUp:O,clippingRange:_});const k=this.getCamera();this.setFitToCanvasCamera(this.getCamera()),a&&this.setInitialCamera(k),r&&this.setZoom(1,a);const z={type:"ResetCameraEvent",renderer:o};return o.invokeEvent(z),this.triggerCameraModifiedEventIfNecessary(s,k),f&&this.options.displayArea&&r&&n&&i&&this.setDisplayArea(this.options.displayArea),!0}setInitialCamera(e){this.initialCamera=e}setFitToCanvasCamera(e){this.fitToCanvasCamera=e}getPan(e=this.initialCamera){if(!e)return[0,0];const r=this.getVtkActiveCamera().getFocalPoint(),i=this.canvasToWorld([0,0]),a=this.worldToCanvas(tn([0,0,0],e.focalPoint,i)),o=this.worldToCanvas(tn([0,0,0],r,i));return Ru([0,0],a,o)}getCurrentImageIdIndex(){throw new Error("Not implemented")}getSliceIndex(){throw new Error("Not implemented")}getImageData(){throw new Error("Not implemented")}getViewReferenceId(e){return null}setPan(e,n=!1){const r=this.getCamera(),{focalPoint:i,position:a}=r,o=this.canvasToWorld([0,0]),s=Ru([0,0],e,this.getPan());if(Math.abs(s[0])<1&&Math.abs(s[1])<1&&!n)return;const c=tn(Le(),this.canvasToWorld(s),o),l=tn(Le(),i,c),f=tn(Le(),a,c);this.setCamera({...r,focalPoint:l,position:f},n)}getZoom(e=this.initialCamera){if(!e)return 1;const n=this.getVtkActiveCamera(),{parallelScale:r}=e;return r/n.getParallelScale()}setZoom(e,n=!1){const r=this.getCamera(),{parallelScale:i}=this.initialCamera,a=i/e;r.parallelScale===a&&!n||this.setCamera({...r,parallelScale:a},n)}_getFocalPointForViewPlaneReset(e){const{focalPoint:n,viewPlaneNormal:r}=this.getCamera(),i=this._getViewImageDataIntersections(e,n,r);let a=0,o=0,s=0;return i.forEach(([l,f,u])=>{a+=l,o+=f,s+=u}),[a/i.length,o/i.length,s/i.length]}getCanvas(){return this.canvas}getVtkActiveCamera(){const e=this.getRenderer();return e?e.getActiveCamera():(console.warn("No renderer found for the viewport"),null)}getCameraNoRotation(){const e=this.getVtkActiveCamera(),n=(s,c)=>s.some(l=>isNaN(l))?c:s,r=n([...e.getViewUp()],[0,1,0]),i=n([...e.getViewPlaneNormal()],[0,0,-1]),a=n([...e.getPosition()],[0,0,1]),o=n([...e.getFocalPoint()],[0,0,0]);return{viewUp:r,viewPlaneNormal:i,position:a,focalPoint:o,parallelProjection:e.getParallelProjection(),parallelScale:e.getParallelScale(),viewAngle:e.getViewAngle(),flipHorizontal:this.flipHorizontal,flipVertical:this.flipVertical}}getCamera(){return{...this.getCameraNoRotation(),rotation:this.getRotation()}}setCamera(e,n=!1){const r=this.getVtkActiveCamera(),i=this.getCamera(),a=Object.assign({},i,e),{viewUp:o,viewPlaneNormal:s,position:c,focalPoint:l,parallelScale:f,viewAngle:u,flipHorizontal:g,flipVertical:d,clippingRange:h}=e;if(g!==void 0){const v=g&&!this.flipHorizontal||!g&&this.flipHorizontal;v&&this.flip({flipHorizontal:v})}if(d!==void 0){const v=d&&!this.flipVertical||!d&&this.flipVertical;v&&this.flip({flipVertical:v})}o!==void 0&&r.setViewUp(o),s!==void 0&&r.setDirectionOfProjection(-s[0],-s[1],-s[2]),c!==void 0&&r.setPosition(...c),l!==void 0&&r.setFocalPoint(...l),f!==void 0&&r.setParallelScale(f),u!==void 0&&r.setViewAngle(u),h!==void 0&&r.setClippingRange(h);const p=i.focalPoint,m=i.viewUp;if(p&&l||m&&o){const v=r.getViewPlaneNormal(),y=r.getViewUp();let T=!1,C=!1;if(l){const w=[l[0]-p[0],l[1]-p[1],l[2]-p[2]];T=Math.abs(fa.dot(w,v))>0}if(o&&(C=!Mn(y,m)),T||C){const w=this.getDefaultActor();if(!(w!=null&&w.actor))return;Vi(w,"vtkActor")||this.updateClippingPlanesForActors(a),(Vi(w,"vtkImageSlice")||this.type===un.VOLUME_3D)&&this.getRenderer().resetCameraClippingRange()}}n&&this.setInitialCamera(a),this.triggerCameraModifiedEventIfNecessary(i,this.getCamera())}triggerCameraModifiedEventIfNecessary(e,n){if(!this._suppressCameraModifiedEvents&&!this.suppressEvents){const r={previousCamera:e,camera:n,element:this.element,viewportId:this.id,renderingEngineId:this.renderingEngineId};De(this.element,Oe.CAMERA_MODIFIED,r)}}updateCameraClippingPlanesAndRange(){const e=this.getCamera();this.updateClippingPlanesForActors(e),this.getRenderer().resetCameraClippingRange()}async updateClippingPlanesForActors(e){this.getActors().map(r=>{if(!r.actor)return;const i=r.actor.getMapper();let a=r!=null&&r.clippingFilter?r==null?void 0:r.clippingFilter.getClippingPlanes():i.getClippingPlanes();a.length===0&&(r!=null&&r.clippingFilter)&&(a=[$r.newInstance(),$r.newInstance()]);let o=mn.MINIMUM_SLAB_THICKNESS;r.slabThickness&&(o=r.slabThickness);const{viewPlaneNormal:s,focalPoint:c}=e;this.setOrientationOfClippingPlanes(a,o,s,c),De(this.element,Oe.CLIPPING_PLANES_UPDATED,{actorEntry:r,focalPoint:c,vtkPlanes:a,viewport:this})})}setOrientationOfClippingPlanes(e,n,r,i){if(e.length<2)return;const a=[r[0],r[1],r[2]];fa.multiplyScalar(a,n),e[0].setNormal(r);const o=[0,0,0];fa.subtract(i,a,o),e[0].setOrigin(o),e[1].setNormal(-r[0],-r[1],-r[2]);const s=[0,0,0];fa.add(i,a,s),e[1].setOrigin(s)}getClippingPlanesForActor(e){if(e||(e=this.getDefaultActor()),!e.actor)throw new Error("Invalid actor entry: Actor is undefined");const n=e.actor.getMapper();let r=e!=null&&e.clippingFilter?e==null?void 0:e.clippingFilter.getClippingPlanes():n.getClippingPlanes();return r.length===0&&(e!=null&&e.clippingFilter)&&(r=[$r.newInstance(),$r.newInstance()]),r}_getWorldDistanceViewUpAndViewRight(e,n,r){const i=this._getCorners(e),a=this._getCorners(e),o=an(Le(),n,r);let s=N0.buildFromDegree().identity().rotateFromDirections(n,[1,0,0]);i.forEach(g=>s.apply(g));let c=1/0,l=-1/0;for(let g=0;g<8;g++){const d=i[g][0];d>l&&(l=d),d<c&&(c=d)}s=N0.buildFromDegree().identity().rotateFromDirections([o[0],o[1],o[2]],[1,0,0]),a.forEach(g=>s.apply(g));let f=1/0,u=-1/0;for(let g=0;g<8;g++){const d=a[g][0];d>u&&(u=d),d<f&&(f=d)}return{widthWorld:u-f,heightWorld:l-c}}getViewReference(e){const{focalPoint:n,viewPlaneNormal:r,viewUp:i}=this.getCamera();return{FrameOfReferenceUID:this.getFrameOfReferenceUID(),cameraFocalPoint:n,viewPlaneNormal:r,viewUp:i,sliceIndex:(e==null?void 0:e.sliceIndex)??this.getSliceIndex()}}isReferenceViewable(e,n){if(e.FrameOfReferenceUID&&e.FrameOfReferenceUID!==this.getFrameOfReferenceUID())return!1;const{viewPlaneNormal:r}=e,i=this.getCamera();return r&&!Mn(r,i.viewPlaneNormal)&&!Mn(as(i.viewPlaneNormal,i.viewPlaneNormal),r)?n==null?void 0:n.withOrientation:!0}getViewPresentation(e={rotation:!0,displayArea:!0,zoom:!0,pan:!0,flipHorizontal:!0,flipVertical:!0}){const n={},{rotation:r,displayArea:i,zoom:a,pan:o,flipHorizontal:s,flipVertical:c}=e;r&&(n.rotation=this.getRotation()),i&&(n.displayArea=this.getDisplayArea());const l=this.getZoom();return a&&(n.zoom=l),o&&(n.pan=this.getPan(),p9(n.pan,n.pan,1/l)),s&&(n.flipHorizontal=this.flipHorizontal),c&&(n.flipVertical=this.flipVertical),n}setViewReference(e){}setViewPresentation(e){if(!e)return;const{displayArea:n,zoom:r=this.getZoom(),pan:i,rotation:a,flipHorizontal:o=this.flipHorizontal,flipVertical:s=this.flipVertical}=e;n!==this.getDisplayArea()&&this.setDisplayArea(n),this.setZoom(r),i&&this.setPan(p9([0,0],i,r)),a>=0&&this.setRotation(a),(o||s)&&this.flip({flipHorizontal:o,flipVertical:s})}_getCorners(e){return[[e[0],e[2],e[4]],[e[0],e[2],e[5]],[e[0],e[3],e[4]],[e[0],e[3],e[5]],[e[1],e[2],e[4]],[e[1],e[2],e[5]],[e[1],e[3],e[4]],[e[1],e[3],e[5]]]}_getFocalPointForResetCamera(e,n,{resetPan:r=!0,resetToCenter:i=!0}){if(i&&r)return e;if(i&&!r)return q3(n.focalPoint)?e:n.focalPoint;if(!i&&r){const a=n,o=a.focalPoint,s=a.viewPlaneNormal,c=tn(Le(),e,o),l=Qe(c,s),f=vr(Le(),e,s,-1*l);return[f[0],f[1],f[2]]}if(!r&&!i)return q3(n.focalPoint)?e:n.focalPoint}_isInBounds(e,n){const[r,i,a,o,s,c]=n,[l,f,u]=e;return!(l<r||l>i||f<a||f>o||u<s||u>c)}_getEdges(e){const[n,r,i,a,o,s,c,l]=this._getCorners(e);return[[n,r],[n,o],[n,i],[r,a],[r,s],[i,a],[i,c],[a,l],[o,c],[o,s],[s,l],[c,l]]}static boundsRadius(e){const n=(e[1]-e[0])**2,r=(e[3]-e[2])**2,i=(e[5]-e[4])**2;return Math.sqrt(n+r+i||1)*.5}setDataIds(e,n){throw new Error("Unsupported operatoin setDataIds")}};mg.CameraViewPresentation={rotation:!0,pan:!0,zoom:!0,displayArea:!0},mg.TransferViewPresentation={windowLevel:!0,paletteLut:!0};let Iu=mg;function FR(t,e,n=!1){const r=t.getCamera(),{focalPoint:i,viewPlaneNormal:a}=r,{spacingInNormalDirection:o,actorUID:s}=xd(t,r,e,n);if(!s)throw new Error(`Could not find image volume with id ${e} in the viewport`);const c=t.getActor(s);if(!c)return console.warn("No actor found for with actorUID of",s),null;const l=c.actor;return{sliceRange:E2(l,a,i),spacingInNormalDirection:o,camera:r}}function lu(t,e,n=!1){const{sliceRange:r,spacingInNormalDirection:i,camera:a}=FR(t,e,n),{min:o,max:s,current:c}=r,l=Math.round((s-o)/i),u=(c-o)/(s-o)*l,g=Math.round(u);return{numScrollSteps:l,currentStepIndex:g,sliceRangeInfo:{sliceRange:r,spacingInNormalDirection:i,camera:a}}}function UR(t){let e=[];const[n,r]=t.getRange();t.getTable(n,r,1024,e),e=e.filter((d,h)=>h%3===0);const i=[...Array(1024).keys()].map((d,h)=>n+(r-n)/1023*h),a=e[256],o=Math.log((1-a)/a),s=i[256],c=e[256*3],l=Math.log((1-c)/c),f=i[256*3],u=Math.round(4*(f-s)/(o-l)),g=Math.round(s+u*o/4);return[Math.round(g-u/2),Math.round(g+u/2)]}function BR(t,e){const n=e.colorTransfer.split(" ").splice(1).map(parseFloat),{shiftRange:r}=yX(n),i=r[0],a=r[1]-r[0],o=Dc.newInstance(),s=[];for(let C=0;C<n.length;C+=4){let w=n[C];const x=n[C+1],O=n[C+2],M=n[C+3];w=(w-i)/a,s.push([w,x,O,M])}TX(s,r,o),t.getProperty().setRGBTransferFunction(0,o);const c=e.scalarOpacity.split(" ").splice(1).map(parseFloat),l=Mu.newInstance(),f=[];for(let C=0;C<c.length;C+=2){let w=c[C];const x=c[C+1];w=(w-i)/a,f.push([w,x])}CX(f,r,l);const u=t.getProperty();u.setScalarOpacity(0,l);const[g,d,h,p]=e.gradientOpacity.split(" ").splice(1).map(parseFloat);u.setUseGradientOpacity(0,!0),u.setGradientOpacityMinimumValue(0,g),u.setGradientOpacityMinimumOpacity(0,d),u.setGradientOpacityMaximumValue(0,h),u.setGradientOpacityMaximumOpacity(0,p),e.interpolation==="1"&&u.setInterpolationTypeToFastLinear(),u.setShade(e.shade==="1");const m=parseFloat(e.ambient),v=parseFloat(e.diffuse),y=parseFloat(e.specular),T=parseFloat(e.specularPower);u.setAmbient(m),u.setDiffuse(v),u.setSpecular(y),u.setSpecularPower(T)}function yX(t){let e=1/0,n=-1/0;for(let i=0;i<t.length;i+=4)e=Math.min(e,t[i]),n=Math.max(n,t[i]);const r=(n-e)/2;return{shiftRange:[-r,r],min:e,max:n}}function TX(t,e,n){const r=e[1]-e[0],i=t.map(([a,o,s,c])=>[a*r+e[0],o,s,c]);return n.removeAllPoints(),i.forEach(([a,o,s,c])=>n.addRGBPoint(a,o,s,c)),i}function CX(t,e,n){const r=e[1]-e[0],i=t.map(([a,o])=>[a*r+e[0],o]);return n.removeAllPoints(),i.forEach(([a,o])=>n.addPoint(a,o)),i}class za extends Iu{constructor(e){if(super(e),this.useCPURendering=!1,this.perVolumeIdDefaultProperties=new Map,this.viewportProperties={},this.volumeIds=new Set,this.setRotation=i=>{const a=this.getPan(this.fitToCanvasCamera),o=this.getPan(),s=this.getCamera(),c=sh([0,0],a,o);this.setPan(c,!1);const{flipVertical:l}=this.getCamera(),f=l?as([0,0,0],this.initialViewUp):this.initialViewUp;this.setCameraNoEvent({viewUp:f}),this.rotateCamera(i);const u=this.getPan(),g=this.getPan(this.fitToCanvasCamera),d=sh([0,0],u,g),h=W4([0,0],a,d);if(this.setPan(h,!1),this._suppressCameraModifiedEvents)return;const p=this.getCamera(),m={previousCamera:s,camera:p,element:this.element,viewportId:this.id,renderingEngineId:this.renderingEngineId};De(this.element,Oe.CAMERA_MODIFIED,m)},this.getDefaultProperties=i=>{let a;return i!==void 0&&(a=this.perVolumeIdDefaultProperties.get(i)),a!==void 0?a:{...this.globalDefaultProperties}},this.getProperties=i=>{var w;if(!this._getApplicableVolumeActor(i))return;const{colormap:o,VOILUTFunction:s,interpolationType:c,invert:l,slabThickness:f,preset:u}=this.viewportProperties;if(i||(i=this.getVolumeId()),!Me.getVolume(i))return null;const d=this.getActors().find(x=>x.referencedId===i);if(!d)return;const p=d.actor.getProperty().getRGBTransferFunction(0),[m,v]=((w=this.viewportProperties)==null?void 0:w.VOILUTFunction)==="SIGMOID"?UR(p):p.getRange(),y={lower:m,upper:v},T=this.getColormap(i);return{colormap:i&&T?T:o,voiRange:y,VOILUTFunction:s,interpolationType:c,invert:l,slabThickness:f,preset:u}},this.getColormap=i=>{const a=this._getApplicableVolumeActor(i);if(!a)return;const{volumeActor:o}=a,s=this._getOrCreateColorTransferFunction(i),{nodes:c}=s.getState(),l=c.reduce((u,g)=>(u.push(g.x,g.r,g.g,g.b),u),[]);return Ty(l,o)},this.getRotation=()=>{const{viewUp:i,viewPlaneNormal:a,flipVertical:o}=this.getCameraNoRotation(),s=o?as([0,0,0],this.initialViewUp):this.initialViewUp;if(!s)return 0;const c=mE(s,i)*180/Math.PI,l=an([0,0,0],s,i);return Qe(l,a)>=0?c:(360-c)%360},this.getFrameOfReferenceUID=()=>this._FrameOfReferenceUID,this.canvasToWorld=i=>{var h,p;const a=this.getVtkActiveCamera();(h=a.setIsPerformingCoordinateTransformation)==null||h.call(a,!0);const o=this.getRenderer(),c=this.getRenderingEngine().offscreenMultiRenderWindow.getOpenGLRenderWindow(),l=c.getSize(),f=window.devicePixelRatio||1,u=[i[0]*f,i[1]*f],g=[u[0]+this.sx,u[1]+this.sy];g[1]=l[1]-g[1];const d=c.displayToWorld(g[0],g[1],0,o);return(p=a.setIsPerformingCoordinateTransformation)==null||p.call(a,!1),[d[0],d[1],d[2]]},this.worldToCanvas=i=>{var h;const a=this.getVtkActiveCamera();(h=a.setIsPerformingCoordinateTransformation)==null||h.call(a,!0);const o=this.getRenderer(),c=this.getRenderingEngine().offscreenMultiRenderWindow.getOpenGLRenderWindow(),l=c.getSize(),f=c.worldToDisplay(...i,o);f[1]=l[1]-f[1];const u=[f[0]-this.sx,f[1]-this.sy],g=window.devicePixelRatio||1,d=[u[0]/g,u[1]/g];return a.setIsPerformingCoordinateTransformation(!1),d},this.hasImageURI=i=>this.getActors().filter(o=>Vi(o,"vtkVolume")).some(({uid:o,referencedId:s})=>{const c=Me.getVolume(s||o);return c!=null&&c.imageIds?c.imageIds.map(gi).includes(i):!1}),this.getImageIds=i=>{const a=this._getApplicableVolumeActor(i);if(!a)throw new Error(`No actor found for the given volumeId: ${i}`);const o=a.volumeId,s=Me.getVolume(o);if(!s)throw new Error(`imageVolume with id: ${o} does not exist in cache`);return s.imageIds},this.useCPURendering=og(),this.useCPURendering)throw new Error("VolumeViewports cannot be used whilst CPU Fallback Rendering is enabled.");const n=this.getRenderer(),r=xj.newInstance();switch(n.setActiveCamera(r),this.type){case un.ORTHOGRAPHIC:r.setParallelProjection(!0);break;case un.VOLUME_3D:r.setParallelProjection(!0);break;case un.PERSPECTIVE:r.setParallelProjection(!1);break;default:throw new Error(`Unrecognized viewport type: ${this.type}`)}this.initializeVolumeNewImageEventDispatcher()}static get useCustomRenderingPipeline(){return!1}getSliceViewInfo(){throw new Error("Method not implemented.")}applyViewOrientation(e,n=!0){const{viewPlaneNormal:r,viewUp:i}=this._getOrientationVectors(e),a=this.getVtkActiveCamera();a.setDirectionOfProjection(-r[0],-r[1],-r[2]),a.setViewUpFrom(i),this.initialViewUp=i,n&&this.resetCamera()}initializeVolumeNewImageEventDispatcher(){const e=r.bind(this),n=i.bind(this);function r(a){const{viewportId:o}=a.detail;o!==this.id||this.isDisabled||!this.getImageData()||hX(a)}function i(a){const{viewportId:o}=a.detail;o===this.id&&(this.element.removeEventListener(Oe.CAMERA_MODIFIED,e),Ee.removeEventListener(Oe.ELEMENT_DISABLED,n),pX(o))}this.element.removeEventListener(Oe.CAMERA_MODIFIED,e),this.element.addEventListener(Oe.CAMERA_MODIFIED,e),Ee.addEventListener(Oe.ELEMENT_DISABLED,n)}setVOILUTFunction(e,n,r){Object.values(ui).includes(e)||(e=ui.LINEAR);const{voiRange:i}=this.getProperties();this.setVOI(i,n,r),this.viewportProperties.VOILUTFunction=e}setColormap(e,n,r){const i=this._getApplicableVolumeActor(n);if(!i)return;const{volumeActor:a}=i,o=Dc.newInstance();let s=zg(e.name);const{name:c}=e;if(s||(s=wh.getPresetByName(c)),!s)throw new Error(`Colormap ${e} not found`);const l=a.getProperty().getRGBTransferFunction(0).getRange();if(o.applyColorMap(s),o.setMappingRange(l[0],l[1]),a.getProperty().setRGBTransferFunction(0,o),this.viewportProperties.colormap=e,!r){const f={viewportId:this.id,colormap:e,volumeId:n};De(this.element,Oe.VOI_MODIFIED,f),De(this.element,Oe.COLORMAP_MODIFIED,f)}}setOpacity(e,n){const r=this._getApplicableVolumeActor(n);if(!r)return;const{volumeActor:i}=r,a=Mu.newInstance();if(typeof e.opacity=="number"){const o=i.getProperty().getRGBTransferFunction(0).getRange();a.addPoint(o[0],e.opacity),a.addPoint(o[1],e.opacity)}else e.opacity.forEach(({opacity:o,value:s})=>{a.addPoint(s,o)});i.getProperty().setScalarOpacity(0,a),this.viewportProperties.colormap||(this.viewportProperties.colormap={}),this.viewportProperties.colormap.opacity=e.opacity}setInvert(e,n,r){const i=this._getApplicableVolumeActor(n);if(!i)return;const a=i.volumeId,o=this._getOrCreateColorTransferFunction(a);if(sg(o),this.viewportProperties.invert=e,!r){const s={...this.getVOIModifiedEventDetail(a),invertStateChanged:!0};De(this.element,Oe.VOI_MODIFIED,s)}}getVOIModifiedEventDetail(e){const n=this._getApplicableVolumeActor(e);if(!n)throw new Error(`No actor found for the given volumeId: ${e}`);const a=n.volumeActor.getProperty().getRGBTransferFunction(0).getMappingRange(),o=this.getColormap(e),{VOILUTFunction:s,invert:c}=this.getProperties(e);return{viewportId:this.id,range:{lower:a[0],upper:a[1]},volumeId:n.volumeId,VOILUTFunction:s,colormap:o,invert:c}}_getOrCreateColorTransferFunction(e){const n=this._getApplicableVolumeActor(e);if(!n)return null;const{volumeActor:r}=n,i=r.getProperty().getRGBTransferFunction(0);if(i)return i;const a=Dc.newInstance();return r.getProperty().setRGBTransferFunction(0,a),a}setInterpolationType(e,n){const r=this._getApplicableVolumeActor(n);if(!r)return;const{volumeActor:i}=r;i.getProperty().setInterpolationType(e),this.viewportProperties.interpolationType=e}setVOI(e,n,r=!1){const i=this._getApplicableVolumeActor(n);if(!i)return;const{volumeActor:a}=i,o=i.volumeId,s=e;if(typeof s>"u")throw new Error("voiRangeToUse is undefined, need to implement this in the new volume model");const{VOILUTFunction:c}=this.getProperties(o);if(c===ui.SAMPLED_SIGMOID){const l=wy(s);a.getProperty().setRGBTransferFunction(0,l)}else{const{lower:l,upper:f}=s;a.getProperty().getRGBTransferFunction(0).setRange(l,f)}if(!r){const l={...this.getVOIModifiedEventDetail(o)};De(this.element,Oe.VOI_MODIFIED,l)}this.viewportProperties.voiRange=s}rotateCamera(e){const n=e-this.getRotation();this.getVtkActiveCamera().roll(-n)}setDefaultProperties(e,n){n==null?this.globalDefaultProperties=e:this.perVolumeIdDefaultProperties.set(n,e)}clearDefaultProperties(e){e==null?(this.globalDefaultProperties={},this.resetProperties()):(this.perVolumeIdDefaultProperties.delete(e),this.resetToDefaultProperties(e))}getViewReference(e={}){const n=super.getViewReference(e),r=this.getVolumeId(e);if((e==null?void 0:e.forFrameOfReference)!==!1&&(n.volumeId=r),typeof(e==null?void 0:e.sliceIndex)!="number")return n;const{viewPlaneNormal:i}=n,a=(e==null?void 0:e.sliceIndex)-this.getSliceIndex(),{sliceRangeInfo:o}=lu(this,r,!0),{sliceRange:s,spacingInNormalDirection:c,camera:l}=o,{focalPoint:f,position:u}=l,{newFocalPoint:g}=ou(f,u,s,i,c,a);return n.cameraFocalPoint=g,n}isReferenceViewable(e,n){if(!e.FrameOfReferenceUID||!super.isReferenceViewable(e,n))return!1;if(n!=null&&n.withNavigation)return!0;const r=this.getSliceIndex(),{sliceIndex:i}=e;return Array.isArray(i)?i[0]<=r&&r<=i[1]:i===void 0||i===r}scroll(e=1){const n=this.getVolumeId(),{sliceRangeInfo:r}=lu(this,n,!0);if(!r)return;const{sliceRange:i,spacingInNormalDirection:a,camera:o}=r,{focalPoint:s,viewPlaneNormal:c,position:l}=o,{newFocalPoint:f,newPosition:u}=ou(s,l,i,c,a,e);this.setCamera({focalPoint:f,position:u})}setViewReference(e){if(!e)return;const n=this.getVolumeId(),{viewPlaneNormal:r,FrameOfReferenceUID:i,cameraFocalPoint:a,viewUp:o}=e;let{sliceIndex:s}=e;const{focalPoint:c,viewPlaneNormal:l,position:f}=this.getCamera(),u=HD(l,r),g=Mn(l,r);if(typeof s=="number"&&e.volumeId===n&&(u||g)){const{currentStepIndex:d,sliceRangeInfo:h,numScrollSteps:p}=lu(this,n,!0),{sliceRange:m,spacingInNormalDirection:v}=h;u&&(s=p-s-1);const y=s-d,{newFocalPoint:T,newPosition:C}=ou(c,f,m,l,v,y);this.setCamera({focalPoint:T,position:C})}else if(i===this.getFrameOfReferenceUID()){if(r&&!u&&!g){this.setOrientation({viewPlaneNormal:r,viewUp:o}),this.setViewReference(e);return}if(a){const d=tn([0,0,0],a,c),h=r??l,p=Qe(d,h);Mn(p,0)||Br(d,h,p);const m=da([0,0,0],c,d),v=da([0,0,0],f,d);this.setCamera({focalPoint:m,position:v})}}else throw new Error(`Incompatible view refs: ${i}!==${this.getFrameOfReferenceUID()}`)}setProperties({voiRange:e,VOILUTFunction:n,invert:r,colormap:i,preset:a,interpolationType:o,slabThickness:s}={},c,l=!1){this.globalDefaultProperties==null&&this.setDefaultProperties({voiRange:e,VOILUTFunction:n,invert:r,colormap:i,preset:a,slabThickness:s}),r!==void 0&&this.viewportProperties.invert!==r&&this.setInvert(r,c,l),i!=null&&i.name&&this.setColormap(i,c,l),(i==null?void 0:i.opacity)!=null&&this.setOpacity(i,c),e!==void 0&&this.setVOI(e,c,l),typeof o<"u"&&this.setInterpolationType(o),n!==void 0&&this.setVOILUTFunction(n,c,l),a!==void 0&&this.setPreset(a,c,l),s!==void 0&&this.setSlabThickness(s)}resetToDefaultProperties(e){var r,i;const n=this.globalDefaultProperties;(r=n.colormap)!=null&&r.name&&this.setColormap(n.colormap,e),((i=n.colormap)==null?void 0:i.opacity)!=null&&this.setOpacity(n.colormap,e),n.voiRange!==void 0&&this.setVOI(n.voiRange,e),n.VOILUTFunction!==void 0&&this.setVOILUTFunction(n.VOILUTFunction,e),n.invert!==void 0&&this.setInvert(n.invert,e),n.slabThickness!==void 0&&(this.setSlabThickness(n.slabThickness),this.viewportProperties.slabThickness=n.slabThickness),n.preset!==void 0&&this.setPreset(n.preset,e,!1),n.preset!==void 0&&this.setPreset(n.preset,e,!1),this.render()}setPreset(e,n,r){const i=this._getApplicableVolumeActor(n);if(!i)return;const{volumeActor:a}=i;let o=e;typeof o=="string"&&(o=Ux.find(s=>s.name===e)),o&&(BR(a,o),this.viewportProperties.preset=o,this.render(),r||De(this.element,Oe.PRESET_MODIFIED,{viewportId:this.id,volumeId:i.volumeId,actor:a,presetName:o.name}))}async setVolumes(e,n=!1,r=!1){const i=Me.getVolume(e[0].volumeId);if(!i)throw new Error(`imageVolume with id: ${i.volumeId} does not exist, you need to create/allocate the volume first`);const a=i.metadata.FrameOfReferenceUID;this._isValidVolumeInputArray(e,a),this._FrameOfReferenceUID=a,e.forEach(s=>{this._addVolumeId(s.volumeId)});const o=[];for(let s=0;s<e.length;s++){const{volumeId:c,actorUID:l,slabThickness:f,...u}=e[s],g=await K3(e[s],this.element,this.id,r),d=l||In();o.push({uid:d,actor:g,slabThickness:f,referencedId:c,...u})}this._setVolumeActors(o),this.viewportStatus=si.PRE_RENDER,this.initializeColorTransferFunction(e),De(this.element,Oe.VOLUME_VIEWPORT_NEW_VOLUME,{viewportId:this.id,volumeActors:o}),n&&this.render()}async addVolumes(e,n=!1,r=!1){const i=Me.getVolume(e[0].volumeId);if(!i)throw new Error(`imageVolume with id: ${i.volumeId} does not exist`);const a=[];this._isValidVolumeInputArray(e,this._FrameOfReferenceUID),e.forEach(o=>{this._addVolumeId(o.volumeId)});for(let o=0;o<e.length;o++){const{volumeId:s,visibility:c,actorUID:l,slabThickness:f,...u}=e[o],g=await K3(e[o],this.element,this.id,r);c||g.setVisibility(!1);const d=l||In();a.push({uid:d,actor:g,slabThickness:f,referencedId:s,...u})}this.addActors(a),this.initializeColorTransferFunction(e),n&&this.render()}removeVolumeActors(e,n=!1){this.removeActors(e),n&&this.render()}setOrientation(e,n=!0){console.warn('Method "setOrientation" needs implementation')}initializeColorTransferFunction(e){const n=e[0].volumeId,r=this._getOrCreateColorTransferFunction(n);!this.initialTransferFunctionNodes&&r&&(this.initialTransferFunctionNodes=xh(r))}_getApplicableVolumeActor(e){const n=this.getActors();if(!(n!=null&&n.length))return;if(e){const i=n.find(a=>a.referencedId===e);return i?{volumeActor:i.actor,volumeId:e,actorUID:i.uid}:void 0}const r=n[0];return{volumeActor:r.actor,volumeId:r.referencedId,actorUID:r.uid}}async _isValidVolumeInputArray(e,n){const r=e.length;for(let i=1;i<r;i++){const a=Me.getVolume(e[i].volumeId);if(n!==a.metadata.FrameOfReferenceUID)throw new Error(`Volumes being added to viewport ${this.id} do not share the same FrameOfReferenceUID. This is not yet supported`)}return!0}getBounds(){return this.getRenderer().computeVisiblePropBounds()}flip(e){super.flip(e)}hasVolumeId(e){return this.volumeIds.has(e)}hasVolumeURI(e){for(const n of this.volumeIds)if(n.includes(e))return!0;return!1}getImageData(e){var s,c,l;if(!this.getDefaultActor())return;e||(e=this.getVolumeId());const r=(s=this.getActors())==null?void 0:s.find(f=>f.referencedId===e);if(!Vi(r,"vtkVolume"))return;const i=r.actor,a=Me.getVolume(e),o=i.getMapper().getInputData();return{dimensions:o.getDimensions(),spacing:o.getSpacing(),origin:o.getOrigin(),direction:o.getDirection(),imageData:i.getMapper().getInputData(),metadata:{Modality:(c=a==null?void 0:a.metadata)==null?void 0:c.Modality,FrameOfReferenceUID:(l=a==null?void 0:a.metadata)==null?void 0:l.FrameOfReferenceUID},get scalarData(){var f;return(f=a==null?void 0:a.voxelManager)==null?void 0:f.getScalarData()},scaling:a==null?void 0:a.scaling,hasPixelSpacing:!0,voxelManager:a==null?void 0:a.voxelManager}}setCameraClippingRange(){throw new Error("Method not implemented.")}getSliceIndex(){throw new Error("Method not implemented.")}setCamera(e,n){super.setCamera(e,n),this.setCameraClippingRange()}_setVolumeActors(e){for(let n=0;n<e.length;n++)this.viewportProperties.invert=!1;this.setActors(e)}_getOrientationVectors(e){if(typeof e=="object"){if(e.viewPlaneNormal&&e.viewUp)return e;throw new Error("Invalid orientation object. It must contain viewPlaneNormal and viewUp")}else{if(typeof e=="string"&&sc[e])return this.viewportProperties.orientation=e,sc[e];throw new Error(`Invalid orientation: ${e}. Valid orientations are: ${Object.keys(sc).join(", ")}`)}}getSlabThickness(){const e=this.getActors();let n=mn.MINIMUM_SLAB_THICKNESS;return e.forEach(r=>{r.slabThickness>n&&(n=r.slabThickness)}),n}getIntensityFromWorld(e){const n=this.getDefaultActor();if(!Vi(n,"vtkVolume"))return;const{actor:r}=n,i=r.getMapper().getInputData(),a=Me.getVolume(this.getVolumeId()),o=Qo(i,e);return a.voxelManager.getAtIJKPoint(o)}getVolumeId(e){const n=this.getActors();if(!n)return;if(!(e!=null&&e.volumeId)){const i=n.find(a=>a.actor.getClassName()==="vtkVolume");return(i==null?void 0:i.referencedId)||(i==null?void 0:i.uid)}const r=n.find(i=>i.actor.getClassName()==="vtkVolume"&&i.referencedId===(e==null?void 0:e.volumeId));return(r==null?void 0:r.referencedId)||(r==null?void 0:r.uid)}getViewReferenceId(e={}){var c;let{volumeId:n,sliceIndex:r}=e;if(!n){const l=this.getActors();if(!l)return;n=(c=l.find(f=>f.actor.getClassName()==="vtkVolume"))==null?void 0:c.referencedId}const i=this.getSliceIndex();r??(r=i);const{viewPlaneNormal:a,focalPoint:o}=this.getCamera(),s=n.includes("?")?"&":"?";return`volumeId:${n}${s}sliceIndex=${r}&viewPlaneNormal=${a.join(",")}`}_addVolumeId(e){this.volumeIds.add(e)}getAllVolumeIds(){return Array.from(this.volumeIds)}}function rc(t,e){const{imageData:n}=t.getImageData(),r=t.canvasToWorld(e);return Qo(n,r)}function Dh(t,e){return t.indexToWorld(e)}function wX(t,e){const{imageData:n}=t.getImageData(),r=Dh(n,e);return t.worldToCanvas(r)}class Hi extends za{constructor(e){super(e),this._useAcquisitionPlaneForViewPlane=!1,this.getNumberOfSlices=()=>{const{numberOfSlices:r}=Oh(this)||{};return r},this.resetCameraForResize=()=>this.resetCamera({resetPan:!0,resetZoom:!0,resetToCenter:!0,resetRotation:!1,suppressEvents:!0}),this.getCurrentImageIdIndex=(r,i=!0)=>{const{currentStepIndex:a}=lu(this,r||this.getVolumeId(),i);return a},this.getSliceIndex=()=>{const{imageIndex:r}=Oh(this)||{};return r},this.getCurrentImageId=()=>{const r=this.getDefaultActor();if(!r||!Vi(r,"vtkVolume"))return;const i=Me.getVolume(this.getVolumeId());if(!i)return;const{viewPlaneNormal:a,focalPoint:o}=this.getCamera();return Wg(i,o,a)},this.getSlicePlaneCoordinates=()=>{const r=this.getDefaultActor();if(!(r!=null&&r.actor))return console.warn("No image data found for calculating vtkPlanes."),[];const i=this.getVolumeId(),a=Me.getVolume(i),o=this.getCamera(),{focalPoint:s,position:c,viewPlaneNormal:l}=o,f=Td(a,l),u=E2(r.actor,l,s),g=Math.round((u.current-u.min)/f),d=Math.round((u.max-u.current)/f),h=this.getSliceIndex(),p=[];for(let m=-g;m<=d;m++){const{newFocalPoint:v}=ou(s,c,u,l,f,m);p.push({sliceIndex:h+m,point:v})}return p};const{orientation:n}=this.options;if(n&&n!==Ou.ACQUISITION){this.applyViewOrientation(n);return}this._useAcquisitionPlaneForViewPlane=!0}async setVolumes(e,n=!1,r=!1){const i=Me.getVolume(e[0].volumeId);if(!i)throw new Error(`imageVolume with id: ${i.volumeId} does not exist`);return this._useAcquisitionPlaneForViewPlane&&(this._setViewPlaneToAcquisitionPlane(i),this._useAcquisitionPlaneForViewPlane=!1),super.setVolumes(e,n,r)}async addVolumes(e,n=!1,r=!1){const i=Me.getVolume(e[0].volumeId);if(!i)throw new Error(`imageVolume with id: ${i.volumeId} does not exist`);return this._useAcquisitionPlaneForViewPlane&&(this._setViewPlaneToAcquisitionPlane(i),this._useAcquisitionPlaneForViewPlane=!1),super.addVolumes(e,n,r)}jumpToWorld(e){const{focalPoint:n}=this.getCamera(),r=[0,0,0];_n(r,e,n);const i=this.getCamera(),a=i.viewPlaneNormal,o=Qe(r,a),s=Cn(a[0],a[1],a[2]);if(Br(s,s,o),Math.abs(s[0])>.001||Math.abs(s[1])>.001||Math.abs(s[2])>.001){const c=[0,0,0],l=[0,0,0];da(c,i.focalPoint,s),da(l,i.position,s),this.setCamera({focalPoint:c,position:l}),this.render()}return!0}setOrientation(e,n=!0){let r,i;if(typeof e=="string"){if(sc[e])({viewPlaneNormal:r,viewUp:i}=sc[e]);else if(e==="acquisition")({viewPlaneNormal:r,viewUp:i}=this._getAcquisitionPlaneOrientation());else throw new Error(`Invalid orientation: ${e}. Use Enums.OrientationAxis instead.`);this.setCamera({viewPlaneNormal:r,viewUp:i}),this.viewportProperties.orientation=e,this.resetCamera()}else({viewPlaneNormal:r,viewUp:i}=e),this.applyViewOrientation(e);n&&this.render()}setCameraClippingRange(){const e=this.getVtkActiveCamera();if(!e){console.warn("No active camera found");return}e.getParallelProjection()?e.setClippingRange(-mn.MAXIMUM_RAY_DISTANCE,mn.MAXIMUM_RAY_DISTANCE):e.setClippingRange(mn.MINIMUM_SLAB_THICKNESS,mn.MAXIMUM_RAY_DISTANCE)}_getAcquisitionPlaneOrientation(){if(!this.getDefaultActor())return;const n=this.getVolumeId(),r=Me.getVolume(n);if(!r)throw new Error(`imageVolume with id: ${n} does not exist in cache`);const{direction:i}=r,a=i.slice(6,9).map(s=>-s),o=i.slice(3,6).map(s=>-s);return{viewPlaneNormal:a,viewUp:o}}_setViewPlaneToAcquisitionPlane(e){let n,r;if(e){const{direction:i}=e;n=i.slice(6,9).map(a=>-a),r=i.slice(3,6).map(a=>-a)}else({viewPlaneNormal:n,viewUp:r}=this._getAcquisitionPlaneOrientation());this.setCamera({viewPlaneNormal:n,viewUp:r}),this.initialViewUp=r,this.resetCamera()}getBlendMode(e){const n=this.getActors(),r=(e==null?void 0:e.length)>0?n.find(i=>e.includes(i.uid)):n[0];return(r==null?void 0:r.blendMode)||(r==null?void 0:r.actor.getMapper().getBlendMode())}setBlendMode(e,n=[],r=!1){let i=this.getActors();(n==null?void 0:n.length)>0&&(i=i.filter(a=>n.includes(a.uid))),i.forEach(a=>{var c;const{actor:o}=a,s=o.getMapper();(c=s.setBlendMode)==null||c.call(s,e),a.blendMode=e}),r&&this.render()}resetCamera(e){const{resetPan:n=!0,resetZoom:r=!0,resetRotation:i=!0,resetToCenter:a=!0,suppressEvents:o=!1,resetOrientation:s=!0}=e||{},{orientation:c}=this.viewportProperties;c&&s&&this.applyViewOrientation(c,!1),super.resetCamera({resetPan:n,resetZoom:r,resetToCenter:a});const l=this.getVtkActiveCamera(),f=l.getViewPlaneNormal(),u=l.getFocalPoint();if(this.getActors().forEach(d=>{if(!d.actor)return;const h=d.actor.getMapper();if(h.getClippingPlanes().length===0&&!(d!=null&&d.clippingFilter)){const m=$r.newInstance(),v=$r.newInstance(),y=[m,v];let T=mn.MINIMUM_SLAB_THICKNESS;d.slabThickness&&(T=d.slabThickness),this.setOrientationOfClippingPlanes(y,T,f,u),h.addClippingPlane(m),h.addClippingPlane(v)}}),i&&sc[this.viewportProperties.orientation]!==void 0){const d=sc[this.viewportProperties.orientation];this.setCameraNoEvent({viewUp:d.viewUp,viewPlaneNormal:d.viewPlaneNormal})}if(!o){const d={viewportId:this.id,camera:this.getCamera(),renderingEngineId:this.renderingEngineId,element:this.element};De(this.element,Oe.CAMERA_RESET,d)}return!0}setSlabThickness(e,n=[]){e<.1&&(e=.1);let r=this.getActors();(n==null?void 0:n.length)>0&&(r=r.filter(a=>n.includes(a.uid))),r.forEach(a=>{Vi(a,"vtkVolume")&&(a.slabThickness=e)});const i=this.getCamera();this.updateClippingPlanesForActors(i),this.triggerCameraModifiedEventIfNecessary(i,i),this.viewportProperties.slabThickness=e}resetSlabThickness(){this.getActors().forEach(r=>{Vi(r,"vtkVolume")&&(r.slabThickness=mn.MINIMUM_SLAB_THICKNESS)});const n=this.getCamera();this.updateClippingPlanesForActors(n),this.triggerCameraModifiedEventIfNecessary(n,n),this.viewportProperties.slabThickness=void 0}getSliceViewInfo(){const{width:e,height:n}=this.getCanvas(),r=rc(this,[0,0]),i=rc(this,[e-1,0]),a=rc(this,[0,n-1]),o=_n(Le(),i,r),s=_n(Le(),a,r),c=an(Le(),o,s);wn(o,o),wn(s,s),wn(c,c);const{dimensions:l}=this.getImageData(),[f,u,g]=l,p=[[0,0,0],[f-1,0,0],[0,u-1,0],[f-1,u-1,0],[0,0,g-1],[f-1,0,g-1],[0,u-1,g-1],[f-1,u-1,g-1]].map(_=>wX(this,_)).reduce((_,k)=>(_.minX=Math.min(_.minX,k[0]),_.minY=Math.min(_.minY,k[1]),_.maxX=Math.max(_.maxX,k[0]),_.maxY=Math.max(_.maxY,k[1]),_),{minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}),m=rc(this,[p.minX,p.minY]),v=sE(o[0],o[1],o[2],0,s[0],s[1],s[2],0,c[0],c[1],c[2],0,m[0],m[1],m[2],1),y=rc(this,[p.maxX,p.maxY]),T=_n(Le(),y,m),C=Ln(Lc(),v),{viewPlaneNormal:w}=this.getCamera();if(w.filter(_=>Math.abs(_)>mo).length>1)throw new Error("getSliceInfo is not supported for oblique views");const O=w.findIndex(_=>Math.abs(_)>1-mo);if(O===-1)throw new Error("Unable to determine slice axis");const M=Qe(o,T)+1,A=Qe(s,T)+1;return{sliceIndex:this.getSliceIndex(),width:M,height:A,slicePlane:O,sliceToIndexMatrix:v,indexToSliceMatrix:C}}getCurrentSlicePixelData(){const{voxelManager:e}=this.getImageData();return e.getSliceData(this.getSliceViewInfo())}getViewReference(e={}){const n=super.getViewReference(e);if(!(n!=null&&n.volumeId))return;const r=Me.getVolume(n.volumeId);return n.referencedImageId=Wg(r,n.cameraFocalPoint,n.viewPlaneNormal),n}resetProperties(e){this._resetProperties(e)}_resetProperties(e){const n=e?this.getActor(e):this.getDefaultActor();if(!n)throw new Error(`No actor found for the given volumeId: ${e}`);n.slabThickness&&(n.slabThickness=mn.MINIMUM_SLAB_THICKNESS,this.viewportProperties.slabThickness=void 0,this.updateClippingPlanesForActors(this.getCamera())),e||(e=this.getVolumeId());const r=Me.getVolume(e);if(!r)throw new Error(`imageVolume with id: ${e} does not exist in cache`);if(My(n.actor,r),co(n)){const l=n.actor.getProperty().getRGBTransferFunction(0);O2(l,this.initialTransferFunctionNodes)}const i={...super.getVOIModifiedEventDetail(e)};this.resetCamera({resetPan:!0,resetZoom:!0,resetToCenter:!0,resetCameraRotation:!0}),De(this.element,Oe.VOI_MODIFIED,i)}getSlicesClippingPlanes(){const e=this.getSlicePlaneCoordinates(),{viewPlaneNormal:n}=this.getCamera(),r=mn.MINIMUM_SLAB_THICKNESS;return e.map(({point:i,sliceIndex:a})=>{const o=[$r.newInstance(),$r.newInstance()];return this.setOrientationOfClippingPlanes(o,r,n,i),{sliceIndex:a,planes:o.map(s=>({normal:s.getNormal(),origin:s.getOrigin()}))}})}}function xX(t,e){e.classHierarchy.push("vtkAbstractImageMapper"),t.getIsOpaque=()=>!0,t.getCurrentImage=()=>null,t.getBoundsForSlice=()=>(P.vtkErrorMacro("vtkAbstractImageMapper.getBoundsForSlice - NOT IMPLEMENTED"),Oc())}const SX={slice:0,customDisplayExtent:[0,0,0,0,0,0],useCustomExtents:!1,backgroundColor:[0,0,0,1]};function EX(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,SX,n),ny.extend(t,e,n),P.setGet(t,e,["slice","useCustomExtents"]),P.setGetArray(t,e,["customDisplayExtent"],6),P.setGetArray(t,e,["backgroundColor"],4),xX(t,e)}var OX={extend:EX};function GR(t,e,n){const r=n.getCurrentImage(),i=r.getExtent(),a=[i[0],i[2],i[4]],{ijkMode:o}=n.getClosestIJKAxis();let s=n.isA("vtkImageArrayMapper")?n.getSubSlice():n.getSlice();o!==n.getSlicingMode()&&(s=n.getSliceAtPosition(s)),a[o]+=s;const c=[0,0,0];r.indexToWorld(a,c),a[o]+=1;const l=[0,0,0];r.indexToWorld(a,l),l[0]-=c[0],l[1]-=c[1],l[2]-=c[2],wn(l,l);const f=$r.intersectWithLine(t,e,c,l);if(f.intersection){const u=f.x,g=[0,0,0];return r.worldToIndex(u,g),{t:f.t,absoluteIJK:g}}return null}function DX(t,e,n){const r=GR(t,e,n);if(r){const a=n.getCurrentImage().getExtent(),o=[Math.round(r.absoluteIJK[0]),Math.round(r.absoluteIJK[1]),Math.round(r.absoluteIJK[2])];return o[0]<a[0]||o[0]>a[1]||o[1]<a[2]||o[1]>a[3]||o[2]<a[4]||o[2]>a[5]?null:{t:r.t,ijk:o}}return null}function RX(t,e,n){const r=GR(t,e,n);if(r){const a=n.getCurrentImage().getExtent(),o=r.absoluteIJK,s=[Math.floor(o[0]),Math.floor(o[1]),Math.floor(o[2])];if(s[0]<a[0]||s[0]>a[1]-1||s[1]<a[2]||s[1]>a[3]-1||s[2]<a[4]||s[2]>(a[5]?a[5]-1:a[5]))return null;const c=[o[0]-s[0],o[1]-s[1],o[2]-s[2]];return{t:r.t,ijk:s,pCoords:c}}return null}const{staticOffsetAPI:MX,otherStaticMethods:_X}=w2,{SlicingMode:Ot}=S2;function bX(t,e){e.classHierarchy.push("vtkImageMapper"),t.getSliceAtPosition=r=>{const i=t.getCurrentImage();let a;if(r.length===3)a=r;else if(Number.isFinite(r)){const f=i.getBounds();switch(e.slicingMode){case Ot.X:a=[r,(f[3]+f[2])/2,(f[5]+f[4])/2];break;case Ot.Y:a=[(f[1]+f[0])/2,r,(f[5]+f[4])/2];break;case Ot.Z:a=[(f[1]+f[0])/2,(f[3]+f[2])/2,r];break}}const o=[0,0,0];i.worldToIndex(a,o);const s=i.getExtent(),{ijkMode:c}=t.getClosestIJKAxis();let l=0;switch(c){case Ot.I:l=Ua(o[0],s[0],s[1]);break;case Ot.J:l=Ua(o[1],s[2],s[3]);break;case Ot.K:l=Ua(o[2],s[4],s[5]);break;default:return 0}return l},t.setSliceFromCamera=r=>{const i=r.getFocalPoint();switch(e.slicingMode){case Ot.I:case Ot.J:case Ot.K:{const a=t.getSliceAtPosition(i);t.setSlice(a)}break;case Ot.X:t.setSlice(i[0]);break;case Ot.Y:t.setSlice(i[1]);break;case Ot.Z:t.setSlice(i[2]);break}},t.setXSlice=r=>{t.setSlicingMode(Ot.X),t.setSlice(r)},t.setYSlice=r=>{t.setSlicingMode(Ot.Y),t.setSlice(r)},t.setZSlice=r=>{t.setSlicingMode(Ot.Z),t.setSlice(r)},t.setISlice=r=>{t.setSlicingMode(Ot.I),t.setSlice(r)},t.setJSlice=r=>{t.setSlicingMode(Ot.J),t.setSlice(r)},t.setKSlice=r=>{t.setSlicingMode(Ot.K),t.setSlice(r)},t.getSlicingModeNormal=()=>{const r=[0,0,0],i=t.getCurrentImage().getDirection();switch(e.slicingMode){case Ot.X:r[0]=1;break;case Ot.Y:r[1]=1;break;case Ot.Z:r[2]=1;break;case Ot.I:ep(i,[1,0,0],r);break;case Ot.J:ep(i,[0,1,0],r);break;case Ot.K:ep(i,[0,0,1],r);break}return r};function n(){let r;switch(e.slicingMode){case Ot.X:r=0;break;case Ot.Y:r=1;break;case Ot.Z:r=2;break;default:e.closestIJKAxis={ijkMode:e.slicingMode,flip:!1};return}const i=t.getCurrentImage().getDirection(),a=HS(i);let o=0;for(;o<3&&a[r+3*o]===0;++o);const s=a[r+3*o]<0;e.closestIJKAxis={ijkMode:o,flip:s}}t.setSlicingMode=r=>{e.slicingMode!==r&&(e.slicingMode=r,t.getCurrentImage()&&n(),t.modified())},t.getClosestIJKAxis=()=>((e.closestIJKAxis===void 0||e.closestIJKAxis.ijkMode===Ot.NONE)&&t.getCurrentImage()&&n(),e.closestIJKAxis),t.getBounds=()=>{const r=t.getCurrentImage();if(!r)return Oc();if(!e.useCustomExtents)return r.getBounds();const i=e.customDisplayExtent.slice(),{ijkMode:a}=t.getClosestIJKAxis();let o=e.slice;switch(a!==e.slicingMode&&(o=t.getSliceAtPosition(e.slice)),a){case Ot.I:i[0]=o,i[1]=o;break;case Ot.J:i[2]=o,i[3]=o;break;case Ot.K:i[4]=o,i[5]=o;break}return r.extentToBounds(i)},t.getBoundsForSlice=function(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:e.slice,i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;const a=t.getCurrentImage();if(!a)return Oc();const o=a.getSpatialExtent(),{ijkMode:s}=t.getClosestIJKAxis();let c=r;switch(s!==e.slicingMode&&(c=t.getSliceAtPosition(r)),s){case Ot.I:o[0]=c-i,o[1]=c+i;break;case Ot.J:o[2]=c-i,o[3]=c+i;break;case Ot.K:o[4]=c-i,o[5]=c+i;break}return a.extentToBounds(o)},t.intersectWithLineForPointPicking=(r,i)=>DX(r,i,t),t.intersectWithLineForCellPicking=(r,i)=>RX(r,i,t),t.getCurrentImage=()=>t.getInputData()}const LX={slicingMode:Ot.NONE,closestIJKAxis:{ijkMode:Ot.NONE,flip:!1},renderToRectangle:!1,sliceAtFocalPoint:!1,preferSizeOverAccuracy:!1};function $R(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,LX,n),OX.extend(t,e,n),P.get(t,e,["slicingMode"]),P.setGet(t,e,["closestIJKAxis","renderToRectangle","sliceAtFocalPoint","preferSizeOverAccuracy"]),w2.implementCoincidentTopologyMethods(t,e),bX(t,e)}const IX=P.newInstance($R,"vtkImageMapper");var VX={newInstance:IX,extend:$R,...MX,..._X,...S2};const{InterpolationType:pp}=YG,{vtkErrorMacro:v7}=P,hp=4;function PX(t,e){e.classHierarchy.push("vtkImageProperty"),t.getMTime=()=>{let n=e.mtime,r;for(let i=0;i<hp;i++)e.componentData[i].rGBTransferFunction&&(r=e.componentData[i].rGBTransferFunction.getMTime(),n=n>r?n:r),e.componentData[i].piecewiseFunction&&(r=e.componentData[i].piecewiseFunction.getMTime(),n=n>r?n:r);return n},t.setRGBTransferFunction=function(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,i=n,a=r;return Number.isInteger(n)||(a=n,i=0),e.componentData[i].rGBTransferFunction!==a?(e.componentData[i].rGBTransferFunction=a,t.modified(),!0):!1},t.getRGBTransferFunction=function(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return e.componentData[n].rGBTransferFunction},t.setPiecewiseFunction=function(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,i=n,a=r;return Number.isInteger(n)||(a=n,i=0),e.componentData[i].piecewiseFunction!==a?(e.componentData[i].piecewiseFunction=a,t.modified(),!0):!1},t.getPiecewiseFunction=function(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return e.componentData[n].piecewiseFunction},t.setScalarOpacity=function(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,i=n,a=r;return Number.isInteger(n)||(a=n,i=0),t.setPiecewiseFunction(i,a)},t.getScalarOpacity=function(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return t.getPiecewiseFunction(n)},t.setComponentWeight=function(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;if(n<0||n>=hp)return v7("Invalid index"),!1;const i=Math.min(1,Math.max(0,r));return e.componentData[n].componentWeight!==i?(e.componentData[n].componentWeight=i,t.modified(),!0):!1},t.getComponentWeight=function(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return n<0||n>=hp?(v7("Invalid index"),0):e.componentData[n].componentWeight},t.setInterpolationTypeToNearest=()=>t.setInterpolationType(pp.NEAREST),t.setInterpolationTypeToLinear=()=>t.setInterpolationType(pp.LINEAR),t.getInterpolationTypeAsString=()=>P.enumToString(pp,e.interpolationType)}const NX={independentComponents:!1,interpolationType:pp.LINEAR,colorWindow:255,colorLevel:127.5,ambient:1,diffuse:0,opacity:1,useLookupTableScalarRange:!1,useLabelOutline:!1,labelOutlineThickness:[1],labelOutlineOpacity:1};function kX(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(Object.assign(e,NX,n),P.obj(t,e),!e.componentData){e.componentData=[];for(let r=0;r<hp;r++)e.componentData.push({rGBTransferFunction:null,piecewiseFunction:null,componentWeight:1})}P.setGet(t,e,["independentComponents","interpolationType","colorWindow","colorLevel","ambient","diffuse","opacity","useLookupTableScalarRange","useLabelOutline","labelOutlineOpacity"]),P.setGetArray(t,e,["labelOutlineThickness"]),PX(t,e)}const AX=P.newInstance(kX,"vtkImageProperty");var FX={newInstance:AX};const{vtkDebugMacro:UX}=P;function BX(t,e){e.classHierarchy.push("vtkImageSlice"),t.getActors=()=>t,t.getImages=()=>t,t.getIsOpaque=()=>{if(e.forceOpaque)return!0;if(e.forceTranslucent)return!1;e.property||t.getProperty();let n=e.property.getOpacity()>=1;return n=n&&(!e.mapper||e.mapper.getIsOpaque()),n},t.hasTranslucentPolygonalGeometry=()=>!1,t.makeProperty=FX.newInstance,t.getProperty=()=>(e.property===null&&(e.property=t.makeProperty()),e.property),t.getBounds=()=>{if(e.mapper===null)return e.bounds;const n=e.mapper.getBounds();if(!n||n.length!==6)return n;if(n[0]>n[1])return e.mapperBounds=n.concat(),e.bounds=[1,-1,1,-1,1,-1],e.boundsMTime.modified(),n;const r=i=>i[0].map((a,o)=>i.map(s=>s[o]));if(!e.mapperBounds||!r([n,e.mapperBounds]).reduce((i,a)=>i&&a[0]===a[1],!0)||t.getMTime()>e.boundsMTime.getMTime()){UX("Recomputing bounds..."),e.mapperBounds=n.map(a=>a),t.computeMatrix();const i=new Float64Array(16);ft(i,e.matrix),Nt.transformBounds(n,i,e.bounds),e.boundsMTime.modified()}return e.bounds},t.getBoundsForSlice=(n,r)=>{const i=e.mapper.getBoundsForSlice(n,r);if(!Nt.isValid(i))return i;t.computeMatrix();const a=new Float64Array(16);return ft(a,e.matrix),Nt.transformBounds(i,a)},t.getMinXBound=()=>t.getBounds()[0],t.getMaxXBound=()=>t.getBounds()[1],t.getMinYBound=()=>t.getBounds()[2],t.getMaxYBound=()=>t.getBounds()[3],t.getMinZBound=()=>t.getBounds()[4],t.getMaxZBound=()=>t.getBounds()[5],t.getMTime=()=>{let n=e.mtime;if(e.property!==null){const r=e.property.getMTime();n=r>n?r:n}return n},t.getRedrawMTime=()=>{let n=e.mtime;if(e.mapper!==null){let r=e.mapper.getMTime();n=r>n?r:n,e.mapper.getInput()!==null&&(e.mapper.getInputAlgorithm().update(),r=e.mapper.getInput().getMTime(),n=r>n?r:n)}if(e.property!==null){let r=e.property.getMTime();n=r>n?r:n,e.property.getRGBTransferFunction()!==null&&(r=e.property.getRGBTransferFunction().getMTime(),n=r>n?r:n)}return n},t.getSupportsSelection=()=>e.mapper?e.mapper.getSupportsSelection():!1}const GX={mapper:null,property:null,forceOpaque:!1,forceTranslucent:!1,bounds:[...Nt.INIT_BOUNDS]};function WR(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,GX,n),my.extend(t,e,n),e.boundsMTime={},P.obj(e.boundsMTime),P.set(t,e,["property"]),P.setGet(t,e,["mapper","forceOpaque","forceTranslucent"]),P.getArray(t,e,["bounds"],6),BX(t,e)}const $X=P.newInstance(WR,"vtkImageSlice");var WX={newInstance:$X,extend:WR};function zR(t){const e=Dc.newInstance();let n=0,r=1024;return t.lower!==void 0&&t.upper!==void 0&&(n=t.lower,r=t.upper),e.addRGBPoint(n,0,0,0),e.addRGBPoint(r,1,1,1),e}function D2(t,e){const n=e.voxelManager.getScalarData();if(!t.getPointData)return;const r=t.getPointData().getScalars().getData();if(e.color&&e.rgba){const i=new Uint8Array(e.columns*e.rows*3);for(let a=0;a<e.columns*e.rows;a++)i[a*3]=n[a*4],i[a*3+1]=n[a*4+1],i[a*3+2]=n[a*4+2];e.rgba=!1,e.getPixelData=()=>i,r.set(i)}else r.set(n);t.modified()}function gt(){return window.performance?performance.now():Date.now()}function zX(t,e){return function(n){const r=((n-(e-.5))/(t-1)+.5)*255;return Math.min(Math.max(r,0),255)}}function jX(t){const n=Math.max(...t.lut).toString(2).length-8,r=t.lut[0]>>n,i=t.lut[t.lut.length-1]>>n,a=t.firstValueMapped+t.lut.length-1;return function(o){return o<t.firstValueMapped?r:o>=a?i:t.lut[o-t.firstValueMapped]>>n}}function jR(t,e,n){return n?jX(n):zX(t,e)}function HX(t,e,n,r,i){const a=t.maxPixelValue,o=t.minPixelValue,s=Math.min(o,0);if(t.cachedLut===void 0){const f=a-s+1;t.cachedLut={},t.cachedLut.lutArray=new Uint8ClampedArray(f)}const c=t.cachedLut.lutArray,l=jR(Array.isArray(e)?e[0]:e,Array.isArray(n)?n[0]:n,i);if(r)for(let f=o;f<=a;f++)c[f+-s]=255-l(f);else for(let f=o;f<=a;f++)c[f+-s]=l(f);return c}function KX(t,e,n){let r=gt();const i=t.voxelManager.getScalarData();t.stats.lastGetPixelDataTime=gt()-r;const a=t.minPixelValue;let o=0,s=0;const c=i.length;if(r=gt(),a<0)for(;s<c;)n[o++]=e[i[s++]+-a],n[o++]=e[i[s++]+-a],n[o]=e[i[s]+-a],s+=2,o+=2;else for(;s<c;)n[o++]=e[i[s++]],n[o++]=e[i[s++]],n[o]=e[i[s]],s+=2,o+=2;t.stats.lastStoredPixelDataToCanvasImageDataTime=gt()-r}function qX(t,e,n){let r=gt();const i=t.getPixelData();t.stats.lastGetPixelDataTime=gt()-r;const a=t.minPixelValue;let o=0,s=0;const c=i.length;if(r=gt(),a<0)for(;s<c;)n[o++]=e[i[s++]+-a],n[o++]=e[i[s++]+-a],n[o++]=e[i[s++]+-a],n[o++]=i[s++];else for(;s<c;)n[o++]=e[i[s++]],n[o++]=e[i[s++]],n[o++]=e[i[s++]],n[o++]=i[s++];t.stats.lastStoredPixelDataToCanvasImageDataTime=gt()-r}class tf{constructor(){this.reset()}getMatrix(){return this.m}reset(){this.m=[1,0,0,1,0,0]}clone(){const e=new tf;return e.m[0]=this.m[0],e.m[1]=this.m[1],e.m[2]=this.m[2],e.m[3]=this.m[3],e.m[4]=this.m[4],e.m[5]=this.m[5],e}multiply(e){const n=this.m[0]*e[0]+this.m[2]*e[1],r=this.m[1]*e[0]+this.m[3]*e[1],i=this.m[0]*e[2]+this.m[2]*e[3],a=this.m[1]*e[2]+this.m[3]*e[3],o=this.m[0]*e[4]+this.m[2]*e[5]+this.m[4],s=this.m[1]*e[4]+this.m[3]*e[5]+this.m[5];this.m[0]=n,this.m[1]=r,this.m[2]=i,this.m[3]=a,this.m[4]=o,this.m[5]=s}invert(){const e=1/(this.m[0]*this.m[3]-this.m[1]*this.m[2]),n=this.m[3]*e,r=-this.m[1]*e,i=-this.m[2]*e,a=this.m[0]*e,o=e*(this.m[2]*this.m[5]-this.m[3]*this.m[4]),s=e*(this.m[1]*this.m[4]-this.m[0]*this.m[5]);this.m[0]=n,this.m[1]=r,this.m[2]=i,this.m[3]=a,this.m[4]=o,this.m[5]=s}rotate(e){const n=Math.cos(e),r=Math.sin(e),i=this.m[0]*n+this.m[2]*r,a=this.m[1]*n+this.m[3]*r,o=this.m[0]*-r+this.m[2]*n,s=this.m[1]*-r+this.m[3]*n;this.m[0]=i,this.m[1]=a,this.m[2]=o,this.m[3]=s}translate(e,n){this.m[4]+=this.m[0]*e+this.m[2]*n,this.m[5]+=this.m[1]*e+this.m[3]*n}scale(e,n){this.m[0]*=e,this.m[1]*=e,this.m[2]*=n,this.m[3]*=n}transformPoint(e){const n=e[0],r=e[1];return[n*this.m[0]+r*this.m[2]+this.m[4],n*this.m[1]+r*this.m[3]+this.m[5]]}}function Hg(t,e){const n=new tf;if(!t.viewport.displayedArea)return n;n.translate(t.canvas.width/2,t.canvas.height/2);const r=t.viewport.rotation;r!==0&&n.rotate(r*Math.PI/180);let i=t.viewport.scale,a=t.viewport.scale;const o=t.viewport.displayedArea.brhc.x-(t.viewport.displayedArea.tlhc.x-1),s=t.viewport.displayedArea.brhc.y-(t.viewport.displayedArea.tlhc.y-1);if(t.viewport.displayedArea.presentationSizeMode==="NONE")t.image.rowPixelSpacing<t.image.columnPixelSpacing?i*=t.image.columnPixelSpacing/t.image.rowPixelSpacing:t.image.columnPixelSpacing<t.image.rowPixelSpacing&&(a*=t.image.rowPixelSpacing/t.image.columnPixelSpacing);else if(i=t.viewport.displayedArea.columnPixelSpacing,a=t.viewport.displayedArea.rowPixelSpacing,t.viewport.displayedArea.presentationSizeMode==="SCALE TO FIT"){const c=t.canvas.height/(s*a),l=t.canvas.width/(o*i);i=a=Math.min(l,c),t.viewport.displayedArea.rowPixelSpacing<t.viewport.displayedArea.columnPixelSpacing?i*=t.viewport.displayedArea.columnPixelSpacing/t.viewport.displayedArea.rowPixelSpacing:t.viewport.displayedArea.columnPixelSpacing<t.viewport.displayedArea.rowPixelSpacing&&(a*=t.viewport.displayedArea.rowPixelSpacing/t.viewport.displayedArea.columnPixelSpacing)}return n.scale(i,a),r!==0&&n.rotate(-r*Math.PI/180),n.translate(t.viewport.translation.x,t.viewport.translation.y),r!==0&&n.rotate(r*Math.PI/180),t.viewport.hflip&&n.scale(-1,1),t.viewport.vflip&&n.scale(1,-1),n.translate(-o/2,-s/2),n}function _y(t,e,n){if(t===void 0)throw new Error("setToPixelCoordinateSystem: parameter enabledElement must not be undefined");if(e===void 0)throw new Error("setToPixelCoordinateSystem: parameter context must not be undefined");const i=Hg(t).getMatrix();e.setTransform(i[0],i[1],i[2],i[3],i[4],i[5])}function by(t,e){const n=t.renderingTools.lastRenderedImageId,r=t.renderingTools.lastRenderedViewport;return e.imageId!==n||!r||r.windowCenter!==t.viewport.voi.windowCenter||r.windowWidth!==t.viewport.voi.windowWidth||r.invert!==t.viewport.invert||r.rotation!==t.viewport.rotation||r.hflip!==t.viewport.hflip||r.vflip!==t.viewport.vflip||r.modalityLUT!==t.viewport.modalityLUT||r.voiLUT!==t.viewport.voiLUT||r.colormap!==t.viewport.colormap}function Rh(t,e){const n=t.renderingTools.renderCanvas;n.width=e.width,n.height=e.height;const r=n.getContext("2d");r.fillStyle="white",r.fillRect(0,0,n.width,n.height);const i=r.getImageData(0,0,e.width,e.height);t.renderingTools.renderCanvasContext=r,t.renderingTools.renderCanvasData=i}function Ly(t){const e=t.image.imageId,n=t.viewport,r=t.image.color;return t.renderingTools.lastRenderedImageId=e,t.renderingTools.lastRenderedIsColor=r,t.renderingTools.lastRenderedViewport={windowCenter:n.voi.windowCenter,windowWidth:n.voi.windowWidth,invert:n.invert,rotation:n.rotation,hflip:n.hflip,vflip:n.vflip,modalityLUT:n.modalityLUT,voiLUT:n.voiLUT,colormap:n.colormap},t.renderingTools}function XX(t,e){return t.cachedLut!==void 0&&t.cachedLut.windowCenter===e.voi.windowCenter&&t.cachedLut.windowWidth===e.voi.windowWidth&&t.cachedLut.invert===e.invert||(HX(t,e.voi.windowWidth,e.voi.windowCenter,e.invert),t.cachedLut.windowWidth=e.voi.windowWidth,t.cachedLut.windowCenter=e.voi.windowCenter,t.cachedLut.invert=e.invert),t.cachedLut.lutArray}function YX(t,e,n){const r=t.renderingTools.lastRenderedIsColor;(!t.renderingTools.renderCanvas||!r)&&(t.renderingTools.renderCanvas=document.createElement("canvas"));const i=t.renderingTools.renderCanvas,{windowWidth:a,windowCenter:o}=t.viewport.voi;if((a===256||a===255)&&(o===128||o===127)&&!t.viewport.invert&&e.getCanvas&&e.getCanvas())return e.getCanvas();if(!by(t,e)&&!n)return i;(i.width!==e.width||i.height!==e.height)&&Rh(t,e);let s=gt();const c=XX(e,t.viewport);e.stats=e.stats||{},e.stats.lastLutGenerateTime=gt()-s;const l=t.renderingTools.renderCanvasData,f=t.renderingTools.renderCanvasContext;return e.rgba?qX(e,c,l.data):KX(e,c,l.data),s=gt(),f.putImageData(l,0,0),e.stats.lastPutImageDataTime=gt()-s,i}function ZX(t,e){if(t===void 0)throw new Error("renderColorImage: enabledElement parameter must not be undefined");const n=t.image;if(n===void 0)throw new Error("renderColorImage: image must be loaded before it can be drawn");const r=t.canvas.getContext("2d");r.setTransform(1,0,0,1,0,0),r.fillStyle="black",r.fillRect(0,0,t.canvas.width,t.canvas.height),r.imageSmoothingEnabled=!t.viewport.pixelReplication,_y(t,r);const i=YX(t,n,e),a=t.viewport.displayedArea.tlhc.x-1,o=t.viewport.displayedArea.tlhc.y-1,s=t.viewport.displayedArea.brhc.x-a,c=t.viewport.displayedArea.brhc.y-o;r.drawImage(i,a,o,s,c,0,0,s,c),t.renderingTools=Ly(t)}function QX(t,e,n){let r=gt();const i=t.voxelManager.getScalarData();t.stats.lastGetPixelDataTime=gt()-r;const a=i.length,o=t.minPixelValue;let s=3,c=0;if(r=gt(),i instanceof Int16Array)if(o<0)for(;c<a;)n[s]=e[i[c++]+-o],s+=4;else for(;c<a;)n[s]=e[i[c++]],s+=4;else if(i instanceof Uint16Array)for(;c<a;)n[s]=e[i[c++]],s+=4;else if(o<0)for(;c<a;)n[s]=e[i[c++]+-o],s+=4;else for(;c<a;)n[s]=e[i[c++]],s+=4;t.stats.lastStoredPixelDataToCanvasImageDataTime=gt()-r}function JX(t,e,n){let r=gt();const i=t.voxelManager.getScalarData();t.stats.lastGetPixelDataTime=gt()-r;const a=i.length;let o=3,s=0;for(r=gt();s<a;)n[o]=e(i[s++]),o+=4;t.stats.lastStoredPixelDataToCanvasImageDataTime=gt()-r}function eY(t,e,n){let r=gt();const i=t.voxelManager.getScalarData();t.stats.lastGetPixelDataTime=gt()-r;const a=i.length,o=t.minPixelValue;let s=0,c=0,l;if(r=gt(),i instanceof Int16Array)if(o<0)for(;c<a;)l=e[i[c++]+-o],n[s++]=l,n[s++]=l,n[s++]=l,n[s++]=255;else for(;c<a;)l=e[i[c++]],n[s++]=l,n[s++]=l,n[s++]=l,n[s++]=255;else if(i instanceof Uint16Array)for(;c<a;)l=e[i[c++]],n[s++]=l,n[s++]=l,n[s++]=l,n[s++]=255;else if(o<0)for(;c<a;)l=e[i[c++]+-o],n[s++]=l,n[s++]=l,n[s++]=l,n[s++]=255;else for(;c<a;)l=e[i[c++]],n[s++]=l,n[s++]=l,n[s++]=l,n[s++]=255;t.stats.lastStoredPixelDataToCanvasImageDataTime=gt()-r}function tY(t,e){if(nY(t))return;const n=e.maxPixelValue*e.slope+e.intercept,r=e.minPixelValue*e.slope+e.intercept,i=n-r,a=(n+r)/2;t.voi===void 0?t.voi={windowWidth:i,windowCenter:a,voiLUTFunction:e.voiLUTFunction}:(t.voi.windowWidth=i,t.voi.windowCenter=a)}function nY(t){return t.voiLUT&&t.voiLUT.lut&&t.voiLUT.lut.length>0||t.voi.windowWidth!==void 0&&t.voi.windowCenter!==void 0}function y7(t,e){return!t&&!e?!0:!t||!e?!1:t.id===e.id}function rY(t,e){return n=>n*t+e}function iY(t){const e=t.lut[0],n=t.lut[t.lut.length-1],r=t.firstValueMapped+t.lut.length;return i=>i<t.firstValueMapped?e:i>=r?n:t.lut[i]}function aY(t,e,n){return n?iY(n):rY(t,e)}function oY(t,e,n,r,i,a){const o=t.maxPixelValue,s=t.minPixelValue,c=Math.min(s,0);if(t.cachedLut===void 0){const g=o-c+1;t.cachedLut={},t.cachedLut.lutArray=new Uint8ClampedArray(g)}const l=t.cachedLut.lutArray,f=aY(t.slope,t.intercept,i),u=jR(e,n,a);if(t.isPreScaled)if(r)for(let g=s;g<=o;g++)l[g+-c]=255-u(g);else for(let g=s;g<=o;g++)l[g+-c]=u(g);else if(r)for(let g=s;g<=o;g++)l[g+-c]=255-u(f(g));else for(let g=s;g<=o;g++)l[g+-c]=u(f(g));return l}function HR(t,e,n){return t.cachedLut!==void 0&&t.cachedLut.windowCenter===e.voi.windowCenter&&t.cachedLut.windowWidth===e.voi.windowWidth&&y7(t.cachedLut.modalityLUT,e.modalityLUT)&&y7(t.cachedLut.voiLUT,e.voiLUT)&&t.cachedLut.invert===e.invert&&!n||(tY(e,t),oY(t,e.voi.windowWidth,e.voi.windowCenter,e.invert,e.modalityLUT,e.voiLUT),t.cachedLut.windowWidth=e.voi.windowWidth,t.cachedLut.windowCenter=e.voi.windowCenter,t.cachedLut.invert=e.invert,t.cachedLut.voiLUT=e.voiLUT,t.cachedLut.modalityLUT=e.modalityLUT),t.cachedLut.lutArray}function sY(t,e,n,r=!0){const i=t.renderingTools.lastRenderedIsColor;(!t.renderingTools.renderCanvas||i)&&(t.renderingTools.renderCanvas=document.createElement("canvas"),Rh(t,e));const a=t.renderingTools.renderCanvas;if(!by(t,e)&&!n)return a;(a.width!==e.width||a.height!==e.height)&&Rh(t,e),e.stats=e.stats||{};const o=t.renderingTools.renderCanvasData,s=t.renderingTools.renderCanvasContext;let c=gt();e.stats.lastLutGenerateTime=gt()-c;const{viewport:l}=t;if(l.modality==="PT"&&e.isPreScaled){const{windowWidth:f,windowCenter:u}=l.voi,g=u-f/2,p=255/(u+f/2-g);let m;l.invert?m=v=>255-(v-g)*p:m=v=>(v-g)*p,JX(e,m,o.data)}else{const f=HR(e,l,n);r?QX(e,f,o.data):eY(e,f,o.data)}return c=gt(),s.putImageData(o,0,0),e.stats.lastPutImageDataTime=gt()-c,a}function cY(t,e){if(t===void 0)throw new Error("drawImage: enabledElement parameter must not be undefined");const n=t.image;if(n===void 0)throw new Error("drawImage: image must be loaded before it can be drawn");const r=t.canvas.getContext("2d");r.setTransform(1,0,0,1,0,0),r.fillStyle="black",r.fillRect(0,0,t.canvas.width,t.canvas.height),r.imageSmoothingEnabled=!t.viewport.pixelReplication,_y(t,r);const i=sY(t,n,e),a=t.viewport.displayedArea.tlhc.x-1,o=t.viewport.displayedArea.tlhc.y-1,s=t.viewport.displayedArea.brhc.x-a,c=t.viewport.displayedArea.brhc.y-o;r.drawImage(i,a,o,s,c,0,0,s,c),t.renderingTools=Ly(t)}const X3=0,Y3=1,lY=2;function uY(t,e,n){if(t>1)throw new Error("HSVToRGB expects hue < 1");const r=[];if(e===0)return r[0]=n,r[1]=n,r[2]=n,r;const i=Math.floor(t*6),a=6*t-i,o=n*(1-e),s=n*(1-e*a),c=n*(1-e*(1-a));switch(i){case 0:case 6:r[0]=n,r[1]=c,r[2]=o;break;case 1:r[0]=s,r[1]=n,r[2]=o;break;case 2:r[0]=o,r[1]=n,r[2]=c;break;case 3:r[0]=o,r[1]=s,r[2]=n;break;case 4:r[0]=c,r[1]=o,r[2]=n;break;case 5:r[0]=n,r[1]=o,r[2]=s;break}return r}function fY(t,e){let n;return t<e.Range[0]?n=e.MaxIndex+X3+1.5:t>e.Range[1]?n=e.MaxIndex+Y3+1.5:n=(t+e.Shift)*e.Scale,Math.floor(n)}class Iy{constructor(){this.NumberOfColors=256,this.Ramp="linear",this.TableRange=[0,255],this.HueRange=[0,.66667],this.SaturationRange=[1,1],this.ValueRange=[1,1],this.AlphaRange=[1,1],this.NaNColor=[128,0,0,255],this.BelowRangeColor=[0,0,0,255],this.UseBelowRangeColor=!0,this.AboveRangeColor=[255,255,255,255],this.UseAboveRangeColor=!0,this.InputRange=[0,255],this.Table=[]}setNumberOfTableValues(e){this.NumberOfColors=e}setRamp(e){this.Ramp=e}setTableRange(e,n){this.TableRange[0]=e,this.TableRange[1]=n}setHueRange(e,n){this.HueRange[0]=e,this.HueRange[1]=n}setSaturationRange(e,n){this.SaturationRange[0]=e,this.SaturationRange[1]=n}setValueRange(e,n){this.ValueRange[0]=e,this.ValueRange[1]=n}setRange(e,n){this.InputRange[0]=e,this.InputRange[1]=n}setAlphaRange(e,n){this.AlphaRange[0]=e,this.AlphaRange[1]=n}getColor(e){return this.mapValue(e)}build(e){if(this.Table.length>1&&!e)return;this.Table=[];const n=this.NumberOfColors-1;let r,i,a,o;n?(r=(this.HueRange[1]-this.HueRange[0])/n,i=(this.SaturationRange[1]-this.SaturationRange[0])/n,a=(this.ValueRange[1]-this.ValueRange[0])/n,o=(this.AlphaRange[1]-this.AlphaRange[0])/n):r=i=a=o=0;for(let s=0;s<=n;s++){const c=this.HueRange[0]+s*r,l=this.SaturationRange[0]+s*i,f=this.ValueRange[0]+s*a,u=this.AlphaRange[0]+s*o,g=uY(c,l,f),d=[0,0,0,0];switch(this.Ramp){case"scurve":d[0]=Math.floor(127.5*(1+Math.cos((1-g[0])*Math.PI))),d[1]=Math.floor(127.5*(1+Math.cos((1-g[1])*Math.PI))),d[2]=Math.floor(127.5*(1+Math.cos((1-g[2])*Math.PI))),d[3]=Math.floor(u*255);break;case"linear":d[0]=Math.floor(g[0]*255+.5),d[1]=Math.floor(g[1]*255+.5),d[2]=Math.floor(g[2]*255+.5),d[3]=Math.floor(u*255+.5);break;case"sqrt":d[0]=Math.floor(Math.sqrt(g[0])*255+.5),d[1]=Math.floor(Math.sqrt(g[1])*255+.5),d[2]=Math.floor(Math.sqrt(g[2])*255+.5),d[3]=Math.floor(Math.sqrt(u)*255+.5);break;default:throw new Error(`Invalid Ramp value (${this.Ramp})`)}this.Table.push(d)}this.buildSpecialColors()}buildSpecialColors(){const e=this.NumberOfColors,n=e+X3,r=e+Y3,i=e+lY;this.UseBelowRangeColor||e===0?this.Table[n]=this.BelowRangeColor:this.Table[n]=this.Table[0],this.UseAboveRangeColor||e===0?this.Table[r]=this.AboveRangeColor:this.Table[r]=this.Table[e-1],this.Table[i]=this.NaNColor}mapValue(e){const n=this.getIndex(e);if(n<0)return this.NaNColor;if(n===0){if(this.UseBelowRangeColor&&e<this.TableRange[0])return this.BelowRangeColor}else if(n===this.NumberOfColors-1&&this.UseAboveRangeColor&&e>this.TableRange[1])return this.AboveRangeColor;return this.Table[n]}getIndex(e){const n={Range:[],MaxIndex:this.NumberOfColors-1,Shift:-this.TableRange[0],Scale:1};if(this.TableRange[1]<=this.TableRange[0]?n.Scale=Number.MAX_VALUE:n.Scale=n.MaxIndex/(this.TableRange[1]-this.TableRange[0]),n.Range[0]=this.TableRange[0],n.Range[1]=this.TableRange[1],isNaN(e))return-1;let r=fY(e,n);return r===this.NumberOfColors+X3?r=0:r===this.NumberOfColors+Y3&&(r=this.NumberOfColors-1),r}setTableValue(e,n,r,i,a){let o;if(typeof n=="number"&&r!==void 0&&i!==void 0&&a!==void 0)o=[n,r,i,a];else if(Array.isArray(n))o=n;else throw new Error("Invalid arguments for setTableValue");if(e<0)throw new Error(`Can't set the table value for negative index (${e})`);if(e>=this.NumberOfColors)throw new Error(`Index ${e} is greater than the number of colors ${this.NumberOfColors}`);this.Table[e]=o,(e===0||e===this.NumberOfColors-1)&&this.buildSpecialColors()}}const T7=[0,0,0,0];function gY(t,e,n){n=n===null?100:n;const r=(e-t)/(n-1),i=[];for(;n-- >0;)i.push(t),t+=r;return i[i.length-1]=e,i}function dY(t,e){let n=0,r=t.length-1;for(;n<=r;){const i=n+Math.floor((r-n)/2),a=t[i];if(a===e)return i;e<a?r=i-1:n=i+1}return n}function pY(t,e){let n;const r=[],i=e.length;for(t.sort(function(a,o){return a-o}),n=0;n<i;n++)r[n]=dY(t,e[n]);return r}function z5(t,e,n){let r;const i=[],a=[],o=[],s=[];for(n=n===null?1:n,r=0;r<e.length;r++){const f=e[r];i.push((t-1)*f[0]),a.push(f[1]),o.push(f[1])}const c=gY(0,1,t);for(r=0;r<t;r++)c[r]=(t-1)*Math.pow(c[r],n);const l=pY(i,c);for(r=1;r<t-1;r++){const f=l[r],u=(c[r]-i[f-1])/(i[f]-i[f-1]),g=a[f]-o[f-1];s[r]=u*g+o[f-1]}return s[0]=o[0],s[t-1]=a[e.length-1],s}function hY(t,e,n){let r;const i=[];e=e===null?256:e,n=n===null?1:n;const a=z5(e,t.red,n),o=z5(e,t.green,n),s=z5(e,t.blue,n);for(r=0;r<e;r++){const c=Math.round(a[r]*255),l=Math.round(o[r]*255),f=Math.round(s[r]*255),u=[c,l,f,255];i.push(u)}return i}function mY(t,e){let n=T3[t];return n||(n=T3[t]={name:"",colors:[]}),!n.colors&&n.segmentedData&&(n.colors=hY(n.segmentedData,n.numColors,n.gamma)),{getId(){return t},getColorSchemeName(){return n.name},setColorSchemeName(i){n.name=i},getNumberOfColors(){return n.colors.length},setNumberOfColors(i){for(;n.colors.length<i;)n.colors.push(T7);n.colors.length=i},getColor(i){return this.isValidIndex(i)?n.colors[i]:T7},getColorRepeating(i){const a=n.colors.length;return i=a?i%a:0,this.getColor(i)},setColor(i,a){this.isValidIndex(i)&&(n.colors[i]=a)},addColor(i){n.colors.push(i)},insertColor(i,a){this.isValidIndex(i)&&n.colors.splice(i,1,a)},removeColor(i){this.isValidIndex(i)&&n.colors.splice(i,1)},clearColors(){n.colors=[]},buildLookupTable(i){if(!i)return;const a=n.colors.length;i.setNumberOfTableValues(a);for(let o=0;o<a;o++)i.setTableValue(o,n.colors[o])},createLookupTable(){const i=new Iy;return this.buildLookupTable(i),i},isValidIndex(i){return i>=0&&i<n.colors.length}}}function vY(t,e,n,r){let i=gt();const a=t.voxelManager.getScalarData();t.stats.lastGetPixelDataTime=gt()-i;const o=a.length,s=t.minPixelValue;let c=0,l=0,f,u,g;if(i=gt(),n instanceof Iy?g=n.Table:g=n,s<0)for(;l<o;)f=e[a[l++]+-s],u=g[f],r[c++]=u[0],r[c++]=u[1],r[c++]=u[2],r[c++]=u[3];else for(;l<o;)f=e[a[l++]],u=g[f],r[c++]=u[0],r[c++]=u[1],r[c++]=u[2],r[c++]=u[3];t.stats.lastStoredPixelDataToCanvasImageDataTime=gt()-i}function yY(t,e,n,r){let i=gt();const a=t.voxelManager.getScalarData();t.stats.lastGetPixelDataTime=gt()-i;const o=a.length,s=t.minPixelValue;let c=0,l=0,f,u,g;if(i=gt(),n instanceof Iy?g=n.Table:g=n,s<0)for(;l<o;)f=e(a[l++]+-s),u=g[f],r[c++]=u[0],r[c++]=u[1],r[c++]=u[2],r[c++]=u[3];else for(;l<o;)f=e(a[l++]),u=g[f],r[c++]=u[0],r[c++]=u[1],r[c++]=u[2],r[c++]=u[3];t.stats.lastStoredPixelDataToCanvasImageDataTime=gt()-i}function Z3(t,e,n){return Math.max(e,Math.min(n,t))}function TY(t,e,n){t.renderingTools.renderCanvas||(t.renderingTools.renderCanvas=document.createElement("canvas"));const r=t.renderingTools.renderCanvas;let i=t.viewport.colormap||t.options.colormap;if(t.options&&t.options.colormap&&console.warn("enabledElement.options.colormap is deprecated. Use enabledElement.viewport.colormap instead"),i&&typeof i=="string"&&(i=mY(i)),!i)throw new Error("renderPseudoColorImage: colormap not found.");const a=i.getId();if(!by(t,e)&&!n&&t.renderingTools.colormapId===a)return r;(r.width!==e.width||r.height!==e.height)&&Rh(t,e);let o=gt();(!t.renderingTools.colorLUT||n||t.renderingTools.colormapId!==a)&&(i.setNumberOfColors(256),t.renderingTools.colorLUT=i.createLookupTable(),t.renderingTools.colormapId=a);const s=t.renderingTools.renderCanvasData,c=t.renderingTools.renderCanvasContext,{viewport:l}=t,f=t.renderingTools.colorLUT;if(l.modality==="PT"){const{windowWidth:u,windowCenter:g}=l.voi,d=g-u/2,m=255/(g+u/2-d);let v;l.invert?v=y=>Z3(Math.floor(255-(y-d)*m),0,255):v=y=>Z3(Math.floor((y-d)*m),0,255),yY(e,v,f,s.data)}else{const u=HR(e,t.viewport,n);e.stats=e.stats||{},e.stats.lastLutGenerateTime=gt()-o,vY(e,u,f,s.data)}return o=gt(),c.putImageData(s,0,0),e.stats.lastPutImageDataTime=gt()-o,r}function CY(t,e){if(t===void 0)throw new Error("drawImage: enabledElement parameter must not be undefined");const n=t.image;if(n===void 0)throw new Error("drawImage: image must be loaded before it can be drawn");const r=t.canvas.getContext("2d");r.setTransform(1,0,0,1,0,0),r.fillStyle="black",r.fillRect(0,0,t.canvas.width,t.canvas.height),r.imageSmoothingEnabled=!t.viewport.pixelReplication,_y(t,r);const i=TY(t,n,e),a=t.viewport.displayedArea.tlhc.x-1,o=t.viewport.displayedArea.tlhc.y-1,s=t.viewport.displayedArea.brhc.x-a,c=t.viewport.displayedArea.brhc.y-o;r.drawImage(i,a,o,s,c,0,0,s,c),t.renderingTools=Ly(t)}function KR(t,e){const n=t.image;if(!t.canvas||!t.image)return;const r=gt();if(n.stats={lastGetPixelDataTime:-1,lastStoredPixelDataToCanvasImageDataTime:-1,lastPutImageDataTime:-1,lastRenderTime:-1,lastLutGenerateTime:-1},n){let a=n.render;a||(t.viewport.colormap?a=CY:n.color?a=ZX:a=cY),a(t,e)}const i=gt()-r;n.stats.lastRenderTime=i,t.invalid=!1,t.needsRedraw=!1}function qR(t){return Hg(t)}function h1(t,e){const n=qR(t);return n.invert(),n.transformPoint(e)}const wY={viewport:{}};function xY(){return{tlhc:{x:1,y:1},brhc:{x:1,y:1},rowPixelSpacing:1,columnPixelSpacing:1,presentationSizeMode:"NONE"}}function SY(){const t=xY(),e={scale:1,translation:{x:0,y:0},voi:{windowWidth:void 0,windowCenter:void 0,voiLUTFunction:ui.LINEAR},invert:!1,pixelReplication:!1,rotation:0,hflip:!1,vflip:!1,modalityLUT:void 0,voiLUT:void 0,colormap:void 0,labelmap:!1,displayedArea:t};return Object.assign({},e,wY.viewport)}function lg(t,e){if(t==null)throw new Error(e)}function EY(t){return!(t==null||t===0||t===180)}function XR(t,e=null){return lg(t,"getImageSize: parameter image must not be undefined"),lg(t.width,"getImageSize: parameter image must have width"),lg(t.height,"getImageSize: parameter image must have height"),EY(e)?{height:t.width,width:t.height}:{width:t.width,height:t.height}}function Vy(t,e,n=null){lg(t,"getImageScale: parameter canvas must not be undefined"),lg(e,"getImageScale: parameter image must not be undefined");const r=XR(e,n),i=e.rowPixelSpacing||1,a=e.columnPixelSpacing||1;let o=1,s=1;i<a?s=a/i:o=i/a;const c=t.height/r.height/o,l=t.width/r.width/s;return{verticalScale:c,horizontalScale:l,scaleFactor:Math.min(l,c)}}function YR(t,e,n,r){if(t===void 0)throw new Error("getDefaultViewport: parameter canvas must not be undefined");if(e===void 0)return SY();const i=Vy(t,e,0).scaleFactor;let a;return n==="PT"&&e.isPreScaled?a={windowWidth:5,windowCenter:2.5}:e.windowWidth!==void 0&&e.windowCenter!==void 0&&(a={windowWidth:Array.isArray(e.windowWidth)?e.windowWidth[0]:e.windowWidth,windowCenter:Array.isArray(e.windowCenter)?e.windowCenter[0]:e.windowCenter}),{scale:i,translation:{x:0,y:0},voi:a,invert:e.invert,pixelReplication:!1,rotation:0,hflip:!1,vflip:!1,modalityLUT:e.modalityLUT,modality:n,voiLUT:e.voiLUT,colormap:r!==void 0?r:e.colormap,displayedArea:{tlhc:{x:1,y:1},brhc:{x:e.columns,y:e.rows},rowPixelSpacing:e.rowPixelSpacing===void 0?1:e.rowPixelSpacing,columnPixelSpacing:e.columnPixelSpacing===void 0?1:e.columnPixelSpacing,presentationSizeMode:"NONE"}}}function C7(t,e){return qR(t).transformPoint(e)}function OY(t){const{image:e}=t;t.viewport.scale=Vy(t.canvas,e,t.viewport.rotation).scaleFactor,t.viewport.translation.x=0,t.viewport.translation.y=0}function DY(t){const{canvas:e}=t,{clientWidth:n,clientHeight:r}=e;(e.width!==n||e.height!==r)&&(e.width=n,e.height=r)}function RY(t,e,n){const r=t.viewport.scale,i=XR(t.image,t.viewport.rotation),a=Math.round(i.width*r),o=Math.round(i.height*r),s=t.viewport.translation.x,c=t.viewport.translation.y;return a===e&&o<=n||a<=e&&o===n&&s===0&&c===0}function MY(t,e,n){const r=t.viewport.scale,i=t.canvas.width,a=t.canvas.height,o=i/e,s=a/n,c=Math.sqrt(o*s);t.viewport.scale=c*r}function _Y(t,e=!1){const n=t.canvas.width,r=t.canvas.height;DY(t),t.image!==void 0&&(e||RY(t,n,r)?OY(t):MY(t,n,r))}function bY(t,e){const{hflip:n,vflip:r,rotation:i}=e;if(t.x*=n?-1:1,t.y*=r?-1:1,i!==0){const a=i*Math.PI/180,o=Math.cos(a),s=Math.sin(a),c=t.x*o-t.y*s,l=t.x*s+t.y*o;t.x=c,t.y=l}return t}function LY(t,e=!0,n=!0){const{canvas:r,image:i,viewport:a}=t,o=Vy(r,i,0).scaleFactor;a.vflip=!1,a.hflip=!1,e&&(a.translation.x=0,a.translation.y=0),n&&(a.displayedArea.tlhc.x=1,a.displayedArea.tlhc.y=1,a.displayedArea.brhc.x=i.columns,a.displayedArea.brhc.y=i.rows,a.scale=o)}const IY=1;class ha extends Iu{constructor(e){super(e),this.imageIds=[],this.imageKeyToIndexMap=new Map,this.currentImageIdIndex=0,this.targetImageIdIndex=0,this.imagesLoader=this,this.globalDefaultProperties={},this.perImageIdDefaultProperties=new Map,this.voiUpdatedWithSetProperties=!1,this.invert=!1,this.initialInvert=!1,this.initialTransferFunctionNodes=null,this.stackInvalidated=!1,this._publishCalibratedEvent=!1,this.updateRenderingPipeline=()=>{this._configureRenderingPipeline()},this.resize=()=>{this.useCPURendering&&this._resizeCPU()},this._resizeCPU=()=>{this._cpuFallbackEnabledElement.viewport&&_Y(this._cpuFallbackEnabledElement)},this.getFrameOfReferenceUID=n=>{var r;return(r=this.getImagePlaneReferenceData(n))==null?void 0:r.FrameOfReferenceUID},this.getCornerstoneImage=()=>this.csImage,this.createActorMapper=n=>{const r=VX.newInstance();r.setInputData(n);const i=WX.newInstance();i.setMapper(r);const{preferSizeOverAccuracy:a}=gy().rendering;return a&&r.setPreferSizeOverAccuracy(!0),n.getPointData().getScalars().getNumberOfComponents()>1&&i.getProperty().setIndependentComponents(!1),i},this.getNumberOfSlices=()=>this.imageIds.length,this.getDefaultProperties=n=>{let r;return n!==void 0&&(r=this.perImageIdDefaultProperties.get(n)),r!==void 0?r:{...this.globalDefaultProperties}},this.getProperties=()=>{const{colormap:n,voiRange:r,VOILUTFunction:i,interpolationType:a,invert:o,voiUpdatedWithSetProperties:s}=this;return{colormap:n,voiRange:r,VOILUTFunction:i,interpolationType:a,invert:o,isComputedVOI:!s}},this.resetCameraForResize=()=>this.resetCamera({resetPan:!0,resetZoom:!0,resetToCenter:!0,suppressEvents:!0}),this.getRotationCPU=()=>{const{viewport:n}=this._cpuFallbackEnabledElement;return n.rotation},this.getRotationGPU=()=>{const{viewUp:n,viewPlaneNormal:r,flipVertical:i}=this.getCameraNoRotation(),a=i?as(Le(),this.initialViewUp):this.initialViewUp,o=mE(a,n)*180/Math.PI,s=an(Le(),a,n);return Qe(s,r)>=0?o:(360-o)%360},this.setRotation=n=>{const r=this.getCamera();if(this.useCPURendering?this.setRotationCPU(n):this.setRotationGPU(n),this._suppressCameraModifiedEvents)return;const i=this.getCamera(),a={previousCamera:r,camera:i,element:this.element,viewportId:this.id,renderingEngineId:this.renderingEngineId};De(this.element,Oe.CAMERA_MODIFIED,a)},this.renderImageObject=n=>{this._setCSImage(n),(this.useCPURendering?this._updateToDisplayImageCPU:this._updateActorToDisplayImageId).call(this,n)},this._setCSImage=n=>{var r;n.isPreScaled=(r=n.preScale)==null?void 0:r.scaled,this.csImage=n},this.canvasToWorldCPU=(n,r=[0,0,0])=>{if(!this._cpuFallbackEnabledElement.image)return;const[i,a]=h1(this._cpuFallbackEnabledElement,n),{origin:o,spacing:s,direction:c}=this.getImageData(),l=c.slice(0,3),f=c.slice(3,6);return vr(r,o,l,i*s[0]),vr(r,r,f,a*s[1]),r},this.worldToCanvasCPU=n=>{const{spacing:r,direction:i,origin:a}=this.getImageData(),o=i.slice(0,3),s=i.slice(3,6),c=tn(Le(),n,a),l=[Qe(c,o)/r[0],Qe(c,s)/r[1]];return C7(this._cpuFallbackEnabledElement,l)},this.canvasToWorldGPU=n=>{const r=this.getRenderer(),i=this.getVtkActiveCamera(),a=i.getClippingRange(),o=i.getDistance();i.setClippingRange(o,o+.1);const c=this.getRenderingEngine().offscreenMultiRenderWindow.getOpenGLRenderWindow(),l=c.getSize(),f=window.devicePixelRatio||1,u=[n[0]*f,n[1]*f],g=[u[0]+this.sx,u[1]+this.sy];g[1]=l[1]-g[1];const d=c.displayToWorld(g[0],g[1],0,r);return i.setClippingRange(a[0],a[1]),[d[0],d[1],d[2]]},this.worldToCanvasGPU=n=>{const r=this.getRenderer(),i=this.getVtkActiveCamera(),a=i.getClippingRange(),o=i.getDistance();i.setClippingRange(o,o+.1);const c=this.getRenderingEngine().offscreenMultiRenderWindow.getOpenGLRenderWindow(),l=c.getSize(),f=c.worldToDisplay(...n,r);f[1]=l[1]-f[1];const u=[f[0]-this.sx,f[1]-this.sy];i.setClippingRange(a[0],a[1]);const g=window.devicePixelRatio||1;return[u[0]/g,u[1]/g]},this.getCurrentImageIdIndex=()=>this.currentImageIdIndex,this.getSliceIndex=()=>this.currentImageIdIndex,this.getTargetImageIdIndex=()=>this.targetImageIdIndex,this.getImageIds=()=>this.imageIds,this.getCurrentImageId=(n=this.getCurrentImageIdIndex())=>this.imageIds[n],this.hasImageId=n=>this.imageKeyToIndexMap.has(n),this.hasImageURI=n=>this.imageKeyToIndexMap.has(n),this.customRenderViewportToCanvas=()=>{if(!this.useCPURendering)throw new Error("Custom cpu rendering pipeline should only be hit in CPU rendering mode");return this._cpuFallbackEnabledElement.image?(KR(this._cpuFallbackEnabledElement,this.cpuRenderingInvalidated),this.cpuRenderingInvalidated=!1):this.fillWithBackgroundColor(),{canvas:this.canvas,element:this.element,viewportId:this.id,renderingEngineId:this.renderingEngineId,viewportStatus:this.viewportStatus}},this.renderingPipelineFunctions={getImageData:{cpu:this.getImageDataCPU,gpu:this.getImageDataGPU},setColormap:{cpu:this.setColormapCPU,gpu:this.setColormapGPU},getCamera:{cpu:this.getCameraCPU,gpu:super.getCamera},setCamera:{cpu:this.setCameraCPU,gpu:super.setCamera},getPan:{cpu:this.getPanCPU,gpu:super.getPan},setPan:{cpu:this.setPanCPU,gpu:super.setPan},getZoom:{cpu:this.getZoomCPU,gpu:super.getZoom},setZoom:{cpu:this.setZoomCPU,gpu:super.setZoom},setVOI:{cpu:this.setVOICPU,gpu:this.setVOIGPU},getRotation:{cpu:this.getRotationCPU,gpu:this.getRotationGPU},setInterpolationType:{cpu:this.setInterpolationTypeCPU,gpu:this.setInterpolationTypeGPU},setInvertColor:{cpu:this.setInvertColorCPU,gpu:this.setInvertColorGPU},resetCamera:{cpu:(n={})=>{const{resetPan:r=!0,resetZoom:i=!0}=n;return this.resetCameraCPU({resetPan:r,resetZoom:i}),!0},gpu:(n={})=>{const{resetPan:r=!0,resetZoom:i=!0}=n;return this.resetCameraGPU({resetPan:r,resetZoom:i}),!0}},canvasToWorld:{cpu:this.canvasToWorldCPU,gpu:this.canvasToWorldGPU},worldToCanvas:{cpu:this.worldToCanvasCPU,gpu:this.worldToCanvasGPU},getRenderer:{cpu:()=>this.getCPUFallbackError("getRenderer"),gpu:super.getRenderer},getDefaultActor:{cpu:()=>this.getCPUFallbackError("getDefaultActor"),gpu:super.getDefaultActor},getActors:{cpu:()=>this.getCPUFallbackError("getActors"),gpu:super.getActors},getActor:{cpu:()=>this.getCPUFallbackError("getActor"),gpu:super.getActor},setActors:{cpu:()=>this.getCPUFallbackError("setActors"),gpu:super.setActors},addActors:{cpu:()=>this.getCPUFallbackError("addActors"),gpu:super.addActors},addActor:{cpu:()=>this.getCPUFallbackError("addActor"),gpu:super.addActor},removeAllActors:{cpu:()=>this.getCPUFallbackError("removeAllActors"),gpu:super.removeAllActors},unsetColormap:{cpu:this.unsetColormapCPU,gpu:this.unsetColormapGPU}},this.scaling={},this.modality=null,this.useCPURendering=og(),this._configureRenderingPipeline(),this.useCPURendering?this._resetCPUFallbackElement():this._resetGPUViewport(),this.currentImageIdIndex=0,this.targetImageIdIndex=0,this.resetCamera(),this.initializeElementDisabledHandler()}setUseCPURendering(e){this.useCPURendering=e,this._configureRenderingPipeline(e)}static get useCustomRenderingPipeline(){return og()}_configureRenderingPipeline(e){this.useCPURendering=e??og();for(const n in this.renderingPipelineFunctions)if(Object.prototype.hasOwnProperty.call(this.renderingPipelineFunctions,n)){const r=this.renderingPipelineFunctions[n];this[n]=this.useCPURendering?r.cpu:r.gpu}this.useCPURendering?this._resetCPUFallbackElement():this._resetGPUViewport()}_resetCPUFallbackElement(){this._cpuFallbackEnabledElement={canvas:this.canvas,renderingTools:{},transform:new tf,viewport:{rotation:0}}}_resetGPUViewport(){const e=this.getRenderer(),n=dy.newInstance();e.setActiveCamera(n),this.initialViewUp=[0,-1,0],n.setDirectionOfProjection(-0,-0,1),n.setViewUp(...this.initialViewUp),n.setParallelProjection(!0),n.setThicknessFromFocalPoint(.1),n.setFreezeFocalPoint(!0)}initializeElementDisabledHandler(){Ee.addEventListener(Oe.ELEMENT_DISABLED,function e(){clearTimeout(this.debouncedTimeout),Ee.removeEventListener(Oe.ELEMENT_DISABLED,e)})}getImageDataGPU(){const e=this.getDefaultActor();if(!e||!co(e))return;const{actor:n}=e,r=n.getMapper().getInputData(),i=this.csImage;return{dimensions:r.getDimensions(),spacing:r.getSpacing(),origin:r.getOrigin(),direction:r.getDirection(),get scalarData(){return i==null?void 0:i.voxelManager.getScalarData()},imageData:n.getMapper().getInputData(),metadata:{Modality:this.modality,FrameOfReferenceUID:this.getFrameOfReferenceUID()},scaling:this.scaling,hasPixelSpacing:this.hasPixelSpacing,calibration:{...i==null?void 0:i.calibration,...this.calibration},preScale:{...i==null?void 0:i.preScale},voxelManager:i==null?void 0:i.voxelManager}}getImageDataCPU(){const{metadata:e}=this._cpuFallbackEnabledElement;if(!e)return;const n=e.spacing,r=this.csImage;return{dimensions:e.dimensions,spacing:n,origin:e.origin,direction:e.direction,metadata:{Modality:this.modality,FrameOfReferenceUID:this.getFrameOfReferenceUID()},scaling:this.scaling,imageData:{getDirection:()=>e.direction,getDimensions:()=>e.dimensions,getScalarData:()=>this.cpuImagePixelData,getSpacing:()=>n,worldToIndex:i=>{const a=this.worldToCanvasCPU(i),o=h1(this._cpuFallbackEnabledElement,a);return[o[0],o[1],0]},indexToWorld:(i,a)=>{const o=C7(this._cpuFallbackEnabledElement,[i[0],i[1]]);return this.canvasToWorldCPU(o,a)}},scalarData:this.cpuImagePixelData,hasPixelSpacing:this.hasPixelSpacing,calibration:{...r==null?void 0:r.calibration,...this.calibration},preScale:{...r==null?void 0:r.preScale},voxelManager:r==null?void 0:r.voxelManager}}buildMetadata(e){const n=e.imageId,{pixelRepresentation:r,bitsAllocated:i,bitsStored:a,highBit:o,photometricInterpretation:s,samplesPerPixel:c}=Ve("imagePixelModule",n),{windowWidth:l,windowCenter:f,voiLUTFunction:u}=e,{modality:g}=Ve("generalSeriesModule",n),d=Ve("scalingModule",n),h=Ve(li.CALIBRATION,n);g==="PT"&&d&&this._addScalingToViewport(d),this.modality=g;const p=this._getValidVOILUTFunction(u);this.VOILUTFunction=p,this.calibration=h;let m=this._getImagePlaneModule(n);return this.useCPURendering||(m=this.calibrateIfNecessary(n,m)),{imagePlaneModule:m,imagePixelModule:{bitsAllocated:i,bitsStored:a,samplesPerPixel:c,highBit:o,photometricInterpretation:s,pixelRepresentation:r,windowWidth:l,windowCenter:f,modality:g,voiLUTFunction:p}}}calibrateIfNecessary(e,n){const r=Ve("calibratedPixelSpacing",e),i=this.calibration!==r,{scale:a}=r||{};return this.hasPixelSpacing=a>0||n.rowPixelSpacing>0,n.calibration=r,i&&(this.calibration=r,this._publishCalibratedEvent=!0,this._calibrationEvent={scale:a,calibration:r}),n}setDefaultProperties(e,n){n==null?this.globalDefaultProperties=e:(this.perImageIdDefaultProperties.set(n,e),this.getCurrentImageId()===n&&this.setProperties(e))}clearDefaultProperties(e){e==null?(this.globalDefaultProperties={},this.resetProperties()):(this.perImageIdDefaultProperties.delete(e),this.resetToDefaultProperties())}setProperties({colormap:e,voiRange:n,VOILUTFunction:r,invert:i,interpolationType:a}={},o=!1){this.viewportStatus=this.csImage?si.PRE_RENDER:si.LOADING,this.globalDefaultProperties={colormap:this.globalDefaultProperties.colormap??e,voiRange:this.globalDefaultProperties.voiRange??n,VOILUTFunction:this.globalDefaultProperties.VOILUTFunction??r,invert:this.globalDefaultProperties.invert??i,interpolationType:this.globalDefaultProperties.interpolationType??a},typeof e<"u"&&this.setColormap(e),typeof n<"u"&&this.setVOI(n,{suppressEvents:o,voiUpdatedWithSetProperties:!0}),typeof r<"u"&&this.setVOILUTFunction(r,o),typeof i<"u"&&this.setInvertColor(i),typeof a<"u"&&this.setInterpolationType(a)}resetProperties(){this.cpuRenderingInvalidated=!0,this.voiUpdatedWithSetProperties=!1,this.viewportStatus=si.PRE_RENDER,this.fillWithBackgroundColor(),this.useCPURendering&&(this._cpuFallbackEnabledElement.renderingTools={}),this._resetProperties(),this.render()}_resetProperties(){let e;if(this._isCurrentImagePTPrescaled()?e=this._getDefaultPTPrescaledVOIRange():e=this._getVOIRangeForCurrentImage(),this.setVOI(e),this.setInvertColor(this.initialInvert),this.setInterpolationType(ts.LINEAR),!this.useCPURendering){const n=this.getTransferFunction();O2(n,this.initialTransferFunctionNodes);const i=xh(n).reduce((s,c)=>(s.push(c[0],c[1],c[2],c[3]),s),[]),a=this.getDefaultActor(),o=Ty(i,a.actor);this.setColormap(o)}}resetToDefaultProperties(){var i;this.cpuRenderingInvalidated=!0,this.viewportStatus=si.PRE_RENDER,this.fillWithBackgroundColor(),this.useCPURendering&&(this._cpuFallbackEnabledElement.renderingTools={});const e=this.getCurrentImageId(),n=this.perImageIdDefaultProperties.get(e)||this.globalDefaultProperties;(i=n.colormap)!=null&&i.name&&this.setColormap(n.colormap);let r;n.voiRange==null?r=this._getVOIRangeForCurrentImage():r=n.voiRange,this.setVOI(r),this.setInterpolationType(ts.LINEAR),this.setInvertColor(!1),this.render()}_getVOIFromCache(){let e;return this.voiUpdatedWithSetProperties?e=this.voiRange:this._isCurrentImagePTPrescaled()?e=this._getDefaultPTPrescaledVOIRange():e=this._getVOIRangeForCurrentImage()??this.voiRange,e}_setPropertiesFromCache(){const e=this._getVOIFromCache(),{interpolationType:n,invert:r}=this;this.setVOI(e),this.setInterpolationType(n),this.setInvertColor(r)}getCameraCPU(){const{metadata:e,viewport:n}=this._cpuFallbackEnabledElement;if(!e)return{};const{direction:r}=e,i=r.slice(6,9).map(u=>-u);let a=r.slice(3,6).map(u=>-u);if(n.rotation){const u=B4(Lc(),n.rotation*Math.PI/180,i);a=pt(Le(),a,u)}const o=[this.element.clientWidth/2,this.element.clientHeight/2],s=this.canvasToWorld(o),c=this.canvasToWorld([0,0]),l=this.canvasToWorld([0,this.element.clientHeight]),f=Gg(c,l)/2;return{parallelProjection:!0,focalPoint:s,position:[0,0,0],parallelScale:f,scale:n.scale,viewPlaneNormal:[i[0],i[1],i[2]],viewUp:[a[0],a[1],a[2]],flipHorizontal:this.flipHorizontal,flipVertical:this.flipVertical}}setCameraCPU(e){const{viewport:n,image:r}=this._cpuFallbackEnabledElement,i=this.getCameraCPU(),{focalPoint:a,parallelScale:o,scale:s,flipHorizontal:c,flipVertical:l}=e,{clientHeight:f}=this.element;if(a){const g=this.worldToCanvasCPU(a),d=h1(this._cpuFallbackEnabledElement,g),h=this.worldToCanvasCPU(i.focalPoint),p=h1(this._cpuFallbackEnabledElement,h),m=os();Ru(m,d9(d[0],d[1]),d9(p[0],p[1]));const v=bY({x:m[0],y:m[1]},n);n.translation.x-=v.x,n.translation.y-=v.y}if(o){const{rowPixelSpacing:g}=r,d=f*g*.5/o;n.scale=d,n.parallelScale=o}if(s){const{rowPixelSpacing:g}=r;n.scale=s,n.parallelScale=f*g*.5/s}(c!==void 0||l!==void 0)&&this.setFlipCPU({flipHorizontal:c,flipVertical:l}),this._cpuFallbackEnabledElement.transform=Hg(this._cpuFallbackEnabledElement);const u={previousCamera:i,camera:this.getCamera(),element:this.element,viewportId:this.id,renderingEngineId:this.renderingEngineId};De(this.element,Oe.CAMERA_MODIFIED,u)}getPanCPU(){const{viewport:e}=this._cpuFallbackEnabledElement;return[e.translation.x,e.translation.y]}setPanCPU(e){const n=this.getCameraCPU();this.setCameraCPU({...n,focalPoint:[...e.map(r=>-r),0]})}getZoomCPU(){const{viewport:e}=this._cpuFallbackEnabledElement;return e.scale}setZoomCPU(e){const n=this.getCameraCPU();this.setCameraCPU({...n,scale:e})}setFlipCPU({flipHorizontal:e,flipVertical:n}){const{viewport:r}=this._cpuFallbackEnabledElement;e!==void 0&&(r.hflip=e,this.flipHorizontal=r.hflip),n!==void 0&&(r.vflip=n,this.flipVertical=r.vflip)}setVOILUTFunction(e,n){if(this.useCPURendering)throw new Error("VOI LUT function is not supported in CPU rendering");const r=this._getValidVOILUTFunction(e);let i=!1;this.VOILUTFunction!==r&&(i=!0),this.VOILUTFunction=r;const{voiRange:a}=this.getProperties();this.setVOI(a,{suppressEvents:n,forceRecreateLUTFunction:i})}setRotationCPU(e){const{viewport:n}=this._cpuFallbackEnabledElement;n.rotation=e}setRotationGPU(e){const n=this.getPan(this.fitToCanvasCamera),r=this.getPan(),i=sh([0,0],n,r);this.setPan(i,!1);const{flipVertical:a}=this.getCamera(),o=a?as(Le(),this.initialViewUp):this.initialViewUp;this.setCameraNoEvent({viewUp:o}),this.getVtkActiveCamera().roll(-e);const s=this.getPan(),c=this.getPan(this.fitToCanvasCamera),l=sh([0,0],s,c),f=W4([0,0],n,l);this.setPan(f,!1)}setInterpolationTypeGPU(e){const n=this.getDefaultActor();if(!n||!co(n))return;const{actor:r}=n;r.getProperty().setInterpolationType(e),this.interpolationType=e}setInterpolationTypeCPU(e){const{viewport:n}=this._cpuFallbackEnabledElement;n.pixelReplication=e!==ts.LINEAR,this.interpolationType=e}setInvertColorCPU(e){const{viewport:n}=this._cpuFallbackEnabledElement;n&&(n.invert=e,this.invert=e)}setInvertColorGPU(e){const n=this.getDefaultActor();if(n&&co(n)){if(Vi(n,"vtkVolume")){const i=n.actor.getProperty().getRGBTransferFunction(0);(!this.invert&&e||this.invert&&!e)&&sg(i),this.invert=e}else if(Vi(n,"vtkImageSlice")){const i=n.actor.getProperty().getRGBTransferFunction(0);(!this.invert&&e||this.invert&&!e)&&sg(i),this.invert=e}}}setVOICPU(e,n={}){const{suppressEvents:r=!1}=n,{viewport:i,image:a}=this._cpuFallbackEnabledElement;if(!i||!a)return;if(typeof e>"u"){const{windowWidth:s,windowCenter:c}=a,l=Array.isArray(s)?s[0]:s,f=Array.isArray(c)?c[0]:c;i.voi={windowWidth:l,windowCenter:f,voiLUTFunction:a.voiLUTFunction};const{lower:u,upper:g}=cg(l,f,a.voiLUTFunction);e={lower:u,upper:g}}else{const{lower:s,upper:c}=e,{windowCenter:l,windowWidth:f}=Cy(s,c);i.voi||(i.voi={windowWidth:0,windowCenter:0,voiLUTFunction:a.voiLUTFunction}),i.voi.windowWidth=f,i.voi.windowCenter=l}this.voiRange=e;const o={viewportId:this.id,range:e};r||De(this.element,Oe.VOI_MODIFIED,o)}getTransferFunction(){const e=this.getDefaultActor();return!e||!co(e)?void 0:e.actor.getProperty().getRGBTransferFunction(0)}setVOIGPU(e,n={}){const{suppressEvents:r=!1,forceRecreateLUTFunction:i=!1,voiUpdatedWithSetProperties:a=!1}=n;if(e&&this.voiRange&&this.voiRange.lower===e.lower&&this.voiRange.upper===e.upper&&!i&&!this.stackInvalidated)return;const o=this.getDefaultActor();if(!o||!co(o))return;const s=o.actor;let c=e;if(typeof c>"u"){const d=s.getMapper().getInputData().getPointData().getScalars().getRange();c={lower:d[0],upper:d[1]}}s.getProperty().setUseLookupTableScalarRange(!0);let l=s.getProperty().getRGBTransferFunction(0);const f=this.VOILUTFunction===ui.SAMPLED_SIGMOID;if((f||!l||i)&&(l=(f?wy:zR)(c),this.invert&&sg(l),s.getProperty().setRGBTransferFunction(0,l),this.initialTransferFunctionNodes=xh(l)),f||l.setRange(c.lower,c.upper),this.voiRange=c,this.voiUpdatedWithSetProperties||(this.voiUpdatedWithSetProperties=a),r)return;const u={viewportId:this.id,range:c,VOILUTFunction:this.VOILUTFunction};De(this.element,Oe.VOI_MODIFIED,u)}_addScalingToViewport(e){if(this.scaling.PT)return;const{suvbw:n,suvlbm:r,suvbsa:i}=e,a={};r&&(a.suvbwToSuvlbm=r/n),i&&(a.suvbwToSuvbsa=i/n),this.scaling.PT=a}_getNumCompsFromPhotometricInterpretation(e){let n=1;return(e==="RGB"||e.includes("YBR")||e==="PALETTE COLOR")&&(n=3),n}getImageDataMetadata(e){const{imagePlaneModule:n,imagePixelModule:r}=this.buildMetadata(e);let{rowCosines:i,columnCosines:a}=n;(i==null||a==null)&&(i=[1,0,0],a=[0,1,0]);const o=Cn(i[0],i[1],i[2]),s=Cn(a[0],a[1],a[2]),c=Le();an(c,o,s);let l=n.imagePositionPatient;l==null&&(l=[0,0,0]);const f=n.columnPixelSpacing||e.columnPixelSpacing,u=n.rowPixelSpacing||e.rowPixelSpacing,g=e.columns,d=e.rows,h=IY,p=1,m=e.numberOfComponents||this._getNumCompsFromPhotometricInterpretation(r.photometricInterpretation);return{bitsAllocated:r.bitsAllocated,numberOfComponents:m,origin:l,direction:[...o,...s,...c],dimensions:[g,d,p],spacing:[f,u,h],numVoxels:g*d*p,imagePlaneModule:n,imagePixelModule:r}}matchImagesForOverlay(e,n){return(i=>{const a=Ve(li.IMAGE_PLANE,n),o=Ve(li.IMAGE_PLANE,i),s=a.imageOrientationPatient,c=o.imageOrientationPatient;if(s&&c){if(Mn(a.imageOrientationPatient,o.imageOrientationPatient)){const f=a.imagePositionPatient,u=o.imagePositionPatient;if(f&&u&&Mn(f,u)){const d=a.rows,h=a.columns,p=o.rows,m=o.columns;if(d===p&&h===m)return i}}}else{const l=a.rows,f=a.columns,u=o.rows,g=o.columns;if(l===u&&f===g)return i}})(e)}getImagePlaneReferenceData(e=this.getCurrentImageIdIndex()){const n=this.imageIds[e];if(!n)return;const r=Ve(li.IMAGE_PLANE,n);if(!r)return;const{imagePositionPatient:i,frameOfReferenceUID:a}=r;let{rowCosines:o,columnCosines:s}=r;o||(o=[1,0,0]),s||(s=[0,1,0]);const c=an([0,0,0],s,o);return{FrameOfReferenceUID:a,viewPlaneNormal:c,cameraFocalPoint:i,referencedImageId:n,sliceIndex:e}}_getCameraOrientation(e){const n=e.slice(6,9).map(i=>-i),r=e.slice(3,6).map(i=>-i);return{viewPlaneNormal:[n[0],n[1],n[2]],viewUp:[r[0],r[1],r[2]]}}createVTKImageData({origin:e,direction:n,dimensions:r,spacing:i,numberOfComponents:a,pixelArray:o}){const s=new o.constructor(o.length),c=nt.newInstance({name:"Pixels",numberOfComponents:a,values:s}),l=v2.newInstance();return l.setDimensions(r),l.setSpacing(i),l.setDirection(n),l.setOrigin(e),l.getPointData().setScalars(c),l}_createVTKImageData({origin:e,direction:n,dimensions:r,spacing:i,numberOfComponents:a,pixelArray:o}){try{this._imageData=this.createVTKImageData({origin:e,direction:n,dimensions:r,spacing:i,numberOfComponents:a,pixelArray:o})}catch(s){console.error(s)}}async setStack(e,n=0){this._throwIfDestroyed(),this.imageIds=e,this.imageKeyToIndexMap.clear(),e.forEach((o,s)=>{this.imageKeyToIndexMap.set(o,s),this.imageKeyToIndexMap.set(gi(o),s)}),this.currentImageIdIndex=n,this.targetImageIdIndex=n;const r=Ve(jg.IMAGE_RETRIEVE_CONFIGURATION,e[n],"stack");this.imagesLoader=r?(r.create||MR)(r):this,this.stackInvalidated=!0,this.flipVertical=!1,this.flipHorizontal=!1,this.voiRange=null,this.interpolationType=ts.LINEAR,this.invert=!1,this.viewportStatus=si.LOADING,this.fillWithBackgroundColor(),this.useCPURendering&&(this._cpuFallbackEnabledElement.renderingTools={},delete this._cpuFallbackEnabledElement.viewport.colormap);const i=await this._setImageIdIndex(n),a={imageIds:e,viewportId:this.id,element:this.element,currentImageIdIndex:n};return De(this.element,Oe.VIEWPORT_NEW_IMAGE_SET,a),i}_throwIfDestroyed(){if(this.isDisabled)throw new Error("The stack viewport has been destroyed and is no longer usable. Renderings will not be performed. If you are using the same viewportId and have re-enabled the viewport, you need to grab the new viewport instance using renderingEngine.getViewport(viewportId), instead of using your lexical scoped reference to the viewport instance.")}_checkVTKImageDataMatchesCornerstoneImage(e,n){if(!n)return!1;const[r,i]=n.getSpacing(),[a,o]=n.getDimensions(),s=this._getImagePlaneModule(e.imageId),c=n.getDirection(),l=c.slice(0,3),f=c.slice(3,6),u=n.getPointData().getScalars().getDataType(),g=Mn(r,e.columnPixelSpacing),d=Mn(i,e.rowPixelSpacing),h=g||e.columnPixelSpacing===null&&r===1,p=d||e.rowPixelSpacing===null&&i===1,m=a===e.columns,v=o===e.rows,y=Mn(s.rowCosines,l),T=Mn(s.columnCosines,f),C=u===e.voxelManager.getScalarData().constructor.name;return h&&p&&m&&v&&y&&T&&C}_updateVTKImageDataFromCornerstoneImage(e){let r=this._getImagePlaneModule(e.imageId).imagePositionPatient;r==null&&(r=[0,0,0]),this._imageData.setOrigin(r),D2(this._imageData,e)}_loadAndDisplayImage(e,n){return this.useCPURendering?this._loadAndDisplayImageCPU(e,n):this._loadAndDisplayImageGPU(e,n)}_loadAndDisplayImageCPU(e,n){return new Promise((r,i)=>{function a(d,h,p){if(this.currentImageIdIndex!==h)return;const m=d.voxelManager.getScalarData(),v=d.preScale,y=v==null?void 0:v.scalingParameters,T=(v==null?void 0:v.scaled)&&(y==null?void 0:y.rescaleIntercept)%1!==0||(y==null?void 0:y.rescaleSlope)%1!==0;if(m instanceof Float32Array&&T){const w={min:d.maxPixelValue,max:d.minPixelValue},M=Math.abs(w.max-w.min)/65535,A=w.min,_=m.length,k=new Uint16Array(_);let z=65535,X=0;for(let Z=0;Z<_;Z++){const ce=Math.floor((m[Z]-A)/M);k[Z]=ce,z=Math.min(z,ce),X=Math.max(X,ce)}d.minPixelValue=z,d.maxPixelValue=X,d.slope=M,d.intercept=A,d.getPixelData=()=>k,d.preScale={...d.preScale,scaled:!1}}this._setCSImage(d),this.viewportStatus=si.PRE_RENDER;const C={image:d,imageId:p,imageIdIndex:h,viewportId:this.id,renderingEngineId:this.renderingEngineId};De(this.element,Oe.STACK_NEW_IMAGE,C),this._updateToDisplayImageCPU(d),this.render(),this.currentImageIdIndex=h,r(p)}function o(d,h,p){const m={error:d,imageIdIndex:h,imageId:p};this.suppressEvents||De(Ee,Oe.IMAGE_LOAD_ERROR,m),i(d)}function s(d,h,p){return Lu(d,p).then(m=>{a.call(this,m,h,d)},m=>{o.call(this,m,h,d)})}const c=-5,l=ot.Interaction,f={imageId:e,imageIdIndex:n},u={useRGBA:!0,requestType:l},g={imageId:e,imageIdIndex:n,viewportId:this.id,renderingEngineId:this.renderingEngineId};De(this.element,Oe.PRE_STACK_NEW_IMAGE,g),wo.addRequest(s.bind(this,e,n,u),l,f,c)})}successCallback(e,n){var l,f;const r=this.imageIds.indexOf(e);if(this.currentImageIdIndex!==r)return;const i=(l=this.csImage)==null?void 0:l.imageFrame,a=n==null?void 0:n.imageFrame,o=(i==null?void 0:i.photometricInterpretation)||((f=this.csImage)==null?void 0:f.photometricInterpretation),s=(a==null?void 0:a.photometricInterpretation)||(n==null?void 0:n.photometricInterpretation);o!==s&&(this.stackInvalidated=!0),this._setCSImage(n);const c={image:n,imageId:e,imageIdIndex:r,viewportId:this.id,renderingEngineId:this.renderingEngineId};this._updateActorToDisplayImageId(n),De(this.element,Oe.STACK_NEW_IMAGE,c),this.render(),this.currentImageIdIndex=r}errorCallback(e,n,r){if(!n)return;const i=this.imageIds.indexOf(e),a={error:r,imageIdIndex:i,imageId:e};De(Ee,Oe.IMAGE_LOAD_ERROR,a)}getLoaderImageOptions(e){const n=this.imageIds.indexOf(e),{transferSyntaxUID:r}=Ve("transferSyntax",e)||{};return{useRGBA:!1,transferSyntaxUID:r,priority:5,requestType:ot.Interaction,additionalDetails:{imageId:e,imageIdIndex:n}}}async loadImages(e,n){const r=await Promise.allSettled(e.map(a=>{const o=this.getLoaderImageOptions(a);return Lu(a,o).then(s=>(n.successCallback(a,s),a),s=>(n.errorCallback(a,!0,s),a))})),i=r.filter(a=>a.status==="rejected");if(i&&i.length){const a=new CustomEvent(Oe.IMAGE_LOAD_ERROR,{detail:i,cancelable:!0});Ee.dispatchEvent(a)}return r}_loadAndDisplayImageGPU(e,n){const r={imageId:e,imageIdIndex:n,viewportId:this.id,renderingEngineId:this.renderingEngineId};return De(this.element,Oe.PRE_STACK_NEW_IMAGE,r),this.imagesLoader.loadImages([e],this).then(i=>e)}_updateToDisplayImageCPU(e){const n=this.getImageDataMetadata(e),r=YR(this.canvas,e,this.modality,this._cpuFallbackEnabledElement.viewport.colormap),{windowCenter:i,windowWidth:a,voiLUTFunction:o}=r.voi;this.voiRange=cg(a,i,o),this._cpuFallbackEnabledElement.image=e,this._cpuFallbackEnabledElement.metadata={...n},this.cpuImagePixelData=e.voxelManager.getScalarData();const s=Object.assign({},r,this._cpuFallbackEnabledElement.viewport);this._cpuFallbackEnabledElement.viewport=this.stackInvalidated?r:s,this.stackInvalidated=!1,this.cpuRenderingInvalidated=!0,this._cpuFallbackEnabledElement.transform=Hg(this._cpuFallbackEnabledElement)}getSliceViewInfo(){throw new Error("Method not implemented.")}addImages(e){const n=[];e.forEach(r=>{const{imageId:i,...a}=r,o=Me.getImage(i),{origin:s,dimensions:c,direction:l,spacing:f,numberOfComponents:u}=this.getImageDataMetadata(o),g=this.createVTKImageData({origin:s,dimensions:c,direction:l,spacing:f,numberOfComponents:u,pixelArray:o.voxelManager.getScalarData()}),d=this.createActorMapper(g);d&&(n.push({uid:r.actorUID??In(),actor:d,referencedId:i,...a}),r.callback&&r.callback({imageActor:d,imageId:r.imageId}))}),this.addActors(n)}_updateActorToDisplayImageId(e){const n=this._checkVTKImageDataMatchesCornerstoneImage(e,this._imageData),r=this.getViewPresentation();if(n&&!this.stackInvalidated){this._updateVTKImageDataFromCornerstoneImage(e),this.resetCameraNoEvent(),this.setViewPresentation(r),this._setPropertiesFromCache(),this.stackActorReInitialized=!1;return}const{origin:i,direction:a,dimensions:o,spacing:s,numberOfComponents:c,imagePixelModule:l}=this.getImageDataMetadata(e),f=e.voxelManager.getScalarData();this._createVTKImageData({origin:i,direction:a,dimensions:o,spacing:s,numberOfComponents:c,pixelArray:f}),this._updateVTKImageDataFromCornerstoneImage(e);const u=this.createActorMapper(this._imageData),g=this.getActors();g.length&&g[0].uid===this.id?g[0].actor=u:g.unshift({uid:this.id,actor:u}),this.setActors(g);const{viewPlaneNormal:d,viewUp:h}=this._getCameraOrientation(a),p=this.getCamera();this.setCameraNoEvent({viewUp:h,viewPlaneNormal:d}),this.initialViewUp=h,this.resetCameraNoEvent(),this.setViewPresentation(r),this.triggerCameraEvent(this.getCamera(),p);const m=l.photometricInterpretation==="MONOCHROME1";this.stackInvalidated=!0;const v=this._getInitialVOIRange(e);this.setVOI(v,{forceRecreateLUTFunction:!!m}),this.initialInvert=!!m,this.setInvertColor(this.invert||this.initialInvert),this.stackInvalidated=!1,this.stackActorReInitialized=!0,this._publishCalibratedEvent&&this.triggerCalibrationEvent()}_getInitialVOIRange(e){if(this.voiRange&&this.voiUpdatedWithSetProperties)return this.voiRange;const{windowCenter:n,windowWidth:r,voiLUTFunction:i}=e;let a=this._getVOIRangeFromWindowLevel(r,n,i);return a=this._getPTPreScaledRange()||a,a}_getPTPreScaledRange(){if(this._isCurrentImagePTPrescaled())return this._getDefaultPTPrescaledVOIRange()}_isCurrentImagePTPrescaled(){var e;return!(this.modality!=="PT"||!this.csImage.isPreScaled||!((e=this.csImage.preScale)!=null&&e.scalingParameters.suvbw))}_getDefaultPTPrescaledVOIRange(){return{lower:0,upper:5}}_getVOIRangeFromWindowLevel(e,n,r=ui.LINEAR){let i,a;if(typeof n=="number"&&typeof e=="number"?(i=n,a=e):Array.isArray(n)&&Array.isArray(e)&&(i=n[0],a=e[0]),i!==void 0&&a!==void 0)return cg(a,i,r)}async _setImageIdIndex(e){if(e>=this.imageIds.length)throw new Error(`ImageIdIndex provided ${e} is invalid, the stack only has ${this.imageIds.length} elements`);this.currentImageIdIndex=e,this.hasPixelSpacing=!0,this.viewportStatus=si.PRE_RENDER;const n=await this._loadAndDisplayImage(this.imageIds[e],e);if(this.perImageIdDefaultProperties.size>=1){const r=this.perImageIdDefaultProperties.get(n);r!==void 0?this.setProperties(r):this.globalDefaultProperties!==void 0&&this.setProperties(this.globalDefaultProperties)}return n}resetCameraCPU({resetPan:e=!0,resetZoom:n=!0}){const{image:r}=this._cpuFallbackEnabledElement;if(!r)return;LY(this._cpuFallbackEnabledElement,e,n);const{scale:i}=this._cpuFallbackEnabledElement.viewport,{clientWidth:a,clientHeight:o}=this.element,s=[a/2,o/2],c=this.canvasToWorldCPU(s);this.setCameraCPU({focalPoint:c,scale:i})}resetCameraGPU({resetPan:e,resetZoom:n}){return this.setCamera({flipHorizontal:!1,flipVertical:!1,viewUp:this.initialViewUp}),super.resetCamera({resetPan:e,resetZoom:n,resetToCenter:!0})}scroll(e,n=!0,r=!1){const i=this.imageIds,a=this.targetImageIdIndex,o=i.length;let s=a+e;s=Math.max(0,s),r?s=s%o:s=Math.min(o-1,s),this.targetImageIdIndex=s;const c=i[s];Me.isLoaded(c)||!n?this.setImageIdIndex(s):(clearTimeout(this.debouncedTimeout),this.debouncedTimeout=window.setTimeout(()=>{this.setImageIdIndex(s)},40));const f={newImageIdIndex:s,imageId:c,direction:e};s!==a&&De(this.element,Oe.STACK_VIEWPORT_SCROLL,f)}setImageIdIndex(e){return this._throwIfDestroyed(),this.currentImageIdIndex===e?Promise.resolve(this.getCurrentImageId()):this._setImageIdIndex(e)}calibrateSpacing(e){const n=this.getImageIds().indexOf(e);this.stackInvalidated=!0,this._loadAndDisplayImage(e,n)}triggerCameraEvent(e,n){const r={previousCamera:n,camera:e,element:this.element,viewportId:this.id,renderingEngineId:this.renderingEngineId};this.suppressEvents||De(this.element,Oe.CAMERA_MODIFIED,r)}triggerCalibrationEvent(){const{imageData:e}=this.getImageData(),n={element:this.element,viewportId:this.id,renderingEngineId:this.renderingEngineId,imageId:this.getCurrentImageId(),imageData:e,worldToIndex:e.getWorldToIndex(),...this._calibrationEvent};this.suppressEvents||De(this.element,Oe.IMAGE_SPACING_CALIBRATED,n),this._publishCalibratedEvent=!1}jumpToWorld(e){const n=this.getImageIds(),r=this.getImageData(),{direction:i,spacing:a}=r,o=Wg({direction:i,spacing:a,imageIds:n},e,this.getCamera().viewPlaneNormal),s=n.indexOf(o);return s===-1?!1:(this.setImageIdIndex(s),this.render(),!0)}_getVOIRangeForCurrentImage(){const{windowCenter:e,windowWidth:n,voiLUTFunction:r}=this.csImage;return this._getVOIRangeFromWindowLevel(n,e,r)}_getValidVOILUTFunction(e){return Object.values(ui).includes(e)?e:ui.LINEAR}getSliceInfo(){const e=this.getSliceIndex(),{dimensions:n}=this.getImageData();return{width:n[0],height:n[1],sliceIndex:e,slicePlane:2}}isReferenceViewable(e,n={}){const r=this.getCurrentImageIdIndex(),i=this.imageIds[r];if(!i||!e)return!1;const{referencedImageId:a,multiSliceReference:o}=e;if(a){if(a===i)return!0;e.referencedImageURI||(e.referencedImageURI=gi(a));const{referencedImageURI:c}=e,l=this.imageKeyToIndexMap.get(c);if(n.asOverlay&&this.matchImagesForOverlay(i,a))return!0;if(l===void 0)return!1;if(n.withNavigation)return!0;const f=o&&this.imageKeyToIndexMap.get(o.referencedImageId);return r<=f&&r>=l}if(!super.isReferenceViewable(e,n))return!1;if(e.volumeId)return n.asVolume;const{cameraFocalPoint:s}=e;if(n.asNearbyProjection&&s){const{spacing:c,direction:l,origin:f}=this.getImageData(),u=l.slice(6,9),g=Td({direction:l,spacing:c},u),d=tn(Le(),s,f),h=Qe(d,u),p=g/2;if(Math.abs(h)<=p)return!0}return!1}getViewReference(e={}){const{sliceIndex:n=this.getCurrentImageIdIndex()}=e,r=super.getViewReference(e),i=this.getCurrentImageId(n);if(i){if(r.referencedImageId=i,this.getCurrentImageIdIndex()!==n){const a=this.getImagePlaneReferenceData(n);if(!a)return;Object.assign(r,a)}return r}}setViewReference(e){if(!(e!=null&&e.referencedImageId)){(e==null?void 0:e.sliceIndex)!==void 0&&this.scroll(e.sliceIndex-this.targetImageIdIndex);return}const{referencedImageId:n}=e;e.referencedImageURI||(e.referencedImageURI=gi(n));const{referencedImageURI:r}=e,i=this.imageKeyToIndexMap.get(r);if(i===void 0){console.error(`No image URI found for ${r}`);return}this.scroll(i-this.targetImageIdIndex)}getViewReferenceId(e={}){const{sliceIndex:n=this.currentImageIdIndex}=e;return`imageId:${this.imageIds[n]}`}getSliceIndexForImage(e){if(e){if(typeof e=="string")return this.imageKeyToIndexMap.get(e);if(e.referencedImageId)return this.imageKeyToIndexMap.get(e.referencedImageId)}}getCPUFallbackError(e){return new Error(`method ${e} cannot be used during CPU Fallback mode`)}fillWithBackgroundColor(){const e=this.getRenderingEngine();e&&e.fillCanvasWithBackgroundColor(this.canvas,this.options.background)}unsetColormapCPU(){delete this._cpuFallbackEnabledElement.viewport.colormap,this._cpuFallbackEnabledElement.renderingTools={},this.cpuRenderingInvalidated=!0,this.fillWithBackgroundColor(),this.render()}setColormapCPU(e){this.colormap=e;const n=zg(e.name);this._cpuFallbackEnabledElement.viewport.colormap=n,this._cpuFallbackEnabledElement.renderingTools={},this.fillWithBackgroundColor(),this.cpuRenderingInvalidated=!0,this.render();const r={viewportId:this.id,colormap:e};De(this.element,Oe.COLORMAP_MODIFIED,r)}setColormapGPU(e){const i=this.getDefaultActor().actor.getProperty(),a=i.getRGBTransferFunction(),o=zg(e.name)||wh.getPresetByName(e.name);if(a)a.applyColorMap(o),a.setMappingRange(this.voiRange.lower,this.voiRange.upper),i.setRGBTransferFunction(0,a);else{const c=Dc.newInstance();c.applyColorMap(o),c.setMappingRange(this.voiRange.lower,this.voiRange.upper),i.setRGBTransferFunction(0,c)}this.colormap=e,this.render();const s={viewportId:this.id,colormap:e};De(this.element,Oe.COLORMAP_MODIFIED,s)}unsetColormapGPU(){throw new Error("unsetColormapGPU not implemented.")}_getImagePlaneModule(e){var i;const n=Ve(li.IMAGE_PLANE,e);this.hasPixelSpacing=!n.usingDefaultValues||((i=this.calibration)==null?void 0:i.scale)>0,this.calibration||(this.calibration=n.calibration);const r={...n};return r.columnPixelSpacing||(r.columnPixelSpacing=1),r.rowPixelSpacing||(r.rowPixelSpacing=1),r.columnCosines||(r.columnCosines=[0,1,0]),r.rowCosines||(r.rowCosines=[1,0,0]),r.imagePositionPatient||(r.imagePositionPatient=[0,0,0]),r.imageOrientationPatient||(r.imageOrientationPatient=new Float32Array([1,0,0,0,1,0])),r}}class ZR extends za{constructor(e){super(e),this.getNumberOfSlices=()=>1,this.getRotation=()=>0,this.getCurrentImageIdIndex=()=>0,this.getCurrentImageId=()=>null,this.resetCameraForResize=()=>this.resetCamera({resetPan:!0,resetZoom:!0,resetToCenter:!0});const{parallelProjection:n,orientation:r}=this.options,i=this.getVtkActiveCamera();n!=null&&i.setParallelProjection(n),r&&r!==Ou.ACQUISITION&&this.applyViewOrientation(r)}resetCamera({resetPan:e=!0,resetZoom:n=!0,resetToCenter:r=!0}={}){super.resetCamera({resetPan:e,resetZoom:n,resetToCenter:r});const i=this.getVtkActiveCamera();return i.getParallelProjection()?i.setClippingRange(-mn.MAXIMUM_RAY_DISTANCE,mn.MAXIMUM_RAY_DISTANCE):i.setClippingRange(mn.MINIMUM_SLAB_THICKNESS,mn.MAXIMUM_RAY_DISTANCE),this.getRenderer().resetCameraClippingRange(),!0}setSlabThickness(e,n){return null}setBlendMode(e,n,r){return null}resetProperties(e){const n=e?this.getActor(e):this.getDefaultActor();if(!n)throw new Error(`No actor found for the given volumeId: ${e}`);n.slabThickness&&(n.slabThickness=mn.MINIMUM_SLAB_THICKNESS,this.viewportProperties.slabThickness=void 0,this.updateClippingPlanesForActors(this.getCamera())),e||(e=this.getVolumeId());const r=Me.getVolume(e);if(!r)throw new Error(`imageVolume with id: ${e} does not exist in cache`);if(My(n.actor,r),co(n)){const i=n.actor.getProperty().getRGBTransferFunction(0);O2(i,this.initialTransferFunctionNodes)}this.setCamera(this.initialCamera),De(this.element,Oe.VOI_MODIFIED,super.getVOIModifiedEventDetail(e))}getSliceIndex(){return null}setCamera(e){super.setCamera(e),this.getRenderer().resetCameraClippingRange(),this.render()}setCameraClippingRange(){const e=this.getVtkActiveCamera();e.getParallelProjection()?e.setClippingRange(-mn.MAXIMUM_RAY_DISTANCE,mn.MAXIMUM_RAY_DISTANCE):e.setClippingRange(mn.MINIMUM_SLAB_THICKNESS,mn.MAXIMUM_RAY_DISTANCE)}resetSlabThickness(){return null}}const QR="viewport-element",JR="cornerstone-canvas",w7=1e-4;function VY(t){const e=document.createElement("canvas");return e.style.position="absolute",e.style.width="100%",e.style.height="100%",e.style.imageRendering="pixelated",e.classList.add(JR),t.appendChild(e),e}function PY(t){const e=document.createElement("div");return e.style.position="relative",e.style.width="100%",e.style.height="100%",e.style.overflow="hidden",e.classList.add(QR),t.appendChild(e),e}function Yo(t){const e=`canvas.${JR}`,n=`div.${QR}`,r=t.querySelector(n)||PY(t),i=r.querySelector(e);if(i)return i;const a=VY(r),o=r.getBoundingClientRect(),s=window.devicePixelRatio||1,c=Math.ceil(o.width*s),l=Math.ceil(o.height*s);return a.width=c,a.height=l,a}async function NY(t,e,n,r=!1,i=!1){n.forEach(o=>{const s=t.getViewport(o);if(!s)throw new Error(`Viewport with Id ${o} does not exist`);if(!(s instanceof za))throw new Error("setVolumesForViewports only supports VolumeViewport and VolumeViewport3D")});const a=n.map(async o=>{await t.getViewport(o).setVolumes(e,r,i)});await Promise.all(a)}async function kY(t,e,n,r=!1,i=!1){for(const o of n){const s=t.getViewport(o);if(!s)throw new Error(`Viewport with Id ${o} does not exist`);if(!(s instanceof za)){console.warn(`Viewport with Id ${o} is not a BaseVolumeViewport. Cannot add volume to this viewport.`);return}}const a=n.map(async o=>{await t.getViewport(o).addVolumes(e,r,i)});await Promise.all(a)}function AY(t,e,n){for(const r of n){const i=t.getViewport(r);if(!i)throw new Error(`Viewport with Id ${r} does not exist`);if(!i.addImages){console.warn(`Viewport with Id ${r} does not have addImages. Cannot add image segmentation to this viewport.`);return}}n.forEach(r=>{t.getViewport(r).addImages(e)})}class FY{constructor(e){this.opacity=.4,this.outlineOpacity=.4,this.transferFunction=[],this.actor=e}setRGBTransferFunction(e,n){this.transferFunction[e]=n}setScalarOpacity(e){}setInterpolationTypeToNearest(){}setUseLabelOutline(){}setLabelOutlineOpacity(e){this.outlineOpacity=e}setLabelOutlineThickness(){}getColor(e){const n=this.transferFunction[0],r=n.getRedValue(e),i=n.getGreenValue(e),a=n.getBlueValue(e);return[r,i,a,this.opacity]}}class UY{constructor(e){this.actor=e}getInputData(){return this.actor.getImage()}}class BY{constructor(e,n){this.canvasProperties=new FY(this),this.visibility=!1,this.mapper=new UY(this),this.className="CanvasActor",this.derivedImage=n,this.viewport=e}renderRLE(e,n,r){const{width:i,height:a}=this.image;let{canvas:o}=this;(!o||o.width!==i||o.height!==a)&&(this.canvas=o=new window.OffscreenCanvas(i,a));const s=o.getContext("2d"),c=s.createImageData(i,a),{data:l}=c;l.fill(0);const{map:f}=r;let u=1/0,g=1/0,d=-1/0,h=-1/0;for(let v=0;v<a;v++){const y=f.getRun(v,0);if(!y)continue;g=Math.min(g,v),h=Math.max(h,v);const T=v*i<<2;let C;for(const w of y){const{start:x,end:O,value:M}=w;if(M===0){C||(C=[]),C.push(y.indexOf(w));continue}u=Math.min(u,x),d=Math.max(d,O);const A=this.canvasProperties.getColor(M).map(k=>k*255);let _=T+(x<<2);for(let k=x;k<O;k++)l[_++]=A[0],l[_++]=A[1],l[_++]=A[2],l[_++]=A[3]}}if(u>i)return;const p=d-u,m=h-g;s.putImageData(c,0,0,u-1,g-1,p+2,m+2),n.drawImage(o,u,g,p,m,u,g,p,m)}setMapper(e){this.mapper=e}render(e,n){if(!this.visibility)return;const r=this.image||this.getImage(),{width:i,height:a}=r,o=r.getScalarData();if(!o)return;const{voxelManager:s}=r;if(s&&s.map.getRun){this.renderRLE(e,n,s);return}let{canvas:c}=this;(!c||c.width!==i||c.height!==a)&&(this.canvas=c=new window.OffscreenCanvas(i,a));const l=c.getContext("2d"),f=l.createImageData(i,a),{data:u}=f;let g=0,d=0,h=1/0,p=1/0,m=-1/0,v=-1/0;for(let C=0;C<a;C++)for(let w=0;w<i;w++){const x=o[g++];if(x){h=Math.min(w,h),p=Math.min(C,p),m=Math.max(w,m),v=Math.max(C,v);const O=this.canvasProperties.getColor(x);u[d]=O[0]*255,u[d+1]=O[1]*255,u[d+2]=O[2]*255,u[d+3]=127}d+=4}if(h>i)return;const y=m-h+1,T=v-p+1;l.putImageData(f,0,0,h,p,y,T),n.drawImage(c,h,p,y,T,h,p,y,T)}getClassName(){return this.className}getProperty(){return this.canvasProperties}setVisibility(e){this.visibility=e}getMapper(){return this.mapper}isA(e){return e===this.className}getImage(){if(this.image)return this.image;this.image={...this.derivedImage};const e=this.viewport.getImageData();return Object.assign(this.image,{worldToIndex:n=>e.imageData.worldToIndex(n),indexToWorld:(n,r)=>e.imageData.indexToWorld(n,r),getDimensions:()=>e.dimensions,getScalarData:()=>{var n;return(n=this.derivedImage)==null?void 0:n.getPixelData()},getDirection:()=>e.direction,getSpacing:()=>e.spacing,setOrigin:()=>null,setDerivedImage:n=>{this.derivedImage=n,this.image=null},modified:()=>null}),this.image}}const I8=class I8{static imageIdToFrames(e){const n=e.match(this.frameRangeExtractor);if(!n||!n[2])return null;const r=n[2].split("-").map(i=>Number(i));return r.length===1?r[0]:r}static imageIdToFrameEnd(e){const n=this.imageIdToFrames(e);return Array.isArray(n)?n[1]:n}static imageIdToFrameStart(e){const n=this.imageIdToFrames(e);return Array.isArray(n)?n[0]:n}static framesToString(e){return Array.isArray(e)?`${e[0]}-${e[1]}`:String(e)}static framesToImageId(e,n){const r=e.match(this.frameRangeExtractor);if(!r||!r[2])return null;const i=this.framesToString(n);return e.replace(this.frameRangeExtractor,`${r[1]}${i}`)}};I8.frameRangeExtractor=/(\/frames\/|[&?]frameNumber=)([^/&?]*)/i;let uu=I8;const vg=class vg extends Iu{constructor(e){super({...e,canvas:e.canvas||Yo(e.element)}),this.videoWidth=0,this.videoHeight=0,this.loop=!0,this.mute=!0,this.isPlaying=!1,this.scrollSpeed=1,this.playbackRate=1,this.frameRange=[0,0],this.fps=30,this.videoCamera={panWorld:[0,0],parallelScale:1},this.voiRange={lower:0,upper:255},this.getProperties=()=>({loop:this.videoElement.loop,muted:this.videoElement.muted,playbackRate:this.playbackRate,scrollSpeed:this.scrollSpeed,voiRange:{...this.voiRange}}),this.getMiddleSliceData=()=>{throw new Error("Method not implemented.")},this.useCustomRenderingPipeline=!0,this.resetCamera=()=>(this.refreshRenderValues(),this.canvasContext.fillRect(0,0,this.canvas.width,this.canvas.height),this.isPlaying||this.renderFrame(),!0),this.getNumberOfSlices=()=>{const n=Math.round(this.videoElement.duration*this.fps/this.scrollSpeed);return isNaN(n)?this.numberOfFrames:n},this.getFrameOfReferenceUID=()=>this.videoElement.src,this.resize=()=>{const n=this.canvas,{clientWidth:r,clientHeight:i}=n;(n.width!==r||n.height!==i)&&(n.width=r,n.height=i),this.refreshRenderValues(),this.isPlaying||this.renderFrame()},this.canvasToWorld=(n,r=[0,0,0])=>{const i=this.videoCamera.panWorld,a=this.getWorldToCanvasRatio(),o=[i[0]*a,i[1]*a],s=[n[0]-o[0],n[1]-o[1]];return r.splice(0,2,s[0]/a,s[1]/a),r},this.worldToCanvas=n=>{const r=this.videoCamera.panWorld,i=this.getWorldToCanvasRatio();return[(n[0]+r[0])*i,(n[1]+r[1])*i]},this.getRotation=()=>0,this.canvasToIndex=n=>{const r=this.getTransform();return r.invert(),r.transformPoint(n.map(i=>i*devicePixelRatio))},this.indexToCanvas=n=>this.getTransform().transformPoint(n).map(i=>i/devicePixelRatio),this.customRenderViewportToCanvas=()=>{this.renderFrame()},this.renderFrame=()=>{var s;const n=window.devicePixelRatio||1,i=this.getTransform().getMatrix(),a=this.canvasContext;a.resetTransform(),a.clearRect(0,0,this.canvas.width,this.canvas.height),a.transform(i[0]/n,i[1]/n,i[2]/n,i[3]/n,i[4]/n,i[5]/n),a.drawImage(this.videoElement,0,0,this.videoWidth,this.videoHeight);for(const c of this.getActors())c.actor.render(this,this.canvasContext);this.canvasContext.resetTransform(),De(this.element,Oe.STACK_NEW_IMAGE,{element:this.element,viewportId:this.id,viewport:this,renderingEngineId:this.renderingEngineId,time:this.videoElement.currentTime,duration:this.videoElement.duration}),De(this.element,Oe.IMAGE_RENDERED,{element:this.element,viewportId:this.id,viewport:this,imageIndex:this.getCurrentImageIdIndex(),numberOfSlices:this.numberOfFrames,renderingEngineId:this.renderingEngineId,time:this.videoElement.currentTime,duration:this.videoElement.duration}),(s=this.initialRender)==null||s.call(this);const o=this.getFrameNumber();this.isPlaying&&(o<this.frameRange[0]?this.setFrameNumber(this.frameRange[0]):o>this.frameRange[1]&&(this.loop?this.setFrameNumber(this.frameRange[0]):this.pause()))},this.renderWhilstPlaying=()=>{this.renderFrame(),this.isPlaying&&requestAnimationFrame(this.renderWhilstPlaying)},this.canvasContext=this.canvas.getContext("2d"),this.renderingEngineId=e.renderingEngineId,this.element.setAttribute("data-viewport-uid",this.id),this.element.setAttribute("data-rendering-engine-uid",this.renderingEngineId),this.videoElement=document.createElement("video"),this.videoElement.muted=this.mute,this.videoElement.loop=this.loop,this.videoElement.autoplay=!0,this.videoElement.crossOrigin="anonymous",this.addEventListeners(),this.resize()}static get useCustomRenderingPipeline(){return!0}addEventListeners(){this.canvas.addEventListener(Oe.ELEMENT_DISABLED,this.elementDisabledHandler)}removeEventListeners(){this.canvas.removeEventListener(Oe.ELEMENT_DISABLED,this.elementDisabledHandler)}elementDisabledHandler(){this.removeEventListeners(),this.videoElement.remove()}getImageDataMetadata(e){const n=typeof e=="string"?e:e.imageId,r=Ve(li.IMAGE_PLANE,n);let i=r.rowCosines,a=r.columnCosines;(r.usingDefaultValues||i==null||a==null)&&(i=[1,0,0],a=[0,1,0]);const s=Cn(i[0],i[1],i[2]),c=Cn(a[0],a[1],a[2]),{rows:l,columns:f}=r,u=Le();an(u,s,c);let g=r.imagePositionPatient;g==null&&(g=[0,0,0]);const d=r.columnPixelSpacing||1,h=r.rowPixelSpacing||1,p=r.columns,m=r.rows,v=1,y=1;return this.hasPixelSpacing=!!r.columnPixelSpacing,{bitsAllocated:8,numberOfComponents:3,origin:g,rows:l,columns:f,direction:[...s,...c,...u],dimensions:[p,m,y],spacing:[d,h,v],hasPixelSpacing:this.hasPixelSpacing,numVoxels:p*m*y,imagePlaneModule:r}}setDataIds(e,n){var r;this.setVideo(e[0],(((r=n.viewReference)==null?void 0:r.sliceIndex)||0)+1)}setVideo(e,n){this.imageId=Array.isArray(e)?e[0]:e;const r=Ve(li.IMAGE_URL,e);if(!(r!=null&&r.rendered))throw new Error(`Video Image ID ${e} does not have a rendered video view`);const{rendered:i}=r,a=Ve(li.GENERAL_SERIES,e);this.modality=a==null?void 0:a.Modality,this.metadata=this.getImageDataMetadata(e);let{cineRate:o,numberOfFrames:s}=Ve(li.CINE,e);return this.numberOfFrames=s,this.setVideoURL(i).then(()=>((!s||s===1)&&(s=Math.round(this.videoElement.duration*(o||30))),o||(o=Math.round(s/this.videoElement.duration)),this.fps=o,this.numberOfFrames=s,this.setFrameRange([1,s]),this.initialRender=()=>{this.initialRender=null,this.pause(),this.setFrameNumber(n||1)},new Promise(c=>{window.setTimeout(()=>{this.setFrameNumber(n||1),c(this)},25)})))}async setVideoURL(e){return new Promise(n=>{this.videoElement.src=e,this.videoElement.preload="auto";const r=()=>{this.videoWidth=this.videoElement.videoWidth,this.videoHeight=this.videoElement.videoHeight,this.videoElement.removeEventListener("loadedmetadata",r),this.refreshRenderValues(),n(!0)};this.videoElement.addEventListener("loadedmetadata",r)})}getImageIds(){const e=new Array(this.numberOfFrames),n=this.imageId.replace(/[0-9]+$/,"");for(let r=0;r<this.numberOfFrames;r++)e[r]=`${n}${r+1}`;return e}togglePlayPause(){return this.isPlaying?(this.pause(),!1):(this.play(),!0)}async play(){try{this.isPlaying||(this.isPlaying=!0,await this.videoElement.play(),this.renderWhilstPlaying())}catch{}}pause(){try{this.isPlaying=!1,this.videoElement.pause()}catch{}}async scroll(e=1){await this.pause();const n=this.videoElement,r=this.renderFrame,a=n.currentTime+e*this.scrollSpeed/this.fps;n.currentTime=a;const o=s=>{r(),n.removeEventListener("seeked",o)};n.addEventListener("seeked",o)}async start(){const e=this.videoElement,n=this.renderFrame;if(e.currentTime=0,e.paused){const r=i=>{n(),e.removeEventListener("seeked",r)};e.addEventListener("seeked",r)}}async end(){const e=this.videoElement,n=this.renderFrame;if(e.currentTime=e.duration,e.paused){const r=i=>{n(),e.removeEventListener("seeked",r)};e.addEventListener("seeked",r)}}async setTime(e){const n=this.videoElement,r=this.renderFrame;if(n.currentTime=e,n.paused){const i=a=>{r(),n.removeEventListener("seeked",i)};n.addEventListener("seeked",i)}}getSliceViewInfo(){throw new Error("Method not implemented.")}async setFrameNumber(e){this.setTime((e-1)/this.fps)}setFrameRange(e){if(!e){this.frameRange=[1,this.numberOfFrames];return}e.length!==2||e[0]===e[1]||(this.frameRange=[e[0],e[1]])}getSliceIndexForImage(e){if(e){if(typeof e=="string")return uu.imageIdToFrameStart(e);if(e.referencedImageId)return uu.imageIdToFrameStart(e.referencedImageId)}}getFrameRange(){return this.frameRange}setProperties(e){e.loop!==void 0&&(this.videoElement.loop=e.loop),e.muted!==void 0&&(this.videoElement.muted=e.muted),e.playbackRate!==void 0&&this.setPlaybackRate(e.playbackRate),e.scrollSpeed!==void 0&&this.setScrollSpeed(e.scrollSpeed),e.voiRange&&this.setVOI(e.voiRange)}setPlaybackRate(e=1){if(this.playbackRate=e,e<.0625){this.pause();return}this.videoElement&&(this.videoElement.playbackRate=e,this.play())}setScrollSpeed(e=1,n=kg.FRAME){this.scrollSpeed=n===kg.SECOND?e*this.fps:e}resetProperties(){this.setProperties({loop:!1,muted:!0})}getScalarData(){var a;if(((a=this.scalarData)==null?void 0:a.frameNumber)===this.getFrameNumber())return this.scalarData;if(!this.videoElement||!this.videoElement.videoWidth||!this.videoElement.videoHeight){console.debug("Video not ready yet, returning empty scalar data");const o=new Uint8ClampedArray;return o.getRange=()=>[0,255],o.frameNumber=-1,o}const e=document.createElement("canvas");e.width=this.videoElement.videoWidth,e.height=this.videoElement.videoHeight;const n=e.getContext("2d");n.drawImage(this.videoElement,0,0);const i=n.getImageData(0,0,e.width,e.height).data;return i.getRange=()=>[0,255],i.frameNumber=this.getFrameNumber(),this.scalarData=i,i}getImageData(){const{metadata:e}=this,n=e.spacing,r={getDirection:()=>e.direction,getDimensions:()=>e.dimensions,getRange:()=>[0,255],getScalarData:()=>this.getScalarData(),getSpacing:()=>e.spacing,worldToIndex:a=>{const o=this.worldToCanvas(a),s=this.canvasToIndex(o);return[s[0],s[1],0]},indexToWorld:(a,o)=>{const s=this.indexToCanvas([a[0],a[1]]);return this.canvasToWorld(s,o)}},i={dimensions:e.dimensions,spacing:n,origin:e.origin,direction:e.direction,metadata:{Modality:this.modality,FrameOfReferenceUID:e.FrameOfReferenceUID},getScalarData:()=>this.getScalarData(),scalarData:this.getScalarData(),imageData:r,voxelManager:{forEach:(a,o)=>Sy(o.imageData,{pointInShapeFn:o.isInObject??(()=>!0),callback:a,boundsIJK:o.boundsIJK,returnPoints:o.returnPoints??!1})},hasPixelSpacing:this.hasPixelSpacing,calibration:this.calibration,preScale:{scaled:!1}};return Object.defineProperty(r,"scalarData",{get:()=>this.getScalarData(),enumerable:!0}),i}hasImageURI(e){const n=e.match(vg.frameRangeExtractor),r=n?e.substring(0,n.index):e;return this.imageId.includes(r)}setVOI(e){this.voiRange=e,this.setColorTransform()}setWindowLevel(e=256,n=128){const r=n-e/2,i=n+e/2-1;this.setVOI({lower:r,upper:i}),this.setColorTransform()}setAverageWhite(e){this.averageWhite=e,this.setColorTransform()}setColorTransform(){if(!this.voiRange&&!this.averageWhite){this.feFilter=null;return}const e=this.averageWhite||[255,255,255],n=Math.max(...e),r=e.map(c=>n/c),{lower:i=0,upper:a=255}=this.voiRange||{},o=(a-i+1)/255,s=i/255;this.feFilter=`url('data:image/svg+xml,      <svg xmlns="http://www.w3.org/2000/svg">        <filter id="colour" color-interpolation-filters="linearRGB">        <feColorMatrix type="matrix"         values="          ${r[0]*o} 0 0 0 ${s}           0 ${r[1]*o} 0 0 ${s}           0 0 ${r[2]*o} 0 ${s}           0 0 0 1 0" />        </filter>      </svg>#colour')`,this.canvas.style.filter=this.feFilter}setCamera(e){const{parallelScale:n,focalPoint:r}=e;if(n&&(this.videoCamera.parallelScale=this.element.clientHeight/2/n),r!==void 0){const i=this.worldToCanvas(r),a=[this.element.clientWidth/2,this.element.clientHeight/2],o=[(i[0]-a[0])/this.videoCamera.parallelScale,(i[1]-a[1])/this.videoCamera.parallelScale];this.videoCamera.panWorld=[this.videoCamera.panWorld[0]-o[0],this.videoCamera.panWorld[1]-o[1]]}this.canvasContext.fillStyle="rgba(0,0,0,1)",this.canvasContext.fillRect(0,0,this.canvas.width,this.canvas.height),this.isPlaying||this.renderFrame()}getCurrentImageId(e=this.getCurrentImageIdIndex()){return this.imageId.replace("/frames/1",`/frames/${e+1}`)}getViewReferenceId(e={}){const{sliceIndex:n}=e;return n===void 0?`videoId:${this.getCurrentImageId()}`:Array.isArray(n)?`videoId:${this.imageId.substring(0,this.imageId.length-1)}${n[0]+1}-${n[1]+1}`:`videoId:${this.imageId.replace("/frames/1",`/frames/${1+n}`)}`}isReferenceViewable(e,n={}){let{imageURI:r}=n;const{referencedImageId:i,sliceIndex:a,multiSliceReference:o}=e;if(!super.isReferenceViewable(e))return!1;const s=this.getCurrentImageId();if(!r){const g=s.indexOf(":");r=s.substring(g+1,s.length-1)}if(n.withNavigation)return!0;const c=this.getSliceIndex();if(o){const g=uu.imageIdToFrameEnd(o.referencedImageId);return c>=a&&c<=g}if(a!==void 0)return c===a;if(!i)return!1;const l=i.match(vg.frameRangeExtractor);if(!l||!l[2])return!0;const f=l[2].split("-").map(g=>Number(g)),u=c+1;return f[0]<=u&&u<=(f[1]??f[0])}setViewReference(e){typeof e.sliceIndex=="number"?this.setFrameNumber(e.sliceIndex+1):Array.isArray(e.sliceIndex)&&this.setFrameRange(e.sliceIndex)}getViewReference(e){const n=(e==null?void 0:e.sliceIndex)??(this.isPlaying?this.frameRange[0]:this.getCurrentImageIdIndex()),r=(e==null?void 0:e.rangeEndSliceIndex)??(this.isPlaying?this.frameRange[1]-1:void 0),i=r>n?{sliceIndex:r,referencedImageId:this.getCurrentImageId(r)}:void 0;return{...super.getViewReference(e),referencedImageId:this.getViewReferenceId(e),sliceIndex:n,multiSliceReference:i}}getFrameNumber(){return 1+this.getCurrentImageIdIndex()}getCurrentImageIdIndex(){return Math.round(this.videoElement.currentTime*this.fps)}getSliceIndex(){return this.getCurrentImageIdIndex()/this.scrollSpeed}getCamera(){const{parallelScale:e}=this.videoCamera,n=[this.element.clientWidth/2,this.element.clientHeight/2];return{parallelProjection:!0,focalPoint:this.canvasToWorld(n),position:[0,0,0],viewUp:[0,-1,0],parallelScale:this.element.clientHeight/2/e,viewPlaneNormal:[0,0,1]}}getFrameRate(){return this.fps}getPan(){const e=this.videoCamera.panWorld;return[e[0],e[1]]}refreshRenderValues(){let e=this.canvas.offsetWidth/this.videoWidth;this.videoHeight*e>this.canvas.height&&(e=this.canvas.offsetHeight/this.videoHeight);const n=Math.floor(this.videoWidth*e),r=Math.floor(this.videoHeight*e),i=(this.canvas.offsetWidth-n)/2,a=(this.canvas.offsetHeight-r)/2,o=i/e,s=a/e;this.videoCamera.panWorld=[o,s],this.videoCamera.parallelScale=e}getWorldToCanvasRatio(){return this.videoCamera.parallelScale}getCanvasToWorldRatio(){return 1/this.videoCamera.parallelScale}getTransform(){const e=this.videoCamera.panWorld,n=window.devicePixelRatio||1,r=this.getWorldToCanvasRatio(),i=this.getCanvasToWorldRatio(),a=[this.canvas.offsetWidth/2,this.canvas.offsetHeight/2],o=[a[0]*i,a[1]*i],s=new tf;return s.scale(n,n),s.translate(a[0],a[1]),s.scale(r,r),s.translate(e[0],e[1]),s.translate(-o[0],-o[1]),s}updateCameraClippingPlanesAndRange(){}addImages(e){const n=this.getActors();e.forEach(r=>{const{imageId:i,...a}=r,o=Me.getImage(i),s=this.createActorMapper(o),c=r.actorUID??In();s&&(n.push({uid:c,actor:s,referencedId:i,...a}),r.callback&&r.callback({imageActor:s,imageId:i}))}),this.setActors(n)}createActorMapper(e){return new BY(this,e)}};vg.frameRangeExtractor=/(\/frames\/|[&?]frameNumber=)([^/&?]*)/i;let Q3=vg;const GY=`
.DicomMicroscopyViewer {
  --ol-partial-background-color: rgba(127, 127, 127, 0.7);
  --ol-foreground-color: #000000;
  --ol-subtle-foreground-color: #000;
  --ol-subtle-background-color: rgba(78, 78, 78, 0.5);
}

.DicomMicroscopyViewer .ol-box {
  box-sizing: border-box;
  border-radius: 2px;
  border: 1.5px solid var(--ol-background-color);
  background-color: var(--ol-partial-background-color);
}

.DicomMicroscopyViewer .ol-mouse-position {
  top: 8px;
  right: 8px;
  position: absolute;
}

.DicomMicroscopyViewer .ol-scale-line {
  background: var(--ol-partial-background-color);
  border-radius: 4px;
  bottom: 8px;
  left: 8px;
  padding: 2px;
  position: absolute;
}

.DicomMicroscopyViewer .ol-scale-line-inner {
  border: 1px solid var(--ol-subtle-foreground-color);
  border-top: none;
  color: var(--ol-foreground-color);
  font-size: 10px;
  text-align: center;
  margin: 1px;
  will-change: contents, width;
  transition: all 0.25s;
}

.DicomMicroscopyViewer .ol-scale-bar {
  position: absolute;
  bottom: 8px;
  left: 8px;
}

.DicomMicroscopyViewer .ol-scale-bar-inner {
  display: flex;
}

.DicomMicroscopyViewer .ol-scale-step-marker {
  width: 1px;
  height: 15px;
  background-color: var(--ol-foreground-color);
  float: right;
  z-index: 10;
}

.DicomMicroscopyViewer .ol-scale-step-text {
  position: absolute;
  bottom: -5px;
  font-size: 10px;
  z-index: 11;
  color: var(--ol-foreground-color);
  text-shadow:
    -1.5px 0 var(--ol-partial-background-color),
    0 1.5px var(--ol-partial-background-color),
    1.5px 0 var(--ol-partial-background-color),
    0 -1.5px var(--ol-partial-background-color);
}

.DicomMicroscopyViewer .ol-scale-text {
  position: absolute;
  font-size: 12px;
  text-align: center;
  bottom: 25px;
  color: var(--ol-foreground-color);
  text-shadow:
    -1.5px 0 var(--ol-partial-background-color),
    0 1.5px var(--ol-partial-background-color),
    1.5px 0 var(--ol-partial-background-color),
    0 -1.5px var(--ol-partial-background-color);
}

.DicomMicroscopyViewer .ol-scale-singlebar {
  position: relative;
  height: 10px;
  z-index: 9;
  box-sizing: border-box;
  border: 1px solid var(--ol-foreground-color);
}

.DicomMicroscopyViewer .ol-scale-singlebar-even {
  background-color: var(--ol-subtle-foreground-color);
}

.DicomMicroscopyViewer .ol-scale-singlebar-odd {
  background-color: var(--ol-background-color);
}

.DicomMicroscopyViewer .ol-unsupported {
  display: none;
}

.DicomMicroscopyViewer .ol-viewport,
.DicomMicroscopyViewer .ol-unselectable {
  -webkit-touch-callout: none;
  -webkit-user-select: none;
  -moz-user-select: none;
  user-select: none;
  -webkit-tap-highlight-color: transparent;
}

.DicomMicroscopyViewer .ol-viewport canvas {
  all: unset;
}

.DicomMicroscopyViewer .ol-selectable {
  -webkit-touch-callout: default;
  -webkit-user-select: text;
  -moz-user-select: text;
  user-select: text;
}

.DicomMicroscopyViewer .ol-grabbing {
  cursor: -webkit-grabbing;
  cursor: -moz-grabbing;
  cursor: grabbing;
}

.DicomMicroscopyViewer .ol-grab {
  cursor: move;
  cursor: -webkit-grab;
  cursor: -moz-grab;
  cursor: grab;
}

.DicomMicroscopyViewer .ol-control {
  position: absolute;
  background-color: var(--ol-subtle-background-color);
  border-radius: 4px;
}

.DicomMicroscopyViewer .ol-zoom {
  top: 0.5em;
  left: 0.5em;
}

.DicomMicroscopyViewer .ol-rotate {
  top: 0.5em;
  right: 0.5em;
  transition:
    opacity 0.25s linear,
    visibility 0s linear;
}

.DicomMicroscopyViewer .ol-rotate.ol-hidden {
  opacity: 0;
  visibility: hidden;
  transition:
    opacity 0.25s linear,
    visibility 0s linear 0.25s;
}

.DicomMicroscopyViewer .ol-zoom-extent {
  top: 4.643em;
  left: 0.5em;
}

.DicomMicroscopyViewer .ol-full-screen {
  right: 0.5em;
  top: 0.5em;
}

.DicomMicroscopyViewer .ol-control button {
  display: block;
  margin: 1px;
  padding: 0;
  color: var(--ol-subtle-foreground-color);
  font-weight: bold;
  text-decoration: none;
  font-size: inherit;
  text-align: center;
  height: 1.375em;
  width: 1.375em;
  line-height: 0.4em;
  background-color: var(--ol-background-color);
  border: none;
  border-radius: 2px;
}

.DicomMicroscopyViewer .ol-control button::-moz-focus-inner {
  border: none;
  padding: 0;
}

.DicomMicroscopyViewer .ol-zoom-extent button {
  line-height: 1.4em;
}

.DicomMicroscopyViewer .ol-compass {
  display: block;
  font-weight: normal;
  will-change: transform;
}

.DicomMicroscopyViewer .ol-touch .ol-control button {
  font-size: 1.5em;
}

.DicomMicroscopyViewer .ol-touch .ol-zoom-extent {
  top: 5.5em;
}

.DicomMicroscopyViewer .ol-control button:hover,
.DicomMicroscopyViewer .ol-control button:focus {
  text-decoration: none;
  outline: 1px solid var(--ol-subtle-foreground-color);
  color: var(--ol-foreground-color);
}

.DicomMicroscopyViewer .ol-zoom .ol-zoom-in {
  border-radius: 2px 2px 0 0;
}

.DicomMicroscopyViewer .ol-zoom .ol-zoom-out {
  border-radius: 0 0 2px 2px;
}

.DicomMicroscopyViewer .ol-attribution {
  text-align: right;
  bottom: 0.5em;
  right: 0.5em;
  max-width: calc(100% - 1.3em);
  display: flex;
  flex-flow: row-reverse;
  align-items: center;
}

.DicomMicroscopyViewer .ol-attribution a {
  color: var(--ol-subtle-foreground-color);
  text-decoration: none;
}

.DicomMicroscopyViewer .ol-attribution ul {
  margin: 0;
  padding: 1px 0.5em;
  color: var(--ol-foreground-color);
  text-shadow: 0 0 2px var(--ol-background-color);
  font-size: 12px;
}

.DicomMicroscopyViewer .ol-attribution li {
  display: inline;
  list-style: none;
}

.DicomMicroscopyViewer .ol-attribution li:not(:last-child):after {
  content: ' ';
}

.DicomMicroscopyViewer .ol-attribution img {
  max-height: 2em;
  max-width: inherit;
  vertical-align: middle;
}

.DicomMicroscopyViewer .ol-attribution button {
  flex-shrink: 0;
}

.DicomMicroscopyViewer .ol-attribution.ol-collapsed ul {
  display: none;
}

.DicomMicroscopyViewer .ol-attribution:not(.ol-collapsed) {
  background: var(--ol-partial-background-color);
}

.DicomMicroscopyViewer .ol-attribution.ol-uncollapsible {
  bottom: 0;
  right: 0;
  border-radius: 4px 0 0;
}

.DicomMicroscopyViewer .ol-attribution.ol-uncollapsible img {
  margin-top: -0.2em;
  max-height: 1.6em;
}

.DicomMicroscopyViewer .ol-attribution.ol-uncollapsible button {
  display: none;
}

.DicomMicroscopyViewer .ol-zoomslider {
  top: 4.5em;
  left: 0.5em;
  height: 200px;
}

.DicomMicroscopyViewer .ol-zoomslider button {
  position: relative;
  height: 10px;
}

.DicomMicroscopyViewer .ol-touch .ol-zoomslider {
  top: 5.5em;
}

.DicomMicroscopyViewer .ol-overviewmap {
  left: 0.5em;
  bottom: 0.5em;
}

.DicomMicroscopyViewer .ol-overviewmap.ol-uncollapsible {
  bottom: 0;
  left: 0;
  border-radius: 0 4px 0 0;
}

.DicomMicroscopyViewer .ol-overviewmap .ol-overviewmap-map,
.DicomMicroscopyViewer .ol-overviewmap button {
  display: block;
}

.DicomMicroscopyViewer .ol-overviewmap .ol-overviewmap-map {
  border: 1px solid var(--ol-subtle-foreground-color);
  height: 150px;
  width: 150px;
}

.DicomMicroscopyViewer .ol-overviewmap:not(.ol-collapsed) button {
  bottom: 0;
  left: 0;
  position: absolute;
}

.DicomMicroscopyViewer .ol-overviewmap.ol-collapsed .ol-overviewmap-map,
.DicomMicroscopyViewer .ol-overviewmap.ol-uncollapsible button {
  display: none;
}

.DicomMicroscopyViewer .ol-overviewmap:not(.ol-collapsed) {
  background: var(--ol-subtle-background-color);
}

.DicomMicroscopyViewer .ol-overviewmap-box {
  border: 0.5px dotted var(--ol-subtle-foreground-color);
}

.DicomMicroscopyViewer .ol-overviewmap .ol-overviewmap-box:hover {
  cursor: move;
}

@layout-header-background: #007ea3;
@primary-color: #007ea3;
@processing-color: #8cb8c6;
@success-color: #3f9c35;
@warning-color: #eeaf30;
@error-color: #96172e;
@font-size-base: 14px;

.DicomMicroscopyViewer .ol-tooltip {
  font-size: 16px !important;
}
`,x7=Symbol.for("map"),$Y="postrender",Zl=class Zl extends Iu{constructor(e){super({...e,canvas:e.canvas||Yo(e.element)}),this.internalCamera={rotation:0,centerIndex:[0,0],extent:[0,-2,1,-1],xSpacing:1,ySpacing:1,resolution:1,zoom:1},this.voiRange={lower:0,upper:255},this.getProperties=()=>({}),this.resetCamera=()=>!0,this.getNumberOfSlices=()=>1,this.getFrameOfReferenceUID=()=>this.frameOfReferenceUID,this.resize=()=>{const r=this.canvas,{clientWidth:i,clientHeight:a}=r;(r.width!==i||r.height!==a)&&(r.width=i,r.height=a),this.refreshRenderValues()},this.canvasToWorld=r=>{if(!this.metadata)return;const[i,a]=this.canvasToIndex(r),{origin:o,spacing:s,direction:c}=this.getImageData(),l=Cn(0,0,0),f=c.slice(0,3),u=c.slice(3,6);return vr(l,o,f,i*s[0]),vr(l,l,u,a*s[1]),[l[0],l[1],l[2]]},this.worldToCanvas=r=>{if(!this.metadata)return;const{spacing:i,direction:a,origin:o}=this.metadata,s=a.slice(0,3),c=a.slice(3,6),l=tn([0,0,0],r,o),f=[Qe(l,s)/i[0],Qe(l,c)/i[1]];return this.indexToCanvas(f)},this.postrender=()=>{this.refreshRenderValues(),De(this.element,Oe.IMAGE_RENDERED,{element:this.element,viewportId:this.id,viewport:this,renderingEngineId:this.renderingEngineId})},this.getRotation=()=>0,this.canvasToIndex=r=>{const i=this.getTransform();return i.invert(),i.transformPoint(r)},this.indexToCanvas=r=>this.getTransform().transformPoint(r),this.customRenderViewportToCanvas=()=>{},this.getImageIds=()=>[this.imageIds[0]],this.renderingEngineId=e.renderingEngineId,this.element.setAttribute("data-viewport-uid",this.id),this.element.setAttribute("data-rendering-engine-uid",this.renderingEngineId),this.element.style.position="relative",this.microscopyElement=document.createElement("div"),this.microscopyElement.setAttribute("class","DicomMicroscopyViewer"),this.microscopyElement.id=In(),this.microscopyElement.innerText="Initial",this.microscopyElement.style.background="grey",this.microscopyElement.style.width="100%",this.microscopyElement.style.height="100%",this.microscopyElement.style.position="absolute",this.microscopyElement.style.left="0",this.microscopyElement.style.top="0";const n=this.element.firstElementChild;n.insertBefore(this.microscopyElement,n.childNodes[1]),this.addEventListeners(),this.addWidget("DicomMicroscopyViewer",{getEnabled:()=>!!this.viewer,setEnabled:()=>{this.elementDisabledHandler()}}),this.resize()}static get useCustomRenderingPipeline(){return!0}addEventListeners(){this.canvas.addEventListener(Oe.ELEMENT_DISABLED,this.elementDisabledHandler)}removeEventListeners(){this.canvas.removeEventListener(Oe.ELEMENT_DISABLED,this.elementDisabledHandler)}elementDisabledHandler(){var n;this.removeEventListeners(),(n=this.viewer)==null||n.cleanup(),this.viewer=null,this.element.firstElementChild.removeChild(this.microscopyElement),this.microscopyElement=null}getImageDataMetadata(e=0){var A;const n=this.metadataDicomweb.reduce((_,k)=>(_==null?void 0:_.NumberOfFrames)<k.NumberOfFrames?k:_),{TotalPixelMatrixColumns:r,TotalPixelMatrixRows:i,ImageOrientationSlide:a,ImagedVolumeWidth:o,ImagedVolumeHeight:s,ImagedVolumeDepth:c}=n,l=Ve(li.IMAGE_PLANE,this.imageIds[e]);let f=a.slice(0,3),u=a.slice(3,6);(f==null||u==null)&&(f=[1,0,0],u=[0,1,0]);const g=Cn(f[0],f[1],f[2]),d=Cn(u[0],u[1],u[2]),h=Le();an(h,g,d);const{XOffsetInSlideCoordinateSystem:p=0,YOffsetInSlideCoordinateSystem:m=0,ZOffsetInSlideCoordinateSystem:v=0}=((A=n.TotalPixelMatrixOriginSequence)==null?void 0:A[0])||{},y=[p,m,v],T=o/r,C=s/i,w=r,x=i,O=c,M=1;return this.hasPixelSpacing=!!(o&&s),{bitsAllocated:8,numberOfComponents:3,origin:y,direction:[...g,...d,...h],dimensions:[w,x,M],spacing:[T,C,O],hasPixelSpacing:this.hasPixelSpacing,numVoxels:w*x*M,imagePlaneModule:l}}async setFrameNumber(e){}setProperties(e){}resetProperties(){this.setProperties({})}getScalarData(){return null}getImageData(){const{metadata:e}=this;if(!e)return null;const{spacing:n}=e,r={getDirection:()=>e.direction,getDimensions:()=>e.dimensions,getRange:()=>[0,255],getScalarData:()=>this.getScalarData(),getSpacing:()=>e.spacing,worldToIndex:a=>{const o=this.worldToCanvas(a),s=this.canvasToIndex(o);return[s[0],s[1],0]},indexToWorld:a=>{const o=this.indexToCanvas([a[0],a[1]]);return this.canvasToWorld(o)}};return{dimensions:e.dimensions,spacing:n,numberOfComponents:3,origin:e.origin,direction:e.direction,metadata:{Modality:this.modality,FrameOfReferenceUID:this.frameOfReferenceUID},hasPixelSpacing:this.hasPixelSpacing,calibration:this.calibration,preScale:{scaled:!1},scalarData:this.getScalarData(),imageData:r,voxelManager:{forEach:(a,o)=>Sy(o.imageData,{pointInShapeFn:o.isInObject??(()=>!0),callback:a,boundsIJK:o.boundsIJK,returnPoints:o.returnPoints??!1})}}}hasImageURI(e){return!0}setCamera(e){const n=this.getCamera(),{parallelScale:r,focalPoint:i}=e,a=this.getView(),{xSpacing:o}=this.internalCamera;if(r){const c=this.element.clientHeight/r,l=1/o/c;a.setResolution(l)}if(i){const c=this.worldToCanvas(i),l=this.canvasToIndex(c);a.setCenter(l)}const s=this.getCamera();this.triggerCameraModifiedEventIfNecessary(n,s)}getCurrentImageId(){return this.imageIds[0]}getFrameNumber(){return 1}getCamera(){this.refreshRenderValues();const{resolution:e,xSpacing:n}=this.internalCamera,r=e*n,i=[this.element.clientWidth/2,this.element.clientHeight/2],a=this.canvasToWorld(i);return{parallelProjection:!0,focalPoint:a,position:a,viewUp:[0,-1,0],parallelScale:this.element.clientHeight*r,viewPlaneNormal:[0,0,1]}}setDataIds(e,n){(n==null?void 0:n.miniNavigationOverlay)!==!1&&Zl.addMiniNavigationOverlayCss();const r=(n==null?void 0:n.webClient)||Ve(li.WADO_WEB_CLIENT,e[0]);if(!r)throw new Error(`To use setDataIds on WSI data, you must provide metaData.webClient for ${e[0]}`);return this.setWSI(e,r)}async setWSI(e,n){this.microscopyElement.style.background="black",this.microscopyElement.innerText="Loading",this.imageIds=e;const r=await Zl.getDicomMicroscopyViewer();this.frameOfReferenceUID=null;const i=this.imageIds.map(s=>{var u,g,d;const c=n.getDICOMwebMetadata(s);Object.defineProperty(c,"isMultiframe",{value:c.isMultiframe,enumerable:!1}),Object.defineProperty(c,"frameNumber",{value:void 0,enumerable:!1});const l=(u=c["00080008"])==null?void 0:u.Value;(l==null?void 0:l.length)===1&&(c["00080008"].Value=l[0].split("\\"));const f=(d=(g=c["00200052"])==null?void 0:g.Value)==null?void 0:d[0];return this.frameOfReferenceUID?f!==this.frameOfReferenceUID&&(c["00200052"].Value=[this.frameOfReferenceUID]):this.frameOfReferenceUID=f,c}),a=[];i.forEach(s=>{const c=new r.metadata.VLWholeSlideMicroscopyImage({metadata:s}),l=c.ImageType[2];l==="VOLUME"||l==="THUMBNAIL"?a.push(c):console.log("Unknown image type",c.ImageType)}),this.metadataDicomweb=a;const o=new r.viewer.VolumeImageViewer({client:n,metadata:a,controls:["overview","position"],retrieveRendered:!1,bindings:{}});o.render({container:this.microscopyElement}),this.metadata=this.getImageDataMetadata(),o.deactivateDragPanInteraction(),this.viewer=o,this.map=o[x7],this.map.on($Y,this.postrender),this.resize(),this.microscopyElement.innerText="",Object.assign(this.microscopyElement.style,{"--ol-partial-background-color":"rgba(127, 127, 127, 0.7)","--ol-foreground-color":"#000000","--ol-subtle-foreground-color":"#000","--ol-subtle-background-color":"rgba(78, 78, 78, 0.5)",background:"none"})}scroll(e){const n=this.getCamera();this.setCamera({parallelScale:n.parallelScale*(1+.1*e)})}getSliceIndex(){return 0}getView(){if(!this.viewer)return;const e=this.viewer[x7],n=window;return n.map=e,n.viewer=this.viewer,n.view=e==null?void 0:e.getView(),n.wsi=this,e==null?void 0:e.getView()}refreshRenderValues(){const e=this.getView();if(!e)return;const n=e.getResolution();if(!n||n<mo)return;const r=e.getCenter(),i=e.getProjection().getExtent(),a=e.getRotation(),o=e.getZoom(),{metadata:{spacing:[s,c]}}=this,l=1/n/s;Object.assign(this.internalCamera,{extent:i,centerIndex:r,worldToCanvasRatio:l,xSpacing:s,ySpacing:c,resolution:n,rotation:a,zoom:o})}getZoom(){var e;return(e=this.getView())==null?void 0:e.getZoom()}setZoom(e){var n;(n=this.getView())==null||n.setZoom(e)}getTransform(){this.refreshRenderValues();const{centerIndex:e,resolution:n,rotation:r}=this.internalCamera,i=[this.canvas.width/2,this.canvas.height/2],a=new tf;return a.translate(i[0],i[1]),a.rotate(r),a.scale(1/n,-1/n),a.translate(-e[0],-e[1]),a}getViewReferenceId(){return`imageId:${this.getCurrentImageId()}`}getCurrentImageIdIndex(){return 0}static addMiniNavigationOverlayCss(){if(document.getElementById(this.overlayCssId))return;const e=document.createElement("style");e.innerText=GY,e.setAttribute("id",this.overlayCssId),document.getElementsByTagName("head")[0].append(e)}};Zl.getDicomMicroscopyViewer=async()=>dW("dicom-microscopy-viewer"),Zl.overlayCssId="overlayCss";let J3=Zl;const eM={[un.ORTHOGRAPHIC]:Hi,[un.PERSPECTIVE]:Hi,[un.STACK]:ha,[un.VOLUME_3D]:ZR,[un.VIDEO]:Q3,[un.WHOLE_SLIDE]:J3};function Ol(t){return eM[t].useCustomRenderingPipeline}const S7=2;class tM{constructor(e){if(this._needsRender=new Set,this._animationFrameSet=!1,this._animationFrameHandle=null,this.renderFrameOfReference=n=>{const i=this._getViewportsAsArray().map(a=>{if(a.getFrameOfReferenceUID()===n)return a.id});this.renderViewports(i)},this._renderFlaggedViewports=()=>{this._throwIfDestroyed(),this.useCPURendering||this.performVtkDrawCall();const n=this._getViewportsAsArray(),r=[];for(let i=0;i<n.length;i++){const a=n[i];if(this._needsRender.has(a.id)){const o=this.renderViewportUsingCustomOrVtkPipeline(a);if(r.push(o),a.setRendered(),this._needsRender.delete(a.id),this._needsRender.size===0)break}}this._animationFrameSet=!1,this._animationFrameHandle=null,r.forEach(i=>{i!=null&&i.element&&De(i.element,Oe.IMAGE_RENDERED,i)})},this.id=e||In(),this.useCPURendering=og(),Ag.set(this),!gW())throw new Error("@cornerstonejs/core is not initialized, run init() first");this.useCPURendering||(this.offscreenMultiRenderWindow=ej.newInstance(),this.offScreenCanvasContainer=document.createElement("div"),this.offscreenMultiRenderWindow.setContainer(this.offScreenCanvasContainer)),this._viewports=new Map,this.hasBeenDestroyed=!1}enableElement(e){const n=this._normalizeViewportInputEntry(e);this._throwIfDestroyed();const{element:r,viewportId:i}=n;if(!r)throw new Error("No element provided");this.getViewport(i)&&this.disableElement(i);const{type:o}=n,s=Ol(o);!this.useCPURendering&&!s?this.enableVTKjsDrivenViewport(n):this.addCustomViewport(n);const c=Yo(r),{background:l}=n.defaultOptions;this.fillCanvasWithBackgroundColor(c,l)}disableElement(e){this._throwIfDestroyed();const n=this.getViewport(e);if(!n){console.warn(`viewport ${e} does not exist`);return}this._resetViewport(n),!Ol(n.type)&&!this.useCPURendering&&this.offscreenMultiRenderWindow.removeRenderer(e),this._removeViewport(e),n.isDisabled=!0,this._needsRender.delete(e),this.getViewports().length||this._clearAnimationFrame()}setViewports(e){const n=this._normalizeViewportInputEntries(e);this._throwIfDestroyed(),this._reset();const r=[],i=[];n.forEach(a=>{!this.useCPURendering&&!Ol(a.type)?r.push(a):i.push(a)}),this.setVtkjsDrivenViewports(r),this.setCustomViewports(i),n.forEach(a=>{const o=Yo(a.element),{background:s}=a.defaultOptions;this.fillCanvasWithBackgroundColor(o,s)})}resize(e=!0,n=!0){this._throwIfDestroyed();const r=this._getViewportsAsArray(),i=[],a=[];r.forEach(o=>{Ol(o.type)?a.push(o):i.push(o)}),i.length&&this._resizeVTKViewports(i,n,e),a.length&&this._resizeUsingCustomResizeHandler(a,n,e)}getViewport(e){return this._viewports.get(e)}getViewports(){return this._throwIfDestroyed(),this._getViewportsAsArray()}getStackViewport(e){this._throwIfDestroyed();const n=this.getViewport(e);if(!n)throw new Error(`Viewport with Id ${e} does not exist`);if(!(n instanceof ha))throw new Error(`Viewport with Id ${e} is not a StackViewport.`);return n}getStackViewports(){return this._throwIfDestroyed(),this.getViewports().filter(n=>n instanceof ha)}getVolumeViewports(){this._throwIfDestroyed();const e=this.getViewports(),n=r=>r instanceof za;return e.filter(n)}render(){const n=this.getViewports().map(r=>r.id);this._setViewportsToBeRenderedNextFrame(n)}renderViewports(e){this._setViewportsToBeRenderedNextFrame(e)}renderViewport(e){this._setViewportsToBeRenderedNextFrame([e])}destroy(){this.hasBeenDestroyed||(this.useCPURendering||(this._getViewportsAsArray().forEach(n=>{this.offscreenMultiRenderWindow.removeRenderer(n.id)}),this.offscreenMultiRenderWindow.delete(),delete this.offscreenMultiRenderWindow),this._reset(),Ag.delete(this.id),this.hasBeenDestroyed=!0)}fillCanvasWithBackgroundColor(e,n){const r=e.getContext("2d");let i;if(n){const a=n.map(o=>Math.floor(255*o));i=`rgb(${a[0]}, ${a[1]}, ${a[2]})`}else i="black";r.fillStyle=i,r.fillRect(0,0,e.width,e.height)}_normalizeViewportInputEntry(e){const{type:n,defaultOptions:r}=e;let i=r;return(!i||Object.keys(i).length===0)&&(i={background:[0,0,0],orientation:null,displayArea:null},n===un.ORTHOGRAPHIC&&(i={...i,orientation:Ou.AXIAL})),{...e,defaultOptions:i}}_normalizeViewportInputEntries(e){const n=[];return e.forEach(r=>{n.push(this._normalizeViewportInputEntry(r))}),n}_resizeUsingCustomResizeHandler(e,n=!0,r=!0){e.forEach(i=>{typeof i.resize=="function"&&i.resize()}),e.forEach(i=>{const a=i.getCamera();i.resetCamera(),n&&i.setCamera(a)}),r&&this.render()}_resizeVTKViewports(e,n=!0,r=!0){const i=e.map(a=>Yo(a.element));if(i.forEach(a=>{const o=window.devicePixelRatio||1;a.width=a.clientWidth*o,a.height=a.clientHeight*o}),i.length){const{offScreenCanvasWidth:a,offScreenCanvasHeight:o}=this._resizeOffScreenCanvas(i);this._resize(e,a,o)}e.forEach(a=>{const o=a.getCamera(),s=a.getRotation(),{flipHorizontal:c}=o;a.resetCameraForResize();const l=a.getDisplayArea();n&&(l?(c&&a.setCamera({flipHorizontal:c}),s&&a.setViewPresentation({rotation:s})):a.setCamera(o))}),r&&this.render()}enableVTKjsDrivenViewport(e){const r=this._getViewportsAsArray().filter(f=>Ol(f.type)===!1),i=r.map(f=>f.canvas),a=Yo(e.element);i.push(a);const{offScreenCanvasWidth:o,offScreenCanvasHeight:s}=this._resizeOffScreenCanvas(i),c=this._resize(r,o,s),l={...e,canvas:a};this.addVtkjsDrivenViewport(l,{offScreenCanvasWidth:o,offScreenCanvasHeight:s,xOffset:c})}_removeViewport(e){if(!this.getViewport(e)){console.warn(`viewport ${e} does not exist`);return}this._viewports.delete(e)}addVtkjsDrivenViewport(e,n){const{element:r,canvas:i,viewportId:a,type:o,defaultOptions:s}=e;r.tabIndex=-1;const{offScreenCanvasWidth:c,offScreenCanvasHeight:l,xOffset:f}=n,{sxStartDisplayCoords:u,syStartDisplayCoords:g,sxEndDisplayCoords:d,syEndDisplayCoords:h,sx:p,sy:m,sWidth:v,sHeight:y}=this._getViewportCoordsOnOffScreenCanvas(e,c,l,f);this.offscreenMultiRenderWindow.addRenderer({viewport:[u,g,d,h],id:a,background:s.background?s.background:[0,0,0]});const T={id:a,element:r,renderingEngineId:this.id,type:o,canvas:i,sx:p,sy:m,sWidth:v,sHeight:y,defaultOptions:s||{}};let C;if(o===un.STACK)C=new ha(T);else if(o===un.ORTHOGRAPHIC||o===un.PERSPECTIVE)C=new Hi(T);else if(o===un.VOLUME_3D)C=new ZR(T);else throw new Error(`Viewport Type ${o} is not supported`);this._viewports.set(a,C);const w={element:r,viewportId:a,renderingEngineId:this.id};C.suppressEvents||De(Ee,Oe.ELEMENT_ENABLED,w)}addCustomViewport(e){const{element:n,viewportId:r,type:i,defaultOptions:a}=e;n.tabIndex=-1;const o=Yo(n),{clientWidth:s,clientHeight:c}=o;(o.width!==s||o.height!==c)&&(o.width=s,o.height=c);const l={id:r,renderingEngineId:this.id,element:n,type:i,canvas:o,sx:0,sy:0,sWidth:s,sHeight:c,defaultOptions:a||{}},f=eM[i],u=new f(l);this._viewports.set(r,u);const g={element:n,viewportId:r,renderingEngineId:this.id};De(Ee,Oe.ELEMENT_ENABLED,g)}setCustomViewports(e){e.forEach(n=>{this.addCustomViewport(n)})}setVtkjsDrivenViewports(e){if(e.length){const n=e.map(o=>Yo(o.element));n.forEach(o=>{const s=window.devicePixelRatio||1,c=o.getBoundingClientRect();o.width=c.width*s,o.height=c.height*s});const{offScreenCanvasWidth:r,offScreenCanvasHeight:i}=this._resizeOffScreenCanvas(n);let a=0;for(let o=0;o<e.length;o++){const s=e[o],c=n[o],l={...s,canvas:c};this.addVtkjsDrivenViewport(l,{offScreenCanvasWidth:r,offScreenCanvasHeight:i,xOffset:a}),a+=c.width}}}_resizeOffScreenCanvas(e){const{offScreenCanvasContainer:n,offscreenMultiRenderWindow:r}=this,i=Math.max(...e.map(o=>o.height));let a=0;return e.forEach(o=>{a+=o.width}),n.width=a,n.height=i,r.resize(),{offScreenCanvasWidth:a,offScreenCanvasHeight:i}}_resize(e,n,r){let i=0;for(let a=0;a<e.length;a++){const o=e[a],{sxStartDisplayCoords:s,syStartDisplayCoords:c,sxEndDisplayCoords:l,syEndDisplayCoords:f,sx:u,sy:g,sWidth:d,sHeight:h}=this._getViewportCoordsOnOffScreenCanvas(o,n,r,i);i+=o.canvas.width,o.sx=u,o.sy=g,o.sWidth=d,o.sHeight=h,this.offscreenMultiRenderWindow.getRenderer(o.id).setViewport([s,c,l,f])}return i}_getViewportCoordsOnOffScreenCanvas(e,n,r,i){const{canvas:a}=e,{width:o,height:s}=a,c=i,l=0,f=c/n,u=l+(r-s)/r,g=o/n,d=s/r;return{sxStartDisplayCoords:f,syStartDisplayCoords:u,sxEndDisplayCoords:f+g,syEndDisplayCoords:u+d,sx:c,sy:l,sWidth:o,sHeight:s}}_getViewportsAsArray(){return Array.from(this._viewports.values())}_setViewportsToBeRenderedNextFrame(e){e.forEach(n=>{this._needsRender.add(n)}),this._render()}_render(){this._needsRender.size>0&&!this._animationFrameSet&&(this._animationFrameHandle=window.requestAnimationFrame(this._renderFlaggedViewports),this._animationFrameSet=!0)}performVtkDrawCall(){const{offscreenMultiRenderWindow:e}=this,n=e.getRenderWindow(),r=e.getRenderers();if(r.length){for(let i=0;i<r.length;i++){const{renderer:a,id:o}=r[i];this._needsRender.has(o)?a.setDraw(!0):a.setDraw(!1)}n.render();for(let i=0;i<r.length;i++)r[i].renderer.setDraw(!1)}}renderViewportUsingCustomOrVtkPipeline(e){let n;if(e.sWidth<S7||e.sHeight<S7){console.warn("Viewport is too small",e.sWidth,e.sHeight);return}if(Ol(e.type)===!0)n=e.customRenderViewportToCanvas();else{if(this.useCPURendering)throw new Error("GPU not available, and using a viewport with no custom render pipeline.");const{offscreenMultiRenderWindow:r}=this,o=r.getOpenGLRenderWindow().get3DContext().canvas;n=this._renderViewportFromVtkCanvasToOnscreenCanvas(e,o)}return n}_renderViewportFromVtkCanvasToOnscreenCanvas(e,n){const{element:r,canvas:i,sx:a,sy:o,sWidth:s,sHeight:c,id:l,renderingEngineId:f,suppressEvents:u}=e,{width:g,height:d}=i;return i.getContext("2d").drawImage(n,a,o,s,c,0,0,g,d),{element:r,suppressEvents:u,viewportId:l,renderingEngineId:f,viewportStatus:e.viewportStatus}}_resetViewport(e){const n=this.id,{element:r,canvas:i,id:a}=e,o={element:r,viewportId:a,renderingEngineId:n};e.removeWidgets(),De(Ee,Oe.ELEMENT_DISABLED,o),r.removeAttribute("data-viewport-uid"),r.removeAttribute("data-rendering-engine-uid"),i.getContext("2d").clearRect(0,0,i.width,i.height)}_clearAnimationFrame(){window.cancelAnimationFrame(this._animationFrameHandle),this._needsRender.clear(),this._animationFrameSet=!1,this._animationFrameHandle=null}_reset(){this._getViewportsAsArray().forEach(n=>{this._resetViewport(n)}),this._clearAnimationFrame(),this._viewports=new Map}_throwIfDestroyed(){if(this.hasBeenDestroyed)throw new Error("this.destroy() has been manually called to free up memory, can not longer use this instance. Instead make a new one.")}_downloadOffScreenCanvas(){const e=this._debugRender();WY(e)}_debugRender(){const{offscreenMultiRenderWindow:e}=this,n=e.getRenderWindow(),r=e.getRenderers();for(let c=0;c<r.length;c++)r[c].renderer.setDraw(!0);n.render();const o=e.getOpenGLRenderWindow().get3DContext().canvas,s=o.toDataURL();return this._getViewportsAsArray().forEach(c=>{const{sx:l,sy:f,sWidth:u,sHeight:g}=c,d=c.canvas,{width:h,height:p}=d;d.getContext("2d").drawImage(o,l,f,u,g,0,0,h,p)}),s}}function WY(t){const e=document.createElement("a");e.download="viewport.png",e.href=t,document.body.appendChild(e),e.click(),document.body.removeChild(e)}class zY{constructor(e){this._color=[200,0,0],this.id=e.id,this._points=e.points,this._polys=e.polys,this._color=e.color??this._color,this.frameOfReferenceUID=e.frameOfReferenceUID,this._segmentIndex=e.segmentIndex,this.sizeInBytes=this._getSizeInBytes(),this._updateCentroid()}_getSizeInBytes(){return this._points.length*4+this._polys.length*4}_updateCentroid(){const e=this._points.length/3;let n=0,r=0,i=0;for(let a=0;a<this._points.length;a+=3)n+=this._points[a],r+=this._points[a+1],i+=this._points[a+2];this._centroid=[n/e,r/e,i/e]}get color(){return this._color}set color(e){this._color=e}get points(){return this._points}set points(e){this._points=e,this._updateCentroid()}get polys(){return this._polys}set polys(e){this._polys=e}get segmentIndex(){return this._segmentIndex}get centroid(){return this._centroid}get flatPointsArray(){return this._points}get totalNumberOfPoints(){return this._points.length/3}}var ba;(function(t){t[t.None=0]="None",t[t.Capture=1]="Capture",t[t.Bubble=2]="Bubble"})(ba||(ba={}));class R2{constructor(e){this._eventListeners=new Map,this._children=new Map,this._target=e}get isEmpty(){return this._eventListeners.size===0&&this._children.size===0}addEventListener(e,n,r){const i=e.indexOf(".");if(i!==-1){const o=e.substring(0,i);let s=this._children.get(o);s||(s=new R2(this._target),this._children.set(o,s)),e=e.substring(i+1),s.addEventListener(e,n,r)}else this._addEventListener(e,n,r)}removeEventListener(e,n,r){const i=e.indexOf(".");if(i!==-1){const o=e.substring(0,i),s=this._children.get(o);if(!s)return;e=e.substring(i+1),s.removeEventListener(e,n,r),s.isEmpty&&this._children.delete(o)}else this._removeEventListener(e,n,r)}reset(){Array.from(this._children.entries()).forEach(([e,n])=>{if(n.reset(),n.isEmpty)this._children.delete(e);else throw new Error("Child is not empty and cannot be removed")}),this._unregisterAllEvents()}_addEventListener(e,n,r){let i=this._eventListeners.get(e);i||(i=new Map,this._eventListeners.set(e,i));const o=(r==null?void 0:r.capture)??!1?ba.Capture:ba.Bubble,s=i.get(n)??ba.None;if(s&o){console.warn("A listener is already registered for this phase");return}i.set(n,s|o),this._target.addEventListener(e,n,r)}_removeEventListener(e,n,r){const a=(r==null?void 0:r.capture)??!1?ba.Capture:ba.Bubble,o=this._eventListeners.get(e);if(!o)return;(n?[n]:Array.from(o.keys())).forEach(c=>{const l=o.get(c)??ba.None;if(!!!(l&a))return;this._target.removeEventListener(e,c,r);const u=l^a;u===ba.None?o.delete(c):o.set(c,u)}),o.size||this._eventListeners.delete(e)}_unregisterAllListeners(e,n){Array.from(n.entries()).forEach(([r,i])=>{const a=ba.Capture;for(let o=a;i;o<<=1){if(!(i&o))continue;const s=o===ba.Capture;this.removeEventListener(e,r,{capture:s}),i^=o}})}_unregisterAllEvents(){Array.from(this._eventListeners.entries()).forEach(([e,n])=>{this._unregisterAllListeners(e,n)})}}class jY{constructor(){this._targetsEventListeners=new Map}addEventListener(e,n,r,i){let a=this._targetsEventListeners.get(e);a||(a=new R2(e),this._targetsEventListeners.set(e,a)),a.addEventListener(n,r,i)}removeEventListener(e,n,r,i){const a=this._targetsEventListeners.get(e);a&&(a.removeEventListener(n,r,i),a.isEmpty&&this._targetsEventListeners.delete(e))}reset(){Array.from(this._targetsEventListeners.entries()).forEach(([e,n])=>{n.reset(),this._targetsEventListeners.delete(e)})}}const HY=Object.freeze(Object.defineProperty({__proto__:null,MultiTargetEventListenerManager:jY,TargetEventListeners:R2},Symbol.toStringTag,{value:"Module"}));function KY(t,e){const n=t.getSize();for(let r=0;r<n;r++){const i=[];t.getNodeValue(r,i),i[1]=i[1]*e,i[2]=i[2]*e,i[3]=i[3]*e,t.setNodeValue(r,i)}}function qY(t){let e=t[0],n=t[0],r;const i=t.length;for(let a=1;a<i;a++)r=t[a],e=Math.min(e,r),n=Math.max(n,r);return{min:e,max:n}}const XY=Symbol("LastRuntimeId"),YY={},ZY=4294967295,QY="-";function nM(t,e,n){return JY(t!==null&&typeof t=="object"?t:YY,XY,(typeof n=="number"&&n>0?n:ZY)>>>0).join(typeof e=="string"?e:QY)}function JY(t,e,n){let r=t[e];r instanceof Array||(r=[0],Object.defineProperty(t,e,{value:r}));for(let i=!0,a=0;i&&a<r.length;++a){let o=r[a]|0;o<n?(i=!1,o=o+1):(o=0,a+1===r.length&&r.push(0)),r[a]=o}return r}const E7={},eZ={add:(t,e)=>{const n=gi(t);E7[n]=e},get:(t,e)=>{if(t==="calibratedPixelSpacing"){const n=gi(e);return E7[n]}}};function tZ(t,e,n=1e-5){return Math.abs(t[0]+e[0])<n&&Math.abs(t[1]+e[1])<n&&Math.abs(t[2]+e[2])<n}function nZ(t,e){return!(t[0]<0||t[0]>=e[0]||t[1]<0||t[1]>=e[1]||t[2]<0||t[2]>=e[2])}function rZ(t,e){let n;e?n=[dl(e)]:n=Do();const r=[];return n.forEach(i=>{const a=t.getActors(),o=i.getVolumeViewports();for(const s of o){const c=s.getActors();if(c.length!==a.length)continue;a.every(({uid:f})=>c.find(u=>f===u.uid))&&r.push(s)}}),r}const rM=t=>t.preScale.scaled&&t.preScale.scalingParameters.suvbw;function iM(t,e,n=void 0,r="_thumbnails",i={displayArea:{imageArea:[1,1]}}){if(!t||!(t instanceof HTMLCanvasElement))throw new Error("canvas element is required");const a=!e.imageId,o=!a&&e,s=a&&e,l=`renderGPUViewport-${o.imageId||s.volumeId}`,f=document.createElement("div"),u=window.devicePixelRatio||1;i.displayArea||(i.displayArea={imageArea:[1,1]});const g=t.width,d=t.height;f.style.width=`${g/u+w7}px`,f.style.height=`${d/u+w7}px`,f.style.visibility="hidden",f.style.position="absolute",document.body.appendChild(f);const h=l.split(":").join("-");f.setAttribute("viewport-id-for-remove",h);const p=Yo(f),m=dl(r)||new tM(r);let v=m.getViewport(l);if(!v){const y={viewportId:l,type:a?un.ORTHOGRAPHIC:un.STACK,element:f,defaultOptions:{...i,suppressEvents:!0}};m.enableElement(y),v=m.getViewport(l)}return new Promise(y=>{let T=!1,{viewReference:C}=i;const w=x=>{if(T)return;if(C){const z=C;C=null,v.setViewReference(z),v.render();return}t.getContext("2d").drawImage(p,0,0,p.width,p.height,0,0,t.width,t.height);const M=v.canvasToWorld([0,0]),A=v.canvasToWorld([p.width/u,0]),_=v.canvasToWorld([0,p.height/u]),k=1;T=!0,f.removeEventListener(Oe.IMAGE_RENDERED,w),setTimeout(()=>{m.disableElement(l),document.querySelectorAll(`[viewport-id-for-remove="${h}"]`).forEach(X=>{X.remove()})},0),y({origin:M,bottomLeft:_,topRight:A,thicknessMm:k})};f.addEventListener(Oe.IMAGE_RENDERED,w),a?v.setVolumes([s],!1,!0):v.renderImageObject(e),v.resetCamera(),n==="PT"&&!rM(o)&&v.setProperties({voiRange:{lower:o.minPixelValue,upper:o.maxPixelValue}}),v.render()})}function aM(t,e,n,r,i){if(e.volumeId)throw new Error("Unsupported volume rendering for CPU");const o=e,s=YR(t,o,n),c={canvas:t,viewport:s,image:o,renderingTools:{}};c.transform=Hg(c);const l=!0;return new Promise((f,u)=>{KR(c,l),f(null)})}function iZ(t){const{canvas:e,imageId:n,viewReference:r,requestType:i=ot.Thumbnail,priority:a=-5,renderingEngineId:o="_thumbnails",useCPURendering:s=!1,thumbnail:c=!1,imageAspect:l=!1,viewportOptions:f}=t,u=r==null?void 0:r.volumeId,g=u&&!n,d=r&&f?{...f,viewReference:r}:f,h=s?aM:iM;return new Promise((p,m)=>{function v(w,x){var _;const{modality:O}=Ve("generalSeriesModule",x)||{},M=!g&&w,A=g&&w;M&&(M.isPreScaled=M.isPreScaled||((_=M.preScale)==null?void 0:_.scaled)),c&&(e.height=256,e.width=256),l&&M&&(e.width=M&&e.height*M.width/M.height),e.style.width=`${e.width/devicePixelRatio}px`,e.style.height=`${e.height/devicePixelRatio}px`,A&&s&&m(new Error("CPU rendering of volume not supported")),h(e,w,O,o,d).then(p)}function y(w,x){console.error(w,x),m(w)}function T(w,x,O){return Lu(w,O).then(M=>{v.call(this,M,w)},M=>{y.call(this,M,w)})}const C={useRGBA:!!s,requestType:i};if(u){const w=Me.getVolume(u);w||m(new Error(`Volume id ${u} not found in cache`));const x=w.imageIds[0];v(w,x)}else wo.addRequest(T.bind(null,n,null,C),i,{imageId:n},a)})}class oM{constructor(e="Tools",n=50){this.position=-1,this.redoAvailable=0,this.undoAvailable=0,this.ring=new Array,this.label=e,this._size=n}get size(){return this._size}set size(e){this.ring=new Array(e),this._size=e,this.position=-1,this.redoAvailable=0,this.undoAvailable=0}undo(e=1){for(;e>0&&this.undoAvailable>0;)this.ring[this.position].restoreMemo(!0),e--,this.redoAvailable++,this.undoAvailable--,this.position=(this.position-1+this.size)%this.size}redo(e=1){for(;e>0&&this.redoAvailable>0;){const n=(this.position+1)%this.size;this.ring[n].restoreMemo(!1),e--,this.position=n,this.undoAvailable++,this.redoAvailable--}}push(e){var r;if(!e)return;const n=e.restoreMemo?e:(r=e.createMemo)==null?void 0:r.call(e);if(n)return this.redoAvailable=0,this.undoAvailable<this._size&&this.undoAvailable++,this.position=(this.position+1)%this._size,this.ring[this.position]=n,n}}const aZ=new oM,Py=Object.freeze(Object.defineProperty({__proto__:null,DefaultHistoryMemo:aZ,HistoryMemo:oM},Symbol.toStringTag,{value:"Module"}));function oZ(t,e){const n=Ve("imagePlaneModule",t);if(!n)throw new Error(`No imagePlaneModule found for imageId: ${t}`);const{columnCosines:r,rowCosines:i,imagePositionPatient:a}=n;let{columnPixelSpacing:o,rowPixelSpacing:s}=n;o||(o=1),s||(s=1);const c=Le();vr(c,a,r,-o/2),vr(c,c,i,-s/2);const l=Le();_n(l,e,c);const f=Qe(l,i),u=Qe(l,r);return[f/s,u/o]}function sZ(t,e){const n=Ve("imagePlaneModule",t);if(!n)throw new Error(`No imagePlaneModule found for imageId: ${t}`);const{columnCosines:r,rowCosines:i,imagePositionPatient:a}=n;let{columnPixelSpacing:o,rowPixelSpacing:s}=n;o||(o=1),s||(s=1);const c=Le();return vr(c,a,i,s*(e[0]-.5)),vr(c,c,r,o*(e[1]-.5)),Array.from(c)}function ev(t){const e=Do(),n=[];return e.forEach(r=>{r.getViewports().forEach(a=>{a.hasImageURI(t)&&n.push(a)})}),n}function cZ(t,e){const n=lZ(t,e);return n?n.index:null}function lZ(t,e){const n=e.getImageIds(),r=e.getCurrentImageIdIndex();if(n.length===0)return null;const i=c=>{const l=uZ(c);if(!l)return null;const f=kR(l.planeNormal,l.imagePositionPatient);return AR(f,t)},a={distance:i(n[r])??1/0,index:r},o=n.slice(r+1);for(let c=0;c<o.length;c++){const l=o[c],f=i(l);if(f!==null)if(f<=a.distance)a.distance=f,a.index=c+r+1;else break}const s=n.slice(0,r);for(let c=s.length-1;c>=0;c--){const l=s[c],f=i(l);if(!(f===null||f===a.distance))if(f<a.distance)a.distance=f,a.index=c;else break}return a.distance===1/0?null:a}function uZ(t){const e=Ve("imagePlaneModule",t);if(!e||!(e.rowCosines instanceof Array&&e.rowCosines.length===3)||!(e.columnCosines instanceof Array&&e.columnCosines.length===3)||!(e.imagePositionPatient instanceof Array&&e.imagePositionPatient.length===3))return null;const{rowCosines:n,columnCosines:r,imagePositionPatient:i}=e,a=bt(Le(),...n),o=bt(Le(),...r),s=an(Le(),a,o);return{rowCosines:n,columnCosines:r,imagePositionPatient:i,planeNormal:s}}function fZ(t){const{width:e,height:n}=t.getCanvas(),{sliceToIndexMatrix:r,indexToSliceMatrix:i}=t.getSliceViewInfo(),a=rc(t,[0,0]),o=rc(t,[e-1,0]),s=rc(t,[0,n-1]),c=_n(Le(),o,a),l=_n(Le(),s,a),f=an(Le(),c,l);wn(c,c),wn(l,l),wn(f,f);const u=Math.max(Math.abs(c[0]),Math.abs(c[1]),Math.abs(c[2])),g=Math.max(Math.abs(l[0]),Math.abs(l[1]),Math.abs(l[2]));if(!Ug(1,u)||!Ug(1,g))throw new Error("Livewire is not available for rotate/oblique viewports");const{voxelManager:d}=t.getImageData(),h=t.getSliceViewInfo(),p=d.getSliceData(h);return{width:h.width,height:h.height,scalarData:p,sliceToIndexMatrix:r,indexToSliceMatrix:i}}const p0={},Mh={add:(t,e)=>{const[n,r]=t,i=`${n}_${r}`;p0[i]||(p0[i]={}),p0[i]=e},get:(t,e,n)=>{if(t!=="spatialRegistrationModule")return;const r=`${e}_${n}`;if(p0[r])return p0[r];const i=`${n}_${e}`;if(p0[i])return Ln(Lc(),p0[i])}};Qu(Mh.get.bind(Mh));const gZ=.05;function dZ(t,e){const n=t.getSliceIndex(),r=e.getSliceIndex(),i=Ve("imagePlaneModule",n.toString()),a=Ve("imagePlaneModule",r.toString());if(!i||!a){console.log("Viewport spatial registration requires image plane module");return}const{imageOrientationPatient:o}=a;if(!i.imageOrientationPatient.every((g,d)=>Math.abs(g-o[d])<gZ)){console.log("Viewport spatial registration only supported for same orientation (hence translation only) for now",i==null?void 0:i.imageOrientationPatient,a==null?void 0:a.imageOrientationPatient);return}const c=i.imagePositionPatient,l=a.imagePositionPatient,f=tn(Le(),c,l),u=d2(Lc(),f);Mh.add([t.id,e.id],u)}function pZ(t){const{imageData:e,dimensions:n}=t.getImageData()||{};if(!e||!n)return[];const{canvas:r}=t,i=window.devicePixelRatio,a=[0,0],o=[r.width/i,0],s=[r.width/i,r.height/i],c=[0,r.height/i],l=t.canvasToWorld(a),f=t.canvasToWorld(o),u=t.canvasToWorld(s),g=t.canvasToWorld(c),d=e.worldToIndex(l),h=e.worldToIndex(f),p=e.worldToIndex(u),m=e.worldToIndex(g);return hZ({dimensions:n,imageData:e,topLeftImage:d,topRightImage:h,bottomRightImage:p,bottomLeftImage:m,topLeftWorld:l,topRightWorld:f,bottomRightWorld:u,bottomLeftWorld:g})}function hZ({dimensions:t,imageData:e,topLeftImage:n,topRightImage:r,bottomRightImage:i,bottomLeftImage:a,topLeftWorld:o,topRightWorld:s,bottomRightWorld:c,bottomLeftWorld:l}){const f=m1(n,t)?o:e.indexToWorld([0,0,0]),u=m1(r,t)?s:e.indexToWorld([t[0]-1,0,0]),g=m1(i,t)?c:e.indexToWorld([t[0]-1,t[1]-1,0]),d=m1(a,t)?l:e.indexToWorld([0,t[1]-1,0]);return[f,u,d,g]}function m1(t,e){return t[0]>0||t[0]<e[0]-1||t[1]>0||t[1]<e[1]-1||t[2]>0||t[2]<e[2]-1}function We(t){if(!t)return;const{viewportUid:e,renderingEngineUid:n}=t.dataset;return Sd(e,n)}function Sd(t,e){if(!e||!t)return;const n=dl(e);if(!n||n.hasBeenDestroyed)return;const r=n.getViewport(t);if(!r)return;const i=r.getFrameOfReferenceUID();return{viewport:r,renderingEngine:n,viewportId:t,renderingEngineId:e,FrameOfReferenceUID:i}}function Dr(t){const e=Do();for(let n=0;n<e.length;n++){const r=e[n];if(r.getViewport(t))return Sd(t,r.id)}}function mZ(){const t=[];return Do().forEach(n=>{n.getViewports().forEach(({element:i})=>{t.push(We(i))})}),t}function vZ(t){const e=We(t);if(!e)return;const{viewport:n}=e;if(!(n instanceof ha))throw new Error(`An image can only be fetched for a stack viewport and not for a viewport of type: ${n.type}`);return n.getCornerstoneImage()}function yZ(t){const e=t[0],{modality:n,seriesInstanceUID:r}=Ve("generalSeriesModule",e),{imageOrientationPatient:i,pixelSpacing:a,frameOfReferenceUID:o,columns:s,rows:c}=Ve("imagePlaneModule",e),l={modality:n,imageOrientationPatient:i,pixelSpacing:a,columns:s,rows:c,seriesInstanceUID:r};return t.every(u=>{const{modality:g,seriesInstanceUID:d}=Ve("generalSeriesModule",u),{imageOrientationPatient:h,pixelSpacing:p,columns:m,rows:v}=Ve("imagePlaneModule",u);return d===l.seriesInstanceUID&&g===l.modality&&m===l.columns&&v===l.rows&&Mn(h,l.imageOrientationPatient)&&Mn(p,l.pixelSpacing)})}const TZ=new Set(["1.2.840.10008.1.2.4.100","1.2.840.10008.1.2.4.100.1","1.2.840.10008.1.2.4.101","1.2.840.10008.1.2.4.101.1","1.2.840.10008.1.2.4.102","1.2.840.10008.1.2.4.102.1","1.2.840.10008.1.2.4.103","1.2.840.10008.1.2.4.103.1","1.2.840.10008.1.2.4.104","1.2.840.10008.1.2.4.104.1","1.2.840.10008.1.2.4.105","1.2.840.10008.1.2.4.105.1","1.2.840.10008.1.2.4.106","1.2.840.10008.1.2.4.106.1","1.2.840.10008.1.2.4.107","1.2.840.10008.1.2.4.108"]);function sM(t){return t?(Array.isArray(t)?t:[t]).find(n=>TZ.has(n)):!1}async function CZ({viewport:t,options:e={}}){const n=t.getRenderingEngine();let r=e.volumeId||`${In()}`;r.split(":").length===0&&(r=`${nX()}:${r}`);const{id:i,element:a}=t,o=e.viewportId||i,s=t.getImageIds(),c=t.getViewPresentation(),l=t.getViewReference();n.enableElement({viewportId:o,type:un.ORTHOGRAPHIC,element:a,defaultOptions:{background:e.background,orientation:e.orientation}}),(await VR(r,{imageIds:s})).load();const u=n.getViewport(o);await NY(n,[{volumeId:r}],[o]);const g=()=>{u.render(),a.removeEventListener(Oe.VOLUME_VIEWPORT_NEW_VOLUME,g)};return(()=>{a.addEventListener(Oe.VOLUME_VIEWPORT_NEW_VOLUME,g)})(),u.setViewPresentation(c),u.setViewReference(l),u.render(),u}async function wZ({viewport:t,options:e}){const n=t,{id:r,element:i}=n,a=t.getRenderingEngine(),{background:o}=e,s=e.viewportId||r,c=Me.getVolume(n.getVolumeId());if(!(c instanceof wd))throw new Error("Currently, you cannot decache a volume that is not an ImageVolume. So, unfortunately, volumes such as nifti  (which are basic Volume, without imageIds) cannot be decached.");const l={viewportId:s,type:un.STACK,element:i,defaultOptions:{background:o}},f=n.getViewReference();a.enableElement(l);const u=a.getViewport(s);return await u.setStack(c.imageIds),u.setViewReference(f),u.render(),u}function Qs(t,e=2){if(Array.isArray(t))return t.map(i=>Qs(i,e)).join(", ");if(t==null||t==="")return"NaN";t=Number(t);const n=Math.abs(t);if(n<1e-4)return`${t}`;const r=n>=100?e-2:n>=10?e-1:n>=1?e:n>=.1?e+1:n>=.01?e+2:n>=.001?e+3:e+4;return t.toFixed(r)}function xZ(t){return Math.round(t/mo)*mo}function SZ(t,e,n){const r=t.length===e*n*4,i=t.length===e*n*3;if(r||i){const a=new Float32Array(e*n);let o=0,s=0;const c=r?4:3;for(let l=0;l<e;l++)for(let f=0;f<n;f++){const u=t[o],g=t[o+1],d=t[o+2];a[s]=(u+g+d)/3,o+=c,s++}return a}else return t}function cM(t){if(t instanceof Hi)return Me.getVolume(t.getVolumeId()).imageIds;if(t.getImageIds)return t.getImageIds()}function lM(t,e){const n=[...t];return e>=n.length?(O7(n),n):(O7(n),n.slice(0,e))}function O7(t){for(let e=t.length-1;e>0;e--){const n=Math.floor(Math.random()*(e+1));[t[e],t[n]]=[t[n],t[e]]}}function j5(t){const e=t.toString(16);return e.length==1?"0"+e:e}function EZ(t,e,n){return"#"+j5(t)+j5(e)+j5(n)}function OZ(t){const e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return e?{r:parseInt(e[1],16),g:parseInt(e[2],16),b:parseInt(e[3],16)}:null}const DZ=Object.freeze(Object.defineProperty({__proto__:null,hexToRgb:OZ,rgbToHex:EZ},Symbol.toStringTag,{value:"Module"}));function uM(t,e){if(t===e)return!0;if(t==null||e==null)return!1;try{return JSON.stringify(t)===JSON.stringify(e)}catch(n){return console.debug("Error in JSON.stringify during deep comparison:",n),t===e}}function RZ(t,e,n){if(!n)throw new Error("getVolume is required, use the utilities export instead ");if(t.modality)return t.modality;if(t.setVolumes)return e=e??t.getVolumeId(),!e||!n?void 0:n(e).metadata.Modality;throw new Error("Invalid viewport type")}const MZ=(t,e)=>t.reduce((n,r)=>((n[r[e]]=n[r[e]]||[]).push(r),n),{});function _Z(t){const e=t.map(o=>{const{imagePositionPatient:s}=Ve("imagePlaneModule",o)||{};return{imageId:o,imagePositionPatient:s}});if(!e.every(o=>o.imagePositionPatient))return null;const n=MZ(e,"imagePositionPatient"),r=Object.keys(n),i=n[r[0]].length;return i===1||!r.every(o=>n[o].length===i)?null:n}function bZ(t,e){const n={};let r=[];const i=Object.keys(t);for(let a=0;a<i.length;a++){const o=new Set,s=t[i[a]];for(let c=0;c<s.length;c++){const l=e(s[c].imageId)||0;if(n[l]=n[l]||[],n[l].push({imageId:s[c].imageId}),o.add(l),o.size-1<c)return}if(a==0)r=Array.from(o);else if(!PZ(r,o))return}return n}function Sf(t,e){const n=Ve(e,t);try{return parseFloat(n)}catch{return}}function LZ(t){const e=Ve("20011003",t);try{const{InlineBinary:n}=e;if(n){const r=atob(n),i=new ArrayBuffer(r.length),a=new DataView(i);for(let o=0;o<r.length;o++)a.setUint8(o,r.charCodeAt(o));return new Float32Array(i)[0]}return parseFloat(e)}catch{return}}function IZ(t){let e=Ve("0019100c",t)||Ve("0019100C",t);try{const{InlineBinary:n}=e;return n&&(e=atob(n)),parseFloat(e)}catch{return}}function VZ(t){let e=Ve("00431039",t);try{const{InlineBinary:n}=e;return n&&(e=atob(n).split("//")),parseFloat(e[0])%1e5}catch{return}}function PZ(t,e){if(t.length!=e.size)return!1;for(let n=0;n<t.length;n++)if(!e.has(t[n]))return!1;return!0}function NZ(t){const e=Ve("petImageModule",t);return e?e.frameReferenceTime:0}function fM(t){const e=_Z(t);if(!e)return{imageIdGroups:[t],splittingTag:null};const n=["TemporalPositionIdentifier","DiffusionBValue","TriggerTime","EchoTime","EchoNumber","PhilipsPrivateBValue","SiemensPrivateBValue","GEPrivateBValue","PetFrameReferenceTime"],r=[i=>Sf(i,n[0]),i=>Sf(i,n[1]),i=>Sf(i,n[2]),i=>Sf(i,n[3]),i=>Sf(i,n[4]),LZ,IZ,VZ,NZ];for(let i=0;i<r.length;i++){const a=bZ(e,r[i]);if(a)return{imageIdGroups:Object.keys(a).map(Number.parseFloat).sort((c,l)=>c-l).map(c=>a[c].map(l=>l.imageId)),splittingTag:n[i]}}return{imageIdGroups:[t],splittingTag:null}}function kZ(t){const{imageIdGroups:e,splittingTag:n}=fM(t);return{isDynamicVolume:e.length>1,timePoints:e,splittingTag:n}}function AZ(t,e){const n=t.length,{rescaleSlope:r,rescaleIntercept:i,suvbw:a}=e;if(e.modality==="PT"&&typeof a=="number")for(let o=0;o<n;o++)t[o]=a*(t[o]*r+i);else for(let o=0;o<n;o++)t[o]=t[o]*r+i;return t}function gM(t,e,n){return Math.min(Math.max(e,t),n)}function dM(t,e){if(!We(t.element))throw new Error("Scroll::Viewport is not enabled (it might be disabled)");if(t instanceof ha&&t.getImageIds().length===0)throw new Error("Scroll::Stack Viewport has no images");const{volumeId:r,delta:i,scrollSlabs:a}=e;if(t instanceof Hi)FZ(t,r,i,a);else{const o=t.getCurrentImageIdIndex();if(o+i>t.getImageIds().length-1||o+i<0){const s={imageIdIndex:o,direction:i};De(Ee,Oe.STACK_SCROLL_OUT_OF_BOUNDS,s)}t.scroll(i,e.debounceLoading,e.loop)}}function FZ(t,e,n,r=!1){const i=r,{numScrollSteps:a,currentStepIndex:o,sliceRangeInfo:s}=lu(t,e,i);if(!s)return;const{sliceRange:c,spacingInNormalDirection:l,camera:f}=s,{focalPoint:u,viewPlaneNormal:g,position:d}=f,{newFocalPoint:h,newPosition:p}=ou(u,d,c,g,l,n);t.setCamera({focalPoint:h,position:p}),t.render();const m=o+n,v={volumeId:e,viewport:t,delta:n,desiredStepIndex:m,currentStepIndex:o,numScrollSteps:a,currentImageId:t.getCurrentImageId()};(m>a||m<0)&&t.getCurrentImageId()?De(Ee,Oe.VOLUME_VIEWPORT_SCROLL_OUT_OF_BOUNDS,v):De(Ee,Oe.VOLUME_VIEWPORT_SCROLL,v)}async function UZ(t,e={}){const{imageIndex:n,debounceLoading:r,volumeId:i}=e,a=We(t);if(!a)throw new Error("Element has been disabled");const{viewport:o}=a,{imageIndex:s,numberOfSlices:c}=BZ(o,r),f=GZ(c,n)-s;dM(o,{delta:f,debounceLoading:r,volumeId:i})}function BZ(t,e){return t instanceof ha?{numberOfSlices:t.getImageIds().length,imageIndex:e?t.getTargetImageIdIndex():t.getCurrentImageIdIndex()}:{numberOfSlices:t.getNumberOfSlices(),imageIndex:t.getSliceIndex()}}function GZ(t,e){const n=t-1;return gM(e,0,n)}function $Z(t,e,n={}){const r=Me.getVolume(t);if(!r)throw new Error(`Referenced volume with id ${t} does not exist.`);const{metadata:i,spacing:a,direction:o,dimensions:s}=r,{minX:c,maxX:l,minY:f,maxY:u,minZ:g,maxZ:d}=e,h=[Math.min(c,l),Math.min(f,u),Math.min(g,d)],p=Dh(r.imageData,h),m=[Math.abs(l-c)+1,Math.abs(u-f)+1,Math.abs(d-g)+1],{targetBuffer:v}=n,y={metadata:i,dimensions:m,spacing:a,origin:p,direction:o,targetBuffer:v,scalarData:(v==null?void 0:v.type)==="Float32Array"?new Float32Array(m[0]*m[1]*m[2]):void 0},T=Jq(In(),y),C=T.voxelManager.getCompleteScalarDataArray(),w=m[0]*m[1],x=s[0]*s[1],O=r.voxelManager.getCompleteScalarDataArray();for(let M=0;M<m[2];M++)for(let A=0;A<m[1];A++){const _=Dh(T.imageData,[0,A,M]),k=Qo(r.imageData,_),z=k[2]*x+k[1]*s[0]+k[0],X=O.slice(z,z+m[0]),Z=M*w+A*m[0];C.set(X,Z)}return T.voxelManager.setCompleteScalarDataArray(C),T}function WZ(t,e){const{viewUp:n,viewPlaneNormal:r}=e,i=up(t,[0,0,0]),a=as(Le(),n),o=as(Le(),r),s=an(Le(),a,o),c=_n(Le(),up(t,a),i),l=_n(Le(),up(t,o),i);wn(c,c),wn(l,l);const f=an(Le(),c,l);return{worldVecRowDir:s,worldVecColDir:a,worldVecSliceDir:o,ijkVecRowDir:f,ijkVecColDir:c,ijkVecSliceDir:l}}const zZ=(t,e)=>RZ(t,e,Me.getVolume),ws=Object.freeze(Object.defineProperty({__proto__:null,FrameRange:uu,HistoryMemo:Py,PointsManager:gp,ProgressiveIterator:Sh,RLEVoxelMap:nc,VoxelManager:Wt,actorIsA:Vi,applyPreset:BR,autoLoad:H3,calculateViewportsSpatialRegistration:dZ,calibratedPixelSpacingMetadataProvider:eZ,clamp:Z3,clip:gM,color:DZ,colormap:Kj,convertStackToVolumeViewport:CZ,convertToGrayscale:SZ,convertVolumeToStackViewport:wZ,createLinearRGBTransferFunction:zR,createSigmoidRGBTransferFunction:wy,createSubVolume:$Z,decimate:RR,deepClone:ka,deepEqual:uM,deepMerge:Li,eventListener:HY,generateVolumePropsFromImageIds:Oy,genericMetadataProvider:lc,getBufferConfiguration:cy,getClosestImageId:Wg,getClosestStackImageIndexForPoint:cZ,getCurrentVolumeViewportSlice:fZ,getDynamicVolumeInfo:kZ,getImageLegacy:vZ,getImageSliceDataForVolumeViewport:Oh,getMinMax:qY,getRandomSampleFromArray:lM,getRuntimeId:nM,getScalingParameters:OR,getSliceRange:E2,getSpacingInNormalDirection:Td,getTargetVolumeAndSpacingInNormalDir:xd,getViewportImageCornersInWorld:pZ,getViewportImageIds:cM,getViewportModality:zZ,getViewportsWithImageURI:ev,getViewportsWithVolumeId:Dy,getVoiFromSigmoidRGBTransferFunction:UR,getVolumeActorCorners:GD,getVolumeDirectionVectors:WZ,getVolumeId:ef,getVolumeSliceRangeInfo:FR,getVolumeViewportScrollInfo:lu,getVolumeViewportsContainingSameVolumes:rZ,hasFloatScalingParameters:Ey,hasNaNValues:q3,imageIdToURI:gi,imageRetrieveMetadataProvider:jg,imageToWorldCoords:sZ,indexWithinDimensions:nZ,invertRgbTransferFunction:sg,isEqual:Mn,isEqualAbs:jj,isEqualNegative:HD,isImageActor:co,isOpposite:tZ,isPTPrescaledWithSUV:rM,isValidVolume:yZ,isVideoTransferSyntax:sM,jumpToSlice:UZ,loadImageToCanvas:iZ,makeVolumeMetadata:SR,planar:vX,pointInShapeCallback:Sy,renderToCanvasCPU:aM,renderToCanvasGPU:iM,roundNumber:Qs,roundToPrecision:xZ,scaleArray:AZ,scaleRgbTransferFunction:KY,scroll:dM,snapFocalPointToSlice:ou,sortImageIdsAndGetSpacing:ER,spatialRegistrationMetadataProvider:Mh,splitImageIdsBy4DTags:fM,transferFunctionUtils:Xj,transformIndexToWorld:Dh,transformWorldToIndex:Qo,transformWorldToIndexContinuous:up,triggerEvent:De,updateVTKImageDataWithCornerstoneImage:D2,uuidv4:In,windowLevel:qj,worldToImageCoords:oZ},Symbol.toStringTag,{value:"Module"})),Ed=new uy("imageRetrievalPool");Ed.setMaxSimultaneousRequests(ot.Interaction,200);Ed.setMaxSimultaneousRequests(ot.Thumbnail,200);Ed.setMaxSimultaneousRequests(ot.Prefetch,200);Ed.grabDelay=0;const D7=Symbol("DefaultSettings"),R7=Symbol("RuntimeSettings"),M7=Symbol("ObjectSettingsMap"),jo=Symbol("Dictionary");class jt{constructor(e){const n=Object.create(e instanceof jt&&jo in e?e[jo]:null);Object.seal(Object.defineProperty(this,jo,{value:n}))}set(e,n){return _h(this[jo],e,n,null)}get(e){return KZ(this[jo],e)}unset(e){return jZ(this[jo],e+"")}forEach(e){_7(this[jo],e)}extend(){return new jt(this)}import(e){pM(e)&&Object.keys(e).forEach(n=>{_h(this[jo],n,e[n],null)})}dump(){const e={};return _7(this[jo],(n,r)=>{typeof r<"u"&&hM(e,n,r)}),e}static assert(e){return e instanceof jt?e:jt.getRuntimeSettings()}static getDefaultSettings(e=null){let n=jt[D7];if(n instanceof jt||(n=new jt,jt[D7]=n),e){const r={};return n.forEach(i=>{if(i.startsWith(e)){const a=i.split(`${e}.`)[1];r[a]=n.get(i)}}),r}return n}static getRuntimeSettings(){let e=jt[R7];return e instanceof jt||(e=new jt(jt.getDefaultSettings()),jt[R7]=e),e}static getObjectSettings(e,n){let r=null;if(e instanceof jt)r=e;else if(typeof e=="object"&&e!==null){let i=jt[M7];i instanceof WeakMap||(i=new WeakMap,jt[M7]=i),r=i.get(e),r instanceof jt||(r=new jt(jt.assert(jt.getObjectSettings(n))),i.set(e,r))}return r}static extendRuntimeSettings(){return jt.getRuntimeSettings().extend()}}function jZ(t,e){if(e.endsWith(".")){let n=0;const r=e,i=r.slice(0,-1),a=i.length===0;for(const o in t)Object.prototype.hasOwnProperty.call(t,o)&&(a||o.startsWith(r)||o===i)&&(delete t[o],++n);return n>0}return delete t[e]}function _7(t,e){for(const n in t)e(n,t[n])}function HZ(t,e,n,r){let i;if(r.has(n))return _h(t,e,null,r);r.add(n),i=0;for(const a in n)if(Object.prototype.hasOwnProperty.call(n,a)){const o=a.length===0?e:`${e}.${a}`;_h(t,o,n[a],r)||++i}return r.delete(n),i===0}function _h(t,e,n,r){return qZ(e)?pM(n)?HZ(t,e,n,r instanceof WeakSet?r:new WeakSet):(t[e]=n,!0):!1}function KZ(t,e){return t[e]}function qZ(t){let e,n,r;if(typeof t!="string"||(e=t.length-1)<0)return!1;for(r=-1;(n=t.indexOf(".",r+1))>=0;){if(n-r<2||n===e)return!1;r=n}return!0}function pM(t){if(typeof t=="object"&&t!==null){const e=Object.getPrototypeOf(t);if(e===Object.prototype||e===null)return!0}return!1}function hM(t,e,n){const r=e.indexOf(".");if(r>=0){const i=e.slice(0,r);let a=t[i];if(typeof a!="object"||a===null){const o=a;a={},typeof o<"u"&&(a[""]=o),t[i]=a}hM(a,e.slice(r+1,e.length),n)}else t[e]=n}jt.getDefaultSettings().set("useCursors",!0);function mp(t,e){return t==null||e==null?NaN:t<e?-1:t>e?1:t>=e?0:NaN}function XZ(t,e){return t==null||e==null?NaN:e<t?-1:e>t?1:e>=t?0:NaN}function mM(t){let e,n,r;t.length!==2?(e=mp,n=(s,c)=>mp(t(s),c),r=(s,c)=>t(s)-c):(e=t===mp||t===XZ?t:YZ,n=t,r=t);function i(s,c,l=0,f=s.length){if(l<f){if(e(c,c)!==0)return f;do{const u=l+f>>>1;n(s[u],c)<0?l=u+1:f=u}while(l<f)}return l}function a(s,c,l=0,f=s.length){if(l<f){if(e(c,c)!==0)return f;do{const u=l+f>>>1;n(s[u],c)<=0?l=u+1:f=u}while(l<f)}return l}function o(s,c,l=0,f=s.length){const u=i(s,c,l,f-1);return u>l&&r(s[u-1],c)>-r(s[u],c)?u-1:u}return{left:i,center:o,right:a}}function YZ(){return 0}function ZZ(t){return t===null?NaN:+t}const QZ=mM(mp),JZ=QZ.right;mM(ZZ).center;const eQ=Math.sqrt(50),tQ=Math.sqrt(10),nQ=Math.sqrt(2);function bh(t,e,n){const r=(e-t)/Math.max(0,n),i=Math.floor(Math.log10(r)),a=r/Math.pow(10,i),o=a>=eQ?10:a>=tQ?5:a>=nQ?2:1;let s,c,l;return i<0?(l=Math.pow(10,-i)/o,s=Math.round(t*l),c=Math.round(e*l),s/l<t&&++s,c/l>e&&--c,l=-l):(l=Math.pow(10,i)*o,s=Math.round(t/l),c=Math.round(e/l),s*l<t&&++s,c*l>e&&--c),c<s&&.5<=n&&n<2?bh(t,e,n*2):[s,c,l]}function rQ(t,e,n){if(e=+e,t=+t,n=+n,!(n>0))return[];if(t===e)return[t];const r=e<t,[i,a,o]=r?bh(e,t,n):bh(t,e,n);if(!(a>=i))return[];const s=a-i+1,c=new Array(s);if(r)if(o<0)for(let l=0;l<s;++l)c[l]=(a-l)/-o;else for(let l=0;l<s;++l)c[l]=(a-l)*o;else if(o<0)for(let l=0;l<s;++l)c[l]=(i+l)/-o;else for(let l=0;l<s;++l)c[l]=(i+l)*o;return c}function tv(t,e,n){return e=+e,t=+t,n=+n,bh(t,e,n)[2]}function iQ(t,e,n){e=+e,t=+t,n=+n;const r=e<t,i=r?tv(e,t,n):tv(t,e,n);return(r?-1:1)*(i<0?1/-i:i)}function aQ(t,e){let n;if(e===void 0)for(const r of t)r!=null&&(n>r||n===void 0&&r>=r)&&(n=r);else{let r=-1;for(let i of t)(i=e(i,++r,t))!=null&&(n>i||n===void 0&&i>=i)&&(n=i)}return n}function oQ(t){if(!(a=t.length))return[];for(var e=-1,n=aQ(t,sQ),r=new Array(n);++e<n;)for(var i=-1,a,o=r[e]=new Array(a);++i<a;)o[i]=t[i][e];return r}function sQ(t){return t.length}function b7(){return oQ(arguments)}function cQ(t,e){switch(arguments.length){case 0:break;case 1:this.range(t);break;default:this.range(e).domain(t);break}return this}function Ny(t,e,n){t.prototype=e.prototype=n,n.constructor=t}function vM(t,e){var n=Object.create(t.prototype);for(var r in e)n[r]=e[r];return n}function Od(){}var Kg=.7,Lh=1/Kg,fu="\\s*([+-]?\\d+)\\s*",qg="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",go="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",lQ=/^#([0-9a-f]{3,8})$/,uQ=new RegExp(`^rgb\\(${fu},${fu},${fu}\\)$`),fQ=new RegExp(`^rgb\\(${go},${go},${go}\\)$`),gQ=new RegExp(`^rgba\\(${fu},${fu},${fu},${qg}\\)$`),dQ=new RegExp(`^rgba\\(${go},${go},${go},${qg}\\)$`),pQ=new RegExp(`^hsl\\(${qg},${go},${go}\\)$`),hQ=new RegExp(`^hsla\\(${qg},${go},${go},${qg}\\)$`),L7={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};Ny(Od,Xg,{copy(t){return Object.assign(new this.constructor,this,t)},displayable(){return this.rgb().displayable()},hex:I7,formatHex:I7,formatHex8:mQ,formatHsl:vQ,formatRgb:V7,toString:V7});function I7(){return this.rgb().formatHex()}function mQ(){return this.rgb().formatHex8()}function vQ(){return yM(this).formatHsl()}function V7(){return this.rgb().formatRgb()}function Xg(t){var e,n;return t=(t+"").trim().toLowerCase(),(e=lQ.exec(t))?(n=e[1].length,e=parseInt(e[1],16),n===6?P7(e):n===3?new Ri(e>>8&15|e>>4&240,e>>4&15|e&240,(e&15)<<4|e&15,1):n===8?v1(e>>24&255,e>>16&255,e>>8&255,(e&255)/255):n===4?v1(e>>12&15|e>>8&240,e>>8&15|e>>4&240,e>>4&15|e&240,((e&15)<<4|e&15)/255):null):(e=uQ.exec(t))?new Ri(e[1],e[2],e[3],1):(e=fQ.exec(t))?new Ri(e[1]*255/100,e[2]*255/100,e[3]*255/100,1):(e=gQ.exec(t))?v1(e[1],e[2],e[3],e[4]):(e=dQ.exec(t))?v1(e[1]*255/100,e[2]*255/100,e[3]*255/100,e[4]):(e=pQ.exec(t))?A7(e[1],e[2]/100,e[3]/100,1):(e=hQ.exec(t))?A7(e[1],e[2]/100,e[3]/100,e[4]):L7.hasOwnProperty(t)?P7(L7[t]):t==="transparent"?new Ri(NaN,NaN,NaN,0):null}function P7(t){return new Ri(t>>16&255,t>>8&255,t&255,1)}function v1(t,e,n,r){return r<=0&&(t=e=n=NaN),new Ri(t,e,n,r)}function yQ(t){return t instanceof Od||(t=Xg(t)),t?(t=t.rgb(),new Ri(t.r,t.g,t.b,t.opacity)):new Ri}function nv(t,e,n,r){return arguments.length===1?yQ(t):new Ri(t,e,n,r??1)}function Ri(t,e,n,r){this.r=+t,this.g=+e,this.b=+n,this.opacity=+r}Ny(Ri,nv,vM(Od,{brighter(t){return t=t==null?Lh:Math.pow(Lh,t),new Ri(this.r*t,this.g*t,this.b*t,this.opacity)},darker(t){return t=t==null?Kg:Math.pow(Kg,t),new Ri(this.r*t,this.g*t,this.b*t,this.opacity)},rgb(){return this},clamp(){return new Ri(G0(this.r),G0(this.g),G0(this.b),Ih(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:N7,formatHex:N7,formatHex8:TQ,formatRgb:k7,toString:k7}));function N7(){return`#${k0(this.r)}${k0(this.g)}${k0(this.b)}`}function TQ(){return`#${k0(this.r)}${k0(this.g)}${k0(this.b)}${k0((isNaN(this.opacity)?1:this.opacity)*255)}`}function k7(){const t=Ih(this.opacity);return`${t===1?"rgb(":"rgba("}${G0(this.r)}, ${G0(this.g)}, ${G0(this.b)}${t===1?")":`, ${t})`}`}function Ih(t){return isNaN(t)?1:Math.max(0,Math.min(1,t))}function G0(t){return Math.max(0,Math.min(255,Math.round(t)||0))}function k0(t){return t=G0(t),(t<16?"0":"")+t.toString(16)}function A7(t,e,n,r){return r<=0?t=e=n=NaN:n<=0||n>=1?t=e=NaN:e<=0&&(t=NaN),new Aa(t,e,n,r)}function yM(t){if(t instanceof Aa)return new Aa(t.h,t.s,t.l,t.opacity);if(t instanceof Od||(t=Xg(t)),!t)return new Aa;if(t instanceof Aa)return t;t=t.rgb();var e=t.r/255,n=t.g/255,r=t.b/255,i=Math.min(e,n,r),a=Math.max(e,n,r),o=NaN,s=a-i,c=(a+i)/2;return s?(e===a?o=(n-r)/s+(n<r)*6:n===a?o=(r-e)/s+2:o=(e-n)/s+4,s/=c<.5?a+i:2-a-i,o*=60):s=c>0&&c<1?0:o,new Aa(o,s,c,t.opacity)}function CQ(t,e,n,r){return arguments.length===1?yM(t):new Aa(t,e,n,r??1)}function Aa(t,e,n,r){this.h=+t,this.s=+e,this.l=+n,this.opacity=+r}Ny(Aa,CQ,vM(Od,{brighter(t){return t=t==null?Lh:Math.pow(Lh,t),new Aa(this.h,this.s,this.l*t,this.opacity)},darker(t){return t=t==null?Kg:Math.pow(Kg,t),new Aa(this.h,this.s,this.l*t,this.opacity)},rgb(){var t=this.h%360+(this.h<0)*360,e=isNaN(t)||isNaN(this.s)?0:this.s,n=this.l,r=n+(n<.5?n:1-n)*e,i=2*n-r;return new Ri(H5(t>=240?t-240:t+120,i,r),H5(t,i,r),H5(t<120?t+240:t-120,i,r),this.opacity)},clamp(){return new Aa(F7(this.h),y1(this.s),y1(this.l),Ih(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const t=Ih(this.opacity);return`${t===1?"hsl(":"hsla("}${F7(this.h)}, ${y1(this.s)*100}%, ${y1(this.l)*100}%${t===1?")":`, ${t})`}`}}));function F7(t){return t=(t||0)%360,t<0?t+360:t}function y1(t){return Math.max(0,Math.min(1,t||0))}function H5(t,e,n){return(t<60?e+(n-e)*t/60:t<180?n:t<240?e+(n-e)*(240-t)/60:e)*255}function wQ(t,e,n,r,i){var a=t*t,o=a*t;return((1-3*t+3*a-o)*e+(4-6*a+3*o)*n+(1+3*t+3*a-3*o)*r+o*i)/6}function K5(t){var e=t.length-1;return function(n){var r=n<=0?n=0:n>=1?(n=1,e-1):Math.floor(n*e),i=t[r],a=t[r+1],o=r>0?t[r-1]:2*i-a,s=r<e-1?t[r+2]:2*a-i;return wQ((n-r/e)*e,o,i,a,s)}}const ky=t=>()=>t;function xQ(t,e){return function(n){return t+n*e}}function SQ(t,e,n){return t=Math.pow(t,n),e=Math.pow(e,n)-t,n=1/n,function(r){return Math.pow(t+r*e,n)}}function EQ(t){return(t=+t)==1?TM:function(e,n){return n-e?SQ(e,n,t):ky(isNaN(e)?n:e)}}function TM(t,e){var n=e-t;return n?xQ(t,n):ky(isNaN(t)?e:t)}const U7=function t(e){var n=EQ(e);function r(i,a){var o=n((i=nv(i)).r,(a=nv(a)).r),s=n(i.g,a.g),c=n(i.b,a.b),l=TM(i.opacity,a.opacity);return function(f){return i.r=o(f),i.g=s(f),i.b=c(f),i.opacity=l(f),i+""}}return r.gamma=t,r}(1);function OQ(t,e){e||(e=[]);var n=t?Math.min(e.length,t.length):0,r=e.slice(),i;return function(a){for(i=0;i<n;++i)r[i]=t[i]*(1-a)+e[i]*a;return r}}function DQ(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)}function RQ(t,e){var n=e?e.length:0,r=t?Math.min(n,t.length):0,i=new Array(r),a=new Array(n),o;for(o=0;o<r;++o)i[o]=Ay(t[o],e[o]);for(;o<n;++o)a[o]=e[o];return function(s){for(o=0;o<r;++o)a[o]=i[o](s);return a}}function MQ(t,e){var n=new Date;return t=+t,e=+e,function(r){return n.setTime(t*(1-r)+e*r),n}}function Vh(t,e){return t=+t,e=+e,function(n){return t*(1-n)+e*n}}function _Q(t,e){var n={},r={},i;(t===null||typeof t!="object")&&(t={}),(e===null||typeof e!="object")&&(e={});for(i in e)i in t?n[i]=Ay(t[i],e[i]):r[i]=e[i];return function(a){for(i in n)r[i]=n[i](a);return r}}var rv=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,q5=new RegExp(rv.source,"g");function bQ(t){return function(){return t}}function LQ(t){return function(e){return t(e)+""}}function IQ(t,e){var n=rv.lastIndex=q5.lastIndex=0,r,i,a,o=-1,s=[],c=[];for(t=t+"",e=e+"";(r=rv.exec(t))&&(i=q5.exec(e));)(a=i.index)>n&&(a=e.slice(n,a),s[o]?s[o]+=a:s[++o]=a),(r=r[0])===(i=i[0])?s[o]?s[o]+=i:s[++o]=i:(s[++o]=null,c.push({i:o,x:Vh(r,i)})),n=q5.lastIndex;return n<e.length&&(a=e.slice(n),s[o]?s[o]+=a:s[++o]=a),s.length<2?c[0]?LQ(c[0].x):bQ(e):(e=c.length,function(l){for(var f=0,u;f<e;++f)s[(u=c[f]).i]=u.x(l);return s.join("")})}function Ay(t,e){var n=typeof e,r;return e==null||n==="boolean"?ky(e):(n==="number"?Vh:n==="string"?(r=Xg(e))?(e=r,U7):IQ:e instanceof Xg?U7:e instanceof Date?MQ:DQ(e)?OQ:Array.isArray(e)?RQ:typeof e.valueOf!="function"&&typeof e.toString!="function"||isNaN(e)?_Q:Vh)(t,e)}function VQ(t,e){return t=+t,e=+e,function(n){return Math.round(t*(1-n)+e*n)}}function Ef(t,e){for(var n=new Array(e),r=0;r<e;++r)n[r]=t(r/(e-1));return n}function PQ(t){return function(){return t}}function NQ(t){return+t}var B7=[0,1];function jl(t){return t}function iv(t,e){return(e-=t=+t)?function(n){return(n-t)/e}:PQ(isNaN(e)?NaN:.5)}function kQ(t,e){var n;return t>e&&(n=t,t=e,e=n),function(r){return Math.max(t,Math.min(e,r))}}function AQ(t,e,n){var r=t[0],i=t[1],a=e[0],o=e[1];return i<r?(r=iv(i,r),a=n(o,a)):(r=iv(r,i),a=n(a,o)),function(s){return a(r(s))}}function FQ(t,e,n){var r=Math.min(t.length,e.length)-1,i=new Array(r),a=new Array(r),o=-1;for(t[r]<t[0]&&(t=t.slice().reverse(),e=e.slice().reverse());++o<r;)i[o]=iv(t[o],t[o+1]),a[o]=n(e[o],e[o+1]);return function(s){var c=JZ(t,s,1,r)-1;return a[c](i[c](s))}}function UQ(t,e){return e.domain(t.domain()).range(t.range()).interpolate(t.interpolate()).clamp(t.clamp()).unknown(t.unknown())}function BQ(){var t=B7,e=B7,n=Ay,r,i,a,o=jl,s,c,l;function f(){var g=Math.min(t.length,e.length);return o!==jl&&(o=kQ(t[0],t[g-1])),s=g>2?FQ:AQ,c=l=null,u}function u(g){return g==null||isNaN(g=+g)?a:(c||(c=s(t.map(r),e,n)))(r(o(g)))}return u.invert=function(g){return o(i((l||(l=s(e,t.map(r),Vh)))(g)))},u.domain=function(g){return arguments.length?(t=Array.from(g,NQ),f()):t.slice()},u.range=function(g){return arguments.length?(e=Array.from(g),f()):e.slice()},u.rangeRound=function(g){return e=Array.from(g),n=VQ,f()},u.clamp=function(g){return arguments.length?(o=g?!0:jl,f()):o!==jl},u.interpolate=function(g){return arguments.length?(n=g,f()):n},u.unknown=function(g){return arguments.length?(a=g,u):a},function(g,d){return r=g,i=d,f()}}function GQ(){return BQ()(jl,jl)}function $Q(t){return Math.abs(t=Math.round(t))>=1e21?t.toLocaleString("en").replace(/,/g,""):t.toString(10)}function Ph(t,e){if((n=(t=e?t.toExponential(e-1):t.toExponential()).indexOf("e"))<0)return null;var n,r=t.slice(0,n);return[r.length>1?r[0]+r.slice(2):r,+t.slice(n+1)]}function Vu(t){return t=Ph(Math.abs(t)),t?t[1]:NaN}function WQ(t,e){return function(n,r){for(var i=n.length,a=[],o=0,s=t[0],c=0;i>0&&s>0&&(c+s+1>r&&(s=Math.max(1,r-c)),a.push(n.substring(i-=s,i+s)),!((c+=s+1)>r));)s=t[o=(o+1)%t.length];return a.reverse().join(e)}}function zQ(t){return function(e){return e.replace(/[0-9]/g,function(n){return t[+n]})}}var jQ=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function Nh(t){if(!(e=jQ.exec(t)))throw new Error("invalid format: "+t);var e;return new Fy({fill:e[1],align:e[2],sign:e[3],symbol:e[4],zero:e[5],width:e[6],comma:e[7],precision:e[8]&&e[8].slice(1),trim:e[9],type:e[10]})}Nh.prototype=Fy.prototype;function Fy(t){this.fill=t.fill===void 0?" ":t.fill+"",this.align=t.align===void 0?">":t.align+"",this.sign=t.sign===void 0?"-":t.sign+"",this.symbol=t.symbol===void 0?"":t.symbol+"",this.zero=!!t.zero,this.width=t.width===void 0?void 0:+t.width,this.comma=!!t.comma,this.precision=t.precision===void 0?void 0:+t.precision,this.trim=!!t.trim,this.type=t.type===void 0?"":t.type+""}Fy.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function HQ(t){e:for(var e=t.length,n=1,r=-1,i;n<e;++n)switch(t[n]){case".":r=i=n;break;case"0":r===0&&(r=n),i=n;break;default:if(!+t[n])break e;r>0&&(r=0);break}return r>0?t.slice(0,r)+t.slice(i+1):t}var CM;function KQ(t,e){var n=Ph(t,e);if(!n)return t+"";var r=n[0],i=n[1],a=i-(CM=Math.max(-8,Math.min(8,Math.floor(i/3)))*3)+1,o=r.length;return a===o?r:a>o?r+new Array(a-o+1).join("0"):a>0?r.slice(0,a)+"."+r.slice(a):"0."+new Array(1-a).join("0")+Ph(t,Math.max(0,e+a-1))[0]}function G7(t,e){var n=Ph(t,e);if(!n)return t+"";var r=n[0],i=n[1];return i<0?"0."+new Array(-i).join("0")+r:r.length>i+1?r.slice(0,i+1)+"."+r.slice(i+1):r+new Array(i-r.length+2).join("0")}const $7={"%":(t,e)=>(t*100).toFixed(e),b:t=>Math.round(t).toString(2),c:t=>t+"",d:$Q,e:(t,e)=>t.toExponential(e),f:(t,e)=>t.toFixed(e),g:(t,e)=>t.toPrecision(e),o:t=>Math.round(t).toString(8),p:(t,e)=>G7(t*100,e),r:G7,s:KQ,X:t=>Math.round(t).toString(16).toUpperCase(),x:t=>Math.round(t).toString(16)};function W7(t){return t}var z7=Array.prototype.map,j7=["y","z","a","f","p","n","µ","m","","k","M","G","T","P","E","Z","Y"];function qQ(t){var e=t.grouping===void 0||t.thousands===void 0?W7:WQ(z7.call(t.grouping,Number),t.thousands+""),n=t.currency===void 0?"":t.currency[0]+"",r=t.currency===void 0?"":t.currency[1]+"",i=t.decimal===void 0?".":t.decimal+"",a=t.numerals===void 0?W7:zQ(z7.call(t.numerals,String)),o=t.percent===void 0?"%":t.percent+"",s=t.minus===void 0?"−":t.minus+"",c=t.nan===void 0?"NaN":t.nan+"";function l(u){u=Nh(u);var g=u.fill,d=u.align,h=u.sign,p=u.symbol,m=u.zero,v=u.width,y=u.comma,T=u.precision,C=u.trim,w=u.type;w==="n"?(y=!0,w="g"):$7[w]||(T===void 0&&(T=12),C=!0,w="g"),(m||g==="0"&&d==="=")&&(m=!0,g="0",d="=");var x=p==="$"?n:p==="#"&&/[boxX]/.test(w)?"0"+w.toLowerCase():"",O=p==="$"?r:/[%p]/.test(w)?o:"",M=$7[w],A=/[defgprs%]/.test(w);T=T===void 0?6:/[gprs]/.test(w)?Math.max(1,Math.min(21,T)):Math.max(0,Math.min(20,T));function _(k){var z=x,X=O,Z,ce,J;if(w==="c")X=M(k)+X,k="";else{k=+k;var de=k<0||1/k<0;if(k=isNaN(k)?c:M(Math.abs(k),T),C&&(k=HQ(k)),de&&+k==0&&h!=="+"&&(de=!1),z=(de?h==="("?h:s:h==="-"||h==="("?"":h)+z,X=(w==="s"?j7[8+CM/3]:"")+X+(de&&h==="("?")":""),A){for(Z=-1,ce=k.length;++Z<ce;)if(J=k.charCodeAt(Z),48>J||J>57){X=(J===46?i+k.slice(Z+1):k.slice(Z))+X,k=k.slice(0,Z);break}}}y&&!m&&(k=e(k,1/0));var Q=z.length+k.length+X.length,q=Q<v?new Array(v-Q+1).join(g):"";switch(y&&m&&(k=e(q+k,q.length?v-X.length:1/0),q=""),d){case"<":k=z+k+X+q;break;case"=":k=z+q+k+X;break;case"^":k=q.slice(0,Q=q.length>>1)+z+k+X+q.slice(Q);break;default:k=q+z+k+X;break}return a(k)}return _.toString=function(){return u+""},_}function f(u,g){var d=l((u=Nh(u),u.type="f",u)),h=Math.max(-8,Math.min(8,Math.floor(Vu(g)/3)))*3,p=Math.pow(10,-h),m=j7[8+h/3];return function(v){return d(p*v)+m}}return{format:l,formatPrefix:f}}var T1,wM,xM;XQ({thousands:",",grouping:[3],currency:["$",""]});function XQ(t){return T1=qQ(t),wM=T1.format,xM=T1.formatPrefix,T1}function YQ(t){return Math.max(0,-Vu(Math.abs(t)))}function ZQ(t,e){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(Vu(e)/3)))*3-Vu(Math.abs(t)))}function QQ(t,e){return t=Math.abs(t),e=Math.abs(e)-t,Math.max(0,Vu(e)-Vu(t))+1}function JQ(t,e,n,r){var i=iQ(t,e,n),a;switch(r=Nh(r??",f"),r.type){case"s":{var o=Math.max(Math.abs(t),Math.abs(e));return r.precision==null&&!isNaN(a=ZQ(i,o))&&(r.precision=a),xM(r,o)}case"":case"e":case"g":case"p":case"r":{r.precision==null&&!isNaN(a=QQ(i,Math.max(Math.abs(t),Math.abs(e))))&&(r.precision=a-(r.type==="e"));break}case"f":case"%":{r.precision==null&&!isNaN(a=YQ(i))&&(r.precision=a-(r.type==="%")*2);break}}return wM(r)}function eJ(t){var e=t.domain;return t.ticks=function(n){var r=e();return rQ(r[0],r[r.length-1],n??10)},t.tickFormat=function(n,r){var i=e();return JQ(i[0],i[i.length-1],n??10,r)},t.nice=function(n){n==null&&(n=10);var r=e(),i=0,a=r.length-1,o=r[i],s=r[a],c,l,f=10;for(s<o&&(l=o,o=s,s=l,l=i,i=a,a=l);f-- >0;){if(l=tv(o,s,n),l===c)return r[i]=o,r[a]=s,e(r);if(l>0)o=Math.floor(o/l)*l,s=Math.ceil(s/l)*l;else if(l<0)o=Math.ceil(o*l)/l,s=Math.floor(s*l)/l;else break;c=l}return t},t}function Uy(){var t=GQ();return t.copy=function(){return UQ(t,Uy())},cQ.apply(t,arguments),eJ(t)}function tJ(t,e){e.classHierarchy.push("vtkTexture"),t.imageLoaded=()=>{e.image.removeEventListener("load",t.imageLoaded),e.imageLoaded=!0,t.modified()},t.setJsImageData=n=>{e.jsImageData!==n&&(n!==null&&(t.setInputData(null),t.setInputConnection(null),e.image=null,e.canvas=null),e.jsImageData=n,e.imageLoaded=!0,t.modified())},t.setCanvas=n=>{e.canvas!==n&&(n!==null&&(t.setInputData(null),t.setInputConnection(null),e.image=null,e.jsImageData=null),e.canvas=n,t.modified())},t.setImage=n=>{e.image!==n&&(n!==null&&(t.setInputData(null),t.setInputConnection(null),e.canvas=null,e.jsImageData=null),e.image=n,e.imageLoaded=!1,n.complete?t.imageLoaded():n.addEventListener("load",t.imageLoaded),t.modified())},t.getDimensionality=()=>{let n=0,r=0,i=1;if(t.getInputData()){const o=t.getInputData();n=o.getDimensions()[0],r=o.getDimensions()[1],i=o.getDimensions()[2]}return e.jsImageData&&(n=e.jsImageData.width,r=e.jsImageData.height),e.canvas&&(n=e.canvas.width,r=e.canvas.height),e.image&&(n=e.image.width,r=e.image.height),(n>1)+(r>1)+(i>1)},t.getInputAsJsImageData=()=>{if(!e.imageLoaded||t.getInputData())return null;if(e.jsImageData)return e.jsImageData();if(e.canvas)return e.canvas.getContext("2d").getImageData(0,0,e.canvas.width,e.canvas.height);if(e.image){const n=document.createElement("canvas");n.width=e.image.width,n.height=e.image.height;const r=n.getContext("2d");return r.translate(0,n.height),r.scale(1,-1),r.drawImage(e.image,0,0,e.image.width,e.image.height),r.getImageData(0,0,n.width,n.height)}return null}}const nJ=(t,e,n,r)=>{const i=[1,2,1],a=4,o=i,s=a,c=t.length/(e*n);let l=e,f=n,u=t;const g=[u];for(let d=0;d<r;d++){const h=[...u];l/=2,f/=2,u=new Uint8ClampedArray(l*f*c);const p=c*l;let m=0;for(let y=0;y<u.length;y+=c){y%p===0&&(m+=2*c*l);for(let T=0;T<c;T++){let C=h[m+T];C+=h[m+c+T],C+=h[m-2*p+T],C+=h[m-2*p+c+T],C/=4,u[y+T]=C}m+=2*c}let v=[...u];for(let y=0;y<u.length;y+=c)for(let T=0;T<c;T++){let C=-(o.length-1)/2,w=s,x=0;for(let O=0;O<o.length;O++){let M=y+T+C*c;const A=M%p-(y+T)%p;A>c&&(M+=p),A<-c&&(M-=p),v[M]?x+=v[M]*o[O]:w-=o[O],C+=1}u[y+T]=x/w}v=[...u];for(let y=0;y<u.length;y+=c)for(let T=0;T<c;T++){let C=-(o.length-1)/2,w=s,x=0;for(let O=0;O<o.length;O++){const M=y+T+C*p;v[M]?x+=v[M]*o[O]:w-=o[O],C+=1}u[y+T]=x/w}g.push(u)}return g},rJ={image:null,canvas:null,jsImageData:null,imageLoaded:!1,repeat:!1,interpolate:!1,edgeClamp:!1,mipLevel:0,resizable:!1};function SM(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,rJ,n),P.obj(t,e),P.algo(t,e,6,0),P.get(t,e,["canvas","image","jsImageData","imageLoaded","resizable"]),P.setGet(t,e,["repeat","edgeClamp","interpolate","mipLevel"]),tJ(t,e)}const iJ=P.newInstance(SM,"vtkTexture"),aJ={generateMipmaps:nJ};var M2={newInstance:iJ,extend:SM,...aJ};const oJ=[[-1,0,0],[1,0,0],[0,-1,0],[0,1,0],[0,0,-1],[0,0,1]],H7=[[8,7,11,3],[9,1,10,5],[4,9,0,8],[2,11,6,10],[0,3,2,1],[4,5,6,7]],C1=[[0,1],[1,3],[2,3],[0,2],[4,5],[5,7],[6,7],[4,6],[0,4],[1,5],[3,7],[2,6]],K7=[0,1,0,1,0,1,0,1,2,2,2,2],cn=[[1,2],[1,2],[0,2],[0,2],[0,1],[0,1]],at=new Float64Array(3),w1=new Float64Array(3),Ft=new Float64Array(3),M0=new Float64Array(3),h0=new Float64Array(3),x1=new Float64Array(3),X5=new Float64Array(16);function Y5(t,e){t.strokeStyle=e.strokeColor,t.lineWidth=e.strokeSize,t.fillStyle=e.fontColor,t.font=`${e.fontStyle} ${e.fontSize}px ${e.fontFamily}`}function EM(t){const e=[],n=[];for(let r=0;r<3;r++){const i=Uy().domain([t[r*2],t[r*2+1]]);e[r]=i.ticks(5);const a=i.tickFormat(5);n[r]=e[r].map(a)}return{ticks:e,tickStrings:n}}function sJ(t,e){e.classHierarchy.push("vtkCubeAxesActorHelper"),t.setRenderable=n=>{e.renderable!==n&&(e.renderable=n,e.tmActor.addTexture(e.renderable.getTmTexture()),e.tmActor.setProperty(n.getProperty()),e.tmActor.setParentProp(n),t.modified())},t.createPolyDataForOneLabel=(n,r,i,a,o,s,c)=>{const l=e.renderable.get_tmAtlas().get(n);if(!l)return;const f=e.renderable.getTextPolyData().getPoints().getData(),u=e.lastSize;at[0]=f[r*3],at[1]=f[r*3+1],at[2]=f[r*3+2],pt(Ft,at,i),Ft[0]+=.1,pt(w1,Ft,a),tn(h0,w1,at),Ft[0]-=.1,Ft[1]+=.1,pt(w1,Ft,a),tn(x1,w1,at);for(let h=0;h<3;h++)h0[h]/=.5*.1*u[0],x1[h]/=.5*.1*u[1];let g=c.ptIdx,d=c.cellIdx;at[0]=f[r*3],at[1]=f[r*3+1],at[2]=f[r*3+2],o[0]<-.5?Br(Ft,h0,o[0]*s-l.width):o[0]>.5?Br(Ft,h0,o[0]*s):Br(Ft,h0,o[0]*s-l.width/2),da(at,at,Ft),Br(Ft,x1,o[1]*s-l.height/2),da(at,at,Ft),c.points[g*3]=at[0],c.points[g*3+1]=at[1],c.points[g*3+2]=at[2],c.tcoords[g*2]=l.tcoords[0],c.tcoords[g*2+1]=l.tcoords[1],g++,Br(Ft,h0,l.width),da(at,at,Ft),c.points[g*3]=at[0],c.points[g*3+1]=at[1],c.points[g*3+2]=at[2],c.tcoords[g*2]=l.tcoords[2],c.tcoords[g*2+1]=l.tcoords[3],g++,Br(Ft,x1,l.height),da(at,at,Ft),c.points[g*3]=at[0],c.points[g*3+1]=at[1],c.points[g*3+2]=at[2],c.tcoords[g*2]=l.tcoords[4],c.tcoords[g*2+1]=l.tcoords[5],g++,Br(Ft,h0,l.width),tn(at,at,Ft),c.points[g*3]=at[0],c.points[g*3+1]=at[1],c.points[g*3+2]=at[2],c.tcoords[g*2]=l.tcoords[6],c.tcoords[g*2+1]=l.tcoords[7],g++,c.polys[d*4]=3,c.polys[d*4+1]=g-4,c.polys[d*4+2]=g-3,c.polys[d*4+3]=g-2,d++,c.polys[d*4]=3,c.polys[d*4+1]=g-4,c.polys[d*4+2]=g-2,c.polys[d*4+3]=g-1,c.ptIdx+=4,c.cellIdx+=2},t.updateTexturePolyData=()=>{const n=e.camera.getCompositeProjectionMatrix(e.lastAspectRatio,-1,1);ft(n,n);const r=e.renderable.getTextValues().length,i=r*4,a=r*2,o=new Float64Array(i*3),s=new Uint16Array(a*4),c=new Float32Array(i*2);Ln(X5,n);const l={ptIdx:0,cellIdx:0,polys:s,points:o,tcoords:c};let f=0,u=0,g=0;const d=e.renderable.getTextPolyData().getPoints().getData(),h=e.renderable.getTextValues();for(;f<d.length/3;){at[0]=d[f*3],at[1]=d[f*3+1],at[2]=d[f*3+2],pt(Ft,at,n),at[0]=d[f*3+3],at[1]=d[f*3+4],at[2]=d[f*3+5],pt(M0,at,n),tn(Ft,Ft,M0);const m=[Ft[0],Ft[1]];LS(m),t.createPolyDataForOneLabel(h[u],f,n,X5,m,e.renderable.getAxisTitlePixelOffset(),l),f+=2,u++;for(let v=0;v<e.renderable.getTickCounts()[g];v++)t.createPolyDataForOneLabel(h[u],f,n,X5,m,e.renderable.getTickLabelPixelOffset(),l),f++,u++;g++}const p=nt.newInstance({numberOfComponents:2,values:c,name:"TextureCoordinates"});e.tmPolyData.getPointData().setTCoords(p),e.tmPolyData.getPoints().setData(o,3),e.tmPolyData.getPoints().modified(),e.tmPolyData.getPolys().setData(s,1),e.tmPolyData.getPolys().modified(),e.tmPolyData.modified()},t.updateAPISpecificData=(n,r,i)=>{(e.lastSize[0]!==n[0]||e.lastSize[1]!==n[1])&&(e.lastSize[0]=n[0],e.lastSize[1]=n[1],e.lastAspectRatio=n[0]/n[1],e.forceUpdate=!0),e.camera=r,t.updateTexturePolyData()}}const cJ=P.newInstance(function(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{renderable:null};Object.assign(e,{},n),P.obj(t,e),e.tmPolyData=Ii.newInstance(),e.tmMapper=J0.newInstance(),e.tmMapper.setInputData(e.tmPolyData),e.tmActor=tl.newInstance({parentProp:t}),e.tmActor.setMapper(e.tmMapper),P.setGet(t,e,["renderable"]),P.get(t,e,["lastSize","lastAspectRatio","axisTextStyle","tickTextStyle","tmActor","ticks"]),e.forceUpdate=!1,e.lastRedrawTime={},P.obj(e.lastRedrawTime,{mtime:0}),e.lastRebuildTime={},P.obj(e.lastRebuildTime,{mtime:0}),e.lastSize=[-1,-1],e.lastTickBounds=[],sJ(t,e)},"vtkCubeAxesActorHelper");function lJ(t,e){e.classHierarchy.push("vtkCubeAxesActor"),t.setCamera=r=>{e.camera!==r&&(e.cameraModifiedSub&&(e.cameraModifiedSub.unsubscribe(),e.cameraModifiedSub=null),e.camera=r,r&&(e.cameraModifiedSub=r.onModified(t.update)),t.update(),t.modified())},t.computeFacesToDraw=()=>{const r=e.camera.getViewMatrix();ft(r,r);let i=!1;const a=Nt.getDiagonalLength(e.dataBounds),o=Math.sin(e.faceVisibilityAngle*Math.PI/180);for(let s=0;s<6;s++){let c=!1;const l=Math.floor(s/2),f=(l+1)%3,u=(l+2)%3;e.dataBounds[f*2]!==e.dataBounds[f*2+1]&&e.dataBounds[u*2]!==e.dataBounds[u*2+1]&&(at[l]=e.dataBounds[s]-.1*a*oJ[s][l],at[f]=.5*(e.dataBounds[f*2]+e.dataBounds[f*2+1]),at[u]=.5*(e.dataBounds[u*2]+e.dataBounds[u*2+1]),pt(Ft,at,r),at[l]=e.dataBounds[s],pt(M0,at,r),tn(Ft,M0,Ft),wn(Ft,Ft),c=Ft[2]>o,e.camera.getParallelProjection()||(wn(M0,M0),c=Qe(M0,Ft)>o)),c!==e.lastFacesToDraw[s]&&(e.lastFacesToDraw[s]=c,i=!0)}return i},t.updatePolyData=(r,i,a)=>{let o=0,s=0;o+=8;let c=0;for(let d=0;d<12;d++)i[d]>0&&c++;if(s+=c,e.gridLines)for(let d=0;d<6;d++)r[d]&&(o+=a[cn[d][0]].length*2+a[cn[d][1]].length*2,s+=a[cn[d][0]].length+a[cn[d][1]].length);const l=new Float64Array(o*3),f=new Uint32Array(s*3);let u=0,g=0;for(let d=0;d<2;d++)for(let h=0;h<2;h++)for(let p=0;p<2;p++)l[u*3]=e.dataBounds[p],l[u*3+1]=e.dataBounds[2+h],l[u*3+2]=e.dataBounds[4+d],u++;for(let d=0;d<12;d++)i[d]>0&&(f[g*3]=2,f[g*3+1]=C1[d][0],f[g*3+2]=C1[d][1],g++);if(e.gridLines){for(let d=0;d<6;d++)if(r[d]){const h=Math.floor(d/2);let p=a[cn[d][0]];for(let m=0;m<p.length;m++)l[u*3+h]=e.dataBounds[d],l[u*3+cn[d][0]]=p[m],l[u*3+cn[d][1]]=e.dataBounds[cn[d][1]*2],u++,l[u*3+h]=e.dataBounds[d],l[u*3+cn[d][0]]=p[m],l[u*3+cn[d][1]]=e.dataBounds[cn[d][1]*2+1],u++,f[g*3]=2,f[g*3+1]=u-2,f[g*3+2]=u-1,g++;p=a[cn[d][1]];for(let m=0;m<p.length;m++)l[u*3+h]=e.dataBounds[d],l[u*3+cn[d][1]]=p[m],l[u*3+cn[d][0]]=e.dataBounds[cn[d][0]*2],u++,l[u*3+h]=e.dataBounds[d],l[u*3+cn[d][1]]=p[m],l[u*3+cn[d][0]]=e.dataBounds[cn[d][0]*2+1],u++,f[g*3]=2,f[g*3+1]=u-2,f[g*3+2]=u-1,g++}}e.polyData.getPoints().setData(l,3),e.polyData.getPoints().modified(),e.polyData.getLines().setData(f,1),e.polyData.getLines().modified(),e.polyData.modified()},t.updateTextData=(r,i,a,o)=>{let s=0;for(let d=0;d<12;d++)i[d]===1&&(s+=2,s+=a[K7[d]].length);const c=e.polyData.getPoints().getData(),l=new Float64Array(s*3);let f=0,u=0,g=0;for(let d=0;d<6;d++)if(r[d])for(let h=0;h<4;h++){const p=H7[d][h];if(i[p]===1){const m=K7[p],v=C1[p][0]*3,y=C1[p][1]*3;l[f*3]=.5*(c[v]+c[y]),l[f*3+1]=.5*(c[v+1]+c[y+1]),l[f*3+2]=.5*(c[v+2]+c[y+2]),f++;const T=Math.floor(d/2);l[f*3+T]=e.dataBounds[d],l[f*3+cn[d][0]]=.5*(e.dataBounds[cn[d][0]*2]+e.dataBounds[cn[d][0]*2+1]),l[f*3+cn[d][1]]=.5*(e.dataBounds[cn[d][1]*2]+e.dataBounds[cn[d][1]*2+1]),f++,e.textValues[u]=e.axisLabels[m],u++;const C=(m+1)%3,w=(m+2)%3,x=a[m],O=o[m];e.tickCounts[g]=x.length;for(let M=0;M<x.length;M++)l[f*3+m]=x[M],l[f*3+C]=c[v+C],l[f*3+w]=c[v+w],f++,e.textValues[u]=O[M],u++;g++}}e.textPolyData.getPoints().setData(l,3),e.textPolyData.modified()},t.update=()=>{if(!e.camera)return;const r=t.computeFacesToDraw(),i=e.lastFacesToDraw;let a=!1;for(let o=0;o<6;o++)e.dataBounds[o]!==e.lastTickBounds[o]&&(a=!0,e.lastTickBounds[o]=e.dataBounds[o]);if(r||a||e.forceUpdate){const o=new Array(12).fill(0);for(let c=0;c<6;c++)if(i[c])for(let l=0;l<4;l++)o[H7[c][l]]++;const s=e.generateTicks(e.dataBounds);t.updatePolyData(i,o,s.ticks),t.updateTextData(i,o,s.ticks,s.tickStrings),(a||e.forceUpdate)&&t.updateTextureAtlas(s.tickStrings)}e.forceUpdate=!1},t.updateTextureAtlas=r=>{e.tmContext.textBaseline="bottom",e.tmContext.textAlign="left",e._tmAtlas.clear();let i=0,a=1;for(let o=0;o<3;o++){if(!e._tmAtlas.has(e.axisLabels[o])){Y5(e.tmContext,e.axisTextStyle);const s=e.tmContext.measureText(e.axisLabels[o]),c={height:s.actualBoundingBoxAscent+2,startingHeight:a,width:s.width+2,textStyle:e.axisTextStyle};e._tmAtlas.set(e.axisLabels[o],c),a+=c.height,i<c.width&&(i=c.width)}Y5(e.tmContext,e.tickTextStyle);for(let s=0;s<r[o].length;s++)if(!e._tmAtlas.has(r[o][s])){const c=e.tmContext.measureText(r[o][s]),l={height:c.actualBoundingBoxAscent+2,startingHeight:a,width:c.width+2,textStyle:e.tickTextStyle};e._tmAtlas.set(r[o][s],l),a+=l.height,i<l.width&&(i=l.width)}}i=ua(i),a=ua(a),e._tmAtlas.forEach(o=>{o.tcoords=[0,(a-o.startingHeight-o.height)/a,o.width/i,(a-o.startingHeight-o.height)/a,o.width/i,(a-o.startingHeight)/a,0,(a-o.startingHeight)/a]}),e.tmCanvas.width=i,e.tmCanvas.height=a,e.tmContext.textBaseline="bottom",e.tmContext.textAlign="left",e.tmContext.clearRect(0,0,i,a),e._tmAtlas.forEach((o,s)=>{Y5(e.tmContext,o.textStyle),e.tmContext.fillText(s,1,o.startingHeight+o.height-1)}),e.tmTexture.setCanvas(e.tmCanvas),e.tmTexture.modified()},t.onModified(()=>{e.forceUpdate=!0,t.update()}),t.setTickTextStyle=r=>{e.tickTextStyle={...e.tickTextStyle,...r},t.modified()},t.setAxisTextStyle=r=>{e.axisTextStyle={...e.axisTextStyle,...r},t.modified()},t.get_tmAtlas=()=>e._tmAtlas,t.getBounds=()=>(t.update(),Nt.setBounds(e.bounds,e.gridActor.getBounds()),Nt.scaleAboutCenter(e.bounds,e.boundsScaleFactor,e.boundsScaleFactor,e.boundsScaleFactor),e.bounds);const n=P.chain(t.setProperty,e.gridActor.setProperty);t.setProperty=r=>n(r)[0]}function uJ(t,e,n){return{boundsScaleFactor:1.3,camera:null,dataBounds:[...Nt.INIT_BOUNDS],faceVisibilityAngle:8,gridLines:!0,axisLabels:null,axisTitlePixelOffset:35,tickLabelPixelOffset:12,generateTicks:EM,...n,axisTextStyle:{fontColor:"white",fontStyle:"normal",fontSize:18,fontFamily:"serif",...n==null?void 0:n.axisTextStyle},tickTextStyle:{fontColor:"white",fontStyle:"normal",fontSize:14,fontFamily:"serif",...n==null?void 0:n.tickTextStyle}}}function OM(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};tl.extend(t,e,uJ(t,e,n)),e.lastFacesToDraw=[!1,!1,!1,!1,!1,!1],e.axisLabels=["X-Axis","Y-Axis","Z-Axis"],e.tickCounts=[],e.textValues=[],e.lastTickBounds=[],e.tmCanvas=document.createElement("canvas"),e.tmContext=e.tmCanvas.getContext("2d"),e._tmAtlas=new Map,e.tmTexture=M2.newInstance({resizable:!0}),e.tmTexture.setInterpolate(!1),t.getProperty().setDiffuse(0),t.getProperty().setAmbient(1),e.gridMapper=J0.newInstance(),e.polyData=Ii.newInstance(),e.gridMapper.setInputData(e.polyData),e.gridActor=tl.newInstance(),e.gridActor.setMapper(e.gridMapper),e.gridActor.setProperty(t.getProperty()),e.gridActor.setParentProp(t),e.textPolyData=Ii.newInstance(),P.setGet(t,e,["axisTitlePixelOffset","boundsScaleFactor","faceVisibilityAngle","gridLines","tickLabelPixelOffset","generateTicks"]),P.setGetArray(t,e,["dataBounds"],6),P.setGetArray(t,e,["axisLabels"],3),P.get(t,e,["axisTextStyle","tickTextStyle","camera","tmTexture","textValues","textPolyData","tickCounts","gridActor"]),lJ(t,e)}const fJ=P.newInstance(OM,"vtkCubeAxesActor");var DM={newInstance:fJ,extend:OM,newCubeAxesActorHelper:cJ,defaultGenerateTicks:EM};function gJ(t,e){e.classHierarchy.push("vtkOpenGLCubeAxesActor"),t.buildPass=n=>{n&&(e._openGLRenderer=t.getFirstAncestorOfType("vtkOpenGLRenderer"),e._openGLRenderWindow=e._openGLRenderer.getParent(),e.CubeAxesActorHelper.getRenderable()||e.CubeAxesActorHelper.setRenderable(e.renderable),t.prepareNodes(),t.addMissingNode(e.CubeAxesActorHelper.getTmActor()),t.addMissingNode(e.renderable.getGridActor()),t.removeUnusedNodes())},t.opaquePass=(n,r)=>{if(n){const i=e._openGLRenderer?e._openGLRenderer.getRenderable().getActiveCamera():null,a=e._openGLRenderer.getTiledSizeAndOrigin();e.CubeAxesActorHelper.updateAPISpecificData([a.usize,a.vsize],i,e._openGLRenderWindow.getRenderable())}}}const dJ={};function pJ(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,dJ,n),Bt.extend(t,e,n),e.CubeAxesActorHelper=DM.newCubeAxesActorHelper(),gJ(t,e)}const hJ=Rt(pJ,"vtkOpenGLCubeAxesActor");Wn("vtkCubeAxesActor",hJ);const{ColorMode:mJ,ScalarMode:m0,GetArray:Z5}=y2;function vJ(t,e){e.classHierarchy.push("vtkMapper2D"),t.createDefaultLookupTable=()=>{e.lookupTable=gh.newInstance()},t.getColorModeAsString=()=>P.enumToString(mJ,e.colorMode),t.setColorModeToDefault=()=>t.setColorMode(0),t.setColorModeToMapScalars=()=>t.setColorMode(1),t.setColorModeToDirectScalars=()=>t.setColorMode(2),t.getScalarModeAsString=()=>P.enumToString(m0,e.scalarMode),t.setScalarModeToDefault=()=>t.setScalarMode(0),t.setScalarModeToUsePointData=()=>t.setScalarMode(1),t.setScalarModeToUseCellData=()=>t.setScalarMode(2),t.setScalarModeToUsePointFieldData=()=>t.setScalarMode(3),t.setScalarModeToUseCellFieldData=()=>t.setScalarMode(4),t.setScalarModeToUseFieldData=()=>t.setScalarMode(5),t.getAbstractScalars=(n,r,i,a,o)=>{if(!n||!e.scalarVisibility)return{scalars:null,cellFLag:!1};let s=null,c=!1;if(r===m0.DEFAULT)s=n.getPointData().getScalars(),s||(s=n.getCellData().getScalars(),c=!0);else if(r===m0.USE_POINT_DATA)s=n.getPointData().getScalars();else if(r===m0.USE_CELL_DATA)s=n.getCellData().getScalars(),c=!0;else if(r===m0.USE_POINT_FIELD_DATA){const l=n.getPointData();i===Z5.BY_ID?s=l.getArrayByIndex(a):s=l.getArrayByName(o)}else if(r===m0.USE_CELL_FIELD_DATA){const l=n.getCellData();c=!0,i===Z5.BY_ID?s=l.getArrayByIndex(a):s=l.getArrayByName(o)}else if(r===m0.USE_FIELD_DATA){const l=n.getFieldData();i===Z5.BY_ID?s=l.getArrayByIndex(a):s=l.getArrayByName(o)}return{scalars:s,cellFlag:c}},t.getLookupTable=()=>(e.lookupTable||t.createDefaultLookupTable(),e.lookupTable),t.getMTime=()=>{let n=e.mtime;if(e.lookupTable!==null){const r=e.lookupTable.getMTime();n=r>n?r:n}return n},t.mapScalars=(n,r)=>{const i=t.getAbstractScalars(n,e.scalarMode,e.arrayAccessMode,e.arrayId,e.colorByArrayName).scalars;if(!i){e.colorMapColors=null;return}const a=`${t.getMTime()}${i.getMTime()}${r}`;if(e.colorBuildString===a)return;e.useLookupTableScalarRange||t.getLookupTable().setRange(e.scalarRange[0],e.scalarRange[1]);const o=t.getLookupTable();o&&(o.build(),e.colorMapColors=o.mapScalars(i,e.colorMode,e.fieldDataTupleId)),e.colorBuildString=`${t.getMTime()}${i.getMTime()}${r}`},t.getPrimitiveCount=()=>{const n=t.getInputData();return{points:n.getPoints().getNumberOfValues()/3,verts:n.getVerts().getNumberOfValues()-n.getVerts().getNumberOfCells(),lines:n.getLines().getNumberOfValues()-2*n.getLines().getNumberOfCells(),triangles:n.getPolys().getNumberOfValues()-3*n.getPolys().getNumberOfCells()}}}const yJ={static:!1,lookupTable:null,scalarVisibility:!1,scalarRange:[0,1],useLookupTableScalarRange:!1,colorMode:0,scalarMode:0,arrayAccessMode:1,renderTime:0,colorByArrayName:null,transformCoordinate:null,viewSpecificProperties:null,customShaderAttributes:[]};function TJ(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,yJ,n),QE.extend(t,e,n),P.get(t,e,["colorMapColors"]),P.setGet(t,e,["arrayAccessMode","colorByArrayName","colorMode","lookupTable","renderTime","scalarMode","scalarVisibility","static","transformCoordinate","useLookupTableScalarRange","viewSpecificProperties","customShaderAttributes"]),P.setGetArray(t,e,["scalarRange"],2),e.viewSpecificProperties||(e.viewSpecificProperties={}),vJ(t,e)}P.newInstance(TJ,"vtkMapper2D");var CJ={},wJ=`//VTK::System::Dec

/*=========================================================================

  Program:   Visualization Toolkit
  Module:    vtkPolyData2DFS.glsl

  Copyright (c) Ken Martin, Will Schroeder, Bill Lorensen
  All rights reserved.
  See Copyright.txt or http://www.kitware.com/Copyright.htm for details.

     This software is distributed WITHOUT ANY WARRANTY; without even
     the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR
     PURPOSE.  See the above copyright notice for more information.

=========================================================================*/

uniform int PrimitiveIDOffset;

// Texture coordinates
//VTK::TCoord::Dec

// Scalar coloring
//VTK::Color::Dec

// Depth Peeling
//VTK::DepthPeeling::Dec

// picking support
//VTK::Picking::Dec

// the output of this shader
//VTK::Output::Dec

// Apple Bug
//VTK::PrimID::Dec

void main()
{
  // Apple Bug
  //VTK::PrimID::Impl

  //VTK::Color::Impl
  //VTK::TCoord::Impl

  //VTK::DepthPeeling::Impl
  //VTK::Picking::Impl

  if (gl_FragData[0].a <= 0.0)
    {
    discard;
    }
}
`,xJ=`//VTK::System::Dec

/*=========================================================================

  Program:   Visualization Toolkit
  Module:    vtkPolyData2DVS.glsl

  Copyright (c) Ken Martin, Will Schroeder, Bill Lorensen
  All rights reserved.
  See Copyright.txt or http://www.kitware.com/Copyright.htm for details.

     This software is distributed WITHOUT ANY WARRANTY; without even
     the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR
     PURPOSE.  See the above copyright notice for more information.

=========================================================================*/

// all variables that represent positions or directions have a suffix
// indicating the coordinate system they are in. The possible values are
// MC - Model Coordinates
// WC - WC world coordinates
// VC - View Coordinates
// DC - Display Coordinates

in vec4 vertexWC;

// frag position in VC
//VTK::PositionVC::Dec

// material property values
//VTK::Color::Dec

// Texture coordinates
//VTK::TCoord::Dec

// Apple Bug
//VTK::PrimID::Dec

uniform mat4 WCVCMatrix;  // World to view matrix

void main()
{
  // Apple Bug
  //VTK::PrimID::Impl

  gl_Position = WCVCMatrix*vertexWC;

  //VTK::TCoord::Impl

  //VTK::Color::Impl

  //VTK::PositionVC::Impl
}
`;const RM={BACKGROUND:0,FOREGROUND:1};var MM={DisplayLocation:RM};const{primTypes:Ia}=Oo,{ScalarMode:S1}=CJ,{vtkErrorMacro:E1}=Ir,SJ={type:"StartEvent"},EJ={type:"EndEvent"};function OJ(t,e){e.classHierarchy.push("vtkOpenGLPolyDataMapper2D"),t.buildPass=r=>{r&&(e.openGLActor2D=t.getFirstAncestorOfType("vtkOpenGLActor2D"),e._openGLRenderer=e.openGLActor2D.getFirstAncestorOfType("vtkOpenGLRenderer"),e._openGLRenderWindow=e._openGLRenderer.getLastAncestorOfType("vtkOpenGLRenderWindow"),e.openGLCamera=e._openGLRenderer.getViewNodeFor(e._openGLRenderer.getRenderable().getActiveCamera()))},t.overlayPass=r=>{r&&t.render()},t.getShaderTemplate=(r,i,a)=>{r.Vertex=xJ,r.Fragment=wJ,r.Geometry=""},t.render=()=>{const r=e._openGLRenderWindow.getContext();if(e.context!==r){e.context=r;for(let o=Ia.Start;o<Ia.End;o++)e.primitives[o].setOpenGLRenderWindow(e._openGLRenderWindow)}const i=e.openGLActor2D.getRenderable(),a=e._openGLRenderer.getRenderable();t.renderPiece(a,i)},t.renderPiece=(r,i)=>{if(t.invokeEvent(SJ),e.renderable.getStatic()||e.renderable.update(),e.currentInput=e.renderable.getInputData(),t.invokeEvent(EJ),!e.currentInput){E1("No input!");return}!e.currentInput.getPoints||!e.currentInput.getPoints().getNumberOfValues()||(t.renderPieceStart(r,i),t.renderPieceDraw(r,i),t.renderPieceFinish(r,i))},t.renderPieceStart=(r,i)=>{if(e.primitiveIDOffset=0,e._openGLRenderer.getSelector())switch(e._openGLRenderer.getSelector().getCurrentPass()){default:e._openGLRenderer.getSelector().renderProp(i)}t.updateBufferObjects(r,i),e.lastBoundBO=null},t.getNeedToRebuildShaders=(r,i,a)=>r.getShaderSourceTime().getMTime()<e.renderable.getMTime()||r.getShaderSourceTime().getMTime()<e.currentInput.getMTime(),t.updateBufferObjects=(r,i)=>{t.getNeedToRebuildBufferObjects(r,i)&&t.buildBufferObjects(r,i)},t.getNeedToRebuildBufferObjects=(r,i)=>{const a=e.VBOBuildTime.getMTime();return!!(a<t.getMTime()||a<e._openGLRenderWindow.getMTime()||a<e.renderable.getMTime()||a<i.getMTime()||a<e.currentInput.getMTime()||e.renderable.getTransformCoordinate()&&a<r.getMTime())},t.buildBufferObjects=(r,i)=>{const a=e.currentInput;if(a===null)return;e.renderable.mapScalars(a,i.getProperty().getOpacity());const o=e.renderable.getColorMapColors();e.haveCellScalars=!1;const s=e.renderable.getScalarMode();e.renderable.getScalarVisibility()&&(s===S1.USE_CELL_DATA||s===S1.USE_CELL_FIELD_DATA||s===S1.USE_FIELD_DATA||!a.getPointData().getScalars())&&s!==S1.USE_POINT_FIELD_DATA&&o&&(e.haveCellScalars=!0);const c=i.getProperty().getRepresentation();let l=a.getPointData().getTCoords();e.openGLActor2D.getActiveTextures()||(l=null);const f=e.renderable.getTransformCoordinate(),g=r.getRenderWindow().getViews()[0].getViewportSize(r),d=`${a.getMTime()}A${c}B${a.getMTime()}C${o?o.getMTime():1}D${l?l.getMTime():1}E${f?r.getMTime():1}F${g}`;if(e.VBOBuildString!==d){let h=a.getPoints();if(f){const m=yh.newInstance(),v=h.getNumberOfPoints();m.setNumberOfPoints(v);const y=[];for(let T=0;T<v;++T){h.getPoint(T,y),f.setValue(y);const C=f.getComputedDoubleViewportValue(r);m.setPoint(T,C[0],C[1],0)}h=m}const p={points:h,tcoords:l,colors:o,cellOffset:0,haveCellScalars:e.haveCellSCalars,customAttributes:e.renderable.getCustomShaderAttributes().map(m=>a.getPointData().getArrayByName(m))};p.cellOffset+=e.primitives[Ia.Points].getCABO().createVBO(a.getVerts(),"verts",c,p),p.cellOffset+=e.primitives[Ia.Lines].getCABO().createVBO(a.getLines(),"lines",c,p),p.cellOffset+=e.primitives[Ia.Tris].getCABO().createVBO(a.getPolys(),"polys",c,p),p.cellOffset+=e.primitives[Ia.TriStrips].getCABO().createVBO(a.getStrips(),"strips",c,p),e.VBOBuildTime.modified(),e.VBOBuildString=d}},t.renderPieceDraw=(r,i)=>{const a=i.getProperty().getRepresentation();e.context.depthMask(!0);for(let s=Ia.Start;s<Ia.End;s++)e.primitives[s].getCABO().getElementCount()&&(e.lastBoundBO=e.primitives[s],e.primitiveIDOffset+=e.primitives[s].drawArrays(r,i,a,t))},t.renderPieceFinish=(r,i)=>{e.lastBoundBO&&e.lastBoundBO.getVAO().release()},t.replaceShaderValues=(r,i,a)=>{t.replaceShaderColor(r,i,a),t.replaceShaderTCoord(r,i,a),t.replaceShaderPicking(r,i,a),t.replaceShaderPositionVC(r,i,a)},t.replaceShaderColor=(r,i,a)=>{let o=r.Vertex,s=r.Geometry,c=r.Fragment;e.haveCellScalars&&(c=te.substitute(c,"//VTK::Color::Dec",["uniform samplerBuffer texture1;"]).result,c=te.substitute(c,"//VTK::Color::Impl",["gl_FragData[0] = texelFetchBuffer(texture1, gl_PrimitiveID + PrimitiveIDOffset);"]).result),e.lastBoundBO.getCABO().getColorComponents()!==0?(o=te.substitute(o,"//VTK::Color::Dec",["in vec4 diffuseColor;","out vec4 fcolorVSOutput;"]).result,o=te.substitute(o,"//VTK::Color::Impl",["fcolorVSOutput = diffuseColor;"]).result,s=te.substitute(s,"//VTK::Color::Dec",[`in vec4 fcolorVSOutput[];
`,"out vec4 fcolorGSOutput;"]).result,s=te.substitute(s,"//VTK::Color::Impl",["fcolorGSOutput = fcolorVSOutput[i];"]).result,c=te.substitute(c,"//VTK::Color::Dec",["in vec4 fcolorVSOutput;"]).result,c=te.substitute(c,"//VTK::Color::Impl",["gl_FragData[0] = fcolorVSOutput;"]).result):(c=te.substitute(c,"//VTK::Color::Dec",["uniform vec4 diffuseColor;"]).result,c=te.substitute(c,"//VTK::Color::Impl",["gl_FragData[0] = diffuseColor;"]).result),r.Vertex=o,r.Geometry=s,r.Fragment=c},t.replaceShaderTCoord=(r,i,a)=>{if(e.lastBoundBO.getCABO().getTCoordOffset()){let o=r.Vertex,s=r.Geometry,c=r.Fragment;const l=e.lastBoundBO.getCABO().getTCoordComponents();l===1?(o=te.substitute(o,"//VTK::TCoord::Dec",["in float tcoordMC;","out float tcoordVCVSOutput;"]).result,o=te.substitute(o,"//VTK::TCoord::Impl",["tcoordVCVSOutput = tcoordMC;"]).result,s=te.substitute(s,"//VTK::TCoord::Dec",[`in float tcoordVCVSOutput[];
`,"out float tcoordVCGSOutput;"]).result,s=te.substitute(s,["//VTK::TCoord::Impl","tcoordVCGSOutput = tcoordVCVSOutput[i];"]).result,c=te.substitute(c,"//VTK::TCoord::Dec",["in float tcoordVCVSOutput;","uniform sampler2D texture1;"]).result,c=te.substitute(c,"//VTK::TCoord::Impl",["gl_FragData[0] = gl_FragData[0]*texture2D(texture1, vec2(tcoordVCVSOutput,0));"]).result):l===2&&(o=te.substitute(o,"//VTK::TCoord::Dec",["in vec2 tcoordMC;","out vec2 tcoordVCVSOutput;"]).result,o=te.substitute(o,"//VTK::TCoord::Impl",["tcoordVCVSOutput = tcoordMC;"]).result,s=te.substitute(s,"//VTK::TCoord::Dec",[`in vec2 tcoordVCVSOutput[];
`,"out vec2 tcoordVCGSOutput;"]).result,s=te.substitute(s,"//VTK::TCoord::Impl",["tcoordVCGSOutput = tcoordVCVSOutput[i];"]).result,c=te.substitute(c,"//VTK::TCoord::Dec",["in vec2 tcoordVCVSOutput;","uniform sampler2D texture1;"]).result,c=te.substitute(c,"//VTK::TCoord::Impl",["gl_FragData[0] = gl_FragData[0]*texture2D(texture1, tcoordVCVSOutput.st);"]).result),e.haveCellScalars&&(s=te.substitute(s,"//VTK::PrimID::Impl",["gl_PrimitiveID = gl_PrimitiveIDIn;"]).result),r.Vertex=o,r.Geometry=s,r.Fragment=c}},t.replaceShaderPicking=(r,i,a)=>{let o=r.Fragment;o=te.substitute(o,"//VTK::Picking::Dec",["uniform vec3 mapperIndex;","uniform int picking;"]).result,o=te.substitute(o,"//VTK::Picking::Impl","  gl_FragData[0] = picking != 0 ? vec4(mapperIndex,1.0) : gl_FragData[0];").result,r.Fragment=o},t.replaceShaderPositionVC=(r,i,a)=>{e.lastBoundBO.replaceShaderPositionVC(r,i,a)},t.invokeShaderCallbacks=(r,i,a)=>{const o=e.renderable.getViewSpecificProperties().ShadersCallbacks;o&&o.forEach(s=>{s.callback(s.userData,r,i,a)})},t.setMapperShaderParameters=(r,i,a)=>{if(r.getProgram().isUniformUsed("PrimitiveIDOffset")&&r.getProgram().setUniformi("PrimitiveIDOffset",e.primitiveIDOffset),r.getProgram().isAttributeUsed("vertexWC")&&(r.getVAO().addAttributeArray(r.getProgram(),r.getCABO(),"vertexWC",r.getCABO().getVertexOffset(),r.getCABO().getStride(),e.context.FLOAT,3,!1)||E1("Error setting vertexWC in shader VAO.")),r.getCABO().getElementCount()&&(e.VBOBuildTime.getMTime()>r.getAttributeUpdateTime().getMTime()||r.getShaderSourceTime().getMTime()>r.getAttributeUpdateTime().getMTime())){e.renderable.getCustomShaderAttributes().forEach((c,l)=>{r.getProgram().isAttributeUsed(`${c}MC`)&&(r.getVAO().addAttributeArray(r.getProgram(),r.getCABO(),`${c}MC`,r.getCABO().getCustomData()[l].offset,r.getCABO().getStride(),e.context.FLOAT,r.getCABO().getCustomData()[l].components,!1)||E1(`Error setting ${c}MC in shader VAO.`))}),r.getProgram().isAttributeUsed("tcoordMC")&&r.getCABO().getTCoordOffset()?r.getVAO().addAttributeArray(r.getProgram(),r.getCABO(),"tcoordMC",r.getCABO().getTCoordOffset(),r.getCABO().getStride(),e.context.FLOAT,r.getCABO().getTCoordComponents(),!1)||E1("Error setting tcoordMC in shader VAO."):r.getVAO().removeAttributeArray("tcoordMC"),e.internalColorTexture&&r.getProgram().isUniformUsed("texture1")&&r.getProgram().setUniformi("texture1",e.internalColorTexture.getTextureUnit());const o=e.openGLActor2D.getActiveTextures();if(o)for(let c=0;c<o.length;++c){const f=o[c].getTextureUnit(),u=`texture${f+1}`;r.getProgram().isUniformUsed(u)&&r.getProgram().setUniformi(u,f)}r.setMapperShaderParameters(i,a,e._openGLRenderer.getTiledSizeAndOrigin());const s=e._openGLRenderer.getSelector();r.getProgram().setUniform3fArray("mapperIndex",s?s.getPropColorValue():[0,0,0]),r.getProgram().setUniformi("picking",s?s.getCurrentPass()+1:0)}},t.setPropertyShaderParameters=(r,i,a)=>{const o=e.renderable.getColorMapColors();if(!o||o.getNumberOfComponents()===0){const s=r.getProgram(),c=a.getProperty(),l=c.getOpacity(),f=c.getColor(),u=[f[0],f[1],f[2],l];s.setUniform4f("diffuseColor",u)}},t.setLightingShaderParameters=(r,i,a)=>{};function n(r,i,a){return i.identity(a),r.reduce((o,s,c)=>c===0?s?i.copy(o,s):i.identity(o):s?i.multiply(o,o,s):o,a)}t.setCameraShaderParameters=(r,i,a)=>{const o=r.getProgram(),c=r.getCABO().getCoordShiftAndScaleEnabled()?r.getCABO().getInverseShiftAndScaleMatrix():null,f=i.getRenderWindow().getViews()[0].getViewportSize(i),u=i.getViewport(),g=a.getActualPositionCoordinate().getComputedDoubleViewportValue(i),d=[0,0,1,1],h=[0,0,1,1];if(h[0]=u[0]>=d[0]?u[0]:d[0],h[1]=u[1]>=d[1]?u[1]:d[1],h[2]=u[2]<=d[2]?u[2]:d[2],h[3]=u[3]<=d[3]?u[3]:d[3],h[0]>=h[2]||h[1]>=h[3])return;f[0]=Nf(f[0]*(h[2]-h[0])/(u[2]-u[0])),f[1]=Nf(f[1]*(h[3]-h[1])/(u[3]-u[1]));const p=e._openGLRenderer.getParent().getSize(),m=Nf(g[0]-(h[0]-u[0])*p[0]),v=Nf(g[1]-(h[1]-u[1])*p[1]),y=-m;let T=-m+f[0];const C=-v;let w=-v+f[1];y===T&&(T=y+1),C===w&&(w=C+1);const x=Be(new Float64Array(16));x[0]=2/(T-y),x[1*4+1]=2/(w-C),x[0*4+3]=-1*(T+y)/(T-y),x[1*4+3]=-1*(w+C)/(w-C),x[2*4+2]=0,x[2*4+3]=a.getProperty().getDisplayLocation()===RM.FOREGROUND?-1:1,x[3*4+3]=1,ft(x,x),o.setUniformMatrix("WCVCMatrix",n([x,c],Bg,e.tmpMat4))},t.getAllocatedGPUMemoryInBytes=()=>{let r=0;return e.primitives.forEach(i=>{r+=i.getAllocatedGPUMemoryInBytes()}),r}}const DJ={context:null,VBOBuildTime:0,VBOBuildString:null,primitives:null,primTypes:null,shaderRebuildString:null};function RJ(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,DJ,n),Bt.extend(t,e,n),To.implementReplaceShaderCoincidentOffset(t,e,n),To.implementBuildShadersWithReplacements(t,e,n),e.primitives=[],e.primTypes=Ia,e.tmpMat4=Be(new Float64Array(16));for(let r=Ia.Start;r<Ia.End;r++)e.primitives[r]=Oo.newInstance(),e.primitives[r].setPrimitiveType(r),e.primitives[r].set({lastLightComplexity:0,lastLightCount:0,lastSelectionPass:!1},!0);Vn(t,e,["context"]),e.VBOBuildTime={},zt(e.VBOBuildTime,{mtime:0}),OJ(t,e)}const MJ=Rt(RJ,"vtkOpenGLPolyDataMapper2D");Wn("vtkMapper2D",MJ);const{VectorMode:_J}=T2;function Q5(t,e){t.strokeStyle=e.strokeColor,t.lineWidth=e.strokeSize,t.fillStyle=e.fontColor,t.font=`${e.fontStyle} ${e.fontSize}px ${e.fontFamily}`}function _M(t,e){return n=>{const r=n.getLastSize(),i=(r[0]/700)**.8,a=(r[1]/700)**.8,o=Math.min(i,a),s=n.getAxisTextStyle(),c=n.getTickTextStyle();Object.assign(s,e.axisTextStyle),Object.assign(c,e.tickTextStyle),s.fontSize=Math.max(24*o,12),n.getLastAspectRatio()>1?c.fontSize=Math.max(20*o,10):c.fontSize=Math.max(16*o,10);const l=n.updateTextureAtlas();n.setTopTitle(!1);const f=n.getBoxSizeByReference();if(n.getLastAspectRatio()>1)n.setTickLabelPixelOffset(.3*c.fontSize),l.titleWidth<=l.tickWidth+n.getTickLabelPixelOffset()+.8*c.fontSize?(n.setTopTitle(!0),n.setAxisTitlePixelOffset(.2*c.fontSize),f[0]=2*(l.tickWidth+n.getTickLabelPixelOffset()+.8*c.fontSize)/r[0],n.setBoxPosition([.98-f[0],-.92])):(n.setAxisTitlePixelOffset(.2*c.fontSize),f[0]=2*(l.titleHeight+n.getAxisTitlePixelOffset()+l.tickWidth+n.getTickLabelPixelOffset()+.8*c.fontSize)/r[0],n.setBoxPosition([.99-f[0],-.92])),f[1]=Math.max(1.2,Math.min(1.84/a,1.84));else{n.setAxisTitlePixelOffset(1.2*c.fontSize),n.setTickLabelPixelOffset(.1*c.fontSize);const u=2*(.8*c.fontSize+l.titleHeight+n.getAxisTitlePixelOffset())/r[1],g=2*l.tickWidth/r[0];f[0]=Math.min(1.9,Math.max(1.4,1.4*g*(n.getTicks().length+3))),f[1]=u,n.setBoxPosition([-.5*f[0],-.97])}n.recomputeBarSegments(l)}}function bM(t,e){return n=>{const r=n.getLastTickBounds(),i=Uy().domain([r[0],r[1]]),a=i.ticks(5),o=i.tickFormat(5);n.setTicks(a),n.setTickStrings(a.map(o))}}function bJ(t,e){e.classHierarchy.push("vtkScalarBarActorHelper"),t.setRenderable=i=>{e.renderable!==i&&(e.renderable=i,e.barActor.setProperty(i.getProperty()),e.barActor.setParentProp(i),e.barActor.setCoordinateSystemToDisplay(),e.tmActor.setProperty(i.getProperty()),e.tmActor.setParentProp(i),e.tmActor.setCoordinateSystemToDisplay(),e.generateTicks=i.generateTicks,e.axisTextStyle={...i.getAxisTextStyle()},e.tickTextStyle={...i.getTickTextStyle()},t.modified())},t.updateAPISpecificData=(i,a,o)=>{(e.lastSize[0]!==i[0]||e.lastSize[1]!==i[1])&&(e.lastSize[0]=i[0],e.lastSize[1]=i[1],e.lastAspectRatio=i[0]/i[1],e.forceUpdate=!0);const s=e.renderable.getScalarsToColors();if(!(!s||!e.renderable.getVisibility())&&(e.barMapper.setLookupTable(s),e.camera=a,e.renderWindow=o,e.forceUpdate||Math.max(s.getMTime(),t.getMTime(),e.renderable.getMTime())>e.lastRebuildTime.getMTime())){const c=s.getMappingRange();if(e.lastTickBounds=[...c],e.renderable.getGenerateTicks()(t),e.renderable.getAutomated())e.renderable.getAutoLayout()(t);else{e.axisTextStyle={...e.renderable.getAxisTextStyle()},e.tickTextStyle={...e.renderable.getTickTextStyle()},e.barPosition=[...e.renderable.getBarPosition()],e.barSize=[...e.renderable.getBarSize()],e.boxPosition=[...e.renderable.getBoxPosition()],e.boxSize=[...e.renderable.getBoxSize()],e.axisTitlePixelOffset=e.renderable.getAxisTitlePixelOffset(),e.tickLabelPixelOffset=e.renderable.getTickLabelPixelOffset();const l=t.updateTextureAtlas();t.recomputeBarSegments(l)}t.updatePolyDataForLabels(),t.updatePolyDataForBarSegments(),e.lastRebuildTime.modified(),e.forceUpdate=!1}},t.updateTextureAtlas=()=>{e.tmContext.textBaseline="bottom",e.tmContext.textAlign="left";const i={},a=new Map;let o=0,s=1;Q5(e.tmContext,e.axisTextStyle);let c=e.tmContext.measureText(e.renderable.getAxisLabel()),l={height:c.actualBoundingBoxAscent+2,startingHeight:s,width:c.width+2,textStyle:e.axisTextStyle};a.set(e.renderable.getAxisLabel(),l),s+=l.height,o=l.width,i.titleWidth=l.width,i.titleHeight=l.height,i.tickWidth=0,i.tickHeight=0,Q5(e.tmContext,e.tickTextStyle);const f=[...t.getTickStrings(),"NaN","Below","Above"];for(let u=0;u<f.length;u++)a.has(f[u])||(c=e.tmContext.measureText(f[u]),l={height:c.actualBoundingBoxAscent+2,startingHeight:s,width:c.width+2,textStyle:e.tickTextStyle},a.set(f[u],l),s+=l.height,o<l.width&&(o=l.width),i.tickWidth<l.width&&(i.tickWidth=l.width),i.tickHeight<l.height&&(i.tickHeight=l.height));return o=ua(o),s=ua(s),a.forEach(u=>{u.tcoords=[0,(s-u.startingHeight-u.height)/s,u.width/o,(s-u.startingHeight-u.height)/s,u.width/o,(s-u.startingHeight)/s,0,(s-u.startingHeight)/s]}),e.tmCanvas.width=o,e.tmCanvas.height=s,e.tmContext.textBaseline="bottom",e.tmContext.textAlign="left",e.tmContext.clearRect(0,0,o,s),a.forEach((u,g)=>{Q5(e.tmContext,u.textStyle),e.tmContext.fillText(g,1,u.startingHeight+u.height-1)}),e.tmTexture.setCanvas(e.tmCanvas),e.tmTexture.modified(),e._tmAtlas=a,i},t.computeBarSize=i=>{e.vertical=e.boxSize[1]>e.boxSize[0];const a=2*i.tickHeight/e.lastSize[1],o=[1,1];if(e.vertical){const s=2*(i.tickWidth+e.tickLabelPixelOffset)/e.lastSize[0];if(e.topTitle){const c=2*(i.titleHeight+e.axisTitlePixelOffset)/e.lastSize[1];e.barSize[0]=e.boxSize[0]-s,e.barSize[1]=e.boxSize[1]-c}else{const c=2*(i.titleHeight+e.axisTitlePixelOffset)/e.lastSize[0];e.barSize[0]=e.boxSize[0]-c-s,e.barSize[1]=e.boxSize[1]}e.barPosition[0]=e.boxPosition[0]+s,e.barPosition[1]=e.boxPosition[1],o[1]=a}else{const s=(2*i.tickWidth-8)/e.lastSize[0],c=2*(i.titleHeight+e.axisTitlePixelOffset)/e.lastSize[1];e.barSize[0]=e.boxSize[0],e.barPosition[0]=e.boxPosition[0],e.barSize[1]=e.boxSize[1]-c,e.barPosition[1]=e.boxPosition[1],o[0]=s}return o},t.recomputeBarSegments=i=>{var g,d,h,p;const a=t.computeBarSize(i);e.barSegments=[];const o=[0,0],s=e.vertical?1:0,c=e.vertical?.01:.02;function l(m,v){e.barSegments.push({corners:[[...o],[o[0]+a[0],o[1]],[o[0]+a[0],o[1]+a[1]],[o[0],o[1]+a[1]]],scalars:v,title:m}),o[s]+=a[s]+c}e.renderable.getDrawNanAnnotation()&&e.renderable.getScalarsToColors().getNanColor()&&l("NaN",[NaN,NaN,NaN,NaN]),e.renderable.getDrawBelowRangeSwatch()&&((d=(g=e.renderable.getScalarsToColors()).getUseBelowRangeColor)!=null&&d.call(g))&&l("Below",[-.1,-.1,-.1,-.1]);const f=(p=(h=e.renderable.getScalarsToColors()).getUseAboveRangeColor)==null?void 0:p.call(h);o[s]+=c;const u=a[s];a[s]=f?1-2*c-a[s]-o[s]:1-c-o[s],l("ticks",e.vertical?[0,0,.995,.995]:[0,.995,.995,0]),e.renderable.getDrawAboveRangeSwatch()&&f&&(a[s]=u,o[s]+=c,l("Above",[1.1,1.1,1.1,1.1]))};const n=new Float64Array(3);t.createPolyDataForOneLabel=(i,a,o,s,c,l)=>{const f=e._tmAtlas.get(i);if(!f)return;let u=l.ptIdx,g=l.cellIdx;n[0]=(.5*a[0]+.5)*e.lastSize[0],n[1]=(.5*a[1]+.5)*e.lastSize[1],n[2]=a[2],n[0]+=c[0],n[1]+=c[1];const d=[],h=s==="vertical"?[1,0]:[0,1];s==="vertical"?(d[0]=f.width,d[1]=-f.height,o[0]==="middle"?n[1]-=f.width/2:o[0]==="right"&&(n[1]-=f.width),o[1]==="middle"?n[0]+=f.height/2:o[1]==="top"&&(n[0]+=f.height)):(d[0]=f.width,d[1]=f.height,o[0]==="middle"?n[0]-=f.width/2:o[0]==="right"&&(n[0]-=f.width),o[1]==="middle"?n[1]-=f.height/2:o[1]==="top"&&(n[1]-=f.height)),l.points[u*3]=n[0],l.points[u*3+1]=n[1],l.points[u*3+2]=n[2],l.tcoords[u*2]=f.tcoords[0],l.tcoords[u*2+1]=f.tcoords[1],u++,n[h[0]]+=d[0],l.points[u*3]=n[0],l.points[u*3+1]=n[1],l.points[u*3+2]=n[2],l.tcoords[u*2]=f.tcoords[2],l.tcoords[u*2+1]=f.tcoords[3],u++,n[h[1]]+=d[1],l.points[u*3]=n[0],l.points[u*3+1]=n[1],l.points[u*3+2]=n[2],l.tcoords[u*2]=f.tcoords[4],l.tcoords[u*2+1]=f.tcoords[5],u++,n[h[0]]-=d[0],l.points[u*3]=n[0],l.points[u*3+1]=n[1],l.points[u*3+2]=n[2],l.tcoords[u*2]=f.tcoords[6],l.tcoords[u*2+1]=f.tcoords[7],u++,l.polys[g*4]=3,l.polys[g*4+1]=u-4,l.polys[g*4+2]=u-3,l.polys[g*4+3]=u-2,g++,l.polys[g*4]=3,l.polys[g*4+1]=u-4,l.polys[g*4+2]=u-2,l.polys[g*4+3]=u-1,l.ptIdx+=4,l.cellIdx+=2};const r=new Float64Array(3);t.updatePolyDataForLabels=()=>{const i=t.getTickStrings().length+e.barSegments.length,a=i*4,o=i*2,s=new Float64Array(a*3),c=new Uint16Array(o*4),l=new Float32Array(a*2),f={ptIdx:0,cellIdx:0,polys:c,points:s,tcoords:l},u=e.vertical?0:1,g=e.vertical?1:0;r[2]=-.99;const d=e.vertical?["right","middle"]:["middle","bottom"];let h=[0,1];const p=[0,0];e.vertical?(p[0]=-e.tickLabelPixelOffset,e.topTitle?(r[0]=e.boxPosition[0]+.5*e.boxSize[0],r[1]=e.barPosition[1]+e.barSize[1],t.createPolyDataForOneLabel(e.renderable.getAxisLabel(),r,["middle","bottom"],"horizontal",[0,e.axisTitlePixelOffset],f)):(r[0]=e.barPosition[0]+e.barSize[0],r[1]=e.barPosition[1]+.5*e.barSize[1],t.createPolyDataForOneLabel(e.renderable.getAxisLabel(),r,["middle","top"],"vertical",[e.axisTitlePixelOffset,0],f)),h=[-1,0]):(p[1]=e.tickLabelPixelOffset,r[0]=e.barPosition[0]+.5*e.barSize[0],r[1]=e.barPosition[1]+e.barSize[1],t.createPolyDataForOneLabel(e.renderable.getAxisLabel(),r,["middle","bottom"],"horizontal",[0,e.axisTitlePixelOffset],f)),r[u]=e.barPosition[u]+(.5*h[u]+.5)*e.barSize[u],r[g]=e.barPosition[g]+e.barSize[g]*.5;let m=null;for(let x=0;x<e.barSegments.length;x++){const O=e.barSegments[x];O.title==="ticks"?m=O:(r[g]=e.barPosition[g]+.5*e.barSize[g]*(O.corners[2][g]+O.corners[0][g]),t.createPolyDataForOneLabel(O.title,r,d,"horizontal",p,f))}const v=e.barPosition[g]+e.barSize[g]*m.corners[0][g],y=e.barSize[g]*(m.corners[2][g]-m.corners[0][g]),T=t.getTicks(),C=t.getTickStrings();for(let x=0;x<T.length;x++){const O=(T[x]-e.lastTickBounds[0])/(e.lastTickBounds[1]-e.lastTickBounds[0]);r[g]=v+y*O,t.createPolyDataForOneLabel(C[x],r,d,"horizontal",p,f)}const w=nt.newInstance({numberOfComponents:2,values:l,name:"TextureCoordinates"});e.tmPolyData.getPointData().setTCoords(w),e.tmPolyData.getPoints().setData(s,3),e.tmPolyData.getPoints().modified(),e.tmPolyData.getPolys().setData(c,1),e.tmPolyData.getPolys().modified(),e.tmPolyData.modified()},t.updatePolyDataForBarSegments=()=>{var p,m;const i=e.renderable.getScalarsToColors();let a=0;e.renderable.getDrawNanAnnotation()&&i.getNanColor()&&(a+=1),e.renderable.getDrawBelowRangeSwatch()&&((p=i.getUseBelowRangeColor)!=null&&p.call(i))&&(a+=1),e.renderable.getDrawAboveRangeSwatch()&&((m=i.getUseAboveRangeColor)!=null&&m.call(i))&&(a+=1);const o=4*(1+a),s=o;let c=1;i.getVectorMode()===_J.COMPONENT&&(c=i.getVectorComponent()+1);const l=new Float64Array(o*3),f=new Uint16Array(s*5),u=new Float32Array(o*c);let g=0,d=0;for(let v=0;v<e.barSegments.length;v++){const y=e.barSegments[v];for(let T=0;T<4;T++){r[0]=e.barPosition[0]+y.corners[T][0]*e.barSize[0],r[1]=e.barPosition[1]+y.corners[T][1]*e.barSize[1],l[g*3]=(.5*r[0]+.5)*e.lastSize[0],l[g*3+1]=(.5*r[1]+.5)*e.lastSize[1],l[g*3+2]=r[2];for(let C=0;C<c;C++)u[g*c+C]=e.lastTickBounds[0]+y.scalars[T]*(e.lastTickBounds[1]-e.lastTickBounds[0]);g++}f[d*5]=4,f[d*5+1]=g-4,f[d*5+2]=g-3,f[d*5+3]=g-2,f[d*5+4]=g-1,d++}const h=nt.newInstance({numberOfComponents:c,values:u,name:"Scalars"});e.polyData.getPointData().setScalars(h),e.polyData.getPoints().setData(l,3),e.polyData.getPoints().modified(),e.polyData.getPolys().setData(f,1),e.polyData.getPolys().modified(),e.polyData.modified()}}const LJ=P.newInstance(function(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{renderable:null};Object.assign(e,{},n),P.obj(t,e),P.setGet(t,e,["axisTitlePixelOffset","tickLabelPixelOffset","renderable","topTitle","ticks","tickStrings"]),P.get(t,e,["lastSize","lastAspectRatio","lastTickBounds","axisTextStyle","tickTextStyle","barActor","tmActor"]),P.getArray(t,e,["boxPosition","boxSize"]),P.setArray(t,e,["boxPosition","boxSize"],2),e.forceUpdate=!1,e.lastRebuildTime={},P.obj(e.lastRebuildTime,{mtime:0}),e.lastSize=[-1,-1],e.tmCanvas=document.createElement("canvas"),e.tmContext=e.tmCanvas.getContext("2d"),e._tmAtlas=new Map,e.barMapper=J0.newInstance(),e.barMapper.setInterpolateScalarsBeforeMapping(!0),e.barMapper.setUseLookupTableScalarRange(!0),e.polyData=Ii.newInstance(),e.barMapper.setInputData(e.polyData),e.barActor=tl.newInstance(),e.barActor.setMapper(e.barMapper),e.tmPolyData=Ii.newInstance(),e.tmMapper=J0.newInstance(),e.tmMapper.setInputData(e.tmPolyData),e.tmTexture=M2.newInstance({resizable:!0}),e.tmTexture.setInterpolate(!1),e.tmActor=tl.newInstance({parentProp:t}),e.tmActor.setMapper(e.tmMapper),e.tmActor.addTexture(e.tmTexture),e.barPosition=[0,0],e.barSize=[0,0],e.boxPosition=[.88,-.92],e.boxSize=[.1,1.1],e.lastTickBounds=[],bJ(t,e)},"vtkScalarBarActorHelper");function IJ(t,e){e.classHierarchy.push("vtkScalarBarActor"),t.setTickTextStyle=n=>{e.tickTextStyle={...e.tickTextStyle,...n},t.modified()},t.setAxisTextStyle=n=>{e.axisTextStyle={...e.axisTextStyle,...n},t.modified()},t.resetAutoLayoutToDefault=()=>{t.setAutoLayout(_M(t,e))},t.resetGenerateTicksToDefault=()=>{t.setGenerateTicks(bM())}}function VJ(t){return{automated:!0,autoLayout:null,axisLabel:"Scalar Value",barPosition:[0,0],barSize:[0,0],boxPosition:[.88,-.92],boxSize:[.1,1.1],scalarToColors:null,axisTitlePixelOffset:36,axisTextStyle:{fontColor:"white",fontStyle:"normal",fontSize:18,fontFamily:"serif"},tickLabelPixelOffset:14,tickTextStyle:{fontColor:"white",fontStyle:"normal",fontSize:14,fontFamily:"serif"},generateTicks:null,drawNanAnnotation:!0,drawBelowRangeSwatch:!0,drawAboveRangeSwatch:!0,...t}}function LM(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,VJ(n)),e.autoLayout||(e.autoLayout=_M(t,e)),e.generateTicks||(e.generateTicks=bM()),tl.extend(t,e,n),t.getProperty().setDiffuse(0),t.getProperty().setAmbient(1),P.setGet(t,e,["automated","autoLayout","axisTitlePixelOffset","axisLabel","scalarsToColors","tickLabelPixelOffset","generateTicks","drawNanAnnotation","drawBelowRangeSwatch","drawAboveRangeSwatch"]),P.get(t,e,["axisTextStyle","tickTextStyle"]),P.getArray(t,e,["barPosition","barSize","boxPosition","boxSize"]),P.setArray(t,e,["barPosition","barSize","boxPosition","boxSize"],2),IJ(t,e)}const PJ=P.newInstance(LM,"vtkScalarBarActor");var IM={newInstance:PJ,extend:LM,newScalarBarActorHelper:LJ};function NJ(t,e){e.classHierarchy.push("vtkOpenGLScalarBarActor"),t.buildPass=n=>{n&&(e._openGLRenderer=t.getFirstAncestorOfType("vtkOpenGLRenderer"),e._openGLRenderWindow=e._openGLRenderer.getParent(),e.scalarBarActorHelper.getRenderable()||e.scalarBarActorHelper.setRenderable(e.renderable),t.prepareNodes(),t.addMissingNode(e.scalarBarActorHelper.getBarActor()),t.addMissingNode(e.scalarBarActorHelper.getTmActor()),t.removeUnusedNodes())},t.opaquePass=(n,r)=>{if(n){const i=e._openGLRenderer?e._openGLRenderer.getRenderable().getActiveCamera():null,a=e._openGLRenderer.getTiledSizeAndOrigin();e.scalarBarActorHelper.updateAPISpecificData([a.usize,a.vsize],i,e._openGLRenderWindow.getRenderable())}}}const kJ={};function AJ(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,kJ,n),Bt.extend(t,e,n),e.scalarBarActorHelper=IM.newScalarBarActorHelper(),NJ(t,e)}const FJ=Rt(AJ,"vtkOpenGLScalarBarActor");Wn("vtkScalarBarActor",FJ);const{CoordinateSystem:q7}=vd;function UJ(t,e){e.classHierarchy.push("vtkWebGPUActor"),t.buildPass=n=>{n&&(e.WebGPURenderer=t.getFirstAncestorOfType("vtkWebGPURenderer"),e.WebGPURenderWindow=e.WebGPURenderer.getFirstAncestorOfType("vtkWebGPURenderWindow"),e.propID===void 0&&(e.propID=e.WebGPURenderWindow.getUniquePropID()),t.prepareNodes(),t.addMissingNode(e.renderable.getMapper()),t.removeUnusedNodes())},t.traverseOpaquePass=n=>{!e.renderable||!e.renderable.getNestedVisibility()||!e.renderable.getIsOpaque()||e.WebGPURenderer.getSelector()&&!e.renderable.getNestedPickable()||(t.apply(n,!0),e.children[0]&&e.children[0].traverse(n),t.apply(n,!1))},t.traverseTranslucentPass=n=>{!e.renderable||!e.renderable.getNestedVisibility()||e.renderable.getIsOpaque()||e.WebGPURenderer.getSelector()&&!e.renderable.getNestedPickable()||(t.apply(n,!0),e.children[0]&&e.children[0].traverse(n),t.apply(n,!1))},t.queryPass=(n,r)=>{if(n){if(!e.renderable||!e.renderable.getVisibility())return;e.renderable.getIsOpaque()?r.incrementOpaqueActorCount():r.incrementTranslucentActorCount()}},t.getBufferShift=n=>(t.getKeyMatrices(n),e.bufferShift),t.getKeyMatrices=n=>{if(Math.max(e.renderable.getMTime(),n.getStabilizedTime())>e.keyMatricesTime.getMTime()){e.renderable.computeMatrix();const r=e.renderable.getMatrix();e.bufferShift[0]=r[3],e.bufferShift[1]=r[7],e.bufferShift[2]=r[11];const i=n.getStabilizedCenterByReference();e.renderable.getCoordinateSystem()===q7.WORLD&&(e.bufferShift[0]-=i[0],e.bufferShift[1]-=i[1],e.bufferShift[2]-=i[2]),ft(e.keyMatrices.bcwc,r),e.renderable.getIsIdentity()?Be(e.keyMatrices.normalMatrix):(nn(e.keyMatrices.normalMatrix,e.keyMatrices.bcwc),e.keyMatrices.normalMatrix[3]=0,e.keyMatrices.normalMatrix[7]=0,e.keyMatrices.normalMatrix[11]=0,Ln(e.keyMatrices.normalMatrix,e.keyMatrices.normalMatrix),ft(e.keyMatrices.normalMatrix,e.keyMatrices.normalMatrix)),en(e.keyMatrices.bcwc,e.keyMatrices.bcwc,[-e.bufferShift[0],-e.bufferShift[1],-e.bufferShift[2]]),e.renderable.getCoordinateSystem()===q7.WORLD?en(e.keyMatrices.bcsc,e.keyMatrices.bcwc,[-i[0],-i[1],-i[2]]):nn(e.keyMatrices.bcsc,e.keyMatrices.bcwc),e.keyMatricesTime.modified()}return e.keyMatrices}}const BJ={keyMatricesTime:null,keyMatrices:null,propID:void 0,bufferShift:void 0};function GJ(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,BJ,n),Bt.extend(t,e,n),e.keyMatricesTime={},P.obj(e.keyMatricesTime,{mtime:0}),e.keyMatrices={normalMatrix:new Float64Array(16),bcwc:new Float64Array(16),bcsc:new Float64Array(16)},P.get(t,e,["propID","keyMatricesTime"]),e.bufferShift=[0,0,0,0],UJ(t,e)}const $J=P.newInstance(GJ);Ta("vtkActor",$J);const{CoordinateSystem:X7}=vd;function WJ(t,e){e.classHierarchy.push("vtkWebGPUActor2D"),t.buildPass=n=>{n&&(e.WebGPURenderer=t.getFirstAncestorOfType("vtkWebGPURenderer"),e.WebGPURenderWindow=e.WebGPURenderer.getFirstAncestorOfType("vtkWebGPURenderWindow"),e.propID===void 0&&(e.propID=e.WebGPURenderWindow.getUniquePropID()),t.prepareNodes(),t.addMissingNode(e.renderable.getMapper()),t.removeUnusedNodes())},t.traverseOpaquePass=n=>{!e.renderable||!e.renderable.getNestedVisibility()||!e.renderable.getIsOpaque()||e.WebGPURenderer.getSelector()&&!e.renderable.getNestedPickable()||(t.apply(n,!0),e.children[0]&&e.children[0].traverse(n),t.apply(n,!1))},t.traverseTranslucentPass=n=>{!e.renderable||!e.renderable.getNestedVisibility()||e.renderable.getIsOpaque()||e.WebGPURenderer.getSelector()&&!e.renderable.getNestedPickable()||(t.apply(n,!0),e.children[0]&&e.children[0].traverse(n),t.apply(n,!1))},t.queryPass=(n,r)=>{if(n){if(!e.renderable||!e.renderable.getVisibility())return;e.renderable.getIsOpaque()?r.incrementOpaqueActorCount():r.incrementTranslucentActorCount()}},t.getBufferShift=n=>(t.getKeyMatrices(n),e.bufferShift),t.getKeyMatrices=n=>{if(Math.max(e.renderable.getMTime(),n.getStabilizedTime())>e.keyMatricesTime.getMTime()){e.bufferShift[0]=0,e.bufferShift[1]=0,e.bufferShift[2]=0;const r=n.getStabilizedCenterByReference();e.renderable.getCoordinateSystem()===X7.WORLD&&(e.bufferShift[0]-=r[0],e.bufferShift[1]-=r[1],e.bufferShift[2]-=r[2]),Be(e.keyMatrices.bcwc),Be(e.keyMatrices.normalMatrix),en(e.keyMatrices.bcwc,e.keyMatrices.bcwc,[-e.bufferShift[0],-e.bufferShift[1],-e.bufferShift[2]]),e.renderable.getCoordinateSystem()===X7.WORLD?en(e.keyMatrices.bcsc,e.keyMatrices.bcwc,[-r[0],-r[1],-r[2]]):nn(e.keyMatrices.bcsc,e.keyMatrices.bcwc),e.keyMatricesTime.modified()}return e.keyMatrices}}const zJ={keyMatricesTime:null,keyMatrices:null,propID:void 0,bufferShift:void 0};function jJ(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,zJ,n),Bt.extend(t,e,n),e.keyMatricesTime={},P.obj(e.keyMatricesTime,{mtime:0}),e.keyMatrices={normalMatrix:new Float64Array(16),bcwc:new Float64Array(16),bcsc:new Float64Array(16)},P.get(t,e,["propID","keyMatricesTime"]),e.bufferShift=[0,0,0,0],WJ(t,e)}const HJ=P.newInstance(jJ);Ta("vtkActor2D",HJ);function KJ(t,e){e.classHierarchy.push("vtkWebGPUCubeAxesActor"),t.buildPass=n=>{n&&(e.WebGPURenderer=t.getFirstAncestorOfType("vtkWebGPURenderer"),e.WebGPURenderWindow=e.WebGPURenderer.getParent(),e.CubeAxesActorHelper.getRenderable()||e.CubeAxesActorHelper.setRenderable(e.renderable),t.prepareNodes(),t.addMissingNode(e.CubeAxesActorHelper.getTmActor()),t.addMissingNode(e.renderable.getGridActor()),t.removeUnusedNodes())},t.opaquePass=(n,r)=>{if(n){const i=e.WebGPURenderer?e.WebGPURenderer.getRenderable().getActiveCamera():null,a=e.WebGPURenderer.getTiledSizeAndOrigin();e.CubeAxesActorHelper.updateAPISpecificData([a.usize,a.vsize],i,e.WebGPURenderWindow.getRenderable())}}}const qJ={};function XJ(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,qJ,n),Bt.extend(t,e,n),e.CubeAxesActorHelper=DM.newCubeAxesActorHelper(),KJ(t,e)}const YJ=Rt(XJ,"vtkWebGPUCubeAxesActor");Ta("vtkCubeAxesActor",YJ);const{DisplayLocation:av}=MM;function ZJ(t,e){e.classHierarchy.push("vtkProperty2D"),t.setDisplayLocationToBackground=()=>t.setDisplayLocation(av.BACKGROUND),t.setDisplayLocationToForeground=()=>t.setDisplayLocation(av.FOREGROUND),t.setRepresentationToWireframe=()=>t.setRepresentation(_r.WIREFRAME),t.setRepresentationToSurface=()=>t.setRepresentation(_r.SURFACE),t.setRepresentationToPoints=()=>t.setRepresentation(_r.POINTS),t.getRepresentationAsString=()=>P.enumToString(_r,e.representation)}const QJ={color:[1,1,1],opacity:1,pointSize:1,lineWidth:1,representation:_r.SURFACE,displayLocation:av.FOREGROUND};function JJ(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,QJ,n),P.obj(t,e),P.setGet(t,e,["opacity","lineWidth","pointSize","displayLocation","representation"]),P.setGetArray(t,e,["color"],3),ZJ(t,e)}P.newInstance(JJ,"vtkProperty2D");var eee={...MM};const{BufferUsage:dr,PrimitiveTypes:ii}=Ju,{Representation:O1}=Yu,{ScalarMode:D1}=J0,{CoordinateSystem:tee}=vd,{DisplayLocation:nee}=eee,ree=`
//VTK::Renderer::Dec

//VTK::Color::Dec

//VTK::Normal::Dec

//VTK::TCoord::Dec

//VTK::Select::Dec

//VTK::Mapper::Dec

//VTK::IOStructs::Dec

@vertex
fn main(
//VTK::IOStructs::Input
)
//VTK::IOStructs::Output
{
  var output : vertexOutput;

  var vertex: vec4<f32> = vertexBC;

  //VTK::Color::Impl

  //VTK::Normal::Impl

  //VTK::TCoord::Impl

  //VTK::Select::Impl

  //VTK::Position::Impl

  return output;
}
`,iee=`
struct PBRData {
  diffuse: vec3<f32>,
  specular: vec3<f32>,
}

// Dot product with the max already in it
fn mdot(a: vec3<f32>, b: vec3<f32>) -> f32 {
  return max(0.0, dot(a, b));
}
// Dot product with a max in it that does not allow for negative values
// Physically based rendering is accurate as long as normals are accurate,
// however this is pretty often not the case. In order to prevent negative
// values from ruining light calculations and creating zones of zero light,
// this remapping is used, which smoothly clamps the dot product between
// zero and one while still maintaining a good amount of accuracy.
fn cdot(a: vec3<f32>, b: vec3<f32>) -> f32 {
  var d: f32 = max(0.0, dot(a, b));
  d = pow((d + 1.0) / 2.0, 2.6);
  return d;
}

// Lambertian diffuse model
fn lambertDiffuse(base: vec3<f32>, N: vec3<f32>, L: vec3<f32>) -> vec3<f32> {
  var pi: f32 = 3.14159265359; 
  var NdotL: f32 = mdot(N, L);
  NdotL = pow(NdotL, 1.5);
  return (base/pi)*NdotL;
}

// Yasuhiro Fujii improvement on the Oren-Nayar model
// https://mimosa-pudica.net/improved-oren-nayar.html
// p is surface color, o is roughness
fn fujiiOrenNayar(p: vec3<f32>, o: f32, N: vec3<f32>, L: vec3<f32>, V: vec3<f32>) -> vec3<f32> {
  var invpi: f32 = 0.31830988618; // 1/pi

  var o2 = o*o;
  var NdotL: f32 = mdot(N, L);
  NdotL = pow(NdotL, 1.5); // Less physically accurate, but hides the "seams" between lights better

  var NdotV: f32 = mdot(N, V);
  var LdotV: f32 = mdot(L, V);

  var s: f32 = LdotV - NdotL*NdotV;
  var t: f32 = mix(1.0, max(NdotL, NdotV), step(0.0, s)); // Mix with step is the equivalent of an if statement
  var A: vec3<f32> = 0.5*(o2 / (o2 + 0.33)) + 0.17*p*(o2 / (o2 + 0.13));
  A = invpi*(1 - A);
  var B: f32 = 0.45*(o2 / (o2 + 0.09));
  B = invpi*B;

  return p*NdotL*(A + B*(s/t));
}

// Fresnel portion of BRDF (IOR only, simplified)
fn schlickFresnelIOR(V: vec3<f32>, N: vec3<f32>, ior: f32, k: f32) -> f32 {
  var NdotV: f32 = mdot(V, N);
  var F0: f32 = (pow((ior - 1.0), 2.0) + k*k) / (pow((ior + 1.0), 2.0) + k*k); // This takes into account the roughness, which the other one does not
  return F0 + (1.0 - F0) * pow((1.0-NdotV), 5.0);
}

// Fresnel portion of BRDF (Color ior, better)
fn schlickFresnelRGB(V: vec3<f32>, N: vec3<f32>, F0: vec3<f32>) -> vec3<f32> {
  var NdotV: f32 = mdot(V, N);
  return F0 + (1.0 - F0) * pow((1-NdotV), 5.0);
}

// Normal portion of BRDF
// https://learnopengl.com/PBR/Theory
// Trowbridge-Reitz GGX functions: normal, halfway, roughness^2
fn trGGX(N: vec3<f32>, H: vec3<f32>, a: f32) -> f32 {
  var pi: f32 = 3.14159265359; 

  var a2: f32 = a*a;
  var NdotH = mdot(N, H);
  var NdotH2 = NdotH*NdotH;
  
  var denom: f32 = NdotH2 * (a2 - 1.0) + 1.0;

  return a2 / max((pi*denom*denom), 0.000001);
}

// A VERY bad approximation of anisotropy. Real anisotropic calculations require tangent and bitangent
fn anisotrophicTrGGX(N: vec3<f32>, H: vec3<f32>, O: vec3<f32>, s: f32, a: f32) -> f32 {
  var Op: vec3<f32> = (rendererUBO.WCVCNormals * vec4<f32>(normalize(O) * s, 0.)).xyz;

  var ggx1: f32 = trGGX(N + Op*s, H, a);
  var ggx2: f32 = trGGX(N - Op*s, H, a);
  return (0.5 * ggx1 + 0.5 * ggx2);
}

// Geometry portion of BRDF
fn schlickGGX(N: vec3<f32>, X: vec3<f32>, k: f32) -> f32 {
  var NdotX = cdot(N, X);
  return NdotX / max(0.000001, (NdotX*(1.0-k) + k));
}

fn smithSurfaceRoughness(N: vec3<f32>, V: vec3<f32>, L: vec3<f32>, k: f32) -> f32 {
  var ggx1: f32 = min(1.0, schlickGGX(N, V, k));
  var ggx2: f32 = min(1.0, schlickGGX(N, L, k));
  return ggx1*ggx2;
}

// BRDF Combination
fn cookTorrance(D: f32, F: f32, G: f32, N: vec3<f32>, V: vec3<f32>, L: vec3<f32>) -> f32 {
  var num: f32 = D*F*G;
  var denom: f32 = 4*cdot(V, N)*cdot(L, N);

  return num / max(denom, 0.000001);
}

// Different lighting calculations for different light sources
fn calcDirectionalLight(N: vec3<f32>, V: vec3<f32>, ior: f32, roughness: f32, metallic: f32, direction: vec3<f32>, color: vec3<f32>, base: vec3<f32>) -> PBRData {  
  var L: vec3<f32> = normalize(direction); // Light Vector
  var H: vec3<f32> = normalize(L + V); // Halfway Vector

  var alpha = roughness*roughness;
  var k: f32 = alpha*alpha / 2;

  var D: f32 = trGGX(N, H, alpha); // Distribution
  // var F: f32 = schlickFresnelIOR(V, N, ior, k); // Fresnel
  var G: f32 = smithSurfaceRoughness(N, V, L, k); // Geometry

  var brdf: f32 = cookTorrance(D, 1.0, G, N, V, L); // Fresnel term is replaced with 1 because it is added later
  var incoming: vec3<f32> = color;
  var angle: f32 = mdot(L, N);
  angle = pow(angle, 1.5);

  var specular: vec3<f32> = brdf*incoming*angle;
  // Oren-Nayar gives a clay-like effect when fully rough which some people may not want, so it might be better to give a separate
  // control property for the diffuse vs specular roughness
  var diffuse: vec3<f32> = incoming*fujiiOrenNayar(base, roughness, N, L, V); 
  // Stores the specular and diffuse separately to allow for finer post processing
  var out = PBRData(diffuse, specular);
  
  return out; // Returns angle along with color of light so the final color can be multiplied by angle as well (creates black areas)
}

// TODO: find some way to reduce the number of arguments going in here
fn calcPointLight(N: vec3<f32>, V: vec3<f32>, fragPos: vec3<f32>, ior: f32, roughness: f32, metallic: f32, position: vec3<f32>, color: vec3<f32>, base: vec3<f32>) -> PBRData {
  var L: vec3<f32> = normalize(position - fragPos); // Light Vector
  var H: vec3<f32> = normalize(L + V); // Halfway Vector
  var dist = distance(position, fragPos);

  var alpha = roughness*roughness;
  var k: f32 = alpha*alpha / 2.0; // could also be pow(alpha + 1.0, 2) / 8

  var D: f32 = trGGX(N, H, alpha); // Distribution
  // var F: f32 = schlickFresnelIOR(V, N, ior, k); // Fresnel
  var G: f32 = smithSurfaceRoughness(N, V, L, k); // Geometry

  var brdf: f32 = cookTorrance(D, 1.0, G, N, V, L);
  var incoming: vec3<f32> = color * (1.0 / (dist*dist));
  var angle: f32 = mdot(L, N);
  angle = pow(angle, 1.5); // Smoothing factor makes it less accurate, but reduces ugly "seams" bewteen light sources

  var specular: vec3<f32> = brdf*incoming*angle;
  var diffuse: vec3<f32> = incoming*fujiiOrenNayar(base, roughness, N, L, V);

  // Stores the specular and diffuse separately to allow for finer post processing
  // Could also be done (propably more properly) with a struct
  var out = PBRData(diffuse, specular);
  
  return out; // Returns angle along with color of light so the final color can be multiplied by angle as well (creates black areas)
}

// For a reason unknown to me, spheres dont seem to behave propperly with head-on spot lights
fn calcSpotLight(N: vec3<f32>, V: vec3<f32>, fragPos: vec3<f32>, ior: f32, roughness: f32, metallic: f32, position: vec3<f32>, direction: vec3<f32>, cones: vec2<f32>, color: vec3<f32>, base: vec3<f32>) -> PBRData {
  var L: vec3<f32> = normalize(position - fragPos);
  var H: vec3<f32> = normalize(L + V); // Halfway Vector
  var dist = distance(position, fragPos);

  var alpha = roughness*roughness;
  var k: f32 = alpha*alpha / 2.0; // could also be pow(alpha + 1.0, 2) / 8

  var D: f32 = trGGX(N, H, alpha); // Distribution
  // var F: f32 = schlickFresnelIOR(V, N, ior, k); // Fresnel
  var G: f32 = smithSurfaceRoughness(N, V, L, k); // Geometry

  var brdf: f32 = cookTorrance(D, 1.0, G, N, V, L);
  
  // Cones.x is the inner phi and cones.y is the outer phi
  var theta: f32 = mdot(normalize(direction), L);
  var epsilon: f32 = cones.x - cones.y;
  var intensity: f32 = (theta - cones.y) / epsilon;
  intensity = clamp(intensity, 0.0, 1.0);
  intensity /= dist*dist;

  var incoming: vec3<f32> = color * intensity;

  var angle: f32 = mdot(L, N);
  angle = pow(angle, 1.5); // Smoothing factor makes it less accurate, but reduces ugly "seams" bewteen light sources

  var specular: vec3<f32> = brdf*incoming*angle;
  var diffuse: vec3<f32> = incoming*fujiiOrenNayar(base, roughness, N, L, V);

  // Stores the specular and diffuse separately to allow for finer post processing
  // Could also be done (propably more properly) with a struct
  var out = PBRData(diffuse, specular);
  
  return out; // Returns angle along with color of light so the final color can be multiplied by angle as well (creates black areas)
}

// Environment mapping stuff
// Takes in a vector and converts it to an equivalent coordinate in a rectilinear texture. Should be replaced with cubemaps at some point
fn vecToRectCoord(dir: vec3<f32>) -> vec2<f32> {
  var tau: f32 = 6.28318530718;
  var pi: f32 = 3.14159265359;
  var out: vec2<f32> = vec2<f32>(0.0);

  out.x = atan2(dir.z, dir.x) / tau;
  out.x += 0.5;

  var phix: f32 = length(vec2(dir.x, dir.z));
  out.y = atan2(dir.y, phix) / pi + 0.5;

  return out;
}

//VTK::Renderer::Dec

//VTK::Color::Dec

//VTK::TCoord::Dec

// optional surface normal declaration
//VTK::Normal::Dec

//VTK::Select::Dec

//VTK::RenderEncoder::Dec

//VTK::Mapper::Dec

//VTK::IOStructs::Dec

@fragment
fn main(
//VTK::IOStructs::Input
)
//VTK::IOStructs::Output
{
  var output : fragmentOutput;

  // Temporary ambient, diffuse, and opacity
  var ambientColor: vec4<f32> = mapperUBO.AmbientColor;
  var diffuseColor: vec4<f32> = mapperUBO.DiffuseColor;
  var opacity: f32 = mapperUBO.Opacity;

  // This should be declared somewhere else
  var _diffuseMap: vec4<f32> = vec4<f32>(1.0);
  var _roughnessMap: vec4<f32> = vec4<f32>(1.0);
  var _metallicMap: vec4<f32> = vec4<f32>(1.0);
  var _normalMap: vec4<f32> = vec4<f32>(0.0, 0.0, 1.0, 0.0); // normal map was setting off the normal vector detection in fragment
  var _ambientOcclusionMap: vec4<f32> = vec4<f32>(1.);
  var _emissionMap: vec4<f32> = vec4<f32>(0.);

  //VTK::Color::Impl

  //VTK::TCoord::Impl

  //VTK::Normal::Impl

  var computedColor: vec4<f32> = vec4<f32>(diffuseColor.rgb, 1.0);

  //VTK::Light::Impl

  //VTK::Select::Impl

  if (computedColor.a == 0.0) { discard; };

  //VTK::Position::Impl

  //VTK::RenderEncoder::Impl

  return output;
}
`;function Y7(t){return t.indexOf("edge")>=0}function aee(t,e){e.classHierarchy.push("vtkWebGPUCellArrayMapper"),t.buildPass=n=>{n&&(e.is2D?(e.WebGPUActor=t.getFirstAncestorOfType("vtkWebGPUActor2D"),e.forceZValue=!0):(e.WebGPUActor=t.getFirstAncestorOfType("vtkWebGPUActor"),e.forceZValue=!1),e.coordinateSystem=e.WebGPUActor.getRenderable().getCoordinateSystem(),e.useRendererMatrix=e.coordinateSystem!==tee.DISPLAY,e.WebGPURenderer=e.WebGPUActor.getFirstAncestorOfType("vtkWebGPURenderer"),e.WebGPURenderWindow=e.WebGPURenderer.getParent(),e.device=e.WebGPURenderWindow.getDevice())},t.translucentPass=n=>{n&&(t.prepareToDraw(e.WebGPURenderer.getRenderEncoder()),e.renderEncoder.registerDrawCallback(e.pipeline,t.draw))},t.opaquePass=n=>{n&&(t.prepareToDraw(e.WebGPURenderer.getRenderEncoder()),e.renderEncoder.registerDrawCallback(e.pipeline,t.draw))},t.updateUBO=()=>{var a;const r=e.WebGPUActor.getRenderable().getProperty(),i=e.UBO.getSendTime();if(t.getMTime()>i||r.getMTime()>i||e.renderable.getMTime()>i){const o=e.WebGPUActor.getKeyMatrices(e.WebGPURenderer);if(e.UBO.setArray("BCWCMatrix",o.bcwc),e.UBO.setArray("BCSCMatrix",o.bcsc),e.UBO.setArray("MCWCNormals",o.normalMatrix),e.is2D){e.UBO.setValue("ZValue",e.WebGPUActor.getRenderable().getProperty().getDisplayLocation()===nee.FOREGROUND?1:0);const l=r.getColorByReference();e.UBO.setValue("AmbientIntensity",1),e.UBO.setArray("DiffuseColor",[l[0],l[1],l[2],1]),e.UBO.setValue("DiffuseIntensity",0),e.UBO.setValue("SpecularIntensity",0)}else{let l=r.getAmbientColorByReference();e.UBO.setValue("AmbientIntensity",r.getAmbient()),e.UBO.setArray("AmbientColor",[l[0],l[1],l[2],1]),e.UBO.setValue("DiffuseIntensity",r.getDiffuse()),l=r.getDiffuseColorByReference(),e.UBO.setArray("DiffuseColor",[l[0],l[1],l[2],1]),e.UBO.setValue("Roughness",r.getRoughness()),e.UBO.setValue("BaseIOR",r.getBaseIOR()),e.UBO.setValue("Metallic",r.getMetallic()),e.UBO.setValue("NormalStrength",r.getNormalStrength()),e.UBO.setValue("Emission",r.getEmission()),e.UBO.setValue("SpecularIntensity",r.getSpecular()),l=r.getSpecularColorByReference(),e.UBO.setArray("SpecularColor",[l[0],l[1],l[2],1])}const s=(a=r.getEdgeColorByReference)==null?void 0:a.call(r);s&&e.UBO.setArray("EdgeColor",[s[0],s[1],s[2],1]),e.UBO.setValue("LineWidth",r.getLineWidth()),e.UBO.setValue("Opacity",r.getOpacity()),e.UBO.setValue("PropID",e.WebGPUActor.getPropID());const c=e.WebGPURenderWindow.getDevice();e.UBO.sendIfNeeded(c)}},t.haveWideLines=()=>{const n=e.WebGPUActor.getRenderable(),r=n.getProperty().getRepresentation();return n.getProperty().getLineWidth()<=1||e.primitiveType===ii.Verts?!1:e.primitiveType===ii.Triangles||e.primitiveType===ii.TriangleStrips?r===O1.WIREFRAME:!0},t.replaceShaderPosition=(n,r,i)=>{const a=r.getShaderDescription("vertex");a.addBuiltinOutput("vec4<f32>","@builtin(position) Position"),a.hasOutput("vertexVC")||a.addOutput("vec4<f32>","vertexVC");let o=a.getCode();e.useRendererMatrix?(o=Ut.substitute(o,"//VTK::Position::Impl",["    var pCoord: vec4<f32> = rendererUBO.SCPCMatrix*mapperUBO.BCSCMatrix*vertexBC;","    output.vertexVC = rendererUBO.SCVCMatrix * mapperUBO.BCSCMatrix * vec4<f32>(vertexBC.xyz, 1.0);","//VTK::Position::Impl"]).result,e.forceZValue&&(o=Ut.substitute(o,"//VTK::Position::Impl",["pCoord = vec4<f32>(pCoord.xyz/pCoord.w, 1.0);","pCoord.z = mapperUBO.ZValue;","//VTK::Position::Impl"]).result)):(o=Ut.substitute(o,"//VTK::Position::Impl",["    var pCoord: vec4<f32> = mapperUBO.BCSCMatrix*vertexBC;","    pCoord.x = 2.0* pCoord.x / rendererUBO.viewportSize.x - 1.0;","    pCoord.y = 2.0* pCoord.y / rendererUBO.viewportSize.y - 1.0;","    pCoord.z = 0.5 - 0.5 * pCoord.z;","//VTK::Position::Impl"]).result,e.forceZValue&&(o=Ut.substitute(o,"//VTK::Position::Impl",["    pCoord.z = mapperUBO.ZValue;","//VTK::Position::Impl"]).result)),t.haveWideLines()&&(a.addBuiltinInput("u32","@builtin(instance_index) instanceIndex"),o=Ut.substitute(o,"//VTK::Position::Impl",["    var tmpPos: vec4<f32> = pCoord;","    var numSteps: f32 = ceil(mapperUBO.LineWidth - 1.0);","    var offset: f32 = (mapperUBO.LineWidth - 1.0) * (f32(input.instanceIndex / 2u) - numSteps/2.0) / numSteps;","    var tmpPos2: vec3<f32> = tmpPos.xyz / tmpPos.w;","    tmpPos2.x = tmpPos2.x + 2.0 * (f32(input.instanceIndex) % 2.0) * offset / rendererUBO.viewportSize.x;","    tmpPos2.y = tmpPos2.y + 2.0 * (f32(input.instanceIndex + 1u) % 2.0) * offset / rendererUBO.viewportSize.y;","    tmpPos2.z = min(1.0, tmpPos2.z + 0.00001);","    pCoord = vec4<f32>(tmpPos2.xyz * tmpPos.w, tmpPos.w);","//VTK::Position::Impl"]).result),o=Ut.substitute(o,"//VTK::Position::Impl",["    output.Position = pCoord;"]).result,a.setCode(o)},e.shaderReplacements.set("replaceShaderPosition",t.replaceShaderPosition),t.replaceShaderNormal=(n,r,i)=>{const a=i.getBuffer("normalMC"),o=e.WebGPUActor.getRenderable();if(a){const s=r.getShaderDescription("vertex");s.hasOutput("normalVC")||s.addOutput("vec3<f32>","normalVC",a.getArrayInformation()[0].interpolation),s.hasOutput("tangentVC")||s.addOutput("vec3<f32>","tangentVC",a.getArrayInformation()[0].interpolation),s.hasOutput("bitangentVC")||s.addOutput("vec3<f32>","bitangentVC",a.getArrayInformation()[0].interpolation);let c=s.getCode();c=Ut.substitute(c,"//VTK::Normal::Impl",["  output.normalVC = normalize((rendererUBO.WCVCNormals * mapperUBO.MCWCNormals * normalMC).xyz);","  var c1: vec3<f32> = cross(output.normalVC, vec3<f32>(0, 0, 1));","  var c2: vec3<f32> = cross(output.normalVC, vec3<f32>(0, 1, 0));","  var tangent: vec3<f32> = mix(c1, c2, distance(c1, c2));","  output.tangentVC = normalize(tangent);","  output.bitangentVC = normalize(cross(output.normalVC, tangent));"]).result,s.setCode(c);const l=r.getShaderDescription("fragment");c=l.getCode(),o.getProperty().getNormalTexture()?c=Ut.substitute(c,"//VTK::Normal::Impl",["  var normal: vec3<f32> = input.normalVC;","  if (!input.frontFacing) { normal = -normal; }","  var tangent: vec3<f32> = input.tangentVC;","  var bitangent: vec3<f32> = input.bitangentVC;","  var TCVCMatrix: mat3x3<f32> = mat3x3<f32>(","    tangent.x, bitangent.x, normal.x,","    tangent.y, bitangent.y, normal.y,","    tangent.z, bitangent.z, normal.z,","  );","  var mappedNormal: vec3<f32> = TCVCMatrix * (_normalMap.xyz * 2 - 1);","  normal = mix(normal, mappedNormal, mapperUBO.NormalStrength);","  normal = normalize(normal);"]).result:c=Ut.substitute(c,"//VTK::Normal::Impl",["  var normal: vec3<f32> = input.normalVC;","  if (!input.frontFacing) { normal = -normal; }","  normal = normalize(normal);"]).result,l.setCode(c)}},e.shaderReplacements.set("replaceShaderNormal",t.replaceShaderNormal),t.replaceShaderLight=(n,r,i)=>{var l;if(n.includes("sel"))return;const a=r.getShaderDescription("vertex");a.hasOutput("vertexVC")||a.addOutput("vec4<f32>","vertexVC");const o=e.WebGPURenderer.getRenderable(),s=r.getShaderDescription("fragment");let c=s.getCode();if(c.includes("var normal:")&&e.useRendererMatrix&&!Y7(n)&&!e.is2D&&!n.includes("sel")){const f=["  var pi: f32 = 3.14159265359;","  var fragPos: vec3<f32> = vec3<f32>(input.vertexVC.xyz);","  var V: vec3<f32> = mix(normalize(-fragPos), vec3<f32>(0, 0, 1), f32(rendererUBO.cameraParallel)); // View Vector","  var baseColor: vec3<f32> = _diffuseMap.rgb * diffuseColor.rgb;","  var roughness: f32 = max(0.000001, mapperUBO.Roughness * _roughnessMap.r);","  var metallic: f32 = mapperUBO.Metallic * _metallicMap.r;","  var alpha: f32 = roughness*roughness;","  var ior: f32 = mapperUBO.BaseIOR;","  var k: f32 = alpha*alpha / 2;","  var diffuse: vec3<f32> = vec3<f32>(0.);","  var specular: vec3<f32> = vec3<f32>(0.);","  var emission: vec3<f32> = _emissionMap.rgb * mapperUBO.Emission;","  {","    var i: i32 = 0;","    loop {","      if !(i < rendererUBO.LightCount) { break; }","      switch (i32(rendererLightSSBO.values[i].LightData.x)) {","         // Point Light","         case 0 {","           var color: vec3<f32> = rendererLightSSBO.values[i].LightColor.rgb * rendererLightSSBO.values[i].LightColor.w;","           var pos: vec3<f32> = (rendererLightSSBO.values[i].LightPos).xyz;","           var calculated: PBRData = calcPointLight(normal, V, fragPos, ior, roughness, metallic, pos, color, baseColor);","           diffuse += max(vec3<f32>(0), calculated.diffuse);","           specular += max(vec3<f32>(0), calculated.specular);","          }","         // Directional light","         case 1 {","           var dir: vec3<f32> = (rendererUBO.WCVCNormals * vec4<f32>(normalize(rendererLightSSBO.values[i].LightDir.xyz), 0.)).xyz;","           dir = normalize(dir);","           var color: vec3<f32> = rendererLightSSBO.values[i].LightColor.rgb * rendererLightSSBO.values[i].LightColor.w;","           var calculated: PBRData = calcDirectionalLight(normal, V, ior, roughness, metallic, dir, color, baseColor); // diffuseColor.rgb needs to be fixed with a more dynamic diffuse color","           diffuse += max(vec3<f32>(0), calculated.diffuse);","           specular += max(vec3<f32>(0), calculated.specular);","         }","         // Spot Light","         case 2 {","           var color: vec3<f32> = rendererLightSSBO.values[i].LightColor.rgb * rendererLightSSBO.values[i].LightColor.w;","           var pos: vec3<f32> = (rendererLightSSBO.values[i].LightPos).xyz;","           var dir: vec3<f32> = (rendererUBO.WCVCNormals * vec4<f32>(normalize(rendererLightSSBO.values[i].LightDir.xyz), 0.)).xyz;","           dir = normalize(dir);","           var cones: vec2<f32> = vec2<f32>(rendererLightSSBO.values[i].LightData.y, rendererLightSSBO.values[i].LightData.z);","           var calculated: PBRData = calcSpotLight(normal, V, fragPos, ior, roughness, metallic, pos, dir, cones, color, baseColor);","           diffuse += max(vec3<f32>(0), calculated.diffuse);","           specular += max(vec3<f32>(0), calculated.specular);","         }","         default { continue; }","       }","      continuing { i++; }","    }","  }","  var fresnel: f32 = schlickFresnelIOR(V, normal, ior, k); // Fresnel","  fresnel = min(1.0, fresnel);","  // This could be controlled with its own variable (that isnt base color) for better artistic control","  var fresnelMetallic: vec3<f32> = schlickFresnelRGB(V, normal, baseColor); // Fresnel for metal, takes color into account","  var kS: vec3<f32> = mix(vec3<f32>(fresnel), fresnelMetallic, metallic);","  kS = min(vec3<f32>(1.0), kS);","  var kD: vec3<f32> = (1.0 - kS) * (1.0 - metallic);","  var PBR: vec3<f32> = mapperUBO.DiffuseIntensity*kD*diffuse + kS*specular;","  PBR += emission;","  computedColor = vec4<f32>(PBR, mapperUBO.Opacity);"];(l=o.getEnvironmentTexture())!=null&&l.getImageLoaded()&&f.push("  // To get diffuse IBL, the texture is sampled with normals in worldspace","  var diffuseIBLCoords: vec3<f32> = (transpose(rendererUBO.WCVCNormals) * vec4<f32>(normal, 1.)).xyz;","  var diffuseCoords: vec2<f32> = vecToRectCoord(diffuseIBLCoords);","  // To get specular IBL, the texture is sampled as the worldspace reflection between the normal and view vectors","  // Reflections are first calculated in viewspace, then converted to worldspace to sample the environment","  var VreflN: vec3<f32> = normalize(reflect(-V, normal));","  var reflectionIBLCoords = (transpose(rendererUBO.WCVCNormals) * vec4<f32>(VreflN, 1.)).xyz;","  var specularCoords: vec2<f32> = vecToRectCoord(reflectionIBLCoords);","  var diffuseIBL = textureSampleLevel(EnvironmentTexture, EnvironmentTextureSampler, diffuseCoords, rendererUBO.MaxEnvironmentMipLevel);","  var level = roughness * rendererUBO.MaxEnvironmentMipLevel;","  var specularIBL = textureSampleLevel(EnvironmentTexture, EnvironmentTextureSampler, specularCoords, level);","  var specularIBLContribution: vec3<f32> = specularIBL.rgb*rendererUBO.BackgroundSpecularStrength;","  computedColor += vec4<f32>(specularIBLContribution*kS, 0);","  var diffuseIBLContribution: vec3<f32> = diffuseIBL.rgb*rendererUBO.BackgroundDiffuseStrength;","  diffuseIBLContribution *= baseColor * _ambientOcclusionMap.rgb;","  computedColor += vec4<f32>(diffuseIBLContribution*kD, 0);"),c=Ut.substitute(c,"//VTK::Light::Impl",f).result,s.setCode(c)}else c=Ut.substitute(c,"//VTK::Light::Impl",["  var diffuse: vec3<f32> = diffuseColor.rgb;","  var specular: vec3<f32> = mapperUBO.SpecularColor.rgb * mapperUBO.SpecularColor.a;","  computedColor = vec4<f32>(diffuse * _diffuseMap.rgb, mapperUBO.Opacity);"]).result,s.setCode(c)},e.shaderReplacements.set("replaceShaderLight",t.replaceShaderLight),t.replaceShaderColor=(n,r,i)=>{if(Y7(n)){const l=r.getShaderDescription("fragment");let f=l.getCode();f=Ut.substitute(f,"//VTK::Color::Impl",["ambientColor = mapperUBO.EdgeColor;","diffuseColor = mapperUBO.EdgeColor;"]).result,l.setCode(f);return}const a=i.getBuffer("colorVI");if(!a)return;const o=r.getShaderDescription("vertex");o.addOutput("vec4<f32>","color",a.getArrayInformation()[0].interpolation);let s=o.getCode();s=Ut.substitute(s,"//VTK::Color::Impl",["  output.color = colorVI;"]).result,o.setCode(s);const c=r.getShaderDescription("fragment");s=c.getCode(),s=Ut.substitute(s,"//VTK::Color::Impl",["ambientColor = input.color;","diffuseColor = input.color;","opacity = mapperUBO.Opacity * input.color.a;"]).result,c.setCode(s)},e.shaderReplacements.set("replaceShaderColor",t.replaceShaderColor),t.replaceShaderTCoord=(n,r,i)=>{var d,h,p,m,v,y,T,C,w,x,O,M,A,_,k,z,X,Z,ce,J;if(!i.hasAttribute("tcoord"))return;const a=r.getShaderDescription("vertex"),o=i.getBuffer("tcoord"),s=Mr.getNumberOfComponentsFromBufferFormat(o.getArrayInformation()[0].format);let c=a.getCode();a.addOutput(`vec${s}<f32>`,"tcoordVS"),c=Ut.substitute(c,"//VTK::TCoord::Impl",["  output.tcoordVS = tcoord;"]).result,a.setCode(c);const l=r.getShaderDescription("fragment");c=l.getCode();const f=e.WebGPUActor.getRenderable(),u=de=>de?de.getDimensionality()===s:!1,g=[];((p=(h=(d=f.getProperty()).getDiffuseTexture)==null?void 0:h.call(d))!=null&&p.getImageLoaded()||f.getTextures()[0]||e.colorTexture)&&(u((v=(m=f.getProperty()).getDiffuseTexture)==null?void 0:v.call(m))||u(f.getTextures()[0])||u(e.colorTexture))&&g.push("_diffuseMap = textureSample(DiffuseTexture, DiffuseTextureSampler, input.tcoordVS);"),(C=(T=(y=f.getProperty()).getRoughnessTexture)==null?void 0:T.call(y))!=null&&C.getImageLoaded()&&u(f.getProperty().getRoughnessTexture())&&g.push("_roughnessMap = textureSample(RoughnessTexture, RoughnessTextureSampler, input.tcoordVS);"),(O=(x=(w=f.getProperty()).getMetallicTexture)==null?void 0:x.call(w))!=null&&O.getImageLoaded()&&u(f.getProperty().getMetallicTexture())&&g.push("_metallicMap = textureSample(MetallicTexture, MetallicTextureSampler, input.tcoordVS);"),(_=(A=(M=f.getProperty()).getNormalTexture)==null?void 0:A.call(M))!=null&&_.getImageLoaded()&&u(f.getProperty().getNormalTexture())&&g.push("_normalMap = textureSample(NormalTexture, NormalTextureSampler, input.tcoordVS);"),(X=(z=(k=f.getProperty()).getAmbientOcclusionTexture)==null?void 0:z.call(k))!=null&&X.getImageLoaded()&&u(f.getProperty().getAmbientOcclusionTexture())&&g.push("_ambientOcclusionMap = textureSample(AmbientOcclusionTexture, AmbientOcclusionTextureSampler, input.tcoordVS);"),(J=(ce=(Z=f.getProperty()).getEmissionTexture)==null?void 0:ce.call(Z))!=null&&J.getImageLoaded()&&u(f.getProperty().getEmissionTexture())&&g.push("_emissionMap = textureSample(EmissionTexture, EmissionTextureSampler, input.tcoordVS);"),c=Ut.substitute(c,"//VTK::TCoord::Impl",g).result,l.setCode(c)},e.shaderReplacements.set("replaceShaderTCoord",t.replaceShaderTCoord),t.replaceShaderSelect=(n,r,i)=>{if(n.includes("sel")){const a=r.getShaderDescription("fragment");let o=a.getCode();o=Ut.substitute(o,"//VTK::Select::Impl",["  var compositeID: u32 = 0u;"]).result,a.setCode(o)}},e.shaderReplacements.set("replaceShaderSelect",t.replaceShaderSelect),t.getUsage=(n,r)=>n===O1.POINTS||r===ii.Points?dr.Verts:r===ii.Lines?dr.Lines:n===O1.WIREFRAME?r===ii.Triangles?dr.LinesFromTriangles:dr.LinesFromStrips:r===ii.Triangles?dr.Triangles:r===ii.TriangleStrips?dr.Strips:r===ii.TriangleEdges?dr.LinesFromTriangles:dr.LinesFromStrips,t.getHashFromUsage=n=>`pt${n}`,t.getTopologyFromUsage=n=>{switch(n){case dr.Triangles:return"triangle-list";case dr.Verts:return"point-list";case dr.Lines:default:return"line-list"}},t.buildVertexInput=()=>{var p,m;const n=e.currentInput,r=e.cellArray,i=e.primitiveType;let o=e.WebGPUActor.getRenderable().getProperty().getRepresentation();const s=e.WebGPURenderWindow.getDevice();let c=!1;i===ii.TriangleEdges&&(c=!0,o=O1.WIREFRAME);const l=e.vertexInput,f=n.getPoints();let u;if(r){const v={hash:`R${o}P${i}${r.getMTime()}`,usage:dr.Index,cells:r,numberOfPoints:f.getNumberOfPoints(),primitiveType:i,representation:o};u=s.getBufferManager().getBuffer(v),l.setIndexBuffer(u)}else l.setIndexBuffer(null);if(f){const v=e.WebGPUActor.getBufferShift(e.WebGPURenderer),y={hash:`${f.getMTime()}I${u.getMTime()}${v.join()}float32x4`,usage:dr.PointArray,format:"float32x4",dataArray:f,indexBuffer:u,shift:v,packExtra:!0},T=s.getBufferManager().getBuffer(y);l.addBuffer(T,["vertexBC"])}else l.removeBufferIfPresent("vertexBC");const g=t.getUsage(o,i);if(e._usesCellNormals=!1,!e.is2D&&(g===dr.Triangles||g===dr.Strips)){const v=n.getPointData().getNormals(),y={format:"snorm8x4",indexBuffer:u,packExtra:!0,shift:0,scale:127};if(v){y.hash=`${v.getMTime()}I${u.getMTime()}snorm8x4`,y.dataArray=v,y.usage=dr.PointArray;const T=s.getBufferManager().getBuffer(y);l.addBuffer(T,["normalMC"])}else if(i===ii.Triangles){e._usesCellNormals=!0,y.hash=`PFN${f.getMTime()}I${u.getMTime()}snorm8x4`,y.dataArray=f,y.cells=r,y.usage=dr.NormalsFromPoints;const T=s.getBufferManager().getBuffer(y);l.addBuffer(T,["normalMC"])}else l.removeBufferIfPresent("normalMC")}else l.removeBufferIfPresent("normalMC");let d=!1;if(e.renderable.getScalarVisibility()){const v=e.renderable.getColorMapColors();if(v&&!c){const y=e.renderable.getScalarMode();let T=!1;(y===D1.USE_CELL_DATA||y===D1.USE_CELL_FIELD_DATA||y===D1.USE_FIELD_DATA||!n.getPointData().getScalars())&&y!==D1.USE_POINT_FIELD_DATA&&v&&(T=!0);const C={usage:dr.PointArray,format:"unorm8x4",hash:`${T}${v.getMTime()}I${u.getMTime()}unorm8x4`,dataArray:v,indexBuffer:u,cellData:T,cellOffset:0},w=s.getBufferManager().getBuffer(C);l.addBuffer(w,["colorVI"]),d=!0}}d||l.removeBufferIfPresent("colorVI");let h=null;if((m=(p=e.renderable).getInterpolateScalarsBeforeMapping)!=null&&m.call(p)&&e.renderable.getColorCoordinates()?h=e.renderable.getColorCoordinates():h=n.getPointData().getTCoords(),h&&!c){const v=s.getBufferManager().getBufferForPointArray(h,l.getIndexBuffer());l.addBuffer(v,["tcoord"])}else l.removeBufferIfPresent("tcoord")},t.updateTextures=()=>{var c,l,f,u,g,d,h,p,m,v,y,T,C,w,x;const n=[],r=[],i=(l=(c=e.renderable).getColorTextureMap)==null?void 0:l.call(c);i&&(e.colorTexture||(e.colorTexture=M2.newInstance({label:"polyDataColor"})),e.colorTexture.setInputData(i),r.push(["Diffuse",e.colorTexture]));const a=e.WebGPUActor.getRenderable(),o=e.WebGPURenderer.getRenderable(),s=[];if((u=(f=a.getProperty()).getDiffuseTexture)!=null&&u.call(f)){const O=["Diffuse",a.getProperty().getDiffuseTexture()];s.push(O)}if(a.getTextures()[0]){const O=["Diffuse",a.getTextures()[0]];s.push(O)}if(e.colorTexture){const O=["Diffuse",e.colorTexture];s.push(O)}if((d=(g=a.getProperty()).getRoughnessTexture)!=null&&d.call(g)){const O=["Roughness",a.getProperty().getRoughnessTexture()];s.push(O)}if((p=(h=a.getProperty()).getMetallicTexture)!=null&&p.call(h)){const O=["Metallic",a.getProperty().getMetallicTexture()];s.push(O)}if((v=(m=a.getProperty()).getNormalTexture)!=null&&v.call(m)){const O=["Normal",a.getProperty().getNormalTexture()];s.push(O)}if((T=(y=a.getProperty()).getAmbientOcclusionTexture)!=null&&T.call(y)){const O=["AmbientOcclusion",a.getProperty().getAmbientOcclusionTexture()];s.push(O)}if((w=(C=a.getProperty()).getEmissionTexture)!=null&&w.call(C)){const O=["Emission",a.getProperty().getEmissionTexture()];s.push(O)}if((x=o.getEnvironmentTexture)!=null&&x.call(o)){const O=["Environment",o.getEnvironmentTexture()];s.push(O)}for(let O=0;O<s.length;O++)(s[O][1].getInputData()||s[O][1].getJsImageData()||s[O][1].getCanvas())&&r.push(s[O]),s[O][1].getImage()&&s[O][1].getImageLoaded()&&r.push(s[O]);for(let O=0;O<r.length;O++){const M=r[O][1],A=r[O][0],_=e.device.getTextureManager().getTextureForVTKTexture(M);if(_.getReady()){let k=!1;for(let z=0;z<e.textures.length;z++)e.textures[z]===_&&(k=!0,n[z]=!0);if(!k){n[e.textures.length]=!0;const z=_.createView(`${A}Texture`);e.textures.push(_),e.textureViews.push(z);const X=M.getInterpolate()?"linear":"nearest";let Z=null;!Z&&M.getEdgeClamp()&&M.getRepeat()&&(Z="mirror-repeat"),!Z&&M.getEdgeClamp()&&(Z="clamp-to-edge"),!Z&&M.getRepeat()&&(Z="repeat"),A!=="Environment"?z.addSampler(e.device,{addressModeU:Z,addressModeV:Z,addressModeW:Z,minFilter:X,magFilter:X}):z.addSampler(e.device,{addressModeU:"repeat",addressModeV:"clamp-to-edge",addressModeW:"repeat",minFilter:X,magFilter:X,mipmapFilter:"linear"})}}}for(let O=e.textures.length-1;O>=0;O--)n[O]||(e.textures.splice(O,1),e.textureViews.splice(O,1))},t.computePipelineHash=()=>{let n=`pd${e.useRendererMatrix?"r":""}${e.forceZValue?"z":""}`;if(e.primitiveType===ii.TriangleEdges||e.primitiveType===ii.TriangleStripEdges)n+="edge";else{if(e.vertexInput.hasAttribute("normalMC")&&(n+="n"),e.vertexInput.hasAttribute("colorVI")&&(n+="c"),e.vertexInput.hasAttribute("tcoord")){const i=e.vertexInput.getBuffer("tcoord"),a=Mr.getNumberOfComponentsFromBufferFormat(i.getArrayInformation()[0].format);n+=`t${a}`}e.textures.length&&(n+=`tx${e.textures.length}`)}e._usesCellNormals&&(n+="cn"),e.SSBO&&(n+="ssbo");const r=t.getHashFromUsage(e.usage);n+=r,n+=e.renderEncoder.getPipelineHash(),e.pipelineHash=n},t.updateBuffers=()=>{e.primitiveType!==ii.TriangleEdges&&e.primitiveType!==ii.TriangleStripEdges&&t.updateTextures();const n=e.WebGPUActor.getRenderable(),r=n.getProperty().getRepresentation();e.usage=t.getUsage(r,e.primitiveType),t.buildVertexInput();const i=e.vertexInput.getBuffer("vertexBC");if(t.setNumberOfVertices(i.getSizeInBytes()/i.getStrideInBytes()),t.setTopology(t.getTopologyFromUsage(e.usage)),t.updateUBO(),t.haveWideLines()){const a=n.getProperty();t.setNumberOfInstances(Math.ceil(a.getLineWidth()*2))}else t.setNumberOfInstances(1)}}const oee={is2D:!1,cellArray:null,currentInput:null,cellOffset:0,primitiveType:0,colorTexture:null,renderEncoder:null,textures:null};function VM(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,oee,n),lR.extend(t,e,n),e.fragmentShaderTemplate=iee,e.vertexShaderTemplate=ree,e._tmpMat3=ya(new Float64Array(9)),e._tmpMat4=Be(new Float64Array(16)),e.UBO=su.newInstance({label:"mapperUBO"}),e.UBO.addEntry("BCWCMatrix","mat4x4<f32>"),e.UBO.addEntry("BCSCMatrix","mat4x4<f32>"),e.UBO.addEntry("MCWCNormals","mat4x4<f32>"),e.UBO.addEntry("AmbientColor","vec4<f32>"),e.UBO.addEntry("DiffuseColor","vec4<f32>"),e.UBO.addEntry("EdgeColor","vec4<f32>"),e.UBO.addEntry("SpecularColor","vec4<f32>"),e.UBO.addEntry("AmbientIntensity","f32"),e.UBO.addEntry("DiffuseIntensity","f32"),e.UBO.addEntry("Roughness","f32"),e.UBO.addEntry("Metallic","f32"),e.UBO.addEntry("Ambient","f32"),e.UBO.addEntry("Normal","f32"),e.UBO.addEntry("Emission","f32"),e.UBO.addEntry("NormalStrength","f32"),e.UBO.addEntry("BaseIOR","f32"),e.UBO.addEntry("SpecularIntensity","f32"),e.UBO.addEntry("LineWidth","f32"),e.UBO.addEntry("Opacity","f32"),e.UBO.addEntry("ZValue","f32"),e.UBO.addEntry("PropID","u32"),e.UBO.addEntry("ClipNear","f32"),e.UBO.addEntry("ClipFar","f32"),e.UBO.addEntry("Time","u32"),Vn(t,e,["cellArray","currentInput","cellOffset","is2D","primitiveType","renderEncoder"]),e.textures=[],aee(t,e)}const see=Rt(VM,"vtkWebGPUCellArrayMapper");var PM={newInstance:see,extend:VM};const{PrimitiveTypes:R1}=Ju;function cee(t,e){e.classHierarchy.push("vtkWebGPUPolyDataMapper"),t.createCellArrayMapper=()=>PM.newInstance(),t.buildPass=n=>{if(n){e.WebGPUActor=t.getFirstAncestorOfType("vtkWebGPUActor"),e.renderable.getStatic()||e.renderable.update();const r=e.renderable.getInputData();e.renderable.mapScalars(r,1),t.updateCellArrayMappers(r)}},t.updateCellArrayMappers=n=>{const r=[n.getVerts(),n.getLines(),n.getPolys(),n.getStrips()],i=[];let a=0;for(let o=R1.Points;o<=R1.Triangles;o++)if(r[o].getNumberOfValues()>0){e.primitives[o]||(e.primitives[o]=t.createCellArrayMapper());const s=e.primitives[o];s.setCellArray(r[o]),s.setCurrentInput(n),s.setCellOffset(a),s.setPrimitiveType(o),s.setRenderable(e.renderable),a+=r[o].getNumberOfCells(),i.push(s)}else e.primitives[o]=null;if(e.WebGPUActor.getRenderable().getProperty().getEdgeVisibility())for(let o=R1.TriangleEdges;o<=R1.TriangleStripEdges;o++)if(r[o-2].getNumberOfValues()>0){e.primitives[o]||(e.primitives[o]=t.createCellArrayMapper());const s=e.primitives[o];s.setCellArray(r[o-2]),s.setCurrentInput(n),s.setCellOffset(e.primitives[o-2].getCellOffset()),s.setPrimitiveType(o),s.setRenderable(e.renderable),i.push(s)}else e.primitives[o]=null;t.prepareNodes(),t.addMissingChildren(i),t.removeUnusedNodes()}}const lee={primitives:null};function uee(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,lee,n),Bt.extend(t,e,n),e.primitives=[],cee(t,e)}const fee=Rt(uee,"vtkWebGPUPolyDataMapper");Ta("vtkMapper",fee);const{PrimitiveTypes:Z7}=Ju;function gee(t,e){e.classHierarchy.push("vtkWebGPUPolyDataMapper2D"),t.createCellArrayMapper=()=>PM.newInstance(),t.buildPass=n=>{if(n){e.WebGPUActor=t.getFirstAncestorOfType("vtkWebGPUActor2D"),e.renderable.getStatic()||e.renderable.update();const r=e.renderable.getInputData();e.renderable.mapScalars(r,1),t.updateCellArrayMappers(r)}},t.updateCellArrayMappers=n=>{const r=[n.getVerts(),n.getLines(),n.getPolys(),n.getStrips()],i=[];let a=0;for(let o=Z7.Points;o<=Z7.Triangles;o++)if(r[o].getNumberOfValues()>0){e.primitives[o]||(e.primitives[o]=t.createCellArrayMapper());const s=e.primitives[o];s.setCellArray(r[o]),s.setCurrentInput(n),s.setCellOffset(a),s.setPrimitiveType(o),s.setRenderable(e.renderable),s.setIs2D(!0),a+=r[o].getNumberOfCells(),i.push(s)}else e.primitives[o]=null;t.prepareNodes(),t.addMissingChildren(i),t.removeUnusedNodes()}}function dee(t){return{primitives:[],...t}}function pee(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,dee(n)),Bt.extend(t,e,n),e.primitives=[],gee(t,e)}const hee=Rt(pee,"vtkWebGPUPolyDataMapper2D");Ta("vtkMapper2D",hee);function mee(t,e){e.classHierarchy.push("vtkWebGPUScalarBarActor"),t.buildPass=n=>{n&&(e.WebGPURenderer=t.getFirstAncestorOfType("vtkWebGPURenderer"),e.WebGPURenderWindow=e.WebGPURenderer.getParent(),e.scalarBarActorHelper.getRenderable()||e.scalarBarActorHelper.setRenderable(e.renderable),t.prepareNodes(),t.addMissingNode(e.scalarBarActorHelper.getBarActor()),t.addMissingNode(e.scalarBarActorHelper.getTmActor()),t.removeUnusedNodes())},t.opaquePass=(n,r)=>{if(n){const i=e.WebGPURenderer?e.WebGPURenderer.getRenderable().getActiveCamera():null,a=e.WebGPURenderer.getTiledSizeAndOrigin();e.scalarBarActorHelper.updateAPISpecificData([a.usize,a.vsize],i,e.WebGPURenderWindow.getRenderable())}}}const vee={};function yee(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,vee,n),Bt.extend(t,e,n),e.scalarBarActorHelper=IM.newScalarBarActorHelper(),mee(t,e)}const Tee=Rt(yee,"vtkWebGPUScalarBarActor");Ta("vtkScalarBarActor",Tee);function Cee(t,e){e.classHierarchy.push("vtkWebGPUTextureView"),t.create=(n,r)=>{e.texture=n,e.options=r,e.options.dimension=e.options.dimension||"2d",e.options.label=e.label,e.textureHandle=n.getHandle(),e.handle=e.textureHandle.createView(e.options),e.bindGroupLayoutEntry.texture.viewDimension=e.options.dimension;const i=Mr.getDetailsFromTextureFormat(e.texture.getFormat());e.bindGroupLayoutEntry.texture.sampleType=i.sampleType},t.createFromTextureHandle=(n,r)=>{e.texture=null,e.options=r,e.options.dimension=e.options.dimension||"2d",e.options.label=e.label,e.textureHandle=n,e.handle=e.textureHandle.createView(e.options),e.bindGroupLayoutEntry.texture.viewDimension=e.options.dimension;const i=Mr.getDetailsFromTextureFormat(r.format);e.bindGroupLayoutEntry.texture.sampleType=i.sampleType,e.bindGroupTime.modified()},t.getBindGroupEntry=()=>({resource:t.getHandle()}),t.getShaderCode=(n,r)=>{let i="f32";e.bindGroupLayoutEntry.texture.sampleType==="sint"?i="i32":e.bindGroupLayoutEntry.texture.sampleType==="uint"&&(i="u32");let a=`@binding(${n}) @group(${r}) var ${e.label}: texture_${e.options.dimension}<${i}>;`;return e.bindGroupLayoutEntry.texture.sampleType==="depth"&&(a=`@binding(${n}) @group(${r}) var ${e.label}: texture_depth_${e.options.dimension};`),a},t.addSampler=(n,r)=>{const i=mR.newInstance({label:`${e.label}Sampler`});i.create(n,r),t.setSampler(i)},t.getBindGroupTime=()=>(e.texture&&e.texture.getHandle()!==e.textureHandle&&(e.textureHandle=e.texture.getHandle(),e.handle=e.textureHandle.createView(e.options),e.bindGroupTime.modified()),e.bindGroupTime),t.getHandle=()=>(e.texture&&e.texture.getHandle()!==e.textureHandle&&(e.textureHandle=e.texture.getHandle(),e.handle=e.textureHandle.createView(e.options),e.bindGroupTime.modified()),e.handle)}const wee={texture:null,handle:null,sampler:null,label:null};function NM(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,wee,n),P.obj(t,e),e.bindGroupLayoutEntry={visibility:GPUShaderStage.VERTEX|GPUShaderStage.FRAGMENT,texture:{sampleType:"float",viewDimension:"2d"}},e.bindGroupTime={},P.obj(e.bindGroupTime,{mtime:0}),P.get(t,e,["bindGroupTime","texture"]),P.setGet(t,e,["bindGroupLayoutEntry","label","sampler"]),Cee(t,e)}const xee=P.newInstance(NM);var See={newInstance:xee,extend:NM};const{BufferUsage:Q7}=Ju;function Eee(t,e){e.classHierarchy.push("vtkWebGPUTexture"),t.create=(n,r)=>{e.device=n,e.width=r.width,e.height=r.height,e.depth=r.depth?r.depth:1;const i=e.depth===1?"2d":"3d";e.format=r.format?r.format:"rgba8unorm",e.mipLevel=r.mipLevel?r.mipLevel:0,e.usage=r.usage?r.usage:GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST,e.handle=e.device.getHandle().createTexture({size:[e.width,e.height,e.depth],format:e.format,usage:e.usage,label:e.label,dimension:i,mipLevelCount:e.mipLevel+1})},t.assignFromHandle=(n,r,i)=>{e.device=n,e.handle=r,e.width=i.width,e.height=i.height,e.depth=i.depth?i.depth:1,e.format=i.format?i.format:"rgba8unorm",e.usage=i.usage?i.usage:GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST},t.writeImageData=n=>{let r=[];if(n.canvas){e.device.getHandle().queue.copyExternalImageToTexture({source:n.canvas,flipY:n.flip},{texture:e.handle,premultipliedAlpha:!0},[e.width,e.height,e.depth]),e.ready=!0;return}n.jsImageData&&!n.nativeArray&&(n.width=n.jsImageData.width,n.height=n.jsImageData.height,n.depth=1,n.format="rgba8unorm",n.flip=!0,n.nativeArray=n.jsImageData.data);const i=Mr.getDetailsFromTextureFormat(e.format);let a=e.width*i.stride;const o=(c,l,f)=>{const u=c.length/(l*f)*c.BYTES_PER_ELEMENT,g=i.elementSize===2&&i.sampleType==="float";if(g||u%256){const d=c,h=u/d.BYTES_PER_ELEMENT,p=i.elementSize,m=256*Math.floor((h*p+255)/256),v=m/p,y=P.newTypedArray(g?"Uint16Array":d.constructor.name,v*l*f);for(let T=0;T<l*f;T++)if(g)for(let C=0;C<h;C++)y[T*v+C]=E0.toHalf(d[T*h+C]);else y.set(d.subarray(T*h,(T+1)*h),T*v);return[y,m]}return[c,u]};if(n.nativeArray&&(r=n.nativeArray),n.image){const c=document.createElement("canvas");c.width=n.image.width,c.height=n.image.height;const l=c.getContext("2d");l.translate(0,c.height),l.scale(1,-1),l.drawImage(n.image,0,0,n.image.width,n.image.height,0,0,c.width,c.height),r=l.getImageData(0,0,n.image.width,n.image.height).data}const s=e.device.createCommandEncoder();if(t.getDimensionality()!==3){const c=M2.generateMipmaps(r,e.width,e.height,e.mipLevel);let l=e.width,f=e.height;for(let u=0;u<=e.mipLevel;u++){const g=o(c[u],f,1);a=g[1];const d={dataArray:n.dataArray?n.dataArray:null,nativeArray:g[0],usage:Q7.Texture},h=e.device.getBufferManager().getBuffer(d);s.copyBufferToTexture({buffer:h.getHandle(),offset:0,bytesPerRow:a,rowsPerImage:f},{texture:e.handle,mipLevel:u},[l,f,1]),l/=2,f/=2}e.device.submitCommandEncoder(s),e.ready=!0}else{const c=o(r,e.height,e.depth);a=c[1];const l={dataArray:n.dataArray?n.dataArray:null,usage:Q7.Texture};l.nativeArray=c[0];const f=e.device.getBufferManager().getBuffer(l);s.copyBufferToTexture({buffer:f.getHandle(),offset:0,bytesPerRow:a,rowsPerImage:e.height},{texture:e.handle},[e.width,e.height,e.depth]),e.device.submitCommandEncoder(s),e.ready=!0}},t.getScale=()=>{const n=Mr.getDetailsFromTextureFormat(e.format);return n.elementSize===2&&n.sampleType==="float"?1:255},t.getNumberOfComponents=()=>Mr.getDetailsFromTextureFormat(e.format).numComponents,t.getDimensionality=()=>{let n=0;return e.width>1&&n++,e.height>1&&n++,e.depth>1&&n++,n},t.resizeToMatch=n=>{(n.getWidth()!==e.width||n.getHeight()!==e.height||n.getDepth()!==e.depth)&&(e.width=n.getWidth(),e.height=n.getHeight(),e.depth=n.getDepth(),e.handle=e.device.getHandle().createTexture({size:[e.width,e.height,e.depth],format:e.format,usage:e.usage,label:e.label}))},t.resize=function(n,r){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1;(n!==e.width||r!==e.height||i!==e.depth)&&(e.width=n,e.height=r,e.depth=i,e.handle=e.device.getHandle().createTexture({size:[e.width,e.height,e.depth],format:e.format,usage:e.usage,label:e.label}))},t.createView=function(n){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};r.dimension||(r.dimension=e.depth===1?"2d":"3d");const i=See.newInstance({label:n});return i.create(t,r),i}}const Oee={device:null,handle:null,buffer:null,ready:!1,label:null};function Dee(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Oee,n),P.obj(t,e),P.get(t,e,["handle","ready","width","height","depth","format","usage"]),P.setGet(t,e,["device","label"]),Eee(t,e)}P.newInstance(Dee);function Ree(t){if(!t||t.data.length===0)throw new Error("Invalid contour set data, see publicContourSetData type for more info");if(!t.id)throw new Error("Invalid contour set data, each contour set must have an id");if(!t.data||!Array.isArray(t.data))throw new Error("Invalid contour set data, each contour set must have an array of contours");t.data.forEach(e=>{if(!e.points||!Array.isArray(e.points))throw new Error("Invalid contour set data, each contour must have an array of points");e.points.forEach(n=>{if(!n||!Array.isArray(n)||n.length!==3)throw new Error("Invalid contour set data, each point must be an array of length 3")})})}class J7{constructor(e){const{points:n,type:r}=e.data;this.id=e.id,this._points=n,this._type=r,this._color=e.color,this._segmentIndex=e.segmentIndex,this.sizeInBytes=this._getSizeInBytes()}_getSizeInBytes(){return this._points.length*3}get points(){return this._points}set points(e){this._points=e}get color(){return this._color}set color(e){this._color=e}get type(){return this._type}set type(e){this._type=e}get segmentIndex(){return this._segmentIndex}set segmentIndex(e){this._segmentIndex=e}get flatPointsArray(){return this._points.map(e=>[...e]).flat()}}class Mee{constructor(e){this._color=[200,0,0],this.id=e.id,this._contours=[],this._color=e.color??this._color,this.frameOfReferenceUID=e.frameOfReferenceUID,this._segmentIndex=e.segmentIndex,this._createEachContour(e.data),this.sizeInBytes=this._getSizeInBytes()}_createEachContour(e){e.forEach(n=>{const{points:r,type:i,color:a}=n,o=new J7({id:`${this.id}-segment-${this._segmentIndex}`,data:{points:r,type:i,segmentIndex:this._segmentIndex,color:a??this._color},segmentIndex:this._segmentIndex,color:a??this._color});this._contours.push(o)}),this._updateContourSetCentroid()}_updateContourSetCentroid(){const e=this.totalNumberOfPoints,n=this.flatPointsArray,r=n.reduce((o,s)=>[o[0]+s[0],o[1]+s[1],o[2]+s[2]],[0,0,0]),i=[r[0]/e,r[1]/e,r[2]/e],a=n.reduce((o,s)=>{const c=this._getDistance(i,s),l=this._getDistance(i,o);return c<l?s:o},n[0]);this._centroid=a}_getSizeInBytes(){return this._contours.reduce((e,n)=>e+n.sizeInBytes,0)}_getDistance(e,n){return Math.sqrt((e[0]-n[0])**2+(e[1]-n[1])**2+(e[2]-n[2])**2)}get centroid(){return this._centroid}get segmentIndex(){return this._segmentIndex}get color(){return this._color}set color(e){this._color=e,this._contours.forEach(n=>{n instanceof J7&&(n.color=e)})}get contours(){return this._contours}get flatPointsArray(){return this._contours.flatMap(e=>e.points)}get numberOfContours(){return this._contours.length}get totalNumberOfPoints(){return this._contours.reduce((e,n)=>e+n.points.length,0)}get numberOfPointsArray(){return this._contours.map(e=>e.points.length)}getPointsInContour(e){return this._contours[e].points}getNumberOfPointsInAContour(e){return this.getPointsInContour(e).length}}function _ee(t,e){Ree(e);const n=new Mee({id:e.id,data:e.data,color:e.color,frameOfReferenceUID:e.frameOfReferenceUID,segmentIndex:e.segmentIndex??1});return{id:t,type:hs.CONTOUR,data:n,sizeInBytes:n.sizeInBytes}}function bee(t){var e,n;if(!t.id)throw new Error("Surface must have an id");if(((e=t.points)==null?void 0:e.length)===0)throw new Error("Surface must have non-empty points array");if(((n=t.polys)==null?void 0:n.length)===0)throw new Error("Surface must have non-empty polys array");if(!t.frameOfReferenceUID)throw new Error("Surface must have a frameOfReferenceUID")}function Lee(t,e){bee(e);const n=new zY({id:e.id,points:e.points,polys:e.polys,color:e.color,frameOfReferenceUID:e.frameOfReferenceUID,segmentIndex:e.segmentIndex??1});return{id:t,type:hs.SURFACE,data:n,sizeInBytes:n.sizeInBytes}}function Iee(t,e){if(t===void 0)throw new Error("createAndCacheGeometry: parameter geometryId must not be undefined");let n=Me.getGeometry(t);if(n)return n;if(e.type===hs.CONTOUR)n=_ee(t,e.geometryData);else if(e.type===hs.SURFACE)n=Lee(t,e.geometryData);else throw new Error("Unknown geometry type");return Me.putGeometrySync(t,n),n}function J5(t,e){const n=t.length,r=new Uint8ClampedArray(n);for(let i=0;i<n;++i)r[i]=t[i]>>e;return r}function em(t,e,n){const r=t[`${e}PaletteColorLookupTableData`];if(r)return Promise.resolve(r);const i=Ve("imagePixelModule",t.imageId);return i&&typeof i.then=="function"?i.then(a=>a?a[`${e}PaletteColorLookupTableData`]:n):Promise.resolve(i?i[`${e}PaletteColorLookupTableData`]:n)}function Vee(t,e,n){const r=t.columns*t.rows,i=t.pixelData;Promise.all([em(t,"red",null),em(t,"green",null),em(t,"blue",null)]).then(([a,o,s])=>{if(!a||!o||!s)throw new Error("The image does not have a complete color palette. R, G, and B palette data are required.");const c=a.length;let l=0,f=0;const u=t.redPaletteColorLookupTableDescriptor[1],g=t.redPaletteColorLookupTableDescriptor[2]===8?0:8,d=J5(a,g),h=J5(o,g),p=J5(s,g);if(n){for(let m=0;m<r;++m){let v=i[l++];v<u?v=0:v>u+c-1?v=c-1:v-=u,e[f++]=d[v],e[f++]=h[v],e[f++]=p[v],e[f++]=255}return}for(let m=0;m<r;++m){let v=i[l++];v<u?v=0:v>u+c-1?v=c-1:v-=u,e[f++]=d[v],e[f++]=h[v],e[f++]=p[v]}})}function tm(t,e){if(!(!t.elements[e]||t.elements[e].length!==6))return[t.uint16(e,0),t.uint16(e,1),t.uint16(e,2)]}function nm(t,e,n){const r=[],i=t.elements[e];for(let a=0;a<n[0];a++)n[2]===16?r[a]=t.uint16(e,a):r[a]=t.byteArray[a+i.dataOffset];return r}function Pee(t,e){e.redPaletteColorLookupTableDescriptor=tm(t,"x00281101"),e.greenPaletteColorLookupTableDescriptor=tm(t,"x00281102"),e.bluePaletteColorLookupTableDescriptor=tm(t,"x00281103"),e.redPaletteColorLookupTableDescriptor[0]===0&&(e.redPaletteColorLookupTableDescriptor[0]=65536,e.greenPaletteColorLookupTableDescriptor[0]=65536,e.bluePaletteColorLookupTableDescriptor[0]=65536);const n=e.redPaletteColorLookupTableDescriptor[0],i=t.elements.x00281201.length===n?8:16;e.redPaletteColorLookupTableDescriptor[2]!==i&&(e.redPaletteColorLookupTableDescriptor[2]=i,e.greenPaletteColorLookupTableDescriptor[2]=i,e.bluePaletteColorLookupTableDescriptor[2]=i),e.redPaletteColorLookupTableData=nm(t,"x00281201",e.redPaletteColorLookupTableDescriptor),e.greenPaletteColorLookupTableData=nm(t,"x00281202",e.greenPaletteColorLookupTableDescriptor),e.bluePaletteColorLookupTableData=nm(t,"x00281203",e.bluePaletteColorLookupTableDescriptor)}function Nee(t,e){t.uint16("x00280103")===0?(e.smallestPixelValue=t.uint16("x00280106"),e.largestPixelValue=t.uint16("x00280107")):(e.smallestPixelValue=t.int16("x00280106"),e.largestPixelValue=t.int16("x00280107"))}function kee(t){const e={samplesPerPixel:t.uint16("x00280002"),photometricInterpretation:t.string("x00280004"),rows:t.uint16("x00280010"),columns:t.uint16("x00280011"),bitsAllocated:t.uint16("x00280100"),bitsStored:t.uint16("x00280101"),highBit:t.uint16("x00280102"),pixelRepresentation:t.uint16("x00280103"),planarConfiguration:t.uint16("x00280006"),pixelAspectRatio:t.string("x00280034")};return Nee(t,e),e.photometricInterpretation==="PALETTE COLOR"&&t.elements.x00281101&&Pee(t,e),e}function Aee(t,e){let n=e.uint16("x00283002",0);n===0&&(n=65535);let r=0;t===0?r=e.uint16("x00283002",1):r=e.int16("x00283002",1);const i=e.uint16("x00283002",2),a={id:"1",firstValueMapped:r,numBitsPerEntry:i,lut:[]};for(let o=0;o<n;o++)t===0?a.lut[o]=e.uint16("x00283006",o):a.lut[o]=e.int16("x00283006",o);return a}function eT(t,e){if(!e||!e.items||!e.items.length)return;const n=[];for(let r=0;r<e.items.length;r++){const i=e.items[r].dataSet,a=Aee(t,i);a&&n.push(a)}return n}function Fee(t){const e=t.uint16("x00280103"),n=t.uint16("x00280101");return e===0?0:-1<<n-1}function Uee(t){const e=t.string("x00080016");if(e==="1.2.840.10008.5.1.4.1.1.2"||e==="1.2.840.10008.5.1.4.1.1.2.1")return 1;const n=t.floatString("x00281052"),r=t.floatString("x00281053");return n!==void 0&&r!==void 0?Fee(t)*r+n<0?1:0:t.elements.x00283000&&t.elements.x00283000.length>0?0:t.uint16("x00280103")}function xo(t,e,n){const r=[],i=t.string(e);if(!i)return;const a=i.split("\\");if(!(n&&a.length<n)){for(let o=0;o<a.length;o++)r.push(parseFloat(a[o]));return r}}var kM={exports:{}};/*! dicom-parser - 1.8.12 - 2023-02-20 | (c) 2017 Chris Hafey | https://github.com/cornerstonejs/dicomParser */(function(t,e){(function(n,r){t.exports=r(vo)})(Rr,function(n){return i=[function(o,s){o.exports=n},function(o,s,c){c.r(s),c.d(s,"isStringVr",function(){return f}),c.d(s,"isPrivateTag",function(){return u}),c.d(s,"parsePN",function(){return g}),c.d(s,"parseTM",function(){return d}),c.d(s,"parseDA",function(){return p}),c.d(s,"explicitElementToString",function(){return m}),c.d(s,"explicitDataSetToJS",function(){return v}),c.d(s,"createJPEGBasicOffsetTable",function(){return C}),c.d(s,"parseDicomDataSetExplicit",function(){return ue}),c.d(s,"parseDicomDataSetImplicit",function(){return le}),c.d(s,"readFixedString",function(){return M}),c.d(s,"alloc",function(){return Fe}),c.d(s,"version",function(){return kt}),c.d(s,"bigEndianByteArrayParser",function(){return lt}),c.d(s,"ByteStream",function(){return _t}),c.d(s,"sharedCopy",function(){return yt}),c.d(s,"DataSet",function(){return k}),c.d(s,"findAndSetUNElementLength",function(){return O}),c.d(s,"findEndOfEncapsulatedElement",function(){return x}),c.d(s,"findItemDelimitationItemAndSetElementLength",function(){return z}),c.d(s,"littleEndianByteArrayParser",function(){return Ke}),c.d(s,"parseDicom",function(){return jr}),c.d(s,"readDicomElementExplicit",function(){return ie}),c.d(s,"readDicomElementImplicit",function(){return Z}),c.d(s,"readEncapsulatedImageFrame",function(){return fn}),c.d(s,"readEncapsulatedPixelData",function(){return cr}),c.d(s,"readEncapsulatedPixelDataFromFragments",function(){return $t}),c.d(s,"readPart10Header",function(){return Ye}),c.d(s,"readSequenceItemsExplicit",function(){return q}),c.d(s,"readSequenceItemsImplicit",function(){return de}),c.d(s,"readSequenceItem",function(){return ce}),c.d(s,"readTag",function(){return w});var l={AE:!0,AS:!0,AT:!1,CS:!0,DA:!0,DS:!0,DT:!0,FL:!1,FD:!1,IS:!0,LO:!0,LT:!0,OB:!1,OD:!1,OF:!1,OW:!1,PN:!0,SH:!0,SL:!1,SQ:!1,SS:!1,ST:!0,TM:!0,UI:!0,UL:!1,UN:void 0,UR:!0,US:!1,UT:!0},f=function(U){return l[U]},u=function(U){if(U=parseInt(U[4],16),isNaN(U))throw"dicomParser.isPrivateTag: cannot parse last character of group";return U%2==1},g=function(U){if(U!==void 0)return U=U.split("^"),{familyName:U[0],givenName:U[1],middleName:U[2],prefix:U[3],suffix:U[4]}};function d(U,$){if(2<=U.length){var ne=parseInt(U.substring(0,2),10),B=4<=U.length?parseInt(U.substring(2,4),10):void 0,ae=6<=U.length?parseInt(U.substring(4,6),10):void 0,xe=8<=U.length?U.substring(7,13):void 0,xe=xe?parseInt(xe,10)*Math.pow(10,6-xe.length):void 0;if($&&(isNaN(ne)||B!==void 0&&isNaN(B)||ae!==void 0&&isNaN(ae)||xe!==void 0&&isNaN(xe)||ne<0||23<ne||B&&(B<0||59<B)||ae&&(ae<0||59<ae)||xe&&(xe<0||999999<xe)))throw"invalid TM '".concat(U,"'");return{hours:ne,minutes:B,seconds:ae,fractionalSeconds:xe}}if($)throw"invalid TM '".concat(U,"'")}function h(U,$,ne){return!isNaN(ne)&&0<$&&$<=12&&0<U&&U<=function(B,ae){switch(B){case 2:return ae%4==0&&ae%100||ae%400==0?29:28;case 9:case 4:case 6:case 11:return 30;default:return 31}}($,ne)}function p(U,$){if(U&&U.length===8){var ne=parseInt(U.substring(0,4),10),B=parseInt(U.substring(4,6),10),ae=parseInt(U.substring(6,8),10);if($&&h(ae,B,ne)!==!0)throw"invalid DA '".concat(U,"'");return{year:ne,month:B,day:ae}}if($)throw"invalid DA '".concat(U,"'")}function m(U,$){if(U===void 0||$===void 0)throw"dicomParser.explicitElementToString: missing required parameters";if($.vr===void 0)throw"dicomParser.explicitElementToString: cannot convert implicit element to string";var ne,B=$.vr,ae=$.tag;function xe(it,Ct){for(var Qt="",At=0;At<it;At++)At!==0&&(Qt+="/"),Qt+=Ct.call(U,ae,At).toString();return Qt}if(f(B)===!0)ne=U.string(ae);else{if(B==="AT"){var Pe=U.uint32(ae);return Pe===void 0?void 0:"x".concat((Pe=Pe<0?4294967295+Pe+1:Pe).toString(16).toUpperCase())}B==="US"?ne=xe($.length/2,U.uint16):B==="SS"?ne=xe($.length/2,U.int16):B==="UL"?ne=xe($.length/4,U.uint32):B==="SL"?ne=xe($.length/4,U.int32):B==="FD"?ne=xe($.length/8,U.double):B==="FL"&&(ne=xe($.length/4,U.float))}return ne}function v(U,$){if(U===void 0)throw"dicomParser.explicitDataSetToJS: missing required parameter dataSet";$=$||{omitPrivateAttibutes:!0,maxElementLength:128};var ne,B={};for(ne in U.elements){var ae=U.elements[ne];if($.omitPrivateAttibutes!==!0||!u(ne))if(ae.items){for(var xe=[],Pe=0;Pe<ae.items.length;Pe++)xe.push(v(ae.items[Pe].dataSet,$));B[ne]=xe}else{var it=void 0;ae.length<$.maxElementLength&&(it=m(U,ae)),B[ne]=it!==void 0?it:{dataOffset:ae.dataOffset,length:ae.length}}}return B}function y(U,$){return U.byteArray[$]===255&&U.byteArray[$+1]===217}function T(U,$,ne){for(var B,ae,xe=ne;xe<$.fragments.length;xe++)if(B=U,ae=xe,ae=$.fragments[ae],!(!y(B,ae.position+ae.length-2)&&!y(B,ae.position+ae.length-3)))return xe}function C(U,$,ne){if(U===void 0)throw"dicomParser.createJPEGBasicOffsetTable: missing required parameter dataSet";if($===void 0)throw"dicomParser.createJPEGBasicOffsetTable: missing required parameter pixelDataElement";if($.tag!=="x7fe00010")throw"dicomParser.createJPEGBasicOffsetTable: parameter 'pixelDataElement' refers to non pixel data tag (expected tag = x7fe00010'";if($.encapsulatedPixelData!==!0||$.hadUndefinedLength!==!0||$.basicOffsetTable===void 0||$.fragments===void 0||$.fragments.length<=0)throw"dicomParser.createJPEGBasicOffsetTable: parameter 'pixelDataElement' refers to pixel data element that does not have encapsulated pixel data";if(ne&&ne.length<=0)throw"dicomParser.createJPEGBasicOffsetTable: parameter 'fragments' must not be zero length";ne=ne||$.fragments;for(var B=[],ae=0;;){B.push($.fragments[ae].offset);var xe=T(U,$,ae);if(xe===void 0||xe===$.fragments.length-1)return B;ae=xe+1}}function w(ne){if(ne===void 0)throw"dicomParser.readTag: missing required parameter 'byteStream'";var $=256*ne.readUint16()*256,ne=ne.readUint16();return"x".concat("00000000".concat(($+ne).toString(16)).substr(-8))}function x(U,$,ne){if(U===void 0)throw"dicomParser.findEndOfEncapsulatedElement: missing required parameter 'byteStream'";if($===void 0)throw"dicomParser.findEndOfEncapsulatedElement: missing required parameter 'element'";if($.encapsulatedPixelData=!0,$.basicOffsetTable=[],$.fragments=[],w(U)!=="xfffee000")throw"dicomParser.findEndOfEncapsulatedElement: basic offset table not found";for(var B=U.readUint32()/4,ae=0;ae<B;ae++){var xe=U.readUint32();$.basicOffsetTable.push(xe)}for(var Pe=U.position;U.position<U.byteArray.length;){var it=w(U),Ct=U.readUint32();if(it==="xfffee0dd")return U.seek(Ct),void($.length=U.position-$.dataOffset);if(it!=="xfffee000")return ne&&ne.push("unexpected tag ".concat(it," while searching for end of pixel data element with undefined length")),Ct>U.byteArray.length-U.position&&(Ct=U.byteArray.length-U.position),$.fragments.push({offset:U.position-Pe-8,position:U.position,length:Ct}),U.seek(Ct),void($.length=U.position-$.dataOffset);$.fragments.push({offset:U.position-Pe-8,position:U.position,length:Ct}),U.seek(Ct)}ne&&ne.push("pixel data element ".concat($.tag," missing sequence delimiter tag xfffee0dd"))}function O(U,$){if(U===void 0)throw"dicomParser.findAndSetUNElementLength: missing required parameter 'byteStream'";for(var ne=U.byteArray.length-8;U.position<=ne;)if(U.readUint16()===65534){var B=U.readUint16();if(B===57565)return U.readUint32()!==0&&U.warnings("encountered non zero length following item delimiter at position ".concat(U.position-4," while reading element of undefined length with tag ").concat($.tag)),void($.length=U.position-$.dataOffset)}$.length=U.byteArray.length-$.dataOffset,U.seek(U.byteArray.length-U.position)}function M(U,$,ne){if(ne<0)throw"dicomParser.readFixedString - length cannot be less than 0";if($+ne>U.length)throw"dicomParser.readFixedString: attempt to read past end of buffer";for(var B,ae="",xe=0;xe<ne;xe++){if((B=U[$+xe])===0)return $+=ne,ae;ae+=String.fromCharCode(B)}return ae}function A(U,$){for(var ne=0;ne<$.length;ne++){var B=$[ne];B.enumerable=B.enumerable||!1,B.configurable=!0,"value"in B&&(B.writable=!0),Object.defineProperty(U,B.key,B)}}function _(U,$){return U.parser!==void 0?U.parser:$}var k=function(){function U(B,ae,xe){(function(Pe,it){if(!(Pe instanceof it))throw new TypeError("Cannot call a class as a function")})(this,U),this.byteArrayParser=B,this.byteArray=ae,this.elements=xe}var $,ne;return $=U,(ne=[{key:"uint16",value:function(B,ae){if(B=this.elements[B],ae=ae!==void 0?ae:0,B&&B.length!==0)return _(B,this.byteArrayParser).readUint16(this.byteArray,B.dataOffset+2*ae)}},{key:"int16",value:function(B,ae){if(B=this.elements[B],ae=ae!==void 0?ae:0,B&&B.length!==0)return _(B,this.byteArrayParser).readInt16(this.byteArray,B.dataOffset+2*ae)}},{key:"uint32",value:function(B,ae){if(B=this.elements[B],ae=ae!==void 0?ae:0,B&&B.length!==0)return _(B,this.byteArrayParser).readUint32(this.byteArray,B.dataOffset+4*ae)}},{key:"int32",value:function(B,ae){if(B=this.elements[B],ae=ae!==void 0?ae:0,B&&B.length!==0)return _(B,this.byteArrayParser).readInt32(this.byteArray,B.dataOffset+4*ae)}},{key:"float",value:function(B,ae){if(B=this.elements[B],ae=ae!==void 0?ae:0,B&&B.length!==0)return _(B,this.byteArrayParser).readFloat(this.byteArray,B.dataOffset+4*ae)}},{key:"double",value:function(B,ae){if(B=this.elements[B],ae=ae!==void 0?ae:0,B&&B.length!==0)return _(B,this.byteArrayParser).readDouble(this.byteArray,B.dataOffset+8*ae)}},{key:"numStringValues",value:function(B){if(B=this.elements[B],B&&0<B.length)return B=M(this.byteArray,B.dataOffset,B.length).match(/\\/g),B===null?1:B.length+1}},{key:"string",value:function(B,ae){if(B=this.elements[B],B&&B.Value)return B.Value;if(B&&0<B.length)return B=M(this.byteArray,B.dataOffset,B.length),0<=ae?B.split("\\")[ae].trim():B.trim()}},{key:"text",value:function(B,ae){if(B=this.elements[B],B&&0<B.length)return B=M(this.byteArray,B.dataOffset,B.length),0<=ae?B.split("\\")[ae].replace(/ +$/,""):B.replace(/ +$/,"")}},{key:"floatString",value:function(B,ae){var xe=this.elements[B];if(xe&&0<xe.length&&(ae=this.string(B,ae=ae!==void 0?ae:0),ae!==void 0))return parseFloat(ae)}},{key:"intString",value:function(B,ae){var xe=this.elements[B];if(xe&&0<xe.length&&(ae=this.string(B,ae=ae!==void 0?ae:0),ae!==void 0))return parseInt(ae)}},{key:"attributeTag",value:function(B){var ae=this.elements[B];if(ae&&ae.length===4){var xe=_(ae,this.byteArrayParser).readUint16,B=this.byteArray,ae=ae.dataOffset;return"x".concat("00000000".concat((256*xe(B,ae)*256+xe(B,ae+2)).toString(16)).substr(-8))}}}])&&A($.prototype,ne),Object.defineProperty($,"prototype",{writable:!1}),U}();function z(U,$){if(U===void 0)throw"dicomParser.readDicomElementImplicit: missing required parameter 'byteStream'";for(var ne=U.byteArray.length-8;U.position<=ne;)if(U.readUint16()===65534){var B=U.readUint16();if(B===57357)return U.readUint32()!==0&&U.warnings("encountered non zero length following item delimiter at position ".concat(U.position-4," while reading element of undefined length with tag ").concat($.tag)),void($.length=U.position-$.dataOffset)}$.length=U.byteArray.length-$.dataOffset,U.seek(U.byteArray.length-U.position)}var X=function(U,$){return U.vr!==void 0?U.vr==="SQ":$.position+4<=$.byteArray.length?(U=w($),$.seek(-4),U==="xfffee000"||U==="xfffee0dd"):($.warnings.push("eof encountered before finding sequence item tag or sequence delimiter tag in peeking to determine VR"),!1)};function Z(U,$,ne){if(U===void 0)throw"dicomParser.readDicomElementImplicit: missing required parameter 'byteStream'";var B=w(U),B={tag:B,vr:ne!==void 0?ne(B):void 0,length:U.readUint32(),dataOffset:U.position};return B.length===4294967295&&(B.hadUndefinedLength=!0),B.tag===$||(!X(B,U)||u(B.tag)&&!B.hadUndefinedLength?B.hadUndefinedLength?z(U,B):U.seek(B.length):(de(U,B,ne),u(B.tag)&&(B.items=void 0))),B}function ce(U){if(U===void 0)throw"dicomParser.readSequenceItem: missing required parameter 'byteStream'";var $={tag:w(U),length:U.readUint32(),dataOffset:U.position};if($.tag!=="xfffee000")throw"dicomParser.readSequenceItem: item tag (FFFE,E000) not found at offset ".concat(U.position);return $}function J(U,$){var ne=ce(U);return ne.length===4294967295?(ne.hadUndefinedLength=!0,ne.dataSet=function(B,ae){for(var xe={};B.position<B.byteArray.length;){var Pe=Z(B,void 0,ae);if((xe[Pe.tag]=Pe).tag==="xfffee00d")return new k(B.byteArrayParser,B.byteArray,xe)}return B.warnings.push("eof encountered before finding sequence item delimiter in sequence item of undefined length"),new k(B.byteArrayParser,B.byteArray,xe)}(U,$),ne.length=U.position-ne.dataOffset):(ne.dataSet=new k(U.byteArrayParser,U.byteArray,{}),le(ne.dataSet,U,U.position+ne.length,{vrCallback:$})),ne}function de(U,$,ne){if(U===void 0)throw"dicomParser.readSequenceItemsImplicit: missing required parameter 'byteStream'";if($===void 0)throw"dicomParser.readSequenceItemsImplicit: missing required parameter 'element'";$.items=[],($.length===4294967295?function(B,ae,xe){for(;B.position+4<=B.byteArray.length;){var Pe=w(B);if(B.seek(-4),Pe==="xfffee0dd")return ae.length=B.position-ae.dataOffset,B.seek(8);Pe=J(B,xe),ae.items.push(Pe)}B.warnings.push("eof encountered before finding sequence delimiter in sequence of undefined length"),ae.length=B.byteArray.length-ae.dataOffset}:function(B,ae,xe){for(var Pe=ae.dataOffset+ae.length;B.position<Pe;){var it=J(B,xe);ae.items.push(it)}})(U,$,ne)}function Q(U,$){var ne=ce(U);return ne.length===4294967295?(ne.hadUndefinedLength=!0,ne.dataSet=function(B,ae){for(var xe={};B.position<B.byteArray.length;){var Pe=ie(B,ae);if((xe[Pe.tag]=Pe).tag==="xfffee00d")return new k(B.byteArrayParser,B.byteArray,xe)}return ae.push("eof encountered before finding item delimiter tag while reading sequence item of undefined length"),new k(B.byteArrayParser,B.byteArray,xe)}(U,$),ne.length=U.position-ne.dataOffset):(ne.dataSet=new k(U.byteArrayParser,U.byteArray,{}),ue(ne.dataSet,U,U.position+ne.length)),ne}function q(U,$,ne){if(U===void 0)throw"dicomParser.readSequenceItemsExplicit: missing required parameter 'byteStream'";if($===void 0)throw"dicomParser.readSequenceItemsExplicit: missing required parameter 'element'";$.items=[],($.length===4294967295?function(B,ae,xe){for(;B.position+4<=B.byteArray.length;){var Pe=w(B);if(B.seek(-4),Pe==="xfffee0dd")return ae.length=B.position-ae.dataOffset,B.seek(8);Pe=Q(B,xe),ae.items.push(Pe)}xe.push("eof encountered before finding sequence delimitation tag while reading sequence of undefined length"),ae.length=B.position-ae.dataOffset}:function(B,ae,xe){for(var Pe=ae.dataOffset+ae.length;B.position<Pe;){var it=Q(B,xe);ae.items.push(it)}})(U,$,ne)}var j=function(U){return U==="OB"||U==="OD"||U==="OL"||U==="OW"||U==="SQ"||U==="OF"||U==="UC"||U==="UR"||U==="UT"||U==="UN"?4:2};function ie(U,$,ne){if(U===void 0)throw"dicomParser.readDicomElementExplicit: missing required parameter 'byteStream'";var B={tag:w(U),vr:U.readFixedString(2)};return j(B.vr)===2?B.length=U.readUint16():(U.seek(2),B.length=U.readUint32()),B.dataOffset=U.position,B.length===4294967295&&(B.hadUndefinedLength=!0),B.tag===ne||(B.vr==="SQ"?q(U,B,$):B.length===4294967295?B.tag==="x7fe00010"?x(U,B,$):(B.vr==="UN"?de:z)(U,B):U.seek(B.length)),B}function ue(U,$,ne){var B=3<arguments.length&&arguments[3]!==void 0?arguments[3]:{};if(ne=ne===void 0?$.byteArray.length:ne,$===void 0)throw"dicomParser.parseDicomDataSetExplicit: missing required parameter 'byteStream'";if(ne<$.position||ne>$.byteArray.length)throw"dicomParser.parseDicomDataSetExplicit: invalid value for parameter 'maxP osition'";for(var ae=U.elements;$.position<ne;){var xe=ie($,U.warnings,B.untilTag);if((ae[xe.tag]=xe).tag===B.untilTag)return}if($.position>ne)throw"dicomParser:parseDicomDataSetExplicit: buffer overrun"}function le(U,$,ne){var B=3<arguments.length&&arguments[3]!==void 0?arguments[3]:{};if(ne=ne===void 0?U.byteArray.length:ne,$===void 0)throw"dicomParser.parseDicomDataSetImplicit: missing required parameter 'byteStream'";if(ne<$.position||ne>$.byteArray.length)throw"dicomParser.parseDicomDataSetImplicit: invalid value for parameter 'maxPosition'";for(var ae=U.elements;$.position<ne;){var xe=Z($,B.untilTag,B.vrCallback);if((ae[xe.tag]=xe).tag===B.untilTag)return}}function Fe(U,$){if(typeof Buffer<"u"&&U instanceof Buffer)return Buffer.alloc($);if(U instanceof Uint8Array)return new Uint8Array($);throw"dicomParser.alloc: unknown type for byteArray"}var kt="1.8.12",lt={readUint16:function(U,$){if($<0)throw"bigEndianByteArrayParser.readUint16: position cannot be less than 0";if($+2>U.length)throw"bigEndianByteArrayParser.readUint16: attempt to read past end of buffer";return(U[$]<<8)+U[$+1]},readInt16:function(U,$){if($<0)throw"bigEndianByteArrayParser.readInt16: position cannot be less than 0";if($+2>U.length)throw"bigEndianByteArrayParser.readInt16: attempt to read past end of buffer";return $=(U[$]<<8)+U[$+1],$=32768&$?$-65535-1:$},readUint32:function(U,$){if($<0)throw"bigEndianByteArrayParser.readUint32: position cannot be less than 0";if($+4>U.length)throw"bigEndianByteArrayParser.readUint32: attempt to read past end of buffer";return 256*(256*(256*U[$]+U[$+1])+U[$+2])+U[$+3]},readInt32:function(U,$){if($<0)throw"bigEndianByteArrayParser.readInt32: position cannot be less than 0";if($+4>U.length)throw"bigEndianByteArrayParser.readInt32: attempt to read past end of buffer";return(U[$]<<24)+(U[$+1]<<16)+(U[$+2]<<8)+U[$+3]},readFloat:function(U,$){if($<0)throw"bigEndianByteArrayParser.readFloat: position cannot be less than 0";if($+4>U.length)throw"bigEndianByteArrayParser.readFloat: attempt to read past end of buffer";var ne=new Uint8Array(4);return ne[3]=U[$],ne[2]=U[$+1],ne[1]=U[$+2],ne[0]=U[$+3],new Float32Array(ne.buffer)[0]},readDouble:function(U,$){if($<0)throw"bigEndianByteArrayParser.readDouble: position cannot be less than 0";if($+8>U.length)throw"bigEndianByteArrayParser.readDouble: attempt to read past end of buffer";var ne=new Uint8Array(8);return ne[7]=U[$],ne[6]=U[$+1],ne[5]=U[$+2],ne[4]=U[$+3],ne[3]=U[$+4],ne[2]=U[$+5],ne[1]=U[$+6],ne[0]=U[$+7],new Float64Array(ne.buffer)[0]}};function yt(U,$,ne){if(typeof Buffer<"u"&&U instanceof Buffer)return U.slice($,$+ne);if(U instanceof Uint8Array)return new Uint8Array(U.buffer,U.byteOffset+$,ne);throw"dicomParser.from: unknown type for byteArray"}function dt(U,$){for(var ne=0;ne<$.length;ne++){var B=$[ne];B.enumerable=B.enumerable||!1,B.configurable=!0,"value"in B&&(B.writable=!0),Object.defineProperty(U,B.key,B)}}var _t=function(){function U(B,ae,xe){if(function(Pe,it){if(!(Pe instanceof it))throw new TypeError("Cannot call a class as a function")}(this,U),B===void 0)throw"dicomParser.ByteStream: missing required parameter 'byteArrayParser'";if(ae===void 0)throw"dicomParser.ByteStream: missing required parameter 'byteArray'";if(!(ae instanceof Uint8Array)&&(typeof Buffer>"u"||!(ae instanceof Buffer)))throw"dicomParser.ByteStream: parameter byteArray is not of type Uint8Array or Buffer";if(xe<0)throw"dicomParser.ByteStream: parameter 'position' cannot be less than 0";if(xe>=ae.length)throw"dicomParser.ByteStream: parameter 'position' cannot be greater than or equal to 'byteArray' length";this.byteArrayParser=B,this.byteArray=ae,this.position=xe||0,this.warnings=[]}var $,ne;return $=U,(ne=[{key:"seek",value:function(B){if(this.position+B<0)throw"dicomParser.ByteStream.prototype.seek: cannot seek to position < 0";this.position+=B}},{key:"readByteStream",value:function(B){if(this.position+B>this.byteArray.length)throw"dicomParser.ByteStream.prototype.readByteStream: readByteStream - buffer overread";var ae=yt(this.byteArray,this.position,B);return this.position+=B,new U(this.byteArrayParser,ae)}},{key:"getSize",value:function(){return this.byteArray.length}},{key:"readUint16",value:function(){var B=this.byteArrayParser.readUint16(this.byteArray,this.position);return this.position+=2,B}},{key:"readUint32",value:function(){var B=this.byteArrayParser.readUint32(this.byteArray,this.position);return this.position+=4,B}},{key:"readFixedString",value:function(B){var ae=M(this.byteArray,this.position,B);return this.position+=B,ae}}])&&dt($.prototype,ne),Object.defineProperty($,"prototype",{writable:!1}),U}(),Ke={readUint16:function(U,$){if($<0)throw"littleEndianByteArrayParser.readUint16: position cannot be less than 0";if($+2>U.length)throw"littleEndianByteArrayParser.readUint16: attempt to read past end of buffer";return U[$]+256*U[$+1]},readInt16:function(U,$){if($<0)throw"littleEndianByteArrayParser.readInt16: position cannot be less than 0";if($+2>U.length)throw"littleEndianByteArrayParser.readInt16: attempt to read past end of buffer";return $=U[$]+(U[$+1]<<8),$=32768&$?$-65535-1:$},readUint32:function(U,$){if($<0)throw"littleEndianByteArrayParser.readUint32: position cannot be less than 0";if($+4>U.length)throw"littleEndianByteArrayParser.readUint32: attempt to read past end of buffer";return U[$]+256*U[$+1]+256*U[$+2]*256+256*U[$+3]*256*256},readInt32:function(U,$){if($<0)throw"littleEndianByteArrayParser.readInt32: position cannot be less than 0";if($+4>U.length)throw"littleEndianByteArrayParser.readInt32: attempt to read past end of buffer";return U[$]+(U[$+1]<<8)+(U[$+2]<<16)+(U[$+3]<<24)},readFloat:function(U,$){if($<0)throw"littleEndianByteArrayParser.readFloat: position cannot be less than 0";if($+4>U.length)throw"littleEndianByteArrayParser.readFloat: attempt to read past end of buffer";var ne=new Uint8Array(4);return ne[0]=U[$],ne[1]=U[$+1],ne[2]=U[$+2],ne[3]=U[$+3],new Float32Array(ne.buffer)[0]},readDouble:function(U,$){if($<0)throw"littleEndianByteArrayParser.readDouble: position cannot be less than 0";if($+8>U.length)throw"littleEndianByteArrayParser.readDouble: attempt to read past end of buffer";var ne=new Uint8Array(8);return ne[0]=U[$],ne[1]=U[$+1],ne[2]=U[$+2],ne[3]=U[$+3],ne[4]=U[$+4],ne[5]=U[$+5],ne[6]=U[$+6],ne[7]=U[$+7],new Float64Array(ne.buffer)[0]}};function Ye(U){var $=1<arguments.length&&arguments[1]!==void 0?arguments[1]:{};if(U===void 0)throw"dicomParser.readPart10Header: missing required parameter 'byteArray'";var ne=$.TransferSyntaxUID,B=new _t(Ke,U);return function(){var ae=function(){if(B.getSize()<=132&&ne)return!1;if(B.seek(128),B.readFixedString(4)==="DICM")return!0;if(!($||{}).TransferSyntaxUID)throw"dicomParser.readPart10Header: DICM prefix not found at location 132 - this is not a valid DICOM P10 file.";return B.seek(0),!1}(),xe=[],Pe={};if(!ae)return B.position=0,{elements:{x00020010:{tag:"x00020010",vr:"UI",Value:ne}},warnings:xe};for(;B.position<B.byteArray.length;){var it=B.position,Ct=ie(B,xe);if("x0002ffff"<Ct.tag){B.position=it;break}Ct.parser=Ke,Pe[Ct.tag]=Ct}return(ae=new k(B.byteArrayParser,B.byteArray,Pe)).warnings=B.warnings,ae.position=B.position,ae}()}var Zt="1.2.840.10008.1.2.2";function jr(U){var $=1<arguments.length&&arguments[1]!==void 0?arguments[1]:{};if(U===void 0)throw new Error("dicomParser.parseDicom: missing required parameter 'byteArray'");var ne,B=function(xe){if(xe.elements.x00020010===void 0)throw new Error("dicomParser.parseDicom: missing required meta header attribute 0002,0010");return xe=xe.elements.x00020010,xe&&xe.Value||M(U,xe.dataOffset,xe.length)};function ae(Ct){var it=B(Ct),Pe=it!=="1.2.840.10008.1.2",it=function(Qt,At){var gn=Object.prototype.toString.call(typeof process<"u"?process:0)==="[object process]";if(Qt!=="1.2.840.10008.1.2.1.99")return new _t(Qt===Zt?lt:Ke,U,At);if($&&$.inflater)return Qt=$.inflater(U,At),new _t(Ke,Qt,0);if(gn==!0){var Pt=c(0),Tt=yt(U,At,U.length-At),Pt=Pt.inflateRawSync(Tt),Tt=Fe(U,Pt.length+At);return U.copy(Tt,0,0,At),Pt.copy(Tt,At),new _t(Ke,Tt,0)}if(typeof pako>"u")throw"dicomParser.parseDicom: no inflater available to handle deflate transfer syntax";return Pt=U.slice(At),Tt=pako.inflateRaw(Pt),(Pt=Fe(U,Tt.length+At)).set(U.slice(0,At),0),Pt.set(Tt,At),new _t(Ke,Pt,0)}(it,Ct.position),Ct=new k(it.byteArrayParser,it.byteArray,{});Ct.warnings=it.warnings;try{(Pe?ue:le)(Ct,it,it.byteArray.length,$)}catch(Qt){throw{exception:Qt,dataSet:Ct}}return Ct}return function(xe,Pe){for(var it in xe.elements)xe.elements.hasOwnProperty(it)&&(Pe.elements[it]=xe.elements[it]);return xe.warnings!==void 0&&(Pe.warnings=xe.warnings.concat(Pe.warnings)),Pe}(ne=Ye(U,$),ae(ne))}var Cr=function(U,$,ne){for(var B=0,ae=$;ae<$+ne;ae++)B+=U[ae].length;return B};function $t(U,Pe,ne,B,ae){if(ae=ae||Pe.fragments,U===void 0)throw"dicomParser.readEncapsulatedPixelDataFromFragments: missing required parameter 'dataSet'";if(Pe===void 0)throw"dicomParser.readEncapsulatedPixelDataFromFragments: missing required parameter 'pixelDataElement'";if(ne===void 0)throw"dicomParser.readEncapsulatedPixelDataFromFragments: missing required parameter 'startFragmentIndex'";if((B=B||1)===void 0)throw"dicomParser.readEncapsulatedPixelDataFromFragments: missing required parameter 'numFragments'";if(Pe.tag!=="x7fe00010")throw"dicomParser.readEncapsulatedPixelDataFromFragments: parameter 'pixelDataElement' refers to non pixel data tag (expected tag = x7fe00010";if(Pe.encapsulatedPixelData!==!0||Pe.hadUndefinedLength!==!0||Pe.basicOffsetTable===void 0||Pe.fragments===void 0||Pe.fragments.length<=0)throw"dicomParser.readEncapsulatedPixelDataFromFragments: parameter 'pixelDataElement' refers to pixel data element that does not have encapsulated pixel data";if(ne<0)throw"dicomParser.readEncapsulatedPixelDataFromFragments: parameter 'startFragmentIndex' must be >= 0";if(ne>=Pe.fragments.length)throw"dicomParser.readEncapsulatedPixelDataFromFragments: parameter 'startFragmentIndex' must be < number of fragments";if(B<1)throw"dicomParser.readEncapsulatedPixelDataFromFragments: parameter 'numFragments' must be > 0";if(ne+B>Pe.fragments.length)throw"dicomParser.readEncapsulatedPixelDataFromFragments: parameter 'startFragment' + 'numFragments' < number of fragments";var xe=new _t(U.byteArrayParser,U.byteArray,Pe.dataOffset),Pe=ce(xe);if(Pe.tag!=="xfffee000")throw"dicomParser.readEncapsulatedPixelData: missing basic offset table xfffee000";xe.seek(Pe.length);var it=xe.position;if(B===1)return yt(xe.byteArray,it+ae[ne].offset+8,ae[ne].length);for(var Pe=Cr(ae,ne,B),Ct=Fe(xe.byteArray,Pe),Qt=0,At=ne;At<ne+B;At++)for(var gn=it+ae[At].offset+8,Pt=0;Pt<ae[At].length;Pt++)Ct[Qt++]=xe.byteArray[gn++];return Ct}var Pn=function(U,$){for(var ne=0;ne<U.length;ne++)if(U[ne].offset===$)return ne},Nn=function(U,$,ne,B){if(U===$.length-1)return ne.length-B;for(var ae=$[U+1],xe=B+1;xe<ne.length;xe++)if(ne[xe].offset===ae)return xe-B;throw"dicomParser.calculateNumberOfFragmentsForFrame: could not find fragment with offset matching basic offset table"};function fn(U,$,ne,B,ae){if(B=B||$.basicOffsetTable,ae=ae||$.fragments,U===void 0)throw"dicomParser.readEncapsulatedImageFrame: missing required parameter 'dataSet'";if($===void 0)throw"dicomParser.readEncapsulatedImageFrame: missing required parameter 'pixelDataElement'";if(ne===void 0)throw"dicomParser.readEncapsulatedImageFrame: missing required parameter 'frameIndex'";if(B===void 0)throw"dicomParser.readEncapsulatedImageFrame: parameter 'pixelDataElement' does not have basicOffsetTable";if($.tag!=="x7fe00010")throw"dicomParser.readEncapsulatedImageFrame: parameter 'pixelDataElement' refers to non pixel data tag (expected tag = x7fe00010)";if($.encapsulatedPixelData!==!0)throw"dicomParser.readEncapsulatedImageFrame: parameter 'pixelDataElement' refers to pixel data element that does not have encapsulated pixel data";if($.hadUndefinedLength!==!0)throw"dicomParser.readEncapsulatedImageFrame: parameter 'pixelDataElement' refers to pixel data element that does not have undefined length";if($.fragments===void 0)throw"dicomParser.readEncapsulatedImageFrame: parameter 'pixelDataElement' refers to pixel data element that does not have fragments";if(B.length===0)throw"dicomParser.readEncapsulatedImageFrame: basicOffsetTable has zero entries";if(ne<0)throw"dicomParser.readEncapsulatedImageFrame: parameter 'frameIndex' must be >= 0";if(ne>=B.length)throw"dicomParser.readEncapsulatedImageFrame: parameter 'frameIndex' must be < basicOffsetTable.length";var xe=B[ne],xe=Pn(ae,xe);if(xe===void 0)throw"dicomParser.readEncapsulatedImageFrame: unable to find fragment that matches basic offset table entry";return $t(U,$,xe,Nn(ne,B,ae,xe),ae)}var Hr=!1;function cr(U,$,ne){if(Hr||(Hr=!0,console&&console.log&&console.log("WARNING: dicomParser.readEncapsulatedPixelData() has been deprecated")),U===void 0)throw"dicomParser.readEncapsulatedPixelData: missing required parameter 'dataSet'";if($===void 0)throw"dicomParser.readEncapsulatedPixelData: missing required parameter 'element'";if(ne===void 0)throw"dicomParser.readEncapsulatedPixelData: missing required parameter 'frame'";if($.tag!=="x7fe00010")throw"dicomParser.readEncapsulatedPixelData: parameter 'element' refers to non pixel data tag (expected tag = x7fe00010)";if($.encapsulatedPixelData!==!0||$.hadUndefinedLength!==!0||$.basicOffsetTable===void 0||$.fragments===void 0)throw"dicomParser.readEncapsulatedPixelData: parameter 'element' refers to pixel data element that does not have encapsulated pixel data";if(ne<0)throw"dicomParser.readEncapsulatedPixelData: parameter 'frame' must be >= 0";return $.basicOffsetTable.length!==0?fn(U,$,ne):$t(U,$,0,$.fragments.length)}s.default={isStringVr:f,isPrivateTag:u,parsePN:g,parseTM:d,parseDA:p,explicitElementToString:m,explicitDataSetToJS:v,createJPEGBasicOffsetTable:C,parseDicomDataSetExplicit:ue,parseDicomDataSetImplicit:le,readFixedString:M,alloc:Fe,version:kt,bigEndianByteArrayParser:lt,ByteStream:_t,sharedCopy:yt,DataSet:k,findAndSetUNElementLength:O,findEndOfEncapsulatedElement:x,findItemDelimitationItemAndSetElementLength:z,littleEndianByteArrayParser:Ke,parseDicom:jr,readDicomElementExplicit:ie,readDicomElementImplicit:Z,readEncapsulatedImageFrame:fn,readEncapsulatedPixelData:cr,readEncapsulatedPixelDataFromFragments:$t,readPart10Header:Ye,readSequenceItemsExplicit:q,readSequenceItemsImplicit:de,readSequenceItem:ce,readTag:w,LEI:"1.2.840.10008.1.2",LEE:"1.2.840.10008.1.2.1"}}],a={},r.m=i,r.c=a,r.d=function(o,s,c){r.o(o,s)||Object.defineProperty(o,s,{enumerable:!0,get:c})},r.r=function(o){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(o,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(o,"__esModule",{value:!0})},r.t=function(o,s){if(1&s&&(o=r(o)),8&s||4&s&&typeof o=="object"&&o&&o.__esModule)return o;var c=Object.create(null);if(r.r(c),Object.defineProperty(c,"default",{enumerable:!0,value:o}),2&s&&typeof o!="string")for(var l in o)r.d(c,l,(function(f){return o[f]}).bind(null,l));return c},r.n=function(o){var s=o&&o.__esModule?function(){return o.default}:function(){return o};return r.d(s,"a",s),s},r.o=function(o,s){return Object.prototype.hasOwnProperty.call(o,s)},r.p="",r(r.s=1);function r(o){if(a[o])return a[o].exports;var s=a[o]={i:o,l:!1,exports:{}};return i[o].call(s.exports,s,s.exports,r),s.l=!0,s.exports}var i,a})})(kM);var Rn=kM.exports;function _2(t){const e=t.indexOf(":");let n=t.substring(e+1);const r=n.indexOf("frame=");let i;if(r!==-1){const s=n.substring(r+6);i=parseInt(s,10),n=n.substring(0,r-1)}const a=t.substring(0,e),o=i!==void 0?i-1:void 0;return{scheme:a,url:n,frame:i,pixelDataFrame:o}}let ov={open(t,e){t.open("get",e,!0)},beforeSend(){},beforeProcessing(t){return Promise.resolve(t.response)},imageCreated(){},strict:!1};function Bee(t){ov=Object.assign(ov,t)}function b2(){return ov}function By(t,e,n={},r={}){const i=b2(),a=c=>{if(typeof i.errorInterceptor=="function"){const l=new Error("request failed");l.request=c,l.response=c.response,l.status=c.status,i.errorInterceptor(l)}},o=new XMLHttpRequest,s=new Promise((c,l)=>{i.open(o,t,n,r);const f=i.beforeSend(o,e,n,r);o.responseType="arraybuffer";const u=Object.assign({},n,f);Object.keys(u).forEach(function(g){u[g]!==null&&(g==="Accept"&&t.indexOf("accept=")!==-1||o.setRequestHeader(g,u[g]))}),r.deferred={resolve:c,reject:l},r.url=t,r.imageId=e,o.onloadstart=function(g){i.onloadstart&&i.onloadstart(g,r),De(Ee,"cornerstoneimageloadstart",{url:t,imageId:e})},o.onloadend=function(g){i.onloadend&&i.onloadend(g,r),De(Ee,"cornerstoneimageloadend",{url:t,imageId:e})},o.onreadystatechange=function(g){i.onreadystatechange&&i.onreadystatechange(g,r),o.readyState===4&&(o.status===200||o.status===206?i.beforeProcessing(o).then(c).catch(()=>{a(o),l(o)}):(a(o),l(o)))},o.onprogress=function(g){const d=g.loaded;let h,p;g.lengthComputable&&(h=g.total,p=Math.round(d/h*100)),De(Ee,"cornerstoneimageloadprogress",{url:t,imageId:e,loaded:d,total:h,percentComplete:p}),i.onprogress&&i.onprogress(g,r)},o.onerror=function(){a(o),l(o)},o.onabort=function(){a(o),l(o)},o.send()});return s.xhr=o,s}function Gee(t,e,n){if(n+t.length>e.length)return!1;let r=n;for(let i=0;i<t.length;i++)if(t[i]!==e[r++])return!1;return!0}function $ee(t){const e=new Uint8Array(t.length);for(let n=0,r=t.length;n<r;n++)e[n]=t.charCodeAt(n);return e}function tT(t,e,n){n=n||0;const r=$ee(e);for(let i=n;i<t.length;i++)if(r[0]===t[i]&&Gee(r,t,i))return i;return-1}const{ImageQualityStatus:nT}=Cs;function Gy(t,e,n){n||(n={});const r=new Uint8Array(e),i=!!(n!=null&&n.isPartial);if(t.indexOf("multipart")===-1)return{contentType:t,imageQualityStatus:i?nT.SUBRESOLUTION:nT.FULL_RESOLUTION,pixelData:r};let{tokenIndex:a,responseHeaders:o,boundary:s,multipartContentType:c}=n;if(a||(a=tT(r,`\r
\r
`)),a===-1)throw new Error("invalid response - no multipart mime header");if(!s&&(o=jee(r,0,a).split(`\r
`),s=Wee(o),!s))throw new Error("invalid response - no boundary marker");const l=a+4,f=tT(r,s,l);if(f===-1&&!i)throw new Error("invalid response - terminating boundary not found");return c||(c=zee(o)),n.tokenIndex=a,n.boundary=s,n.responseHeaders=o,n.multipartContentType=c,n.isPartial=f===-1,{contentType:c,extractDone:!i||f!==-1,tokenIndex:a,responseHeaders:o,boundary:s,multipartContentType:c,pixelData:e.slice(l,f-2)}}function Wee(t){for(let e=0;e<t.length;e++)if(t[e].substr(0,2)==="--")return t[e]}function zee(t){for(let e=0;e<t.length;e++)if(t[e].substr(0,13)==="Content-Type:")return t[e].substr(13).trim()}function jee(t,e,n){e=e||0,n=n||t.length-e;let r="";for(let i=e;i<e+n;i++)r+=String.fromCharCode(t[i]);return r}const{ImageQualityStatus:rT}=Cs;function $y(t,e=!0){return e?t.imageQualityStatus??rT.FULL_RESOLUTION:rT.SUBRESOLUTION}const{ProgressiveIterator:Hee}=ws;function Kee(t,e,n={},r={}){const i=b2(),{retrieveOptions:a={},streamingData:o={}}=r,s=a.minChunkSize||128*1024,c=f=>{if(typeof i.errorInterceptor=="function"){const u=new Error("request failed");i.errorInterceptor(u)}},l=new Hee("streamRequest");return l.generate(async(f,u)=>{var h,p;const g=(h=i.beforeSend)==null?void 0:h.call(i,null,t,n,{}),d=Object.assign({},n,g);Object.keys(d).forEach(function(m){d[m]===null&&(d[m]=void 0),m==="Accept"&&t.indexOf("accept=")!==-1&&(d[m]=void 0)});try{const m=await fetch(t,{headers:d,signal:void 0});if(m.status!==200)throw new Error(`Couldn't retrieve ${t} got status ${m.status}`);const v=m.body.getReader(),y=m.headers,T=y.get("content-type"),C=Number(y.get("Content-Length"));let w=!1,x=o.encodedData,O=o.lastSize||0;for(o.isPartial=!0;!w;){const{done:M,value:A}=await v.read();if(x=qee(x,A),!x){if(w)throw new Error(`Done but no image frame available ${e}`);continue}if(w=M||x.byteLength===C,!w&&x.length<O+s)continue;O=x.length,o.isPartial=!M;const _=Gy(T,x,o),k=$y(a,w),z={url:t,imageId:e,..._,percentComplete:M?100:((p=_.pixelData)==null?void 0:p.length)*100/C,imageQualityStatus:k,done:w};f.add(z,w)}}catch(m){c(),console.error(m),u(m)}}),l.getNextPromise()}function qee(t,e){if(!t)return e;if(!e)return t;const n=new Uint8Array(t.length+e.length);return n.set(t,0),n.set(e,t.length),n}function Xee(t){const e=t.elements.x7fe00010.fragments,n=t.byteArray.length;for(const r of e){const{position:i,length:a}=r;a>n-i&&(console.log(`Truncated fragment, changing fragment length from ${r.length} to ${n-i}`),r.length=n-i)}return t}function Yee(t){let e=Rn.parseDicom(t,{untilTag:"x7fe00010"});e.elements.x7fe00010||console.warn("Pixel data not found!");let n;try{n=Rn.parseDicom(t)}catch(r){console.error(r),console.log("pixel data dataset:",r.dataSet),n=r.dataSet}return e.elements.x7fe00010=n.elements.x7fe00010,e=Xee(e),e}async function AM(t,e,n){const r=Yee(t),{uri:i,imageId:a,fileTotalLength:o}=n;return r.fetchMore=async function(s){const c=Object.assign({uri:i,imageId:a,fetchedLength:t.length,lengthToFetch:o-t.length},s),{fetchedLength:l,lengthToFetch:f}=c,{arrayBuffer:u}=await e(i,a,{byteRange:`${l}-${l+f}`}),g=new Uint8Array(u),d=new Uint8Array(r.byteArray.length+g.length);return d.set(r.byteArray),d.set(g,r.byteArray.length),AM(d,e,n)},r}function Zee(t,e){if(!t)return;const{NumberOfFrames:n,PerFrameFunctionalGroupsSequence:r,SharedFunctionalGroupsSequence:i}=UM(t);if(r||n>1){const{shared:a,perFrame:o}=FM(r,i,e);return{NumberOfFrames:n,PerFrameFunctionalInformation:o,SharedFunctionalInformation:a}}return{NumberOfFrames:n}}function FM(t,e,n){const r={};(e?Object.values(e.items[0].dataSet.elements):[]).map(a=>r[a.tag]=a);const i={};return(t?Object.values(t.items[n-1].dataSet.elements):[]).map(a=>i[a.tag]=a),{shared:r,perFrame:i}}function UM(t){if(!t)return;const{elements:e,...n}=t,{x52009230:r,x52009229:i,...a}=e;return{NumberOfFrames:t.intString("x00280008"),PerFrameFunctionalGroupsSequence:r,SharedFunctionalGroupsSequence:i,otherElements:a,otherAttributtes:n}}function Qee(t,e){if(!e)return;const{NumberOfFrames:n,PerFrameFunctionalGroupsSequence:r,SharedFunctionalGroupsSequence:i,otherElements:a}=UM(e);if(r||n>1){const{shared:o,perFrame:s}=FM(r,i,t),c={elements:{...a,...o,...s}},l=Object.create(e);return Object.assign(l,c)}return e}let ar={};const Jee=()=>{ar={}};function Wy(t){if(ar[t])return ar[t]}function ete(t){const e=Wy(t);return BM(e)}function BM(t){if(!t)return!1;const e=t.intString("x00280008");return e&&e>1}function tte(t){return t.indexOf("&frame=")}function nte(t){const e=tte(t),n=e===-1?t:t.slice(0,e),r=parseInt(t.slice(e+7),10)||1;let i;return ar[n]?i=ar[n].dataSet:i=void 0,{dataSet:i,frame:r}}function rte(t){const e=[],n=Wy(t);if(BM(n)){const r=n.intString("x00280008");for(let i=1;i<=r;i++)e.push(`${t}&frame=${i}`)}else e.push(t);return e}const GM={_get:Wy,generateMultiframeWADOURIs:rte,retrieveMultiframeDataset:nte,isMultiframeDataset:ete};let Pu=0,x0={};function ite(t){return ar[t]!==void 0}function ate(t){let e;if(t.includes("&frame=")){const{frame:n,dataSet:r}=GM.retrieveMultiframeDataset(t);e=Qee(n,r)}else ar[t]&&(e=ar[t].dataSet);return e}function ote(t,e){const n=ar[t];if(!n){console.error(`No loaded dataSet for uri ${t}`);return}Pu-=n.dataSet.byteArray.length,n.dataSet=e,Pu+=e.byteArray.length,De(Ee,"datasetscachechanged",{uri:t,action:"updated",cacheInfo:L2()})}function ste(t,e=By,n){if(ar[t])return new Promise(a=>{ar[t].cacheCount++,a(ar[t].dataSet)});if(x0[t])return x0[t].cacheCount++,x0[t];const r=e(t,n),i=new Promise((a,o)=>{r.then(async function(s){const c={isPartialContent:!1,fileTotalLength:null};if(!(s instanceof ArrayBuffer)){if(!s.arrayBuffer)return o(new Error("If not returning ArrayBuffer, must return object with `arrayBuffer` parameter"));c.isPartialContent=s.flags.isPartialContent,c.fileTotalLength=s.flags.fileTotalLength,s=s.arrayBuffer}const l=new Uint8Array(s);let f;try{c.isPartialContent?f=await AM(l,e,{uri:t,imageId:n,fileTotalLength:c.fileTotalLength}):f=Rn.parseDicom(l)}catch(u){return o(u)}ar[t]={dataSet:f,cacheCount:i.cacheCount},Pu+=f.byteArray.length,a(f),De(Ee,"datasetscachechanged",{uri:t,action:"loaded",cacheInfo:L2()})},o).then(()=>{delete x0[t]},()=>{delete x0[t]})});return i.cacheCount=1,x0[t]=i,i}function cte(t){ar[t]&&(ar[t].cacheCount--,ar[t].cacheCount===0&&(Pu-=ar[t].dataSet.byteArray.length,delete ar[t],De(Ee,"datasetscachechanged",{uri:t,action:"unloaded",cacheInfo:L2()})))}function L2(){return{cacheSizeInBytes:Pu,numberOfDataSetsCached:Object.keys(ar).length}}function lte(){Jee(),x0={},Pu=0}const ug={isLoaded:ite,load:ste,unload:cte,getInfo:L2,purge:lte,get:ate,update:ote};function ute(t){const e=[];for(let n=0;n<=30;n+=2){let r=`x60${n.toString(16)}`;r.length===4&&(r=`x600${n.toString(16)}`);const i=t.elements[`${r}3000`];if(!i)continue;const a=[];for(let o=0;o<i.length;o++)for(let s=0;s<8;s++){const c=t.byteArray[i.dataOffset+o];a[o*8+s]=c>>s&1}e.push({rows:t.uint16(`${r}0010`),columns:t.uint16(`${r}0011`),type:t.string(`${r}0040`),x:t.int16(`${r}0050`,1)-1,y:t.int16(`${r}0050`,0)-1,pixelData:a,description:t.string(`${r}0022`),label:t.string(`${r}1500`),roiArea:t.string(`${r}1301`),roiMean:t.string(`${r}1302`),roiStandardDeviation:t.string(`${r}1303`)})}return{overlays:e}}function nf(t){return t==="RECON TOMO"||t==="RECON GATED TOMO"}function zy(t,e){const n=t.string("x00080008");if(n){const r=n.split("\\");if(r.length>e)return r[e]}}function fte(t){let e;const n=t.string("x00080060");if(n!=null&&n.includes("NM")){const r=zy(t,2);r&&nf(r)&&t.elements.x00540022&&(e=xo(t.elements.x00540022.items[0].dataSet,"x00200037",6))}return e}function gte(t){let e;const n=t.string("x00080060");if(n!=null&&n.includes("NM")){const r=zy(t,2);r&&nf(r)&&t.elements.x00540022&&(e=xo(t.elements.x00540022.items[0].dataSet,"x00200032",3))}return e}function iT(t){let e=xo(t,"x00200037",6);return!e&&t.elements.x00209116&&(e=xo(t.elements.x00209116.items[0].dataSet,"x00200037",6)),e||(e=fte(t)),e}function aT(t){let e=xo(t,"x00200032",3);return!e&&t.elements.x00209113&&(e=xo(t.elements.x00209113.items[0].dataSet,"x00200032",3)),e||(e=gte(t)),e}function oT(t){let e=xo(t,"x00280030",2);return!e&&t.elements.x00289110&&(e=xo(t.elements.x00289110.items[0].dataSet,"x00280030",2)),e}function sT(t){let e;return t.elements.x00180050?e=t.floatString("x00180050"):t.elements.x00289110&&t.elements.x00289110.items.length&&t.elements.x00289110.items[0].dataSet.elements.x00180050&&(e=t.elements.x00289110.items[0].dataSet.floatString("x00180050")),e}function $M(t,e,n){const r={};for(const i of n)try{const a=e(i,t);if(a){const o={};for(const s in a)if(s in a){const c=dte(s);o[c]=a[s]}Object.assign(r,o)}}catch(a){console.error(`Error retrieving ${i} data:`,a)}return r}const dte=t=>t.charAt(0).toUpperCase()+t.slice(1),WM=["multiframeModule","generalSeriesModule","patientStudyModule","imagePlaneModule","nmMultiframeGeometryModule","imagePixelModule","modalityLutModule","voiLutModule","sopCommonModule","petIsotopeModule","overlayPlaneModule","transferSyntax","petSeriesModule","petImageModule"];function cT(t){const e=t.elements.x00186011;return!e||!e.items?[]:e.items.map(r=>{const i=r.dataSet.double("x0018602c"),a=r.dataSet.double("x0018602e"),o=r.dataSet.uint16("x00186024"),s=r.dataSet.uint16("x00186026"),c=r.dataSet.uint16("x0018601a"),l=r.dataSet.uint16("x0018601e"),f=r.dataSet.uint16("x00186018"),u=r.dataSet.uint16("x0018601c"),g=r.dataSet.int32("x00186020")||null,d=r.dataSet.int32("x00186022")||null,h=r.dataSet.uint16("x0018602a"),p=r.dataSet.uint16("x00186028"),m=r.dataSet.uint16("x00186012"),v=r.dataSet.uint16("x00186014"),y=r.dataSet.uint16("x00186016"),T=r.dataSet.uint16("x00186030");return{regionLocationMinY0:c,regionLocationMaxY1:l,regionLocationMinX0:f,regionLocationMaxX1:u,referencePixelX0:g,referencePixelY0:d,physicalDeltaX:i,physicalDeltaY:a,physicalUnitsXDirection:o,physicalUnitsYDirection:s,referencePhysicalPixelValueY:h,referencePhysicalPixelValueX:p,regionSpatialFormat:m,regionDataType:v,regionFlags:y,transducerFrequency:T}})}function zM(t,e){const{MetadataModules:n}=Cs;if(Array.isArray(e))return;const r=_2(e);if(t===n.MULTIFRAME){const o=GM.retrieveMultiframeDataset(r.url);return o.dataSet?Zee(o.dataSet,o.frame):void 0}let i=r.url;r.frame&&(i=`${i}&frame=${r.frame}`);const a=ug.get(i);if(a)return pte(t,e,a)}function pte(t,e,n){const{MetadataModules:r}=Cs;if(t===r.GENERAL_STUDY)return{studyDescription:n.string("x00081030"),studyDate:Rn.parseDA(n.string("x00080020")),studyTime:Rn.parseTM(n.string("x00080030")||""),accessionNumber:n.string("x00080050")};if(t===r.GENERAL_SERIES)return{modality:n.string("x00080060"),seriesInstanceUID:n.string("x0020000e"),seriesNumber:n.intString("x00200011"),studyInstanceUID:n.string("x0020000d"),seriesDate:Rn.parseDA(n.string("x00080021")),seriesTime:Rn.parseTM(n.string("x00080031")||""),acquisitionDate:Rn.parseDA(n.string("x00080022")),acquisitionTime:Rn.parseTM(n.string("x00080032")||"")};if(t===r.GENERAL_IMAGE)return{sopInstanceUID:n.string("x00080018"),instanceNumber:n.intString("x00200013"),lossyImageCompression:n.string("x00282110"),lossyImageCompressionRatio:n.floatString("x00282112"),lossyImageCompressionMethod:n.string("x00282114")};if(t===r.PATIENT)return{patientID:n.string("x00100020"),patientName:n.string("x00100010")};if(t===r.PATIENT_STUDY)return{patientAge:n.intString("x00101010"),patientSize:n.floatString("x00101020"),patientSex:n.string("x00100040"),patientWeight:n.floatString("x00101030")};if(t===r.NM_MULTIFRAME_GEOMETRY){const i=n.string("x00080060"),a=zy(n,2);return{modality:i,imageType:n.string("x00080008"),imageSubType:a,imageOrientationPatient:iT(n),imagePositionPatient:aT(n),sliceThickness:sT(n),pixelSpacing:oT(n),numberOfFrames:n.uint16("x00280008"),isNMReconstructable:nf(a)&&i.includes("NM")}}if(t===r.IMAGE_PLANE){const i=iT(n),a=aT(n),o=oT(n),s=sT(n);let c=null,l=null;o&&(l=o[0],c=o[1]);let f=null,u=null;return i&&(f=[parseFloat(i[0]),parseFloat(i[1]),parseFloat(i[2])],u=[parseFloat(i[3]),parseFloat(i[4]),parseFloat(i[5])]),{frameOfReferenceUID:n.string("x00200052"),rows:n.uint16("x00280010"),columns:n.uint16("x00280011"),imageOrientationPatient:i,rowCosines:f,columnCosines:u,imagePositionPatient:a,sliceThickness:s,sliceLocation:n.floatString("x00201041"),pixelSpacing:o,rowPixelSpacing:l,columnPixelSpacing:c}}if(t===r.CINE)return{frameTime:n.floatString("x00181063")};if(t===r.IMAGE_PIXEL)return kee(n);if(t===r.VOI_LUT){const i=Uee(n);return{windowCenter:xo(n,"x00281050",1),windowWidth:xo(n,"x00281051",1),voiLUTSequence:eT(i,n.elements.x00283010),voiLUTFunction:n.string("x00281056")}}if(t===r.MODALITY_LUT)return{rescaleIntercept:n.floatString("x00281052"),rescaleSlope:n.floatString("x00281053"),rescaleType:n.string("x00281054"),modalityLUTSequence:eT(n.uint16("x00280103"),n.elements.x00283000)};if(t===r.SOP_COMMON)return{sopClassUID:n.string("x00080016"),sopInstanceUID:n.string("x00080018")};if(t===r.PET_ISOTOPE){const i=n.elements.x00540016;if(i===void 0)return;const a=i.items[0].dataSet;return{radiopharmaceuticalInfo:{radiopharmaceuticalStartTime:Rn.parseTM(a.string("x00181072")||""),radionuclideTotalDose:a.floatString("x00181074"),radionuclideHalfLife:a.floatString("x00181075")}}}if(t===r.OVERLAY_PLANE)return ute(n);if(t==="transferSyntax"){let i;try{i=n.string("x00020010")}catch{}return{transferSyntaxUID:i}}if(t===r.PET_SERIES)return{correctedImage:n.string("x00280051"),units:n.string("x00541001"),decayCorrection:n.string("x00541102")};if(t===r.PET_IMAGE)return{frameReferenceTime:n.floatString(n.string("x00541300")||""),actualFrameDuration:n.intString(n.string("x00181242"))};if(t===r.ULTRASOUND_ENHANCED_REGION)return cT(n);if(t===r.CALIBRATION&&n.string("x00080060")==="US")return{sequenceOfUltrasoundRegions:cT(n)};if(t==="instance")return $M(e,zM,WM)}let I2=[];function hte(t){return`dicomfile:${I2.push(t)-1}`}function mte(t){return I2[t]}function vte(t){I2[t]=void 0}function yte(){I2=[]}const Tte={add:hte,get:mte,remove:vte,purge:yte};function Cte(t){const e=t.intString("x00280008"),n=t.elements.x7fe00010;return e!==n.fragments.length}function wte(t,e){if(t.elements.x7fe00010&&t.elements.x7fe00010.basicOffsetTable.length)return Rn.readEncapsulatedImageFrame(t,t.elements.x7fe00010,e);if(Cte(t)){const l=Rn.createJPEGBasicOffsetTable(t,t.elements.x7fe00010);return Rn.readEncapsulatedImageFrame(t,t.elements.x7fe00010,e,l)}const n=t.elements.x7fe00010.fragments,r=new Rn.ByteStream(t.byteArrayParser,t.byteArray,t.elements.x7fe00010.dataOffset),i=Rn.readSequenceItem(r);if(i.tag!=="xfffee000")throw"dicomParser.readEncapsulatedPixelData: missing basic offset table xfffee000";r.seek(i.length);const a=r.position;if(e+1>n.length)throw"dicomParser.readEncapsulatedPixelData: frame exceeds number of fragments";const s=a+n[e].offset+8,c=n[e].length;return new Uint8Array(r.byteArray.buffer.slice(r.byteArray.byteOffset+s,r.byteArray.byteOffset+s+c))}function xte(t,e){return t&1<<e}function Ste(t,e,n){const r=new Uint8Array(n);for(let i=0;i<n;i++){const a=Math.floor(i/8),o=t[a+e],s=i%8;r[i]=xte(o,s)?1:0}return r}function Ete(t,e){const n=t.elements.x7fe00010||t.elements.x7fe00008,r=t.uint16("x00280100"),i=t.uint16("x00280010"),a=t.uint16("x00280011");let o=t.uint16("x00280002");t.string("x00280004")==="YBR_FULL_422"&&(o=2,console.warn(`Using SamplesPerPixel of 2 for YBR_FULL_422 photometric interpretation.
      See http://dicom.nema.org/medical/dicom/current/output/chtml/part03/sect_C.7.6.3.html for more information.`));const c=n.dataOffset,l=i*a*o;let f;if(r===8){if(f=c+e*l,f>=t.byteArray.length)throw new Error("frame exceeds size of pixelData");return new Uint8Array(t.byteArray.buffer.slice(f,f+l))}else if(r===16){if(f=c+e*l*2,f>=t.byteArray.length)throw new Error("frame exceeds size of pixelData");return new Uint8Array(t.byteArray.buffer.slice(f,f+l*2))}else if(r===1){if(f=c+e*l*.125,f>=t.byteArray.length)throw new Error("frame exceeds size of pixelData");return Ste(t.byteArray,f,l)}else if(r===32){if(f=c+e*l*4,f>=t.byteArray.length)throw new Error("frame exceeds size of pixelData");return new Uint8Array(t.byteArray.buffer.slice(f,f+l*4))}throw new Error("unsupported pixel format")}function Ote(t){const e=_2(t),n=parseInt(e.url,10),r=Tte.get(n);return new Promise((i,a)=>{const o=new FileReader;o.onload=s=>{const c=s.target.result;i(c)},o.onerror=a,o.readAsArrayBuffer(r)})}function jM(t,e=0){const n=t.elements.x7fe00010||t.elements.x7fe00008;return n?n.encapsulatedPixelData?wte(t,e):Ete(t,e):null}function jy(t){let e=t[0],n=t[0],r;const i=t.length;for(let a=1;a<i;a++)r=t[a],e=Math.min(e,r),n=Math.max(n,r);return{min:e,max:n}}function rm(t,e,n){t.planarConfiguration===0?uP(t.pixelData,e,n):fP(t.pixelData,e,n)}function Dte(t,e,n){t.planarConfiguration===0?gP(t.pixelData,e,n):dP(t.pixelData,e,n)}function Rte(t,e,n){if(t.photometricInterpretation==="RGB")rm(t,e,n);else if(t.photometricInterpretation==="YBR_RCT")rm(t,e,n);else if(t.photometricInterpretation==="YBR_ICT")rm(t,e,n);else if(t.photometricInterpretation==="PALETTE COLOR")Vee(t,e,n);else if(t.photometricInterpretation==="YBR_FULL_422")pP(t.pixelData,e,n);else if(t.photometricInterpretation==="YBR_FULL")Dte(t,e,n);else throw new Error(`No color space conversion for photometric interpretation ${t.photometricInterpretation}`)}function Mte(t){if(t===void 0)return!1;const{rows:e,columns:n,photometricInterpretation:r,pixelDataLength:i,planarConfiguration:a}=t;return i===4*n*e||r==="PALETTE COLOR"?!1:r.endsWith("420")?i===(3*Math.ceil(n/2)+Math.floor(n/2))*e:r.endsWith("422")?i===(3*Math.ceil(n/2)+Math.floor(n/2))*Math.ceil(e/2)+Math.floor(e/2)*n:r!=="RGB"||a===1}function _te(t){return bte(String.fromCharCode.apply(null,Array.prototype.slice.apply(new Uint8Array(t))))}function bte(t){let e;try{return decodeURIComponent(escape(t))}catch(n){if(e=n,e instanceof URIError)return t;throw e}}function Lte(t,e,n){const r=new Date().getTime(),i=new Blob([e],{type:"image/jpeg"});return new Promise((a,o)=>{const s=new FileReader;s.readAsBinaryString===void 0?s.readAsArrayBuffer(i):s.readAsBinaryString(i),s.onload=function(){const c=new Image;c.onload=function(){n.height=c.height,n.width=c.width,t.rows=c.height,t.columns=c.width;const l=n.getContext("2d");l.drawImage(this,0,0);const f=l.getImageData(0,0,c.width,c.height),u=new Date().getTime();t.pixelData=new Uint8Array(f.data.buffer),t.imageData=f,t.decodeTimeInMS=u-r;const g=jy(t.pixelData);t.smallestPixelValue=g.min,t.largestPixelValue=g.max,t.pixelDataLength=t.pixelData.length,a(t)},c.onerror=function(l){o(l)},s.readAsBinaryString===void 0?c.src=`data:image/jpeg;base64,${window.btoa(_te(s.result))}`:c.src=`data:image/jpeg;base64,${window.btoa(s.result)}`},s.onerror=c=>{o(c)}})}function xi(t,e,n,r,i){const a={...r};delete a.loader,delete a.streamingData;const o=Ic(),s=a.priority||void 0;return a.transferPixelData&&n.buffer,o.executeTask("dicomImageLoader","decodeTask",{imageFrame:t,transferSyntax:e,pixelData:n,options:a,decodeConfig:i},{priority:s,requestType:a==null?void 0:a.requestType})}function Ite(t,e,n,r,i={},a){switch(e){case"1.2.840.10008.1.2":return xi(t,e,n,i,a);case"1.2.840.10008.1.2.1":return xi(t,e,n,i,a);case"1.2.840.10008.1.2.2":return xi(t,e,n,i,a);case"1.2.840.10008.1.2.1.99":return xi(t,e,n,i,a);case"1.2.840.10008.1.2.5":return xi(t,e,n,i,a);case"1.2.840.10008.1.2.4.50":return t.bitsAllocated===8&&(t.samplesPerPixel===3||t.samplesPerPixel===4)?Lte(t,n,r):xi(t,e,n,i,a);case"1.2.840.10008.1.2.4.51":return xi(t,e,n,i,a);case"1.2.840.10008.1.2.4.57":return xi(t,e,n,i,a);case"1.2.840.10008.1.2.4.70":return xi(t,e,n,i,a);case"1.2.840.10008.1.2.4.80":return xi(t,e,n,i,a);case"1.2.840.10008.1.2.4.81":return xi(t,e,n,i,a);case"1.2.840.10008.1.2.4.90":return xi(t,e,n,i,a);case"1.2.840.10008.1.2.4.91":return xi(t,e,n,i,a);case"3.2.840.10008.1.2.4.96":case"1.2.840.10008.1.2.4.201":case"1.2.840.10008.1.2.4.202":case"1.2.840.10008.1.2.4.203":return xi(t,e,n,i,a)}return Promise.reject(new Error(`No decoder for transfer syntax ${e}`))}function Vte(t){const e=Ve("imagePixelModule",t);return{samplesPerPixel:e.samplesPerPixel,photometricInterpretation:e.photometricInterpretation,planarConfiguration:e.planarConfiguration,rows:e.rows,columns:e.columns,bitsAllocated:e.bitsAllocated,bitsStored:e.bitsStored,pixelRepresentation:e.pixelRepresentation,smallestPixelValue:e.smallestPixelValue,largestPixelValue:e.largestPixelValue,redPaletteColorLookupTableDescriptor:e.redPaletteColorLookupTableDescriptor,greenPaletteColorLookupTableDescriptor:e.greenPaletteColorLookupTableDescriptor,bluePaletteColorLookupTableDescriptor:e.bluePaletteColorLookupTableDescriptor,redPaletteColorLookupTableData:e.redPaletteColorLookupTableData,greenPaletteColorLookupTableData:e.greenPaletteColorLookupTableData,bluePaletteColorLookupTableData:e.bluePaletteColorLookupTableData,pixelData:void 0,imageId:t}}function Pte(t,e){const n=t.get("modalityLutModule",e)||{},r=t.get("generalSeriesModule",e)||{},{modality:i}=r,a={rescaleSlope:n.rescaleSlope,rescaleIntercept:n.rescaleIntercept,modality:i},o=t.get("scalingModule",e)||{};return{...a,...i==="PT"&&{suvbw:o.suvbw}}}function HM(t){return t==="RGB"||t==="PALETTE COLOR"||t==="YBR_FULL"||t==="YBR_FULL_422"||t==="YBR_PARTIAL_422"||t==="YBR_PARTIAL_420"||t==="YBR_RCT"||t==="YBR_ICT"}function Nte(t,e){const n=t.length/4;let r=0,i=0;for(let a=0;a<n;a++)e[i++]=t[r++],e[i++]=t[r++],e[i++]=t[r++],r++;return e}function kte(t){return t!=="1.2.840.10008.5.1.4.1.1.12.1"&&t!=="1.2.840.10008.5.1.4.1.1.12.2.1"}function Hy(t,e){let n;return Number.isInteger(t)&&Number.isInteger(e)&&(t>=0?e<=255?n=Uint8Array:e<=65535&&(n=Uint16Array):t>=-128&&e<=127?n=Int8Array:t>=-32768&&e<=32767&&(n=Int16Array)),n||Float32Array}function Ate(t,e,n){return Hy(t,e)===n}function Fte(t){const e=t.smallestPixelValue,n=t.largestPixelValue,r=Hy(e,n);if(r){const i=new r(t.pixelData);t.pixelData=i}else throw new Error("Could not apply a typed array to the pixel data")}let lT="";function Ky(t,e,n,r={}){const i=r.useRGBA;if(r.preScale={enabled:r.preScale&&r.preScale.enabled!==void 0?r.preScale.enabled:!0},!(e!=null&&e.length))return Promise.reject(new Error("The pixel data is missing"));const{MetadataModules:a}=Cs,o=document.createElement("canvas"),s=Vte(t);if(s.decodeLevel=r.decodeLevel,r.allowFloatRendering=fy(),r.preScale.enabled){const u=Pte(Oj,t);u&&(r.preScale={...r.preScale,scalingParameters:u})}const{decodeConfig:c}=b2();Object.keys(s).forEach(u=>{(typeof s[u]=="function"||s[u]instanceof Promise)&&delete s[u]});const l=Ite(s,n,e,o,r,c),f=HM(s.photometricInterpretation);return new Promise((u,g)=>{l.then(function(d){let h=!1;if(r.targetBuffer&&r.targetBuffer.type&&!f){const{arrayBuffer:M,type:A,offset:_=0,length:k}=r.targetBuffer,z=d.pixelDataLength,X=_,Z=k??z-X,ce={Uint8Array,Uint16Array,Int16Array,Float32Array};if(Z!==d.pixelDataLength)throw new Error(`target array for image does not have the same length (${Z}) as the decoded image length (${d.pixelDataLength}).`);const J=ce[A],de=M?new J(M,X,Z):new J(d.pixelData);if(Z!==d.pixelDataLength)throw new Error("target array for image does not have the same length as the decoded image length.");d.pixelData=de,h=!0}h||Fte(d);const p=Ve(a.IMAGE_PLANE,t)||{},m=Ve(a.VOI_LUT,t)||{},v=Ve(a.MODALITY_LUT,t)||{},y=Ve(a.SOP_COMMON,t)||{},T=Ve(a.CALIBRATION,t)||{},{rows:C,columns:w}=d;if(f){if(Mte(d)){o.height=d.rows,o.width=d.columns;let _=o.getContext("2d").createImageData(d.columns,d.rows);i||(_={..._,data:new Uint8ClampedArray(3*d.columns*d.rows)}),Rte(d,_.data,i),d.imageData=_,d.pixelData=_.data,d.pixelDataLength=_.data.length}else if(!i&&d.pixelDataLength===4*C*w){const A=new Uint8Array(d.pixelData.length/4*3);d.pixelData=Nte(d.pixelData,A),d.pixelDataLength=d.pixelData.length}const M=jy(d.pixelData);d.smallestPixelValue=M.min,d.largestPixelValue=M.max}const x=Wt.createImageVoxelManager({scalarData:d.pixelData,width:d.columns,height:d.rows,numberOfComponents:d.samplesPerPixel}),O={imageId:t,dataType:d.pixelData.constructor.name,color:f,calibration:T,columnPixelSpacing:p.columnPixelSpacing,columns:d.columns,height:d.rows,preScale:d.preScale,intercept:v.rescaleIntercept?v.rescaleIntercept:0,slope:v.rescaleSlope?v.rescaleSlope:1,invert:d.photometricInterpretation==="MONOCHROME1",minPixelValue:d.smallestPixelValue,maxPixelValue:d.largestPixelValue,rowPixelSpacing:p.rowPixelSpacing,rows:d.rows,sizeInBytes:d.pixelData.byteLength,width:d.columns,windowCenter:m.windowCenter?m.windowCenter[0]:void 0,windowWidth:m.windowWidth?m.windowWidth[0]:void 0,voiLUTFunction:m.voiLUTFunction?m.voiLUTFunction:void 0,decodeTimeInMS:d.decodeTimeInMS,floatPixelData:void 0,imageFrame:d,voxelManager:x,rgba:f&&i,getPixelData:()=>d.pixelData,getCanvas:void 0,numberOfComponents:d.samplesPerPixel};if(O.color&&(O.getCanvas=function(){if(lT===t)return o;const M=O.columns,A=O.rows;o.height=A,o.width=M;const _=o.getContext("2d"),k=_.createImageData(M,A),z=d.pixelData;if(z.length===M*A*4)for(let X=0;X<z.length;X++)k.data[X]=z[X];else if(z.length===M*A*3){let X=0;for(let Z=0;Z<z.length;Z+=3)k.data[X++]=z[Z],k.data[X++]=z[Z+1],k.data[X++]=z[Z+2],k.data[X++]=255}return d.pixelData=k.data,d.pixelDataLength=k.data.length,d.imageData=k,_.putImageData(d.imageData,0,0),lT=t,o}),v.modalityLUTSequence&&v.modalityLUTSequence.length>0&&kte(y.sopClassUID)&&(O.modalityLUT=v.modalityLUTSequence[0]),m.voiLUTSequence&&m.voiLUTSequence.length>0&&(O.voiLUT=m.voiLUTSequence[0]),O.color&&(O.windowWidth=256,O.windowCenter=128),O.windowCenter===void 0||O.windowWidth===void 0){const M=O.imageFrame.smallestPixelValue,A=O.imageFrame.largestPixelValue;O.windowWidth=A-M,O.windowCenter=(A+M)/2}u(O)},g)})}const{ImageQualityStatus:KM}=Cs;function Ute(t,e){t.decache=function(){const n=_2(e);ug.unload(n.url)}}function Bte(t,e,n=0,r,i,a){const o=new Date().getTime(),s={cancelFn:void 0,promise:void 0};return s.promise=new Promise((c,l)=>{t.then(f=>{const u=jM(f,n),g=f.string("x00020010"),d=new Date().getTime(),h=Ky(e,u,g,i);Ute(s,e),h.then(p=>{p=p,p.data=f,p.sharedCacheKey=r;const m=new Date().getTime();p.loadTimeInMS=d-o,p.totalTimeInMS=m-o,p.imageQualityStatus=KM.FULL_RESOLUTION,a!==void 0&&a.imageDoneCallback!==void 0&&a.imageDoneCallback(p),c(p)},function(p){l({error:p,dataSet:f})})},function(f){l({error:f})})}),s}function Gte(t,e,n=0,r,i){const a=new Date().getTime();return{promise:new Promise((s,c)=>{const l=new Date().getTime();let f;try{const u=jM(t,n),g=t.string("x00020010");f=Ky(e,u,g,i)}catch(u){c({error:u,dataSet:t});return}f.then(u=>{u=u,u.data=t,u.sharedCacheKey=r;const g=new Date().getTime();u.loadTimeInMS=l-a,u.totalTimeInMS=g-a,u.imageQualityStatus=KM.FULL_RESOLUTION,s(u)},c)}),cancelFn:void 0}}function $te(t){if(t==="dicomweb"||t==="wadouri")return By;if(t==="dicomfile")return Ote}function im(t,e={}){const n=_2(t);e=Object.assign({},e),delete e.loader;const r=$te(n.scheme);if(ug.isLoaded(n.url)){const a=ug.get(n.url,r,t);return Gte(a,t,n.pixelDataFrame,n.url,e)}const i=ug.load(n.url,r,t);return Bte(i,t,n.frame,n.url,e)}function Wte(){dp("dicomweb",im),dp("wadouri",im),dp("dicomfile",im),Qu(zM)}function tt(t,e,n){return e=e||0,!t||!t.Value||Array.isArray(t.Value)&&t.Value.length<=e?n:t.Value[e]}function It(t,e){const n=tt(t,e);if(n!==void 0)return parseFloat(n)}function ai(t,e){if(!t||!t.Value||!Array.isArray(t.Value)||e&&t.Value.length<e)return;const n=[];for(let r=0;r<t.Value.length;r++)n.push(parseFloat(t.Value[r]));return n}function zte(t){const e=[];for(let n=0;n<=30;n+=2){let r=`x60${n.toString(16)}`;r.length===4&&(r=`x600${n.toString(16)}`);const i=tt(t[`${r}3000`]);if(!i)continue;const a=[];for(let o=0;o<i.length;o++)for(let s=0;s<8;s++){const c=t.Value[i.dataOffset+o];a[o*8+s]=c>>s&1}e.push({rows:It(t[`${r}0010`]),columns:It(t[`${r}0011`]),type:tt(t[`${r}0040`]),x:It(t[`${r}0050`],1)-1,y:It(t[`${r}0050`],0)-1,pixelData:a,description:tt(t[`${r}0022`]),label:tt(t[`${r}1500`]),roiArea:tt(t[`${r}1301`]),roiMean:tt(t[`${r}1302`]),roiStandardDeviation:tt(t[`${r}1303`])})}return{overlays:e}}function V2(t){const e=t.indexOf(":");return t.substring(e+1)}function gu(t,e=!0){return t&&t.Value?t.Value[0]&&e?t.Value[0]:t.Value:t}function qM(t,e,n){const r=(e?Object.values(e[0]):[]).map(a=>a[0]).filter(a=>a!==void 0&&typeof a=="object"),i=(t?Object.values(t[n-1]):[]).map(a=>a.Value[0]).filter(a=>a!==void 0&&typeof a=="object");return{shared:r,perFrame:i}}function XM(t){let{52009230:e,52009229:n,"00280008":r,...i}=t;return e=gu(e,!1),n=gu(n,!1),r=gu(r),{PerFrameFunctionalGroupsSequence:e,SharedFunctionalGroupsSequence:n,NumberOfFrames:r,rest:i}}function jte(t,e){const{PerFrameFunctionalGroupsSequence:n,SharedFunctionalGroupsSequence:r,NumberOfFrames:i,rest:a}=XM(e);if(n||i>1){const{shared:o,perFrame:s}=qM(n,r,t),c=Object.assign(e,{frameNumber:t});return[...o,...s].forEach(l=>{Object.entries(l).forEach(([f,u])=>{c[f]=u})}),Object.assign(a,{"00280008":i},c)}return e}let Dd=[],kh={};function YM(t){const e=t.indexOf("/frames/")+8,n=t.slice(0,e),r=parseInt(t.slice(e),10);return{metadata:Dd[`${n}1`],frame:r}}function Hte(t){const e=V2(t);return YM(e)}function Kte(t){const e=tt(t["00280008"]);return e&&e>1}function qte(t,e){const n=V2(t);Object.defineProperty(e,"isMultiframe",{value:Kte(e),enumerable:!1}),Dd[n]=e}function Xte(t){const e=V2(t),n=Dd[e];if(n&&!(n!=null&&n.isMultiframe))return n;const r=kh[e];if(r)return r;const i=YM(e);if(!i||!i.metadata)return;const{metadata:a,frame:o}=i;if(a){const s=jte(o,a);return kh[e]=s,s}}function Yte(t){const e=V2(t);Dd[e]=void 0,kh[e]=void 0}function Zte(){Dd=[],kh={}}const ZM={add:qte,get:Xte,remove:Yte,purge:Zte};function QM(t){return tt(t["00080060"]).includes("NM")}function qy(t,e){const n=gu(t["00080008"],!1);if(n)return n[e]}function Qte(t){let e;const n=qy(t,2);if(n&&nf(n)){const r=gu(t["00540022"]);r&&(e=ai(r["00200037"],6))}return e}function Jte(t){let e;const n=qy(t,2);if(n&&nf(n)){const r=gu(t["00540022"]);r&&(e=ai(r["00200032"],3))}return e}function uT(t){let e=ai(t["00200037"],6);return!e&&QM(t)&&(e=Qte(t)),e}function fT(t){let e=ai(t["00200032"],3);return!e&&QM(t)&&(e=Jte(t)),e}function Ur(t,e){const n=ai(t[e]);return n?n[0]:null}function ene(t){var e;return(e=t==null?void 0:t.Value)!=null&&e.length?Array.isArray(t.Value)?t.Value:typeof t.Value=="object"?(console.warn("Warning: Value should be an array, but an object was found. Encapsulating the object in an array."),[t.Value]):[]:[]}function gT(t){const e=ene(t["00186011"]);return!e||!e.length?null:e.map(r=>{const i=Ur(r,"0018602C"),a=Ur(r,"0018602E"),o=Ur(r,"00186024"),s=Ur(r,"00186026"),c=Ur(r,"0018601A"),l=Ur(r,"0018601E"),f=Ur(r,"00186018"),u=Ur(r,"0018601C"),g=Ur(r,"00186020"),d=Ur(r,"00186022"),h=Ur(r,"0018602A"),p=Ur(r,"00186028"),m=Ur(r,"00186012"),v=Ur(r,"00186014"),y=Ur(r,"00186016"),T=Ur(r,"00186030");return{regionLocationMinY0:c,regionLocationMaxY1:l,regionLocationMinX0:f,regionLocationMaxX1:u,referencePixelX0:g,referencePixelY0:d,physicalDeltaX:i,physicalDeltaY:a,physicalUnitsXDirection:o,physicalUnitsYDirection:s,referencePhysicalPixelValueY:h,referencePhysicalPixelValueX:p,regionSpatialFormat:m,regionDataType:v,regionFlags:y,transducerFrequency:T}})}function JM(t,e){const{MetadataModules:n}=Cs;if(t===n.MULTIFRAME){const{metadata:i,frame:a}=Hte(e);if(!i)return;const{PerFrameFunctionalGroupsSequence:o,SharedFunctionalGroupsSequence:s,NumberOfFrames:c}=XM(i);if(o||c>1){const{shared:l,perFrame:f}=qM(o,s,a);return{NumberOfFrames:c,PerFrameFunctionalInformation:f,SharedFunctionalInformation:l}}return{NumberOfFrames:c}}const r=ZM.get(e);if(r){if(t===n.GENERAL_STUDY)return{studyDescription:tt(r["00081030"]),studyDate:Rn.parseDA(tt(r["00080020"])),studyTime:Rn.parseTM(tt(r["00080030"],0,"")),accessionNumber:tt(r["00080050"])};if(t===n.GENERAL_SERIES)return{modality:tt(r["00080060"]),seriesInstanceUID:tt(r["0020000E"]),seriesNumber:It(r["00200011"]),studyInstanceUID:tt(r["0020000D"]),seriesDate:Rn.parseDA(tt(r["00080021"])),seriesTime:Rn.parseTM(tt(r["00080031"],0,"")),acquisitionDate:Rn.parseDA(tt(r["00080022"])),acquisitionTime:Rn.parseTM(tt(r["00080032"],0,""))};if(t===n.GENERAL_IMAGE)return{sopInstanceUID:tt(r["00080018"]),instanceNumber:It(r["00200013"]),lossyImageCompression:tt(r["00282110"]),lossyImageCompressionRatio:It(r["00282112"]),lossyImageCompressionMethod:tt(r["00282114"])};if(t===n.PATIENT)return{patientID:tt(r["00100020"]),patientName:tt(r["00100010"])};if(t===n.PATIENT_STUDY)return{patientAge:It(r["00101010"]),patientSize:It(r["00101020"]),patientSex:tt(r["00100040"]),patientWeight:It(r["00101030"])};if(t===n.NM_MULTIFRAME_GEOMETRY){const i=tt(r["00080060"]),a=qy(r,2);return{modality:i,imageType:tt(r["00080008"]),imageSubType:a,imageOrientationPatient:uT(r),imagePositionPatient:fT(r),sliceThickness:It(r["00180050"]),spacingBetweenSlices:It(r["00180088"]),pixelSpacing:ai(r["00280030"],2),numberOfFrames:It(r["00280008"]),isNMReconstructable:nf(a)&&i.includes("NM")}}if(t===n.IMAGE_PLANE){let i=uT(r),a=fT(r);const o=ai(r["00280030"],2);let s=null,c=null,l=null,f=null,u=!1;return o?(c=o[0],s=o[1]):(u=!0,c=1,s=1),i?(l=[parseFloat(i[0]),parseFloat(i[1]),parseFloat(i[2])],f=[parseFloat(i[3]),parseFloat(i[4]),parseFloat(i[5])]):(l=[0,1,0],f=[0,0,-1],u=!0,i=[...l,...f]),a||(a=[0,0,0],u=!0),{frameOfReferenceUID:tt(r["00200052"]),rows:It(r["00280010"]),columns:It(r["00280011"]),imageOrientationPatient:i,rowCosines:l,columnCosines:f,imagePositionPatient:a,sliceThickness:It(r["00180050"]),sliceLocation:It(r["00201041"]),pixelSpacing:o,rowPixelSpacing:c,columnPixelSpacing:s,usingDefaultValues:u}}if(t===n.ULTRASOUND_ENHANCED_REGION)return gT(r);if(t===n.CALIBRATION&&tt(r["00080060"])==="US")return{sequenceOfUltrasoundRegions:gT(r)};if(t===n.IMAGE_URL)return tne(e,r);if(t===n.CINE)return nne(e,r);if(t===n.IMAGE_PIXEL)return{samplesPerPixel:It(r["00280002"]),photometricInterpretation:tt(r["00280004"]),rows:It(r["00280010"]),columns:It(r["00280011"]),bitsAllocated:It(r["00280100"]),bitsStored:It(r["00280101"]),highBit:tt(r["00280102"]),pixelRepresentation:It(r["00280103"]),planarConfiguration:It(r["00280006"]),pixelAspectRatio:tt(r["00280034"]),smallestPixelValue:It(r["00280106"]),largestPixelValue:It(r["00280107"]),redPaletteColorLookupTableDescriptor:ai(r["00281101"]),greenPaletteColorLookupTableDescriptor:ai(r["00281102"]),bluePaletteColorLookupTableDescriptor:ai(r["00281103"]),redPaletteColorLookupTableData:ai(r["00281201"]),greenPaletteColorLookupTableData:ai(r["00281202"]),bluePaletteColorLookupTableData:ai(r["00281203"])};if(t===n.VOI_LUT)return{windowCenter:ai(r["00281050"],1),windowWidth:ai(r["00281051"],1),voiLUTFunction:tt(r["00281056"])};if(t===n.MODALITY_LUT)return{rescaleIntercept:It(r["00281052"]),rescaleSlope:It(r["00281053"]),rescaleType:tt(r["00281054"])};if(t===n.SOP_COMMON)return{sopClassUID:tt(r["00080016"]),sopInstanceUID:tt(r["00080018"])};if(t===n.PET_ISOTOPE){const i=tt(r["00540016"]);return i===void 0?void 0:{radiopharmaceuticalInfo:{radiopharmaceuticalStartTime:Rn.parseTM(tt(i["00181072"],0,"")),radiopharmaceuticalStartDateTime:tt(i["00181078"],0,""),radionuclideTotalDose:It(i["00181074"]),radionuclideHalfLife:It(i["00181075"])}}}if(t===n.OVERLAY_PLANE)return zte(r);if(t==="transferSyntax")return e_(e,r);if(t===n.PET_SERIES)return{correctedImage:tt(r["00280051"]),units:tt(r["00541001"]),decayCorrection:tt(r["00541102"])};if(t===n.PET_IMAGE)return{frameReferenceTime:It(r["00541300"]),actualFrameDuration:It(r["00181242"])};if(t==="instance")return $M(e,JM,WM)}}function tne(t,e){const{transferSyntaxUID:n}=e_(t,e),r=sM(n),i=t.substring(7),a=i.replace("/frames/","/thumbnail/");let o=i.replace("/frames/","/rendered/");return r&&(o=o.replace("/rendered/1","/rendered")),{isVideo:r,rendered:o,thumbnail:a}}function nne(t,e){return{cineRate:tt(e["00180040"]),numberOfFrames:It(e["00280008"])}}function e_(t,e){return{transferSyntaxUID:tt(e["00020010"])||tt(e["00083002"])}}function rne(t,e,n={},r={}){const i=b2(),{retrieveOptions:a={},streamingData:o}=r,s=o.chunkSize||ane(e,a,"chunkSize")||65536,c=f=>{if(typeof i.errorInterceptor=="function"){const u=new Error("request failed");i.errorInterceptor(u)}else console.warn("rangeRequest:Caught",f)};return new Promise(async(f,u)=>{const g=Object.assign({},n);Object.keys(g).forEach(function(d){(g[d]===null||g[d]===void 0)&&delete g[d]});try{o.encodedData||(o.chunkSize=s,o.rangesFetched=0);const d=one(o,a),{encodedData:h,responseHeaders:p}=await ine(t,g,d,o),m=p.get("content-type"),{totalBytes:v}=o,y=v===h.byteLength,T=Gy(m,h,{isPartial:!0}),C=$y(a,y||T.extractDone);f({...T,imageQualityStatus:C,percentComplete:T.extractDone?100:s*100/v})}catch(d){c(d),console.error(d),u(d)}})}async function ine(t,e,n,r){n&&(e=Object.assign(e,{Range:`bytes=${n[0]}-${n[1]}`}));let{encodedData:i}=r;if(n[1]&&(i==null?void 0:i.byteLength)>n[1])return r;const a=await fetch(t,{headers:e,signal:void 0}),o=await a.arrayBuffer(),s=new Uint8Array(o),{status:c}=a;let l;i?(l=new Uint8Array(i.length+s.length),l.set(i,0),l.set(s,i.length),r.rangesFetched=1):(l=new Uint8Array(s.length),l.set(s,0),r.rangesFetched++),r.encodedData=i=l,r.responseHeaders=a.headers;const f=a.headers.get("Content-Range");return f?r.totalBytes=Number(f.split("/")[1]):c!==206||!n?r.totalBytes=i==null?void 0:i.byteLength:n[1]===""||(i==null?void 0:i.length)<n[1]?r.totalBytes=i.byteLength:r.totalBytes=Number.MAX_SAFE_INTEGER,r}function ane(t,e,n){const r=e[n];if(typeof r!="function")return r;const i=ZM.get(t);return r(i,t)}function one(t,e){const{totalBytes:n,encodedData:r,chunkSize:i=65536}=t,{rangeIndex:a=0}=e;return a===-1&&(!n||!r)?[0,""]:a===-1||(r==null?void 0:r.byteLength)>n-i?[(r==null?void 0:r.byteLength)||0,""]:[(r==null?void 0:r.byteLength)||0,i*(a+1)-1]}function sne(t,e,n="application/octet-stream",r){const{streamingData:i,retrieveOptions:a={}}=r||{},o={Accept:n};let s=a.urlArguments?`${t}${t.indexOf("?")===-1?"?":"&"}${a.urlArguments}`:t;if(a.framesPath&&(s=s.replace("/frames/",a.framesPath)),(i==null?void 0:i.url)!==s&&(r.streamingData={url:s}),a.rangeIndex!==void 0)return rne(s,e,o,r);if(a.streaming)return Kee(s,e,o,r);const c=By(s,e,o),{xhr:l}=c;return c.then(function(f){const u=l.getResponseHeader("Content-Type")||"application/octet-stream",g=Gy(u,new Uint8Array(f));return g.imageQualityStatus=$y(a,!0),g})}const{ProgressiveIterator:dT}=ws,{ImageQualityStatus:pT}=Cs,cne=new Set(["3.2.840.10008.1.2.4.96","1.2.840.10008.1.2.4.202","1.2.840.10008.1.2.4.203"]);function lne(t){const e="1.2.840.10008.1.2";if(!t)return e;const n=t.split(";"),r={};n.forEach(a=>{const o=a.split("=");if(o.length!==2)return;const s=o[1].trim().replace(/"/g,"");r[o[0].trim()]=s});const i={"image/jpeg":"1.2.840.10008.1.2.4.50","image/x-dicom-rle":"1.2.840.10008.1.2.5","image/x-jls":"1.2.840.10008.1.2.4.80","image/jls":"1.2.840.10008.1.2.4.80","image/jll":"1.2.840.10008.1.2.4.70","image/jp2":"1.2.840.10008.1.2.4.90","image/jpx":"1.2.840.10008.1.2.4.92","image/jphc":"3.2.840.10008.1.2.4.96","image/jxl":"1.2.840.10008.1.2.4.140"};return r["transfer-syntax"]?r["transfer-syntax"]:t&&!Object.keys(r).length&&i[t]?i[t]:r.type&&i[r.type]?i[r.type]:i[t]?i[t]:e}function une(){return Ed}const fne="multipart/related; type=application/octet-stream; transfer-syntax=*";function gne(t,e={}){const n=une(),r=new Date().getTime(),i=new dT("decompress");async function a(f,u,g){i.generate(async d=>{var m;const h=dT.as(sne(f,u,g,e));let p=10;for await(const v of h){const{pixelData:y,imageQualityStatus:T=pT.FULL_RESOLUTION,percentComplete:C,done:w=!0,extractDone:x=!0}=v,O=lne(v.contentType);if(!x&&!cne.has(O))continue;const M=v.decodeLevel??(T===pT.FULL_RESOLUTION?0:dne(C,(m=e.retrieveOptions)==null?void 0:m.decodeLevel));if(!(!w&&p<=M))try{const A={...e,decodeLevel:M},_=await Ky(u,y,O,A),k=new Date().getTime();_.loadTimeInMS=k-r,_.transferSyntaxUID=O,_.imageQualityStatus=T,d.add(_,w),p=M}catch(A){if(x)throw console.warn("Couldn't decode",A),A}}})}const o=e.requestType||ot.Interaction,s=e.additionalDetails||{imageId:t},c=e.priority===void 0?5:e.priority,l=t.substring(7);return n.addRequest(a.bind(this,l,t,fne),o,s,c),{promise:i.getDonePromise(),cancelFn:void 0}}function dne(t,e=4){const n=t/100-.02;return n>1/4?Math.min(e,0):n>1/16?Math.min(e,1):n>1/64?Math.min(e,2):Math.min(e,3)}function pne(){dp("wadors",gne),Qu(JM)}function hne(){pne(),Wte()}const mne=()=>new Worker(new URL("/dicom-viewer/assets/decodeImageFrameWorker-ryCVVbPA.js",import.meta.url),{type:"module"});function vne(t={}){Bee(t),hne();const e=Ic(),n=(t==null?void 0:t.maxWebWorkers)||yne();e.registerWorker("dicomImageLoader",mne,{maxWorkerInstances:n})}function yne(){return typeof navigator<"u"&&navigator.hardwareConcurrency?Math.max(1,Math.floor(navigator.hardwareConcurrency/2)):1}function Tne(t,e){const{rows:n,columns:r,data:i}=t,{rows:a,columns:o,data:s}=e,c=[],l=[],f=[];for(let u=0;u<o;u++){const g=u*(r-1)/(o-1);c[u]=Math.floor(g),l[u]=Math.min(c[u]+1,r-1),f[u]=g-c[u]}for(let u=0;u<a;u++){const g=u*(n-1)/(a-1),d=Math.floor(g)*r,h=Math.min(d+r,(n-1)*r),p=g-Math.floor(g),m=1-p,v=u*o;for(let y=0;y<o;y++){const T=i[d+c[y]],C=i[d+l[y]],w=i[h+c[y]],x=i[h+l[y]],O=1-f[y];s[v+y]=(T*O+C*f[y])*m+(w*O+x*f[y])*p}}return s}function Cne(t,e){const{rows:n,columns:r,pixelData:i,samplesPerPixel:a=1}=t,{rows:o,columns:s,pixelData:c}=e,l=[];for(let f=0;f<s;f++){const u=f*(r-1)/(s-1);l[f]=Math.floor(u)*a}for(let f=0;f<o;f++){const u=f*(n-1)/(o-1),g=Math.floor(u)*r*a,d=f*s;for(let h=0;h<s;h++)for(let p=0;p<a;p++)c[d+h+p]=i[g+l[h]+p]}return c}async function hT(t,e){let n=e.buffer,r=e.byteOffset;const i=e.length;return t.bitsAllocated===16?(r%2&&(n=n.slice(r),r=0),t.pixelRepresentation===0?t.pixelData=new Uint16Array(n,r,i/2):t.pixelData=new Int16Array(n,r,i/2)):t.bitsAllocated===8||t.bitsAllocated===1?t.pixelData=e:t.bitsAllocated===32&&(r%2&&(n=n.slice(r),r=0),t.pixelData=new Float32Array(n,r,i/4)),t}function wne(t){return(t&255)<<8|t>>8&255}async function xne(t,e){if(t.bitsAllocated===16){let n=e.buffer,r=e.byteOffset;const i=e.length;r%2&&(n=n.slice(r),r=0),t.pixelRepresentation===0?t.pixelData=new Uint16Array(n,r,i/2):t.pixelData=new Int16Array(n,r,i/2);for(let a=0;a<t.pixelData.length;a++)t.pixelData[a]=wne(t.pixelData[a])}else t.bitsAllocated===8&&(t.pixelData=e);return t}async function Sne(t,e){if(t.bitsAllocated===8)return t.planarConfiguration?One(t,e):Ene(t,e);if(t.bitsAllocated===16)return Dne(t,e);throw new Error("unsupported pixel format for RLE")}function Ene(t,e){const n=e,r=t.rows*t.columns,i=new ArrayBuffer(r*t.samplesPerPixel),a=new DataView(n.buffer,n.byteOffset),o=new Int8Array(n.buffer,n.byteOffset),s=new Int8Array(i);let c=0;const l=a.getInt32(0,!0);for(let f=0;f<l;++f){c=f;let u=a.getInt32((f+1)*4,!0),g=a.getInt32((f+2)*4,!0);g===0&&(g=n.length);const d=r*l;for(;u<g;){const h=o[u++];if(h>=0&&h<=127)for(let p=0;p<h+1&&c<d;++p)s[c]=o[u++],c+=t.samplesPerPixel;else if(h<=-1&&h>=-127){const p=o[u++];for(let m=0;m<-h+1&&c<d;++m)s[c]=p,c+=t.samplesPerPixel}}}return t.pixelData=new Uint8Array(i),t}function One(t,e){const n=e,r=t.rows*t.columns,i=new ArrayBuffer(r*t.samplesPerPixel),a=new DataView(n.buffer,n.byteOffset),o=new Int8Array(n.buffer,n.byteOffset),s=new Int8Array(i);let c=0;const l=a.getInt32(0,!0);for(let f=0;f<l;++f){c=f*r;let u=a.getInt32((f+1)*4,!0),g=a.getInt32((f+2)*4,!0);g===0&&(g=n.length);const d=r*l;for(;u<g;){const h=o[u++];if(h>=0&&h<=127)for(let p=0;p<h+1&&c<d;++p)s[c]=o[u++],c++;else if(h<=-1&&h>=-127){const p=o[u++];for(let m=0;m<-h+1&&c<d;++m)s[c]=p,c++}}}return t.pixelData=new Uint8Array(i),t}function Dne(t,e){const n=e,r=t.rows*t.columns,i=new ArrayBuffer(r*t.samplesPerPixel*2),a=new DataView(n.buffer,n.byteOffset),o=new Int8Array(n.buffer,n.byteOffset),s=new Int8Array(i),c=a.getInt32(0,!0);for(let l=0;l<c;++l){let f=0;const u=l===0?1:0;let g=a.getInt32((l+1)*4,!0),d=a.getInt32((l+2)*4,!0);for(d===0&&(d=n.length);g<d;){const h=o[g++];if(h>=0&&h<=127)for(let p=0;p<h+1&&f<r;++p)s[f*2+u]=o[g++],f++;else if(h<=-1&&h>=-127){const p=o[g++];for(let m=0;m<-h+1&&f<r;++m)s[f*2+u]=p,f++}}}return t.pixelRepresentation===0?t.pixelData=new Uint16Array(i):t.pixelData=new Int16Array(i),t}var t_={exports:{}};(function(t,e){var n=(()=>{var r=typeof document<"u"&&document.currentScript?document.currentScript.src:void 0;return typeof __filename<"u"&&(r=r||__filename),function(i){i=i||{};var a=typeof i<"u"?i:{},o,s;a.ready=new Promise(function(S,E){o=S,s=E});var c=Object.assign({},a),l="./this.program",f=(S,E)=>{throw E},u=typeof window=="object",g=typeof importScripts=="function",d=typeof process=="object"&&typeof process.versions=="object"&&typeof process.versions.node=="string",h="";function p(S){return a.locateFile?a.locateFile(S,h):h+S}var m,v,y;if(d){var T=vo,C=vo;g?h=C.dirname(h)+"/":h=__dirname+"/",m=(S,E)=>(S=B(S)?new URL(S):C.normalize(S),T.readFileSync(S,E?void 0:"utf8")),y=S=>{var E=m(S,!0);return E.buffer||(E=new Uint8Array(E)),E},v=(S,E,b)=>{S=B(S)?new URL(S):C.normalize(S),T.readFile(S,function(F,W){F?b(F):E(W.buffer)})},process.argv.length>1&&(l=process.argv[1].replace(/\\/g,"/")),process.argv.slice(2),process.on("uncaughtException",function(S){if(!(S instanceof Ct))throw S}),process.on("unhandledRejection",function(S){throw S}),f=(S,E)=>{throw process.exitCode=S,E},a.inspect=function(){return"[Emscripten Module object]"}}else(u||g)&&(g?h=self.location.href:typeof document<"u"&&document.currentScript&&(h=document.currentScript.src),r&&(h=r),h.indexOf("blob:")!==0?h=h.substr(0,h.replace(/[?#].*/,"").lastIndexOf("/")+1):h="",m=S=>{var E=new XMLHttpRequest;return E.open("GET",S,!1),E.send(null),E.responseText},g&&(y=S=>{var E=new XMLHttpRequest;return E.open("GET",S,!1),E.responseType="arraybuffer",E.send(null),new Uint8Array(E.response)}),v=(S,E,b)=>{var F=new XMLHttpRequest;F.open("GET",S,!0),F.responseType="arraybuffer",F.onload=()=>{if(F.status==200||F.status==0&&F.response){E(F.response);return}b()},F.onerror=b,F.send(null)});var w=a.print||console.log.bind(console),x=a.printErr||console.warn.bind(console);Object.assign(a,c),c=null,a.arguments&&a.arguments,a.thisProgram&&(l=a.thisProgram),a.quit&&(f=a.quit);var O;a.wasmBinary&&(O=a.wasmBinary),a.noExitRuntime,typeof WebAssembly!="object"&&U("no native wasm support detected");var M,A=!1;function _(S,E){S||U(E)}var k=typeof TextDecoder<"u"?new TextDecoder("utf8"):void 0;function z(S,E,b){for(var F=E+b,W=E;S[W]&&!(W>=F);)++W;if(W-E>16&&S.buffer&&k)return k.decode(S.subarray(E,W));for(var H="";E<W;){var Y=S[E++];if(!(Y&128)){H+=String.fromCharCode(Y);continue}var ee=S[E++]&63;if((Y&224)==192){H+=String.fromCharCode((Y&31)<<6|ee);continue}var se=S[E++]&63;if((Y&240)==224?Y=(Y&15)<<12|ee<<6|se:Y=(Y&7)<<18|ee<<12|se<<6|S[E++]&63,Y<65536)H+=String.fromCharCode(Y);else{var ve=Y-65536;H+=String.fromCharCode(55296|ve>>10,56320|ve&1023)}}return H}function X(S,E){return S?z(q,S,E):""}function Z(S,E,b,F){if(!(F>0))return 0;for(var W=b,H=b+F-1,Y=0;Y<S.length;++Y){var ee=S.charCodeAt(Y);if(ee>=55296&&ee<=57343){var se=S.charCodeAt(++Y);ee=65536+((ee&1023)<<10)|se&1023}if(ee<=127){if(b>=H)break;E[b++]=ee}else if(ee<=2047){if(b+1>=H)break;E[b++]=192|ee>>6,E[b++]=128|ee&63}else if(ee<=65535){if(b+2>=H)break;E[b++]=224|ee>>12,E[b++]=128|ee>>6&63,E[b++]=128|ee&63}else{if(b+3>=H)break;E[b++]=240|ee>>18,E[b++]=128|ee>>12&63,E[b++]=128|ee>>6&63,E[b++]=128|ee&63}}return E[b]=0,b-W}function ce(S,E,b){return Z(S,q,E,b)}function J(S){for(var E=0,b=0;b<S.length;++b){var F=S.charCodeAt(b);F<=127?E++:F<=2047?E+=2:F>=55296&&F<=57343?(E+=4,++b):E+=3}return E}var de,Q,q,j,ie,ue,le,Fe,kt;function lt(S){de=S,a.HEAP8=Q=new Int8Array(S),a.HEAP16=j=new Int16Array(S),a.HEAP32=ue=new Int32Array(S),a.HEAPU8=q=new Uint8Array(S),a.HEAPU16=ie=new Uint16Array(S),a.HEAPU32=le=new Uint32Array(S),a.HEAPF32=Fe=new Float32Array(S),a.HEAPF64=kt=new Float64Array(S)}a.INITIAL_MEMORY;var yt,dt=[],_t=[],Ke=[];function Ye(){if(a.preRun)for(typeof a.preRun=="function"&&(a.preRun=[a.preRun]);a.preRun.length;)Cr(a.preRun.shift());Qt(dt)}function Zt(){Qt(_t)}function jr(){if(a.postRun)for(typeof a.postRun=="function"&&(a.postRun=[a.postRun]);a.postRun.length;)Pn(a.postRun.shift());Qt(Ke)}function Cr(S){dt.unshift(S)}function $t(S){_t.unshift(S)}function Pn(S){Ke.unshift(S)}var Nn=0,fn=null;function Hr(S){Nn++,a.monitorRunDependencies&&a.monitorRunDependencies(Nn)}function cr(S){if(Nn--,a.monitorRunDependencies&&a.monitorRunDependencies(Nn),Nn==0&&fn){var E=fn;fn=null,E()}}function U(S){a.onAbort&&a.onAbort(S),S="Aborted("+S+")",x(S),A=!0,S+=". Build with -sASSERTIONS for more info.";var E=new WebAssembly.RuntimeError(S);throw s(E),E}var $="data:application/octet-stream;base64,";function ne(S){return S.startsWith($)}function B(S){return S.startsWith("file://")}var ae;ae="libjpegturbowasm_decode.wasm",ne(ae)||(ae=p(ae));function xe(S){try{if(S==ae&&O)return new Uint8Array(O);if(y)return y(S);throw"both async and sync fetching of the wasm failed"}catch(E){U(E)}}function Pe(){if(!O&&(u||g)){if(typeof fetch=="function"&&!B(ae))return fetch(ae,{credentials:"same-origin"}).then(function(S){if(!S.ok)throw"failed to load wasm binary file at '"+ae+"'";return S.arrayBuffer()}).catch(function(){return xe(ae)});if(v)return new Promise(function(S,E){v(ae,function(b){S(new Uint8Array(b))},E)})}return Promise.resolve().then(function(){return xe(ae)})}function it(){var S={a:pe};function E(Y,ee){var se=Y.exports;a.asm=se,M=a.asm.K,lt(M.buffer),yt=a.asm.M,$t(a.asm.L),cr()}Hr();function b(Y){E(Y.instance)}function F(Y){return Pe().then(function(ee){return WebAssembly.instantiate(ee,S)}).then(function(ee){return ee}).then(Y,function(ee){x("failed to asynchronously prepare wasm: "+ee),U(ee)})}function W(){return!O&&typeof WebAssembly.instantiateStreaming=="function"&&!ne(ae)&&!B(ae)&&!d&&typeof fetch=="function"?fetch(ae,{credentials:"same-origin"}).then(function(Y){var ee=WebAssembly.instantiateStreaming(Y,S);return ee.then(b,function(se){return x("wasm streaming compile failed: "+se),x("falling back to ArrayBuffer instantiation"),F(b)})}):F(b)}if(a.instantiateWasm)try{var H=a.instantiateWasm(S,E);return H}catch(Y){x("Module.instantiateWasm callback failed with error: "+Y),s(Y)}return W().catch(s),{}}function Ct(S){this.name="ExitStatus",this.message="Program terminated with exit("+S+")",this.status=S}function Qt(S){for(;S.length>0;)S.shift()(a)}function At(S){this.excPtr=S,this.ptr=S-24,this.set_type=function(E){le[this.ptr+4>>2]=E},this.get_type=function(){return le[this.ptr+4>>2]},this.set_destructor=function(E){le[this.ptr+8>>2]=E},this.get_destructor=function(){return le[this.ptr+8>>2]},this.set_refcount=function(E){ue[this.ptr>>2]=E},this.set_caught=function(E){E=E?1:0,Q[this.ptr+12>>0]=E},this.get_caught=function(){return Q[this.ptr+12>>0]!=0},this.set_rethrown=function(E){E=E?1:0,Q[this.ptr+13>>0]=E},this.get_rethrown=function(){return Q[this.ptr+13>>0]!=0},this.init=function(E,b){this.set_adjusted_ptr(0),this.set_type(E),this.set_destructor(b),this.set_refcount(0),this.set_caught(!1),this.set_rethrown(!1)},this.add_ref=function(){var E=ue[this.ptr>>2];ue[this.ptr>>2]=E+1},this.release_ref=function(){var E=ue[this.ptr>>2];return ue[this.ptr>>2]=E-1,E===1},this.set_adjusted_ptr=function(E){le[this.ptr+16>>2]=E},this.get_adjusted_ptr=function(){return le[this.ptr+16>>2]},this.get_exception_ptr=function(){var E=G(this.get_type());if(E)return le[this.excPtr>>2];var b=this.get_adjusted_ptr();return b!==0?b:this.excPtr}}function gn(S,E,b){var F=new At(S);throw F.init(E,b),S}var Pt={};function Tt(S){for(;S.length;){var E=S.pop(),b=S.pop();b(E)}}function Jn(S){return this.fromWireType(ue[S>>2])}var lr={},er={},Xi={},_o=48,Ca=57;function Yi(S){if(S===void 0)return"_unknown";S=S.replace(/[^a-zA-Z0-9_]/g,"$");var E=S.charCodeAt(0);return E>=_o&&E<=Ca?"_"+S:S}function wr(S,E){return S=Yi(S),new Function("body","return function "+S+`() {
    "use strict";    return body.apply(this, arguments);
};
`)(E)}function xr(S,E){var b=wr(E,function(F){this.name=E,this.message=F;var W=new Error(F).stack;W!==void 0&&(this.stack=this.toString()+`
`+W.replace(/^Error(:[^\n]*)?\n/,""))});return b.prototype=Object.create(S.prototype),b.prototype.constructor=b,b.prototype.toString=function(){return this.message===void 0?this.name:this.name+": "+this.message},b}var Kr=void 0;function zn(S){throw new Kr(S)}function jn(S,E,b){S.forEach(function(ee){Xi[ee]=E});function F(ee){var se=b(ee);se.length!==S.length&&zn("Mismatched type converter count");for(var ve=0;ve<S.length;++ve)kn(S[ve],se[ve])}var W=new Array(E.length),H=[],Y=0;E.forEach((ee,se)=>{er.hasOwnProperty(ee)?W[se]=er[ee]:(H.push(ee),lr.hasOwnProperty(ee)||(lr[ee]=[]),lr[ee].push(()=>{W[se]=er[ee],++Y,Y===H.length&&F(W)}))}),H.length===0&&F(W)}function ja(S){var E=Pt[S];delete Pt[S];var b=E.rawConstructor,F=E.rawDestructor,W=E.fields,H=W.map(Y=>Y.getterReturnType).concat(W.map(Y=>Y.setterArgumentType));jn([S],H,Y=>{var ee={};return W.forEach((se,ve)=>{var Re=se.fieldName,ke=Y[ve],Ie=se.getter,rt=se.getterContext,et=Y[ve+W.length],Lt=se.setter,An=se.setterContext;ee[Re]={read:Xn=>ke.fromWireType(Ie(rt,Xn)),write:(Xn,o0)=>{var ra=[];Lt(An,Xn,et.toWireType(ra,o0)),Tt(ra)}}}),[{name:E.name,fromWireType:function(se){var ve={};for(var Re in ee)ve[Re]=ee[Re].read(se);return F(se),ve},toWireType:function(se,ve){for(var Re in ee)if(!(Re in ve))throw new TypeError('Missing field:  "'+Re+'"');var ke=b();for(Re in ee)ee[Re].write(ke,ve[Re]);return se!==null&&se.push(F,ke),ke},argPackAdvance:8,readValueFromPointer:Jn,destructorFunction:F}]})}function Ha(S,E,b,F,W){}function sn(S){switch(S){case 1:return 0;case 2:return 1;case 4:return 2;case 8:return 3;default:throw new TypeError("Unknown type size: "+S)}}function qr(){for(var S=new Array(256),E=0;E<256;++E)S[E]=String.fromCharCode(E);He=S}var He=void 0;function xt(S){for(var E="",b=S;q[b];)E+=He[q[b++]];return E}var st=void 0;function Je(S){throw new st(S)}function kn(S,E,b={}){if(!("argPackAdvance"in E))throw new TypeError("registerType registeredInstance requires argPackAdvance");var F=E.name;if(S||Je('type "'+F+'" must have a positive integer typeid pointer'),er.hasOwnProperty(S)){if(b.ignoreDuplicateRegistrations)return;Je("Cannot register type '"+F+"' twice")}if(er[S]=E,delete Xi[S],lr.hasOwnProperty(S)){var W=lr[S];delete lr[S],W.forEach(H=>H())}}function bo(S,E,b,F,W){var H=sn(b);E=xt(E),kn(S,{name:E,fromWireType:function(Y){return!!Y},toWireType:function(Y,ee){return ee?F:W},argPackAdvance:8,readValueFromPointer:function(Y){var ee;if(b===1)ee=Q;else if(b===2)ee=j;else if(b===4)ee=ue;else throw new TypeError("Unknown boolean type size: "+E);return this.fromWireType(ee[Y>>H])},destructorFunction:null})}function Lo(S){if(!(this instanceof ti)||!(S instanceof ti))return!1;for(var E=this.$$.ptrType.registeredClass,b=this.$$.ptr,F=S.$$.ptrType.registeredClass,W=S.$$.ptr;E.baseClass;)b=E.upcast(b),E=E.baseClass;for(;F.baseClass;)W=F.upcast(W),F=F.baseClass;return E===F&&b===W}function Zi(S){return{count:S.count,deleteScheduled:S.deleteScheduled,preservePointerOnDelete:S.preservePointerOnDelete,ptr:S.ptr,ptrType:S.ptrType,smartPtr:S.smartPtr,smartPtrType:S.smartPtrType}}function wa(S){function E(b){return b.$$.ptrType.registeredClass.name}Je(E(S)+" instance already deleted")}var Qi=!1;function dn(S){}function vi(S){S.smartPtr?S.smartPtrType.rawDestructor(S.smartPtr):S.ptrType.registeredClass.rawDestructor(S.ptr)}function ht(S){S.count.value-=1;var E=S.count.value===0;E&&vi(S)}function Sr(S,E,b){if(E===b)return S;if(b.baseClass===void 0)return null;var F=Sr(S,E,b.baseClass);return F===null?null:b.downcast(F)}var Ji={};function Io(){return Object.keys(Qr).length}function Xr(){var S=[];for(var E in Qr)Qr.hasOwnProperty(E)&&S.push(Qr[E]);return S}var Yr=[];function Zr(){for(;Yr.length;){var S=Yr.pop();S.$$.deleteScheduled=!1,S.delete()}}var Pr=void 0;function Pc(S){Pr=S,Yr.length&&Pr&&Pr(Zr)}function ea(){a.getInheritedInstanceCount=Io,a.getLiveInheritedInstances=Xr,a.flushPendingDeletes=Zr,a.setDelayFunction=Pc}var Qr={};function Ss(S,E){for(E===void 0&&Je("ptr should not be undefined");S.baseClass;)E=S.upcast(E),S=S.baseClass;return E}function yi(S,E){return E=Ss(S,E),Qr[E]}function Ka(S,E){(!E.ptrType||!E.ptr)&&zn("makeClassHandle requires ptr and ptrType");var b=!!E.smartPtrType,F=!!E.smartPtr;return b!==F&&zn("Both smartPtrType and smartPtr must be specified"),E.count={value:1},Pi(Object.create(S,{$$:{value:E}}))}function Jr(S){var E=this.getPointee(S);if(!E)return this.destructor(S),null;var b=yi(this.registeredClass,E);if(b!==void 0){if(b.$$.count.value===0)return b.$$.ptr=E,b.$$.smartPtr=S,b.clone();var F=b.clone();return this.destructor(S),F}function W(){return this.isSmartPointer?Ka(this.registeredClass.instancePrototype,{ptrType:this.pointeeType,ptr:E,smartPtrType:this,smartPtr:S}):Ka(this.registeredClass.instancePrototype,{ptrType:this,ptr:S})}var H=this.registeredClass.getActualType(E),Y=Ji[H];if(!Y)return W.call(this);var ee;this.isConst?ee=Y.constPointerType:ee=Y.pointerType;var se=Sr(E,this.registeredClass,ee.registeredClass);return se===null?W.call(this):this.isSmartPointer?Ka(ee.registeredClass.instancePrototype,{ptrType:ee,ptr:se,smartPtrType:this,smartPtr:S}):Ka(ee.registeredClass.instancePrototype,{ptrType:ee,ptr:se})}function Pi(S){return typeof FinalizationRegistry>"u"?(Pi=E=>E,S):(Qi=new FinalizationRegistry(E=>{ht(E.$$)}),Pi=E=>{var b=E.$$,F=!!b.smartPtr;if(F){var W={$$:b};Qi.register(E,W,E)}return E},dn=E=>Qi.unregister(E),Pi(S))}function xa(){if(this.$$.ptr||wa(this),this.$$.preservePointerOnDelete)return this.$$.count.value+=1,this;var S=Pi(Object.create(Object.getPrototypeOf(this),{$$:{value:Zi(this.$$)}}));return S.$$.count.value+=1,S.$$.deleteScheduled=!1,S}function Nc(){this.$$.ptr||wa(this),this.$$.deleteScheduled&&!this.$$.preservePointerOnDelete&&Je("Object already scheduled for deletion"),dn(this),ht(this.$$),this.$$.preservePointerOnDelete||(this.$$.smartPtr=void 0,this.$$.ptr=void 0)}function Ti(){return!this.$$.ptr}function ta(){return this.$$.ptr||wa(this),this.$$.deleteScheduled&&!this.$$.preservePointerOnDelete&&Je("Object already scheduled for deletion"),Yr.push(this),Yr.length===1&&Pr&&Pr(Zr),this.$$.deleteScheduled=!0,this}function ei(){ti.prototype.isAliasOf=Lo,ti.prototype.clone=xa,ti.prototype.delete=Nc,ti.prototype.isDeleted=Ti,ti.prototype.deleteLater=ta}function ti(){}function Ni(S,E,b){if(S[E].overloadTable===void 0){var F=S[E];S[E]=function(){return S[E].overloadTable.hasOwnProperty(arguments.length)||Je("Function '"+b+"' called with an invalid number of arguments ("+arguments.length+") - expects one of ("+S[E].overloadTable+")!"),S[E].overloadTable[arguments.length].apply(this,arguments)},S[E].overloadTable=[],S[E].overloadTable[F.argCount]=F}}function kc(S,E,b){a.hasOwnProperty(S)?(Je("Cannot register public name '"+S+"' twice"),Ni(a,S,S),a.hasOwnProperty(b)&&Je("Cannot register multiple overloads of a function with the same number of arguments ("+b+")!"),a[S].overloadTable[b]=E):a[S]=E}function ki(S,E,b,F,W,H,Y,ee){this.name=S,this.constructor=E,this.instancePrototype=b,this.rawDestructor=F,this.baseClass=W,this.getActualType=H,this.upcast=Y,this.downcast=ee,this.pureVirtualFunctions=[]}function Vo(S,E,b){for(;E!==b;)E.upcast||Je("Expected null or instance of "+b.name+", got an instance of "+E.name),S=E.upcast(S),E=E.baseClass;return S}function Ac(S,E){if(E===null)return this.isReference&&Je("null is not a valid "+this.name),0;E.$$||Je('Cannot pass "'+tr(E)+'" as a '+this.name),E.$$.ptr||Je("Cannot pass deleted object as a pointer of type "+this.name);var b=E.$$.ptrType.registeredClass,F=Vo(E.$$.ptr,b,this.registeredClass);return F}function Fc(S,E){var b;if(E===null)return this.isReference&&Je("null is not a valid "+this.name),this.isSmartPointer?(b=this.rawConstructor(),S!==null&&S.push(this.rawDestructor,b),b):0;E.$$||Je('Cannot pass "'+tr(E)+'" as a '+this.name),E.$$.ptr||Je("Cannot pass deleted object as a pointer of type "+this.name),!this.isConst&&E.$$.ptrType.isConst&&Je("Cannot convert argument of type "+(E.$$.smartPtrType?E.$$.smartPtrType.name:E.$$.ptrType.name)+" to parameter type "+this.name);var F=E.$$.ptrType.registeredClass;if(b=Vo(E.$$.ptr,F,this.registeredClass),this.isSmartPointer)switch(E.$$.smartPtr===void 0&&Je("Passing raw pointer to smart pointer is illegal"),this.sharingPolicy){case 0:E.$$.smartPtrType===this?b=E.$$.smartPtr:Je("Cannot convert argument of type "+(E.$$.smartPtrType?E.$$.smartPtrType.name:E.$$.ptrType.name)+" to parameter type "+this.name);break;case 1:b=E.$$.smartPtr;break;case 2:if(E.$$.smartPtrType===this)b=E.$$.smartPtr;else{var W=E.clone();b=this.rawShare(b,wi.toHandle(function(){W.delete()})),S!==null&&S.push(this.rawDestructor,b)}break;default:Je("Unsupporting sharing policy")}return b}function Uc(S,E){if(E===null)return this.isReference&&Je("null is not a valid "+this.name),0;E.$$||Je('Cannot pass "'+tr(E)+'" as a '+this.name),E.$$.ptr||Je("Cannot pass deleted object as a pointer of type "+this.name),E.$$.ptrType.isConst&&Je("Cannot convert argument of type "+E.$$.ptrType.name+" to parameter type "+this.name);var b=E.$$.ptrType.registeredClass,F=Vo(E.$$.ptr,b,this.registeredClass);return F}function Bc(S){return this.rawGetPointee&&(S=this.rawGetPointee(S)),S}function Sn(S){this.rawDestructor&&this.rawDestructor(S)}function Po(S){S!==null&&S.delete()}function Nr(){ur.prototype.getPointee=Bc,ur.prototype.destructor=Sn,ur.prototype.argPackAdvance=8,ur.prototype.readValueFromPointer=Jn,ur.prototype.deleteObject=Po,ur.prototype.fromWireType=Jr}function ur(S,E,b,F,W,H,Y,ee,se,ve,Re){this.name=S,this.registeredClass=E,this.isReference=b,this.isConst=F,this.isSmartPointer=W,this.pointeeType=H,this.sharingPolicy=Y,this.rawGetPointee=ee,this.rawConstructor=se,this.rawShare=ve,this.rawDestructor=Re,!W&&E.baseClass===void 0?F?(this.toWireType=Ac,this.destructorFunction=null):(this.toWireType=Uc,this.destructorFunction=null):this.toWireType=Fc}function qa(S,E,b){a.hasOwnProperty(S)||zn("Replacing nonexistant public symbol"),a[S].overloadTable!==void 0&&b!==void 0||(a[S]=E,a[S].argCount=b)}function Xa(S,E,b){var F=a["dynCall_"+S];return b&&b.length?F.apply(null,[E].concat(b)):F.call(null,E)}var Sa=[];function pn(S){var E=Sa[S];return E||(S>=Sa.length&&(Sa.length=S+1),Sa[S]=E=yt.get(S)),E}function Es(S,E,b){if(S.includes("j"))return Xa(S,E,b);var F=pn(E).apply(null,b);return F}function Er(S,E){var b=[];return function(){return b.length=0,Object.assign(b,arguments),Es(S,E,b)}}function Hn(S,E){S=xt(S);function b(){return S.includes("j")?Er(S,E):pn(E)}var F=b();return typeof F!="function"&&Je("unknown function pointer with signature "+S+": "+E),F}var No=void 0;function Kn(S){var E=Ue(S),b=xt(E);return be(E),b}function Ya(S,E){var b=[],F={};function W(H){if(!F[H]&&!er[H]){if(Xi[H]){Xi[H].forEach(W);return}b.push(H),F[H]=!0}}throw E.forEach(W),new No(S+": "+b.map(Kn).join([", "]))}function Za(S,E,b,F,W,H,Y,ee,se,ve,Re,ke,Ie){Re=xt(Re),H=Hn(W,H),ee&&(ee=Hn(Y,ee)),ve&&(ve=Hn(se,ve)),Ie=Hn(ke,Ie);var rt=Yi(Re);kc(rt,function(){Ya("Cannot construct "+Re+" due to unbound types",[F])}),jn([S,E,b],F?[F]:[],function(et){et=et[0];var Lt,An;F?(Lt=et.registeredClass,An=Lt.instancePrototype):An=ti.prototype;var Xn=wr(rt,function(){if(Object.getPrototypeOf(this)!==o0)throw new st("Use 'new' to construct "+Re);if(ra.constructor_body===void 0)throw new st(Re+" has no accessible constructor");var A8=ra.constructor_body[arguments.length];if(A8===void 0)throw new st("Tried to invoke ctor of "+Re+" with invalid number of parameters ("+arguments.length+") - expected ("+Object.keys(ra.constructor_body).toString()+") parameters instead!");return A8.apply(this,arguments)}),o0=Object.create(An,{constructor:{value:Xn}});Xn.prototype=o0;var ra=new ki(Re,Xn,o0,Ie,Lt,H,ee,ve),bd=new ur(Re,ra,!0,!1,!1),sf=new ur(Re+"*",ra,!1,!1,!1),k8=new ur(Re+" const*",ra,!1,!0,!1);return Ji[S]={pointerType:sf,constPointerType:k8},qa(rt,Xn),[bd,sf,k8]})}function Os(S,E){for(var b=[],F=0;F<S;F++)b.push(le[E+F*4>>2]);return b}function Ds(S,E){if(!(S instanceof Function))throw new TypeError("new_ called with constructor type "+typeof S+" which is not a function");var b=wr(S.name||"unknownFunctionName",function(){});b.prototype=S.prototype;var F=new b,W=S.apply(F,E);return W instanceof Object?W:F}function qn(S,E,b,F,W){var H=E.length;H<2&&Je("argTypes array size mismatch! Must at least get return value and 'this' types!");for(var Y=E[1]!==null&&b!==null,ee=!1,se=1;se<E.length;++se)if(E[se]!==null&&E[se].destructorFunction===void 0){ee=!0;break}for(var ve=E[0].name!=="void",Re="",ke="",se=0;se<H-2;++se)Re+=(se!==0?", ":"")+"arg"+se,ke+=(se!==0?", ":"")+"arg"+se+"Wired";var Ie="return function "+Yi(S)+"("+Re+`) {
if (arguments.length !== `+(H-2)+`) {
throwBindingError('function `+S+" called with ' + arguments.length + ' arguments, expected "+(H-2)+` args!');
}
`;ee&&(Ie+=`var destructors = [];
`);var rt=ee?"destructors":"null",et=["throwBindingError","invoker","fn","runDestructors","retType","classParam"],Lt=[Je,F,W,Tt,E[0],E[1]];Y&&(Ie+="var thisWired = classParam.toWireType("+rt+`, this);
`);for(var se=0;se<H-2;++se)Ie+="var arg"+se+"Wired = argType"+se+".toWireType("+rt+", arg"+se+"); // "+E[se+2].name+`
`,et.push("argType"+se),Lt.push(E[se+2]);if(Y&&(ke="thisWired"+(ke.length>0?", ":"")+ke),Ie+=(ve?"var rv = ":"")+"invoker(fn"+(ke.length>0?", ":"")+ke+`);
`,ee)Ie+=`runDestructors(destructors);
`;else for(var se=Y?1:2;se<E.length;++se){var An=se===1?"thisWired":"arg"+(se-2)+"Wired";E[se].destructorFunction!==null&&(Ie+=An+"_dtor("+An+"); // "+E[se].name+`
`,et.push(An+"_dtor"),Lt.push(E[se].destructorFunction))}ve&&(Ie+=`var ret = retType.fromWireType(rv);
return ret;
`),Ie+=`}
`,et.push(Ie);var Xn=Ds(Function,et).apply(null,Lt);return Xn}function fr(S,E,b,F,W,H){_(E>0);var Y=Os(E,b);W=Hn(F,W),jn([],[S],function(ee){ee=ee[0];var se="constructor "+ee.name;if(ee.registeredClass.constructor_body===void 0&&(ee.registeredClass.constructor_body=[]),ee.registeredClass.constructor_body[E-1]!==void 0)throw new st("Cannot register multiple constructors with identical number of parameters ("+(E-1)+") for class '"+ee.name+"'! Overload resolution is currently only performed using the parameter count, not actual type info!");return ee.registeredClass.constructor_body[E-1]=()=>{Ya("Cannot construct "+ee.name+" due to unbound types",Y)},jn([],Y,function(ve){return ve.splice(1,0,null),ee.registeredClass.constructor_body[E-1]=qn(se,ve,null,W,H),[]}),[]})}function Ea(S,E,b,F,W,H,Y,ee){var se=Os(b,F);E=xt(E),H=Hn(W,H),jn([],[S],function(ve){ve=ve[0];var Re=ve.name+"."+E;E.startsWith("@@")&&(E=Symbol[E.substring(2)]),ee&&ve.registeredClass.pureVirtualFunctions.push(E);function ke(){Ya("Cannot call "+Re+" due to unbound types",se)}var Ie=ve.registeredClass.instancePrototype,rt=Ie[E];return rt===void 0||rt.overloadTable===void 0&&rt.className!==ve.name&&rt.argCount===b-2?(ke.argCount=b-2,ke.className=ve.name,Ie[E]=ke):(Ni(Ie,E,Re),Ie[E].overloadTable[b-2]=ke),jn([],se,function(et){var Lt=qn(Re,et,ve,H,Y);return Ie[E].overloadTable===void 0?(Lt.argCount=b-2,Ie[E]=Lt):Ie[E].overloadTable[b-2]=Lt,[]}),[]})}var En=[],gr=[{},{value:void 0},{value:null},{value:!0},{value:!1}];function Qa(S){S>4&&--gr[S].refcount===0&&(gr[S]=void 0,En.push(S))}function Ci(){for(var S=0,E=5;E<gr.length;++E)gr[E]!==void 0&&++S;return S}function ko(){for(var S=5;S<gr.length;++S)if(gr[S]!==void 0)return gr[S];return null}function kr(){a.count_emval_handles=Ci,a.get_first_emval=ko}var wi={toValue:S=>(S||Je("Cannot use deleted val. handle = "+S),gr[S].value),toHandle:S=>{switch(S){case void 0:return 1;case null:return 2;case!0:return 3;case!1:return 4;default:{var E=En.length?En.pop():gr.length;return gr[E]={refcount:1,value:S},E}}}};function Oa(S,E){E=xt(E),kn(S,{name:E,fromWireType:function(b){var F=wi.toValue(b);return Qa(b),F},toWireType:function(b,F){return wi.toHandle(F)},argPackAdvance:8,readValueFromPointer:Jn,destructorFunction:null})}function tr(S){if(S===null)return"null";var E=typeof S;return E==="object"||E==="array"||E==="function"?S.toString():""+S}function Rs(S,E){switch(E){case 2:return function(b){return this.fromWireType(Fe[b>>2])};case 3:return function(b){return this.fromWireType(kt[b>>3])};default:throw new TypeError("Unknown float type: "+S)}}function Gc(S,E,b){var F=sn(b);E=xt(E),kn(S,{name:E,fromWireType:function(W){return W},toWireType:function(W,H){return H},argPackAdvance:8,readValueFromPointer:Rs(E,F),destructorFunction:null})}function $c(S,E,b){switch(E){case 0:return b?function(W){return Q[W]}:function(W){return q[W]};case 1:return b?function(W){return j[W>>1]}:function(W){return ie[W>>1]};case 2:return b?function(W){return ue[W>>2]}:function(W){return le[W>>2]};default:throw new TypeError("Unknown integer type: "+S)}}function Wc(S,E,b,F,W){E=xt(E);var H=sn(b),Y=ke=>ke;if(F===0){var ee=32-8*b;Y=ke=>ke<<ee>>>ee}var se=E.includes("unsigned"),ve=(ke,Ie)=>{},Re;se?Re=function(ke,Ie){return ve(Ie,this.name),Ie>>>0}:Re=function(ke,Ie){return ve(Ie,this.name),Ie},kn(S,{name:E,fromWireType:Y,toWireType:Re,argPackAdvance:8,readValueFromPointer:$c(E,H,F!==0),destructorFunction:null})}function Da(S,E,b){var F=[Int8Array,Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array],W=F[E];function H(Y){Y=Y>>2;var ee=le,se=ee[Y],ve=ee[Y+1];return new W(de,ve,se)}b=xt(b),kn(S,{name:b,fromWireType:H,argPackAdvance:8,readValueFromPointer:H},{ignoreDuplicateRegistrations:!0})}function Ms(S,E){E=xt(E);var b=E==="std::string";kn(S,{name:E,fromWireType:function(F){var W=le[F>>2],H=F+4,Y;if(b)for(var ee=H,se=0;se<=W;++se){var ve=H+se;if(se==W||q[ve]==0){var Re=ve-ee,ke=X(ee,Re);Y===void 0?Y=ke:(Y+="\0",Y+=ke),ee=ve+1}}else{for(var Ie=new Array(W),se=0;se<W;++se)Ie[se]=String.fromCharCode(q[H+se]);Y=Ie.join("")}return be(F),Y},toWireType:function(F,W){W instanceof ArrayBuffer&&(W=new Uint8Array(W));var H,Y=typeof W=="string";Y||W instanceof Uint8Array||W instanceof Uint8ClampedArray||W instanceof Int8Array||Je("Cannot pass non-string to std::string"),b&&Y?H=J(W):H=W.length;var ee=we(4+H+1),se=ee+4;if(le[ee>>2]=H,b&&Y)ce(W,se,H+1);else if(Y)for(var ve=0;ve<H;++ve){var Re=W.charCodeAt(ve);Re>255&&(be(se),Je("String has UTF-16 code units that do not fit in 8 bits")),q[se+ve]=Re}else for(var ve=0;ve<H;++ve)q[se+ve]=W[ve];return F!==null&&F.push(be,ee),ee},argPackAdvance:8,readValueFromPointer:Jn,destructorFunction:function(F){be(F)}})}var Ja=typeof TextDecoder<"u"?new TextDecoder("utf-16le"):void 0;function zc(S,E){for(var b=S,F=b>>1,W=F+E/2;!(F>=W)&&ie[F];)++F;if(b=F<<1,b-S>32&&Ja)return Ja.decode(q.subarray(S,b));for(var H="",Y=0;!(Y>=E/2);++Y){var ee=j[S+Y*2>>1];if(ee==0)break;H+=String.fromCharCode(ee)}return H}function jc(S,E,b){if(b===void 0&&(b=2147483647),b<2)return 0;b-=2;for(var F=E,W=b<S.length*2?b/2:S.length,H=0;H<W;++H){var Y=S.charCodeAt(H);j[E>>1]=Y,E+=2}return j[E>>1]=0,E-F}function Hc(S){return S.length*2}function Kc(S,E){for(var b=0,F="";!(b>=E/4);){var W=ue[S+b*4>>2];if(W==0)break;if(++b,W>=65536){var H=W-65536;F+=String.fromCharCode(55296|H>>10,56320|H&1023)}else F+=String.fromCharCode(W)}return F}function qc(S,E,b){if(b===void 0&&(b=2147483647),b<4)return 0;for(var F=E,W=F+b-4,H=0;H<S.length;++H){var Y=S.charCodeAt(H);if(Y>=55296&&Y<=57343){var ee=S.charCodeAt(++H);Y=65536+((Y&1023)<<10)|ee&1023}if(ue[E>>2]=Y,E+=4,E+4>W)break}return ue[E>>2]=0,E-F}function Xc(S){for(var E=0,b=0;b<S.length;++b){var F=S.charCodeAt(b);F>=55296&&F<=57343&&++b,E+=4}return E}function Yc(S,E,b){b=xt(b);var F,W,H,Y,ee;E===2?(F=zc,W=jc,Y=Hc,H=()=>ie,ee=1):E===4&&(F=Kc,W=qc,Y=Xc,H=()=>le,ee=2),kn(S,{name:b,fromWireType:function(se){for(var ve=le[se>>2],Re=H(),ke,Ie=se+4,rt=0;rt<=ve;++rt){var et=se+4+rt*E;if(rt==ve||Re[et>>ee]==0){var Lt=et-Ie,An=F(Ie,Lt);ke===void 0?ke=An:(ke+="\0",ke+=An),Ie=et+E}}return be(se),ke},toWireType:function(se,ve){typeof ve!="string"&&Je("Cannot pass non-string to C++ string type "+b);var Re=Y(ve),ke=we(4+Re+E);return le[ke>>2]=Re>>ee,W(ve,ke+4,Re+E),se!==null&&se.push(be,ke),ke},argPackAdvance:8,readValueFromPointer:Jn,destructorFunction:function(se){be(se)}})}function _s(S,E,b,F,W,H){Pt[S]={name:xt(E),rawConstructor:Hn(b,F),rawDestructor:Hn(W,H),fields:[]}}function Zc(S,E,b,F,W,H,Y,ee,se,ve){Pt[S].fields.push({fieldName:xt(E),getterReturnType:b,getter:Hn(F,W),getterContext:H,setterArgumentType:Y,setter:Hn(ee,se),setterContext:ve})}function Qc(S,E){E=xt(E),kn(S,{isVoid:!0,name:E,argPackAdvance:0,fromWireType:function(){},toWireType:function(b,F){}})}function bs(){throw 1/0}var Ls={};function Jc(S){var E=Ls[S];return E===void 0?xt(S):E}function Ao(){return typeof globalThis=="object"?globalThis:function(){return Function}()("return this")()}function Is(S){return S===0?wi.toHandle(Ao()):(S=Jc(S),wi.toHandle(Ao()[S]))}function Vs(S){S>4&&(gr[S].refcount+=1)}function Fo(S,E){var b=er[S];return b===void 0&&Je(E+" has unknown type "+Kn(S)),b}function e0(S){for(var E="",b=0;b<S;++b)E+=(b!==0?", ":"")+"arg"+b;for(var F=()=>le,W="return function emval_allocator_"+S+`(constructor, argTypes, args) {
  var HEAPU32 = getMemory();
`,b=0;b<S;++b)W+="var argType"+b+" = requireRegisteredType(HEAPU32[((argTypes)>>2)], 'parameter "+b+`');
var arg`+b+" = argType"+b+`.readValueFromPointer(args);
args += argType`+b+`['argPackAdvance'];
argTypes += 4;
`;return W+="var obj = new constructor("+E+`);
return valueToHandle(obj);
}
`,new Function("requireRegisteredType","Module","valueToHandle","getMemory",W)(Fo,a,wi.toHandle,F)}var Ps={};function t0(S,E,b,F){S=wi.toValue(S);var W=Ps[E];return W||(W=e0(E),Ps[E]=W),W(S,b,F)}function Ns(S,E){S=Fo(S,"_emval_take_value");var b=S.readValueFromPointer(E);return wi.toHandle(b)}function n0(){U("")}function r0(S,E,b){q.copyWithin(S,E,E+b)}function i0(){return 2147483648}function a0(S){try{return M.grow(S-de.byteLength+65535>>>16),lt(M.buffer),1}catch{}}function Uo(S){var E=q.length;S=S>>>0;var b=i0();if(S>b)return!1;let F=(se,ve)=>se+(ve-se%ve)%ve;for(var W=1;W<=4;W*=2){var H=E*(1+.2/W);H=Math.min(H,S+100663296);var Y=Math.min(b,F(Math.max(S,H),65536)),ee=a0(Y);if(ee)return!0}return!1}var Bo={};function Ai(){return l||"./this.program"}function na(){if(!na.strings){var S=(typeof navigator=="object"&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",E={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:S,_:Ai()};for(var b in Bo)Bo[b]===void 0?delete E[b]:E[b]=Bo[b];var F=[];for(var b in E)F.push(b+"="+E[b]);na.strings=F}return na.strings}function ni(S,E,b){for(var F=0;F<S.length;++F)Q[E++>>0]=S.charCodeAt(F);Q[E>>0]=0}function ks(S,E){var b=0;return na().forEach(function(F,W){var H=E+b;le[S+W*4>>2]=H,ni(F,H),b+=F.length+1}),0}function As(S,E){var b=na();le[S>>2]=b.length;var F=0;return b.forEach(function(W){F+=W.length+1}),le[E>>2]=F,0}function Go(S){f(S,new Ct(S))}function Fs(S,E){Go(S)}var eo=Fs;function Us(S){return 52}function V(S,E,b,F,W){return 70}var N=[null,[],[]];function K(S,E){var b=N[S];E===0||E===10?((S===1?w:x)(z(b,0)),b.length=0):b.push(E)}function oe(S,E,b,F){for(var W=0,H=0;H<b;H++){var Y=le[E>>2],ee=le[E+4>>2];E+=8;for(var se=0;se<ee;se++)K(S,q[Y+se]);W+=ee}return le[F>>2]=W,0}function ge(S){var E=a["_"+S];return E}function ye(S,E){Q.set(S,E)}function Te(S,E,b,F,W){var H={string:et=>{var Lt=0;if(et!=null&&et!==0){var An=(et.length<<2)+1;Lt=L(An),ce(et,Lt,An)}return Lt},array:et=>{var Lt=L(et.length);return ye(et,Lt),Lt}};function Y(et){return E==="string"?X(et):E==="boolean"?!!et:et}var ee=ge(S),se=[],ve=0;if(F)for(var Re=0;Re<F.length;Re++){var ke=H[b[Re]];ke?(ve===0&&(ve=qe()),se[Re]=ke(F[Re])):se[Re]=F[Re]}var Ie=ee.apply(null,se);function rt(et){return ve!==0&&I(ve),Y(et)}return Ie=rt(Ie),Ie}Kr=a.InternalError=xr(Error,"InternalError"),qr(),st=a.BindingError=xr(Error,"BindingError"),ei(),ea(),Nr(),No=a.UnboundTypeError=xr(Error,"UnboundTypeError"),kr();var pe={g:gn,A:ja,w:Ha,F:bo,u:Za,t:fr,c:Ea,E:Oa,m:Gc,b:Wc,a:Da,l:Ms,h:Yc,J:_s,d:Zc,G:Qc,x:bs,i:Qa,r:Is,p:Vs,q:t0,s:Ns,j:n0,D:r0,y:Uo,z:ks,B:As,I:eo,C:Us,v:V,k:oe,o:fe,n:me,H:Ce,f:re,e:Se};it(),a.___wasm_call_ctors=function(){return(a.___wasm_call_ctors=a.asm.L).apply(null,arguments)};var we=a._malloc=function(){return(we=a._malloc=a.asm.N).apply(null,arguments)},be=a._free=function(){return(be=a._free=a.asm.O).apply(null,arguments)},Ue=a.___getTypeName=function(){return(Ue=a.___getTypeName=a.asm.P).apply(null,arguments)};a.__embind_initialize_bindings=function(){return(a.__embind_initialize_bindings=a.asm.Q).apply(null,arguments)};var ze=a._setThrew=function(){return(ze=a._setThrew=a.asm.R).apply(null,arguments)},qe=a.stackSave=function(){return(qe=a.stackSave=a.asm.S).apply(null,arguments)},I=a.stackRestore=function(){return(I=a.stackRestore=a.asm.T).apply(null,arguments)},L=a.stackAlloc=function(){return(L=a.stackAlloc=a.asm.U).apply(null,arguments)},G=a.___cxa_is_pointer_type=function(){return(G=a.___cxa_is_pointer_type=a.asm.V).apply(null,arguments)};a.dynCall_jiji=function(){return(a.dynCall_jiji=a.asm.W).apply(null,arguments)};function re(S,E){var b=qe();try{pn(S)(E)}catch(F){if(I(b),F!==F+0)throw F;ze(1,0)}}function fe(S,E){var b=qe();try{return pn(S)(E)}catch(F){if(I(b),F!==F+0)throw F;ze(1,0)}}function Se(S,E,b,F){var W=qe();try{pn(S)(E,b,F)}catch(H){if(I(W),H!==H+0)throw H;ze(1,0)}}function Ce(S,E,b,F){var W=qe();try{return pn(S)(E,b,F)}catch(H){if(I(W),H!==H+0)throw H;ze(1,0)}}function me(S,E,b){var F=qe();try{return pn(S)(E,b)}catch(W){if(I(F),W!==W+0)throw W;ze(1,0)}}a.ccall=Te;var D;fn=function S(){D||R(),D||(fn=S)};function R(S){if(Nn>0||(Ye(),Nn>0))return;function E(){D||(D=!0,a.calledRun=!0,!A&&(Zt(),o(a),a.onRuntimeInitialized&&a.onRuntimeInitialized(),jr()))}a.setStatus?(a.setStatus("Running..."),setTimeout(function(){setTimeout(function(){a.setStatus("")},1),E()},1)):E()}if(a.preInit)for(typeof a.preInit=="function"&&(a.preInit=[a.preInit]);a.preInit.length>0;)a.preInit.pop()();return R(),i.ready}})();t.exports=n})(t_);var Rne=t_.exports;const Mne=Eo(Rne),_ne=new URL("/dicom-viewer/assets/libjpegturbowasm_decode-daqMmuVl.wasm",import.meta.url),vp={codec:void 0,decoder:void 0};function bne(){if(vp.codec)return Promise.resolve();const t=Mne({locateFile:e=>e.endsWith(".wasm")?_ne.toString():e});return new Promise((e,n)=>{t.then(r=>{vp.codec=r,vp.decoder=new r.JPEGDecoder,e()},n)})}async function Lne(t,e){await bne();const n=vp.decoder;n.getEncodedBuffer(t.length).set(t),n.decode();const i=n.getFrameInfo(),a=n.getDecodedBuffer(),o={columns:i.width,rows:i.height,bitsPerPixel:i.bitsPerSample,signed:e.signed,bytesPerPixel:e.bytesPerPixel,componentsPerPixel:i.componentCount},s=Ine(i,a),c={frameInfo:i};return{...e,pixelData:s,imageInfo:o,encodeOptions:c,...c,...o}}function Ine(t,e){return t.isSigned?new Int8Array(e.buffer,e.byteOffset,e.byteLength):new Uint8Array(e.buffer,e.byteOffset,e.byteLength)}const Vne="modulepreload",Pne=function(t){return"/dicom-viewer/"+t},mT={},n_=function(e,n,r){let i=Promise.resolve();if(n&&n.length>0){document.getElementsByTagName("link");const a=document.querySelector("meta[property=csp-nonce]"),o=(a==null?void 0:a.nonce)||(a==null?void 0:a.getAttribute("nonce"));i=Promise.all(n.map(s=>{if(s=Pne(s),s in mT)return;mT[s]=!0;const c=s.endsWith(".css"),l=c?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${s}"]${l}`))return;const f=document.createElement("link");if(f.rel=c?"stylesheet":Vne,c||(f.as="script",f.crossOrigin=""),f.href=s,o&&f.setAttribute("nonce",o),document.head.appendChild(f),c)return new Promise((u,g)=>{f.addEventListener("load",u),f.addEventListener("error",()=>g(new Error(`Unable to preload CSS for ${s}`)))})}))}return i.then(()=>e()).catch(a=>{const o=new Event("vite:preloadError",{cancelable:!0});if(o.payload=a,window.dispatchEvent(o),!o.defaultPrevented)throw a})},fg={JpegImage:void 0,decodeConfig:{}};function Nne(t){return fg.decodeConfig=t,fg.JpegImage?Promise.resolve():new Promise((e,n)=>{n_(()=>import("./jpeg-BQEpTZHd.js"),[]).then(r=>{fg.JpegImage=r.default,e()}).catch(n)})}async function kne(t,e){if(await Nne(),typeof fg.JpegImage>"u")throw new Error("No JPEG Baseline decoder loaded");const n=new fg.JpegImage;if(n.parse(e),n.colorTransform=!1,t.bitsAllocated===8)return t.pixelData=n.getData(t.columns,t.rows),t;if(t.bitsAllocated===16)return t.pixelData=n.getData16(t.columns,t.rows),t}const gg={jpeg:void 0,decodeConfig:{}};function Ane(t){return gg.decodeConfig=t,gg.jpeg?Promise.resolve():new Promise((e,n)=>{n_(async()=>{const{Decoder:r}=await import("./lossless-BIYWXcdg.js");return{Decoder:r}},[]).then(({Decoder:r})=>{const i=new r;gg.jpeg=i,e()},n)})}async function vT(t,e){if(await Ane(),typeof gg.jpeg>"u")throw new Error("No JPEG Lossless decoder loaded");const n=t.bitsAllocated<=8?1:2,r=e.buffer,i=gg.jpeg.decode(r,e.byteOffset,e.length,n);return t.pixelRepresentation===0?t.bitsAllocated===16?(t.pixelData=new Uint16Array(i.buffer),t):(t.pixelData=new Uint8Array(i.buffer),t):(t.pixelData=new Int16Array(i.buffer),t)}var r_={exports:{}};(function(t,e){var n=(()=>{var r=typeof document<"u"&&document.currentScript?document.currentScript.src:void 0;return typeof __filename<"u"&&(r=r||__filename),function(i){i=i||{};var a=typeof i<"u"?i:{},o,s;a.ready=new Promise(function(V,N){o=V,s=N});var c=Object.assign({},a),l=typeof window=="object",f=typeof importScripts=="function",u=typeof process=="object"&&typeof process.versions=="object"&&typeof process.versions.node=="string",g="";function d(V){return a.locateFile?a.locateFile(V,g):g+V}var h,p,m;if(u){var v=vo,y=vo;f?g=y.dirname(g)+"/":g=__dirname+"/",h=(V,N)=>(V=U(V)?new URL(V):y.normalize(V),v.readFileSync(V,N?void 0:"utf8")),m=V=>{var N=h(V,!0);return N.buffer||(N=new Uint8Array(N)),N},p=(V,N,K)=>{V=U(V)?new URL(V):y.normalize(V),v.readFile(V,function(oe,ge){oe?K(oe):N(ge.buffer)})},process.argv.length>1&&process.argv[1].replace(/\\/g,"/"),process.argv.slice(2),process.on("uncaughtException",function(V){if(!(V instanceof xe))throw V}),process.on("unhandledRejection",function(V){throw V}),a.inspect=function(){return"[Emscripten Module object]"}}else(l||f)&&(f?g=self.location.href:typeof document<"u"&&document.currentScript&&(g=document.currentScript.src),r&&(g=r),g.indexOf("blob:")!==0?g=g.substr(0,g.replace(/[?#].*/,"").lastIndexOf("/")+1):g="",h=V=>{var N=new XMLHttpRequest;return N.open("GET",V,!1),N.send(null),N.responseText},f&&(m=V=>{var N=new XMLHttpRequest;return N.open("GET",V,!1),N.responseType="arraybuffer",N.send(null),new Uint8Array(N.response)}),p=(V,N,K)=>{var oe=new XMLHttpRequest;oe.open("GET",V,!0),oe.responseType="arraybuffer",oe.onload=()=>{if(oe.status==200||oe.status==0&&oe.response){N(oe.response);return}K()},oe.onerror=K,oe.send(null)});a.print||console.log.bind(console);var T=a.printErr||console.warn.bind(console);Object.assign(a,c),c=null,a.arguments&&a.arguments,a.thisProgram&&a.thisProgram,a.quit&&a.quit;var C;a.wasmBinary&&(C=a.wasmBinary),a.noExitRuntime,typeof WebAssembly!="object"&&fn("no native wasm support detected");var w,x=!1;function O(V,N){V||fn(N)}var M=typeof TextDecoder<"u"?new TextDecoder("utf8"):void 0;function A(V,N,K){for(var oe=N+K,ge=N;V[ge]&&!(ge>=oe);)++ge;if(ge-N>16&&V.buffer&&M)return M.decode(V.subarray(N,ge));for(var ye="";N<ge;){var Te=V[N++];if(!(Te&128)){ye+=String.fromCharCode(Te);continue}var pe=V[N++]&63;if((Te&224)==192){ye+=String.fromCharCode((Te&31)<<6|pe);continue}var we=V[N++]&63;if((Te&240)==224?Te=(Te&15)<<12|pe<<6|we:Te=(Te&7)<<18|pe<<12|we<<6|V[N++]&63,Te<65536)ye+=String.fromCharCode(Te);else{var be=Te-65536;ye+=String.fromCharCode(55296|be>>10,56320|be&1023)}}return ye}function _(V,N){return V?A(J,V,N):""}function k(V,N,K,oe){if(!(oe>0))return 0;for(var ge=K,ye=K+oe-1,Te=0;Te<V.length;++Te){var pe=V.charCodeAt(Te);if(pe>=55296&&pe<=57343){var we=V.charCodeAt(++Te);pe=65536+((pe&1023)<<10)|we&1023}if(pe<=127){if(K>=ye)break;N[K++]=pe}else if(pe<=2047){if(K+1>=ye)break;N[K++]=192|pe>>6,N[K++]=128|pe&63}else if(pe<=65535){if(K+2>=ye)break;N[K++]=224|pe>>12,N[K++]=128|pe>>6&63,N[K++]=128|pe&63}else{if(K+3>=ye)break;N[K++]=240|pe>>18,N[K++]=128|pe>>12&63,N[K++]=128|pe>>6&63,N[K++]=128|pe&63}}return N[K]=0,K-ge}function z(V,N,K){return k(V,J,N,K)}function X(V){for(var N=0,K=0;K<V.length;++K){var oe=V.charCodeAt(K);oe<=127?N++:oe<=2047?N+=2:oe>=55296&&oe<=57343?(N+=4,++K):N+=3}return N}var Z,ce,J,de,Q,q,j,ie,ue;function le(V){Z=V,a.HEAP8=ce=new Int8Array(V),a.HEAP16=de=new Int16Array(V),a.HEAP32=q=new Int32Array(V),a.HEAPU8=J=new Uint8Array(V),a.HEAPU16=Q=new Uint16Array(V),a.HEAPU32=j=new Uint32Array(V),a.HEAPF32=ie=new Float32Array(V),a.HEAPF64=ue=new Float64Array(V)}a.INITIAL_MEMORY;var Fe,kt=[],lt=[],yt=[];function dt(){if(a.preRun)for(typeof a.preRun=="function"&&(a.preRun=[a.preRun]);a.preRun.length;)Ye(a.preRun.shift());Pe(kt)}function _t(){Pe(lt)}function Ke(){if(a.postRun)for(typeof a.postRun=="function"&&(a.postRun=[a.postRun]);a.postRun.length;)jr(a.postRun.shift());Pe(yt)}function Ye(V){kt.unshift(V)}function Zt(V){lt.unshift(V)}function jr(V){yt.unshift(V)}var Cr=0,$t=null;function Pn(V){Cr++,a.monitorRunDependencies&&a.monitorRunDependencies(Cr)}function Nn(V){if(Cr--,a.monitorRunDependencies&&a.monitorRunDependencies(Cr),Cr==0&&$t){var N=$t;$t=null,N()}}function fn(V){a.onAbort&&a.onAbort(V),V="Aborted("+V+")",T(V),x=!0,V+=". Build with -sASSERTIONS for more info.";var N=new WebAssembly.RuntimeError(V);throw s(N),N}var Hr="data:application/octet-stream;base64,";function cr(V){return V.startsWith(Hr)}function U(V){return V.startsWith("file://")}var $;$="charlswasm_decode.wasm",cr($)||($=d($));function ne(V){try{if(V==$&&C)return new Uint8Array(C);if(m)return m(V);throw"both async and sync fetching of the wasm failed"}catch(N){fn(N)}}function B(){if(!C&&(l||f)){if(typeof fetch=="function"&&!U($))return fetch($,{credentials:"same-origin"}).then(function(V){if(!V.ok)throw"failed to load wasm binary file at '"+$+"'";return V.arrayBuffer()}).catch(function(){return ne($)});if(p)return new Promise(function(V,N){p($,function(K){V(new Uint8Array(K))},N)})}return Promise.resolve().then(function(){return ne($)})}function ae(){var V={a:Bo};function N(Te,pe){var we=Te.exports;a.asm=we,w=a.asm.z,le(w.buffer),Fe=a.asm.C,Zt(a.asm.A),Nn()}Pn();function K(Te){N(Te.instance)}function oe(Te){return B().then(function(pe){return WebAssembly.instantiate(pe,V)}).then(function(pe){return pe}).then(Te,function(pe){T("failed to asynchronously prepare wasm: "+pe),fn(pe)})}function ge(){return!C&&typeof WebAssembly.instantiateStreaming=="function"&&!cr($)&&!U($)&&!u&&typeof fetch=="function"?fetch($,{credentials:"same-origin"}).then(function(Te){var pe=WebAssembly.instantiateStreaming(Te,V);return pe.then(K,function(we){return T("wasm streaming compile failed: "+we),T("falling back to ArrayBuffer instantiation"),oe(K)})}):oe(K)}if(a.instantiateWasm)try{var ye=a.instantiateWasm(V,N);return ye}catch(Te){T("Module.instantiateWasm callback failed with error: "+Te),s(Te)}return ge().catch(s),{}}function xe(V){this.name="ExitStatus",this.message="Program terminated with exit("+V+")",this.status=V}function Pe(V){for(;V.length>0;)V.shift()(a)}function it(V){this.excPtr=V,this.ptr=V-24,this.set_type=function(N){j[this.ptr+4>>2]=N},this.get_type=function(){return j[this.ptr+4>>2]},this.set_destructor=function(N){j[this.ptr+8>>2]=N},this.get_destructor=function(){return j[this.ptr+8>>2]},this.set_refcount=function(N){q[this.ptr>>2]=N},this.set_caught=function(N){N=N?1:0,ce[this.ptr+12>>0]=N},this.get_caught=function(){return ce[this.ptr+12>>0]!=0},this.set_rethrown=function(N){N=N?1:0,ce[this.ptr+13>>0]=N},this.get_rethrown=function(){return ce[this.ptr+13>>0]!=0},this.init=function(N,K){this.set_adjusted_ptr(0),this.set_type(N),this.set_destructor(K),this.set_refcount(0),this.set_caught(!1),this.set_rethrown(!1)},this.add_ref=function(){var N=q[this.ptr>>2];q[this.ptr>>2]=N+1},this.release_ref=function(){var N=q[this.ptr>>2];return q[this.ptr>>2]=N-1,N===1},this.set_adjusted_ptr=function(N){j[this.ptr+16>>2]=N},this.get_adjusted_ptr=function(){return j[this.ptr+16>>2]},this.get_exception_ptr=function(){var N=Fs(this.get_type());if(N)return j[this.excPtr>>2];var K=this.get_adjusted_ptr();return K!==0?K:this.excPtr}}function Ct(V,N,K){var oe=new it(V);throw oe.init(N,K),V}var Qt={};function At(V){for(;V.length;){var N=V.pop(),K=V.pop();K(N)}}function gn(V){return this.fromWireType(q[V>>2])}var Pt={},Tt={},Jn={},lr=48,er=57;function Xi(V){if(V===void 0)return"_unknown";V=V.replace(/[^a-zA-Z0-9_]/g,"$");var N=V.charCodeAt(0);return N>=lr&&N<=er?"_"+V:V}function _o(V,N){return V=Xi(V),new Function("body","return function "+V+`() {
    "use strict";    return body.apply(this, arguments);
};
`)(N)}function Ca(V,N){var K=_o(N,function(oe){this.name=N,this.message=oe;var ge=new Error(oe).stack;ge!==void 0&&(this.stack=this.toString()+`
`+ge.replace(/^Error(:[^\n]*)?\n/,""))});return K.prototype=Object.create(V.prototype),K.prototype.constructor=K,K.prototype.toString=function(){return this.message===void 0?this.name:this.name+": "+this.message},K}var Yi=void 0;function wr(V){throw new Yi(V)}function xr(V,N,K){V.forEach(function(pe){Jn[pe]=N});function oe(pe){var we=K(pe);we.length!==V.length&&wr("Mismatched type converter count");for(var be=0;be<V.length;++be)xt(V[be],we[be])}var ge=new Array(N.length),ye=[],Te=0;N.forEach((pe,we)=>{Tt.hasOwnProperty(pe)?ge[we]=Tt[pe]:(ye.push(pe),Pt.hasOwnProperty(pe)||(Pt[pe]=[]),Pt[pe].push(()=>{ge[we]=Tt[pe],++Te,Te===ye.length&&oe(ge)}))}),ye.length===0&&oe(ge)}function Kr(V){var N=Qt[V];delete Qt[V];var K=N.rawConstructor,oe=N.rawDestructor,ge=N.fields,ye=ge.map(Te=>Te.getterReturnType).concat(ge.map(Te=>Te.setterArgumentType));xr([V],ye,Te=>{var pe={};return ge.forEach((we,be)=>{var Ue=we.fieldName,ze=Te[be],qe=we.getter,I=we.getterContext,L=Te[be+ge.length],G=we.setter,re=we.setterContext;pe[Ue]={read:fe=>ze.fromWireType(qe(I,fe)),write:(fe,Se)=>{var Ce=[];G(re,fe,L.toWireType(Ce,Se)),At(Ce)}}}),[{name:N.name,fromWireType:function(we){var be={};for(var Ue in pe)be[Ue]=pe[Ue].read(we);return oe(we),be},toWireType:function(we,be){for(var Ue in pe)if(!(Ue in be))throw new TypeError('Missing field:  "'+Ue+'"');var ze=K();for(Ue in pe)pe[Ue].write(ze,be[Ue]);return we!==null&&we.push(oe,ze),ze},argPackAdvance:8,readValueFromPointer:gn,destructorFunction:oe}]})}function zn(V,N,K,oe,ge){}function jn(V){switch(V){case 1:return 0;case 2:return 1;case 4:return 2;case 8:return 3;default:throw new TypeError("Unknown type size: "+V)}}function ja(){for(var V=new Array(256),N=0;N<256;++N)V[N]=String.fromCharCode(N);Ha=V}var Ha=void 0;function sn(V){for(var N="",K=V;J[K];)N+=Ha[J[K++]];return N}var qr=void 0;function He(V){throw new qr(V)}function xt(V,N,K={}){if(!("argPackAdvance"in N))throw new TypeError("registerType registeredInstance requires argPackAdvance");var oe=N.name;if(V||He('type "'+oe+'" must have a positive integer typeid pointer'),Tt.hasOwnProperty(V)){if(K.ignoreDuplicateRegistrations)return;He("Cannot register type '"+oe+"' twice")}if(Tt[V]=N,delete Jn[V],Pt.hasOwnProperty(V)){var ge=Pt[V];delete Pt[V],ge.forEach(ye=>ye())}}function st(V,N,K,oe,ge){var ye=jn(K);N=sn(N),xt(V,{name:N,fromWireType:function(Te){return!!Te},toWireType:function(Te,pe){return pe?oe:ge},argPackAdvance:8,readValueFromPointer:function(Te){var pe;if(K===1)pe=ce;else if(K===2)pe=de;else if(K===4)pe=q;else throw new TypeError("Unknown boolean type size: "+N);return this.fromWireType(pe[Te>>ye])},destructorFunction:null})}function Je(V){if(!(this instanceof Ti)||!(V instanceof Ti))return!1;for(var N=this.$$.ptrType.registeredClass,K=this.$$.ptr,oe=V.$$.ptrType.registeredClass,ge=V.$$.ptr;N.baseClass;)K=N.upcast(K),N=N.baseClass;for(;oe.baseClass;)ge=oe.upcast(ge),oe=oe.baseClass;return N===oe&&K===ge}function kn(V){return{count:V.count,deleteScheduled:V.deleteScheduled,preservePointerOnDelete:V.preservePointerOnDelete,ptr:V.ptr,ptrType:V.ptrType,smartPtr:V.smartPtr,smartPtrType:V.smartPtrType}}function bo(V){function N(K){return K.$$.ptrType.registeredClass.name}He(N(V)+" instance already deleted")}var Lo=!1;function Zi(V){}function wa(V){V.smartPtr?V.smartPtrType.rawDestructor(V.smartPtr):V.ptrType.registeredClass.rawDestructor(V.ptr)}function Qi(V){V.count.value-=1;var N=V.count.value===0;N&&wa(V)}function dn(V,N,K){if(N===K)return V;if(K.baseClass===void 0)return null;var oe=dn(V,N,K.baseClass);return oe===null?null:K.downcast(oe)}var vi={};function ht(){return Object.keys(Pr).length}function Sr(){var V=[];for(var N in Pr)Pr.hasOwnProperty(N)&&V.push(Pr[N]);return V}var Ji=[];function Io(){for(;Ji.length;){var V=Ji.pop();V.$$.deleteScheduled=!1,V.delete()}}var Xr=void 0;function Yr(V){Xr=V,Ji.length&&Xr&&Xr(Io)}function Zr(){a.getInheritedInstanceCount=ht,a.getLiveInheritedInstances=Sr,a.flushPendingDeletes=Io,a.setDelayFunction=Yr}var Pr={};function Pc(V,N){for(N===void 0&&He("ptr should not be undefined");V.baseClass;)N=V.upcast(N),V=V.baseClass;return N}function ea(V,N){return N=Pc(V,N),Pr[N]}function Qr(V,N){(!N.ptrType||!N.ptr)&&wr("makeClassHandle requires ptr and ptrType");var K=!!N.smartPtrType,oe=!!N.smartPtr;return K!==oe&&wr("Both smartPtrType and smartPtr must be specified"),N.count={value:1},yi(Object.create(V,{$$:{value:N}}))}function Ss(V){var N=this.getPointee(V);if(!N)return this.destructor(V),null;var K=ea(this.registeredClass,N);if(K!==void 0){if(K.$$.count.value===0)return K.$$.ptr=N,K.$$.smartPtr=V,K.clone();var oe=K.clone();return this.destructor(V),oe}function ge(){return this.isSmartPointer?Qr(this.registeredClass.instancePrototype,{ptrType:this.pointeeType,ptr:N,smartPtrType:this,smartPtr:V}):Qr(this.registeredClass.instancePrototype,{ptrType:this,ptr:V})}var ye=this.registeredClass.getActualType(N),Te=vi[ye];if(!Te)return ge.call(this);var pe;this.isConst?pe=Te.constPointerType:pe=Te.pointerType;var we=dn(N,this.registeredClass,pe.registeredClass);return we===null?ge.call(this):this.isSmartPointer?Qr(pe.registeredClass.instancePrototype,{ptrType:pe,ptr:we,smartPtrType:this,smartPtr:V}):Qr(pe.registeredClass.instancePrototype,{ptrType:pe,ptr:we})}function yi(V){return typeof FinalizationRegistry>"u"?(yi=N=>N,V):(Lo=new FinalizationRegistry(N=>{Qi(N.$$)}),yi=N=>{var K=N.$$,oe=!!K.smartPtr;if(oe){var ge={$$:K};Lo.register(N,ge,N)}return N},Zi=N=>Lo.unregister(N),yi(V))}function Ka(){if(this.$$.ptr||bo(this),this.$$.preservePointerOnDelete)return this.$$.count.value+=1,this;var V=yi(Object.create(Object.getPrototypeOf(this),{$$:{value:kn(this.$$)}}));return V.$$.count.value+=1,V.$$.deleteScheduled=!1,V}function Jr(){this.$$.ptr||bo(this),this.$$.deleteScheduled&&!this.$$.preservePointerOnDelete&&He("Object already scheduled for deletion"),Zi(this),Qi(this.$$),this.$$.preservePointerOnDelete||(this.$$.smartPtr=void 0,this.$$.ptr=void 0)}function Pi(){return!this.$$.ptr}function xa(){return this.$$.ptr||bo(this),this.$$.deleteScheduled&&!this.$$.preservePointerOnDelete&&He("Object already scheduled for deletion"),Ji.push(this),Ji.length===1&&Xr&&Xr(Io),this.$$.deleteScheduled=!0,this}function Nc(){Ti.prototype.isAliasOf=Je,Ti.prototype.clone=Ka,Ti.prototype.delete=Jr,Ti.prototype.isDeleted=Pi,Ti.prototype.deleteLater=xa}function Ti(){}function ta(V,N,K){if(V[N].overloadTable===void 0){var oe=V[N];V[N]=function(){return V[N].overloadTable.hasOwnProperty(arguments.length)||He("Function '"+K+"' called with an invalid number of arguments ("+arguments.length+") - expects one of ("+V[N].overloadTable+")!"),V[N].overloadTable[arguments.length].apply(this,arguments)},V[N].overloadTable=[],V[N].overloadTable[oe.argCount]=oe}}function ei(V,N,K){a.hasOwnProperty(V)?((K===void 0||a[V].overloadTable!==void 0&&a[V].overloadTable[K]!==void 0)&&He("Cannot register public name '"+V+"' twice"),ta(a,V,V),a.hasOwnProperty(K)&&He("Cannot register multiple overloads of a function with the same number of arguments ("+K+")!"),a[V].overloadTable[K]=N):(a[V]=N,K!==void 0&&(a[V].numArguments=K))}function ti(V,N,K,oe,ge,ye,Te,pe){this.name=V,this.constructor=N,this.instancePrototype=K,this.rawDestructor=oe,this.baseClass=ge,this.getActualType=ye,this.upcast=Te,this.downcast=pe,this.pureVirtualFunctions=[]}function Ni(V,N,K){for(;N!==K;)N.upcast||He("Expected null or instance of "+K.name+", got an instance of "+N.name),V=N.upcast(V),N=N.baseClass;return V}function kc(V,N){if(N===null)return this.isReference&&He("null is not a valid "+this.name),0;N.$$||He('Cannot pass "'+kr(N)+'" as a '+this.name),N.$$.ptr||He("Cannot pass deleted object as a pointer of type "+this.name);var K=N.$$.ptrType.registeredClass,oe=Ni(N.$$.ptr,K,this.registeredClass);return oe}function ki(V,N){var K;if(N===null)return this.isReference&&He("null is not a valid "+this.name),this.isSmartPointer?(K=this.rawConstructor(),V!==null&&V.push(this.rawDestructor,K),K):0;N.$$||He('Cannot pass "'+kr(N)+'" as a '+this.name),N.$$.ptr||He("Cannot pass deleted object as a pointer of type "+this.name),!this.isConst&&N.$$.ptrType.isConst&&He("Cannot convert argument of type "+(N.$$.smartPtrType?N.$$.smartPtrType.name:N.$$.ptrType.name)+" to parameter type "+this.name);var oe=N.$$.ptrType.registeredClass;if(K=Ni(N.$$.ptr,oe,this.registeredClass),this.isSmartPointer)switch(N.$$.smartPtr===void 0&&He("Passing raw pointer to smart pointer is illegal"),this.sharingPolicy){case 0:N.$$.smartPtrType===this?K=N.$$.smartPtr:He("Cannot convert argument of type "+(N.$$.smartPtrType?N.$$.smartPtrType.name:N.$$.ptrType.name)+" to parameter type "+this.name);break;case 1:K=N.$$.smartPtr;break;case 2:if(N.$$.smartPtrType===this)K=N.$$.smartPtr;else{var ge=N.clone();K=this.rawShare(K,Ci.toHandle(function(){ge.delete()})),V!==null&&V.push(this.rawDestructor,K)}break;default:He("Unsupporting sharing policy")}return K}function Vo(V,N){if(N===null)return this.isReference&&He("null is not a valid "+this.name),0;N.$$||He('Cannot pass "'+kr(N)+'" as a '+this.name),N.$$.ptr||He("Cannot pass deleted object as a pointer of type "+this.name),N.$$.ptrType.isConst&&He("Cannot convert argument of type "+N.$$.ptrType.name+" to parameter type "+this.name);var K=N.$$.ptrType.registeredClass,oe=Ni(N.$$.ptr,K,this.registeredClass);return oe}function Ac(V){return this.rawGetPointee&&(V=this.rawGetPointee(V)),V}function Fc(V){this.rawDestructor&&this.rawDestructor(V)}function Uc(V){V!==null&&V.delete()}function Bc(){Sn.prototype.getPointee=Ac,Sn.prototype.destructor=Fc,Sn.prototype.argPackAdvance=8,Sn.prototype.readValueFromPointer=gn,Sn.prototype.deleteObject=Uc,Sn.prototype.fromWireType=Ss}function Sn(V,N,K,oe,ge,ye,Te,pe,we,be,Ue){this.name=V,this.registeredClass=N,this.isReference=K,this.isConst=oe,this.isSmartPointer=ge,this.pointeeType=ye,this.sharingPolicy=Te,this.rawGetPointee=pe,this.rawConstructor=we,this.rawShare=be,this.rawDestructor=Ue,!ge&&N.baseClass===void 0?oe?(this.toWireType=kc,this.destructorFunction=null):(this.toWireType=Vo,this.destructorFunction=null):this.toWireType=ki}function Po(V,N,K){a.hasOwnProperty(V)||wr("Replacing nonexistant public symbol"),a[V].overloadTable!==void 0&&K!==void 0?a[V].overloadTable[K]=N:(a[V]=N,a[V].argCount=K)}function Nr(V,N,K){var oe=a["dynCall_"+V];return K&&K.length?oe.apply(null,[N].concat(K)):oe.call(null,N)}var ur=[];function qa(V){var N=ur[V];return N||(V>=ur.length&&(ur.length=V+1),ur[V]=N=Fe.get(V)),N}function Xa(V,N,K){if(V.includes("j"))return Nr(V,N,K);var oe=qa(N).apply(null,K);return oe}function Sa(V,N){var K=[];return function(){return K.length=0,Object.assign(K,arguments),Xa(V,N,K)}}function pn(V,N){V=sn(V);function K(){return V.includes("j")?Sa(V,N):qa(N)}var oe=K();return typeof oe!="function"&&He("unknown function pointer with signature "+V+": "+N),oe}var Es=void 0;function Er(V){var N=na(V),K=sn(N);return ni(N),K}function Hn(V,N){var K=[],oe={};function ge(ye){if(!oe[ye]&&!Tt[ye]){if(Jn[ye]){Jn[ye].forEach(ge);return}K.push(ye),oe[ye]=!0}}throw N.forEach(ge),new Es(V+": "+K.map(Er).join([", "]))}function No(V,N,K,oe,ge,ye,Te,pe,we,be,Ue,ze,qe){Ue=sn(Ue),ye=pn(ge,ye),pe&&(pe=pn(Te,pe)),be&&(be=pn(we,be)),qe=pn(ze,qe);var I=Xi(Ue);ei(I,function(){Hn("Cannot construct "+Ue+" due to unbound types",[oe])}),xr([V,N,K],oe?[oe]:[],function(L){L=L[0];var G,re;oe?(G=L.registeredClass,re=G.instancePrototype):re=Ti.prototype;var fe=_o(I,function(){if(Object.getPrototypeOf(this)!==Se)throw new qr("Use 'new' to construct "+Ue);if(Ce.constructor_body===void 0)throw new qr(Ue+" has no accessible constructor");var S=Ce.constructor_body[arguments.length];if(S===void 0)throw new qr("Tried to invoke ctor of "+Ue+" with invalid number of parameters ("+arguments.length+") - expected ("+Object.keys(Ce.constructor_body).toString()+") parameters instead!");return S.apply(this,arguments)}),Se=Object.create(re,{constructor:{value:fe}});fe.prototype=Se;var Ce=new ti(Ue,fe,Se,qe,G,ye,pe,be),me=new Sn(Ue,Ce,!0,!1,!1),D=new Sn(Ue+"*",Ce,!1,!1,!1),R=new Sn(Ue+" const*",Ce,!1,!0,!1);return vi[V]={pointerType:D,constPointerType:R},Po(I,fe),[me,D,R]})}function Kn(V,N){for(var K=[],oe=0;oe<V;oe++)K.push(j[N+oe*4>>2]);return K}function Ya(V,N){if(!(V instanceof Function))throw new TypeError("new_ called with constructor type "+typeof V+" which is not a function");var K=_o(V.name||"unknownFunctionName",function(){});K.prototype=V.prototype;var oe=new K,ge=V.apply(oe,N);return ge instanceof Object?ge:oe}function Za(V,N,K,oe,ge){var ye=N.length;ye<2&&He("argTypes array size mismatch! Must at least get return value and 'this' types!");for(var Te=N[1]!==null&&K!==null,pe=!1,we=1;we<N.length;++we)if(N[we]!==null&&N[we].destructorFunction===void 0){pe=!0;break}for(var be=N[0].name!=="void",Ue="",ze="",we=0;we<ye-2;++we)Ue+=(we!==0?", ":"")+"arg"+we,ze+=(we!==0?", ":"")+"arg"+we+"Wired";var qe="return function "+Xi(V)+"("+Ue+`) {
if (arguments.length !== `+(ye-2)+`) {
throwBindingError('function `+V+" called with ' + arguments.length + ' arguments, expected "+(ye-2)+` args!');
}
`;pe&&(qe+=`var destructors = [];
`);var I=pe?"destructors":"null",L=["throwBindingError","invoker","fn","runDestructors","retType","classParam"],G=[He,oe,ge,At,N[0],N[1]];Te&&(qe+="var thisWired = classParam.toWireType("+I+`, this);
`);for(var we=0;we<ye-2;++we)qe+="var arg"+we+"Wired = argType"+we+".toWireType("+I+", arg"+we+"); // "+N[we+2].name+`
`,L.push("argType"+we),G.push(N[we+2]);if(Te&&(ze="thisWired"+(ze.length>0?", ":"")+ze),qe+=(be?"var rv = ":"")+"invoker(fn"+(ze.length>0?", ":"")+ze+`);
`,pe)qe+=`runDestructors(destructors);
`;else for(var we=Te?1:2;we<N.length;++we){var re=we===1?"thisWired":"arg"+(we-2)+"Wired";N[we].destructorFunction!==null&&(qe+=re+"_dtor("+re+"); // "+N[we].name+`
`,L.push(re+"_dtor"),G.push(N[we].destructorFunction))}be&&(qe+=`var ret = retType.fromWireType(rv);
return ret;
`),qe+=`}
`,L.push(qe);var fe=Ya(Function,L).apply(null,G);return fe}function Os(V,N,K,oe,ge,ye){O(N>0);var Te=Kn(N,K);ge=pn(oe,ge),xr([],[V],function(pe){pe=pe[0];var we="constructor "+pe.name;if(pe.registeredClass.constructor_body===void 0&&(pe.registeredClass.constructor_body=[]),pe.registeredClass.constructor_body[N-1]!==void 0)throw new qr("Cannot register multiple constructors with identical number of parameters ("+(N-1)+") for class '"+pe.name+"'! Overload resolution is currently only performed using the parameter count, not actual type info!");return pe.registeredClass.constructor_body[N-1]=()=>{Hn("Cannot construct "+pe.name+" due to unbound types",Te)},xr([],Te,function(be){return be.splice(1,0,null),pe.registeredClass.constructor_body[N-1]=Za(we,be,null,ge,ye),[]}),[]})}function Ds(V,N,K,oe,ge,ye,Te,pe){var we=Kn(K,oe);N=sn(N),ye=pn(ge,ye),xr([],[V],function(be){be=be[0];var Ue=be.name+"."+N;N.startsWith("@@")&&(N=Symbol[N.substring(2)]),pe&&be.registeredClass.pureVirtualFunctions.push(N);function ze(){Hn("Cannot call "+Ue+" due to unbound types",we)}var qe=be.registeredClass.instancePrototype,I=qe[N];return I===void 0||I.overloadTable===void 0&&I.className!==be.name&&I.argCount===K-2?(ze.argCount=K-2,ze.className=be.name,qe[N]=ze):(ta(qe,N,Ue),qe[N].overloadTable[K-2]=ze),xr([],we,function(L){var G=Za(Ue,L,be,ye,Te);return qe[N].overloadTable===void 0?(G.argCount=K-2,qe[N]=G):qe[N].overloadTable[K-2]=G,[]}),[]})}var qn=[],fr=[{},{value:void 0},{value:null},{value:!0},{value:!1}];function Ea(V){V>4&&--fr[V].refcount===0&&(fr[V]=void 0,qn.push(V))}function En(){for(var V=0,N=5;N<fr.length;++N)fr[N]!==void 0&&++V;return V}function gr(){for(var V=5;V<fr.length;++V)if(fr[V]!==void 0)return fr[V];return null}function Qa(){a.count_emval_handles=En,a.get_first_emval=gr}var Ci={toValue:V=>(V||He("Cannot use deleted val. handle = "+V),fr[V].value),toHandle:V=>{switch(V){case void 0:return 1;case null:return 2;case!0:return 3;case!1:return 4;default:{var N=qn.length?qn.pop():fr.length;return fr[N]={refcount:1,value:V},N}}}};function ko(V,N){N=sn(N),xt(V,{name:N,fromWireType:function(K){var oe=Ci.toValue(K);return Ea(K),oe},toWireType:function(K,oe){return Ci.toHandle(oe)},argPackAdvance:8,readValueFromPointer:gn,destructorFunction:null})}function kr(V){if(V===null)return"null";var N=typeof V;return N==="object"||N==="array"||N==="function"?V.toString():""+V}function wi(V,N){switch(N){case 2:return function(K){return this.fromWireType(ie[K>>2])};case 3:return function(K){return this.fromWireType(ue[K>>3])};default:throw new TypeError("Unknown float type: "+V)}}function Oa(V,N,K){var oe=jn(K);N=sn(N),xt(V,{name:N,fromWireType:function(ge){return ge},toWireType:function(ge,ye){return ye},argPackAdvance:8,readValueFromPointer:wi(N,oe),destructorFunction:null})}function tr(V,N,K,oe,ge,ye){var Te=Kn(N,K);V=sn(V),ge=pn(oe,ge),ei(V,function(){Hn("Cannot call "+V+" due to unbound types",Te)},N-1),xr([],Te,function(pe){var we=[pe[0],null].concat(pe.slice(1));return Po(V,Za(V,we,null,ge,ye),N-1),[]})}function Rs(V,N,K){switch(N){case 0:return K?function(ge){return ce[ge]}:function(ge){return J[ge]};case 1:return K?function(ge){return de[ge>>1]}:function(ge){return Q[ge>>1]};case 2:return K?function(ge){return q[ge>>2]}:function(ge){return j[ge>>2]};default:throw new TypeError("Unknown integer type: "+V)}}function Gc(V,N,K,oe,ge){N=sn(N);var ye=jn(K),Te=ze=>ze;if(oe===0){var pe=32-8*K;Te=ze=>ze<<pe>>>pe}var we=N.includes("unsigned"),be=(ze,qe)=>{},Ue;we?Ue=function(ze,qe){return be(qe,this.name),qe>>>0}:Ue=function(ze,qe){return be(qe,this.name),qe},xt(V,{name:N,fromWireType:Te,toWireType:Ue,argPackAdvance:8,readValueFromPointer:Rs(N,ye,oe!==0),destructorFunction:null})}function $c(V,N,K){var oe=[Int8Array,Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array],ge=oe[N];function ye(Te){Te=Te>>2;var pe=j,we=pe[Te],be=pe[Te+1];return new ge(Z,be,we)}K=sn(K),xt(V,{name:K,fromWireType:ye,argPackAdvance:8,readValueFromPointer:ye},{ignoreDuplicateRegistrations:!0})}function Wc(V,N){N=sn(N);var K=N==="std::string";xt(V,{name:N,fromWireType:function(oe){var ge=j[oe>>2],ye=oe+4,Te;if(K)for(var pe=ye,we=0;we<=ge;++we){var be=ye+we;if(we==ge||J[be]==0){var Ue=be-pe,ze=_(pe,Ue);Te===void 0?Te=ze:(Te+="\0",Te+=ze),pe=be+1}}else{for(var qe=new Array(ge),we=0;we<ge;++we)qe[we]=String.fromCharCode(J[ye+we]);Te=qe.join("")}return ni(oe),Te},toWireType:function(oe,ge){ge instanceof ArrayBuffer&&(ge=new Uint8Array(ge));var ye,Te=typeof ge=="string";Te||ge instanceof Uint8Array||ge instanceof Uint8ClampedArray||ge instanceof Int8Array||He("Cannot pass non-string to std::string"),K&&Te?ye=X(ge):ye=ge.length;var pe=Ai(4+ye+1),we=pe+4;if(j[pe>>2]=ye,K&&Te)z(ge,we,ye+1);else if(Te)for(var be=0;be<ye;++be){var Ue=ge.charCodeAt(be);Ue>255&&(ni(we),He("String has UTF-16 code units that do not fit in 8 bits")),J[we+be]=Ue}else for(var be=0;be<ye;++be)J[we+be]=ge[be];return oe!==null&&oe.push(ni,pe),pe},argPackAdvance:8,readValueFromPointer:gn,destructorFunction:function(oe){ni(oe)}})}var Da=typeof TextDecoder<"u"?new TextDecoder("utf-16le"):void 0;function Ms(V,N){for(var K=V,oe=K>>1,ge=oe+N/2;!(oe>=ge)&&Q[oe];)++oe;if(K=oe<<1,K-V>32&&Da)return Da.decode(J.subarray(V,K));for(var ye="",Te=0;!(Te>=N/2);++Te){var pe=de[V+Te*2>>1];if(pe==0)break;ye+=String.fromCharCode(pe)}return ye}function Ja(V,N,K){if(K===void 0&&(K=2147483647),K<2)return 0;K-=2;for(var oe=N,ge=K<V.length*2?K/2:V.length,ye=0;ye<ge;++ye){var Te=V.charCodeAt(ye);de[N>>1]=Te,N+=2}return de[N>>1]=0,N-oe}function zc(V){return V.length*2}function jc(V,N){for(var K=0,oe="";!(K>=N/4);){var ge=q[V+K*4>>2];if(ge==0)break;if(++K,ge>=65536){var ye=ge-65536;oe+=String.fromCharCode(55296|ye>>10,56320|ye&1023)}else oe+=String.fromCharCode(ge)}return oe}function Hc(V,N,K){if(K===void 0&&(K=2147483647),K<4)return 0;for(var oe=N,ge=oe+K-4,ye=0;ye<V.length;++ye){var Te=V.charCodeAt(ye);if(Te>=55296&&Te<=57343){var pe=V.charCodeAt(++ye);Te=65536+((Te&1023)<<10)|pe&1023}if(q[N>>2]=Te,N+=4,N+4>ge)break}return q[N>>2]=0,N-oe}function Kc(V){for(var N=0,K=0;K<V.length;++K){var oe=V.charCodeAt(K);oe>=55296&&oe<=57343&&++K,N+=4}return N}function qc(V,N,K){K=sn(K);var oe,ge,ye,Te,pe;N===2?(oe=Ms,ge=Ja,Te=zc,ye=()=>Q,pe=1):N===4&&(oe=jc,ge=Hc,Te=Kc,ye=()=>j,pe=2),xt(V,{name:K,fromWireType:function(we){for(var be=j[we>>2],Ue=ye(),ze,qe=we+4,I=0;I<=be;++I){var L=we+4+I*N;if(I==be||Ue[L>>pe]==0){var G=L-qe,re=oe(qe,G);ze===void 0?ze=re:(ze+="\0",ze+=re),qe=L+N}}return ni(we),ze},toWireType:function(we,be){typeof be!="string"&&He("Cannot pass non-string to C++ string type "+K);var Ue=Te(be),ze=Ai(4+Ue+N);return j[ze>>2]=Ue>>pe,ge(be,ze+4,Ue+N),we!==null&&we.push(ni,ze),ze},argPackAdvance:8,readValueFromPointer:gn,destructorFunction:function(we){ni(we)}})}function Xc(V,N,K,oe,ge,ye){Qt[V]={name:sn(N),rawConstructor:pn(K,oe),rawDestructor:pn(ge,ye),fields:[]}}function Yc(V,N,K,oe,ge,ye,Te,pe,we,be){Qt[V].fields.push({fieldName:sn(N),getterReturnType:K,getter:pn(oe,ge),getterContext:ye,setterArgumentType:Te,setter:pn(pe,we),setterContext:be})}function _s(V,N){N=sn(N),xt(V,{isVoid:!0,name:N,argPackAdvance:0,fromWireType:function(){},toWireType:function(K,oe){}})}var Zc={};function Qc(V){var N=Zc[V];return N===void 0?sn(V):N}function bs(){return typeof globalThis=="object"?globalThis:function(){return Function}()("return this")()}function Ls(V){return V===0?Ci.toHandle(bs()):(V=Qc(V),Ci.toHandle(bs()[V]))}function Jc(V){V>4&&(fr[V].refcount+=1)}function Ao(V,N){var K=Tt[V];return K===void 0&&He(N+" has unknown type "+Er(V)),K}function Is(V){for(var N="",K=0;K<V;++K)N+=(K!==0?", ":"")+"arg"+K;for(var oe=()=>j,ge="return function emval_allocator_"+V+`(constructor, argTypes, args) {
  var HEAPU32 = getMemory();
`,K=0;K<V;++K)ge+="var argType"+K+" = requireRegisteredType(HEAPU32[((argTypes)>>2)], 'parameter "+K+`');
var arg`+K+" = argType"+K+`.readValueFromPointer(args);
args += argType`+K+`['argPackAdvance'];
argTypes += 4;
`;return ge+="var obj = new constructor("+N+`);
return valueToHandle(obj);
}
`,new Function("requireRegisteredType","Module","valueToHandle","getMemory",ge)(Ao,a,Ci.toHandle,oe)}var Vs={};function Fo(V,N,K,oe){V=Ci.toValue(V);var ge=Vs[N];return ge||(ge=Is(N),Vs[N]=ge),ge(V,K,oe)}function e0(V,N){V=Ao(V,"_emval_take_value");var K=V.readValueFromPointer(N);return Ci.toHandle(K)}function Ps(){fn("")}function t0(V,N,K){J.copyWithin(V,N,N+K)}function Ns(){return 2147483648}function n0(V){try{return w.grow(V-Z.byteLength+65535>>>16),le(w.buffer),1}catch{}}function r0(V){var N=J.length;V=V>>>0;var K=Ns();if(V>K)return!1;let oe=(we,be)=>we+(be-we%be)%be;for(var ge=1;ge<=4;ge*=2){var ye=N*(1+.2/ge);ye=Math.min(ye,V+100663296);var Te=Math.min(K,oe(Math.max(V,ye),65536)),pe=n0(Te);if(pe)return!0}return!1}function i0(V){var N=a["_"+V];return N}function a0(V,N){ce.set(V,N)}function Uo(V,N,K,oe,ge){var ye={string:L=>{var G=0;if(L!=null&&L!==0){var re=(L.length<<2)+1;G=Go(re),z(L,G,re)}return G},array:L=>{var G=Go(L.length);return a0(L,G),G}};function Te(L){return N==="string"?_(L):N==="boolean"?!!L:L}var pe=i0(V),we=[],be=0;if(oe)for(var Ue=0;Ue<oe.length;Ue++){var ze=ye[K[Ue]];ze?(be===0&&(be=ks()),we[Ue]=ze(oe[Ue])):we[Ue]=oe[Ue]}var qe=pe.apply(null,we);function I(L){return be!==0&&As(be),Te(L)}return qe=I(qe),qe}Yi=a.InternalError=Ca(Error,"InternalError"),ja(),qr=a.BindingError=Ca(Error,"BindingError"),Nc(),Zr(),Bc(),Es=a.UnboundTypeError=Ca(Error,"UnboundTypeError"),Qa();var Bo={h:Ct,q:Kr,r:zn,w:st,p:No,o:Os,c:Ds,v:ko,k:Oa,e:tr,b:Gc,a:$c,j:Wc,g:qc,u:Xc,d:Yc,x:_s,i:Ea,m:Ls,l:Jc,y:Fo,n:e0,f:Ps,t:t0,s:r0};ae(),a.___wasm_call_ctors=function(){return(a.___wasm_call_ctors=a.asm.A).apply(null,arguments)};var Ai=a._malloc=function(){return(Ai=a._malloc=a.asm.B).apply(null,arguments)},na=a.___getTypeName=function(){return(na=a.___getTypeName=a.asm.D).apply(null,arguments)};a.__embind_initialize_bindings=function(){return(a.__embind_initialize_bindings=a.asm.E).apply(null,arguments)};var ni=a._free=function(){return(ni=a._free=a.asm.F).apply(null,arguments)},ks=a.stackSave=function(){return(ks=a.stackSave=a.asm.G).apply(null,arguments)},As=a.stackRestore=function(){return(As=a.stackRestore=a.asm.H).apply(null,arguments)},Go=a.stackAlloc=function(){return(Go=a.stackAlloc=a.asm.I).apply(null,arguments)},Fs=a.___cxa_is_pointer_type=function(){return(Fs=a.___cxa_is_pointer_type=a.asm.J).apply(null,arguments)};a.ccall=Uo;var eo;$t=function V(){eo||Us(),eo||($t=V)};function Us(V){if(Cr>0||(dt(),Cr>0))return;function N(){eo||(eo=!0,a.calledRun=!0,!x&&(_t(),o(a),a.onRuntimeInitialized&&a.onRuntimeInitialized(),Ke()))}a.setStatus?(a.setStatus("Running..."),setTimeout(function(){setTimeout(function(){a.setStatus("")},1),N()},1)):N()}if(a.preInit)for(typeof a.preInit=="function"&&(a.preInit=[a.preInit]);a.preInit.length>0;)a.preInit.pop()();return Us(),i.ready}})();t.exports=n})(r_);var Fne=r_.exports;const Une=Eo(Fne),Bne=new URL("/dicom-viewer/assets/charlswasm_decode-484ovEoR.wasm",import.meta.url),Hl={codec:void 0,decoder:void 0,decodeConfig:{}};function Gne(t){return typeof t=="number"?Hl.codec.getExceptionMessage(t):t}function $ne(t){if(Hl.decodeConfig=t,Hl.codec)return Promise.resolve();const e=Une({locateFile:n=>n.endsWith(".wasm")?Bne.toString():n});return new Promise((n,r)=>{e.then(i=>{Hl.codec=i,Hl.decoder=new i.JpegLSDecoder,n()},r)})}async function yT(t,e){try{await $ne();const n=Hl.decoder;n.getEncodedBuffer(t.length).set(t),n.decode();const i=n.getFrameInfo(),a=n.getInterleaveMode(),o=n.getNearLossless(),s=n.getDecodedBuffer(),c={columns:i.width,rows:i.height,bitsPerPixel:i.bitsPerSample,signed:e.signed,bytesPerPixel:e.bytesPerPixel,componentsPerPixel:i.componentCount},l=Wne(i,s,e.signed),f={nearLossless:o,interleaveMode:a,frameInfo:i};return{...e,pixelData:l,imageInfo:c,encodeOptions:f,...f,...c}}catch(n){throw Gne(n)}}function Wne(t,e,n){return t.bitsPerSample>8?n?new Int16Array(e.buffer,e.byteOffset,e.byteLength/2):new Uint16Array(e.buffer,e.byteOffset,e.byteLength/2):n?new Int8Array(e.buffer,e.byteOffset,e.byteLength):new Uint8Array(e.buffer,e.byteOffset,e.byteLength)}var i_={exports:{}};(function(t,e){var n=(()=>{var r=typeof document<"u"&&document.currentScript?document.currentScript.src:void 0;return typeof __filename<"u"&&(r=r||__filename),function(i){i=i||{};var a=typeof i<"u"?i:{},o,s;a.ready=new Promise(function(I,L){o=I,s=L});var c=Object.assign({},a),l="./this.program",f=typeof window=="object",u=typeof importScripts=="function",g=typeof process=="object"&&typeof process.versions=="object"&&typeof process.versions.node=="string",d="";function h(I){return a.locateFile?a.locateFile(I,d):d+I}var p,m,v;if(g){var y=vo,T=vo;u?d=T.dirname(d)+"/":d=__dirname+"/",p=(I,L)=>(I=ne(I)?new URL(I):T.normalize(I),y.readFileSync(I,L?void 0:"utf8")),v=I=>{var L=p(I,!0);return L.buffer||(L=new Uint8Array(L)),L},m=(I,L,G)=>{I=ne(I)?new URL(I):T.normalize(I),y.readFile(I,function(re,fe){re?G(re):L(fe.buffer)})},process.argv.length>1&&(l=process.argv[1].replace(/\\/g,"/")),process.argv.slice(2),process.on("uncaughtException",function(I){if(!(I instanceof it))throw I}),process.on("unhandledRejection",function(I){throw I}),a.inspect=function(){return"[Emscripten Module object]"}}else(f||u)&&(u?d=self.location.href:typeof document<"u"&&document.currentScript&&(d=document.currentScript.src),r&&(d=r),d.indexOf("blob:")!==0?d=d.substr(0,d.replace(/[?#].*/,"").lastIndexOf("/")+1):d="",p=I=>{var L=new XMLHttpRequest;return L.open("GET",I,!1),L.send(null),L.responseText},u&&(v=I=>{var L=new XMLHttpRequest;return L.open("GET",I,!1),L.responseType="arraybuffer",L.send(null),new Uint8Array(L.response)}),m=(I,L,G)=>{var re=new XMLHttpRequest;re.open("GET",I,!0),re.responseType="arraybuffer",re.onload=()=>{if(re.status==200||re.status==0&&re.response){L(re.response);return}G()},re.onerror=G,re.send(null)});var C=a.print||console.log.bind(console),w=a.printErr||console.warn.bind(console);Object.assign(a,c),c=null,a.arguments&&a.arguments,a.thisProgram&&(l=a.thisProgram),a.quit&&a.quit;var x;a.wasmBinary&&(x=a.wasmBinary),a.noExitRuntime,typeof WebAssembly!="object"&&cr("no native wasm support detected");var O,M=!1;function A(I,L){I||cr(L)}var _=typeof TextDecoder<"u"?new TextDecoder("utf8"):void 0;function k(I,L,G){for(var re=L+G,fe=L;I[fe]&&!(fe>=re);)++fe;if(fe-L>16&&I.buffer&&_)return _.decode(I.subarray(L,fe));for(var Se="";L<fe;){var Ce=I[L++];if(!(Ce&128)){Se+=String.fromCharCode(Ce);continue}var me=I[L++]&63;if((Ce&224)==192){Se+=String.fromCharCode((Ce&31)<<6|me);continue}var D=I[L++]&63;if((Ce&240)==224?Ce=(Ce&15)<<12|me<<6|D:Ce=(Ce&7)<<18|me<<12|D<<6|I[L++]&63,Ce<65536)Se+=String.fromCharCode(Ce);else{var R=Ce-65536;Se+=String.fromCharCode(55296|R>>10,56320|R&1023)}}return Se}function z(I,L){return I?k(Q,I,L):""}function X(I,L,G,re){if(!(re>0))return 0;for(var fe=G,Se=G+re-1,Ce=0;Ce<I.length;++Ce){var me=I.charCodeAt(Ce);if(me>=55296&&me<=57343){var D=I.charCodeAt(++Ce);me=65536+((me&1023)<<10)|D&1023}if(me<=127){if(G>=Se)break;L[G++]=me}else if(me<=2047){if(G+1>=Se)break;L[G++]=192|me>>6,L[G++]=128|me&63}else if(me<=65535){if(G+2>=Se)break;L[G++]=224|me>>12,L[G++]=128|me>>6&63,L[G++]=128|me&63}else{if(G+3>=Se)break;L[G++]=240|me>>18,L[G++]=128|me>>12&63,L[G++]=128|me>>6&63,L[G++]=128|me&63}}return L[G]=0,G-fe}function Z(I,L,G){return X(I,Q,L,G)}function ce(I){for(var L=0,G=0;G<I.length;++G){var re=I.charCodeAt(G);re<=127?L++:re<=2047?L+=2:re>=55296&&re<=57343?(L+=4,++G):L+=3}return L}var J,de,Q,q,j,ie,ue,le,Fe;function kt(I){J=I,a.HEAP8=de=new Int8Array(I),a.HEAP16=q=new Int16Array(I),a.HEAP32=ie=new Int32Array(I),a.HEAPU8=Q=new Uint8Array(I),a.HEAPU16=j=new Uint16Array(I),a.HEAPU32=ue=new Uint32Array(I),a.HEAPF32=le=new Float32Array(I),a.HEAPF64=Fe=new Float64Array(I)}a.INITIAL_MEMORY;var lt,yt=[],dt=[],_t=[];function Ke(){if(a.preRun)for(typeof a.preRun=="function"&&(a.preRun=[a.preRun]);a.preRun.length;)jr(a.preRun.shift());Ct(yt)}function Ye(){Ct(dt)}function Zt(){if(a.postRun)for(typeof a.postRun=="function"&&(a.postRun=[a.postRun]);a.postRun.length;)$t(a.postRun.shift());Ct(_t)}function jr(I){yt.unshift(I)}function Cr(I){dt.unshift(I)}function $t(I){_t.unshift(I)}var Pn=0,Nn=null;function fn(I){Pn++,a.monitorRunDependencies&&a.monitorRunDependencies(Pn)}function Hr(I){if(Pn--,a.monitorRunDependencies&&a.monitorRunDependencies(Pn),Pn==0&&Nn){var L=Nn;Nn=null,L()}}function cr(I){a.onAbort&&a.onAbort(I),I="Aborted("+I+")",w(I),M=!0,I+=". Build with -sASSERTIONS for more info.";var L=new WebAssembly.RuntimeError(I);throw s(L),L}var U="data:application/octet-stream;base64,";function $(I){return I.startsWith(U)}function ne(I){return I.startsWith("file://")}var B;B="openjpegwasm_decode.wasm",$(B)||(B=h(B));function ae(I){try{if(I==B&&x)return new Uint8Array(x);if(v)return v(I);throw"both async and sync fetching of the wasm failed"}catch(L){cr(L)}}function xe(){if(!x&&(f||u)){if(typeof fetch=="function"&&!ne(B))return fetch(B,{credentials:"same-origin"}).then(function(I){if(!I.ok)throw"failed to load wasm binary file at '"+B+"'";return I.arrayBuffer()}).catch(function(){return ae(B)});if(m)return new Promise(function(I,L){m(B,function(G){I(new Uint8Array(G))},L)})}return Promise.resolve().then(function(){return ae(B)})}function Pe(){var I={a:oe};function L(Ce,me){var D=Ce.exports;a.asm=D,O=a.asm.E,kt(O.buffer),lt=a.asm.G,Cr(a.asm.F),Hr()}fn();function G(Ce){L(Ce.instance)}function re(Ce){return xe().then(function(me){return WebAssembly.instantiate(me,I)}).then(function(me){return me}).then(Ce,function(me){w("failed to asynchronously prepare wasm: "+me),cr(me)})}function fe(){return!x&&typeof WebAssembly.instantiateStreaming=="function"&&!$(B)&&!ne(B)&&!g&&typeof fetch=="function"?fetch(B,{credentials:"same-origin"}).then(function(Ce){var me=WebAssembly.instantiateStreaming(Ce,I);return me.then(G,function(D){return w("wasm streaming compile failed: "+D),w("falling back to ArrayBuffer instantiation"),re(G)})}):re(G)}if(a.instantiateWasm)try{var Se=a.instantiateWasm(I,L);return Se}catch(Ce){w("Module.instantiateWasm callback failed with error: "+Ce),s(Ce)}return fe().catch(s),{}}function it(I){this.name="ExitStatus",this.message="Program terminated with exit("+I+")",this.status=I}function Ct(I){for(;I.length>0;)I.shift()(a)}function Qt(I){this.excPtr=I,this.ptr=I-24,this.set_type=function(L){ue[this.ptr+4>>2]=L},this.get_type=function(){return ue[this.ptr+4>>2]},this.set_destructor=function(L){ue[this.ptr+8>>2]=L},this.get_destructor=function(){return ue[this.ptr+8>>2]},this.set_refcount=function(L){ie[this.ptr>>2]=L},this.set_caught=function(L){L=L?1:0,de[this.ptr+12>>0]=L},this.get_caught=function(){return de[this.ptr+12>>0]!=0},this.set_rethrown=function(L){L=L?1:0,de[this.ptr+13>>0]=L},this.get_rethrown=function(){return de[this.ptr+13>>0]!=0},this.init=function(L,G){this.set_adjusted_ptr(0),this.set_type(L),this.set_destructor(G),this.set_refcount(0),this.set_caught(!1),this.set_rethrown(!1)},this.add_ref=function(){var L=ie[this.ptr>>2];ie[this.ptr>>2]=L+1},this.release_ref=function(){var L=ie[this.ptr>>2];return ie[this.ptr>>2]=L-1,L===1},this.set_adjusted_ptr=function(L){ue[this.ptr+16>>2]=L},this.get_adjusted_ptr=function(){return ue[this.ptr+16>>2]},this.get_exception_ptr=function(){var L=Ue(this.get_type());if(L)return ue[this.excPtr>>2];var G=this.get_adjusted_ptr();return G!==0?G:this.excPtr}}function At(I,L,G){var re=new Qt(I);throw re.init(L,G),I}var gn={};function Pt(I){for(;I.length;){var L=I.pop(),G=I.pop();G(L)}}function Tt(I){return this.fromWireType(ie[I>>2])}var Jn={},lr={},er={},Xi=48,_o=57;function Ca(I){if(I===void 0)return"_unknown";I=I.replace(/[^a-zA-Z0-9_]/g,"$");var L=I.charCodeAt(0);return L>=Xi&&L<=_o?"_"+I:I}function Yi(I,L){return I=Ca(I),new Function("body","return function "+I+`() {
    "use strict";    return body.apply(this, arguments);
};
`)(L)}function wr(I,L){var G=Yi(L,function(re){this.name=L,this.message=re;var fe=new Error(re).stack;fe!==void 0&&(this.stack=this.toString()+`
`+fe.replace(/^Error(:[^\n]*)?\n/,""))});return G.prototype=Object.create(I.prototype),G.prototype.constructor=G,G.prototype.toString=function(){return this.message===void 0?this.name:this.name+": "+this.message},G}var xr=void 0;function Kr(I){throw new xr(I)}function zn(I,L,G){I.forEach(function(me){er[me]=L});function re(me){var D=G(me);D.length!==I.length&&Kr("Mismatched type converter count");for(var R=0;R<I.length;++R)Je(I[R],D[R])}var fe=new Array(L.length),Se=[],Ce=0;L.forEach((me,D)=>{lr.hasOwnProperty(me)?fe[D]=lr[me]:(Se.push(me),Jn.hasOwnProperty(me)||(Jn[me]=[]),Jn[me].push(()=>{fe[D]=lr[me],++Ce,Ce===Se.length&&re(fe)}))}),Se.length===0&&re(fe)}function jn(I){var L=gn[I];delete gn[I];var G=L.rawConstructor,re=L.rawDestructor,fe=L.fields,Se=fe.map(Ce=>Ce.getterReturnType).concat(fe.map(Ce=>Ce.setterArgumentType));zn([I],Se,Ce=>{var me={};return fe.forEach((D,R)=>{var S=D.fieldName,E=Ce[R],b=D.getter,F=D.getterContext,W=Ce[R+fe.length],H=D.setter,Y=D.setterContext;me[S]={read:ee=>E.fromWireType(b(F,ee)),write:(ee,se)=>{var ve=[];H(Y,ee,W.toWireType(ve,se)),Pt(ve)}}}),[{name:L.name,fromWireType:function(D){var R={};for(var S in me)R[S]=me[S].read(D);return re(D),R},toWireType:function(D,R){for(var S in me)if(!(S in R))throw new TypeError('Missing field:  "'+S+'"');var E=G();for(S in me)me[S].write(E,R[S]);return D!==null&&D.push(re,E),E},argPackAdvance:8,readValueFromPointer:Tt,destructorFunction:re}]})}function ja(I,L,G,re,fe){}function Ha(I){switch(I){case 1:return 0;case 2:return 1;case 4:return 2;case 8:return 3;default:throw new TypeError("Unknown type size: "+I)}}function sn(){for(var I=new Array(256),L=0;L<256;++L)I[L]=String.fromCharCode(L);qr=I}var qr=void 0;function He(I){for(var L="",G=I;Q[G];)L+=qr[Q[G++]];return L}var xt=void 0;function st(I){throw new xt(I)}function Je(I,L,G={}){if(!("argPackAdvance"in L))throw new TypeError("registerType registeredInstance requires argPackAdvance");var re=L.name;if(I||st('type "'+re+'" must have a positive integer typeid pointer'),lr.hasOwnProperty(I)){if(G.ignoreDuplicateRegistrations)return;st("Cannot register type '"+re+"' twice")}if(lr[I]=L,delete er[I],Jn.hasOwnProperty(I)){var fe=Jn[I];delete Jn[I],fe.forEach(Se=>Se())}}function kn(I,L,G,re,fe){var Se=Ha(G);L=He(L),Je(I,{name:L,fromWireType:function(Ce){return!!Ce},toWireType:function(Ce,me){return me?re:fe},argPackAdvance:8,readValueFromPointer:function(Ce){var me;if(G===1)me=de;else if(G===2)me=q;else if(G===4)me=ie;else throw new TypeError("Unknown boolean type size: "+L);return this.fromWireType(me[Ce>>Se])},destructorFunction:null})}function bo(I){if(!(this instanceof ei)||!(I instanceof ei))return!1;for(var L=this.$$.ptrType.registeredClass,G=this.$$.ptr,re=I.$$.ptrType.registeredClass,fe=I.$$.ptr;L.baseClass;)G=L.upcast(G),L=L.baseClass;for(;re.baseClass;)fe=re.upcast(fe),re=re.baseClass;return L===re&&G===fe}function Lo(I){return{count:I.count,deleteScheduled:I.deleteScheduled,preservePointerOnDelete:I.preservePointerOnDelete,ptr:I.ptr,ptrType:I.ptrType,smartPtr:I.smartPtr,smartPtrType:I.smartPtrType}}function Zi(I){function L(G){return G.$$.ptrType.registeredClass.name}st(L(I)+" instance already deleted")}var wa=!1;function Qi(I){}function dn(I){I.smartPtr?I.smartPtrType.rawDestructor(I.smartPtr):I.ptrType.registeredClass.rawDestructor(I.ptr)}function vi(I){I.count.value-=1;var L=I.count.value===0;L&&dn(I)}function ht(I,L,G){if(L===G)return I;if(G.baseClass===void 0)return null;var re=ht(I,L,G.baseClass);return re===null?null:G.downcast(re)}var Sr={};function Ji(){return Object.keys(ea).length}function Io(){var I=[];for(var L in ea)ea.hasOwnProperty(L)&&I.push(ea[L]);return I}var Xr=[];function Yr(){for(;Xr.length;){var I=Xr.pop();I.$$.deleteScheduled=!1,I.delete()}}var Zr=void 0;function Pr(I){Zr=I,Xr.length&&Zr&&Zr(Yr)}function Pc(){a.getInheritedInstanceCount=Ji,a.getLiveInheritedInstances=Io,a.flushPendingDeletes=Yr,a.setDelayFunction=Pr}var ea={};function Qr(I,L){for(L===void 0&&st("ptr should not be undefined");I.baseClass;)L=I.upcast(L),I=I.baseClass;return L}function Ss(I,L){return L=Qr(I,L),ea[L]}function yi(I,L){(!L.ptrType||!L.ptr)&&Kr("makeClassHandle requires ptr and ptrType");var G=!!L.smartPtrType,re=!!L.smartPtr;return G!==re&&Kr("Both smartPtrType and smartPtr must be specified"),L.count={value:1},Jr(Object.create(I,{$$:{value:L}}))}function Ka(I){var L=this.getPointee(I);if(!L)return this.destructor(I),null;var G=Ss(this.registeredClass,L);if(G!==void 0){if(G.$$.count.value===0)return G.$$.ptr=L,G.$$.smartPtr=I,G.clone();var re=G.clone();return this.destructor(I),re}function fe(){return this.isSmartPointer?yi(this.registeredClass.instancePrototype,{ptrType:this.pointeeType,ptr:L,smartPtrType:this,smartPtr:I}):yi(this.registeredClass.instancePrototype,{ptrType:this,ptr:I})}var Se=this.registeredClass.getActualType(L),Ce=Sr[Se];if(!Ce)return fe.call(this);var me;this.isConst?me=Ce.constPointerType:me=Ce.pointerType;var D=ht(L,this.registeredClass,me.registeredClass);return D===null?fe.call(this):this.isSmartPointer?yi(me.registeredClass.instancePrototype,{ptrType:me,ptr:D,smartPtrType:this,smartPtr:I}):yi(me.registeredClass.instancePrototype,{ptrType:me,ptr:D})}function Jr(I){return typeof FinalizationRegistry>"u"?(Jr=L=>L,I):(wa=new FinalizationRegistry(L=>{vi(L.$$)}),Jr=L=>{var G=L.$$,re=!!G.smartPtr;if(re){var fe={$$:G};wa.register(L,fe,L)}return L},Qi=L=>wa.unregister(L),Jr(I))}function Pi(){if(this.$$.ptr||Zi(this),this.$$.preservePointerOnDelete)return this.$$.count.value+=1,this;var I=Jr(Object.create(Object.getPrototypeOf(this),{$$:{value:Lo(this.$$)}}));return I.$$.count.value+=1,I.$$.deleteScheduled=!1,I}function xa(){this.$$.ptr||Zi(this),this.$$.deleteScheduled&&!this.$$.preservePointerOnDelete&&st("Object already scheduled for deletion"),Qi(this),vi(this.$$),this.$$.preservePointerOnDelete||(this.$$.smartPtr=void 0,this.$$.ptr=void 0)}function Nc(){return!this.$$.ptr}function Ti(){return this.$$.ptr||Zi(this),this.$$.deleteScheduled&&!this.$$.preservePointerOnDelete&&st("Object already scheduled for deletion"),Xr.push(this),Xr.length===1&&Zr&&Zr(Yr),this.$$.deleteScheduled=!0,this}function ta(){ei.prototype.isAliasOf=bo,ei.prototype.clone=Pi,ei.prototype.delete=xa,ei.prototype.isDeleted=Nc,ei.prototype.deleteLater=Ti}function ei(){}function ti(I,L,G){if(I[L].overloadTable===void 0){var re=I[L];I[L]=function(){return I[L].overloadTable.hasOwnProperty(arguments.length)||st("Function '"+G+"' called with an invalid number of arguments ("+arguments.length+") - expects one of ("+I[L].overloadTable+")!"),I[L].overloadTable[arguments.length].apply(this,arguments)},I[L].overloadTable=[],I[L].overloadTable[re.argCount]=re}}function Ni(I,L,G){a.hasOwnProperty(I)?(st("Cannot register public name '"+I+"' twice"),ti(a,I,I),a.hasOwnProperty(G)&&st("Cannot register multiple overloads of a function with the same number of arguments ("+G+")!"),a[I].overloadTable[G]=L):a[I]=L}function kc(I,L,G,re,fe,Se,Ce,me){this.name=I,this.constructor=L,this.instancePrototype=G,this.rawDestructor=re,this.baseClass=fe,this.getActualType=Se,this.upcast=Ce,this.downcast=me,this.pureVirtualFunctions=[]}function ki(I,L,G){for(;L!==G;)L.upcast||st("Expected null or instance of "+G.name+", got an instance of "+L.name),I=L.upcast(I),L=L.baseClass;return I}function Vo(I,L){if(L===null)return this.isReference&&st("null is not a valid "+this.name),0;L.$$||st('Cannot pass "'+Oa(L)+'" as a '+this.name),L.$$.ptr||st("Cannot pass deleted object as a pointer of type "+this.name);var G=L.$$.ptrType.registeredClass,re=ki(L.$$.ptr,G,this.registeredClass);return re}function Ac(I,L){var G;if(L===null)return this.isReference&&st("null is not a valid "+this.name),this.isSmartPointer?(G=this.rawConstructor(),I!==null&&I.push(this.rawDestructor,G),G):0;L.$$||st('Cannot pass "'+Oa(L)+'" as a '+this.name),L.$$.ptr||st("Cannot pass deleted object as a pointer of type "+this.name),!this.isConst&&L.$$.ptrType.isConst&&st("Cannot convert argument of type "+(L.$$.smartPtrType?L.$$.smartPtrType.name:L.$$.ptrType.name)+" to parameter type "+this.name);var re=L.$$.ptrType.registeredClass;if(G=ki(L.$$.ptr,re,this.registeredClass),this.isSmartPointer)switch(L.$$.smartPtr===void 0&&st("Passing raw pointer to smart pointer is illegal"),this.sharingPolicy){case 0:L.$$.smartPtrType===this?G=L.$$.smartPtr:st("Cannot convert argument of type "+(L.$$.smartPtrType?L.$$.smartPtrType.name:L.$$.ptrType.name)+" to parameter type "+this.name);break;case 1:G=L.$$.smartPtr;break;case 2:if(L.$$.smartPtrType===this)G=L.$$.smartPtr;else{var fe=L.clone();G=this.rawShare(G,kr.toHandle(function(){fe.delete()})),I!==null&&I.push(this.rawDestructor,G)}break;default:st("Unsupporting sharing policy")}return G}function Fc(I,L){if(L===null)return this.isReference&&st("null is not a valid "+this.name),0;L.$$||st('Cannot pass "'+Oa(L)+'" as a '+this.name),L.$$.ptr||st("Cannot pass deleted object as a pointer of type "+this.name),L.$$.ptrType.isConst&&st("Cannot convert argument of type "+L.$$.ptrType.name+" to parameter type "+this.name);var G=L.$$.ptrType.registeredClass,re=ki(L.$$.ptr,G,this.registeredClass);return re}function Uc(I){return this.rawGetPointee&&(I=this.rawGetPointee(I)),I}function Bc(I){this.rawDestructor&&this.rawDestructor(I)}function Sn(I){I!==null&&I.delete()}function Po(){Nr.prototype.getPointee=Uc,Nr.prototype.destructor=Bc,Nr.prototype.argPackAdvance=8,Nr.prototype.readValueFromPointer=Tt,Nr.prototype.deleteObject=Sn,Nr.prototype.fromWireType=Ka}function Nr(I,L,G,re,fe,Se,Ce,me,D,R,S){this.name=I,this.registeredClass=L,this.isReference=G,this.isConst=re,this.isSmartPointer=fe,this.pointeeType=Se,this.sharingPolicy=Ce,this.rawGetPointee=me,this.rawConstructor=D,this.rawShare=R,this.rawDestructor=S,!fe&&L.baseClass===void 0?re?(this.toWireType=Vo,this.destructorFunction=null):(this.toWireType=Fc,this.destructorFunction=null):this.toWireType=Ac}function ur(I,L,G){a.hasOwnProperty(I)||Kr("Replacing nonexistant public symbol"),a[I].overloadTable!==void 0&&G!==void 0||(a[I]=L,a[I].argCount=G)}function qa(I,L,G){var re=a["dynCall_"+I];return G&&G.length?re.apply(null,[L].concat(G)):re.call(null,L)}var Xa=[];function Sa(I){var L=Xa[I];return L||(I>=Xa.length&&(Xa.length=I+1),Xa[I]=L=lt.get(I)),L}function pn(I,L,G){if(I.includes("j"))return qa(I,L,G);var re=Sa(L).apply(null,G);return re}function Es(I,L){var G=[];return function(){return G.length=0,Object.assign(G,arguments),pn(I,L,G)}}function Er(I,L){I=He(I);function G(){return I.includes("j")?Es(I,L):Sa(L)}var re=G();return typeof re!="function"&&st("unknown function pointer with signature "+I+": "+L),re}var Hn=void 0;function No(I){var L=Te(I),G=He(L);return ye(L),G}function Kn(I,L){var G=[],re={};function fe(Se){if(!re[Se]&&!lr[Se]){if(er[Se]){er[Se].forEach(fe);return}G.push(Se),re[Se]=!0}}throw L.forEach(fe),new Hn(I+": "+G.map(No).join([", "]))}function Ya(I,L,G,re,fe,Se,Ce,me,D,R,S,E,b){S=He(S),Se=Er(fe,Se),me&&(me=Er(Ce,me)),R&&(R=Er(D,R)),b=Er(E,b);var F=Ca(S);Ni(F,function(){Kn("Cannot construct "+S+" due to unbound types",[re])}),zn([I,L,G],re?[re]:[],function(W){W=W[0];var H,Y;re?(H=W.registeredClass,Y=H.instancePrototype):Y=ei.prototype;var ee=Yi(F,function(){if(Object.getPrototypeOf(this)!==se)throw new xt("Use 'new' to construct "+S);if(ve.constructor_body===void 0)throw new xt(S+" has no accessible constructor");var rt=ve.constructor_body[arguments.length];if(rt===void 0)throw new xt("Tried to invoke ctor of "+S+" with invalid number of parameters ("+arguments.length+") - expected ("+Object.keys(ve.constructor_body).toString()+") parameters instead!");return rt.apply(this,arguments)}),se=Object.create(Y,{constructor:{value:ee}});ee.prototype=se;var ve=new kc(S,ee,se,b,H,Se,me,R),Re=new Nr(S,ve,!0,!1,!1),ke=new Nr(S+"*",ve,!1,!1,!1),Ie=new Nr(S+" const*",ve,!1,!0,!1);return Sr[I]={pointerType:ke,constPointerType:Ie},ur(F,ee),[Re,ke,Ie]})}function Za(I,L){for(var G=[],re=0;re<I;re++)G.push(ue[L+re*4>>2]);return G}function Os(I,L){if(!(I instanceof Function))throw new TypeError("new_ called with constructor type "+typeof I+" which is not a function");var G=Yi(I.name||"unknownFunctionName",function(){});G.prototype=I.prototype;var re=new G,fe=I.apply(re,L);return fe instanceof Object?fe:re}function Ds(I,L,G,re,fe){var Se=L.length;Se<2&&st("argTypes array size mismatch! Must at least get return value and 'this' types!");for(var Ce=L[1]!==null&&G!==null,me=!1,D=1;D<L.length;++D)if(L[D]!==null&&L[D].destructorFunction===void 0){me=!0;break}for(var R=L[0].name!=="void",S="",E="",D=0;D<Se-2;++D)S+=(D!==0?", ":"")+"arg"+D,E+=(D!==0?", ":"")+"arg"+D+"Wired";var b="return function "+Ca(I)+"("+S+`) {
if (arguments.length !== `+(Se-2)+`) {
throwBindingError('function `+I+" called with ' + arguments.length + ' arguments, expected "+(Se-2)+` args!');
}
`;me&&(b+=`var destructors = [];
`);var F=me?"destructors":"null",W=["throwBindingError","invoker","fn","runDestructors","retType","classParam"],H=[st,re,fe,Pt,L[0],L[1]];Ce&&(b+="var thisWired = classParam.toWireType("+F+`, this);
`);for(var D=0;D<Se-2;++D)b+="var arg"+D+"Wired = argType"+D+".toWireType("+F+", arg"+D+"); // "+L[D+2].name+`
`,W.push("argType"+D),H.push(L[D+2]);if(Ce&&(E="thisWired"+(E.length>0?", ":"")+E),b+=(R?"var rv = ":"")+"invoker(fn"+(E.length>0?", ":"")+E+`);
`,me)b+=`runDestructors(destructors);
`;else for(var D=Ce?1:2;D<L.length;++D){var Y=D===1?"thisWired":"arg"+(D-2)+"Wired";L[D].destructorFunction!==null&&(b+=Y+"_dtor("+Y+"); // "+L[D].name+`
`,W.push(Y+"_dtor"),H.push(L[D].destructorFunction))}R&&(b+=`var ret = retType.fromWireType(rv);
return ret;
`),b+=`}
`,W.push(b);var ee=Os(Function,W).apply(null,H);return ee}function qn(I,L,G,re,fe,Se){A(L>0);var Ce=Za(L,G);fe=Er(re,fe),zn([],[I],function(me){me=me[0];var D="constructor "+me.name;if(me.registeredClass.constructor_body===void 0&&(me.registeredClass.constructor_body=[]),me.registeredClass.constructor_body[L-1]!==void 0)throw new xt("Cannot register multiple constructors with identical number of parameters ("+(L-1)+") for class '"+me.name+"'! Overload resolution is currently only performed using the parameter count, not actual type info!");return me.registeredClass.constructor_body[L-1]=()=>{Kn("Cannot construct "+me.name+" due to unbound types",Ce)},zn([],Ce,function(R){return R.splice(1,0,null),me.registeredClass.constructor_body[L-1]=Ds(D,R,null,fe,Se),[]}),[]})}function fr(I,L,G,re,fe,Se,Ce,me){var D=Za(G,re);L=He(L),Se=Er(fe,Se),zn([],[I],function(R){R=R[0];var S=R.name+"."+L;L.startsWith("@@")&&(L=Symbol[L.substring(2)]),me&&R.registeredClass.pureVirtualFunctions.push(L);function E(){Kn("Cannot call "+S+" due to unbound types",D)}var b=R.registeredClass.instancePrototype,F=b[L];return F===void 0||F.overloadTable===void 0&&F.className!==R.name&&F.argCount===G-2?(E.argCount=G-2,E.className=R.name,b[L]=E):(ti(b,L,S),b[L].overloadTable[G-2]=E),zn([],D,function(W){var H=Ds(S,W,R,Se,Ce);return b[L].overloadTable===void 0?(H.argCount=G-2,b[L]=H):b[L].overloadTable[G-2]=H,[]}),[]})}var Ea=[],En=[{},{value:void 0},{value:null},{value:!0},{value:!1}];function gr(I){I>4&&--En[I].refcount===0&&(En[I]=void 0,Ea.push(I))}function Qa(){for(var I=0,L=5;L<En.length;++L)En[L]!==void 0&&++I;return I}function Ci(){for(var I=5;I<En.length;++I)if(En[I]!==void 0)return En[I];return null}function ko(){a.count_emval_handles=Qa,a.get_first_emval=Ci}var kr={toValue:I=>(I||st("Cannot use deleted val. handle = "+I),En[I].value),toHandle:I=>{switch(I){case void 0:return 1;case null:return 2;case!0:return 3;case!1:return 4;default:{var L=Ea.length?Ea.pop():En.length;return En[L]={refcount:1,value:I},L}}}};function wi(I,L){L=He(L),Je(I,{name:L,fromWireType:function(G){var re=kr.toValue(G);return gr(G),re},toWireType:function(G,re){return kr.toHandle(re)},argPackAdvance:8,readValueFromPointer:Tt,destructorFunction:null})}function Oa(I){if(I===null)return"null";var L=typeof I;return L==="object"||L==="array"||L==="function"?I.toString():""+I}function tr(I,L){switch(L){case 2:return function(G){return this.fromWireType(le[G>>2])};case 3:return function(G){return this.fromWireType(Fe[G>>3])};default:throw new TypeError("Unknown float type: "+I)}}function Rs(I,L,G){var re=Ha(G);L=He(L),Je(I,{name:L,fromWireType:function(fe){return fe},toWireType:function(fe,Se){return Se},argPackAdvance:8,readValueFromPointer:tr(L,re),destructorFunction:null})}function Gc(I,L,G){switch(L){case 0:return G?function(fe){return de[fe]}:function(fe){return Q[fe]};case 1:return G?function(fe){return q[fe>>1]}:function(fe){return j[fe>>1]};case 2:return G?function(fe){return ie[fe>>2]}:function(fe){return ue[fe>>2]};default:throw new TypeError("Unknown integer type: "+I)}}function $c(I,L,G,re,fe){L=He(L);var Se=Ha(G),Ce=E=>E;if(re===0){var me=32-8*G;Ce=E=>E<<me>>>me}var D=L.includes("unsigned"),R=(E,b)=>{},S;D?S=function(E,b){return R(b,this.name),b>>>0}:S=function(E,b){return R(b,this.name),b},Je(I,{name:L,fromWireType:Ce,toWireType:S,argPackAdvance:8,readValueFromPointer:Gc(L,Se,re!==0),destructorFunction:null})}function Wc(I,L,G){var re=[Int8Array,Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array],fe=re[L];function Se(Ce){Ce=Ce>>2;var me=ue,D=me[Ce],R=me[Ce+1];return new fe(J,R,D)}G=He(G),Je(I,{name:G,fromWireType:Se,argPackAdvance:8,readValueFromPointer:Se},{ignoreDuplicateRegistrations:!0})}function Da(I,L){L=He(L);var G=L==="std::string";Je(I,{name:L,fromWireType:function(re){var fe=ue[re>>2],Se=re+4,Ce;if(G)for(var me=Se,D=0;D<=fe;++D){var R=Se+D;if(D==fe||Q[R]==0){var S=R-me,E=z(me,S);Ce===void 0?Ce=E:(Ce+="\0",Ce+=E),me=R+1}}else{for(var b=new Array(fe),D=0;D<fe;++D)b[D]=String.fromCharCode(Q[Se+D]);Ce=b.join("")}return ye(re),Ce},toWireType:function(re,fe){fe instanceof ArrayBuffer&&(fe=new Uint8Array(fe));var Se,Ce=typeof fe=="string";Ce||fe instanceof Uint8Array||fe instanceof Uint8ClampedArray||fe instanceof Int8Array||st("Cannot pass non-string to std::string"),G&&Ce?Se=ce(fe):Se=fe.length;var me=ge(4+Se+1),D=me+4;if(ue[me>>2]=Se,G&&Ce)Z(fe,D,Se+1);else if(Ce)for(var R=0;R<Se;++R){var S=fe.charCodeAt(R);S>255&&(ye(D),st("String has UTF-16 code units that do not fit in 8 bits")),Q[D+R]=S}else for(var R=0;R<Se;++R)Q[D+R]=fe[R];return re!==null&&re.push(ye,me),me},argPackAdvance:8,readValueFromPointer:Tt,destructorFunction:function(re){ye(re)}})}var Ms=typeof TextDecoder<"u"?new TextDecoder("utf-16le"):void 0;function Ja(I,L){for(var G=I,re=G>>1,fe=re+L/2;!(re>=fe)&&j[re];)++re;if(G=re<<1,G-I>32&&Ms)return Ms.decode(Q.subarray(I,G));for(var Se="",Ce=0;!(Ce>=L/2);++Ce){var me=q[I+Ce*2>>1];if(me==0)break;Se+=String.fromCharCode(me)}return Se}function zc(I,L,G){if(G===void 0&&(G=2147483647),G<2)return 0;G-=2;for(var re=L,fe=G<I.length*2?G/2:I.length,Se=0;Se<fe;++Se){var Ce=I.charCodeAt(Se);q[L>>1]=Ce,L+=2}return q[L>>1]=0,L-re}function jc(I){return I.length*2}function Hc(I,L){for(var G=0,re="";!(G>=L/4);){var fe=ie[I+G*4>>2];if(fe==0)break;if(++G,fe>=65536){var Se=fe-65536;re+=String.fromCharCode(55296|Se>>10,56320|Se&1023)}else re+=String.fromCharCode(fe)}return re}function Kc(I,L,G){if(G===void 0&&(G=2147483647),G<4)return 0;for(var re=L,fe=re+G-4,Se=0;Se<I.length;++Se){var Ce=I.charCodeAt(Se);if(Ce>=55296&&Ce<=57343){var me=I.charCodeAt(++Se);Ce=65536+((Ce&1023)<<10)|me&1023}if(ie[L>>2]=Ce,L+=4,L+4>fe)break}return ie[L>>2]=0,L-re}function qc(I){for(var L=0,G=0;G<I.length;++G){var re=I.charCodeAt(G);re>=55296&&re<=57343&&++G,L+=4}return L}function Xc(I,L,G){G=He(G);var re,fe,Se,Ce,me;L===2?(re=Ja,fe=zc,Ce=jc,Se=()=>j,me=1):L===4&&(re=Hc,fe=Kc,Ce=qc,Se=()=>ue,me=2),Je(I,{name:G,fromWireType:function(D){for(var R=ue[D>>2],S=Se(),E,b=D+4,F=0;F<=R;++F){var W=D+4+F*L;if(F==R||S[W>>me]==0){var H=W-b,Y=re(b,H);E===void 0?E=Y:(E+="\0",E+=Y),b=W+L}}return ye(D),E},toWireType:function(D,R){typeof R!="string"&&st("Cannot pass non-string to C++ string type "+G);var S=Ce(R),E=ge(4+S+L);return ue[E>>2]=S>>me,fe(R,E+4,S+L),D!==null&&D.push(ye,E),E},argPackAdvance:8,readValueFromPointer:Tt,destructorFunction:function(D){ye(D)}})}function Yc(I,L,G,re,fe,Se){gn[I]={name:He(L),rawConstructor:Er(G,re),rawDestructor:Er(fe,Se),fields:[]}}function _s(I,L,G,re,fe,Se,Ce,me,D,R){gn[I].fields.push({fieldName:He(L),getterReturnType:G,getter:Er(re,fe),getterContext:Se,setterArgumentType:Ce,setter:Er(me,D),setterContext:R})}function Zc(I,L){L=He(L),Je(I,{isVoid:!0,name:L,argPackAdvance:0,fromWireType:function(){},toWireType:function(G,re){}})}var Qc={};function bs(I){var L=Qc[I];return L===void 0?He(I):L}function Ls(){return typeof globalThis=="object"?globalThis:function(){return Function}()("return this")()}function Jc(I){return I===0?kr.toHandle(Ls()):(I=bs(I),kr.toHandle(Ls()[I]))}function Ao(I){I>4&&(En[I].refcount+=1)}function Is(I,L){var G=lr[I];return G===void 0&&st(L+" has unknown type "+No(I)),G}function Vs(I){for(var L="",G=0;G<I;++G)L+=(G!==0?", ":"")+"arg"+G;for(var re=()=>ue,fe="return function emval_allocator_"+I+`(constructor, argTypes, args) {
  var HEAPU32 = getMemory();
`,G=0;G<I;++G)fe+="var argType"+G+" = requireRegisteredType(HEAPU32[((argTypes)>>2)], 'parameter "+G+`');
var arg`+G+" = argType"+G+`.readValueFromPointer(args);
args += argType`+G+`['argPackAdvance'];
argTypes += 4;
`;return fe+="var obj = new constructor("+L+`);
return valueToHandle(obj);
}
`,new Function("requireRegisteredType","Module","valueToHandle","getMemory",fe)(Is,a,kr.toHandle,re)}var Fo={};function e0(I,L,G,re){I=kr.toValue(I);var fe=Fo[L];return fe||(fe=Vs(L),Fo[L]=fe),fe(I,G,re)}function Ps(I,L){I=Is(I,"_emval_take_value");var G=I.readValueFromPointer(L);return kr.toHandle(G)}function t0(){cr("")}function Ns(){return 2147483648}function n0(){return Ns()}function r0(I,L,G){Q.copyWithin(I,L,L+G)}function i0(I){try{return O.grow(I-J.byteLength+65535>>>16),kt(O.buffer),1}catch{}}function a0(I){var L=Q.length;I=I>>>0;var G=Ns();if(I>G)return!1;let re=(D,R)=>D+(R-D%R)%R;for(var fe=1;fe<=4;fe*=2){var Se=L*(1+.2/fe);Se=Math.min(Se,I+100663296);var Ce=Math.min(G,re(Math.max(I,Se),65536)),me=i0(Ce);if(me)return!0}return!1}var Uo={};function Bo(){return l||"./this.program"}function Ai(){if(!Ai.strings){var I=(typeof navigator=="object"&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",L={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:I,_:Bo()};for(var G in Uo)Uo[G]===void 0?delete L[G]:L[G]=Uo[G];var re=[];for(var G in L)re.push(G+"="+L[G]);Ai.strings=re}return Ai.strings}function na(I,L,G){for(var re=0;re<I.length;++re)de[L++>>0]=I.charCodeAt(re);de[L>>0]=0}function ni(I,L){var G=0;return Ai().forEach(function(re,fe){var Se=L+G;ue[I+fe*4>>2]=Se,na(re,Se),G+=re.length+1}),0}function ks(I,L){var G=Ai();ue[I>>2]=G.length;var re=0;return G.forEach(function(fe){re+=fe.length+1}),ue[L>>2]=re,0}function As(I){return 52}function Go(I,L,G,re,fe){return 70}var Fs=[null,[],[]];function eo(I,L){var G=Fs[I];L===0||L===10?((I===1?C:w)(k(G,0)),G.length=0):G.push(L)}function Us(I,L,G,re){for(var fe=0,Se=0;Se<G;Se++){var Ce=ue[L>>2],me=ue[L+4>>2];L+=8;for(var D=0;D<me;D++)eo(I,Q[Ce+D]);fe+=me}return ue[re>>2]=fe,0}function V(I){var L=a["_"+I];return L}function N(I,L){de.set(I,L)}function K(I,L,G,re,fe){var Se={string:W=>{var H=0;if(W!=null&&W!==0){var Y=(W.length<<2)+1;H=be(Y),Z(W,H,Y)}return H},array:W=>{var H=be(W.length);return N(W,H),H}};function Ce(W){return L==="string"?z(W):L==="boolean"?!!W:W}var me=V(I),D=[],R=0;if(re)for(var S=0;S<re.length;S++){var E=Se[G[S]];E?(R===0&&(R=pe()),D[S]=E(re[S])):D[S]=re[S]}var b=me.apply(null,D);function F(W){return R!==0&&we(R),Ce(W)}return b=F(b),b}xr=a.InternalError=wr(Error,"InternalError"),sn(),xt=a.BindingError=wr(Error,"BindingError"),ta(),Pc(),Po(),Hn=a.UnboundTypeError=wr(Error,"UnboundTypeError"),ko();var oe={D:At,e:jn,t:ja,B:kn,r:Ya,q:qn,b:fr,A:wi,l:Rs,d:$c,a:Wc,k:Da,f:Xc,g:Yc,c:_s,C:Zc,h:gr,o:Jc,m:Ao,n:e0,p:Ps,i:t0,v:n0,z:r0,u:a0,w:ni,x:ks,y:As,s:Go,j:Us};Pe(),a.___wasm_call_ctors=function(){return(a.___wasm_call_ctors=a.asm.F).apply(null,arguments)};var ge=a._malloc=function(){return(ge=a._malloc=a.asm.H).apply(null,arguments)},ye=a._free=function(){return(ye=a._free=a.asm.I).apply(null,arguments)},Te=a.___getTypeName=function(){return(Te=a.___getTypeName=a.asm.J).apply(null,arguments)};a.__embind_initialize_bindings=function(){return(a.__embind_initialize_bindings=a.asm.K).apply(null,arguments)};var pe=a.stackSave=function(){return(pe=a.stackSave=a.asm.L).apply(null,arguments)},we=a.stackRestore=function(){return(we=a.stackRestore=a.asm.M).apply(null,arguments)},be=a.stackAlloc=function(){return(be=a.stackAlloc=a.asm.N).apply(null,arguments)},Ue=a.___cxa_is_pointer_type=function(){return(Ue=a.___cxa_is_pointer_type=a.asm.O).apply(null,arguments)};a.dynCall_iji=function(){return(a.dynCall_iji=a.asm.P).apply(null,arguments)},a.dynCall_jji=function(){return(a.dynCall_jji=a.asm.Q).apply(null,arguments)},a.dynCall_iiji=function(){return(a.dynCall_iiji=a.asm.R).apply(null,arguments)},a.dynCall_jiji=function(){return(a.dynCall_jiji=a.asm.S).apply(null,arguments)},a.ccall=K;var ze;Nn=function I(){ze||qe(),ze||(Nn=I)};function qe(I){if(Pn>0||(Ke(),Pn>0))return;function L(){ze||(ze=!0,a.calledRun=!0,!M&&(Ye(),o(a),a.onRuntimeInitialized&&a.onRuntimeInitialized(),Zt()))}a.setStatus?(a.setStatus("Running..."),setTimeout(function(){setTimeout(function(){a.setStatus("")},1),L()},1)):L()}if(a.preInit)for(typeof a.preInit=="function"&&(a.preInit=[a.preInit]);a.preInit.length>0;)a.preInit.pop()();return qe(),i.ready}})();t.exports=n})(i_);var zne=i_.exports;const jne=Eo(zne),Hne=new URL("/dicom-viewer/assets/openjpegwasm_decode-C4nnCcr6.wasm",import.meta.url),jf={codec:void 0,decoder:void 0,decodeConfig:{}};function Kne(t){if(jf.decodeConfig=t,jf.codec)return Promise.resolve();const e=jne({locateFile:n=>n.endsWith(".wasm")?Hne.toString():n});return new Promise((n,r)=>{e.then(i=>{jf.codec=i,jf.decoder=new i.J2KDecoder,n()},r)})}async function TT(t,e){await Kne();const n=jf.decoder,r=n.getEncodedBuffer(t.length);r.set(t),n.decode();const i=n.getFrameInfo(),a=n.getDecodedBuffer();new Uint8Array(a.length).set(a);const s=`x: ${n.getImageOffset().x}, y: ${n.getImageOffset().y}`,c=n.getNumDecompositions(),l=n.getNumLayers(),f=["unknown","LRCP","RLCP","RPCL","PCRL","CPRL"][n.getProgressionOrder()+1],u=n.getIsReversible(),g=`${n.getBlockDimensions().width} x ${n.getBlockDimensions().height}`,d=`${n.getTileSize().width} x ${n.getTileSize().height}`,h=`${n.getTileOffset().x}, ${n.getTileOffset().y}`,p=n.getColorSpace(),m=`${a.length.toLocaleString()} bytes`,v=`${(a.length/r.length).toFixed(2)}:1`,y={columns:i.width,rows:i.height,bitsPerPixel:i.bitsPerSample,signed:i.isSigned,bytesPerPixel:e.bytesPerPixel,componentsPerPixel:i.componentCount},T=qne(i,a),C={imageOffset:s,numDecompositions:c,numLayers:l,progessionOrder:f,reversible:u,blockDimensions:g,tileSize:d,tileOffset:h,colorTransform:p,decodedSize:m,compressionRatio:v};return{...e,pixelData:T,imageInfo:y,encodeOptions:C,...C,...y}}function qne(t,e){return t.bitsPerSample>8?t.isSigned?new Int16Array(e.buffer,e.byteOffset,e.byteLength/2):new Uint16Array(e.buffer,e.byteOffset,e.byteLength/2):t.isSigned?new Int8Array(e.buffer,e.byteOffset,e.byteLength):new Uint8Array(e.buffer,e.byteOffset,e.byteLength)}var a_={exports:{}};(function(t,e){var n=(()=>{var r=typeof document<"u"&&document.currentScript?document.currentScript.src:void 0;return typeof __filename<"u"&&(r=r||__filename),function(a){a=a||{};var a=typeof a<"u"?a:{},o,s;a.ready=new Promise(function(D,R){o=D,s=R});var c=Object.assign({},a),l=typeof window=="object",f=typeof importScripts=="function",u=typeof process=="object"&&typeof process.versions=="object"&&typeof process.versions.node=="string",g="";function d(D){return a.locateFile?a.locateFile(D,g):g+D}var h,p,m;if(u){var v=vo,y=vo;f?g=y.dirname(g)+"/":g=__dirname+"/",h=(D,R)=>(D=$(D)?new URL(D):y.normalize(D),v.readFileSync(D,R?void 0:"utf8")),m=D=>{var R=h(D,!0);return R.buffer||(R=new Uint8Array(R)),R},p=(D,R,S)=>{D=$(D)?new URL(D):y.normalize(D),v.readFile(D,function(E,b){E?S(E):R(b.buffer)})},process.argv.length>1&&process.argv[1].replace(/\\/g,"/"),process.argv.slice(2),process.on("uncaughtException",function(D){if(!(D instanceof Pe))throw D}),process.on("unhandledRejection",function(D){throw D}),a.inspect=function(){return"[Emscripten Module object]"}}else(l||f)&&(f?g=self.location.href:typeof document<"u"&&document.currentScript&&(g=document.currentScript.src),r&&(g=r),g.indexOf("blob:")!==0?g=g.substr(0,g.replace(/[?#].*/,"").lastIndexOf("/")+1):g="",h=D=>{var R=new XMLHttpRequest;return R.open("GET",D,!1),R.send(null),R.responseText},f&&(m=D=>{var R=new XMLHttpRequest;return R.open("GET",D,!1),R.responseType="arraybuffer",R.send(null),new Uint8Array(R.response)}),p=(D,R,S)=>{var E=new XMLHttpRequest;E.open("GET",D,!0),E.responseType="arraybuffer",E.onload=()=>{if(E.status==200||E.status==0&&E.response){R(E.response);return}S()},E.onerror=S,E.send(null)});var T=a.print||console.log.bind(console),C=a.printErr||console.warn.bind(console);Object.assign(a,c),c=null,a.arguments&&a.arguments,a.thisProgram&&a.thisProgram,a.quit&&a.quit;var w;a.wasmBinary&&(w=a.wasmBinary),a.noExitRuntime,typeof WebAssembly!="object"&&Hr("no native wasm support detected");var x,O=!1;function M(D,R){D||Hr(R)}var A=typeof TextDecoder<"u"?new TextDecoder("utf8"):void 0;function _(D,R,S){for(var E=R+S,b=R;D[b]&&!(b>=E);)++b;if(b-R>16&&D.buffer&&A)return A.decode(D.subarray(R,b));for(var F="";R<b;){var W=D[R++];if(!(W&128)){F+=String.fromCharCode(W);continue}var H=D[R++]&63;if((W&224)==192){F+=String.fromCharCode((W&31)<<6|H);continue}var Y=D[R++]&63;if((W&240)==224?W=(W&15)<<12|H<<6|Y:W=(W&7)<<18|H<<12|Y<<6|D[R++]&63,W<65536)F+=String.fromCharCode(W);else{var ee=W-65536;F+=String.fromCharCode(55296|ee>>10,56320|ee&1023)}}return F}function k(D,R){return D?_(de,D,R):""}function z(D,R,S,E){if(!(E>0))return 0;for(var b=S,F=S+E-1,W=0;W<D.length;++W){var H=D.charCodeAt(W);if(H>=55296&&H<=57343){var Y=D.charCodeAt(++W);H=65536+((H&1023)<<10)|Y&1023}if(H<=127){if(S>=F)break;R[S++]=H}else if(H<=2047){if(S+1>=F)break;R[S++]=192|H>>6,R[S++]=128|H&63}else if(H<=65535){if(S+2>=F)break;R[S++]=224|H>>12,R[S++]=128|H>>6&63,R[S++]=128|H&63}else{if(S+3>=F)break;R[S++]=240|H>>18,R[S++]=128|H>>12&63,R[S++]=128|H>>6&63,R[S++]=128|H&63}}return R[S]=0,S-b}function X(D,R,S){return z(D,de,R,S)}function Z(D){for(var R=0,S=0;S<D.length;++S){var E=D.charCodeAt(S);E<=127?R++:E<=2047?R+=2:E>=55296&&E<=57343?(R+=4,++S):R+=3}return R}var ce,J,de,Q,q,j,ie,ue,le;function Fe(D){ce=D,a.HEAP8=J=new Int8Array(D),a.HEAP16=Q=new Int16Array(D),a.HEAP32=j=new Int32Array(D),a.HEAPU8=de=new Uint8Array(D),a.HEAPU16=q=new Uint16Array(D),a.HEAPU32=ie=new Uint32Array(D),a.HEAPF32=ue=new Float32Array(D),a.HEAPF64=le=new Float64Array(D)}a.INITIAL_MEMORY;var kt,lt=[],yt=[],dt=[];function _t(){if(a.preRun)for(typeof a.preRun=="function"&&(a.preRun=[a.preRun]);a.preRun.length;)Zt(a.preRun.shift());it(lt)}function Ke(){it(yt)}function Ye(){if(a.postRun)for(typeof a.postRun=="function"&&(a.postRun=[a.postRun]);a.postRun.length;)Cr(a.postRun.shift());it(dt)}function Zt(D){lt.unshift(D)}function jr(D){yt.unshift(D)}function Cr(D){dt.unshift(D)}var $t=0,Pn=null;function Nn(D){$t++,a.monitorRunDependencies&&a.monitorRunDependencies($t)}function fn(D){if($t--,a.monitorRunDependencies&&a.monitorRunDependencies($t),$t==0&&Pn){var R=Pn;Pn=null,R()}}function Hr(D){a.onAbort&&a.onAbort(D),D="Aborted("+D+")",C(D),O=!0,D+=". Build with -sASSERTIONS for more info.";var R=new WebAssembly.RuntimeError(D);throw s(R),R}var cr="data:application/octet-stream;base64,";function U(D){return D.startsWith(cr)}function $(D){return D.startsWith("file://")}var ne;ne="openjphjs.wasm",U(ne)||(ne=d(ne));function B(D){try{if(D==ne&&w)return new Uint8Array(w);if(m)return m(D);throw"both async and sync fetching of the wasm failed"}catch(R){Hr(R)}}function ae(){if(!w&&(l||f)){if(typeof fetch=="function"&&!$(ne))return fetch(ne,{credentials:"same-origin"}).then(function(D){if(!D.ok)throw"failed to load wasm binary file at '"+ne+"'";return D.arrayBuffer()}).catch(function(){return B(ne)});if(p)return new Promise(function(D,R){p(ne,function(S){D(new Uint8Array(S))},R)})}return Promise.resolve().then(function(){return B(ne)})}function xe(){var D={a:Us};function R(W,H){var Y=W.exports;a.asm=Y,x=a.asm.P,Fe(x.buffer),kt=a.asm.T,jr(a.asm.Q),fn()}Nn();function S(W){R(W.instance)}function E(W){return ae().then(function(H){return WebAssembly.instantiate(H,D)}).then(function(H){return H}).then(W,function(H){C("failed to asynchronously prepare wasm: "+H),Hr(H)})}function b(){return!w&&typeof WebAssembly.instantiateStreaming=="function"&&!U(ne)&&!$(ne)&&!u&&typeof fetch=="function"?fetch(ne,{credentials:"same-origin"}).then(function(W){var H=WebAssembly.instantiateStreaming(W,D);return H.then(S,function(Y){return C("wasm streaming compile failed: "+Y),C("falling back to ArrayBuffer instantiation"),E(S)})}):E(S)}if(a.instantiateWasm)try{var F=a.instantiateWasm(D,R);return F}catch(W){C("Module.instantiateWasm callback failed with error: "+W),s(W)}return b().catch(s),{}}function Pe(D){this.name="ExitStatus",this.message="Program terminated with exit("+D+")",this.status=D}function it(D){for(;D.length>0;)D.shift()(a)}var Ct=[];function Qt(D){D.add_ref()}function At(D){var R=new er(D);return R.get_caught()||R.set_caught(!0),R.set_rethrown(!1),Ct.push(R),Qt(R),R.get_exception_ptr()}var gn=0,Pt=[];function Tt(D){var R=Pt[D];return R||(D>=Pt.length&&(Pt.length=D+1),Pt[D]=R=kt.get(D)),R}function Jn(D){if(D.release_ref()&&!D.get_rethrown()){var R=D.get_destructor();R&&Tt(R)(D.excPtr),N(D.excPtr)}}function lr(){_setThrew(0);var D=Ct.pop();Jn(D),gn=0}function er(D){this.excPtr=D,this.ptr=D-24,this.set_type=function(R){ie[this.ptr+4>>2]=R},this.get_type=function(){return ie[this.ptr+4>>2]},this.set_destructor=function(R){ie[this.ptr+8>>2]=R},this.get_destructor=function(){return ie[this.ptr+8>>2]},this.set_refcount=function(R){j[this.ptr>>2]=R},this.set_caught=function(R){R=R?1:0,J[this.ptr+12>>0]=R},this.get_caught=function(){return J[this.ptr+12>>0]!=0},this.set_rethrown=function(R){R=R?1:0,J[this.ptr+13>>0]=R},this.get_rethrown=function(){return J[this.ptr+13>>0]!=0},this.init=function(R,S){this.set_adjusted_ptr(0),this.set_type(R),this.set_destructor(S),this.set_refcount(0),this.set_caught(!1),this.set_rethrown(!1)},this.add_ref=function(){var R=j[this.ptr>>2];j[this.ptr>>2]=R+1},this.release_ref=function(){var R=j[this.ptr>>2];return j[this.ptr>>2]=R-1,R===1},this.set_adjusted_ptr=function(R){ie[this.ptr+16>>2]=R},this.get_adjusted_ptr=function(){return ie[this.ptr+16>>2]},this.get_exception_ptr=function(){var R=be(this.get_type());if(R)return ie[this.excPtr>>2];var S=this.get_adjusted_ptr();return S!==0?S:this.excPtr}}function Xi(D){throw gn||(gn=D),D}function _o(){var D=gn;if(!D)return ge(0),0;var R=new er(D);R.set_adjusted_ptr(D);var S=R.get_type();if(!S)return ge(0),D;for(var E=0;E<arguments.length;E++){var b=arguments[E];if(b===0||b===S)break;var F=R.ptr+16;if(we(b,S,F))return ge(b),D}return ge(S),D}function Ca(){var D=gn;if(!D)return ge(0),0;var R=new er(D);R.set_adjusted_ptr(D);var S=R.get_type();if(!S)return ge(0),D;for(var E=0;E<arguments.length;E++){var b=arguments[E];if(b===0||b===S)break;var F=R.ptr+16;if(we(b,S,F))return ge(b),D}return ge(S),D}function Yi(D,R,S){var E=new er(D);throw E.init(R,S),gn=D,D}var wr={};function xr(D){for(;D.length;){var R=D.pop(),S=D.pop();S(R)}}function Kr(D){return this.fromWireType(j[D>>2])}var zn={},jn={},ja={},Ha=48,sn=57;function qr(D){if(D===void 0)return"_unknown";D=D.replace(/[^a-zA-Z0-9_]/g,"$");var R=D.charCodeAt(0);return R>=Ha&&R<=sn?"_"+D:D}function He(D,R){return D=qr(D),new Function("body","return function "+D+`() {
    "use strict";    return body.apply(this, arguments);
};
`)(R)}function xt(D,R){var S=He(R,function(E){this.name=R,this.message=E;var b=new Error(E).stack;b!==void 0&&(this.stack=this.toString()+`
`+b.replace(/^Error(:[^\n]*)?\n/,""))});return S.prototype=Object.create(D.prototype),S.prototype.constructor=S,S.prototype.toString=function(){return this.message===void 0?this.name:this.name+": "+this.message},S}var st=void 0;function Je(D){throw new st(D)}function kn(D,R,S){D.forEach(function(H){ja[H]=R});function E(H){var Y=S(H);Y.length!==D.length&&Je("Mismatched type converter count");for(var ee=0;ee<D.length;++ee)Sr(D[ee],Y[ee])}var b=new Array(R.length),F=[],W=0;R.forEach((H,Y)=>{jn.hasOwnProperty(H)?b[Y]=jn[H]:(F.push(H),zn.hasOwnProperty(H)||(zn[H]=[]),zn[H].push(()=>{b[Y]=jn[H],++W,W===F.length&&E(b)}))}),F.length===0&&E(b)}function bo(D){var R=wr[D];delete wr[D];var S=R.rawConstructor,E=R.rawDestructor,b=R.fields,F=b.map(W=>W.getterReturnType).concat(b.map(W=>W.setterArgumentType));kn([D],F,W=>{var H={};return b.forEach((Y,ee)=>{var se=Y.fieldName,ve=W[ee],Re=Y.getter,ke=Y.getterContext,Ie=W[ee+b.length],rt=Y.setter,et=Y.setterContext;H[se]={read:Lt=>ve.fromWireType(Re(ke,Lt)),write:(Lt,An)=>{var Xn=[];rt(et,Lt,Ie.toWireType(Xn,An)),xr(Xn)}}}),[{name:R.name,fromWireType:function(Y){var ee={};for(var se in H)ee[se]=H[se].read(Y);return E(Y),ee},toWireType:function(Y,ee){for(var se in H)if(!(se in ee))throw new TypeError('Missing field:  "'+se+'"');var ve=S();for(se in H)H[se].write(ve,ee[se]);return Y!==null&&Y.push(E,ve),ve},argPackAdvance:8,readValueFromPointer:Kr,destructorFunction:E}]})}function Lo(D,R,S,E,b){}function Zi(D){switch(D){case 1:return 0;case 2:return 1;case 4:return 2;case 8:return 3;default:throw new TypeError("Unknown type size: "+D)}}function wa(){for(var D=new Array(256),R=0;R<256;++R)D[R]=String.fromCharCode(R);Qi=D}var Qi=void 0;function dn(D){for(var R="",S=D;de[S];)R+=Qi[de[S++]];return R}var vi=void 0;function ht(D){throw new vi(D)}function Sr(D,R,S={}){if(!("argPackAdvance"in R))throw new TypeError("registerType registeredInstance requires argPackAdvance");var E=R.name;if(D||ht('type "'+E+'" must have a positive integer typeid pointer'),jn.hasOwnProperty(D)){if(S.ignoreDuplicateRegistrations)return;ht("Cannot register type '"+E+"' twice")}if(jn[D]=R,delete ja[D],zn.hasOwnProperty(D)){var b=zn[D];delete zn[D],b.forEach(F=>F())}}function Ji(D,R,S,E,b){var F=Zi(S);R=dn(R),Sr(D,{name:R,fromWireType:function(W){return!!W},toWireType:function(W,H){return H?E:b},argPackAdvance:8,readValueFromPointer:function(W){var H;if(S===1)H=J;else if(S===2)H=Q;else if(S===4)H=j;else throw new TypeError("Unknown boolean type size: "+R);return this.fromWireType(H[W>>F])},destructorFunction:null})}function Io(D){if(!(this instanceof Sn)||!(D instanceof Sn))return!1;for(var R=this.$$.ptrType.registeredClass,S=this.$$.ptr,E=D.$$.ptrType.registeredClass,b=D.$$.ptr;R.baseClass;)S=R.upcast(S),R=R.baseClass;for(;E.baseClass;)b=E.upcast(b),E=E.baseClass;return R===E&&S===b}function Xr(D){return{count:D.count,deleteScheduled:D.deleteScheduled,preservePointerOnDelete:D.preservePointerOnDelete,ptr:D.ptr,ptrType:D.ptrType,smartPtr:D.smartPtr,smartPtrType:D.smartPtrType}}function Yr(D){function R(S){return S.$$.ptrType.registeredClass.name}ht(R(D)+" instance already deleted")}var Zr=!1;function Pr(D){}function Pc(D){D.smartPtr?D.smartPtrType.rawDestructor(D.smartPtr):D.ptrType.registeredClass.rawDestructor(D.ptr)}function ea(D){D.count.value-=1;var R=D.count.value===0;R&&Pc(D)}function Qr(D,R,S){if(R===S)return D;if(S.baseClass===void 0)return null;var E=Qr(D,R,S.baseClass);return E===null?null:S.downcast(E)}var Ss={};function yi(){return Object.keys(ta).length}function Ka(){var D=[];for(var R in ta)ta.hasOwnProperty(R)&&D.push(ta[R]);return D}var Jr=[];function Pi(){for(;Jr.length;){var D=Jr.pop();D.$$.deleteScheduled=!1,D.delete()}}var xa=void 0;function Nc(D){xa=D,Jr.length&&xa&&xa(Pi)}function Ti(){a.getInheritedInstanceCount=yi,a.getLiveInheritedInstances=Ka,a.flushPendingDeletes=Pi,a.setDelayFunction=Nc}var ta={};function ei(D,R){for(R===void 0&&ht("ptr should not be undefined");D.baseClass;)R=D.upcast(R),D=D.baseClass;return R}function ti(D,R){return R=ei(D,R),ta[R]}function Ni(D,R){(!R.ptrType||!R.ptr)&&Je("makeClassHandle requires ptr and ptrType");var S=!!R.smartPtrType,E=!!R.smartPtr;return S!==E&&Je("Both smartPtrType and smartPtr must be specified"),R.count={value:1},ki(Object.create(D,{$$:{value:R}}))}function kc(D){var R=this.getPointee(D);if(!R)return this.destructor(D),null;var S=ti(this.registeredClass,R);if(S!==void 0){if(S.$$.count.value===0)return S.$$.ptr=R,S.$$.smartPtr=D,S.clone();var E=S.clone();return this.destructor(D),E}function b(){return this.isSmartPointer?Ni(this.registeredClass.instancePrototype,{ptrType:this.pointeeType,ptr:R,smartPtrType:this,smartPtr:D}):Ni(this.registeredClass.instancePrototype,{ptrType:this,ptr:D})}var F=this.registeredClass.getActualType(R),W=Ss[F];if(!W)return b.call(this);var H;this.isConst?H=W.constPointerType:H=W.pointerType;var Y=Qr(R,this.registeredClass,H.registeredClass);return Y===null?b.call(this):this.isSmartPointer?Ni(H.registeredClass.instancePrototype,{ptrType:H,ptr:Y,smartPtrType:this,smartPtr:D}):Ni(H.registeredClass.instancePrototype,{ptrType:H,ptr:Y})}function ki(D){return typeof FinalizationRegistry>"u"?(ki=R=>R,D):(Zr=new FinalizationRegistry(R=>{ea(R.$$)}),ki=R=>{var S=R.$$,E=!!S.smartPtr;if(E){var b={$$:S};Zr.register(R,b,R)}return R},Pr=R=>Zr.unregister(R),ki(D))}function Vo(){if(this.$$.ptr||Yr(this),this.$$.preservePointerOnDelete)return this.$$.count.value+=1,this;var D=ki(Object.create(Object.getPrototypeOf(this),{$$:{value:Xr(this.$$)}}));return D.$$.count.value+=1,D.$$.deleteScheduled=!1,D}function Ac(){this.$$.ptr||Yr(this),this.$$.deleteScheduled&&!this.$$.preservePointerOnDelete&&ht("Object already scheduled for deletion"),Pr(this),ea(this.$$),this.$$.preservePointerOnDelete||(this.$$.smartPtr=void 0,this.$$.ptr=void 0)}function Fc(){return!this.$$.ptr}function Uc(){return this.$$.ptr||Yr(this),this.$$.deleteScheduled&&!this.$$.preservePointerOnDelete&&ht("Object already scheduled for deletion"),Jr.push(this),Jr.length===1&&xa&&xa(Pi),this.$$.deleteScheduled=!0,this}function Bc(){Sn.prototype.isAliasOf=Io,Sn.prototype.clone=Vo,Sn.prototype.delete=Ac,Sn.prototype.isDeleted=Fc,Sn.prototype.deleteLater=Uc}function Sn(){}function Po(D,R,S){if(D[R].overloadTable===void 0){var E=D[R];D[R]=function(){return D[R].overloadTable.hasOwnProperty(arguments.length)||ht("Function '"+S+"' called with an invalid number of arguments ("+arguments.length+") - expects one of ("+D[R].overloadTable+")!"),D[R].overloadTable[arguments.length].apply(this,arguments)},D[R].overloadTable=[],D[R].overloadTable[E.argCount]=E}}function Nr(D,R,S){a.hasOwnProperty(D)?((S===void 0||a[D].overloadTable!==void 0&&a[D].overloadTable[S]!==void 0)&&ht("Cannot register public name '"+D+"' twice"),Po(a,D,D),a.hasOwnProperty(S)&&ht("Cannot register multiple overloads of a function with the same number of arguments ("+S+")!"),a[D].overloadTable[S]=R):(a[D]=R,S!==void 0&&(a[D].numArguments=S))}function ur(D,R,S,E,b,F,W,H){this.name=D,this.constructor=R,this.instancePrototype=S,this.rawDestructor=E,this.baseClass=b,this.getActualType=F,this.upcast=W,this.downcast=H,this.pureVirtualFunctions=[]}function qa(D,R,S){for(;R!==S;)R.upcast||ht("Expected null or instance of "+S.name+", got an instance of "+R.name),D=R.upcast(D),R=R.baseClass;return D}function Xa(D,R){if(R===null)return this.isReference&&ht("null is not a valid "+this.name),0;R.$$||ht('Cannot pass "'+Ja(R)+'" as a '+this.name),R.$$.ptr||ht("Cannot pass deleted object as a pointer of type "+this.name);var S=R.$$.ptrType.registeredClass,E=qa(R.$$.ptr,S,this.registeredClass);return E}function Sa(D,R){var S;if(R===null)return this.isReference&&ht("null is not a valid "+this.name),this.isSmartPointer?(S=this.rawConstructor(),D!==null&&D.push(this.rawDestructor,S),S):0;R.$$||ht('Cannot pass "'+Ja(R)+'" as a '+this.name),R.$$.ptr||ht("Cannot pass deleted object as a pointer of type "+this.name),!this.isConst&&R.$$.ptrType.isConst&&ht("Cannot convert argument of type "+(R.$$.smartPtrType?R.$$.smartPtrType.name:R.$$.ptrType.name)+" to parameter type "+this.name);var E=R.$$.ptrType.registeredClass;if(S=qa(R.$$.ptr,E,this.registeredClass),this.isSmartPointer)switch(R.$$.smartPtr===void 0&&ht("Passing raw pointer to smart pointer is illegal"),this.sharingPolicy){case 0:R.$$.smartPtrType===this?S=R.$$.smartPtr:ht("Cannot convert argument of type "+(R.$$.smartPtrType?R.$$.smartPtrType.name:R.$$.ptrType.name)+" to parameter type "+this.name);break;case 1:S=R.$$.smartPtr;break;case 2:if(R.$$.smartPtrType===this)S=R.$$.smartPtr;else{var b=R.clone();S=this.rawShare(S,Da.toHandle(function(){b.delete()})),D!==null&&D.push(this.rawDestructor,S)}break;default:ht("Unsupporting sharing policy")}return S}function pn(D,R){if(R===null)return this.isReference&&ht("null is not a valid "+this.name),0;R.$$||ht('Cannot pass "'+Ja(R)+'" as a '+this.name),R.$$.ptr||ht("Cannot pass deleted object as a pointer of type "+this.name),R.$$.ptrType.isConst&&ht("Cannot convert argument of type "+R.$$.ptrType.name+" to parameter type "+this.name);var S=R.$$.ptrType.registeredClass,E=qa(R.$$.ptr,S,this.registeredClass);return E}function Es(D){return this.rawGetPointee&&(D=this.rawGetPointee(D)),D}function Er(D){this.rawDestructor&&this.rawDestructor(D)}function Hn(D){D!==null&&D.delete()}function No(){Kn.prototype.getPointee=Es,Kn.prototype.destructor=Er,Kn.prototype.argPackAdvance=8,Kn.prototype.readValueFromPointer=Kr,Kn.prototype.deleteObject=Hn,Kn.prototype.fromWireType=kc}function Kn(D,R,S,E,b,F,W,H,Y,ee,se){this.name=D,this.registeredClass=R,this.isReference=S,this.isConst=E,this.isSmartPointer=b,this.pointeeType=F,this.sharingPolicy=W,this.rawGetPointee=H,this.rawConstructor=Y,this.rawShare=ee,this.rawDestructor=se,!b&&R.baseClass===void 0?E?(this.toWireType=Xa,this.destructorFunction=null):(this.toWireType=pn,this.destructorFunction=null):this.toWireType=Sa}function Ya(D,R,S){a.hasOwnProperty(D)||Je("Replacing nonexistant public symbol"),a[D].overloadTable!==void 0&&S!==void 0?a[D].overloadTable[S]=R:(a[D]=R,a[D].argCount=S)}function Za(D,R,S){var E=a["dynCall_"+D];return S&&S.length?E.apply(null,[R].concat(S)):E.call(null,R)}function Os(D,R,S){if(D.includes("j"))return Za(D,R,S);var E=Tt(R).apply(null,S);return E}function Ds(D,R){var S=[];return function(){return S.length=0,Object.assign(S,arguments),Os(D,R,S)}}function qn(D,R){D=dn(D);function S(){return D.includes("j")?Ds(D,R):Tt(R)}var E=S();return typeof E!="function"&&ht("unknown function pointer with signature "+D+": "+R),E}var fr=void 0;function Ea(D){var R=oe(D),S=dn(R);return K(R),S}function En(D,R){var S=[],E={};function b(F){if(!E[F]&&!jn[F]){if(ja[F]){ja[F].forEach(b);return}S.push(F),E[F]=!0}}throw R.forEach(b),new fr(D+": "+S.map(Ea).join([", "]))}function gr(D,R,S,E,b,F,W,H,Y,ee,se,ve,Re){se=dn(se),F=qn(b,F),H&&(H=qn(W,H)),ee&&(ee=qn(Y,ee)),Re=qn(ve,Re);var ke=qr(se);Nr(ke,function(){En("Cannot construct "+se+" due to unbound types",[E])}),kn([D,R,S],E?[E]:[],function(Ie){Ie=Ie[0];var rt,et;E?(rt=Ie.registeredClass,et=rt.instancePrototype):et=Sn.prototype;var Lt=He(ke,function(){if(Object.getPrototypeOf(this)!==An)throw new vi("Use 'new' to construct "+se);if(Xn.constructor_body===void 0)throw new vi(se+" has no accessible constructor");var sf=Xn.constructor_body[arguments.length];if(sf===void 0)throw new vi("Tried to invoke ctor of "+se+" with invalid number of parameters ("+arguments.length+") - expected ("+Object.keys(Xn.constructor_body).toString()+") parameters instead!");return sf.apply(this,arguments)}),An=Object.create(et,{constructor:{value:Lt}});Lt.prototype=An;var Xn=new ur(se,Lt,An,Re,rt,F,H,ee),o0=new Kn(se,Xn,!0,!1,!1),ra=new Kn(se+"*",Xn,!1,!1,!1),bd=new Kn(se+" const*",Xn,!1,!0,!1);return Ss[D]={pointerType:ra,constPointerType:bd},Ya(ke,Lt),[o0,ra,bd]})}function Qa(D,R){for(var S=[],E=0;E<D;E++)S.push(ie[R+E*4>>2]);return S}function Ci(D,R){if(!(D instanceof Function))throw new TypeError("new_ called with constructor type "+typeof D+" which is not a function");var S=He(D.name||"unknownFunctionName",function(){});S.prototype=D.prototype;var E=new S,b=D.apply(E,R);return b instanceof Object?b:E}function ko(D,R,S,E,b){var F=R.length;F<2&&ht("argTypes array size mismatch! Must at least get return value and 'this' types!");for(var W=R[1]!==null&&S!==null,H=!1,Y=1;Y<R.length;++Y)if(R[Y]!==null&&R[Y].destructorFunction===void 0){H=!0;break}for(var ee=R[0].name!=="void",se="",ve="",Y=0;Y<F-2;++Y)se+=(Y!==0?", ":"")+"arg"+Y,ve+=(Y!==0?", ":"")+"arg"+Y+"Wired";var Re="return function "+qr(D)+"("+se+`) {
if (arguments.length !== `+(F-2)+`) {
throwBindingError('function `+D+" called with ' + arguments.length + ' arguments, expected "+(F-2)+` args!');
}
`;H&&(Re+=`var destructors = [];
`);var ke=H?"destructors":"null",Ie=["throwBindingError","invoker","fn","runDestructors","retType","classParam"],rt=[ht,E,b,xr,R[0],R[1]];W&&(Re+="var thisWired = classParam.toWireType("+ke+`, this);
`);for(var Y=0;Y<F-2;++Y)Re+="var arg"+Y+"Wired = argType"+Y+".toWireType("+ke+", arg"+Y+"); // "+R[Y+2].name+`
`,Ie.push("argType"+Y),rt.push(R[Y+2]);if(W&&(ve="thisWired"+(ve.length>0?", ":"")+ve),Re+=(ee?"var rv = ":"")+"invoker(fn"+(ve.length>0?", ":"")+ve+`);
`,H)Re+=`runDestructors(destructors);
`;else for(var Y=W?1:2;Y<R.length;++Y){var et=Y===1?"thisWired":"arg"+(Y-2)+"Wired";R[Y].destructorFunction!==null&&(Re+=et+"_dtor("+et+"); // "+R[Y].name+`
`,Ie.push(et+"_dtor"),rt.push(R[Y].destructorFunction))}ee&&(Re+=`var ret = retType.fromWireType(rv);
return ret;
`),Re+=`}
`,Ie.push(Re);var Lt=Ci(Function,Ie).apply(null,rt);return Lt}function kr(D,R,S,E,b,F){M(R>0);var W=Qa(R,S);b=qn(E,b),kn([],[D],function(H){H=H[0];var Y="constructor "+H.name;if(H.registeredClass.constructor_body===void 0&&(H.registeredClass.constructor_body=[]),H.registeredClass.constructor_body[R-1]!==void 0)throw new vi("Cannot register multiple constructors with identical number of parameters ("+(R-1)+") for class '"+H.name+"'! Overload resolution is currently only performed using the parameter count, not actual type info!");return H.registeredClass.constructor_body[R-1]=()=>{En("Cannot construct "+H.name+" due to unbound types",W)},kn([],W,function(ee){return ee.splice(1,0,null),H.registeredClass.constructor_body[R-1]=ko(Y,ee,null,b,F),[]}),[]})}function wi(D,R,S,E,b,F,W,H){var Y=Qa(S,E);R=dn(R),F=qn(b,F),kn([],[D],function(ee){ee=ee[0];var se=ee.name+"."+R;R.startsWith("@@")&&(R=Symbol[R.substring(2)]),H&&ee.registeredClass.pureVirtualFunctions.push(R);function ve(){En("Cannot call "+se+" due to unbound types",Y)}var Re=ee.registeredClass.instancePrototype,ke=Re[R];return ke===void 0||ke.overloadTable===void 0&&ke.className!==ee.name&&ke.argCount===S-2?(ve.argCount=S-2,ve.className=ee.name,Re[R]=ve):(Po(Re,R,se),Re[R].overloadTable[S-2]=ve),kn([],Y,function(Ie){var rt=ko(se,Ie,ee,F,W);return Re[R].overloadTable===void 0?(rt.argCount=S-2,Re[R]=rt):Re[R].overloadTable[S-2]=rt,[]}),[]})}var Oa=[],tr=[{},{value:void 0},{value:null},{value:!0},{value:!1}];function Rs(D){D>4&&--tr[D].refcount===0&&(tr[D]=void 0,Oa.push(D))}function Gc(){for(var D=0,R=5;R<tr.length;++R)tr[R]!==void 0&&++D;return D}function $c(){for(var D=5;D<tr.length;++D)if(tr[D]!==void 0)return tr[D];return null}function Wc(){a.count_emval_handles=Gc,a.get_first_emval=$c}var Da={toValue:D=>(D||ht("Cannot use deleted val. handle = "+D),tr[D].value),toHandle:D=>{switch(D){case void 0:return 1;case null:return 2;case!0:return 3;case!1:return 4;default:{var R=Oa.length?Oa.pop():tr.length;return tr[R]={refcount:1,value:D},R}}}};function Ms(D,R){R=dn(R),Sr(D,{name:R,fromWireType:function(S){var E=Da.toValue(S);return Rs(S),E},toWireType:function(S,E){return Da.toHandle(E)},argPackAdvance:8,readValueFromPointer:Kr,destructorFunction:null})}function Ja(D){if(D===null)return"null";var R=typeof D;return R==="object"||R==="array"||R==="function"?D.toString():""+D}function zc(D,R){switch(R){case 2:return function(S){return this.fromWireType(ue[S>>2])};case 3:return function(S){return this.fromWireType(le[S>>3])};default:throw new TypeError("Unknown float type: "+D)}}function jc(D,R,S){var E=Zi(S);R=dn(R),Sr(D,{name:R,fromWireType:function(b){return b},toWireType:function(b,F){return F},argPackAdvance:8,readValueFromPointer:zc(R,E),destructorFunction:null})}function Hc(D,R,S,E,b,F){var W=Qa(R,S);D=dn(D),b=qn(E,b),Nr(D,function(){En("Cannot call "+D+" due to unbound types",W)},R-1),kn([],W,function(H){var Y=[H[0],null].concat(H.slice(1));return Ya(D,ko(D,Y,null,b,F),R-1),[]})}function Kc(D,R,S){switch(R){case 0:return S?function(b){return J[b]}:function(b){return de[b]};case 1:return S?function(b){return Q[b>>1]}:function(b){return q[b>>1]};case 2:return S?function(b){return j[b>>2]}:function(b){return ie[b>>2]};default:throw new TypeError("Unknown integer type: "+D)}}function qc(D,R,S,E,b){R=dn(R);var F=Zi(S),W=ve=>ve;if(E===0){var H=32-8*S;W=ve=>ve<<H>>>H}var Y=R.includes("unsigned"),ee=(ve,Re)=>{},se;Y?se=function(ve,Re){return ee(Re,this.name),Re>>>0}:se=function(ve,Re){return ee(Re,this.name),Re},Sr(D,{name:R,fromWireType:W,toWireType:se,argPackAdvance:8,readValueFromPointer:Kc(R,F,E!==0),destructorFunction:null})}function Xc(D,R,S){var E=[Int8Array,Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array],b=E[R];function F(W){W=W>>2;var H=ie,Y=H[W],ee=H[W+1];return new b(ce,ee,Y)}S=dn(S),Sr(D,{name:S,fromWireType:F,argPackAdvance:8,readValueFromPointer:F},{ignoreDuplicateRegistrations:!0})}function Yc(D,R){R=dn(R);var S=R==="std::string";Sr(D,{name:R,fromWireType:function(E){var b=ie[E>>2],F=E+4,W;if(S)for(var H=F,Y=0;Y<=b;++Y){var ee=F+Y;if(Y==b||de[ee]==0){var se=ee-H,ve=k(H,se);W===void 0?W=ve:(W+="\0",W+=ve),H=ee+1}}else{for(var Re=new Array(b),Y=0;Y<b;++Y)Re[Y]=String.fromCharCode(de[F+Y]);W=Re.join("")}return K(E),W},toWireType:function(E,b){b instanceof ArrayBuffer&&(b=new Uint8Array(b));var F,W=typeof b=="string";W||b instanceof Uint8Array||b instanceof Uint8ClampedArray||b instanceof Int8Array||ht("Cannot pass non-string to std::string"),S&&W?F=Z(b):F=b.length;var H=V(4+F+1),Y=H+4;if(ie[H>>2]=F,S&&W)X(b,Y,F+1);else if(W)for(var ee=0;ee<F;++ee){var se=b.charCodeAt(ee);se>255&&(K(Y),ht("String has UTF-16 code units that do not fit in 8 bits")),de[Y+ee]=se}else for(var ee=0;ee<F;++ee)de[Y+ee]=b[ee];return E!==null&&E.push(K,H),H},argPackAdvance:8,readValueFromPointer:Kr,destructorFunction:function(E){K(E)}})}var _s=typeof TextDecoder<"u"?new TextDecoder("utf-16le"):void 0;function Zc(D,R){for(var S=D,E=S>>1,b=E+R/2;!(E>=b)&&q[E];)++E;if(S=E<<1,S-D>32&&_s)return _s.decode(de.subarray(D,S));for(var F="",W=0;!(W>=R/2);++W){var H=Q[D+W*2>>1];if(H==0)break;F+=String.fromCharCode(H)}return F}function Qc(D,R,S){if(S===void 0&&(S=2147483647),S<2)return 0;S-=2;for(var E=R,b=S<D.length*2?S/2:D.length,F=0;F<b;++F){var W=D.charCodeAt(F);Q[R>>1]=W,R+=2}return Q[R>>1]=0,R-E}function bs(D){return D.length*2}function Ls(D,R){for(var S=0,E="";!(S>=R/4);){var b=j[D+S*4>>2];if(b==0)break;if(++S,b>=65536){var F=b-65536;E+=String.fromCharCode(55296|F>>10,56320|F&1023)}else E+=String.fromCharCode(b)}return E}function Jc(D,R,S){if(S===void 0&&(S=2147483647),S<4)return 0;for(var E=R,b=E+S-4,F=0;F<D.length;++F){var W=D.charCodeAt(F);if(W>=55296&&W<=57343){var H=D.charCodeAt(++F);W=65536+((W&1023)<<10)|H&1023}if(j[R>>2]=W,R+=4,R+4>b)break}return j[R>>2]=0,R-E}function Ao(D){for(var R=0,S=0;S<D.length;++S){var E=D.charCodeAt(S);E>=55296&&E<=57343&&++S,R+=4}return R}function Is(D,R,S){S=dn(S);var E,b,F,W,H;R===2?(E=Zc,b=Qc,W=bs,F=()=>q,H=1):R===4&&(E=Ls,b=Jc,W=Ao,F=()=>ie,H=2),Sr(D,{name:S,fromWireType:function(Y){for(var ee=ie[Y>>2],se=F(),ve,Re=Y+4,ke=0;ke<=ee;++ke){var Ie=Y+4+ke*R;if(ke==ee||se[Ie>>H]==0){var rt=Ie-Re,et=E(Re,rt);ve===void 0?ve=et:(ve+="\0",ve+=et),Re=Ie+R}}return K(Y),ve},toWireType:function(Y,ee){typeof ee!="string"&&ht("Cannot pass non-string to C++ string type "+S);var se=W(ee),ve=V(4+se+R);return ie[ve>>2]=se>>H,b(ee,ve+4,se+R),Y!==null&&Y.push(K,ve),ve},argPackAdvance:8,readValueFromPointer:Kr,destructorFunction:function(Y){K(Y)}})}function Vs(D,R,S,E,b,F){wr[D]={name:dn(R),rawConstructor:qn(S,E),rawDestructor:qn(b,F),fields:[]}}function Fo(D,R,S,E,b,F,W,H,Y,ee){wr[D].fields.push({fieldName:dn(R),getterReturnType:S,getter:qn(E,b),getterContext:F,setterArgumentType:W,setter:qn(H,Y),setterContext:ee})}function e0(D,R){R=dn(R),Sr(D,{isVoid:!0,name:R,argPackAdvance:0,fromWireType:function(){},toWireType:function(S,E){}})}function Ps(D){D>4&&(tr[D].refcount+=1)}function t0(D,R){var S=jn[D];return S===void 0&&ht(R+" has unknown type "+Ea(D)),S}function Ns(D,R){D=t0(D,"_emval_take_value");var S=D.readValueFromPointer(R);return Da.toHandle(S)}function n0(){Hr("")}function r0(D,R,S){de.copyWithin(D,R,R+S)}function i0(){return 2147483648}function a0(D){try{return x.grow(D-ce.byteLength+65535>>>16),Fe(x.buffer),1}catch{}}function Uo(D){var R=de.length;D=D>>>0;var S=i0();if(D>S)return!1;let E=(Y,ee)=>Y+(ee-Y%ee)%ee;for(var b=1;b<=4;b*=2){var F=R*(1+.2/b);F=Math.min(F,D+100663296);var W=Math.min(S,E(Math.max(D,F),65536)),H=a0(W);if(H)return!0}return!1}function Bo(D){return 52}function Ai(D,R,S,E,b){return 70}var na=[null,[],[]];function ni(D,R){var S=na[D];R===0||R===10?((D===1?T:C)(_(S,0)),S.length=0):S.push(R)}function ks(D,R,S,E){for(var b=0,F=0;F<S;F++){var W=ie[R>>2],H=ie[R+4>>2];R+=8;for(var Y=0;Y<H;Y++)ni(D,de[W+Y]);b+=H}return ie[E>>2]=b,0}function As(D){return D}function Go(D){var R=a["_"+D];return R}function Fs(D,R){J.set(D,R)}function eo(D,R,S,E,b){var F={string:Ie=>{var rt=0;if(Ie!=null&&Ie!==0){var et=(Ie.length<<2)+1;rt=pe(et),X(Ie,rt,et)}return rt},array:Ie=>{var rt=pe(Ie.length);return Fs(Ie,rt),rt}};function W(Ie){return R==="string"?k(Ie):R==="boolean"?!!Ie:Ie}var H=Go(D),Y=[],ee=0;if(E)for(var se=0;se<E.length;se++){var ve=F[S[se]];ve?(ee===0&&(ee=ye()),Y[se]=ve(E[se])):Y[se]=E[se]}var Re=H.apply(null,Y);function ke(Ie){return ee!==0&&Te(ee),W(Ie)}return Re=ke(Re),Re}st=a.InternalError=xt(Error,"InternalError"),wa(),vi=a.BindingError=xt(Error,"BindingError"),Bc(),Ti(),No(),fr=a.UnboundTypeError=xt(Error,"UnboundTypeError"),Wc();var Us={L:At,v:lr,c:_o,k:Ca,i:Yi,f:Xi,A:bo,D:Lo,I:Ji,y:gr,x:kr,a:wi,H:Ms,u:jc,o:Hc,h:qc,d:Xc,t:Yc,q:Is,p:Vs,B:Fo,J:e0,N:Rs,O:Ps,n:Ns,r:n0,G:r0,E:Uo,F:Bo,C:Ai,s:ks,b:ze,z:Ue,w:fe,e:I,l:re,m:L,j:G,K:Se,g:qe,M:As};xe(),a.___wasm_call_ctors=function(){return(a.___wasm_call_ctors=a.asm.Q).apply(null,arguments)};var V=a._malloc=function(){return(V=a._malloc=a.asm.R).apply(null,arguments)},N=a.___cxa_free_exception=function(){return(N=a.___cxa_free_exception=a.asm.S).apply(null,arguments)},K=a._free=function(){return(K=a._free=a.asm.U).apply(null,arguments)},oe=a.___getTypeName=function(){return(oe=a.___getTypeName=a.asm.V).apply(null,arguments)};a.__embind_initialize_bindings=function(){return(a.__embind_initialize_bindings=a.asm.W).apply(null,arguments)};var ge=a.setTempRet0=function(){return(ge=a.setTempRet0=a.asm.X).apply(null,arguments)},ye=a.stackSave=function(){return(ye=a.stackSave=a.asm.Y).apply(null,arguments)},Te=a.stackRestore=function(){return(Te=a.stackRestore=a.asm.Z).apply(null,arguments)},pe=a.stackAlloc=function(){return(pe=a.stackAlloc=a.asm._).apply(null,arguments)},we=a.___cxa_can_catch=function(){return(we=a.___cxa_can_catch=a.asm.$).apply(null,arguments)},be=a.___cxa_is_pointer_type=function(){return(be=a.___cxa_is_pointer_type=a.asm.aa).apply(null,arguments)};a.dynCall_ji=function(){return(a.dynCall_ji=a.asm.ba).apply(null,arguments)},a.dynCall_iiji=function(){return(a.dynCall_iiji=a.asm.ca).apply(null,arguments)},a.dynCall_jiji=function(){return(a.dynCall_jiji=a.asm.da).apply(null,arguments)};function Ue(D,R,S){var E=ye();try{return Tt(D)(R,S)}catch(b){if(Te(E),b!==b+0)throw b;_setThrew(1,0)}}function ze(D,R){var S=ye();try{return Tt(D)(R)}catch(E){if(Te(S),E!==E+0)throw E;_setThrew(1,0)}}function qe(D,R,S,E,b,F,W,H,Y,ee,se){var ve=ye();try{Tt(D)(R,S,E,b,F,W,H,Y,ee,se)}catch(Re){if(Te(ve),Re!==Re+0)throw Re;_setThrew(1,0)}}function I(D,R){var S=ye();try{Tt(D)(R)}catch(E){if(Te(S),E!==E+0)throw E;_setThrew(1,0)}}function L(D,R,S,E){var b=ye();try{Tt(D)(R,S,E)}catch(F){if(Te(b),F!==F+0)throw F;_setThrew(1,0)}}function G(D,R,S,E,b){var F=ye();try{Tt(D)(R,S,E,b)}catch(W){if(Te(F),W!==W+0)throw W;_setThrew(1,0)}}function re(D,R,S){var E=ye();try{Tt(D)(R,S)}catch(b){if(Te(E),b!==b+0)throw b;_setThrew(1,0)}}function fe(D,R,S,E){var b=ye();try{return Tt(D)(R,S,E)}catch(F){if(Te(b),F!==F+0)throw F;_setThrew(1,0)}}function Se(D,R,S,E,b,F,W){var H=ye();try{Tt(D)(R,S,E,b,F,W)}catch(Y){if(Te(H),Y!==Y+0)throw Y;_setThrew(1,0)}}a.ccall=eo;var Ce;Pn=function D(){Ce||me(),Ce||(Pn=D)};function me(D){if($t>0||(_t(),$t>0))return;function R(){Ce||(Ce=!0,a.calledRun=!0,!O&&(Ke(),o(a),a.onRuntimeInitialized&&a.onRuntimeInitialized(),Ye()))}a.setStatus?(a.setStatus("Running..."),setTimeout(function(){setTimeout(function(){a.setStatus("")},1),R()},1)):R()}if(a.preInit)for(typeof a.preInit=="function"&&(a.preInit=[a.preInit]);a.preInit.length>0;)a.preInit.pop()();return me(),a.ready}})();t.exports=n})(a_);var Xne=a_.exports;const Yne=Eo(Xne),Zne=new URL("/dicom-viewer/assets/openjphjs-CANpALFP.wasm",import.meta.url),Hf={codec:void 0,decoder:void 0,decodeConfig:{}};function Qne(t,e,n){const r={width:e,height:n};for(;t>0;)r.width=Math.ceil(r.width/2),r.height=Math.ceil(r.height/2),t--;return r}function Jne(t){if(Hf.decodeConfig=t,Hf.codec)return Promise.resolve();const e=Yne({locateFile:n=>n.endsWith(".wasm")?Zne.toString():n});return new Promise((n,r)=>{e.then(i=>{Hf.codec=i,Hf.decoder=new i.HTJ2KDecoder,n()},r)})}async function ere(t,e){await Jne();const n=new Hf.codec.HTJ2KDecoder,r=n.getEncodedBuffer(t.length);r.set(t);const i=e.decodeLevel||0;n.decodeSubResolution(i);const a=n.getFrameInfo();if(e.decodeLevel>0){const{width:A,height:_}=Qne(e.decodeLevel,a.width,a.height);a.width=A,a.height=_}const o=n.getDecodedBuffer();new Uint8Array(o.length).set(o);const c=`x: ${n.getImageOffset().x}, y: ${n.getImageOffset().y}`,l=n.getNumDecompositions(),f=n.getNumLayers(),u=["unknown","LRCP","RLCP","RPCL","PCRL","CPRL"][n.getProgressionOrder()+1],g=n.getIsReversible(),d=`${n.getBlockDimensions().width} x ${n.getBlockDimensions().height}`,h=`${n.getTileSize().width} x ${n.getTileSize().height}`,p=`${n.getTileOffset().x}, ${n.getTileOffset().y}`,m=`${o.length.toLocaleString()} bytes`,v=`${(o.length/r.length).toFixed(2)}:1`,y={columns:a.width,rows:a.height,bitsPerPixel:a.bitsPerSample,signed:a.isSigned,bytesPerPixel:e.bytesPerPixel,componentsPerPixel:a.componentCount};let T=tre(a,o);const{buffer:C,byteOffset:w,byteLength:x}=T,O=C.slice(w,w+x);T=new T.constructor(O);const M={imageOffset:c,numDecompositions:l,numLayers:f,progessionOrder:u,reversible:g,blockDimensions:d,tileSize:h,tileOffset:p,decodedSize:m,compressionRatio:v};return{...e,pixelData:T,imageInfo:y,encodeOptions:M,...M,...y}}function tre(t,e){return t.bitsPerSample>8?t.isSigned?new Int16Array(e.buffer,e.byteOffset,e.byteLength/2):new Uint16Array(e.buffer,e.byteOffset,e.byteLength/2):t.isSigned?new Int8Array(e.buffer,e.byteOffset,e.byteLength):new Uint8Array(e.buffer,e.byteOffset,e.byteLength)}function nre(t,e){const n=t.length,{rescaleSlope:r,rescaleIntercept:i,suvbw:a}=e;if(e.modality==="PT"&&typeof a=="number"&&!isNaN(a))for(let o=0;o<n;o++)t[o]=a*(t[o]*r+i);else for(let o=0;o<n;o++)t[o]=t[o]*r+i;return!0}const rre={bilinear:Tne,replicate:Cne},CT={Uint8Array,Uint16Array,Int16Array,Float32Array};function ire(t,e,n,r){var y,T,C;const i=t.pixelRepresentation!==void 0&&t.pixelRepresentation===1,a=i&&t.bitsStored!==void 0?32-t.bitsStored:void 0;if(i&&a!==void 0)for(let w=0;w<t.pixelData.length;w++)t.pixelData[w]=t.pixelData[w]<<a>>a;let o=t.pixelData;t.pixelDataLength=t.pixelData.length;const{min:s,max:c}=jy(t.pixelData),l=typeof e.allowFloatRendering<"u"?e.allowFloatRendering:!0;let f=HM(t.photometricInterpretation)&&((y=e.targetBuffer)==null?void 0:y.offset)===void 0;const g=((T=e.preScale)==null?void 0:T.enabled)&&Object.values(e.preScale.scalingParameters).some(w=>typeof w=="number"&&!Number.isInteger(w)),d=!e.preScale.enabled||!l&&g,h=(C=e.targetBuffer)==null?void 0:C.type;if(h&&e.preScale.enabled&&!d){const{rescaleSlope:w,rescaleIntercept:x}=e.preScale.scalingParameters,O=w*s+x,M=w*c+x;f=!Ate(O,M,CT[h])}h&&!f?o=are(e,t,CT,o):e.preScale.enabled&&!d?o=ore(e,s,c,t):o=o_(s,c,t);let p=s,m=c;if(e.preScale.enabled&&!d){const w=e.preScale.scalingParameters;s_(w);const{rescaleSlope:x,rescaleIntercept:O}=w;if(typeof x=="number"&&typeof O=="number"){nre(o,w),t.preScale={...e.preScale,scaled:!0};const{rescaleIntercept:A,rescaleSlope:_,suvbw:k}=w;p=_*s+A,m=_*c+A,k&&(p=p*k,m=m*k)}}else d&&(t.preScale={enabled:!0,scaled:!1},p=s,m=c);t.pixelData=o,t.smallestPixelValue=p,t.largestPixelValue=m;const v=new Date().getTime();return t.decodeTimeInMS=v-n,t}function are(t,e,n,r){const{arrayBuffer:i,type:a,offset:o=0,length:s,rows:c}=t.targetBuffer,l=n[a];if(!l)throw new Error(`target array ${a} is not supported, or doesn't exist.`);c&&c!=e.rows&&cre(e,t.targetBuffer,l);const f=e.pixelDataLength,u=o,g=s??f-u,d=e.pixelData;if(g!==d.length)throw new Error(`target array for image does not have the same length (${g}) as the decoded image length (${d.length}).`);const h=i?new l(i,u,g):new l(g);return h.set(d,0),r=h,r}function ore(t,e,n,r){const i=t.preScale.scalingParameters;s_(i);const{rescaleSlope:a,rescaleIntercept:o}=i,s=typeof a=="number"&&typeof o=="number";let c=e,l=n;return s&&(c=a*e+o,l=a*n+o),o_(c,l,r)}function o_(t,e,n){const r=Hy(t,e),i=new r(n.pixelData.length);return i.set(n.pixelData,0),i}function s_(t){if(!t)throw new Error("options.preScale.scalingParameters must be defined if preScale.enabled is true, and scalingParameters cannot be derived from the metadata providers.")}function sre(t,e,n){const{samplesPerPixel:r}=t,{rows:i,columns:a}=e,o=i*a*r,s=new n(o),c=s.byteLength/o;return{pixelData:s,rows:i,columns:a,frameInfo:{...t.frameInfo,rows:i,columns:a},imageInfo:{...t.imageInfo,rows:i,columns:a,bytesPerPixel:c}}}function cre(t,e,n){const r=sre(t,e,n),{scalingType:i="replicate"}=e;return rre[i](t,r),Object.assign(t,r),t.pixelDataLength=t.pixelData.length,t}async function lre(t,e,n,r,i,a){const o=new Date().getTime();let s=null,c;switch(e){case"1.2.840.10008.1.2":case"1.2.840.10008.1.2.1":s=hT(t,n);break;case"1.2.840.10008.1.2.2":s=xne(t,n);break;case"1.2.840.10008.1.2.1.99":s=hT(t,n);break;case"1.2.840.10008.1.2.5":s=Sne(t,n);break;case"1.2.840.10008.1.2.4.50":c={...t},s=Lne(n,c);break;case"1.2.840.10008.1.2.4.51":s=kne(t,n);break;case"1.2.840.10008.1.2.4.57":s=vT(t,n);break;case"1.2.840.10008.1.2.4.70":s=vT(t,n);break;case"1.2.840.10008.1.2.4.80":c={signed:t.pixelRepresentation===1,bytesPerPixel:t.bitsAllocated<=8?1:2,...t},s=yT(n,c);break;case"1.2.840.10008.1.2.4.81":c={signed:t.pixelRepresentation===1,bytesPerPixel:t.bitsAllocated<=8?1:2,...t},s=yT(n,c);break;case"1.2.840.10008.1.2.4.90":c={...t},s=TT(n,c);break;case"1.2.840.10008.1.2.4.91":c={...t},s=TT(n,c);break;case"3.2.840.10008.1.2.4.96":case"1.2.840.10008.1.2.4.201":case"1.2.840.10008.1.2.4.202":case"1.2.840.10008.1.2.4.203":c={...t},s=ere(n,c);break;default:throw new Error(`no decoder for transfer syntax ${e}`)}if(!s)throw new Error("decodePromise not defined");const l=await s,f=ire(l,i,o);return a==null||a(f),f}const ure={decodeTask({imageFrame:t,transferSyntax:e,decodeConfig:n,options:r,pixelData:i,callbackFn:a}){return lre(t,e,i,n,r,a)}};ly(ure);async function fre(t){return[`wadouri:${t}`]}var cs;(function(t){t[t.Primary=1]="Primary",t[t.Secondary=2]="Secondary",t[t.Primary_And_Secondary=3]="Primary_And_Secondary",t[t.Auxiliary=4]="Auxiliary",t[t.Primary_And_Auxiliary=5]="Primary_And_Auxiliary",t[t.Secondary_And_Auxiliary=6]="Secondary_And_Auxiliary",t[t.Primary_And_Secondary_And_Auxiliary=7]="Primary_And_Secondary_And_Auxiliary",t[t.Fourth_Button=8]="Fourth_Button",t[t.Fifth_Button=16]="Fifth_Button",t[t.Wheel=524288]="Wheel",t[t.Wheel_Primary=524289]="Wheel_Primary"})(cs||(cs={}));var Ei;(function(t){t[t.Shift=16]="Shift",t[t.Ctrl=17]="Ctrl",t[t.Alt=18]="Alt",t[t.Meta=91]="Meta",t[t.ShiftCtrl=1617]="ShiftCtrl",t[t.ShiftAlt=1618]="ShiftAlt",t[t.ShiftMeta=1691]="ShiftMeta",t[t.CtrlAlt=1718]="CtrlAlt",t[t.CtrlMeta=1791]="CtrlMeta",t[t.AltMeta=1891]="AltMeta"})(Ei||(Ei={}));var Yt;(function(t){t.Active="Active",t.Passive="Passive",t.Enabled="Enabled",t.Disabled="Disabled"})(Yt||(Yt={}));var ic;(function(t){t.Default="",t.Highlighted="Highlighted",t.Selected="Selected",t.Locked="Locked",t.AutoGenerated="AutoGenerated"})(ic||(ic={}));var he;(function(t){t.TOOL_ACTIVATED="CORNERSTONE_TOOLS_TOOL_ACTIVATED",t.TOOLGROUP_VIEWPORT_ADDED="CORNERSTONE_TOOLS_TOOLGROUP_VIEWPORT_ADDED",t.TOOLGROUP_VIEWPORT_REMOVED="CORNERSTONE_TOOLS_TOOLGROUP_VIEWPORT_REMOVED",t.TOOL_MODE_CHANGED="CORNERSTONE_TOOLS_TOOL_MODE_CHANGED",t.ANNOTATION_ADDED="CORNERSTONE_TOOLS_ANNOTATION_ADDED",t.ANNOTATION_COMPLETED="CORNERSTONE_TOOLS_ANNOTATION_COMPLETED",t.ANNOTATION_MODIFIED="CORNERSTONE_TOOLS_ANNOTATION_MODIFIED",t.ANNOTATION_REMOVED="CORNERSTONE_TOOLS_ANNOTATION_REMOVED",t.ANNOTATION_SELECTION_CHANGE="CORNERSTONE_TOOLS_ANNOTATION_SELECTION_CHANGE",t.ANNOTATION_LOCK_CHANGE="CORNERSTONE_TOOLS_ANNOTATION_LOCK_CHANGE",t.ANNOTATION_VISIBILITY_CHANGE="CORNERSTONE_TOOLS_ANNOTATION_VISIBILITY_CHANGE",t.ANNOTATION_RENDERED="CORNERSTONE_TOOLS_ANNOTATION_RENDERED",t.ANNOTATION_INTERPOLATION_PROCESS_COMPLETED="CORNERSTONE_TOOLS_ANNOTATION_INTERPOLATION_PROCESS_COMPLETED",t.INTERPOLATED_ANNOTATIONS_REMOVED="CORNERSTONE_TOOLS_INTERPOLATED_ANNOTATIONS_REMOVED",t.SEGMENTATION_MODIFIED="CORNERSTONE_TOOLS_SEGMENTATION_MODIFIED",t.SEGMENTATION_RENDERED="CORNERSTONE_TOOLS_SEGMENTATION_RENDERED",t.SEGMENTATION_REPRESENTATION_ADDED="CORNERSTONE_TOOLS_SEGMENTATION_REPRESENTATION_ADDED",t.SEGMENTATION_ADDED="CORNERSTONE_TOOLS_SEGMENTATION_ADDED",t.SEGMENTATION_REPRESENTATION_MODIFIED="CORNERSTONE_TOOLS_SEGMENTATION_REPRESENTATION_MODIFIED",t.SEGMENTATION_REMOVED="CORNERSTONE_TOOLS_SEGMENTATION_REMOVED",t.SEGMENTATION_REPRESENTATION_REMOVED="CORNERSTONE_TOOLS_SEGMENTATION_REPRESENTATION_REMOVED",t.SEGMENTATION_DATA_MODIFIED="CORNERSTONE_TOOLS_SEGMENTATION_DATA_MODIFIED",t.KEY_DOWN="CORNERSTONE_TOOLS_KEY_DOWN",t.KEY_UP="CORNERSTONE_TOOLS_KEY_UP",t.MOUSE_DOWN="CORNERSTONE_TOOLS_MOUSE_DOWN",t.MOUSE_UP="CORNERSTONE_TOOLS_MOUSE_UP",t.MOUSE_DOWN_ACTIVATE="CORNERSTONE_TOOLS_MOUSE_DOWN_ACTIVATE",t.MOUSE_DRAG="CORNERSTONE_TOOLS_MOUSE_DRAG",t.MOUSE_MOVE="CORNERSTONE_TOOLS_MOUSE_MOVE",t.MOUSE_CLICK="CORNERSTONE_TOOLS_MOUSE_CLICK",t.MOUSE_DOUBLE_CLICK="CORNERSTONE_TOOLS_MOUSE_DOUBLE_CLICK",t.MOUSE_WHEEL="CORNERSTONE_TOOLS_MOUSE_WHEEL",t.TOUCH_START="CORNERSTONE_TOOLS_TOUCH_START",t.TOUCH_START_ACTIVATE="CORNERSTONE_TOOLS_TOUCH_START_ACTIVATE",t.TOUCH_PRESS="CORNERSTONE_TOOLS_TOUCH_PRESS",t.TOUCH_DRAG="CORNERSTONE_TOOLS_TOUCH_DRAG",t.TOUCH_END="CORNERSTONE_TOOLS_TOUCH_END",t.TOUCH_TAP="CORNERSTONE_TOOLS_TAP",t.TOUCH_SWIPE="CORNERSTONE_TOOLS_SWIPE"})(he||(he={}));var je;(function(t){t.Labelmap="Labelmap",t.Contour="Contour",t.Surface="Surface"})(je||(je={}));var Kl;(function(t){t.UP="UP",t.DOWN="DOWN",t.LEFT="LEFT",t.RIGHT="RIGHT"})(Kl||(Kl={}));var ys;(function(t){t.Interaction="Interaction",t.HandlesUpdated="HandlesUpdated",t.StatsUpdated="StatsUpdated",t.InitialSetup="InitialSetup",t.Completed="Completed",t.InterpolationUpdated="InterpolationUpdated",t.History="History",t.MetadataReferenceModified="MetadataReferenceModified"})(ys||(ys={}));var nl;(function(t){t.POLYSEG_CONTOUR_TO_LABELMAP="Converting Contour to Labelmap",t.POLYSEG_SURFACE_TO_LABELMAP="Converting Surfaces to Labelmap",t.POLYSEG_CONTOUR_TO_SURFACE="Converting Contour to Surface",t.POLYSEG_LABELMAP_TO_SURFACE="Converting Labelmap to Surface",t.SURFACE_CLIPPING="Clipping Surfaces"})(nl||(nl={}));let gre={},$e={isInteractingWithTool:!1,isMultiPartToolActive:!1,tools:{},toolGroups:[],synchronizers:[],svgNodeCache:gre,enabledElements:[]};var dre="Expected a function",c_="__lodash_hash_undefined__",pre="[object Function]",hre="[object GeneratorFunction]",mre="[object Symbol]",vre=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,yre=/^\w*$/,Tre=/^\./,Cre=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,wre=/[\\^$.*+?()[\]{}|]/g,xre=/\\(\\)?/g,Sre=/^\[object .+?Constructor\]$/,Ere=typeof Rr=="object"&&Rr&&Rr.Object===Object&&Rr,Ore=typeof self=="object"&&self&&self.Object===Object&&self,Xy=Ere||Ore||Function("return this")();function Dre(t,e){return t==null?void 0:t[e]}function Rre(t){var e=!1;if(t!=null&&typeof t.toString!="function")try{e=!!(t+"")}catch{}return e}var Mre=Array.prototype,_re=Function.prototype,l_=Object.prototype,am=Xy["__core-js_shared__"],wT=function(){var t=/[^.]+$/.exec(am&&am.keys&&am.keys.IE_PROTO||"");return t?"Symbol(src)_1."+t:""}(),u_=_re.toString,Yy=l_.hasOwnProperty,f_=l_.toString,bre=RegExp("^"+u_.call(Yy).replace(wre,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),xT=Xy.Symbol,Lre=Mre.splice,Ire=g_(Xy,"Map"),Yg=g_(Object,"create"),ST=xT?xT.prototype:void 0,ET=ST?ST.toString:void 0;function rl(t){var e=-1,n=t?t.length:0;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}function Vre(){this.__data__=Yg?Yg(null):{}}function Pre(t){return this.has(t)&&delete this.__data__[t]}function Nre(t){var e=this.__data__;if(Yg){var n=e[t];return n===c_?void 0:n}return Yy.call(e,t)?e[t]:void 0}function kre(t){var e=this.__data__;return Yg?e[t]!==void 0:Yy.call(e,t)}function Are(t,e){var n=this.__data__;return n[t]=Yg&&e===void 0?c_:e,this}rl.prototype.clear=Vre;rl.prototype.delete=Pre;rl.prototype.get=Nre;rl.prototype.has=kre;rl.prototype.set=Are;function rf(t){var e=-1,n=t?t.length:0;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}function Fre(){this.__data__=[]}function Ure(t){var e=this.__data__,n=P2(e,t);if(n<0)return!1;var r=e.length-1;return n==r?e.pop():Lre.call(e,n,1),!0}function Bre(t){var e=this.__data__,n=P2(e,t);return n<0?void 0:e[n][1]}function Gre(t){return P2(this.__data__,t)>-1}function $re(t,e){var n=this.__data__,r=P2(n,t);return r<0?n.push([t,e]):n[r][1]=e,this}rf.prototype.clear=Fre;rf.prototype.delete=Ure;rf.prototype.get=Bre;rf.prototype.has=Gre;rf.prototype.set=$re;function pl(t){var e=-1,n=t?t.length:0;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}function Wre(){this.__data__={hash:new rl,map:new(Ire||rf),string:new rl}}function zre(t){return N2(this,t).delete(t)}function jre(t){return N2(this,t).get(t)}function Hre(t){return N2(this,t).has(t)}function Kre(t,e){return N2(this,t).set(t,e),this}pl.prototype.clear=Wre;pl.prototype.delete=zre;pl.prototype.get=jre;pl.prototype.has=Hre;pl.prototype.set=Kre;function P2(t,e){for(var n=t.length;n--;)if(iie(t[n][0],e))return n;return-1}function qre(t,e){e=Qre(e,t)?[e]:Zre(e);for(var n=0,r=e.length;t!=null&&n<r;)t=t[nie(e[n++])];return n&&n==r?t:void 0}function Xre(t){if(!p_(t)||eie(t))return!1;var e=aie(t)||Rre(t)?bre:Sre;return e.test(rie(t))}function Yre(t){if(typeof t=="string")return t;if(Qy(t))return ET?ET.call(t):"";var e=t+"";return e=="0"&&1/t==-1/0?"-0":e}function Zre(t){return d_(t)?t:tie(t)}function N2(t,e){var n=t.__data__;return Jre(e)?n[typeof e=="string"?"string":"hash"]:n.map}function g_(t,e){var n=Dre(t,e);return Xre(n)?n:void 0}function Qre(t,e){if(d_(t))return!1;var n=typeof t;return n=="number"||n=="symbol"||n=="boolean"||t==null||Qy(t)?!0:yre.test(t)||!vre.test(t)||e!=null&&t in Object(e)}function Jre(t){var e=typeof t;return e=="string"||e=="number"||e=="symbol"||e=="boolean"?t!=="__proto__":t===null}function eie(t){return!!wT&&wT in t}var tie=Zy(function(t){t=sie(t);var e=[];return Tre.test(t)&&e.push(""),t.replace(Cre,function(n,r,i,a){e.push(i?a.replace(xre,"$1"):r||n)}),e});function nie(t){if(typeof t=="string"||Qy(t))return t;var e=t+"";return e=="0"&&1/t==-1/0?"-0":e}function rie(t){if(t!=null){try{return u_.call(t)}catch{}try{return t+""}catch{}}return""}function Zy(t,e){if(typeof t!="function"||e&&typeof e!="function")throw new TypeError(dre);var n=function(){var r=arguments,i=e?e.apply(this,r):r[0],a=n.cache;if(a.has(i))return a.get(i);var o=t.apply(this,r);return n.cache=a.set(i,o),o};return n.cache=new(Zy.Cache||pl),n}Zy.Cache=pl;function iie(t,e){return t===e||t!==t&&e!==e}var d_=Array.isArray;function aie(t){var e=p_(t)?f_.call(t):"";return e==pre||e==hre}function p_(t){var e=typeof t;return!!t&&(e=="object"||e=="function")}function oie(t){return!!t&&typeof t=="object"}function Qy(t){return typeof t=="symbol"||oie(t)&&f_.call(t)==mre}function sie(t){return t==null?"":Yre(t)}function cie(t,e,n){var r=t==null?void 0:qre(t,e);return r===void 0?n:r}var lie=cie;const uie=Eo(lie),OT=Symbol("DefinedCursors"),h_=new Set(["alias","all-scroll","auto","cell","col-resize","context-menu","copy","crosshair","default","e-resize","ew-resize","grab","grabbing","help","move","ne-resize","nesw-resize","no-drop","none","not-allowed","n-resize","ns-resize","nw-resize","nwse-resize","pointer","progress","row-resize","se-resize","s-resize","sw-resize","text","vertical-text","wait","w-resize","zoom-in","zoom-out"]);class Gi{constructor(e,n){this.name=e+"",this.fallback=n}getName(){return this.name+""}addFallbackStyleProperty(e){const{fallback:n}=this;return n instanceof Gi?`${e}, ${n.getStyleProperty()}`:e+""}getStyleProperty(){return this.addFallbackStyleProperty(this.name)+""}static getDefinedCursor(e){const n=DT(Gi,OT);let r=n.get(e);if(r instanceof Gi)return r;if(h_.has(e))return r=new Gi(e),n.set(e,r),r}static setDefinedCursor(e,n){return n instanceof Gi?(DT(Gi,OT).set(e,n),!0):!1}}function DT(t,e){let n=t[e];return n instanceof Map||(n=new Map,Object.defineProperty(t,e,{value:n})),n}const fie=h_.values(),gie="image-cursor";class Ah extends Gi{constructor(e,n,r,i,a){super(i||Ah.getUniqueInstanceName(gie),a),this.url=e,this.x=Number(n)||0,this.y=Number(r)||0}getStyleProperty(){const{url:e,x:n,y:r}=this;let i=`url('${e}')`;return n>=0&&r>=0&&(n>0||r>0)&&(i+=` ${n} ${r}`),this.addFallbackStyleProperty(i)}static getUniqueInstanceName(e){return`${e}-${nM(Ah)}`}}const St={iconContent:"",iconSize:16,viewBox:{x:16,y:16},mousePoint:{x:8,y:8},mousePointerGroupString:`
    <path stroke="{{color}}" d="M8 16L8 0"></path>
    <path stroke="{{color}}" d="M16 8L0 8"></path>
  `},Si={x:127,y:60},Dl=`
<rect fill="{{color}}" x="80.19" y="25.03" width="47.14" height="15.85"/>
`,js=`
<rect fill="{{color}}" x="80.19" y="25.03" width="47.14" height="15.85"/>
<rect fill="{{color}}" x="95.84" y="9.38" width="15.85" height="47.14"/>
`,M1='<path fill="{{color}}" d="M82.89,10a12.09,12.09,0,0,0-16.8-2.5l-27.5,20.4-8.5-6.3a2.93,2.93,0,0,1-1.1-3,14.66,14.66,0,0,0,.1-6.6,14.08,14.08,0,1,0-6.5,15.2,2.87,2.87,0,0,1,3.2.2l8.2,6.1-8.2,6.1a2.87,2.87,0,0,1-3.2.2,14.16,14.16,0,1,0,6.7,14.4,14,14,0,0,0-.3-5.8,2.93,2.93,0,0,1,1.1-3l8.5-6.3,27.5,20.4A11.91,11.91,0,0,0,82.89,57l-31.7-23.5ZM15.29,21a5.9,5.9,0,1,1,5.9-5.9A5.91,5.91,0,0,1,15.29,21Zm0,36.8a5.9,5.9,0,1,1,5.9-5.9A5.91,5.91,0,0,1,15.29,57.77Zm28.3-21.5a2.8,2.8,0,1,1,2.8-2.8A2.8,2.8,0,0,1,43.59,36.27Z" transform="translate(-1.17 -0.96)"/>',Rl='<path fill="{{color}}" d="M8.86,2.25V66.08H72.69V2.25H8.86ZM65.28,58.67h-49v-49h49v49Z" transform="translate(-8.86 -2.25)"/>',_1='<path fill="{{color}}" d="M40.77,2.25A31.92,31.92,0,1,0,72.69,34.16,31.92,31.92,0,0,0,40.77,2.25Zm0,57.63A25.71,25.71,0,1,1,66.48,34.16,25.71,25.71,0,0,1,40.77,59.87Z" transform="translate(-8.86 -2.25)"/>',m_={Angle:Et(St,{name:"Angle",iconContent:`<path fill="{{color}}" d="M1203 544q0 13-10 23l-393 393 393 393q10 10 10 23t-10 23l-50
    50q-10 10-23 10t-23-10l-466-466q-10-10-10-23t10-23l466-466q10-10 23-10t23
    10l50 50q10 10 10 23z" />`,viewBox:{x:1792,y:1792}}),ArrowAnnotate:Et(St,{name:"ArrowAnnotate",iconContent:`<g id="arrowAnnotate-group" fill="none" stroke-width="1" stroke="{{color}}" stroke-linecap="round" stroke-linejoin="round">
    <path id="arrowAnnotate-arrow" d="M23,7 l-15,15 M7,17 l0,6 6,0" stroke-width="2" />
  </g>`,viewBox:{x:24,y:24}}),Bidirectional:Et(St,{name:"Bidirectional",iconContent:`<g fill="{{color}}" stroke-width="3" stroke="{{color}}">
    <path d="M27.63 3.21L3.12 28.81"></path>
    <path d="M27.63 15.75L15.27 4.43"></path>
    <path d="M16.5 4.28C16.5 4.96 15.95 5.51 15.27 5.51C14.59 5.51 14.03 4.96 14.03 4.28C14.03 3.59 14.59 3.04 15.27 3.04C15.95 3.04 16.5 3.59 16.5 4.28Z" ></path>
    <path d="M28.87 3.19C28.87 3.87 28.31 4.43 27.63 4.43C26.95 4.43 26.4 3.87 26.4 3.19C26.4 2.51 26.95 1.95 27.63 1.95C28.31 1.95 28.87 2.51 28.87 3.19Z"></path>
    <path d="M28.87 15.75C28.87 16.43 28.31 16.99 27.63 16.99C26.95 16.99 26.4 16.43 26.4 15.75C26.4 15.07 26.95 14.51 27.63 14.51C28.31 14.51 28.87 15.07 28.87 15.75Z"></path>
    <path d="M4.73 28.44C4.73 29.12 4.17 29.68 3.49 29.68C2.81 29.68 2.25 29.12 2.25 28.44C2.25 27.76 2.81 27.2 3.49 27.2C4.17 27.2 4.73 27.76 4.73 28.44Z"></path>
  </g>`,viewBox:{x:48,y:48}}),CobbAngle:Et(St,{name:"CobbAngle",iconContent:`<g stroke="{{color}}" stroke-width="3">
    <path d="M28.59 2.34L3.82 12.32"></path>
    <path d="M28.59 29.66L3.82 19.68"></path>
    <path stroke-dasharray="2" fill-opacity="0" d="M12.37
      23.06C12.67 22.36 12.85 21.93 12.92 21.76C14.6 17.8 14.68 13.35 13.15
      9.33C13.11 9.24 13.02 9 12.88 8.63">
    </path>
  </g>`,viewBox:{x:32,y:32}}),CircleROI:Et(St,{name:"CircleROI",iconContent:'<circle stroke="{{color}}" fill="none" stroke-width="3" cx="16" cy="16" r="14" />',viewBox:{x:32,y:32}}),EllipticalROI:Et(St,{name:"EllipticalROI",iconContent:`<path stroke="{{color}}" fill="none" stroke-width="3" d="M30.74 15.76C30.74 20.99 24.14 25.23 16
    25.23C7.86 25.23 1.26 20.99 1.26 15.76C1.26 10.54 7.86 6.3 16 6.3C24.14
    6.3 30.74 10.54 30.74 15.76Z" />`,viewBox:{x:32,y:32}}),FreehandROI:Et(St,{name:"FreehandROI",iconContent:`<g fill="{{color}}" stroke="{{color}}" stroke-width="2">
    <ellipse ry="1" rx="1" id="svg_3" cy="4.240343" cx="14.306499"/>
    <line id="svg_4" y2="3.58462" x2="12.242186" y1="3.997482" x1="13.432202"/>
    <line id="svg_5" y2="3.268901" x2="10.857882" y1="3.608906" x1="12.387902"/>
    <line id="svg_6" y2="3.147471" x2="9.740724" y1="3.293187" x1="10.955026"/>
    <line id="svg_7" y2="3.147471" x2="8.089274" y1="3.196043" x1="9.983585"/>
    <line id="svg_8" y2="3.268901" x2="6.874972" y1="3.123185" x1="8.307848"/>
    <line id="svg_9" y2="3.657478" x2="5.587812" y1="3.220329" x1="7.020688"/>
    <line id="svg_10" y2="4.046054" x2="4.737801" y1="3.560334" x1="5.854959"/>
    <line id="svg_11" y2="4.337487" x2="4.300652" y1="3.997482" x1="4.834945"/>
    <line id="svg_12" y2="4.726063" x2="3.88779" y1="4.191771" x1="4.470655"/>
    <line id="svg_15" y2="5.3575" x2="3.377783" y1="4.604633" x1="3.960648"/>
    <line id="svg_16" y2="6.183226" x2="2.916348" y1="5.138926" x1="3.547785"/>
    <line id="svg_17" y2="6.960379" x2="2.770632" y1="5.867507" x1="3.037779"/>
    <line id="svg_18" y2="7.713246" x2="2.673488" y1="6.741804" x1="2.819204"/>
    <line id="svg_19" y2="8.684687" x2="2.697774" y1="7.616102" x1="2.673488"/>
    <line id="svg_20" y2="9.753273" x2="2.892062" y1="8.611829" x1="2.697774"/>
    <line id="svg_21" y2="10.724714" x2="3.134923" y1="9.534698" x1="2.84349"/>
    <line id="svg_23" y2="11.647583" x2="3.596357" y1="10.578998" x1="3.086351"/>
    <line id="svg_25" y2="12.521881" x2="4.276366" y1="11.501867" x1="3.499213"/>
    <line id="svg_26" y2="13.930471" x2="5.830673" y1="12.376165" x1="4.13065"/>
    <line id="svg_28" y2="14.707624" x2="7.263549" y1="13.881899" x1="5.733528"/>
    <line id="svg_29" y2="15.339061" x2="8.963571" y1="14.61048" x1="7.06926"/>
    <line id="svg_30" y2="15.581921" x2="10.882168" y1="15.314775" x1="8.817855"/>
    <line id="svg_31" y2="15.460491" x2="12.023612" y1="15.581921" x1="10.785024"/>
    <line id="svg_33" y2="15.120487" x2="13.092197" y1="15.484777" x1="11.877895"/>
    <line id="svg_34" y2="14.586194" x2="13.86935" y1="15.217631" x1="12.897909"/>
    <line id="svg_35" y2="13.833327" x2="14.597931" y1="14.756196" x1="13.699348"/>
    <line id="svg_37" y2="12.716169" x2="15.180796" y1="13.881899" x1="14.549359"/>
    <line id="svg_39" y2="11.429009" x2="15.520801" y1="12.813313" x1="15.15651"/>
    <ellipse ry="1" rx="1" id="svg_40" cy="10.967574" cx="15.520801"/>
  </g>`,viewBox:{x:18,y:18}}),FreehandROISculptor:Et(St,{name:"FreehandROISculptor",iconContent:`<g id="icon-freehand-sculpt" fill="none" stroke-width="1.5" stroke="{{color}}" stroke-linecap="round" stroke-linejoin="round">
    <line id="svg_1" y2="2.559367" x2="10.184807" y1="4.467781" x1="8.81711"/>
    <line id="svg_4" y2="1.493836" x2="11.727442" y1="2.766112" x1="10.089386"/>
    <line id="svg_7" y2="1.080346" x2="13.047428" y1="1.748291" x1="11.345759"/>
    <line id="svg_8" y2="1.000829" x2="14.351511" y1="1.112153" x1="12.77707"/>
    <line id="svg_9" y2="1.350705" x2="15.242104" y1="0.905408" x1="13.969828"/>
    <line id="svg_10" y2="2.098167" x2="15.862339" y1="1.14396" x1="14.955842"/>
    <line id="svg_11" y2="3.195505" x2="16.41896" y1="1.939133" x1="15.766918"/>
    <line id="svg_12" y2="4.292843" x2="16.530284" y1="2.925147" x1="16.387153"/>
    <line id="svg_16" y2="5.644637" x2="16.196311" y1="3.831643" x1="16.593898"/>
    <line id="svg_18" y2="7.266789" x2="15.623787" y1="5.19934" x1="16.275829"/>
    <line id="svg_19" y2="10.813258" x2="14.526449" y1="6.726071" x1="15.766918"/>
    <line id="svg_20" y2="5.056209" x2="8.085552" y1="4.181519" x1="8.976145"/>
    <line id="svg_23" y2="5.326568" x2="7.481221" y1="4.78585" x1="8.403621"/>
    <line id="svg_24" y2="5.565119" x2="6.749662" y1="5.294761" x1="7.624352"/>
    <line id="svg_25" y2="5.994512" x2="5.429675" y1="5.533312" x1="6.956407"/>
    <line id="svg_27" y2="6.551133" x2="4.284627" y1="5.962706" x1="5.572807"/>
    <line id="svg_28" y2="7.584858" x2="3.044158" y1="6.392099" x1="4.427758"/>
    <line id="svg_29" y2="8.84123" x2="2.185372" y1="7.489437" x1="3.219096"/>
    <line id="svg_31" y2="10.606513" x2="1.644654" y1="8.602678" x1="2.280792"/>
    <line id="svg_32" y2="13.214679" x2="1.48562" y1="10.352058" x1="1.724171"/>
    <line id="svg_33" y2="14.375631" x2="1.676461" y1="12.992031" x1="1.453813"/>
    <line id="svg_34" y2="15.298031" x2="2.264889" y1="14.152983" x1="1.517427"/>
    <line id="svg_35" y2="16.172721" x2="3.521261" y1="14.948155" x1="1.915013"/>
    <line id="svg_36" y2="16.824762" x2="5.207027" y1="15.997783" x1="3.28271"/>
    <line id="svg_38" y2="17.063314" x2="7.035924" y1="16.745245" x1="4.968475"/>
    <line id="svg_39" y2="16.888376" x2="9.278311" y1="17.047411" x1="6.733758"/>
    <line id="svg_40" y2="16.284045" x2="10.661911" y1="16.983797" x1="8.992048"/>
    <line id="svg_41" y2="15.313934" x2="11.647925" y1="16.395369" x1="10.455166"/>
    <line id="svg_44" y2="13.898527" x2="12.82478" y1="15.425259" x1="11.504794"/>
    <line id="svg_45" y2="12.037824" x2="14.144766" y1="14.312017" x1="12.522614"/>
    <line id="svg_47" y2="10.59061" x2="14.605966" y1="12.228665" x1="13.953925"/>
    <ellipse ry="1" rx="1" id="svg_48" cy="3.982726" cx="13.460918"/>
  </g>`,viewBox:{x:18,y:18}}),Length:Et(St,{name:"Length",iconContent:`<g id="length-group" fill="none" stroke-width="1" stroke="{{color}}" stroke-linecap="round" stroke-linejoin="round">
    <path id="length-dashes" d="m22.5,6 -16.5,16.5" stroke-width="3" stroke-dasharray="0.6666,5" />
  </g>`,viewBox:{x:24,y:24}}),Height:Et(St,{name:"Height",iconContent:'<path d="m 6 22 l 8.5 0 v -16 h 8" stroke-width="3" fill="none" stroke="{{color}}" />',viewBox:{x:24,y:24}}),Probe:Et(St,{name:"Probe",iconContent:`<path fill="{{color}}" d="M1152 896q0 106-75 181t-181 75-181-75-75-181 75-181 181-75 181 75
    75 181zm-256-544q-148 0-273 73t-198 198-73 273 73 273 198 198 273 73 273-73
    198-198 73-273-73-273-198-198-273-73zm768 544q0 209-103 385.5t-279.5
    279.5-385.5 103-385.5-103-279.5-279.5-103-385.5 103-385.5 279.5-279.5
    385.5-103 385.5 103 279.5 279.5 103 385.5z" />`,viewBox:{x:1792,y:1792}}),RectangleROI:Et(St,{name:"RectangleROI",iconContent:`<path fill="{{color}}" d="M1312 256h-832q-66 0-113 47t-47 113v832q0 66 47
    113t113 47h832q66 0 113-47t47-113v-832q0-66-47-113t-113-47zm288 160v832q0
    119-84.5 203.5t-203.5 84.5h-832q-119 0-203.5-84.5t-84.5-203.5v-832q0-119
    84.5-203.5t203.5-84.5h832q119 0 203.5 84.5t84.5 203.5z" />`,viewBox:{x:1792,y:1792}}),TextMarker:Et(St,{name:"TextMarker",iconContent:`<path fill="{{color}}" d="M789 559l-170 450q33 0 136.5 2t160.5 2q19 0
    57-2-87-253-184-452zm-725 1105l2-79q23-7 56-12.5t57-10.5 49.5-14.5 44.5-29
    31-50.5l237-616 280-724h128q8 14 11 21l205 480q33 78 106 257.5t114 274.5q15
    34 58 144.5t72 168.5q20 45 35 57 19 15 88 29.5t84 20.5q6 38 6 57 0 5-.5
    13.5t-.5 12.5q-63 0-190-8t-191-8q-76 0-215 7t-178 8q0-43 4-78l131-28q1 0
    12.5-2.5t15.5-3.5 14.5-4.5 15-6.5 11-8 9-11
    2.5-14q0-16-31-96.5t-72-177.5-42-100l-450-2q-26 58-76.5 195.5t-50.5 162.5q0
    22 14 37.5t43.5 24.5 48.5 13.5 57 8.5 41 4q1 19 1 58 0 9-2 27-58
    0-174.5-10t-174.5-10q-8 0-26.5 4t-21.5 4q-80 14-188 14z" />`,viewBox:{x:1792,y:1792}}),Crosshairs:Et(St,{name:"Crosshairs",iconContent:`<path fill="{{color}}" d="M1325 1024h-109q-26 0-45-19t-19-45v-128q0-26
    19-45t45-19h109q-32-108-112.5-188.5t-188.5-112.5v109q0 26-19 45t-45
    19h-128q-26 0-45-19t-19-45v-109q-108 32-188.5 112.5t-112.5 188.5h109q26
    0 45 19t19 45v128q0 26-19 45t-45 19h-109q32 108 112.5 188.5t188.5
    112.5v-109q0-26 19-45t45-19h128q26 0 45 19t19 45v109q108-32
    188.5-112.5t112.5-188.5zm339-192v128q0 26-19 45t-45 19h-143q-37 161-154.5
    278.5t-278.5 154.5v143q0 26-19 45t-45 19h-128q-26
    0-45-19t-19-45v-143q-161-37-278.5-154.5t-154.5-278.5h-143q-26
    0-45-19t-19-45v-128q0-26 19-45t45-19h143q37-161
    154.5-278.5t278.5-154.5v-143q0-26 19-45t45-19h128q26 0 45 19t19 45v143q161
    37 278.5 154.5t154.5 278.5h143q26 0 45 19t19 45z" />`,viewBox:{x:1792,y:1792}}),Eraser:Et(St,{name:"Eraser",iconContent:`<path transform="translate(0,1792) scale(1,-1)" fill="{{color}}" d="M960 1408l336-384h-768l-336 384h768zm1013-1077q15
    34 9.5 71.5t-30.5 65.5l-896 1024q-38 44-96 44h-768q-38
    0-69.5-20.5t-47.5-54.5q-15-34-9.5-71.5t30.5-65.5l896-1024q38-44 96-44h768q38
    0 69.5 20.5t47.5 54.5z" />`,viewBox:{x:2048,y:1792}}),Magnify:Et(St,{name:"Magnify",iconContent:`<path fill="{{color}}" d="M508.5 481.6l-129-129c-2.3-2.3-5.3-3.5-8.5-3.5h-10.3C395
    312 416 262.5 416 208 416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c54.5
    0 104-21 141.1-55.2V371c0 3.2 1.3 6.2 3.5 8.5l129 129c4.7 4.7 12.3 4.7 17
    0l9.9-9.9c4.7-4.7 4.7-12.3 0-17zM208 384c-97.3 0-176-78.7-176-176S110.7 32 208
    32s176 78.7 176 176-78.7 176-176 176z" />`,viewBox:{x:512,y:512}}),Pan:Et(St,{name:"Pan",iconContent:`<path fill="{{color}}" d="M1411 541l-355 355 355 355 144-144q29-31 70-14 39 17
    39 59v448q0 26-19 45t-45 19h-448q-42 0-59-40-17-39 14-69l144-144-355-355-355
    355 144 144q31 30 14 69-17 40-59 40h-448q-26 0-45-19t-19-45v-448q0-42 40-59
    39-17 69 14l144 144 355-355-355-355-144 144q-19 19-45 19-12
    0-24-5-40-17-40-59v-448q0-26 19-45t45-19h448q42 0 59 40 17 39-14 69l-144
    144 355 355 355-355-144-144q-31-30-14-69 17-40 59-40h448q26 0 45 19t19
    45v448q0 42-39 59-13 5-25 5-26 0-45-19z" />`,viewBox:{x:1792,y:1792}}),Rotate:Et(St,{name:"Rotate",iconContent:`<path fill="{{color}}" d="M1664 256v448q0 26-19 45t-45 19h-448q-42 0-59-40-17-39
    14-69l138-138q-148-137-349-137-104 0-198.5 40.5t-163.5 109.5-109.5
    163.5-40.5 198.5 40.5 198.5 109.5 163.5 163.5 109.5 198.5 40.5q119 0
    225-52t179-147q7-10 23-12 15 0 25 9l137 138q9 8 9.5 20.5t-7.5 22.5q-109
    132-264 204.5t-327 72.5q-156 0-298-61t-245-164-164-245-61-298 61-298
    164-245 245-164 298-61q147 0 284.5 55.5t244.5 156.5l130-129q29-31 70-14
    39 17 39 59z" />`,viewBox:{x:1792,y:1792}}),StackScroll:Et(St,{name:"StackScroll",iconContent:`<path fill="{{color}}" d="M24 21v2c0 0.547-0.453 1-1 1h-22c-0.547
    0-1-0.453-1-1v-2c0-0.547 0.453-1 1-1h22c0.547 0 1 0.453 1 1zM24 13v2c0
    0.547-0.453 1-1 1h-22c-0.547 0-1-0.453-1-1v-2c0-0.547 0.453-1 1-1h22c0.547
    0 1 0.453 1 1zM24 5v2c0 0.547-0.453 1-1 1h-22c-0.547
    0-1-0.453-1-1v-2c0-0.547 0.453-1 1-1h22c0.547 0 1 0.453 1 1z" />`,viewBox:{x:24,y:28}}),WindowLevelRegion:Et(St,{name:"WindowLevelRegion",iconContent:`<path fill="{{color}}" d="M1664 416v960q0 119-84.5 203.5t-203.5 84.5h-960q-119
    0-203.5-84.5t-84.5-203.5v-960q0-119 84.5-203.5t203.5-84.5h960q119 0 203.5
    84.5t84.5 203.5z" />`,viewBox:{x:1792,y:1792}}),WindowLevel:Et(St,{name:"WindowLevel",iconContent:`
    <path fill="{{color}}" d="M14.5,3.5 a1 1 0 0 1 -11,11 Z" stroke="none" opacity="0.8" />
    <circle cx="9" cy="9" r="8" fill="none" stroke-width="2" stroke="{{color}}" />`,viewBox:{x:18,y:18}}),Zoom:Et(St,{name:"Zoom",iconContent:`
  <path fill="{{color}}" d="M508.5 481.6l-129-129c-2.3-2.3-5.3-3.5-8.5-3.5h-10.3C395
    312 416 262.5 416 208 416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c54.5
    0 104-21 141.1-55.2V371c0 3.2 1.3 6.2 3.5 8.5l129 129c4.7 4.7 12.3 4.7 17
    0l9.9-9.9c4.7-4.7 4.7-12.3 0-17zM208 384c-97.3 0-176-78.7-176-176S110.7 32 208
    32s176 78.7 176 176-78.7 176-176 176z" />
  <path fill="{{color}}" transform="scale(0.22,0.22) translate(1400,0)" d="M1216
    320q0 26-19 45t-45 19h-128v1024h128q26 0 45 19t19 45-19 45l-256 256q-19
    19-45 19t-45-19l-256-256q-19-19-19-45t19-45 45-19h128v-1024h-128q-26
    0-45-19t-19-45 19-45l256-256q19-19 45-19t45 19l256 256q19 19 19 45z" />`,viewBox:{x:640,y:512}}),SegmentationFreeHandEraseInside:Et(St,{name:"SegmentationFreeHandEraseInside",iconContent:`${M1} ${Dl}`,viewBox:Si}),SegmentationFreeHandFillInside:Et(St,{name:"SegmentationFreeHandFillInside",iconContent:`${M1} ${js}`,viewBox:Si}),SegmentationFreeHandEraseOutside:Et(St,{name:"SegmentationFreeHandEraseOutside",iconContent:`${M1} ${Dl}`,viewBox:Si}),SegmentationFreeHandFillOutside:Et(St,{name:"SegmentationFreeHandFillOutside",iconContent:`${M1} ${js}`,viewBox:Si}),SegmentationRectangleEraseInside:Et(St,{name:"SegmentationRectangleEraseInside",iconContent:`${Rl} ${Dl}`,viewBox:Si}),RectangleScissor:Et(St,{name:"RectangleScissor",iconContent:`${Rl} ${js}`,viewBox:Si}),"RectangleScissor.FILL_INSIDE":Et(St,{name:"RectangleScissor.FILL_INSIDE",iconContent:`${Rl} ${js}`,viewBox:Si}),"RectangleScissor.FILL_OUTSIDE":Et(St,{name:"RectangleScissor.FILL_OUTSIDE",iconContent:`${Rl} ${js}`,viewBox:Si}),"RectangleScissor.ERASE_OUTSIDE":Et(St,{name:"RectangleScissor.ERASE_OUTSIDE",iconContent:`${Rl} ${Dl}`,viewBox:Si}),"RectangleScissor.ERASE_INSIDE":Et(St,{name:"RectangleScissor.ERASE_INSIDE",iconContent:`${Rl} ${Dl}`,viewBox:Si}),CircleScissor:Et(St,{name:"CircleScissor",iconContent:`${_1} ${js}`,viewBox:Si}),"CircleScissor.FILL_INSIDE":Et(St,{name:"CircleScissor.FILL_INSIDE",iconContent:`${_1} ${js}`,viewBox:Si}),"CircleScissor.ERASE_OUTSIDE":Et(St,{name:"CircleScissor.ERASE_OUTSIDE",iconContent:`${_1} ${Dl}`,viewBox:Si}),"CircleScissor.FILL_OUTSIDE":Et(St,{name:"CircleScissor.FILL_OUTSIDE",iconContent:`${_1} ${js}`,viewBox:Si})};function Et(t,e){return Object.assign(Object.create(t),{...e,name:e.name||t.name})}function die(t){return m_[t]}const pie=Object.keys(m_);class hie{constructor(){const e={color:"rgb(255, 255, 0)",colorHighlighted:"rgb(0, 255, 0)",colorSelected:"rgb(0, 220, 0)",colorLocked:"rgb(209, 193, 90)",lineWidth:"1",lineDash:"",shadow:!0,textBoxVisibility:!0,textBoxFontFamily:"Helvetica Neue, Helvetica, Arial, sans-serif",textBoxFontSize:"14px",textBoxColor:"rgb(255, 255, 0)",textBoxColorHighlighted:"rgb(0, 255, 0)",textBoxColorSelected:"rgb(0, 255, 0)",textBoxColorLocked:"rgb(209, 193, 90)",textBoxBackground:"",textBoxLinkLineWidth:"1",textBoxLinkLineDash:"2,3",textBoxShadow:!0,markerSize:"10"};this._initializeConfig(e)}getAnnotationToolStyles(e){return this.config.annotations&&this.config.annotations[e]}getViewportToolStyles(e){return this.config.viewports&&this.config.viewports[e]}getToolGroupToolStyles(e){return this.config.toolGroups&&this.config.toolGroups[e]}getDefaultToolStyles(){return this.config.default}setAnnotationStyles(e,n){let r=this.config.annotations;r||(this.config={...this.config,annotations:{}},r=this.config.annotations),r[e]=n}setViewportToolStyles(e,n){let r=this.config.viewports;r||(this.config={...this.config,viewports:{}},r=this.config.viewports),r[e]=n}setToolGroupToolStyles(e,n){let r=this.config.toolGroups;r||(this.config={...this.config,toolGroups:{}},r=this.config.toolGroups),r[e]=n}setDefaultToolStyles(e){this.config.default=e}getStyleProperty(e,n){const{annotationUID:r,viewportId:i,toolGroupId:a,toolName:o}=n;return this._getToolStyle(e,r,i,a,o)}_getToolStyle(e,n,r,i,a){if(n){const s=this.getAnnotationToolStyles(n);if(s&&s[e]!==void 0)return s[e]}if(r){const s=this.getViewportToolStyles(r);if(s){if(s[a]&&s[a][e]!==void 0)return s[a][e];if(s.global&&s.global[e]!==void 0)return s.global[e]}}if(i){const s=this.getToolGroupToolStyles(i);if(s){if(s[a]&&s[a][e]!==void 0)return s[a][e];if(s.global&&s.global[e]!==void 0)return s.global[e]}}const o=this.getDefaultToolStyles();if(o[a]&&o[a][e]!==void 0)return o[a][e];if(o.global&&o.global[e]!==void 0)return o.global[e]}_initializeConfig(e){const n={};for(const r in e)n[r]=e[r];this.config={default:{global:n}}}}const mie=new hie;function vie(t,e,n){const r=[`${t}`];return e&&r.push(`${r[0]}${e}`),n&&r.push(`${r[r.length-1]}${n}`),r}function v_(t,e,n,r){const i=vie(t,n,r);for(let a=i.length-1;a>=0;--a){const o=mie.getStyleProperty(i[a],e);if(o!==void 0)return o}}const yie="color",Tie=ic.Highlighted,Cie=Yt.Active;class yp extends Ah{constructor(e,n,r,i,a){super(e,n,r,i,a)}static getDefinedCursor(e,n=!1,r){r||(r=v_(yie,{},Tie,Cie));const i=wie(e,n,r);let a=super.getDefinedCursor(i);if(!a){const o=die(e);o&&(a=xie(o,i,n,r,super.getDefinedCursor("default")),super.setDefinedCursor(i,a))}return a}}function y_(t,e){const n=Object(e),r=Object.prototype.hasOwnProperty.bind(n);return(t+"").replace(/\{\{(\w+)\}\}/g,(i,a)=>r(a)?n[a]+"":"")}function wie(t,e,n){return`${e?"pointer":"cursor"}:${t}/${n}`}function xie(t,e,n,r,i){const{x:a,y:o}=t.mousePoint;return new yp(Sie(t,n,{color:r}),a,o,e,i)}function Sie(t,e,n){const r=Eie(t,e,n);return`${URL.createObjectURL(r)}#${t.name||"unknown"}-${e?"pointer":"cursor"}`}function Eie(t,e,n){const r=(e?Die:Oie)(t,n);return new Blob([r],{type:"image/svg+xml"})}function Oie(t,e){const{iconContent:n,iconSize:r,viewBox:i}=t,a=`
    <svg data-icon="cursor" role="img" xmlns="http://www.w3.org/2000/svg"
      width="${r}" height="${r}" viewBox="0 0
      ${i.x} ${i.y}">
      ${n}
    </svg>`;return y_(a,e)}function Die(t,e){const{iconContent:n,iconSize:r,viewBox:i,mousePointerGroupString:a}=t,o=r/Math.max(i.x,i.y,1),s=16+r,c=`
    <svg data-icon="cursor" role="img" xmlns="http://www.w3.org/2000/svg"
      width="${s}" height="${s}" viewBox="0 0 ${s} ${s}">
      <g>${a}</g>
      <g transform="translate(16, 16) scale(${o})">${n}</g>
    </svg>`;return y_(c,e)}const RT=Symbol("ElementCursorsMap");function Rie(t,e){Zg(t)[0]=e,Jy(t,e)}function Jy(t,e){const n=Zg(t);n[1]=n[0],n[0]=e,t.style.cursor=(e instanceof Gi?e:Gi.getDefinedCursor("auto")).getStyleProperty()}function e8(t){Jy(t,Zg(t)[1])}function k2(t){Jy(t,Gi.getDefinedCursor("none"))}function Zg(t){let e=Zg[RT];e instanceof WeakMap||(e=new WeakMap,Object.defineProperty(Zg,RT,{value:e}));let n=e.get(t);return n||(n=[null,null],e.set(t,n)),n}[...pie,...fie];function t8(t){return $e.toolGroups.find(e=>e.id===t)}const{Active:Of,Passive:om,Enabled:sm,Disabled:cm}=Yt,Mie=[{mouseButton:cs.Primary}];class n8{constructor(e){this.viewportsInfo=[],this.toolOptions={},this.currentActivePrimaryToolName=null,this.prevActivePrimaryToolName=null,this.restoreToolOptions={},this._toolInstances={},this.id=e}getViewportIds(){return this.viewportsInfo.map(({viewportId:e})=>e)}getViewportsInfo(){return this.viewportsInfo.slice()}getToolInstance(e){const n=this._toolInstances[e];if(!n){console.warn(`'${e}' is not registered with this toolGroup (${this.id}).`);return}return n}getToolInstances(){return this._toolInstances}hasTool(e){return!!this._toolInstances[e]}addTool(e,n={}){const r=$e.tools[e],i=typeof e<"u"&&e!=="",a=this.toolOptions[e];if(!i){console.warn("Tool with configuration did not produce a toolName: ",n);return}if(!r){console.warn(`'${e}' is not registered with the library. You need to use cornerstoneTools.addTool to register it.`);return}if(a){console.warn(`'${e}' is already registered for ToolGroup ${this.id}.`);return}const{toolClass:o}=r,s={name:e,toolGroupId:this.id,configuration:n},c=new o(s);this._toolInstances[e]=c}addToolInstance(e,n,r={}){var a;let i=(a=$e.tools[e])==null?void 0:a.toolClass;if(!i){const o=$e.tools[n].toolClass;class s extends o{}s.toolName=e,i=s,$e.tools[e]={toolClass:s}}this.addTool(i.toolName,r)}addViewport(e,n){if(typeof e!="string")throw new Error("viewportId must be defined and be a string");const r=this._findRenderingEngine(e,n);this.viewportsInfo.some(({viewportId:s})=>s===e)||this.viewportsInfo.push({viewportId:e,renderingEngineId:r});const i=this.getActivePrimaryMouseButtonTool();jt.getRuntimeSettings().get("useCursors")&&this.setViewportsCursorByToolName(i);const o={toolGroupId:this.id,viewportId:e,renderingEngineId:r};De(Ee,he.TOOLGROUP_VIEWPORT_ADDED,o)}removeViewports(e,n){const r=[];if(this.viewportsInfo.forEach((a,o)=>{let s=!1;a.renderingEngineId===e&&(s=!0,n&&a.viewportId!==n&&(s=!1)),s&&r.push(o)}),r.length)for(let a=r.length-1;a>=0;a--)this.viewportsInfo.splice(r[a],1);const i={toolGroupId:this.id,viewportId:n,renderingEngineId:e};De(Ee,he.TOOLGROUP_VIEWPORT_REMOVED,i)}setActiveStrategy(e,n){const r=this._toolInstances[e];if(r===void 0){console.warn(`Tool ${e} not added to toolGroup, can't set tool configuration.`);return}r.setActiveStrategy(n)}setToolMode(e,n,r={}){if(!e){console.warn("setToolMode: toolName must be defined");return}if(n===Yt.Active){this.setToolActive(e,r||this.restoreToolOptions[e]);return}if(n===Yt.Passive){this.setToolPassive(e);return}if(n===Yt.Enabled){this.setToolEnabled(e);return}if(n===Yt.Disabled){this.setToolDisabled(e);return}console.warn("setToolMode: mode must be defined")}setToolActive(e,n={}){const r=this._toolInstances[e];if(r===void 0){console.warn(`Tool ${e} not added to toolGroup, can't set tool mode.`);return}if(!r){console.warn(`'${e}' instance ${r} is not registered with this toolGroup, can't set tool mode.`);return}const i=this.toolOptions[e]?this.toolOptions[e].bindings:[],a=n.bindings?n.bindings:[],s={bindings:[...i,...a].reduce((u,g)=>{const d=g.numTouchPoints!==void 0,h=g.mouseButton!==void 0;return!u.some(p=>lm(p,g))&&(d||h)&&u.push(g),u},[]),mode:Of};this.toolOptions[e]=s,this._toolInstances[e].mode=Of;const l=jt.getRuntimeSettings().get("useCursors");if(this._hasMousePrimaryButtonBinding(n)&&l)this.setViewportsCursorByToolName(e);else if(!this.getActivePrimaryMouseButtonTool()&&l){const g=Gi.getDefinedCursor("default");this._setCursorForViewports(g)}this._hasMousePrimaryButtonBinding(n)&&(this.prevActivePrimaryToolName===null?this.prevActivePrimaryToolName=e:this.prevActivePrimaryToolName=this.currentActivePrimaryToolName,this.currentActivePrimaryToolName=e),typeof r.onSetToolActive=="function"&&r.onSetToolActive(),this._renderViewports();const f={toolGroupId:this.id,toolName:e,toolBindingsOptions:n};De(Ee,he.TOOL_ACTIVATED,f),this._triggerToolModeChangedEvent(e,Of,n)}setToolPassive(e,n){const r=this._toolInstances[e];if(r===void 0){console.warn(`Tool ${e} not added to toolGroup, can't set tool mode.`);return}const i=this.getToolOptions(e),a=Object.assign({bindings:i?i.bindings:[]},i,{mode:om}),o=Array.isArray(n==null?void 0:n.removeAllBindings)?n.removeAllBindings:this.getDefaultPrimaryBindings();a.bindings=a.bindings.filter(c=>(n==null?void 0:n.removeAllBindings)!==!0&&!o.some(l=>lm(c,l)));let s=om;a.bindings.length!==0&&(s=Of,a.mode=s),this.toolOptions[e]=a,r.mode=s,typeof r.onSetToolPassive=="function"&&r.onSetToolPassive(),this._renderViewports(),this._triggerToolModeChangedEvent(e,om)}setToolEnabled(e){const n=this._toolInstances[e];if(n===void 0){console.warn(`Tool ${e} not added to toolGroup, can't set tool mode.`);return}const r={bindings:[],mode:sm};this.toolOptions[e]=r,n.mode=sm,typeof n.onSetToolEnabled=="function"&&n.onSetToolEnabled(),this._renderViewports(),this._triggerToolModeChangedEvent(e,sm)}setToolDisabled(e){const n=this._toolInstances[e];if(n===void 0){console.warn(`Tool ${e} not added to toolGroup, can't set tool mode.`);return}const r={bindings:[],mode:cm};this.restoreToolOptions[e]=this.toolOptions[e],this.toolOptions[e]=r,n.mode=cm,typeof n.onSetToolDisabled=="function"&&n.onSetToolDisabled(),this._renderViewports(),this._triggerToolModeChangedEvent(e,cm)}getToolOptions(e){const n=this.toolOptions[e];if(n!==void 0)return n}getActivePrimaryMouseButtonTool(){return Object.keys(this.toolOptions).find(e=>{const n=this.toolOptions[e];return n.mode===Of&&this._hasMousePrimaryButtonBinding(n)})}setViewportsCursorByToolName(e,n){const r=this._getCursor(e,n);this._setCursorForViewports(r)}_getCursor(e,n){let r,i;return n&&(r=`${e}.${n}`,i=yp.getDefinedCursor(r,!0),i)||(r=`${e}`,i=yp.getDefinedCursor(r,!0),i)||(r=e,i=yp.getDefinedCursor(r,!0),i)?i:Gi.getDefinedCursor("default")}_setCursorForViewports(e){this.viewportsInfo.forEach(({renderingEngineId:n,viewportId:r})=>{const i=Sd(r,n);if(!i)return;const{viewport:a}=i;Rie(a.element,e)})}setToolConfiguration(e,n,r){const i=this._toolInstances[e];if(i===void 0)return console.warn(`Tool ${e} not present, can't set tool configuration.`),!1;let a;return r?a=n:a=Object.assign(i.configuration,n),i.configuration=a,typeof i.onSetToolConfiguration=="function"&&i.onSetToolConfiguration(),this._renderViewports(),!0}getDefaultMousePrimary(){return cs.Primary}getDefaultPrimaryBindings(){return Mie}getToolConfiguration(e,n){if(this._toolInstances[e]===void 0){console.warn(`Tool ${e} not present, can't set tool configuration.`);return}const r=uie(this._toolInstances[e].configuration,n)||this._toolInstances[e].configuration;return ka(r)}getPrevActivePrimaryToolName(){return this.prevActivePrimaryToolName}setActivePrimaryTool(e){const n=this.getCurrentActivePrimaryToolName();this.setToolDisabled(n),this.setToolActive(e,{bindings:[{mouseButton:cs.Primary}]})}getCurrentActivePrimaryToolName(){return this.currentActivePrimaryToolName}clone(e,n=null){let r=t8(e);return r?(console.debug(`ToolGroup ${e} already exists`),r):(r=new n8(e),$e.toolGroups.push(r),n=n??(()=>!0),Object.keys(this._toolInstances).filter(n).forEach(i=>{const a=this._toolInstances[i],o=this.toolOptions[i],s=a.mode;r.addTool(i),r.setToolMode(i,s,{bindings:o.bindings??[]})}),r)}_hasMousePrimaryButtonBinding(e){var r;const n=this.getDefaultPrimaryBindings();return(r=e==null?void 0:e.bindings)==null?void 0:r.some(i=>n.some(a=>lm(i,a)))}_renderViewports(){this.viewportsInfo.forEach(({renderingEngineId:e,viewportId:n})=>{dl(e).renderViewport(n)})}_triggerToolModeChangedEvent(e,n,r){const i={toolGroupId:this.id,toolName:e,mode:n,toolBindingsOptions:r};De(Ee,he.TOOL_MODE_CHANGED,i)}_findRenderingEngine(e,n){const r=Do();if((r==null?void 0:r.length)===0)throw new Error("No rendering engines found.");if(n)return n;const i=r.filter(a=>a.getViewport(e));if(i.length===0){if(r.length===1)return r[0].id;throw new Error("No rendering engines found that contain the viewport with the same viewportId, you must specify a renderingEngineId.")}if(i.length>1)throw new Error("Multiple rendering engines found that contain the viewport with the same viewportId, you must specify a renderingEngineId.");return i[0].id}}function lm(t,e){return t.mouseButton!==e.mouseButton||t.numTouchPoints!==e.numTouchPoints?!1:t.modifierKey===e.modifierKey}function T_(t){if($e.toolGroups.some(r=>r.id===t)){console.warn(`'${t}' already exists.`);return}const n=new n8(t);return $e.toolGroups.push(n),n}function C_(t){const e=$e.toolGroups.findIndex(n=>n.id===t);e>-1&&$e.toolGroups.splice(e,1)}function _ie(){const t=[...$e.toolGroups];for(const e of t)C_(e.id);$e.toolGroups=[]}function Vr(t,e){var r;e||(e=(r=Do().find(i=>i.getViewports().find(a=>a.id===t)))==null?void 0:r.id);const n=$e.toolGroups.filter(i=>i.viewportsInfo.some(a=>a.renderingEngineId===e&&(!a.viewportId||a.viewportId===t)));if(n.length){if(n.length>1)throw new Error(`Multiple tool groups found for renderingEngineId: ${e} and viewportId: ${t}. You should only
      have one tool group per viewport in a renderingEngine.`);return n[0]}}function bie(){return $e.toolGroups}const Lie=[Yt.Active,Yt.Passive,Yt.Enabled];function w_(t){return $e.toolGroups.filter(({toolOptions:e})=>{const n=Object.keys(e);for(let r=0;r<n.length;r++)if(t===n[r]&&e[t]&&Lie.includes(e[t].mode))return!0;return!1})}const Iie=Object.freeze(Object.defineProperty({__proto__:null,createToolGroup:T_,destroy:_ie,destroyToolGroup:C_,getAllToolGroups:bie,getToolGroup:t8,getToolGroupForViewport:Vr,getToolGroupsWithToolName:w_},Symbol.toStringTag,{value:"Module"}));function x_(t,e){const n=We(e),{renderingEngine:r,viewportId:i}=n,a=he.ANNOTATION_ADDED,o={annotation:t,viewportId:i,renderingEngineId:r.id};De(Ee,a,o)}function S_(t){const{toolName:e}=t.metadata,n=w_(e);if(!n.length)return;const r=[];n.forEach(o=>{o.viewportsInfo.forEach(s=>{const{renderingEngineId:c,viewportId:l}=s,{FrameOfReferenceUID:f}=Sd(l,c);t.metadata.FrameOfReferenceUID===f&&r.push(s)})});const i=he.ANNOTATION_ADDED,a={annotation:t};if(!r.length){De(Ee,i,a);return}r.forEach(({renderingEngineId:o,viewportId:s})=>{a.viewportId=s,a.renderingEngineId=o,De(Ee,i,a)})}function A2(t){const e=he.ANNOTATION_REMOVED;De(Ee,e,t)}function So(t,e,n=ys.HandlesUpdated){const r=We(e),{viewportId:i,renderingEngineId:a}=r,o=he.ANNOTATION_MODIFIED;De(Ee,o,{annotation:t,viewportId:i,renderingEngineId:a,changeType:n})}function Vie(t){E_({annotation:t})}function r8(t,e=!1){E_({annotation:t,contourHoleProcessingEnabled:e})}function E_(t){const e=he.ANNOTATION_COMPLETED;De(Ee,e,t)}const Pie=Object.freeze(Object.defineProperty({__proto__:null,triggerAnnotationAddedForElement:x_,triggerAnnotationAddedForFOR:S_,triggerAnnotationCompleted:Vie,triggerAnnotationModified:So,triggerAnnotationRemoved:A2,triggerContourAnnotationCompleted:r8},Symbol.toStringTag,{value:"Module"}));let O_;function Ro(){return O_}function i8(t){O_=t}function Qg(t,e){const n=Ro(),r=n.getGroupKey(e);return n.getAnnotations(r,t)}function sr(t){return Ro().getAnnotation(t)}function D_(){return Ro().getAllAnnotations()}function a8(t){const{annotationUID:e,parentAnnotationUID:n}=t;if(!n)return;const r=sr(n),i=r.childAnnotationUIDs.indexOf(e);r.childAnnotationUIDs.splice(i,1),t.parentAnnotationUID=void 0}function o8(t,e){const{annotationUID:n}=t,{annotationUID:r}=e;a8(e),t.childAnnotationUIDs||(t.childAnnotationUIDs=[]),!t.childAnnotationUIDs.includes(r)&&(t.childAnnotationUIDs.push(r),e.parentAnnotationUID=n)}function R_(t){return t.parentAnnotationUID?sr(t.parentAnnotationUID):void 0}function s8(t){var e;return((e=t.childAnnotationUIDs)==null?void 0:e.map(n=>sr(n)))??[]}function il(t,e){t.annotationUID||(t.annotationUID=In());const n=Ro();if(e instanceof HTMLDivElement){const r=n.getGroupKey(e);n.addAnnotation(t,r),x_(t,e)}else n.addAnnotation(t,void 0),S_(t);return t.annotationUID}function Nie(t,e){const n=Ro(),r=n.getGroupKey(e);return n.getNumberOfAnnotations(r,t)}function al(t){var r;if(!t)return;const e=Ro(),n=e.getAnnotation(t);n&&((r=n.childAnnotationUIDs)==null||r.forEach(i=>al(i)),e.removeAnnotation(t),A2({annotation:n,annotationManagerUID:e.uid}))}function kie(){const t=Ro(),e=t.removeAllAnnotations();for(const n of e)A2({annotation:n,annotationManagerUID:t.uid})}function Aie(t,e){const n=Ro(),r=n.getGroupKey(e),i=n.removeAnnotations(r,t);for(const a of i)A2({annotation:a,annotationManagerUID:n.uid})}function M_(t){let e=t;for(;e;)e.invalidated=!0,e=e.parentAnnotationUID?sr(e.parentAnnotationUID):void 0}const Fie=Object.freeze(Object.defineProperty({__proto__:null,addAnnotation:il,addChildAnnotation:o8,clearParentAnnotation:a8,getAllAnnotations:D_,getAnnotation:sr,getAnnotationManager:Ro,getAnnotations:Qg,getChildAnnotations:s8,getNumberOfAnnotations:Nie,getParentAnnotation:R_,invalidateAnnotation:M_,removeAllAnnotations:kie,removeAnnotation:al,removeAnnotations:Aie,setAnnotationManager:i8},Symbol.toStringTag,{value:"Module"}));function sv(t){const e=t.toolName;if($e.tools[e],!e)throw new Error(`No Tool Found for the ToolClass ${t.name}`);$e.tools[e]={toolClass:t}}function Uie(t){return!!$e.tools[t]}function hl(t,e){const n=e||t.currentTarget,{viewport:r}=We(n)||{};if(!r)return;const i=$ie(t),a=Gie(t),o=Bie(n,a),s=r.canvasToWorld(o);return{page:a,client:i,canvas:o,world:s}}function Bie(t,e){const n=t.getBoundingClientRect();return[e[0]-n.left-window.pageXOffset,e[1]-n.top-window.pageYOffset]}function Gie(t){return[t.pageX,t.pageY]}function $ie(t){return[t.clientX,t.clientY]}function __(t){const e=t.currentTarget,{viewportId:n,renderingEngineId:r}=We(e),i=hl(t,e),a={page:[0,0],client:[0,0],canvas:[0,0],world:[0,0,0]},o={event:t,eventName:he.MOUSE_DOUBLE_CLICK,viewportId:n,renderingEngineId:r,camera:{},element:e,startPoints:i,lastPoints:i,currentPoints:i,deltaPoints:a};!De(e,he.MOUSE_DOUBLE_CLICK,o)&&(t.stopImmediatePropagation(),t.preventDefault())}const MT=he.MOUSE_MOVE;function Rd(t){const e=t.currentTarget,n=We(e);if(!n)return;const{renderingEngineId:r,viewportId:i}=n,a=hl(t);!De(e,MT,{renderingEngineId:r,viewportId:i,camera:{},element:e,currentPoints:a,eventName:MT,event:t})&&(t.stopImmediatePropagation(),t.preventDefault())}const{MOUSE_DOWN:_T,MOUSE_DOWN_ACTIVATE:Wie,MOUSE_CLICK:zie,MOUSE_UP:jie,MOUSE_DRAG:bT}=he,Hie=400,Kie=150,qie=3,Xie={mouseButton:void 0,element:null,renderingEngineId:void 0,viewportId:void 0,isClickEvent:!0,clickDelay:200,preventClickTimeout:null,startPoints:{page:[0,0],client:[0,0],canvas:[0,0],world:[0,0,0]},lastPoints:{page:[0,0],client:[0,0],canvas:[0,0],world:[0,0,0]}};let Ze={mouseButton:void 0,renderingEngineId:void 0,viewportId:void 0,isClickEvent:!0,clickDelay:200,element:null,preventClickTimeout:null,startPoints:{page:[0,0],client:[0,0],canvas:[0,0],world:[0,0,0]},lastPoints:{page:[0,0],client:[0,0],canvas:[0,0],world:[0,0,0]}};const Zn={doubleClickTimeout:null,mouseDownEvent:null,mouseUpEvent:null,ignoreDoubleClick:!1};function b_(t){if(Zn.doubleClickTimeout){if(t.buttons===Zn.mouseDownEvent.buttons)return;Zn.mouseDownEvent=t,Fh();return}Zn.doubleClickTimeout=setTimeout(Fh,t.buttons===1?Hie:Kie),Zn.mouseDownEvent=t,Zn.ignoreDoubleClick=!1,Ze.element=t.currentTarget,Ze.mouseButton=t.buttons;const e=We(Ze.element),{renderingEngineId:n,viewportId:r}=e;Ze.renderingEngineId=n,Ze.viewportId=r,Ze.preventClickTimeout=setTimeout(Zie,Ze.clickDelay),Ze.element.removeEventListener("mousemove",Rd);const i=hl(t,Ze.element);Ze.startPoints=wc(i),Ze.lastPoints=wc(i),document.addEventListener("mouseup",c8),document.addEventListener("mousemove",L_)}function Yie(t){const e=F2(Ze.startPoints,Ze.startPoints),n={event:t,eventName:_T,element:Ze.element,mouseButton:Ze.mouseButton,renderingEngineId:Ze.renderingEngineId,viewportId:Ze.viewportId,camera:{},startPoints:Ze.startPoints,lastPoints:Ze.startPoints,currentPoints:Ze.startPoints,deltaPoints:e};Ze.lastPoints=wc(n.lastPoints),De(n.element,_T,n)&&De(n.element,Wie,n)}function L_(t){const e=We(Ze.element);if(!(e!=null&&e.viewport))return;const n=hl(t,Ze.element),r=N_(Ze.element,Ze.lastPoints),i=F2(n,r);if(Zn.doubleClickTimeout)if(V_(i.canvas))Fh();else return;const a={event:t,eventName:bT,mouseButton:Ze.mouseButton,renderingEngineId:Ze.renderingEngineId,viewportId:Ze.viewportId,camera:{},element:Ze.element,startPoints:wc(Ze.startPoints),lastPoints:wc(r),currentPoints:n,deltaPoints:i};!De(Ze.element,bT,a)&&(t.stopImmediatePropagation(),t.preventDefault()),Ze.lastPoints=wc(n)}function c8(t){if(clearTimeout(Ze.preventClickTimeout),Zn.doubleClickTimeout)Zn.mouseUpEvent?cv():(Zn.mouseUpEvent=t,Ze.element.addEventListener("mousemove",I_));else{const e=Ze.isClickEvent?zie:jie,n=hl(t,Ze.element),r=F2(n,Ze.lastPoints),i={event:t,eventName:e,mouseButton:Ze.mouseButton,element:Ze.element,renderingEngineId:Ze.renderingEngineId,viewportId:Ze.viewportId,camera:{},startPoints:wc(Ze.startPoints),lastPoints:wc(Ze.lastPoints),currentPoints:n,deltaPoints:r};De(i.element,e,i),cv()}document.removeEventListener("mousemove",L_)}function I_(t){const e=hl(t,Ze.element),n=N_(Ze.element,Ze.lastPoints),r=F2(e,n);V_(r.canvas)&&(Fh(),Rd(t))}function V_(t){return Math.abs(t[0])+Math.abs(t[1])>qie}function Zie(){Ze.isClickEvent=!1}function Fh(){Zn.ignoreDoubleClick=!0;const t=Zn.mouseDownEvent,e=Zn.mouseUpEvent;P_(),Yie(t),e&&c8(e)}function P_(){Zn.doubleClickTimeout&&(clearTimeout(Zn.doubleClickTimeout),Zn.doubleClickTimeout=null),Zn.mouseDownEvent=null,Zn.mouseUpEvent=null}function cv(){var t,e;document.removeEventListener("mouseup",c8),(t=Ze.element)==null||t.removeEventListener("mousemove",I_),(e=Ze.element)==null||e.addEventListener("mousemove",Rd),P_(),Ze=JSON.parse(JSON.stringify(Xie))}function wc(t){return JSON.parse(JSON.stringify(t))}function N_(t,e){const{viewport:n}=We(t)||{};if(!n)return e;const r=n.canvasToWorld(e.canvas);return{page:e.page,client:e.client,canvas:e.canvas,world:r}}function F2(t,e){return!t||!e?{page:[0,0],client:[0,0],canvas:[0,0],world:[0,0,0]}:{page:um(t.page,e.page),client:um(t.client,e.client),canvas:um(t.canvas,e.canvas),world:Qie(t.world,e.world)}}function um(t,e){return[t[0]-e[0],t[1]-e[1]]}function Qie(t,e){return[t[0]-e[0],t[1]-e[1],t[2]-e[2]]}function Jie(){return Ze.mouseButton}function k_(t){Zn.ignoreDoubleClick?(Zn.ignoreDoubleClick=!1,t.stopImmediatePropagation(),t.preventDefault()):cv()}function A_(t){t.removeEventListener("dblclick",__),t.removeEventListener("mousedown",b_),t.removeEventListener("mousemove",Rd),t.removeEventListener("dblclick",k_,{capture:!0})}function eae(t){A_(t),t.addEventListener("dblclick",__),t.addEventListener("mousedown",b_),t.addEventListener("mousemove",Rd),t.addEventListener("dblclick",k_,{capture:!0})}const F_={enable:eae,disable:A_},tae=2e3,Nu={mouse:0,touch:1};let LT,IT;function U_(t,e){const n=Date.now();if(t!==LT){if(n-IT<=tae)return e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation(),!1;LT=t}IT=n}const B_=U_.bind(null,Nu.mouse),G_=U_.bind(null,Nu.touch);function VT(t,e,n){const r=n?B_:G_;e.forEach(function(i){t.addEventListener(i,r,{passive:!1})})}function PT(t,e,n){const r=n?B_:G_;e.forEach(function(i){t.removeEventListener(i,r)})}const $_=["mousedown","mouseup","mousemove"],W_=["touchstart","touchend"];function z_(t){PT(t,$_,Nu.mouse),PT(t,W_,Nu.touch)}function nae(t){z_(t),VT(t,$_,Nu.mouse),VT(t,W_,Nu.touch)}const j_={enable:nae,disable:z_};function U2(t,e){const n=e||t.currentTarget,r=t.type==="touchend"?t.changedTouches:t.touches;return Object.keys(r).map(i=>{const a=aae(r[i]),o=iae(r[i]),s=rae(n,o),{viewport:c}=We(n),l=c.canvasToWorld(s);return{page:o,client:a,canvas:s,world:l,touch:{identifier:i,radiusX:r[i].radiusX,radiusY:r[i].radiusY,force:r[i].force,rotationAngle:r[i].rotationAngle}}})}function rae(t,e){const n=t.getBoundingClientRect();return[e[0]-n.left-window.pageXOffset,e[1]-n.top-window.pageYOffset]}function iae(t){return[t.pageX,t.pageY]}function aae(t){return[t.clientX,t.clientY]}function lv(t,e){const n=Uh(t),r=Uh(e);return{page:fm(n.page,r.page),client:fm(n.client,r.client),canvas:fm(n.canvas,r.canvas),world:oae(n.world,r.world)}}function H_(t,e){const n=Uh(t),r=Uh(e);return{page:du(n.page,r.page),client:du(n.client,r.client),canvas:du(n.canvas,r.canvas),world:K_(n.world,r.world)}}function uv(t,e){const n=kT(t),r=kT(e);return{page:n.page-r.page,client:n.client-r.client,canvas:n.canvas-r.canvas,world:n.world-r.world}}function ls(t){return JSON.parse(JSON.stringify(t))}function NT(t){return JSON.parse(JSON.stringify(t))}function Uh(t){return t.reduce((e,n)=>({page:[e.page[0]+n.page[0]/t.length,e.page[1]+n.page[1]/t.length],client:[e.client[0]+n.client[0]/t.length,e.client[1]+n.client[1]/t.length],canvas:[e.canvas[0]+n.canvas[0]/t.length,e.canvas[1]+n.canvas[1]/t.length],world:[e.world[0]+n.world[0]/t.length,e.world[1]+n.world[1]/t.length,e.world[2]+n.world[2]/t.length]}),{page:[0,0],client:[0,0],canvas:[0,0],world:[0,0,0]})}function po(t){return t.reduce((e,n)=>({page:[e.page[0]+n.page[0]/t.length,e.page[1]+n.page[1]/t.length],client:[e.client[0]+n.client[0]/t.length,e.client[1]+n.client[1]/t.length],canvas:[e.canvas[0]+n.canvas[0]/t.length,e.canvas[1]+n.canvas[1]/t.length],world:[e.world[0]+n.world[0]/t.length,e.world[1]+n.world[1]/t.length,e.world[2]+n.world[2]/t.length],touch:{identifier:null,radiusX:e.touch.radiusX+n.touch.radiusX/t.length,radiusY:e.touch.radiusY+n.touch.radiusY/t.length,force:e.touch.force+n.touch.force/t.length,rotationAngle:e.touch.rotationAngle+n.touch.rotationAngle/t.length}}),{page:[0,0],client:[0,0],canvas:[0,0],world:[0,0,0],touch:{identifier:null,radiusX:0,radiusY:0,force:0,rotationAngle:0}})}function fm(t,e){return[t[0]-e[0],t[1]-e[1]]}function oae(t,e){return[t[0]-e[0],t[1]-e[1],t[2]-e[2]]}function kT(t){const e=[];for(let n=0;n<t.length;n++)for(let r=0;r<t.length;r++)n<r&&e.push({page:du(t[n].page,t[r].page),client:du(t[n].client,t[r].client),canvas:du(t[n].canvas,t[r].canvas),world:K_(t[n].world,t[r].world)});return e.reduce((n,r)=>({page:n.page+r.page/e.length,client:n.client+r.client/e.length,canvas:n.canvas+r.canvas/e.length,world:n.world+r.world/e.length}),{page:0,client:0,canvas:0,world:0})}function du(t,e){return Math.sqrt(Math.pow(t[0]-e[0],2)+Math.pow(t[1]-e[1],2))}function K_(t,e){return Math.sqrt(Math.pow(t[0]-e[0],2)+Math.pow(t[1]-e[1],2)+Math.pow(t[2]-e[2],2))}jt.getRuntimeSettings();const{TOUCH_START:AT,TOUCH_START_ACTIVATE:sae,TOUCH_PRESS:FT,TOUCH_DRAG:UT,TOUCH_END:BT,TOUCH_TAP:GT,TOUCH_SWIPE:gm}=he,Jg={page:[0,0],client:[0,0],canvas:[0,0],world:[0,0,0]},Bh={page:0,client:0,canvas:0,world:0},q_={renderingEngineId:void 0,viewportId:void 0,element:null,startPointsList:[{...Jg,touch:null}],lastPointsList:[{...Jg,touch:null}],isTouchStart:!1,startTime:null,pressTimeout:null,pressDelay:700,pressMaxDistance:5,accumulatedDistance:Bh,swipeDistanceThreshold:48,swiped:!1,swipeToleranceMs:300},X_={renderingEngineId:void 0,viewportId:void 0,element:null,startPointsList:[{...Jg,touch:null}],taps:0,tapTimeout:null,tapMaxDistance:24,tapToleranceMs:300};let Ne=JSON.parse(JSON.stringify(q_)),On=JSON.parse(JSON.stringify(X_));function Rc(t,e,n){return De(t,e,n)}function Y_(t){Ne.element=t.currentTarget;const e=We(Ne.element),{renderingEngineId:n,viewportId:r}=e;Ne.renderingEngineId=n,Ne.viewportId=r,!Ne.isTouchStart&&(clearTimeout(Ne.pressTimeout),Ne.pressTimeout=setTimeout(()=>cae(t),Ne.pressDelay),lae(t),document.addEventListener("touchmove",Z_),document.addEventListener("touchend",Q_))}function cae(t){if(Ne.accumulatedDistance.canvas>Ne.pressMaxDistance)return;const n={event:t,eventName:FT,renderingEngineId:Ne.renderingEngineId,viewportId:Ne.viewportId,camera:{},element:Ne.element,startPointsList:ls(Ne.startPointsList),lastPointsList:ls(Ne.lastPointsList),startPoints:NT(po(Ne.startPointsList)),lastPoints:NT(po(Ne.lastPointsList))};Rc(n.element,FT,n)}function lae(t){Ne.isTouchStart=!0,Ne.startTime=new Date;const e=U2(t,Ne.element),n=po(e),r=Jg,i=Bh,a={event:t,eventName:AT,element:Ne.element,renderingEngineId:Ne.renderingEngineId,viewportId:Ne.viewportId,camera:{},startPointsList:e,lastPointsList:e,currentPointsList:e,startPoints:n,lastPoints:n,currentPoints:n,deltaPoints:r,deltaDistance:i};Ne.startPointsList=ls(a.startPointsList),Ne.lastPointsList=ls(a.lastPointsList),Rc(a.element,AT,a)&&Rc(a.element,sae,a)}function Z_(t){const e=U2(t,Ne.element),n=J_(Ne.element,Ne.lastPointsList),r=e.length===n.length?lv(e,n):Jg,i=e.length===n.length?uv(e,n):Bh,a=e.length===n.length?H_(e,Ne.lastPointsList):Bh;Ne.accumulatedDistance={page:Ne.accumulatedDistance.page+a.page,client:Ne.accumulatedDistance.client+a.client,canvas:Ne.accumulatedDistance.canvas+a.canvas,world:Ne.accumulatedDistance.world+a.world};const o={event:t,eventName:UT,renderingEngineId:Ne.renderingEngineId,viewportId:Ne.viewportId,camera:{},element:Ne.element,startPoints:po(Ne.startPointsList),lastPoints:po(n),currentPoints:po(e),startPointsList:ls(Ne.startPointsList),lastPointsList:ls(n),currentPointsList:e,deltaPoints:r,deltaDistance:i};Rc(Ne.element,UT,o),fae(t,r),Ne.lastPointsList=ls(e)}function Q_(t){clearTimeout(Ne.pressTimeout);const e=U2(t,Ne.element),n=J_(Ne.element,Ne.lastPointsList),r=e.length===n.length?lv(e,n):lv(e,e),i=e.length===n.length?uv(e,n):uv(e,e),a={event:t,eventName:BT,element:Ne.element,renderingEngineId:Ne.renderingEngineId,viewportId:Ne.viewportId,camera:{},startPointsList:ls(Ne.startPointsList),lastPointsList:ls(n),currentPointsList:e,startPoints:po(Ne.startPointsList),lastPoints:po(n),currentPoints:po(e),deltaPoints:r,deltaDistance:i};Rc(a.element,BT,a),uae(t),Ne=JSON.parse(JSON.stringify(q_)),document.removeEventListener("touchmove",Z_),document.removeEventListener("touchend",Q_)}function uae(t){const e=new Date().getTime(),n=Ne.startTime.getTime();if(e-n>On.tapToleranceMs||(On.taps===0&&(On.element=Ne.element,On.renderingEngineId=Ne.renderingEngineId,On.viewportId=Ne.viewportId,On.startPointsList=Ne.startPointsList),On.taps>0&&!(On.element==Ne.element&&On.renderingEngineId==Ne.renderingEngineId&&On.viewportId==Ne.viewportId)))return;const r=U2(t,On.element);H_(r,On.startPointsList).canvas>On.tapMaxDistance||(clearTimeout(On.tapTimeout),On.taps+=1,On.tapTimeout=setTimeout(()=>{const a={event:t,eventName:GT,element:On.element,renderingEngineId:On.renderingEngineId,viewportId:On.viewportId,camera:{},currentPointsList:r,currentPoints:po(r),taps:On.taps};Rc(a.element,GT,a),On=JSON.parse(JSON.stringify(X_))},On.tapToleranceMs))}function fae(t,e){const n=new Date().getTime(),r=Ne.startTime.getTime();if(Ne.swiped||n-r>Ne.swipeToleranceMs)return;const[i,a]=e.canvas,o={event:t,eventName:gm,renderingEngineId:Ne.renderingEngineId,viewportId:Ne.viewportId,camera:{},element:Ne.element,swipe:null};Math.abs(i)>Ne.swipeDistanceThreshold&&(o.swipe=i>0?Kl.RIGHT:Kl.LEFT,Rc(o.element,gm,o),Ne.swiped=!0),Math.abs(a)>Ne.swipeDistanceThreshold&&(o.swipe=a>0?Kl.DOWN:Kl.UP,Rc(o.element,gm,o),Ne.swiped=!0)}function J_(t,e){const{viewport:n}=We(t);return e.map(r=>{const i=n.canvasToWorld(r.canvas);return{page:r.page,client:r.client,canvas:r.canvas,world:i,touch:r.touch}})}function eb(t){j_.disable(t),t.removeEventListener("touchstart",Y_)}function gae(t){eb(t),j_.enable(t),t.addEventListener("touchstart",Y_,{passive:!1})}const tb={enable:gae,disable:eb},$T=10,WT=40,zT=800;function dae(t){let e=0,n=0,r=0,i=0;return"detail"in t&&(n=t.detail),"wheelDelta"in t&&(n=-t.wheelDelta/120),"wheelDeltaY"in t&&(n=-t.wheelDeltaY/120),"wheelDeltaX"in t&&(e=-t.wheelDeltaX/120),r=e*$T,i=n*$T,"deltaY"in t&&(i=t.deltaY),"deltaX"in t&&(r=t.deltaX),(r||i)&&t.deltaMode&&(t.deltaMode===1?(r*=WT,i*=WT):(r*=zT,i*=zT)),r&&!e&&(e=r<1?-1:1),i&&!n&&(n=i<1?-1:1),{spinX:e,spinY:n,pixelX:r,pixelY:i}}function nb(t){const e=t.currentTarget,n=We(e),{renderingEngineId:r,viewportId:i}=n;if(t.deltaY>-1&&t.deltaY<1)return;t.preventDefault();const{spinX:a,spinY:o,pixelX:s,pixelY:c}=dae(t),l=o<0?-1:1,f={event:t,eventName:he.MOUSE_WHEEL,renderingEngineId:r,viewportId:i,element:e,camera:{},detail:t,wheel:{spinX:a,spinY:o,pixelX:s,pixelY:c,direction:l},points:hl(t)};De(e,he.MOUSE_WHEEL,f)}function pae(t){rb(t),t.addEventListener("wheel",nb,{passive:!1})}function rb(t){t.removeEventListener("wheel",nb)}const ib={enable:pae,disable:rb},hae={renderingEngineId:void 0,viewportId:void 0,key:void 0,keyCode:void 0,element:null};let Bn={renderingEngineId:void 0,viewportId:void 0,key:void 0,keyCode:void 0,element:null};function B2(t){Bn.element=t.currentTarget;const e=We(Bn.element),{renderingEngineId:n,viewportId:r}=e;Bn.renderingEngineId=n,Bn.viewportId=r,Bn.key=t.key,Bn.keyCode=t.keyCode,t.preventDefault();const i={renderingEngineId:Bn.renderingEngineId,viewportId:Bn.viewportId,element:Bn.element,key:Bn.key,keyCode:Bn.keyCode};De(i.element,he.KEY_DOWN,i),document.addEventListener("keyup",ab),document.addEventListener("visibilitychange",l8),Bn.element.removeEventListener("keydown",B2)}function l8(){document.removeEventListener("visibilitychange",l8),document.visibilityState==="hidden"&&ob()}function ab(t){const e={renderingEngineId:Bn.renderingEngineId,viewportId:Bn.viewportId,element:Bn.element,key:Bn.key,keyCode:Bn.keyCode};document.removeEventListener("keyup",ab),document.removeEventListener("visibilitychange",l8),Bn.element.addEventListener("keydown",B2),Bn=structuredClone(hae),De(e.element,he.KEY_UP,e)}function mae(){return Bn.keyCode}function ob(){Bn.keyCode=void 0}function vae(t){sb(t),t.addEventListener("keydown",B2)}function sb(t){t.removeEventListener("keydown",B2)}const af={enable:vae,disable:sb,getModifierKey:mae},u8=new Map,yae=t=>{const e=u8.get(t);e&&(e.isDirty=!0)},Tae=t=>{const e=u8.get(t);return e&&!e.isDirty?e.indices:null},Cae=(t,e)=>{u8.set(t,{indices:e,isDirty:!1})};function G2(t,e,n){const r={segmentationId:t,modifiedSlicesToUse:e,segmentIndex:n};yae(t),De(Ee,he.SEGMENTATION_DATA_MODIFIED,r)}function ku(t){const e={segmentationId:t};De(Ee,he.SEGMENTATION_MODIFIED,e)}function wae(t){const e={segmentationId:t};De(Ee,he.SEGMENTATION_REMOVED,e)}function b1(t,e,n){const r={segmentationId:e,type:n,viewportId:t};De(Ee,he.SEGMENTATION_REPRESENTATION_MODIFIED,r)}function jT(t,e,n){const r={viewportId:t,segmentationId:e,type:n};De(Ee,he.SEGMENTATION_REPRESENTATION_REMOVED,r)}const xae={renderOutline:!0,outlineWidthAutoGenerated:3,outlineWidth:1,outlineWidthInactive:1,outlineOpacity:1,outlineOpacityInactive:.85,outlineDash:void 0,outlineDashInactive:void 0,outlineDashAutoGenerated:"5,3",activeSegmentOutlineWidthDelta:0,renderFill:!0,fillAlpha:.5,fillAlphaInactive:.3,fillAlphaAutoGenerated:.3};function Sae(){return xae}const Eae={renderOutline:!0,renderOutlineInactive:!0,outlineWidth:3,outlineWidthInactive:2,activeSegmentOutlineWidthDelta:0,renderFill:!0,renderFillInactive:!0,fillAlpha:.5,fillAlphaInactive:.4,outlineOpacity:1,outlineOpacityInactive:.85};function Oae(){return Eae}class Dae{constructor(){this.config={global:{},segmentations:{},viewportsStyle:{}}}setStyle(e,n){const{viewportId:r,segmentationId:i,type:a,segmentIndex:o}=e,s=this.getStyle(e);let c;if(!r&&!i?c={...s,...n}:c=this.copyActiveToInactiveIfNotProvided({...s,...n},a),!a)throw new Error("Type is required to set a style");if(r){this.config.viewportsStyle[r]||(this.config.viewportsStyle[r]={renderInactiveSegmentations:!1,representations:{}});const l=this.config.viewportsStyle[r].representations;if(i){l[i]||(l[i]={}),l[i][a]||(l[i][a]={});const f=l[i][a];o!==void 0?(f.perSegment||(f.perSegment={}),f.perSegment[o]=c):f.allSegments=c}else{const f="__allSegmentations__";l[f]||(l[f]={}),l[f][a]||(l[f][a]={}),l[f][a].allSegments=c}}else if(i){this.config.segmentations[i]||(this.config.segmentations[i]={}),this.config.segmentations[i][a]||(this.config.segmentations[i][a]={});const l=this.config.segmentations[i][a];o!==void 0?(l.perSegment||(l.perSegment={}),l.perSegment[o]=c):l.allSegments=c}else this.config.global[a]=c}copyActiveToInactiveIfNotProvided(e,n){const r={...e};if(n===je.Labelmap){const i=r;i.renderOutlineInactive??(i.renderOutlineInactive=i.renderOutline),i.outlineWidthInactive??(i.outlineWidthInactive=i.outlineWidth),i.renderFillInactive??(i.renderFillInactive=i.renderFill),i.fillAlphaInactive??(i.fillAlphaInactive=i.fillAlpha),i.outlineOpacityInactive??(i.outlineOpacityInactive=i.outlineOpacity)}else if(n===je.Contour){const i=r;i.outlineWidthInactive??(i.outlineWidthInactive=i.outlineWidth),i.outlineOpacityInactive??(i.outlineOpacityInactive=i.outlineOpacity),i.outlineDashInactive??(i.outlineDashInactive=i.outlineDash),i.renderOutlineInactive??(i.renderOutlineInactive=i.renderOutline),i.renderFillInactive??(i.renderFillInactive=i.renderFill),i.fillAlphaInactive??(i.fillAlphaInactive=i.fillAlpha)}return r}getStyle(e){var s,c,l,f,u;const{viewportId:n,segmentationId:r,type:i,segmentIndex:a}=e;let o=this.getDefaultStyle(i);if(this.config.global[i]&&(o={...o,...this.config.global[i]}),(s=this.config.segmentations[r])!=null&&s[i]&&(o={...o,...this.config.segmentations[r][i].allSegments},a!==void 0&&((c=this.config.segmentations[r][i].perSegment)!=null&&c[a])&&(o={...o,...this.config.segmentations[r][i].perSegment[a]})),n&&this.config.viewportsStyle[n]){this.config.viewportsStyle[n].renderInactiveSegmentations;const g="__allSegmentations__";(l=this.config.viewportsStyle[n].representations[g])!=null&&l[i]&&(o={...o,...this.config.viewportsStyle[n].representations[g][i].allSegments}),r&&((f=this.config.viewportsStyle[n].representations[r])!=null&&f[i])&&(o={...o,...this.config.viewportsStyle[n].representations[r][i].allSegments},a!==void 0&&((u=this.config.viewportsStyle[n].representations[r][i].perSegment)!=null&&u[a])&&(o={...o,...this.config.viewportsStyle[n].representations[r][i].perSegment[a]}))}return o}getRenderInactiveSegmentations(e){var n;return(n=this.config.viewportsStyle[e])==null?void 0:n.renderInactiveSegmentations}setRenderInactiveSegmentations(e,n){this.config.viewportsStyle[e]||(this.config.viewportsStyle[e]={renderInactiveSegmentations:!1,representations:{}}),this.config.viewportsStyle[e].renderInactiveSegmentations=n}getDefaultStyle(e){switch(e){case je.Labelmap:return Oae();case je.Contour:return Sae();case je.Surface:return{};default:throw new Error(`Unknown representation type: ${e}`)}}clearSegmentationStyle(e){this.config.segmentations[e]&&delete this.config.segmentations[e]}clearAllSegmentationStyles(){this.config.segmentations={}}clearViewportStyle(e){this.config.viewportsStyle[e]&&delete this.config.viewportsStyle[e]}clearAllViewportStyles(){for(const e in this.config.viewportsStyle){const r=this.config.viewportsStyle[e].renderInactiveSegmentations;this.config.viewportsStyle[e]={renderInactiveSegmentations:r,representations:{}}}}resetToGlobalStyle(){this.clearAllSegmentationStyles(),this.clearAllViewportStyles()}hasCustomStyle(e){const{type:n}=e,r=this.getStyle(e),i=this.getDefaultStyle(n);return!uM(r,i)}}const $0=new Dae;function Rae(t){const e={segmentationId:t};De(Ee,he.SEGMENTATION_ADDED,e)}const HT={colorLUT:[],segmentations:[],viewportSegRepresentations:{}};class Mae{constructor(e){this._stackLabelmapImageIdReferenceMap=new Map,e||(e=In()),this.state=Object.freeze(ka(HT)),this.uid=e}getState(){return this.state}updateState(e){const n=ka(this.state);e(n),this.state=Object.freeze(n)}getColorLUT(e){return this.state.colorLUT[e]}getNextColorLUTIndex(){return this.state.colorLUT.length}resetState(){this.state=Object.freeze(ka(HT))}getSegmentation(e){return this.state.segmentations.find(n=>n.segmentationId===e)}updateSegmentation(e,n){this.updateState(r=>{const i=r.segmentations.find(a=>a.segmentationId===e);if(!i){console.warn(`Segmentation with id ${e} not found. Update aborted.`);return}Object.assign(i,n)}),ku(e)}addSegmentation(e){if(this.getSegmentation(e.segmentationId))throw new Error(`Segmentation with id ${e.segmentationId} already exists`);this.updateState(n=>{const r=ka(e);if(r.representationData.Labelmap&&"volumeId"in r.representationData.Labelmap&&!("imageIds"in r.representationData.Labelmap)){const i=this.getLabelmapImageIds(r.representationData);r.representationData.Labelmap.imageIds=i}n.segmentations.push(r)}),Rae(e.segmentationId)}removeSegmentation(e){this.updateState(n=>{const r=n.segmentations.filter(i=>i.segmentationId!==e);n.segmentations.splice(0,n.segmentations.length,...r)}),wae(e)}addSegmentationRepresentation(e,n,r,i){if(!Dr(e))return;if(this.getSegmentationRepresentations(e,{type:r,segmentationId:n}).length>0){console.debug("A segmentation representation of type",r,"already exists in viewport",e,"for segmentation",n);return}this.updateState(s=>{s.viewportSegRepresentations[e]||(s.viewportSegRepresentations[e]=[],$0.setRenderInactiveSegmentations(e,!0)),r!==je.Labelmap?this.addDefaultSegmentationRepresentation(s,e,n,r,i):this.addLabelmapRepresentation(s,e,n,i)}),b1(e,n,r)}addDefaultSegmentationRepresentation(e,n,r,i,a){const o=e.segmentations.find(c=>c.segmentationId===r);if(!o)return;const s={};Object.keys(o.segments).forEach(c=>{s[Number(c)]={visible:!0}}),e.viewportSegRepresentations[n].push({segmentationId:r,type:i,active:!0,visible:!0,colorLUTIndex:(a==null?void 0:a.colorLUTIndex)||0,segments:s,config:{...KT(i),...a}}),this._setActiveSegmentation(e,n,r)}addLabelmapRepresentation(e,n,r,i=KT(je.Labelmap)){if(!Dr(n))return;const o=this.getSegmentation(r);if(!o)return;const{representationData:s}=o;if(!s.Labelmap)return this.addDefaultSegmentationRepresentation(e,n,r,je.Labelmap,i);this.processLabelmapRepresentationAddition(n,r),this.addDefaultSegmentationRepresentation(e,n,r,je.Labelmap,i)}async processLabelmapRepresentationAddition(e,n){const r=Dr(e);if(!r)return;const i=this.getSegmentation(n);if(!i)return;const a=r.viewport instanceof za,{representationData:o}=i,s="volumeId"in o.Labelmap;r.viewport,!a&&!s&&this.updateLabelmapSegmentationImageReferences(e,i.segmentationId)}_updateLabelmapSegmentationReferences(e,n,r,i){const a=n.getCurrentImageId();let o=!1;for(const s of r)n.isReferenceViewable({referencedImageId:s},{asOverlay:!0})&&(o=!0,this._stackLabelmapImageIdReferenceMap.get(e).set(a,s));return i&&i(n,e,r),o?this._stackLabelmapImageIdReferenceMap.get(e).get(a):void 0}updateLabelmapSegmentationImageReferences(e,n){const r=this.getSegmentation(n);if(!r)return;this._stackLabelmapImageIdReferenceMap.has(n)||this._stackLabelmapImageIdReferenceMap.set(n,new Map);const{representationData:i}=r;if(!i.Labelmap)return;const a=this.getLabelmapImageIds(i),s=Dr(e).viewport;return this._updateLabelmapSegmentationReferences(n,s,a,null)}_updateAllLabelmapSegmentationImageReferences(e,n){const r=this.getSegmentation(n);if(!r)return;this._stackLabelmapImageIdReferenceMap.has(n)||this._stackLabelmapImageIdReferenceMap.set(n,new Map);const{representationData:i}=r;if(!i.Labelmap)return;const a=this.getLabelmapImageIds(i),s=Dr(e).viewport;this._updateLabelmapSegmentationReferences(n,s,a,(c,l,f)=>{c.getImageIds().forEach((g,d)=>{for(const h of f)c.isReferenceViewable({referencedImageId:h,sliceIndex:d},{asOverlay:!0,withNavigation:!0})&&this._stackLabelmapImageIdReferenceMap.get(l).set(g,h)})})}getLabelmapImageIds(e){const n=e.Labelmap;let r;if(n.imageIds)r=n.imageIds;else if(!r&&n.volumeId){const i=n.volumeId;r=Me.getVolume(i).imageIds}return r}getCurrentLabelmapImageIdForViewport(e,n){const r=Dr(e);if(!r||!this._stackLabelmapImageIdReferenceMap.has(n))return;const a=r.viewport.getCurrentImageId();return this._stackLabelmapImageIdReferenceMap.get(n).get(a)}getStackSegmentationImageIdsForViewport(e,n){if(!this.getSegmentation(n))return[];this._updateAllLabelmapSegmentationImageReferences(e,n);const{viewport:i}=Dr(e),a=i.getImageIds(),o=this._stackLabelmapImageIdReferenceMap.get(n);return a.map(s=>o.get(s))}removeSegmentationRepresentationsInternal(e,n){const r=[];return this.updateState(i=>{if(!i.viewportSegRepresentations[e])return;const a=i.viewportSegRepresentations[e];let o=!1;if(!n||Object.values(n).every(s=>s===void 0))r.push(...a),delete i.viewportSegRepresentations[e];else{const{segmentationId:s,type:c}=n;i.viewportSegRepresentations[e]=a.filter(l=>{const f=s&&c&&l.segmentationId===s&&l.type===c||s&&!c&&l.segmentationId===s||!s&&c&&l.type===c;return f&&(r.push(l),l.active&&(o=!0)),!f}),i.viewportSegRepresentations[e].length===0?delete i.viewportSegRepresentations[e]:o&&(i.viewportSegRepresentations[e][0].active=!0)}}),r}removeSegmentationRepresentations(e,n){const r=this.removeSegmentationRepresentationsInternal(e,n);r.forEach(a=>{jT(e,a.segmentationId,a.type)});const i=this.getSegmentationRepresentations(e);return i.length>0&&i[0].active&&b1(e,i[0].segmentationId,i[0].type),r}removeSegmentationRepresentation(e,n,r){const i=this.removeSegmentationRepresentationsInternal(e,n);return r||i.forEach(({segmentationId:a,type:o})=>{jT(e,a,o)}),i}_setActiveSegmentation(e,n,r){const i=e.viewportSegRepresentations[n];i&&i.forEach(a=>{a.active=a.segmentationId===r})}setActiveSegmentation(e,n){this.updateState(r=>{const i=r.viewportSegRepresentations[e];i&&i.forEach(a=>{a.active=a.segmentationId===n})}),b1(e,n)}getActiveSegmentation(e){if(!this.state.viewportSegRepresentations[e])return;const n=this.state.viewportSegRepresentations[e].find(r=>r.active);if(n)return this.getSegmentation(n.segmentationId)}getSegmentationRepresentations(e,n={}){const r=this.state.viewportSegRepresentations[e];return r?!n.type&&!n.segmentationId?r:r.filter(i=>{const a=n.type?i.type===n.type:!0,o=n.segmentationId?i.segmentationId===n.segmentationId:!0;return a&&o}):[]}getSegmentationRepresentation(e,n){return this.getSegmentationRepresentations(e,n)[0]}getSegmentationRepresentationVisibility(e,n){const r=this.getSegmentationRepresentation(e,n);return r==null?void 0:r.visible}setSegmentationRepresentationVisibility(e,n,r){this.updateState(i=>{const a=this.getSegmentationRepresentations(e,n);a&&a.forEach(o=>{o.visible=r,Object.entries(o.segments).forEach(([s,c])=>{c.visible=r})})}),b1(e,n.segmentationId,n.type)}addColorLUT(e,n){this.updateState(r=>{r.colorLUT[n]&&console.warn("Color LUT table already exists, overwriting"),r.colorLUT[n]=ka(e)})}removeColorLUT(e){this.updateState(n=>{delete n.colorLUT[e]})}_getStackIdForImageIds(e){return e.map(n=>n.slice(-Math.round(n.length*.15))).join("_")}getAllViewportSegmentationRepresentations(){return Object.entries(this.state.viewportSegRepresentations).map(([e,n])=>({viewportId:e,representations:n}))}getSegmentationRepresentationsBySegmentationId(e){const n=[];return Object.entries(this.state.viewportSegRepresentations).forEach(([r,i])=>{const a=i.filter(o=>o.segmentationId===e);a.length>0&&n.push({viewportId:r,representations:a})}),n}}async function _ae({imageIds:t,options:e}){const n=t,r=(e==null?void 0:e.volumeId)||In();return await Ry(r,n),{volumeId:r}}function KT(t){const e=Dc.newInstance(),n=Mu.newInstance();return n.addPoint(0,0),t===je.Labelmap?{cfun:e,ofun:n}:{}}const Mo=new Mae("DEFAULT");function W0(t,e={}){return Mo.getSegmentationRepresentations(t,e)}function cb(t,e){const n=Mo;if(!e.segmentationId||!e.type)throw new Error("getSegmentationRepresentation: No segmentationId or type provided, you need to provide at least one of them");const r=n.getSegmentationRepresentations(t,e);return r==null?void 0:r[0]}function lb(t,e,n){const r=Dr(t);if(!r)return;const{renderingEngine:i,viewport:a}=r;if(!i||!a)return;const s=a.getActors().filter(n);return s.length>0?s[0]:void 0}function bae(t,e){const n=pu(t,e);return n==null?void 0:n.uid}function pu(t,e){return lb(t,e,n=>{var r;return(r=n.representationUID)==null?void 0:r.startsWith(`${e}-${je.Labelmap}`)})}function ub(t,e,n){return lb(t,e,r=>{var i;return(i=r.representationUID)==null?void 0:i.startsWith(fb(e,n))})}function Lae(t,e,n){const i=ub(t,e,"");return i==null?void 0:i.uid}function fb(t,e){return`${t}-${je.Surface}-${e}`}function Iae(t,e){const n=We(t),{viewport:r}=n,a=r.getActors().filter(o=>o.uid.startsWith(Lae(r.id,e)));r.removeActors(a.map(o=>o.uid))}function Vae(t,e,n){const r=We(t),{viewport:i}=r,a=ub(i.id,n,e.segmentIndex),o=a==null?void 0:a.actor;if(o){const m=o.getMapper(),v=m.getInputData(),y=e.points,T=e.polys,C=v.getPoints().getData(),w=v.getPolys().getData();if(y.length===C.length&&T.length===w.length)return;const x=Ii.newInstance();x.getPoints().setData(y,3);const O=el.newInstance({values:Float32Array.from(T)});x.setPolys(O),m.setInputData(x),m.modified(),i.getRenderer().resetCameraClippingRange();return}const s=e.points,c=e.polys,l=e.color,f=Ii.newInstance();f.getPoints().setData(s,3);const u=el.newInstance({values:Float32Array.from(c)});f.setPolys(u);const g=J0.newInstance({});let d;g.setInputData(f);const h=tl.newInstance();h.setMapper(g),h.getProperty().setColor(l[0]/255,l[1]/255,l[2]/255),h.getProperty().setLineWidth(2);const p=fb(n,e.segmentIndex);i.addActor({uid:In(),actor:h,clippingFilter:d,representationUID:p}),i.resetCamera(),i.getRenderer().resetCameraClippingRange(),i.render()}function on(t){return Mo.getSegmentation(t)}function f8(t){return Mo.getColorLUT(t)}function Pae(t){if("volumeId"in t){if(t=t,!Me.getVolume(t.volumeId))throw new Error(`volumeId of ${t.volumeId} not found in cache, you should load and cache volume before adding segmentation`)}else if("imageIds"in t){if(t=t,!t.imageIds)throw new Error("The segmentationInput.representationData.imageIds is undefined, please provide a valid representationData.imageIds for stack data")}else throw new Error("The segmentationInput.representationData is undefined, please provide a valid representationData")}function Nae(t){Pae(t)}const kae=new Map([[je.Labelmap,new Set([je.Surface,je.Contour])],[je.Contour,new Set([je.Labelmap,je.Surface])],[je.Surface,new Set([je.Labelmap])]]);function g8(t,e){const{representationData:n}=on(t);return Aae(n).some(i=>Fae(i,e))}function Aae(t){const e=[];return Object.keys(t).forEach(n=>{const r=t[n];let i;switch(n){case je.Labelmap:i=Nae;break}if(i)try{i(r),e.push(n)}catch{console.warn(`Validation failed for labelmap of type ${n}`)}else e.push(n)}),e}async function Fae(t,e){var n;return((n=kae.get(t))==null?void 0:n.has(e))||!1}function Uae({segmentationId:t,type:e,data:n}){const r=on(t);if(!r)throw new Error(`Segmentation ${t} not found`);switch(r.representationData[e]&&console.warn(`Representation data of type ${e} already exists for segmentation ${t}, overwriting it.`),e){case je.Labelmap:n&&(r.representationData[e]=n);break;case je.Contour:n&&(r.representationData[e]=n);break;case je.Surface:n&&(r.representationData[e]=n);break;default:throw new Error(`Invalid representation type ${e}`)}}function gb(t){const e=typeof t;return t!==null&&(e==="object"||e==="function")}function db(t,e,n){let r,i,a,o,s,c,l=0,f=!1,u=!1,g=!0;const d=!e&&e!==0&&typeof window.requestAnimationFrame=="function";if(typeof t!="function")throw new TypeError("Expected a function");e=Number(e)||0,gb(n)&&(f=!!n.leading,u="maxWait"in n,a=u?Math.max(Number(n.maxWait)||0,e):a,g="trailing"in n?!!n.trailing:g);function h(_){const k=r,z=i;return r=i=void 0,l=_,o=t.apply(z,k),o}function p(_,k){return d?window.requestAnimationFrame(_):setTimeout(_,k)}function m(_){if(d)return window.cancelAnimationFrame(_);clearTimeout(_)}function v(_){return l=_,s=p(C,e),f?h(_):o}function y(_){const k=_-c,z=_-l,X=e-k;return u?Math.min(X,a-z):X}function T(_){const k=_-c,z=_-l;return c===void 0||k>=e||k<0||u&&z>=a}function C(){const _=Date.now();if(T(_))return w(_);s=p(C,y(_))}function w(_){return s=void 0,g&&r?h(_):(r=i=void 0,o)}function x(){s!==void 0&&m(s),l=0,r=c=i=s=void 0}function O(){return s===void 0?o:w(Date.now())}function M(){return s!==void 0}function A(..._){const k=Date.now(),z=T(k);if(r=_,i=this,c=k,z){if(s===void 0)return v(c);if(u)return s=p(C,e),h(c)}return s===void 0&&(s=p(C,e)),o}return A.cancel=x,A.flush=O,A.pending=M,A}let qT=!1;function pb(){if(qT)return;qT=!0;const t=()=>new Worker(new URL("/dicom-viewer/assets/polySegConverters-BK6_sTNL.js",import.meta.url),{name:"polySeg",type:"module"}),e=Ic(),n={maxWorkerInstances:1,autoTerminateOnIdle:{enabled:!0,idleTimeThreshold:2e3}};e.registerWorker("polySeg",t,n)}const Tp=new Map;async function d8(t,e,n,r,i){pb();const a=await n();Uae({segmentationId:t,type:e,data:a}),i==null||i(),Tp.has(t)||Tp.set(t,[]);const o=Tp.get(t);return o.includes(e)||o.push(e),Bae(r),ku(t),a}function Bae(t){const e=n=>{Gae(n,t)};t._debouncedUpdateFunction=e,Ee.removeEventListener(he.SEGMENTATION_DATA_MODIFIED,t._debouncedUpdateFunction),Ee.addEventListener(he.SEGMENTATION_DATA_MODIFIED,t._debouncedUpdateFunction)}const Gae=db((t,e)=>{const n=t.detail.segmentationId,r=Tp.get(n);!r||!r.length||(e(n),r.length&&ku(n))},300);function xs(t){const e=Tae(t);if(e)return e;const n=on(t);if(!n)throw new Error(`No segmentation found for segmentationId ${t}`);let r;if(n.representationData.Labelmap)r=$ae(n,t);else if(n.representationData.Contour)r=jae(n);else if(n.representationData.Surface)r=Hae(n);else throw new Error(`Unsupported segmentation type: ${n.representationData}`);return Cae(t,r),r}function $ae(t,e){const n=t.representationData[je.Labelmap],r=new Set;return n.imageIds?zae(r,n.imageIds):Wae(r,e),Array.from(r).map(Number).sort((i,a)=>i-a)}function Wae(t,e){Me.getVolume(e).voxelManager.forEach(({value:r})=>{r!==0&&t.add(r)})}function zae(t,e){e.forEach(n=>{Me.getImage(n).voxelManager.getScalarData().forEach(a=>{a!==0&&t.add(a)})})}function jae(t){const{annotationUIDsMap:e,geometryIds:n}=t.representationData.Contour||{};if(!n)throw new Error(`No geometryIds found for segmentationId ${t.segmentationId}`);const r=new Set([...e.keys()]);return n.forEach(i=>{const a=Me.getGeometry(i);r.add(a.data.segmentIndex)}),Array.from(r).sort((i,a)=>i-a)}function Hae(t){var n;const e=((n=t.representationData.Surface)==null?void 0:n.geometryIds)??[];return Array.from(e.keys()).map(Number).sort((r,i)=>r-i)}const Kae=Ic(),dm=(t,e,n)=>{De(t,Oe.WEB_WORKER_PROGRESS,{progress:e,type:nl.POLYSEG_CONTOUR_TO_SURFACE,id:n})};async function qae(t,e){const{annotationUIDsMap:n}=t,r=[],i=[],a=n.get(e);for(const s of a){const c=sr(s),{polyline:l}=c.data.contour;i.push(l.length),l.forEach(f=>r.push(...f))}dm(Ee,0,e);const o=await Kae.executeTask("polySeg","convertContourToSurface",{polylines:r,numPointsArray:i},{callbacks:[s=>{dm(Ee,s,e)}]});return dm(Ee,100,e),o}function hb(t,e,n){const r=W0(t,{segmentationId:e});if(!r||r.length===0)return null;const i=r[0],{colorLUTIndex:a}=i,o=f8(a);let s=o[n];if(!s){if(typeof n!="number")throw new Error(`Can't create colour for LUT index ${n}`);s=o[n]=[0,0,0,0]}return s}async function mb(t,e,n={}){const r=on(t),i=new Map,a=Object.keys(e).map(async o=>{const s=e[o],c=s.segmentIndex,l=hb(n.viewport.id,r.segmentationId,c).slice(0,3);if(!l)throw new Error("No color found for segment index, unable to create surface");const f={id:`segmentation_${r.segmentationId}_surface_${c}`,color:l,frameOfReferenceUID:"test-frameOfReferenceUID",points:s.data.points,polys:s.data.polys,segmentIndex:c},u=f.id;return i.set(c,u),Iee(u,{type:hs.SURFACE,geometryData:f})});return await Promise.all(a),{geometryIds:i}}async function Xae(t){return _ae(t)}const Yae=Ic(),pm=(t,e,n)=>{De(t,Oe.WEB_WORKER_PROGRESS,{progress:e,type:nl.POLYSEG_LABELMAP_TO_SURFACE,id:n})};async function Zae(t,e){let n;if(t.volumeId)n=t.volumeId;else{const{imageIds:f}=t;({volumeId:n}=await Xae({imageIds:f}))}const r=Me.getVolume(n),i=r.voxelManager.getCompleteScalarDataArray(),{dimensions:a,spacing:o,origin:s,direction:c}=r;pm(Ee,0,e);const l=await Yae.executeTask("polySeg","convertLabelmapToSurface",{scalarData:i,dimensions:a,spacing:o,origin:s,direction:c,segmentIndex:e},{callbacks:[f=>{pm(Ee,f,e)}]});return pm(Ee,100,e),l}async function Qae(t,e={}){var s;const n=(s=e.segmentIndices)!=null&&s.length?e.segmentIndices:xs(t);let r;const i=on(t),a=i.representationData;try{a.Contour?r=await Jae(t,{segmentIndices:n,...e}):a.Labelmap&&(r=await p8(i.segmentationId,{segmentIndices:n,...e}))}catch(c){throw console.error(c),c}if(!r)throw new Error("Not enough data to convert to surface, currently only support converting volume labelmap to surface if available");return await mb(t,r,e)}async function p8(t,e={}){var l;const n=on(t);if(!((l=n==null?void 0:n.representationData)!=null&&l.Labelmap)){console.warn("Only support surface update from labelmaps");return}const r=n.representationData.Labelmap,i=e.segmentIndices||xs(t),a=i.map(f=>Zae(r,f)),o=await Promise.allSettled(a),s=o.filter(f=>f.status==="rejected");if(s.length>0)throw console.error(s),new Error("Failed to convert labelmap to surface");return o.map((f,u)=>{if(f.status==="fulfilled")return{segmentIndex:i[u],data:f.value}}).filter(Boolean)}async function Jae(t,e={}){const r=on(t).representationData.Contour,a=(e.segmentIndices||xs(t)).map(async s=>{const c=await qae(r,s);return{segmentIndex:s,data:c}});return await Promise.all(a)}function h8(t){const r=Mo.getState().viewportSegRepresentations;return Object.entries(r).filter(([,a])=>a.some(o=>o.segmentationId===t)).map(([a])=>a)}async function eoe(t){const e=await p8(t);if(!e)return;const n=on(t),r=xs(t);if(!r.length){n.representationData.Surface.geometryIds.forEach(o=>{const c=Me.getGeometry(o).data;c.points=[],c.polys=[]}),ku(t);return}const i=e.map(({data:a,segmentIndex:o})=>{const s=`segmentation_${t}_surface_${o}`,c=Me.getGeometry(s);if(c)if(r.includes(o)){const l=c.data;l.points=a.points,l.polys=a.polys}else{const l=c.data;l.points=[],l.polys=[]}else return h8(t).map(f=>[cb(f,{segmentationId:t,type:je.Surface})].map(g=>(n.representationData.Surface.geometryIds.set(o,s),mb(t,[{segmentIndex:o,data:a}],{segmentationId:g.segmentationId}))))});await Promise.all(i),ku(t)}function toe(t,e={}){return d8(t,je.Surface,()=>Qae(t,e),()=>eoe(t))}function noe(t,e,n=!1){const r=Dr(t);if(!r)return;const{viewport:i}=r;Iae(i.element,e),n&&i.render()}async function roe(t,e){const{segmentationId:n}=e,r=on(n);if(!r)return;let i=r.representationData[je.Surface];if(!i&&g8(n,je.Surface)&&(i=await toe(n,{viewport:t}),!i))throw new Error(`No Surface data found for segmentationId ${n}.`);const{geometryIds:a}=i;a!=null&&a.size||console.warn(`No Surfaces found for segmentationId ${n}. Skipping render.`);const{colorLUTIndex:o}=e,s=f8(o);a.forEach(c=>{const l=Me.getGeometry(c);if(!(l!=null&&l.data)){console.warn(`No Surfaces found for geometryId ${c}. Skipping render.`);return}const f=l.data.segmentIndex,u=l.data,g=s[f];u.color=g.slice(0,3),Vae(t.element,u,n)}),t.render()}const ioe={render:roe,removeRepresentation:noe};function aoe(t,e,n){const r=t.getImageIds();if(!r||!r.length)return;const i=r.map(a=>{const{imagePositionPatient:o}=Ve("imagePlaneModule",a),s=ooe(e,o,n);return{imageId:a,distance:s}});return i.sort((a,o)=>a.distance-o.distance),i[0].imageId}function ooe(t,e,n){const r=Le();_n(r,t,e);const i=Qe(r,n);return Math.abs(i)}function soe(t,e){const{segmentation:n}=t.data,{segmentation:r}=e.data;return n.segmentationId===r.segmentationId&&n.segmentIndex===r.segmentIndex}function $2(t){var e;return!!((e=t.data)!=null&&e.segmentation)}function Au(t){if(t.parentAnnotationUID)return;if(!t.data.segmentation)throw new Error("addContourSegmentationAnnotation: annotation does not have a segmentation data");const{segmentationId:e,segmentIndex:n}=t.data.segmentation,r=on(e);r.representationData.Contour||(r.representationData.Contour={annotationUIDsMap:new Map});let{annotationUIDsMap:i}=r.representationData.Contour;i||(i=new Map);let a=i==null?void 0:i.get(n);a||(a=new Set,i.set(n,a)),i.set(n,a.add(t.annotationUID))}function m8(t){if(!t.data.segmentation)throw new Error("removeContourSegmentationAnnotation: annotation does not have a segmentation data");const{segmentationId:e,segmentIndex:n}=t.data.segmentation,r=on(e),{annotationUIDsMap:i}=(r==null?void 0:r.representationData.Contour)||{},a=i==null?void 0:i.get(n);a&&(a.delete(t.annotationUID),a.size||i.delete(n))}function coe(t){if(!t)throw new Error(`No contours found for geometryId ${t.id}`);const e=t.id;if(t.type!==hs.CONTOUR)throw new Error(`Geometry type ${t.type} not supported for rendering.`);if(!t.data){console.warn(`No contours found for geometryId ${e}. Skipping render.`);return}}function loe(t,e,n,r){n.size?t.render():uoe(t,e,r)}function uoe(t,e,n){const{segmentationId:r}=n,i=new Map;e.forEach(a=>{const o=Me.getGeometry(a);if(!o){console.warn(`No geometry found for geometryId ${a}. Skipping render.`);return}const s=o.data.segmentIndex;coe(o);const c=$0.getStyle({viewportId:t.id,segmentationId:r,type:je.Contour,segmentIndex:s}),l=o.data,f=t.getCamera().viewPlaneNormal;l.contours.forEach(u=>{const{points:g,color:d,id:h}=u,p=aoe(t,g[0],f),m={annotationUID:In(),data:{contour:{closed:!0,polyline:g},segmentation:{segmentationId:r,segmentIndex:s,color:d,id:h},handles:{}},handles:{},highlighted:!1,autoGenerated:!1,invalidated:!1,isLocked:!0,isVisible:!0,metadata:{referencedImageId:p,toolName:"PlanarFreehandContourSegmentationTool",FrameOfReferenceUID:t.getFrameOfReferenceUID(),viewPlaneNormal:t.getCamera().viewPlaneNormal}},v=t.element;il(m,v),Au(m)}),c&&i.set(s,c)}),t.resetCamera(),t.render()}function foe(t,e=5){return parseFloat(t[0]).toFixed(e)+","+parseFloat(t[1]).toFixed(e)+","+parseFloat(t[2]).toFixed(e)+","}const vb=Ic(),fv=new Map,gv=new Map,Cp=(t,e)=>{De(t,Oe.WEB_WORKER_PROGRESS,{progress:e,type:nl.SURFACE_CLIPPING})};async function yb(t,e){var o;pb();const n=(o=e.getSlicesClippingPlanes)==null?void 0:o.call(e);if(!n)return;const r=e.getSliceIndex();n.sort((s,c)=>{const l=Math.abs(s.sliceIndex-r),f=Math.abs(c.sliceIndex-r);return l-f}),Cp(Ee,0),await goe(t);const i=new Map;t.forEach(s=>{i.set(s.id,gv.get(s.id))});const a=e.getCamera();return await vb.executeTask("polySeg","cutSurfacesIntoPlanes",{surfacesInfo:t,planesInfo:n,surfacesAABB:i},{callbacks:[({progress:s})=>{Cp(Ee,s)},({sliceIndex:s,polyDataResults:c})=>{c.forEach((l,f)=>{const u=Number(f),g=doe(e,a.viewPlaneNormal,s);poe(u,g,l)})}]}).catch(s=>{console.error(s)}),Cp(Ee,100),fv}async function goe(t){const e=t.filter(r=>!gv.has(r.id));if(!e.length)return;(await vb.executeTask("polySeg","getSurfacesAABBs",{surfacesInfo:e},{callbacks:[({progress:r})=>{Cp(Ee,r)}]})).forEach((r,i)=>{gv.set(i,r)})}function doe(t,e,n){return`${t.id}-${foe(e)}-${n}`}function poe(t,e,n){const{points:r,lines:i,numberOfCells:a}=n;let o=fv.get(t);o||(o=new Map,fv.set(t,o)),o.set(e,{points:r,lines:i,numberOfCells:a})}function Tb(t){const e=new Map;for(const[n,r]of t){const i=Number(n);for(const[a,o]of r)o&&(e.has(i)||e.set(i,[]),e.get(i).push(o))}return e}const{CalibrationTypes:Df}=Cs,v0="px",hoe=[1,2,3,4],moe=["3,3","4,7"],voe={0:"px",1:"percent",2:"dB",3:"cm",4:"seconds",5:"hertz",6:"dB/seconds",7:"cm/sec",8:"cm²",9:"cm²/s",12:"degrees"},yoe=.001,Rf="²",Toe=(t,e)=>{const{calibration:n,hasPixelSpacing:r}=t;let i=r?"mm":v0,a=i+Rf,o=1,s="";if(!n||!n.type&&!n.sequenceOfUltrasoundRegions)return{unit:i,areaUnit:a,scale:o};if(n.type===Df.UNCALIBRATED)return{unit:v0,areaUnit:v0+Rf,scale:o};if(n.sequenceOfUltrasoundRegions){let l,f;if(Array.isArray(e)&&e.length===2)[l,f]=e;else if(typeof e=="function"){const m=e();l=m[0],f=m[1]}let u=n.sequenceOfUltrasoundRegions.filter(m=>l[0]>=m.regionLocationMinX0&&l[0]<=m.regionLocationMaxX1&&l[1]>=m.regionLocationMinY0&&l[1]<=m.regionLocationMaxY1&&f[0]>=m.regionLocationMinX0&&f[0]<=m.regionLocationMaxX1&&f[1]>=m.regionLocationMinY0&&f[1]<=m.regionLocationMaxY1);if(!(u!=null&&u.length))return{unit:i,areaUnit:a,scale:o};if(u=u.filter(m=>hoe.includes(m.regionDataType)&&moe.includes(`${m.physicalUnitsXDirection},${m.physicalUnitsYDirection}`)),!u.length)return{unit:v0,areaUnit:v0+Rf,scale:o};const g=u[0],d=Math.abs(g.physicalDeltaX),h=Math.abs(g.physicalDeltaY);if(Mn(d,h,yoe))o=1/d,s="US Region",i=voe[g.physicalUnitsXDirection]||"unknown",a=i+Rf;else return{unit:v0,areaUnit:v0+Rf,scale:o}}else n.scale&&(o=n.scale);return[Df.ERMF,Df.USER,Df.ERROR,Df.PROJECTION].includes(n==null?void 0:n.type)&&(s=n.type),{unit:i+(s?` ${s}`:""),areaUnit:a+(s?` ${s}`:""),scale:o}};function Coe(t,e){return t.minX<=e.maxX&&t.maxX>=e.minX&&t.minY<=e.maxY&&t.maxY>=e.minY}class woe{}const{PointsManager:XT}=ws,Xe=class Xe extends woe{static statsInit(e){e.storePointData||(Xe.pointsInShape=null)}};Xe.max=[-1/0],Xe.min=[1/0],Xe.sum=[0],Xe.count=0,Xe.runMean=[0],Xe.m2=[0],Xe.pointsInShape=XT.create3(1024),Xe.statsCallback=({value:e,pointLPS:n=null})=>{var i;Array.isArray(e)&&e.length>1&&Xe.max.length===1&&(Xe.max.push(Xe.max[0],Xe.max[0]),Xe.min.push(Xe.min[0],Xe.min[0]),Xe.sum.push(Xe.sum[0],Xe.sum[0]),Xe.runMean.push(0,0),Xe.m2.push(Xe.m2[0],Xe.m2[0])),Xe.pointsInShape&&n&&((i=Xe.pointsInShape)==null||i.push(n));const r=Array.isArray(e)?e:[e];Xe.count+=1,Xe.max.map((a,o)=>{const s=r[o],c=s-Xe.runMean[o];Xe.sum[o]+=s,Xe.runMean[o]+=c/Xe.count;const l=s-Xe.runMean[o];Xe.m2[o]+=c*l,Xe.min[o]=Math.min(Xe.min[o],s),Xe.max[o]=Math.max(a,s)})},Xe.getStatistics=e=>{const n=Xe.sum.map(o=>o/Xe.count),r=Xe.m2.map(o=>Math.sqrt(o/Xe.count)),i=(e==null?void 0:e.unit)||null,a={max:{name:"max",label:"Max Pixel",value:L1(Xe.max),unit:i},min:{name:"min",label:"Min Pixel",value:L1(Xe.min),unit:i},mean:{name:"mean",label:"Mean Pixel",value:L1(n),unit:i},stdDev:{name:"stdDev",label:"Standard Deviation",value:L1(r),unit:i},count:{name:"count",label:"Pixel Count",value:Xe.count,unit:null},pointsInShape:Xe.pointsInShape,array:[]};return a.array.push(a.max,a.mean,a.stdDev,a.stdDev,a.count),Xe.max=[-1/0],Xe.min=[1/0],Xe.sum=[0],Xe.m2=[0],Xe.runMean=[0],Xe.count=0,Xe.pointsInShape=XT.create3(1024),a};let dv=Xe;function L1(t){return t.length===1?t[0]:t}function ol(t,e){if(t.length!==e.length)throw Error("Both points should have the same dimensionality");const[n,r,i=0]=t,[a,o,s=0]=e,c=a-n,l=o-r,f=s-i;return c*c+l*l+f*f}function Cb(t,e){return Math.sqrt(ol(t,e))}function xoe(t,e,n){let r;const i=ol(t,e);if(t[0]===e[0]&&t[1]===e[1]&&(r=t),!r){const a=((n[0]-t[0])*(e[0]-t[0])+(n[1]-t[1])*(e[1]-t[1]))/i;a<0?r=t:a>1?r=e:r=[t[0]+a*(e[0]-t[0]),t[1]+a*(e[1]-t[1])]}return{point:[...r],distanceSquared:ol(n,r)}}function Soe(t,e,n){return xoe(t,e,n).distanceSquared}const Mf=.01;function hm(t,e,n){const r=t[0]<=e[0]?t[0]:e[0],i=t[0]>=e[0]?t[0]:e[0],a=t[1]<=e[1]?t[1]:e[1],o=t[1]>=e[1]?t[1]:e[1];if(!(n[0]>=r-Mf&&n[0]<=i+Mf&&n[1]>=a-Mf&&n[1]<=o+Mf))return!1;const c=(e[1]-t[1])*(n[0]-e[0])-(e[0]-t[0])*(n[1]-e[1]);return(c>=0?c:-c)<=Mf}function wb(t){if(t.length<3)return!1;const e=t.length,n=t[0],r=t[e-1],i=ol(n,r);return Ug(0,i)}function sl(t,e,n={closed:void 0}){if(t.length<3)return!1;const r=t.length;let i=0;const{closed:a,holes:o}=n;if(o!=null&&o.length){for(const l of o)if(sl(l,e))return!1}const s=!(a===void 0?wb(t):a),c=t.length-(s?1:2);for(let l=0;l<=c;l++){const f=t[l],u=l===r-1?0:l+1,g=t[u],d=f[0]>=g[0]?f[0]:g[0],h=f[1]>=g[1]?f[1]:g[1],p=f[1]<=g[1]?f[1]:g[1];if(e[0]<=d&&e[1]>=p&&e[1]<h){let y=f[0]===g[0];if(!y){const T=(e[1]-f[1])*(g[0]-f[0])/(g[1]-f[1])+f[0];y=e[0]<=T}i+=y?1:0}}return!!(i%2)}function v8(t,e){for(let n=0,r=e.length;n<r;n++)if(!sl(t,e[n]))return!1;return!0}function Gh(t,e){let n=t;const r=(e==null?void 0:e.numDimensions)||2,i=r===3;if(!Array.isArray(t[0])){const u=t,g=u.length/r;n=new Array(u.length/r);for(let d=0,h=g;d<h;d++)n[d]=[u[d*r],u[d*r+1]],i&&n[d].push(u[d*r+2])}let a=1/0,o=1/0,s=-1/0,c=-1/0,l=1/0,f=-1/0;n=n;for(let u=0,g=n.length;u<g;u++){const[d,h,p]=n[u];a=a<d?a:d,o=o<h?o:h,s=s>d?s:d,c=c>h?c:h,i&&(l=l<p?l:p,f=f>p?f:p)}return i?{minX:a,maxX:s,minY:o,maxY:c,minZ:l,maxZ:f}:{minX:a,maxX:s,minY:o,maxY:c}}function y8(t){const e=t.length;let n=0,r=e-1;for(let i=0;i<e;i++)n+=(t[r][0]+t[i][0])*(t[r][1]-t[i][1]),r=i;return Math.abs(n/2)}function T8(t){if(t.length<3)return 0;const e=t[0];let n=0;for(let r=0,i=t.length;r<i;r++){const a=t[r],o=r===i-1?0:r+1,s=t[o],c=a[0]-e[0],l=a[1]-e[1],f=s[0]-e[0],u=s[1]-e[1];n+=c*u-l*f}return n*=.5,n}function wp(t){return T8(t)>=0?1:-1}function Eoe(t){const e=Le(),n=t[0];for(let r=0,i=t.length;r<i;r++){const a=t[r],o=r===i-1?0:r+1,s=t[o],c=a[0]-n[0],l=a[1]-n[1],f=a[2]-n[2],u=s[0]-n[0],g=s[1]-n[1],d=s[2]-n[2];e[0]+=l*d-f*g,e[1]+=f*u-c*d,e[2]+=c*g-l*u}return Br(e,e,.5),e}function Ooe(t){const e=Eoe(t);return wn(e,e)}function ed(t){const e=T8(t);return[0,0,e/Math.abs(e)]}function C8(t,e,n,r){let i=!1;const a=t[0]<e[0]?t[0]:e[0],o=t[1]<e[1]?t[1]:e[1],s=t[0]>e[0]?t[0]:e[0],c=t[1]>e[1]?t[1]:e[1],l=n[0]<r[0]?n[0]:r[0],f=n[1]<r[1]?n[1]:r[1],u=n[0]>r[0]?n[0]:r[0],g=n[1]>r[1]?n[1]:r[1];if(a>u||s<l||o>g||c<f)return!1;const d=[I1(t,e,n),I1(t,e,r),I1(n,r,t),I1(n,r,e)];return d[0]!==d[1]&&d[2]!==d[3]?!0:((d[0]===0&&V1(t,n,e)||d[1]===0&&V1(t,r,e)||d[2]===0&&V1(n,t,r)||d[3]===0&&V1(n,e,r))&&(i=!0),i)}function I1(t,e,n){const r=(e[1]-t[1])*(n[0]-e[0])-(e[0]-t[0])*(n[1]-e[1]);return r===0?0:r>0?1:2}function V1(t,e,n){return e[0]<=Math.max(t[0],n[0])&&e[0]>=Math.min(t[0],n[0])&&e[1]<=Math.max(t[1],n[1])&&e[1]>=Math.min(t[1],n[1])}function w8(t,e,n,r=!0){const i=[],a=t.length,o=a-(r?1:2);for(let s=0;s<=o;s++){const c=t[s],l=s===a-1?0:s+1,f=t[l];C8(e,n,c,f)&&i.push([s,l])}return i}const Doe=.01;function xb(t,e,n,r){const i=[e[0]-t[0],e[1]-t[1]],a=[r[0]-n[0],r[1]-n[1]],o=a[1]*i[0]-a[0]*i[1];if((o>=0?o:-o)<Doe){const h=[t[0]<e[0]?t[0]:e[0],t[0]>e[0]?t[0]:e[0],t[1]<e[1]?t[1]:e[1],t[1]>e[1]?t[1]:e[1]],p=[n[0]<r[0]?n[0]:r[0],n[0]>r[0]?n[0]:r[0],n[1]<r[1]?n[1]:r[1],n[1]>r[1]?n[1]:r[1]];if(!(h[0]<=p[1]&&h[1]>=p[0]&&h[2]<=p[3]&&h[3]>=p[2])||!(hm(t,e,n)||hm(t,e,r)||hm(n,r,t)))return;const y=h[0]>p[0]?h[0]:p[0],T=h[1]<p[1]?h[1]:p[1],C=h[2]>p[2]?h[2]:p[2],w=h[3]<p[3]?h[3]:p[3],x=(y+T)*.5,O=(C+w)*.5;return[x,O]}let c=t[1]-n[1],l=t[0]-n[0];const f=a[0]*c-a[1]*l,u=i[0]*c-i[1]*l;c=f/o,l=u/o;const g=t[0]+c*i[0],d=t[1]+c*i[1];return[g,d]}var z0;(function(t){t[t.Vertex=0]="Vertex",t[t.Intersection=1]="Intersection"})(z0||(z0={}));var hu;(function(t){t[t.Outside=-1]="Outside",t[t.Edge=0]="Edge",t[t.Inside=1]="Inside"})(hu||(hu={}));var ql;(function(t){t[t.Exiting=-1]="Exiting",t[t.Unknown=0]="Unknown",t[t.Entering=1]="Entering"})(ql||(ql={}));function YT(t){for(let e=0,n=t.length;e<n;e++){const r=t[e];r.next||(r.next=t[e===n-1?0:e+1])}}function Sb(t,e){const n=[],r=[],i=new Map;let o=sl(e,t[0])?ql.Exiting:ql.Entering;for(let s=0,c=t.length;s<c;s++){const l=t[s],f=sl(e,l),u={type:z0.Vertex,coordinates:l,position:f?hu.Inside:hu.Outside,visited:!1,next:null};n.push(u);const g=t[s===c-1?0:s+1],d=w8(e,l,g).map(h=>{const p=h[0],m=e[h[0]],v=e[h[1]],y=xb(l,g,m,v),T=ol(l,y);return{sourceLineSegmentId:p,coordinate:y,targetStartPointDistSquared:T}});d.sort((h,p)=>h.targetStartPointDistSquared-p.targetStartPointDistSquared),d.forEach(h=>{const{sourceLineSegmentId:p,coordinate:m}=h,v={type:z0.Intersection,coordinates:m,position:hu.Edge,direction:o,visited:!1,next:null},y={...v,direction:ql.Unknown,cloned:!0};o===ql.Entering?v.next=y:y.next=v;let T=i.get(p);T||(T=[],i.set(p,T)),n.push(v),T.push(y),o*=-1})}for(let s=0,c=e.length;s<c;s++){const l=s,f=e[s],u={type:z0.Vertex,coordinates:f,visited:!1,next:null};r.push(u);const g=i.get(l);g!=null&&g.length&&g.map(d=>({intersectionPoint:d,lineSegStartDistSquared:ol(f,d.coordinates)})).sort((d,h)=>d.lineSegStartDistSquared-h.lineSegStartDistSquared).map(({intersectionPoint:d})=>d).forEach(d=>r.push(d))}return YT(n),YT(r),{targetPolylinePoints:n,sourcePolylinePoints:r}}function Eb(t){for(let e=0,n=t.length;e<n;e++){const r=t[e];if(!r.visited&&r.position===hu.Outside)return r}}function Ob(t,e){const n=ed(t),r=ed(e),i=Qe(r,n);Ug(1,i)||(e=e.slice().reverse());const{targetPolylinePoints:a}=Sb(t,e),o=Eb(a);if(!o)return t.slice();const s=[o.coordinates];let c=o.next;for(;c!==o;){if(c.type===z0.Intersection&&c.cloned){c=c.next;continue}s.push(c.coordinates),c=c.next}return s}function Db(t,e){const n=ed(t),r=ed(e),i=Qe(r,n);Ug(-1,i)||(e=e.slice().reverse());const{targetPolylinePoints:a}=Sb(t,e);let o=null;const s=[];for(;o=Eb(a);){const c=[o.coordinates];let l=o.next;for(o.visited=!0;l!==o;){if(l.visited=!0,l.type===z0.Intersection&&l.cloned){l=l.next;continue}c.push(l.coordinates),l=l.next}s.push(c)}return s}function Rb(t,e,n,r=!0){let i,a;r?(a=t.length-1,i=0):(a=0,i=1);for(let o=i;o<t.length;o++){const s=t[a],c=t[o];if(C8(e,n,s,c))return[a,o];a=o}}function Mb(t,e){for(let n=0,r=t.length;n<r;n++){const i=t[n],a=n===r-1?0:n+1,o=t[a],s=Rb(e,i,o);if((s==null?void 0:s.length)===2)return!0}return!1}const Roe=.1;function _b(t,e=Roe){const n=t.length;if(n<3)return t;const r=e*e,i=[[0,n-1]],a=new Array(n).fill(!1);let o=2;for(a[0]=!0,a[n-1]=!0;i.length;){const[c,l]=i.pop();if(l-c===1)continue;const f=t[c],u=t[l];let g=-1/0,d=-1;for(let h=c+1;h<l;h++){const p=t[h],m=Soe(f,u,p);m>g&&(g=m,d=h)}g<r||(a[d]=!0,o++,i.push([d,l]),i.push([c,d]))}const s=new Array(o);for(let c=0,l=0;c<n;c++)a[c]&&(s[l++]=t[c]);return s}function bb(t,e,n,r=!0){const i=[],a=w8(t,e,n,r);for(let o=0;o<a.length;o++){const s=t[a[o][0]],c=t[a[o][1]],l=xb(e,n,s,c);i.push(l)}return i}function Moe(t,e,n,r=!0){let i,a;r?(a=t.length-1,i=0):(a=0,i=1);const o=[];for(let f=i;f<t.length;f++){const u=t[a],g=t[f];C8(e,n,u,g)&&o.push([a,f]),a=f}if(o.length===0)return;const s=[];o.forEach(f=>{const u=[t[f[0]],t[f[1]]],g=[(u[0][0]+u[1][0])/2,(u[0][1]+u[1][1])/2];s.push(yr(g,e))});const c=Math.min(...s),l=s.indexOf(c);return{segment:o[l],distance:c}}const Ml=.001,_oe=(t,e)=>{let n,r,i;if(t instanceof ha){const o=t.getImageData();if(!o)return;r=o.direction.slice(0,3),i=o.direction.slice(3,6),n=o.spacing}else{const o=t.getImageData(),{direction:s,spacing:c}=o,{viewPlaneNormal:l,viewUp:f}=t.getCamera(),u=s.slice(0,3),g=s.slice(3,6),d=s.slice(6,9),h=Le();an(h,f,l);const p=Math.abs(Qe(h,u)),m=Math.abs(Qe(h,g)),v=Math.abs(Qe(h,d));let y;if(Math.abs(1-p)<Ml)y=c[0],r=u;else if(Math.abs(1-m)<Ml)y=c[1],r=g;else if(Math.abs(1-v)<Ml)y=c[2],r=d;else throw new Error("No support yet for oblique plane planar contours");const T=Math.abs(Qe(f,u)),C=Math.abs(Qe(f,g)),w=Math.abs(Qe(f,d));let x;if(Math.abs(1-T)<Ml)x=c[0],i=u;else if(Math.abs(1-C)<Ml)x=c[1],i=g;else if(Math.abs(1-w)<Ml)x=c[2],i=d;else throw new Error("No support yet for oblique plane planar contours");n=[y,x]}return{spacing:[n[0]/e,n[1]/e],xDir:r,yDir:i}},boe=(t,e,n)=>z4(t,e)<n,Loe=(t,e,n,r)=>{const{xDir:i,yDir:a,spacing:o}=r,s=We(t),{viewport:c}=s;if(!e.length)return e.push(n),console.log(">>>>> !canvasPoints. :: RETURN"),1;const l=c.canvasToWorld(e[e.length-1]),f=c.canvasToWorld(n),u=Le();tn(u,f,l);const g=Math.abs(Qe(u,i)),d=Math.abs(Qe(u,a)),h=Math.max(Math.floor(g/o[0]),Math.floor(d/o[0]));if(h>1){const p=e[e.length-1],m=z4(p,n),v=os();Ru(v,n,p),au(v,v[0]/m,v[1]/m);const y=m/h;for(let T=1;T<=h;T++)e.push([p[0]+y*v[0]*T,p[1]+y*v[1]*T])}else e.push(n);return h},Ioe=(t,e,n,r)=>{const i=[t[0]-e[0],t[1]-e[1]],a=[n[0]-e[0],n[1]-e[1]],o=i[0]*a[0]+i[1]*a[1];if(o<0)return!1;const s=Math.sqrt(a[0]*a[0]+a[1]*a[1]);if(s===0)return!1;const c=o/s,l=[a[0]/s,a[1]/s],f=[l[0]*c,l[1]*c],u=[e[0]+f[0],e[1]+f[1]];return!(yr(t,u)>r||yr(e,u)>yr(e,n))},Voe=1e-6;function Lb(t){let e;const n=lM(t,50);for(let o=0;o<3;o++)if(n.every((s,c,l)=>Math.abs(s[o]-l[0][o])<Voe)){e=o;break}if(e===void 0)throw new Error("Cannot find a shared dimension index for polyline, probably oblique plane");const r=[],i=(e+1)%3,a=(e+2)%3;for(let o=0;o<t.length;o++)r.push([t[o][i],t[o][a]]);return{sharedDimensionIndex:e,projectedPolyline:r}}function Poe(t,e,n={}){const{sharedDimensionIndex:r,projectedPolyline:i}=Lb(e),{holes:a}=n,o=[];if(a)for(let c=0;c<a.length;c++){const l=a[c],f=[];for(let u=0;u<l.length;u++)f.push([l[u][(r+1)%3],l[u][(r+2)%3]]);o.push(f)}const s=[t[(r+1)%3],t[(r+2)%3]];return sl(i,s,{holes:o})}const ml=Object.freeze(Object.defineProperty({__proto__:null,addCanvasPointsToArray:Loe,containsPoint:sl,containsPoints:v8,decimate:_b,getAABB:Gh,getArea:y8,getClosestLineSegmentIntersection:Moe,getFirstLineSegmentIntersectionIndexes:Rb,getLineSegmentIntersectionsCoordinates:bb,getLineSegmentIntersectionsIndexes:w8,getNormal2:ed,getNormal3:Ooe,getSignedArea:T8,getSubPixelSpacingAndXYDirections:_oe,getWindingDirection:wp,intersectPolyline:Mb,isClosed:wb,isPointInsidePolyline3D:Poe,mergePolylines:Ob,pointCanProjectOnLine:Ioe,pointsAreWithinCloseContourProximity:boe,projectTo2D:Lb,subtractPolylines:Db},Symbol.toStringTag,{value:"Module"}));function ZT(t,e){let n=[0,0],r=Number.MAX_SAFE_INTEGER;return t.forEach(function(i){const a=Noe(e,i);a<r&&(r=a,n=[...i])}),n}function Noe(t,e){const[n,r]=t,[i,a]=e;return Math.sqrt(Math.pow(n-i,2)+Math.pow(r-a,2))}const{EPSILON:koe}=Bx,Aoe=1-koe;function Foe(t,e,n){var c;const{viewPlaneNormal:r}=e,i=t.filter(l=>{let f=l.metadata.viewPlaneNormal;if(!f){const{referencedImageId:g}=l.metadata,{imageOrientationPatient:d}=Ve("imagePlaneModule",g),h=Cn(d[0],d[1],d[2]),p=Cn(d[3],d[4],d[5]);f=Le(),an(f,h,p),l.metadata.viewPlaneNormal=f}const u=Math.abs(Qe(r,f))>Aoe;return f&&u});if(!i.length)return[];const a=n/2,{focalPoint:o}=e,s=[];for(const l of i){const f=l.data,u=f.handles.points[0]||((c=f.contour)==null?void 0:c.polyline[0]);if(!l.isVisible)continue;const g=Le();if(!u){s.push(l);continue}_n(g,o,u);const d=Qe(g,r);Math.abs(d)<a&&s.push(l)}return s}function Ib(t,e,n={}){if(t instanceof Hi){const r=t.getCamera(),{spacingInNormalDirection:i}=xd(t,r);return Foe(e,r,i)}if(t instanceof ha){const r=t.getCurrentImageId();if(!r)return[];const i=r.indexOf(":");n.imageURI=r.substring(i+1)}return e.filter(r=>r.isVisible?r.data.isCanvasAnnotation?!0:t.isReferenceViewable(r.metadata,n):!1)}function Uoe(t,e,n){let r=!0,i=!0;if(typeof t!="function")throw new TypeError("Expected a function");return gb(n)&&(r="leading"in n?!!n.leading:r,i="trailing"in n?!!n.trailing:i),db(t,e,{leading:r,trailing:i,maxWait:e})}function Boe(t,e){const n=t.length,r=[];for(let i=0;i<n;i++){const a=t[i];a.getFrameOfReferenceUID()===e&&r.push(a)}return r}const{Active:Goe,Passive:$oe,Enabled:Woe}=Yt;function zoe(t,e){const n=t.length,r=[];for(let i=0;i<n;i++){const a=t[i],o=Vr(a.id,a.renderingEngineId);if(!o)continue;joe(o,e)&&r.push(a)}return r}function joe(t,e){const{toolOptions:n}=t,r=n[e];if(!r)return!1;const i=r.mode;return i===Goe||i===$oe||i===Woe}function Hoe(t,e,n=.999){return t.filter(r=>{const i=r.getCamera();return Math.abs(Qe(i.viewPlaneNormal,e.viewPlaneNormal))>n})}function dg(t,e,n=!0){const r=We(t),{renderingEngine:i,FrameOfReferenceUID:a}=r;let o=i.getViewports();o=Boe(o,a),o=zoe(o,e);const s=i.getViewport(r.viewportId);return n&&(o=Hoe(o,s.getCamera())),o.map(l=>l.id)}const Koe="viewport-element";function qoe(t){const e=We(t),{viewportId:n,renderingEngineId:r}=e,i=`${n}:${r}`,a=Xoe(t);return Object.keys($e.svgNodeCache[i]).forEach(o=>{$e.svgNodeCache[i][o].touched=!1}),{svgLayerElement:a,svgNodeCacheForCanvas:$e.svgNodeCache,getSvgNode:Yoe.bind(this,i),appendNode:Zoe.bind(this,a,i),setNodeTouched:Qoe.bind(this,i),clearUntouched:Joe.bind(this,a,i)}}function Xoe(t){const e=`.${Koe}`,n=t.querySelector(e);return n==null?void 0:n.querySelector(":scope > .svg-layer")}function Yoe(t,e){if($e.svgNodeCache[t]&&$e.svgNodeCache[t][e])return $e.svgNodeCache[t][e].domRef}function Zoe(t,e,n,r){if(!$e.svgNodeCache[e])return null;$e.svgNodeCache[e][r]={touched:!0,domRef:n},t.appendChild(n)}function Qoe(t,e){$e.svgNodeCache[t]&&$e.svgNodeCache[t][e]&&($e.svgNodeCache[t][e].touched=!0)}function Joe(t,e){$e.svgNodeCache[e]&&Object.keys($e.svgNodeCache[e]).forEach(n=>{const r=$e.svgNodeCache[e][n];!r.touched&&r.domRef&&(t.removeChild(r.domRef),delete $e.svgNodeCache[e][n])})}function ese(t,e){const n=qoe(t);e(n),n.clearUntouched()}function Md(t,e,n){return`${t}::${e}::${n}`}function cl(t,e){Object.keys(t).forEach(n=>{const r=e.getAttribute(n),i=t[n];i===void 0||i===""?e.removeAttribute(n):r!==i&&e.setAttribute(n,i)})}function W2(t,e){Object.keys(t).forEach(n=>{const r=t[n];r!==void 0&&r!==""&&e.setAttribute(n,r)})}function tse(t,e,n,r,i={},a){const{color:o,handleRadius:s,width:c,lineWidth:l,fill:f,type:u,opacity:g}=Object.assign({color:"rgb(0, 255, 0)",handleRadius:"6",width:"2",lineWidth:void 0,fill:"transparent",type:"circle",opacity:1},i),d=l||c,h="http://www.w3.org/2000/svg",p=Md(e,"handle",`hg-${n}-index-${a}`);let m;if(u==="circle")m={cx:`${r[0]}`,cy:`${r[1]}`,r:s,stroke:o,fill:f,"stroke-width":d,opacity:g};else if(u==="rect"){const T=parseFloat(s)*1.5,C=r[0]-T*.5,w=r[1]-T*.5;m={x:`${C}`,y:`${w}`,width:`${T}`,height:`${T}`,stroke:o,fill:f,"stroke-width":d,rx:`${T*.1}`,opacity:g}}else throw new Error(`Unsupported handle type: ${u}`);const v=t.getSvgNode(p);if(v)cl(m,v),t.setNodeTouched(p);else{const y=document.createElementNS(h,u);W2(m,y),t.appendNode(y,p)}}function pv(t,e,n,r,i={}){r.forEach((a,o)=>{tse(t,e,n,a,i,o)})}function nse(t,e,n,r,i,a={},o=""){if(isNaN(r[0])||isNaN(r[1])||isNaN(i[0])||isNaN(i[1]))return;const{color:s="rgb(0, 255, 0)",width:c=10,lineWidth:l,lineDash:f,markerStartId:u=null,markerEndId:g=null,shadow:d=!1}=a,h=l||c,p="http://www.w3.org/2000/svg",m=Md(e,"line",n),v=t.getSvgNode(m),y=t.svgLayerElement.id,T=d?`filter:url(#shadow-${y});`:"",C={x1:`${r[0]}`,y1:`${r[1]}`,x2:`${i[0]}`,y2:`${i[1]}`,stroke:s,style:T,"stroke-width":h,"stroke-dasharray":f,"marker-start":u?`url(#${u})`:"","marker-end":g?`url(#${g})`:""};if(v)cl(C,v),t.setNodeTouched(m);else{const w=document.createElementNS(p,"line");o!==""&&w.setAttribute("data-id",o),W2(C,w),t.appendNode(w,m)}}function Fu(t,e,n,r,i){if(r.length<2)return;const{color:a="rgb(0, 255, 0)",width:o=10,fillColor:s="none",fillOpacity:c=0,lineWidth:l,lineDash:f,closePath:u=!1,markerStartId:g=null,markerEndId:d=null}=i,h=l||o,p="http://www.w3.org/2000/svg",m=Md(e,"polyline",n),v=t.getSvgNode(m);let y="";for(const C of r)y+=`${C[0].toFixed(1)}, ${C[1].toFixed(1)} `;if(u){const C=r[0];y+=`${C[0]}, ${C[1]}`}const T={points:y,stroke:a,fill:s,"fill-opacity":c,"stroke-width":h,"stroke-dasharray":f,"marker-start":g?`url(#${g})`:"","marker-end":d?`url(#${d})`:""};if(v)cl(T,v),t.setNodeTouched(m);else{const C=document.createElementNS(p,"polyline");W2(T,C),t.appendNode(C,m)}}function mu(t,e,n,r,i){const o=r.length&&r[0].length&&Array.isArray(r[0][0])?r:[r],{color:s="rgb(0, 255, 0)",width:c=10,fillColor:l="none",fillOpacity:f=0,lineWidth:u,lineDash:g,closePath:d=!1}=i,h=u||c,p="http://www.w3.org/2000/svg",m=Md(e,"path",n),v=t.getSvgNode(m);let y="";for(let C=0,w=o.length;C<w;C++){const x=o[C],O=x.length;if(!(O<2)){for(let M=0;M<O;M++){const A=x[M];y+=`${M?"L":"M"} ${A[0].toFixed(1)}, ${A[1].toFixed(1)} `}d&&(y+="Z ")}}if(!y)return;const T={d:y,stroke:s,fill:l,"fill-opacity":f,"stroke-width":h,"stroke-dasharray":g};if(v)cl(T,v),t.setNodeTouched(m);else{const C=document.createElementNS(p,"path");W2(T,C),t.appendNode(C,m)}}function rse(t,e,n,r,i,a={}){const o=Object.assign({fontFamily:"Helvetica, Arial, sans-serif",fontSize:"14px",color:"rgb(255, 255, 0)",background:"",padding:25,centerX:!1,centerY:!0},a);return ise(t,e,n,r,i,o)}function ise(t,e,n,r=[""],i,a){const{padding:o,color:s,fontFamily:c,fontSize:l,background:f}=a;let u;const[g,d]=[i[0]+o,i[1]+o],h="http://www.w3.org/2000/svg",p=Md(e,"text",n),m=t.getSvgNode(p);if(m){const v=m.querySelector("text"),y=Array.from(v.children);for(let w=0;w<y.length;w++){const x=y[w],O=r[w]||"";x.textContent=O}if(r.length>y.length){for(let w=0;w<r.length-y.length;w++){const x=r[w+y.length],O=QT(x);v.appendChild(O)}m.appendChild(v),t.appendNode(m,p)}const T={fill:s,"font-size":l,"font-family":c},C={transform:`translate(${g} ${d})`};cl(T,v),cl(C,m),m.setAttribute("data-annotation-uid",e),u=JT(m,f),t.setNodeTouched(p)}else{const v=document.createElementNS(h,"g");v.setAttribute("data-annotation-uid",e),v.setAttribute("transform",`translate(${g} ${d})`);const y=ase(t,a);for(let T=0;T<r.length;T++){const C=r[T],w=QT(C);y.appendChild(w)}v.appendChild(y),t.appendNode(v,p),u=JT(v,f)}return Object.assign({},u,{x:g,y:d,height:u.height+o,width:u.width+o})}function ase(t,e){const{color:n,fontFamily:r,fontSize:i}=e,o=document.createElementNS("http://www.w3.org/2000/svg","text"),s="user-select: none; pointer-events: none; -webkit-tap-highlight-color:  rgba(255, 255, 255, 0);",c=`filter:url(#shadow-${t.svgLayerElement.id});`,l=`${s}${c}`;return o.setAttribute("x","0"),o.setAttribute("y","0"),o.setAttribute("fill",n),o.setAttribute("font-family",r),o.setAttribute("font-size",i),o.setAttribute("style",l),o.setAttribute("pointer-events","visible"),o}function QT(t){const n=document.createElementNS("http://www.w3.org/2000/svg","tspan");return n.setAttribute("x","0"),n.setAttribute("dy","1.2em"),n.textContent=t,n}function JT(t,e){let n=t.querySelector("rect.background");if(!e)return n&&t.removeChild(n),t.getBBox();n||(n=document.createElementNS("http://www.w3.org/2000/svg","rect"),n.setAttribute("class","background"),t.insertBefore(n,t.firstChild));const r=t.getBBox(),i={x:`${r.x}`,y:`${r.y}`,width:`${r.width}`,height:`${r.height}`,fill:e};return cl(i,n),r}function ose(t,e,n,r,i,a,o={}){const s=r.length>0?ZT(r,i):i,c=sse(a),l=ZT(c,s),f=Object.assign({color:"rgb(255, 255, 0)",lineWidth:"1",lineDash:"2,3"},o);nse(t,e,`link-${n}`,s,l,f)}function sse(t){const{x:e,y:n,height:r,width:i}=t,a=i/2,o=r/2,s=[e+a,n],c=[e,n+o],l=[e+a,n+r],f=[e+i,n+o];return[s,c,l,f]}function cse(t,e,n,r,i,a,o,s={}){const c=Object.assign({handleRadius:"6",centering:{x:!1,y:!0}},s),l=rse(t,e,n,r,i,c);return ose(t,e,n,a,i,l,c),l}function lse(t,e){const n=We(t),{renderingEngineId:r,viewportId:i}=n,a=Vr(i,r);if(!a)return[];const o=[],s=Object.keys(a.toolOptions);for(let c=0;c<s.length;c++){const l=s[c],f=a.toolOptions[l];if(f&&e.includes(f.mode)){const u=a.getToolInstance(l);o.push(u)}}return o}const{Active:use,Passive:fse,Enabled:gse}=Yt;class dse{constructor(){this._needsRender=new Set,this._animationFrameSet=!1,this._animationFrameHandle=null,this._renderFlaggedViewports=()=>{this._throwIfDestroyed();const e=Array.from(this._viewportElements.values());for(let n=0;n<e.length;n++){const r=e[n];if(this._needsRender.has(r)&&(this._triggerRender(r),this._needsRender.delete(r),this._needsRender.size===0))break}this._animationFrameSet=!1,this._animationFrameHandle=null,this._render()},this._viewportElements=new Map}addViewportElement(e,n){this._viewportElements.set(e,n)}removeViewportElement(e,n){this._viewportElements.delete(e),this._needsRender.delete(n),this._reset()}renderViewport(e){this._setViewportsToBeRenderedNextFrame([e])}_throwIfDestroyed(){if(this.hasBeenDestroyed)throw new Error("this.destroy() has been manually called to free up memory, can not longer use this instance. Instead make a new one.")}_setAllViewportsToBeRenderedNextFrame(){[...this._viewportElements.values()].forEach(n=>{this._needsRender.add(n)}),this._renderFlaggedViewports()}_setViewportsToBeRenderedNextFrame(e){const n=[...this._viewportElements.values()];e.forEach(r=>{n.indexOf(r)!==-1&&this._needsRender.add(r)}),this._render()}_render(){this._needsRender.size>0&&this._animationFrameSet===!1&&(this._animationFrameHandle=window.requestAnimationFrame(this._renderFlaggedViewports),this._animationFrameSet=!0)}_triggerRender(e){const n=We(e);if(!n)return;if(!dl(n.renderingEngineId)){console.warn("rendering Engine has been destroyed");return}const i=lse(e,[use,fse,gse]),{renderingEngineId:a,viewportId:o}=n,s={element:e,renderingEngineId:a,viewportId:o};ese(e,c=>{let l=!1;const f=u=>{if(u.renderAnnotation){const g=u.renderAnnotation(n,c);l=l||g}};i.forEach(f),l&&De(e,he.ANNOTATION_RENDERED,{...s})})}_reset(){window.cancelAnimationFrame(this._animationFrameHandle),this._needsRender.clear(),this._animationFrameSet=!1,this._animationFrameHandle=null,this._setAllViewportsToBeRenderedNextFrame()}}const x8=new dse;function _d(t){x8.renderViewport(t)}function mi(t){t.length&&t.forEach(e=>{const n=Dr(e);if(!n){console.warn(`Viewport not available for ${e}`);return}const{viewport:r}=n;if(!r){console.warn(`Viewport not available for ${e}`);return}const i=r.element;_d(i)})}function pse(t){var e;return((e=t[0])==null?void 0:e.length)===3}function hse(t,e){if(!e||e.length===0||e.length===t.length)return t;const n=e[e.length-1]-e[0]+1,r=K5(e.map(a=>t[a][0])),i=K5(e.map(a=>t[a][1]));if(pse(t)){const a=K5(e.map(o=>t[o][2]));return b7(Ef(r,n),Ef(i,n),Ef(a,n))}else return b7(Ef(r,n),Ef(i,n))}function mse(t,e){const n=[],[r,i]=e,a=i-r+1,o=Math.floor(a/t);let s=0,c=Math.round((a-1)/(o-1)*s)+r;for(;c<=i;)n.push(c),s++,c=Math.round((a-1)/(o-1)*s)+r;return n}function vse(t,e,n,r){const i=n-e+1,a=Math.floor(r/100*i)??1,o=Math.floor(i/a)??1;if(isNaN(i)||!i||!o||i/o<2)return t;const s=Math.max(0,e),c=Math.min(t.length-1,n),l=t.slice(0,s),f=t.slice(c+1,t.length),u=mse(o,[s,c]),g=hse(t,u);return[...l,...g,...f]}function z2(t,e){var r,i;return e!=null&&e.autoGenerated?!1:((r=t==null?void 0:t.smoothing)==null?void 0:r.smoothOnAdd)===!0||((i=t==null?void 0:t.smoothing)==null?void 0:i.smoothOnEdit)===!0}function yse(t,e){return Cb(t,e)<.001}function Tse(t,e){return Cb(t,e)===0}function Cse(t,e){for(let n=0;n<t.length;n++)for(let r=0;r<e.length;r++)if(Tse(t[n],e[r]))return[n,r]}function Xl(t,e,n){return(t+e+n)%e}function eC(t,e,n,r){const[,i,a]=t,[,o,s]=e,c=a.length,l=s.length;let f=t[0],u=e[0];if(!a[f]||!s[u]||!a[i]||!s[o])return[void 0,void 0];for(;f!==i&&u!==o;){if(n(s[u],a[f]))return[f,u];f=Xl(f,c,r),u=Xl(u,l,r)}return[void 0,void 0]}function wse(t,e){const[n,r]=Cse(t,e)||[],i=(c,l)=>yse(c,l)===!1,[a,o]=eC([Xl(n,t.length,1),n,t],[Xl(r,e.length,1),r,e],i,1),[s]=eC([Xl(a,t.length,-1),a,t],[Xl(o,e.length,-1),o,e],i,-1);return[a,s]}function j2(t,e,n){const{interpolation:r,smoothing:i}=t,a=e;if(r){const{knotsRatioPercentageOnAdd:o,knotsRatioPercentageOnEdit:s,smoothOnAdd:c=!1,smoothOnEdit:l=!1}=i,f=n?s:o;if(n?l:c){const[g,d]=n?wse(e,n):[0,e.length-1];return!e[g]||!e[d]?e:vse(e,g,d,f)}}return a}const H2=t=>{if(t.shiftKey)return t.ctrlKey?Ei.ShiftCtrl:t.altKey?Ei.ShiftAlt:t.metaKey?Ei.ShiftMeta:Ei.Shift;if(t.ctrlKey)return t.altKey?Ei.CtrlAlt:t.metaKey?Ei.CtrlMeta:Ei.Ctrl;if(t.altKey)return t.metaKey&&Ei.AltMeta||Ei.Alt;if(t.metaKey)return Ei.Meta};function S8(t,e){const n=t[0],r=t[t.length-1],i=os();au(i,r[0]-n[0],r[1]-n[1]),yE(i,i);const a=os(),o=os();au(a,-i[1],i[0]),au(o,i[1],-i[0]);const s=[(n[0]+r[0])/2,(n[1]+r[1])/2],c={dist:0,index:null};for(let u=0;u<t.length;u++){const g=t[u],d=z4(g,s);d>c.dist&&(c.dist=d,c.index=u)}return[t[c.index],s].map(e.canvasToWorld)}function xse(t,e){const{viewport:n}=t,r=e.data.contour.polyline.map(n.worldToCanvas);return S8(r,n)}var Uu;(function(t){t[t.CounterClockwise=-1]="CounterClockwise",t[t.Unknown=0]="Unknown",t[t.Clockwise=1]="Clockwise"})(Uu||(Uu={}));const{addCanvasPointsToArray:E8,pointsAreWithinCloseContourProximity:Vb,getFirstLineSegmentIntersectionIndexes:Pb,getSubPixelSpacingAndXYDirections:Sse}=ml;function Ese(t,e,n){this.isDrawing=!0;const r=t.detail,{currentPoints:i,element:a}=r,o=i.canvas,s=We(a),{viewport:c}=s,l=H2(t.detail.event)===this.configuration.contourHoleAdditionModifierKey,{spacing:f,xDir:u,yDir:g}=Sse(c,this.configuration.subPixelResolution)||{};!f||!u||!g||(this.drawData={canvasPoints:[o],polylineIndex:0,contourHoleProcessingEnabled:l,newAnnotation:!0},this.commonData={annotation:e,viewportIdsToRender:n,spacing:f,xDir:u,yDir:g,movingTextBox:!1},$e.isInteractingWithTool=!0,a.addEventListener(he.MOUSE_UP,this.mouseUpDrawCallback),a.addEventListener(he.MOUSE_DRAG,this.mouseDragDrawCallback),a.addEventListener(he.MOUSE_CLICK,this.mouseUpDrawCallback),a.addEventListener(he.TOUCH_END,this.mouseUpDrawCallback),a.addEventListener(he.TOUCH_DRAG,this.mouseDragDrawCallback),a.addEventListener(he.TOUCH_TAP,this.mouseUpDrawCallback),k2(a))}function Ose(t){$e.isInteractingWithTool=!1,t.removeEventListener(he.MOUSE_UP,this.mouseUpDrawCallback),t.removeEventListener(he.MOUSE_DRAG,this.mouseDragDrawCallback),t.removeEventListener(he.MOUSE_CLICK,this.mouseUpDrawCallback),t.removeEventListener(he.TOUCH_END,this.mouseUpDrawCallback),t.removeEventListener(he.TOUCH_DRAG,this.mouseDragDrawCallback),t.removeEventListener(he.TOUCH_TAP,this.mouseUpDrawCallback),e8(t)}function Dse(t){const e=t.detail,{currentPoints:n,element:r}=e,i=n.world,a=n.canvas,o=We(r),{viewport:s}=o,{annotation:c,viewportIdsToRender:l,xDir:f,yDir:u,spacing:g,movingTextBox:d}=this.commonData,{polylineIndex:h,canvasPoints:p,newAnnotation:m}=this.drawData;this.createMemo(r,c,{newAnnotation:m});const v=p[p.length-1],y=s.canvasToWorld(v),T=Le();tn(T,i,y);const C=Math.abs(Qe(T,f)),w=Math.abs(Qe(T,u));if(!(C<=g[0]&&w<=g[1])){if(d){this.isDrawing=!1;const{deltaPoints:x}=e,O=x.world,{textBox:M}=c.data.handles,{worldPosition:A}=M;A[0]+=O[0],A[1]+=O[1],A[2]+=O[2],M.hasMoved=!0}else{const x=this.findCrossingIndexDuringCreate(t);if(x!==void 0)this.applyCreateOnCross(t,x);else{const O=E8(r,p,a,this.commonData);this.drawData.polylineIndex=h+O}}mi(l)}}function Rse(t){const{allowOpenContours:e}=this.configuration,{canvasPoints:n,contourHoleProcessingEnabled:r}=this.drawData,i=n[0],a=n[n.length-1],o=t.detail,{element:s}=o;this.doneEditMemo(),this.drawData.newAnnotation=!1,e&&!Vb(i,a,this.configuration.closeContourProximity)?this.completeDrawOpenContour(s,{contourHoleProcessingEnabled:r}):this.completeDrawClosedContour(s,{contourHoleProcessingEnabled:r})}function Mse(t,e){this.removeCrossedLinesOnCompleteDraw();const{canvasPoints:n}=this.drawData,{contourHoleProcessingEnabled:r,minPointsToSave:i}=e??{};if(i&&n.length<i||this.haltDrawing(t,n))return!1;const{annotation:a,viewportIdsToRender:o}=this.commonData,s=We(t),{viewport:c,renderingEngine:l}=s;E8(t,n,n[0],this.commonData),n.pop();const f=z2(this.configuration,a)?j2(this.configuration,n):n;this.updateContourPolyline(a,{points:f,closed:!0,targetWindingDirection:Uu.Clockwise},c);const{textBox:u}=a.data.handles;return u!=null&&u.hasMoved||r8(a,r),this.isDrawing=!1,this.drawData=void 0,this.commonData=void 0,mi(o),this.deactivateDraw(t),!0}function _se(){const{canvasPoints:t}=this.drawData,e=t.length,n=[t[0],t[e-1]],r=t.slice(0,-1).slice(1),i=Pb(r,n[0],n[1],!1);if(i){const a=i[1];a===1?this.drawData.canvasPoints=t.splice(1):this.drawData.canvasPoints=t.splice(0,a)}}function bse(t,e){const{canvasPoints:n}=this.drawData,{contourHoleProcessingEnabled:r}=e??{};if(this.haltDrawing(t,n))return!1;const{annotation:i,viewportIdsToRender:a}=this.commonData,o=We(t),{viewport:s,renderingEngine:c}=o,l=z2(this.configuration,i)?j2(this.configuration,n):n;this.updateContourPolyline(i,{points:l,closed:!1},s);const{textBox:f}=i.data.handles,u=i.data.contour.polyline;return i.data.handles.points=[u[0],u[u.length-1]],i.data.isOpenUShapeContour&&(i.data.openUShapeContourVectorToPeak=S8(n,s)),f.hasMoved||r8(i,r),this.isDrawing=!1,this.drawData=void 0,this.commonData=void 0,mi(a),this.deactivateDraw(t),!0}function Lse(t){const e=t.detail,{currentPoints:n,lastPoints:r}=e,i=n.canvas,a=r.canvas,{canvasPoints:o}=this.drawData,s=o.slice(0,-1),c=Pb(s,i,a,!1);return c===void 0?void 0:c[0]}function Ise(t,e){const n=t.detail,{element:r}=n,{canvasPoints:i,contourHoleProcessingEnabled:a}=this.drawData,{annotation:o,viewportIdsToRender:s}=this.commonData;E8(r,i,i[e],this.commonData),i.pop();const c=i.slice(e),l=y8(c);if(Mn(l,0)){i.splice(e+1);return}i.splice(0,e);const f={contourHoleProcessingEnabled:a,minPointsToSave:3};this.completeDrawClosedContour(r,f)&&this.activateClosedContourEdit(t,o,s)}function Vse(t){const{allowOpenContours:e}=this.configuration,{canvasPoints:n,contourHoleProcessingEnabled:r}=this.drawData,i=n[0],a=n[n.length-1];e&&!Vb(i,a,this.configuration.closeContourProximity)?this.completeDrawOpenContour(t,{contourHoleProcessingEnabled:r}):this.completeDrawClosedContour(t,{contourHoleProcessingEnabled:r})}function Pse(t,e){const n=Math.max(e*3,3);return t.length<n}function Nse(t,e){const{subPixelResolution:n}=this.configuration;if(Pse(e,n)){const{annotation:r,viewportIdsToRender:i}=this.commonData,a=We(t),{renderingEngine:o}=a;return al(r.annotationUID),this.isDrawing=!1,this.drawData=void 0,this.commonData=void 0,mi(i),this.deactivateDraw(t),!0}return!1}function kse(t){t.activateDraw=Ese.bind(t),t.deactivateDraw=Ose.bind(t),t.applyCreateOnCross=Ise.bind(t),t.findCrossingIndexDuringCreate=Lse.bind(t),t.completeDrawOpenContour=bse.bind(t),t.removeCrossedLinesOnCompleteDraw=_se.bind(t),t.mouseDragDrawCallback=Dse.bind(t),t.mouseUpDrawCallback=Rse.bind(t),t.completeDrawClosedContour=Mse.bind(t),t.cancelDrawing=Vse.bind(t),t.haltDrawing=Nse.bind(t)}const{addCanvasPointsToArray:Ase,getFirstLineSegmentIntersectionIndexes:ll}=ml;function Fse(t,e){const n=t.detail,{element:r,currentPoints:i,lastPoints:a}=n,o=i.canvas,s=a.canvas,{editCanvasPoints:c,prevCanvasPoints:l}=this.editData,f=ll(l,o,s,e);if(f)this.editData.startCrossingIndex=f[0],this.removePointsUpUntilFirstCrossing(e);else if(l.length>=2)if(c.length>this.configuration.checkCanvasEditFallbackProximity){const u=c[0],g=[];for(let p=0;p<l.length;p++){const m=l[p],v=yr(m,u);g.push({distance:v,index:p})}g.sort((p,m)=>p.distance-m.distance);const d=[g[0],g[1]],h=Math.min(d[0].index,d[1].index);this.editData.startCrossingIndex=h}else{const u=os();Ru(u,c[1],c[0]),yE(u,u);const g=6,d=[c[0][0]-u[0]*g,c[0][1]-u[1]*g],h=ll(l,d,c[0],e);if(h){const p=[d];Ase(r,p,c[0],this.commonData),c.unshift(...p),this.removePointsUpUntilFirstCrossing(e),this.editData.editIndex=c.length-1,this.editData.startCrossingIndex=h[0]}}}function Use(t){const{editCanvasPoints:e,prevCanvasPoints:n}=this.editData;let r=0;for(let i=0;i<e.length-1;i++){const a=[e[i],e[i+1]],o=!!ll(n,a[0],a[1],t);if(r++,o)break}e.splice(0,r),this.editData.editIndex=e.length-1}function Bse(t,e){const n=t.detail,{currentPoints:r,lastPoints:i}=n,a=r.canvas,o=i.canvas,{prevCanvasPoints:s}=this.editData;return!!ll(s,a,o,e)}function Gse(t){const{prevCanvasPoints:e,editCanvasPoints:n}=this.editData;for(let r=n.length-1;r>0;r--){const i=[n[r],n[r-1]],a=!!ll(e,i[0],i[1],t);if(n.pop(),a)break}}function $se(){const{editCanvasPoints:t,prevCanvasPoints:e,startCrossingIndex:n}=this.editData;if(n===void 0)return;const r=t[t.length-1],i=[];for(let o=0;o<e.length;o++){const s=e[o],c=yr(s,r);i.push({distance:c,index:o})}i.sort((o,s)=>o.distance-s.distance);const a=t.slice(0,-1);for(let o=0;o<i.length;o++){const{index:s}=i[o],c=e[s],l=t[t.length-1];if(!ll(a,c,l,!1))return s}return-1}function Wse(t){const e=t.detail,{currentPoints:n,lastPoints:r}=e,i=n.canvas,a=r.canvas,{editCanvasPoints:o}=this.editData,s=o.slice(0,-2),c=ll(s,i,a,!1);if(!c)return;const l=c[0],f=o.length-l;for(let u=0;u<f;u++)o.pop()}function zse(t){t.checkForFirstCrossing=Fse.bind(t),t.removePointsUpUntilFirstCrossing=Use.bind(t),t.checkForSecondCrossing=Bse.bind(t),t.findSnapIndex=$se.bind(t),t.removePointsAfterSecondCrossing=Gse.bind(t),t.checkAndRemoveCrossesOnEditLine=Wse.bind(t)}function Vc(t,e,n,r){var h,p,m;const{canvasToWorld:i,worldToCanvas:a}=n,{data:o}=t,{targetWindingDirection:s}=e;let{points:c}=e,l=wp(c);(h=r==null?void 0:r.decimate)!=null&&h.enabled&&(c=_b(e.points,(p=r==null?void 0:r.decimate)==null?void 0:p.epsilon));let{closed:f}=e;const u=c.length,g=new Array(u);wp(c);const d=R_(t);if(f===void 0){let v=!1;if(c.length>3){const y=ol(c[0],c[u-1]);v=Mn(0,y)}f=v}if((r==null?void 0:r.updateWindingDirection)!==!1){let v=d?d.data.contour.windingDirection*-1:s;v===void 0&&(v=l),v!==l&&c.reverse();const y=(((m=o.handles)==null?void 0:m.points)??[]).map(a);y.length>2&&wp(y)!==v&&o.handles.points.reverse(),l=v}for(let v=0;v<u;v++)g[v]=i(c[v]);o.contour.polyline=g,o.contour.closed=f,o.contour.windingDirection=l,M_(t)}const{getSubPixelSpacingAndXYDirections:jse,addCanvasPointsToArray:Nb,getArea:tC}=ml;function Hse(t,e,n){this.isEditingClosed=!0;const r=t.detail,{currentPoints:i,element:a}=r,o=i.canvas,s=We(a);if(!s)return;const{viewport:c}=s,l=e.data.contour.polyline.map(c.worldToCanvas),{spacing:f,xDir:u,yDir:g}=jse(c,this.configuration.subPixelResolution);this.editData={prevCanvasPoints:l,editCanvasPoints:[o],startCrossingIndex:void 0,editIndex:0,annotation:e},this.commonData={annotation:e,viewportIdsToRender:n,spacing:f,xDir:u,yDir:g,movingTextBox:!1},$e.isInteractingWithTool=!0,a.addEventListener(he.MOUSE_UP,this.mouseUpClosedContourEditCallback),a.addEventListener(he.MOUSE_DRAG,this.mouseDragClosedContourEditCallback),a.addEventListener(he.MOUSE_CLICK,this.mouseUpClosedContourEditCallback),a.addEventListener(he.TOUCH_END,this.mouseUpClosedContourEditCallback),a.addEventListener(he.TOUCH_DRAG,this.mouseDragClosedContourEditCallback),a.addEventListener(he.TOUCH_TAP,this.mouseUpClosedContourEditCallback),k2(a)}function Kse(t){$e.isInteractingWithTool=!1,t.removeEventListener(he.MOUSE_UP,this.mouseUpClosedContourEditCallback),t.removeEventListener(he.MOUSE_DRAG,this.mouseDragClosedContourEditCallback),t.removeEventListener(he.MOUSE_CLICK,this.mouseUpClosedContourEditCallback),t.removeEventListener(he.TOUCH_END,this.mouseUpClosedContourEditCallback),t.removeEventListener(he.TOUCH_DRAG,this.mouseDragClosedContourEditCallback),t.removeEventListener(he.TOUCH_TAP,this.mouseUpClosedContourEditCallback),e8(t)}function qse(t){const e=t.detail,{currentPoints:n,element:r}=e,i=n.world,a=n.canvas,o=We(r),{viewport:s}=o,{viewportIdsToRender:c,xDir:l,yDir:f,spacing:u}=this.commonData,{editIndex:g,editCanvasPoints:d,startCrossingIndex:h,annotation:p}=this.editData;this.createMemo(r,p);const m=d[d.length-1],v=s.canvasToWorld(m),y=Le();tn(y,i,v);const T=Math.abs(Qe(y,l)),C=Math.abs(Qe(y,f));if(T<=u[0]&&C<=u[1])return;h!==void 0&&this.checkAndRemoveCrossesOnEditLine(t);const w=Nb(r,d,a,this.commonData),x=g+w;if(this.editData.editIndex=x,h===void 0&&d.length>1&&this.checkForFirstCrossing(t,!0),this.editData.snapIndex=this.findSnapIndex(),this.editData.snapIndex===-1){this.finishEditAndStartNewEdit(t);return}this.editData.fusedCanvasPoints=this.fuseEditPointsWithClosedContour(t),h!==void 0&&this.checkForSecondCrossing(t,!0)&&(this.removePointsAfterSecondCrossing(!0),this.finishEditAndStartNewEdit(t)),mi(c)}function Xse(t){const e=t.detail,{element:n}=e,r=We(n),{viewport:i,renderingEngine:a}=r,{annotation:o,viewportIdsToRender:s}=this.commonData,{fusedCanvasPoints:c,editCanvasPoints:l}=this.editData;Vc(o,{points:c,closed:!0,targetWindingDirection:Uu.Clockwise},i),o.autoGenerated&&(o.autoGenerated=!1),So(o,n);const f=l.pop();this.editData={prevCanvasPoints:c,editCanvasPoints:[f],startCrossingIndex:void 0,editIndex:0,snapIndex:void 0,annotation:o},mi(s)}function Yse(t){const{prevCanvasPoints:e,editCanvasPoints:n,startCrossingIndex:r,snapIndex:i}=this.editData;if(r===void 0||i===void 0)return;const a=t.detail,{element:o}=a,s=[...n];Nb(o,s,e[i],this.commonData),s.length>n.length&&s.pop();let c,l;r>i?(c=i,l=r):(c=r,l=i);const f=yr(e[c],s[0]),u=yr(e[c],s[s.length-1]),g=yr(e[l],s[0]),d=yr(e[l],s[s.length-1]),h=[];for(let w=0;w<c;w++){const x=e[w];h.push([x[0],x[1]])}let p=f+d,m=u+g;if(p<m)for(let w=0;w<s.length;w++){const x=s[w];h.push([x[0],x[1]])}else for(let w=s.length-1;w>=0;w--){const x=s[w];h.push([x[0],x[1]])}for(let w=l;w<e.length;w++){const x=e[w];h.push([x[0],x[1]])}const v=[];for(let w=c;w<l;w++){const x=e[w];v.push([x[0],x[1]])}if(p=g+u,m=d+f,p<m)for(let w=0;w<s.length;w++){const x=s[w];v.push([x[0],x[1]])}else for(let w=s.length-1;w>=0;w--){const x=s[w];v.push([x[0],x[1]])}const y=tC(h),T=tC(v);return y>T?h:v}function Zse(t){const e=t.detail,{element:n}=e;this.completeClosedContourEdit(n)}function Qse(t){var s;const e=We(t),{viewport:n}=e,{annotation:r,viewportIdsToRender:i}=this.commonData;this.doneEditMemo();const{fusedCanvasPoints:a,prevCanvasPoints:o}=this.editData;if(a){const c=z2(this.configuration,r)?j2(this.configuration,a,o):a,l=((s=this.configuration)==null?void 0:s.decimate)||{};Vc(r,{points:c,closed:!0,targetWindingDirection:Uu.Clockwise},n,{decimate:{enabled:!!l.enabled,epsilon:l.epsilon}}),r.autoGenerated&&(r.autoGenerated=!1),So(r,t)}this.isEditingClosed=!1,this.editData=void 0,this.commonData=void 0,mi(i),this.deactivateClosedContourEdit(t)}function Jse(t){this.completeClosedContourEdit(t)}function ece(t){t.activateClosedContourEdit=Hse.bind(t),t.deactivateClosedContourEdit=Kse.bind(t),t.mouseDragClosedContourEditCallback=qse.bind(t),t.mouseUpClosedContourEditCallback=Zse.bind(t),t.finishEditAndStartNewEdit=Xse.bind(t),t.fuseEditPointsWithClosedContour=Yse.bind(t),t.cancelClosedContourEdit=Jse.bind(t),t.completeClosedContourEdit=Qse.bind(t)}const{addCanvasPointsToArray:kb,getSubPixelSpacingAndXYDirections:tce}=ml;function nce(t,e,n){this.isEditingOpen=!0;const r=t.detail,{currentPoints:i,element:a}=r,o=i.canvas,s=We(a),{viewport:c}=s;this.doneEditMemo();const l=e.data.contour.polyline.map(c.worldToCanvas),{spacing:f,xDir:u,yDir:g}=tce(c,this.configuration.subPixelResolution);this.editData={prevCanvasPoints:l,editCanvasPoints:[o],startCrossingIndex:void 0,editIndex:0},this.commonData={annotation:e,viewportIdsToRender:n,spacing:f,xDir:u,yDir:g,movingTextBox:!1},$e.isInteractingWithTool=!0,a.addEventListener(he.MOUSE_UP,this.mouseUpOpenContourEditCallback),a.addEventListener(he.MOUSE_DRAG,this.mouseDragOpenContourEditCallback),a.addEventListener(he.MOUSE_CLICK,this.mouseUpOpenContourEditCallback),a.addEventListener(he.TOUCH_END,this.mouseUpOpenContourEditCallback),a.addEventListener(he.TOUCH_DRAG,this.mouseDragOpenContourEditCallback),a.addEventListener(he.TOUCH_TAP,this.mouseUpOpenContourEditCallback),k2(a)}function rce(t){$e.isInteractingWithTool=!1,t.removeEventListener(he.MOUSE_UP,this.mouseUpOpenContourEditCallback),t.removeEventListener(he.MOUSE_DRAG,this.mouseDragOpenContourEditCallback),t.removeEventListener(he.MOUSE_CLICK,this.mouseUpOpenContourEditCallback),t.removeEventListener(he.TOUCH_END,this.mouseUpOpenContourEditCallback),t.removeEventListener(he.TOUCH_DRAG,this.mouseDragOpenContourEditCallback),t.removeEventListener(he.TOUCH_TAP,this.mouseUpOpenContourEditCallback),e8(t)}function ice(t){const e=t.detail,{currentPoints:n,element:r}=e,i=n.world,a=n.canvas,o=We(r),{viewport:s}=o,{viewportIdsToRender:c,xDir:l,yDir:f,spacing:u}=this.commonData,{editIndex:g,editCanvasPoints:d,startCrossingIndex:h}=this.editData,p=d[d.length-1],m=s.canvasToWorld(p),v=Le();this.createMemo(r,this.commonData.annotation),tn(v,i,m);const y=Math.abs(Qe(v,l)),T=Math.abs(Qe(v,f));if(y<=u[0]&&T<=u[1])return;h!==void 0&&this.checkAndRemoveCrossesOnEditLine(t);const C=kb(r,d,a,this.commonData),w=g+C;this.editData.editIndex=w,h===void 0&&d.length>1&&this.checkForFirstCrossing(t,!1),this.editData.snapIndex=this.findSnapIndex(),this.editData.fusedCanvasPoints=this.fuseEditPointsWithOpenContour(t),h!==void 0&&this.checkForSecondCrossing(t,!1)?(this.removePointsAfterSecondCrossing(!1),this.finishEditOpenOnSecondCrossing(t)):this.checkIfShouldOverwriteAnEnd(t)&&this.openContourEditOverwriteEnd(t),mi(c)}function ace(t){const e=t.detail,{element:n}=e,r=We(n),{viewport:i}=r,{annotation:a,viewportIdsToRender:o}=this.commonData,s=this.fuseEditPointsForOpenContourEndEdit();Vc(a,{points:s,closed:!1},i);const c=a.data.contour.polyline;a.data.handles.points=[c[0],c[c.length-1]],a.data.handles.activeHandleIndex=1,So(a,n),this.isEditingOpen=!1,this.editData=void 0,this.commonData=void 0,this.doneEditMemo(),this.deactivateOpenContourEdit(n),this.activateOpenContourEndEdit(t,a,o,null)}function oce(t){const e=t.detail,{currentPoints:n,lastPoints:r}=e,i=n.canvas,a=r.canvas,{snapIndex:o,prevCanvasPoints:s,startCrossingIndex:c}=this.editData;if(c===void 0||o===void 0)return!1;if(o===-1)return!0;if(o!==0&&o!==s.length-1)return!1;const l=i,f=a,u=s[o],g=os(),d=os();au(g,l[0]-f[0],l[1]-f[1]),au(d,l[0]-u[0],l[1]-u[1]);const h=mF(g,d),p=Math.sqrt(g[0]*g[0]+g[1]*g[1]),m=Math.sqrt(d[0]*d[0]+d[1]*d[1]);return Math.acos(h/(p*m))<Math.PI/2}function sce(){const{snapIndex:t,prevCanvasPoints:e,editCanvasPoints:n,startCrossingIndex:r}=this.editData,i=[];if(t===0)for(let s=e.length-1;s>=r;s--){const c=e[s];i.push([c[0],c[1]])}else for(let s=0;s<r;s++){const c=e[s];i.push([c[0],c[1]])}const a=yr(e[r],n[0]),o=yr(e[r],n[n.length-1]);if(a<o)for(let s=0;s<n.length;s++){const c=n[s];i.push([c[0],c[1]])}else for(let s=n.length-1;s>=0;s--){const c=n[s];i.push([c[0],c[1]])}return i}function cce(t){const{prevCanvasPoints:e,editCanvasPoints:n,startCrossingIndex:r,snapIndex:i}=this.editData;if(r===void 0||i===void 0)return;const a=t.detail,{element:o}=a,s=[...n];kb(o,s,e[i],this.commonData),s.length>n.length&&s.pop();let c,l;r>i?(c=i,l=r):(c=r,l=i);const f=yr(e[c],s[0]),u=yr(e[c],s[s.length-1]),g=yr(e[l],s[0]),d=yr(e[l],s[s.length-1]),h=[];for(let v=0;v<c;v++){const y=e[v];h.push([y[0],y[1]])}const p=f+d,m=u+g;if(p<m)for(let v=0;v<s.length;v++){const y=s[v];h.push([y[0],y[1]])}else for(let v=s.length-1;v>=0;v--){const y=s[v];h.push([y[0],y[1]])}for(let v=l;v<e.length;v++){const y=e[v];h.push([y[0],y[1]])}return h}function lce(t){const e=t.detail,{element:n}=e,r=We(n),{viewport:i,renderingEngine:a}=r,{annotation:o,viewportIdsToRender:s}=this.commonData,{fusedCanvasPoints:c,editCanvasPoints:l}=this.editData;Vc(o,{points:c,closed:!1},i);const f=o.data.contour.polyline;o.data.handles.points=[f[0],f[f.length-1]],So(o,n);const u=l.pop();this.editData={prevCanvasPoints:c,editCanvasPoints:[u],startCrossingIndex:void 0,editIndex:0},mi(s)}function uce(t){const e=t.detail,{element:n}=e;this.completeOpenContourEdit(n)}function fce(t){var s;const e=We(t),{viewport:n}=e,{annotation:r,viewportIdsToRender:i}=this.commonData;this.doneEditMemo();const{fusedCanvasPoints:a,prevCanvasPoints:o}=this.editData;if(a){const c=z2(this.configuration)?j2(this.configuration,a,o):a,l=((s=this.configuration)==null?void 0:s.decimate)||{};Vc(r,{points:c,closed:!1},n,{decimate:{enabled:!!l.enabled,epsilon:l.epsilon}});const f=r.data.contour.polyline;r.data.handles.points=[f[0],f[f.length-1]],r.data.isOpenUShapeContour&&(r.data.openUShapeContourVectorToPeak=S8(a,n)),So(r,t)}this.isEditingOpen=!1,this.editData=void 0,this.commonData=void 0,mi(i),this.deactivateOpenContourEdit(t)}function gce(t){this.completeOpenContourEdit(t)}function dce(t){t.activateOpenContourEdit=nce.bind(t),t.deactivateOpenContourEdit=rce.bind(t),t.mouseDragOpenContourEditCallback=ice.bind(t),t.mouseUpOpenContourEditCallback=uce.bind(t),t.fuseEditPointsWithOpenContour=cce.bind(t),t.finishEditOpenOnSecondCrossing=lce.bind(t),t.checkIfShouldOverwriteAnEnd=oce.bind(t),t.fuseEditPointsForOpenContourEndEdit=sce.bind(t),t.openContourEditOverwriteEnd=ace.bind(t),t.cancelOpenContourEdit=gce.bind(t),t.completeOpenContourEdit=fce.bind(t)}const{getSubPixelSpacingAndXYDirections:pce}=ml;function hce(t,e,n,r){this.isDrawing=!0;const i=t.detail,{element:a}=i,o=We(a),{viewport:s}=o,{spacing:c,xDir:l,yDir:f}=pce(s,this.configuration.subPixelResolution),u=e.data.contour.polyline.map(s.worldToCanvas);e.data.handles.activeHandleIndex===0&&u.reverse();let d=!1;r!=null&&r.worldPosition&&(d=!0),this.drawData={canvasPoints:u,polylineIndex:u.length-1},this.commonData={annotation:e,viewportIdsToRender:n,spacing:c,xDir:l,yDir:f,movingTextBox:d},$e.isInteractingWithTool=!0,a.addEventListener(he.MOUSE_UP,this.mouseUpDrawCallback),a.addEventListener(he.MOUSE_DRAG,this.mouseDragDrawCallback),a.addEventListener(he.MOUSE_CLICK,this.mouseUpDrawCallback),a.addEventListener(he.TOUCH_END,this.mouseUpDrawCallback),a.addEventListener(he.TOUCH_DRAG,this.mouseDragDrawCallback),a.addEventListener(he.TOUCH_TAP,this.mouseUpDrawCallback),k2(a)}function mce(t){t.activateOpenContourEndEdit=hce.bind(t)}function vce(t){return(t.childAnnotationUIDs??[]).map(n=>sr(n).data.contour.polyline)}function K2(t,e){const n=vce(t),r=[];return n.forEach(i=>{const a=i.length,o=new Array(a);for(let s=0;s<a;s++)o[s]=e.worldToCanvas(i[s]);r.push(o)}),r}const{pointsAreWithinCloseContourProximity:yce}=ml;function Tce(t,e){const n={toolGroupId:this.toolGroupId,toolName:this.getToolName(),viewportId:t.viewport.id,annotationUID:e.annotationUID},{lineWidth:r,lineDash:i,color:a,fillColor:o,fillOpacity:s}=this.getAnnotationStyle({annotation:e,styleSpecifier:n}),{closed:c}=e.data.contour;return{color:a,width:r,lineDash:i,fillColor:o,fillOpacity:s,closePath:c}}function Cce(t,e,n){var r;(r=t==null?void 0:t.viewport)!=null&&r.getImageData()&&(n.data.contour.closed?this.renderClosedContour(t,e,n):n.data.isOpenUShapeContour?(wce(t,n),this.renderOpenUShapedContour(t,e,n)):this.renderOpenContour(t,e,n))}function wce(t,e){e.data.openUShapeContourVectorToPeak||(e.data.openUShapeContourVectorToPeak=xse(t,e))}function xce(t,e,n){if(n.parentAnnotationUID)return;const{viewport:r}=t,i=this._getRenderingOptions(t,n),a=n.data.contour.polyline.map(l=>r.worldToCanvas(l)),o=K2(n,r),s=[a,...o];mu(e,n.annotationUID,"1",s,i)}function Sce(t,e,n){var c;const{viewport:r}=t,i=this._getRenderingOptions(t,n),a=n.data.contour.polyline.map(l=>r.worldToCanvas(l));Fu(e,n.annotationUID,"1",a,i);const s=n.data.handles.activeHandleIndex;if(((c=this.configuration.alwaysRenderOpenContourHandles)==null?void 0:c.enabled)===!0){const l=this.configuration.alwaysRenderOpenContourHandles.radius,f="0",u=[a[0],a[a.length-1]];s===0?u.shift():s===1&&u.pop(),pv(e,n.annotationUID,f,u,{color:i.color,handleRadius:l})}if(s!==null){const l="1",f=s===0?0:a.length-1,u=a[f];pv(e,n.annotationUID,l,[u],{color:i.color})}}function Ece(t,e,n){const{viewport:r}=t,{openUShapeContourVectorToPeak:i}=n.data,{polyline:a}=n.data.contour;if(this.renderOpenContour(t,e,n),!i)return;const o=r.worldToCanvas(a[0]),s=r.worldToCanvas(a[a.length-1]),c=[r.worldToCanvas(i[0]),r.worldToCanvas(i[1])],l=this._getRenderingOptions(t,n);Fu(e,n.annotationUID,"first-to-last",[o,s],{color:l.color,width:l.width,closePath:!1,lineDash:"2,2"}),Fu(e,n.annotationUID,"midpoint-to-open-contour",[c[0],c[1]],{color:l.color,width:l.width,closePath:!1,lineDash:"2,2"})}function Oce(t,e,n){const r=this._getRenderingOptions(t,n),{allowOpenContours:i}=this.configuration,{canvasPoints:a}=this.drawData;if(r.closePath=!1,Fu(e,n.annotationUID,"1",a,r),i){const o=a[0],s=a[a.length-1];yce(o,s,this.configuration.closeContourProximity)?Fu(e,n.annotationUID,"2",[s,o],r):pv(e,n.annotationUID,"0",[o],{color:r.color,handleRadius:2})}}function Dce(t,e,n){const{viewport:r}=t,{fusedCanvasPoints:i}=this.editData;if(i===void 0){this.renderClosedContour(t,e,n);return}const a=K2(n,r),o=[i,...a],s=this._getRenderingOptions(t,n),c="preview-1";n.parentAnnotationUID&&s.fillOpacity&&(s.fillOpacity=0),mu(e,n.annotationUID,c,o,s)}function Rce(t,e,n){const{fusedCanvasPoints:r}=this.editData;if(r===void 0){this.renderOpenContour(t,e,n);return}const i=this._getRenderingOptions(t,n);Fu(e,n.annotationUID,"preview-1",r,i)}function Mce(t,e,n){if(n.parentAnnotationUID)return;const{viewport:r}=t,i=this._getRenderingOptions(t,n),a=n.data.contour.polyline.map(h=>r.worldToCanvas(h)),o=K2(n,r),s="1",c=a[0],l=6,f=100,u=[];for(let h=0;h<f;h++){const p=h/f*2*Math.PI,m=c[0]+l*Math.cos(p),v=c[1]+l*Math.sin(p);u.push([m,v])}const g=[[c[0]-l*2,c[1]],[c[0]+l*2,c[1]],[c[0],c[1]-l*2],[c[0],c[1]+l*2]];mu(e,n.annotationUID,s+"-crosshair_v",[g[0],g[1]],i),mu(e,n.annotationUID,s+"-crosshair_h",[g[2],g[3]],i);const d=[u,...o];mu(e,n.annotationUID,s,d,i)}function _ce(t){t.renderContour=Cce.bind(t),t.renderClosedContour=xce.bind(t),t.renderOpenContour=Sce.bind(t),t.renderPointContourWithMarker=Mce.bind(t),t.renderOpenUShapedContour=Ece.bind(t),t.renderContourBeingDrawn=Oce.bind(t),t.renderClosedContourBeingEdited=Dce.bind(t),t.renderOpenContourBeingEdited=Rce.bind(t),t._getRenderingOptions=Tce.bind(t)}function bce(t){const e=Lce(t),n=(e.top[1]+e.bottom[1])/2;return[e.right[0],n]}function Lce(t){const e=[t[0],t[1]].sort(o),n=[t[0],t[1]].sort(s),r=e[e.length-1],i=n[0],a=n[n.length-1];return{top:i,bottom:a,right:r};function o(c,l){return c[0]<l[0]?-1:1}function s(c,l){return c[1]<l[1]?-1:1}}function Ice(t,e){if(t instanceof za){const n=ef(e),r=Me.getVolume(n);return!!(r!=null&&r.scaling)&&Object.keys(r.scaling).length>0}else if(t instanceof ha){const{preScale:n}=t.getImageData()||{};return!!(n!=null&&n.scaled)}else return!1}function nC(t,e){let n=0;for(let r=0;r<t.length-1;r++){const i=t[r],a=t[r+1];n+=Math.sqrt(Math.pow(a[0]-i[0],2)+Math.pow(a[1]-i[1],2))}if(e){const r=t[0],i=t[t.length-1];n+=Math.sqrt(Math.pow(i[0]-r[0],2)+Math.pow(i[1]-r[1],2))}return n}const{DefaultHistoryMemo:P1}=Py,yg=class yg{constructor(e,n){const r=yg.mergeDefaultProps(yg.defaults,n),i=Li(r,e),{configuration:a={},supportedInteractionTypes:o,toolGroupId:s}=i;this.toolGroupId=s,this.supportedInteractionTypes=o||[],this.configuration=Object.assign({},a),this.mode=Yt.Disabled}static mergeDefaultProps(e={},n){return n?Li(e,n):e}get toolName(){return this.getToolName()}getToolName(){return this.constructor.toolName}applyActiveStrategy(e,n){var a;const{strategies:r,activeStrategy:i}=this.configuration;return(a=r[i])==null?void 0:a.call(this,e,n)}applyActiveStrategyCallback(e,n,r,...i){var s;const{strategies:a,activeStrategy:o}=this.configuration;if(!a[o])throw new Error(`applyActiveStrategyCallback: active strategy ${o} not found, check tool configuration or spellings`);return(s=a[o][r])==null?void 0:s.call(this,e,n,...i)}setConfiguration(e){this.configuration=Li(this.configuration,e)}setActiveStrategy(e){this.setConfiguration({activeStrategy:e})}getTargetImageData(e){if(e.startsWith("imageId:")){const n=e.split("imageId:")[1],r=gi(n);let i=ev(r);return!i||!i.length||(i=i.filter(a=>a.getCurrentImageId()===n),!i||!i.length)?void 0:i[0].getImageData()}else if(e.startsWith("volumeId:")){const n=ef(e),r=Dy(n);return!r||!r.length?void 0:r[0].getImageData()}else if(e.startsWith("videoId:")){const n=gi(e),r=ev(n);return!r||!r.length?void 0:r[0].getImageData()}else throw new Error('getTargetIdImage: targetId must start with "imageId:" or "volumeId:"')}getTargetId(e){var r;const n=(r=e.getViewReferenceId)==null?void 0:r.call(e);if(n)return n;throw new Error("getTargetId: viewport must have a getViewReferenceId method")}undo(){this.doneEditMemo(),P1.undo()}redo(){P1.redo()}static createZoomPanMemo(e){const n={pan:e.getPan(),zoom:e.getZoom()},r={restoreMemo:()=>{const i=e.getPan(),a=e.getZoom();e.setZoom(n.zoom),e.setPan(n.pan),e.render(),n.pan=i,n.zoom=a}};return P1.push(r),r}doneEditMemo(){var e,n;(n=(e=this.memo)==null?void 0:e.commitMemo)!=null&&n.call(e)&&P1.push(this.memo),this.memo=null}};yg.defaults={configuration:{strategies:{},defaultStrategy:void 0,activeStrategy:void 0,strategyOptions:{}}};let Bu=yg;Bu.toolName="BaseTool";const xp=new Set;function Vce(t,e=!0){const n=Nce();t&&(e?kce(t,xp,n):Ace(t,xp,n)),Fce(n,xp)}function Gu(t){return xp.has(t)}function Pce(t){const e=Gu(t);return Vce(t,e),e}function Nce(){return Object.freeze({added:[],removed:[],locked:[]})}function kce(t,e,n){if(!e.has(t)){e.add(t),n.added.push(t);const r=sr(t);r&&(r.isLocked=!0)}}function Ace(t,e,n){if(e.delete(t)){n.removed.push(t);const r=sr(t);r&&(r.isLocked=!1)}}function Fce(t,e){(t.added.length>0||t.removed.length>0)&&(e.forEach(n=>void t.locked.push(n)),De(Ee,he.ANNOTATION_LOCK_CHANGE,t))}const uc=new Set;function ho(t,e=!0,n=!1){e?Uce(t,n):Ab(t)}function Uce(t,e=!1){const n=Fb();if(!e){Ub(uc,n);const r=sr(t);r&&(r.isSelected=!0)}if(t&&!uc.has(t)){uc.add(t),n.added.push(t);const r=sr(t);r&&(r.isSelected=!0)}Bb(n,uc)}function Ab(t){const e=Fb();if(t){if(uc.delete(t)){e.removed.push(t);const n=sr(t);n.isSelected=!1}}else Ub(uc,e);Bb(e,uc)}function q2(t){return uc.has(t)}function Fb(){return Object.freeze({added:[],removed:[],selection:[]})}function Ub(t,e){t.forEach(n=>{if(t.delete(n)){e.removed.push(n);const r=sr(n);r&&(r.isSelected=!1)}})}function Bb(t,e){(t.added.length>0||t.removed.length>0)&&(e.forEach(n=>void t.selection.push(n)),De(Ee,he.ANNOTATION_SELECTION_CHANGE,t))}function Bce(t){if(t){if(t.data&&t.highlighted)return ic.Highlighted;if(q2(t.annotationUID))return ic.Selected;if(Gu(t.annotationUID))return ic.Locked;if(t.data&&t.autoGenerated)return ic.AutoGenerated}return ic.Default}class Gb extends Bu{constructor(){super(...arguments),this.onImageSpacingCalibrated=e=>{const{element:n,imageId:r}=e.detail,i=gi(r),a=Ro();a.getFramesOfReference().forEach(s=>{const l=a.getAnnotations(s)[this.getToolName()];!l||!l.length||(l.forEach(f=>{var g;if(!((g=f.metadata)!=null&&g.referencedImageId))return;gi(f.metadata.referencedImageId)===i&&(f.invalidated=!0,f.data.cachedStats={})}),_d(n))})}}filterInteractableAnnotationsForElement(e,n){if(!(n!=null&&n.length))return[];const r=We(e),{viewport:i}=r;return Ib(i,n)}createAnnotation(e){const n=e.detail,{currentPoints:r,element:i}=n,{world:a}=r,o=We(i),{viewport:s}=o,c=s.getCamera(),{viewPlaneNormal:l,viewUp:f,position:u}=c,g=this.getReferencedImageId(s,a,l,f),d=s.getViewReference({points:[a]});return{highlighted:!0,invalidated:!0,metadata:{toolName:this.getToolName(),...d,referencedImageId:g,viewUp:f,cameraPosition:u},data:{cachedStats:{},handles:{points:[],activeHandleIndex:null,textBox:{hasMoved:!1,worldPosition:[0,0,0],worldBoundingBox:{topLeft:[0,0,0],topRight:[0,0,0],bottomLeft:[0,0,0],bottomRight:[0,0,0]}}}}}}getReferencedImageId(e,n,r,i){const a=this.getTargetId(e);let o=a.split(/^[a-zA-Z]+:/)[1];if(e instanceof za){const s=ef(a),c=Me.getVolume(s);o=Wg(c,n,r)}return o}getStyle(e,n,r){return v_(e,n,Bce(r),this.mode)}}Gb.toolName="AnnotationDisplayTool";const td=new Set;function Gce(t,e=!0){const n=$ce();t&&(e?Wce(t,td,n):zce(t,td,n)),jce(n)}function $h(t){if(sr(t))return!td.has(t)}function $ce(){return Object.freeze({lastVisible:[],lastHidden:[],hidden:[]})}function Wce(t,e,n){if(e.delete(t)){n.lastVisible.push(t);const r=sr(t);r.isVisible=!0}}function zce(t,e,n){e.has(t)||(e.add(t),q2(t)&&Ab(t),n.lastHidden.push(t))}function jce(t){(t.lastHidden.length>0||t.lastVisible.length>0)&&(td.forEach(e=>void t.hidden.push(e)),De(Ee,he.ANNOTATION_VISIBILITY_CHANGE,t))}function Hce(t){const e=!td.has(t);return Gce(t,e),e}const{DefaultHistoryMemo:Kce}=Py,{PointsManager:qce}=ws;class A0 extends Gb{static createAnnotation(...e){let n={annotationUID:null,highlighted:!0,invalidated:!0,metadata:{toolName:this.toolName},data:{text:"",handles:{points:new Array,textBox:{hasMoved:!1,worldPosition:[0,0,0],worldBoundingBox:{topLeft:[0,0,0],topRight:[0,0,0],bottomLeft:[0,0,0],bottomRight:[0,0,0]}}},label:""}};for(const r of e)n=Li(n,r);return n}static createAnnotationForViewport(e,...n){return this.createAnnotation({metadata:e.getViewReference()},...n)}static createAndAddAnnotation(e,...n){const r=this.createAnnotationForViewport(e,...n);il(r,e.element),So(r,e.element)}constructor(e,n){var r,i;super(e,n),this.mouseMoveCallback=(a,o)=>{if(!o)return!1;const{element:s,currentPoints:c}=a.detail,l=c.canvas;let f=!1;for(const u of o){if(Gu(u.annotationUID)||!$h(u.annotationUID))continue;const{data:g}=u,d=g.handles?g.handles.activeHandleIndex:void 0,h=this._imagePointNearToolOrHandle(s,u,l,6),p=h&&!u.highlighted,m=!h&&u.highlighted;p||m?(u.highlighted=!u.highlighted,f=!0):g.handles&&g.handles.activeHandleIndex!==d&&(f=!0)}return f},this.isSuvScaled=A0.isSuvScaled,(r=e.configuration)!=null&&r.getTextLines&&(this.configuration.getTextLines=e.configuration.getTextLines),(i=e.configuration)!=null&&i.statsCalculator&&(this.configuration.statsCalculator=e.configuration.statsCalculator)}getHandleNearImagePoint(e,n,r,i){const a=We(e),{viewport:o}=a,{data:s}=n,{isCanvasAnnotation:c}=s,{points:l,textBox:f}=s.handles;if(f){const{worldBoundingBox:u}=f;if(u){const g={topLeft:o.worldToCanvas(u.topLeft),topRight:o.worldToCanvas(u.topRight),bottomLeft:o.worldToCanvas(u.bottomLeft),bottomRight:o.worldToCanvas(u.bottomRight)};if(r[0]>=g.topLeft[0]&&r[0]<=g.bottomRight[0]&&r[1]>=g.topLeft[1]&&r[1]<=g.bottomRight[1])return s.handles.activeHandleIndex=null,f}}for(let u=0;u<(l==null?void 0:l.length);u++){const g=l[u],d=c?g.slice(0,2):o.worldToCanvas(g);if(yr(r,d)<i===!0)return s.handles.activeHandleIndex=u,g}s.handles.activeHandleIndex=null}getLinkedTextBoxStyle(e,n){return{visibility:this.getStyle("textBoxVisibility",e,n),fontFamily:this.getStyle("textBoxFontFamily",e,n),fontSize:this.getStyle("textBoxFontSize",e,n),color:this.getStyle("textBoxColor",e,n),shadow:this.getStyle("textBoxShadow",e,n),background:this.getStyle("textBoxBackground",e,n),lineWidth:this.getStyle("textBoxLinkLineWidth",e,n),lineDash:this.getStyle("textBoxLinkLineDash",e,n)}}static isSuvScaled(e,n,r){var a;if(e instanceof za){const o=ef(n),s=Me.getVolume(o);return((a=s==null?void 0:s.scaling)==null?void 0:a.PT)!==void 0}const i=r&&Ve("scalingModule",r);return typeof(i==null?void 0:i.suvbw)=="number"}getAnnotationStyle(e){const{annotation:n,styleSpecifier:r}=e,i=h=>this.getStyle(h,r,n),{annotationUID:a}=n,o=$h(a),s=Gu(a),c=i("lineWidth"),l=i("lineDash"),f=i("color"),u=i("markerSize"),g=i("shadow"),d=this.getLinkedTextBoxStyle(r,n);return{visibility:o,locked:s,color:f,lineWidth:c,lineDash:l,lineOpacity:1,fillColor:f,fillOpacity:0,shadow:g,textbox:d,markerSize:u}}_imagePointNearToolOrHandle(e,n,r,i){if(this.getHandleNearImagePoint(e,n,r,i)||this.isPointNearTool(e,n,r,i,"mouse"))return!0}static createAnnotationState(e,n){const{data:r,annotationUID:i}=e,a={...r,cachedStats:{}};delete a.contour,delete a.spline;const o={annotationUID:i,data:structuredClone(a),deleting:n},s=r.contour;return s&&(o.data.contour={...s,polyline:null,pointsManager:qce.create3(s.polyline.length,s.polyline)}),o}static createAnnotationMemo(e,n,r){if(!n)return;const{newAnnotation:i,deleting:a=i?!1:void 0}=r||{},{annotationUID:o}=n,s=A0.createAnnotationState(n,a),c={restoreMemo:()=>{const l=A0.createAnnotationState(n,a),{viewport:f}=We(e)||{};if(f==null||f.setViewReference(n.metadata),s.deleting===!0){if(s.deleting=!1,Object.assign(n.data,s.data),n.data.contour){const g=n.data;g.contour.polyline=s.data.contour.pointsManager.points,delete s.data.contour.pointsManager,g.segmentation&&Au(n)}s.data=l.data,il(n,e),ho(n.annotationUID,!0),f==null||f.render();return}if(s.deleting===!1){s.deleting=!0,s.data=l.data,ho(n.annotationUID),al(n.annotationUID),f==null||f.render();return}const u=sr(o);if(!u){console.warn("No current annotation");return}Object.assign(u.data,s.data),u.data.contour&&(u.data.contour.polyline=s.data.contour.pointsManager.points),s.data=l.data,u.invalidated=!0,So(u,e,ys.History)}};return Kce.push(c),c}createMemo(e,n,r){this.memo||(this.memo=A0.createAnnotationMemo(e,n,r))}}A0.toolName="AnnotationTool";class Xce extends A0{constructor(e,n){super(e,n)}renderAnnotation(e,n){let r=!1;const{viewport:i}=e,{element:a}=i;if(!i.getRenderingEngine())return console.warn("Rendering Engine has been destroyed"),r;let o=Qg(this.getToolName(),a);if(!(o!=null&&o.length)||(o=this.filterInteractableAnnotationsForElement(a,o),!(o!=null&&o.length)))return r;const s=this.getTargetId(i),c={toolGroupId:this.toolGroupId,toolName:this.getToolName(),viewportId:e.viewport.id};for(let l=0;l<o.length;l++){const f=o[l];c.annotationUID=f.annotationUID;const u=this.getAnnotationStyle({annotation:f,styleSpecifier:c});if(!u.visibility)continue;const g=this.renderAnnotationInstance({enabledElement:e,targetId:s,annotation:f,annotationStyle:u,svgDrawingHelper:n});r||(r=g),f.invalidated=!1}return r}createAnnotation(e){const n=super.createAnnotation(e);return Object.assign(n.data,{contour:{polyline:[],closed:!1}}),Object.assign(n,{interpolationUID:"",autoGenerated:!1}),n}addAnnotation(e,n){return il(e,n)}cancelAnnotation(e){}moveAnnotation(e,n){const{points:r}=e.data.handles;for(let i=0,a=r.length;i<a;i++){const o=r[i];o[0]+=n[0],o[1]+=n[1],o[2]+=n[2]}e.invalidated=!0,s8(e).forEach(i=>this.moveAnnotation(i,n))}updateContourPolyline(e,n,r,i){var o;const a=((o=this.configuration)==null?void 0:o.decimate)||{};Vc(e,n,r,{decimate:{enabled:!!a.enabled,epsilon:a.epsilon},updateWindingDirection:i==null?void 0:i.updateWindingDirection})}getPolylinePoints(e){var n;return((n=e.data.contour)==null?void 0:n.polyline)??e.data.polyline}renderAnnotationInstance(e){const{enabledElement:n,annotationStyle:r,svgDrawingHelper:i}=e,a=e.annotation;if(a.parentAnnotationUID)return;const{annotationUID:o}=a,{viewport:s}=n,{worldToCanvas:c}=s,l=this.getPolylinePoints(a).map(v=>c(v)),{lineWidth:f,lineDash:u,color:g,fillColor:d,fillOpacity:h}=r,p=K2(a,s),m=[l,...p];return mu(i,o,"contourPolyline",m,{color:g,lineDash:u,lineWidth:Math.max(.1,f),fillColor:d,fillOpacity:h}),!0}}class Yce{constructor(e){this.getGroupKey=n=>{if(typeof n=="string")return n;const i=We(n);if(!i)throw new Error("Element not enabled, you must have an enabled element if you are not providing a FrameOfReferenceUID");return i.FrameOfReferenceUID},this._imageVolumeModifiedHandler=n=>{const r=n.detail,{FrameOfReferenceUID:i}=r,o=this.annotations[i];o&&Object.keys(o).forEach(s=>{o[s].forEach(l=>{l.invalidated!==void 0&&(l.invalidated=!0)})})},this.getFramesOfReference=()=>Object.keys(this.annotations),this.getAnnotations=(n,r)=>{const i=this.annotations;return i[n]?r?i[n][r]?i[n][r]:[]:i[n]:[]},this.getAnnotation=n=>{const r=this.annotations;for(const i in r){const a=r[i];for(const o in a){const s=a[o];for(const c of s)if(n===c.annotationUID)return c}}},this.getNumberOfAnnotations=(n,r)=>{const i=this.getAnnotations(n,r);if(!i.length)return 0;if(r)return i.length;let a=0;for(const o in i)a+=i[o].length;return a},this.addAnnotation=(n,r)=>{const{metadata:i}=n,{FrameOfReferenceUID:a,toolName:o}=i;r=r||a;const s=this.annotations;let c=s[r];c||(s[r]={},c=s[r]);let l=c[o];l||(c[o]=[],l=c[o]),this.preprocessingFn&&(n=this.preprocessingFn(n)),l.push(n)},this.removeAnnotation=n=>{const{annotations:r}=this;for(const i in r){const a=r[i];for(const o in a){const s=a[o],c=s.findIndex(l=>l.annotationUID===n);c!==-1&&(s.splice(c,1),s.length===0&&delete a[o])}Object.keys(a).length===0&&delete r[i]}},this.removeAnnotations=(n,r)=>{const i=this.annotations,a=[];if(!i[n])return a;if(r){const o=i[n][r];for(const s of o)this.removeAnnotation(s.annotationUID),a.push(s)}else for(const o in i[n]){const s=i[n][o];for(const c of s)this.removeAnnotation(c.annotationUID),a.push(c)}return a},this.saveAnnotations=(n,r)=>{const i=this.annotations;if(n&&r){const a=i[n];if(!a)return;const o=a[r];return structuredClone(o)}else if(n){const a=i[n];return structuredClone(a)}return structuredClone(i)},this.restoreAnnotations=(n,r,i)=>{const a=this.annotations;if(r&&i){let o=a[r];o||(a[r]={},o=a[r]),o[i]=n}else r?a[r]=n:this.annotations=structuredClone(n)},this.getAllAnnotations=()=>Object.values(this.annotations).map(n=>Object.values(n)).flat(2),this.getNumberOfAllAnnotations=()=>{let n=0;const r=this.annotations;for(const i in r){const a=r[i];for(const o in a){const s=a[o];n+=s.length}}return n},this.removeAllAnnotations=()=>{const n=[];for(const r of this.getAllAnnotations())this.removeAnnotation(r.annotationUID),n.push(r);return n},e||(e=In()),this.annotations={},this.uid=e,Ee.addEventListener(Oe.IMAGE_VOLUME_MODIFIED,this._imageVolumeModifiedHandler)}setPreprocessingFn(e){this.preprocessingFn=e}}const Zce=new Yce("DEFAULT"),Qce=t=>(t.data||(t.data={}),t.data.handles||(t.data.handles={}),t.data.handles.textBox||(t.data.handles.textBox={}),t),Jce=t=>(t.data||(t.data={}),t.data.cachedStats||(t.data.cachedStats={}),t),O8=Zce,e0e=t=>{t=Qce(t),t=Jce(t);const e=t.annotationUID,n=Pce(e);t.isLocked=n;const r=Hce(e);return t.isVisible=r,t};O8.setPreprocessingFn(e0e);i8(O8);function t0e(){i8(O8)}const $u={...Fie,...Pie,resetAnnotationManager:t0e},rC="PlanarFreehandContourSegmentationTool";function D8(t,e=[]){const{viewport:n,sliceData:r,annotation:i}=t,a=new Map,{toolName:o,originalToolName:s}=i.metadata,c=s||o,l=(Qg(c,n.element)||[]).filter(f=>!f.metadata.originalToolName||f.metadata.originalToolName===c);if(c!==rC){const f=Qg(rC,n.element);f!=null&&f.length&&f.forEach(u=>{const{metadata:g}=u;g.originalToolName===c&&g.originalToolName!==g.toolName&&l.push(u)})}if(!(l!=null&&l.length))return a;for(let f=0;f<r.numberOfSlices;f++){const u=l.filter(d=>d.metadata.sliceIndex===f);if(!(u!=null&&u.length))continue;const g=u.filter(d=>e.every(h=>{const p=h.parentKey?h.parentKey(d):d,m=p==null?void 0:p[h.key];return Array.isArray(m)?m.every((v,y)=>v===h.value[y]):m===h.value}));g.length&&a.set(f,g)}return a}function n0e(t,e){const n=D8(t,e),r=[];if(!(n!=null&&n.size))return r;for(const i of n.values())i.forEach(a=>{r.push(a)});return r}function $b(t,e,n){const r=Li({data:{},metadata:{}},n);return Object.assign(r,{highlighted:!1,invalidated:!0,autoGenerated:!0,annotationUID:void 0,cachedStats:{},childAnnotationUIDs:[],parentAnnotationUID:void 0}),Object.assign(r.data,{handles:{points:e.points||e||[],interpolationSources:e.sources,activeHandleIndex:null,textBox:{hasMoved:!1,worldPosition:[0,0,0],worldBoundingBox:{topLeft:[0,0,0],topRight:[0,0,0],bottomLeft:[0,0,0],bottomRight:[0,0,0]}}},contour:{...n.data.contour,polyline:t}}),r}function r0e(t,e){const n=D8(e,[{key:"interpolationUID",value:e.interpolationUID}]),r=i0e(n);if(!r){console.warn("No annotations found to interpolate",n);return}const i=a0e(n,t.annotationUID),a=[];for(let o=r[0]+1;o<r[1];o++)if(o0e(n,o)){const s=c0e(o,r,n);((s==null?void 0:s[0])===i||(s==null?void 0:s[1])===i)&&s0e(s,a,o)}return{interpolationData:n,interpolationList:a}}function i0e(t){let e=1/0,n=-1/0,r=!1;for(const[i,a]of t.entries())a.length&&(e=Math.min(i,e),n=Math.max(i,n),r=!0);if(r)return[e,n]}function a0e(t,e){for(const[n,r]of t)for(let i=0;i<r.length;i++)if(r[i].annotationUID===e)return n}function o0e(t,e){const n=t.get(e);return!(n!=null&&n.length)||n.length===1&&n[0].autoGenerated}function s0e(t,e,n){const[r]=t;e[r]||(e[r]={pair:t,list:[]}),e[r].list.push(n)}function c0e(t,e,n){const r=[];let i=!0;for(let a=t-1;a>=e[0];a--){const o=n.get(a);if(o!=null&&o.length){if(o[0].autoGenerated)continue;o.length>1&&(i=!1),r.push(a);break}}if(!(!i||!r.length)){for(let a=t+1;a<=e[1];a++){const o=n.get(a);if(o!=null&&o.length){if(o[0].autoGenerated)continue;o.length>1&&(i=!1),r.push(a);break}}if(!(!i||r.length<2))return r}}const{PointsManager:iC}=ws;function l0e(t,e=12){const n=iC.create3(e);n.sources=[];const{sources:r}=n,{length:i,sources:a=[]}=t,o=5;if(i<o*3)return t.subselect(e);const s=Math.floor(Math.max(2*i/e,o*2));a.forEach(()=>r.push(iC.create3(e)));const c=u0e(t,o),l=f0e(c,e),f=[];if((l==null?void 0:l.length)>2){let u=-1;const g=s/3;l.forEach(p=>{const[m,,v]=p,y=Math.ceil((m+v)/2);v-u<g||(y-m>2*g?(_l(f,u,m,s,i),u=_l(f,m,y,s,i)):u=_l(f,u,y,s,i),v-u>g&&(u=_l(f,u,v,s,i)))});const d=f[0];hv(d+i-u,i)>2*g&&_l(f,u,d-g,s,i)}else{const u=Math.floor(i/e);_l(f,-1,i-u,u,i)}return f.forEach(u=>{const g=t.getPointArray(u);n.push(g),a.forEach((d,h)=>r[h].push(d.getPoint(u)))}),n}function u0e(t,e=6){const{length:n}=t,r=Le(),i=Le(),a=new Float32Array(n);for(let o=0;o<n;o++){const s=t.getPoint(o),c=t.getPoint(o-e),l=t.getPoint((o+e)%n);_n(r,s,c),_n(i,l,s);const f=Qe(r,i)/(oh(r)*oh(i));a[o]=f}return a}function f0e(t,e){const{max:n,deviation:r}=g0e(t),{length:i}=t;if(r<.01||i<e*3)return[];const a=[];let o=null,s,c=0;for(let l=0;l<i;l++){const f=t[l];f<n-r?o?(o[2]=l,f<s&&(s=f,c=l),o[1]=c):(s=f,c=l,o=[l,l,l]):o&&(a.push(o),o=null)}return o&&(a[0][0]===0?a[0][0]=o[0]:(o[1]=c,o[2]=i-1,a.push(o))),a}function _l(t,e,n,r,i){n<e&&(n+=i);const a=n-e,o=Math.ceil(a/r);if(o<=0)return t[t.length-1]!==n&&t.push(hv(n,i)),n;for(let s=1;s<=o;s++){const c=hv(e+s*a/o,i);t.push(c)}return t[t.length-1]}function hv(t,e){return(Math.round(t)+e)%e}function g0e(t){const{length:e}=t;let n=0,r=1/0,i=-1/0,a=0;for(let s=0;s<e;s++){const c=t[s];n+=c,r=Math.min(r,c),i=Math.max(i,c)}const o=n/e;for(let s=0;s<e;s++){const c=t[s]-o;a+=c*c}return{mean:o,max:i,min:r,sumSq:a,deviation:Math.sqrt(a/e)}}function d0e(t){const{parentAnnotationUID:e,annotationUID:n}=t;if(!e)return t.interpolationUID;const r=$u.getAnnotation(e),{interpolationUID:i}=r,a=r.childAnnotationUIDs.indexOf(n);return t.interpolationUID=`${i}-${a}`,t.interpolationUID}const{isEqual:aC}=ws;function Wb(t){const{metadata:e}=t;return mZ().filter(n=>{if(n.FrameOfReferenceUID===e.FrameOfReferenceUID){const r=n.viewport,{viewPlaneNormal:i,viewUp:a}=r.getCamera();return aC(i,e.viewPlaneNormal)&&(!e.viewUp||aC(a,e.viewUp))}}).map(n=>n.viewport)}const pg="PlanarFreehandContourSegmentationTool";async function p0e(t){const e=t.detail.annotation;if(!$2(e))return;const n=h0e(e),r=m0e(n,e);if(!r.length)return;const i=X2(e.data.contour.polyline,n),a=v0e(n,i,r);if(!a)return;const{targetAnnotation:o,targetPolyline:s,isContourHole:c}=a;if(c){const{contourHoleProcessingEnabled:l=!1}=t.detail;if(!l)return;jb(n,o,e)}else T0e(n,o,s,e,i)}function zb(t,e=!1){const n="PlanarFreehandContourSegmentationTool",r=Vr(t.id,t.renderingEngineId);let i;return r.hasTool(n)?r.getToolOptions(n)||(i=`Tool ${n} must be in active/passive state`):i=`Tool ${n} not added to ${r.id} toolGroup`,i&&!e&&console.warn(i),!i}function h0e(t){const e=Wb(t);return e.find(r=>zb(r,!0))??e[0]}function X2(t,e){const n=t.length,r=new Array(n);for(let i=0;i<n;i++)r[i]=e.worldToCanvas(t[i]);return r}function m0e(t,e){const{annotationUID:n}=e;return D_().filter(i=>i.annotationUID&&i.annotationUID!==n&&$2(i)&&soe(i,e)&&t.isReferenceViewable(i.metadata))}function v0e(t,e,n){const r=Gh(e);for(let i=0;i<n.length;i++){const a=n[i],o=X2(a.data.contour.polyline,t),s=Gh(o),c=Coe(r,s),l=c&&Mb(e,o),f=c&&!l&&v8(o,e);if(l||f)return{targetAnnotation:a,targetPolyline:o,isContourHole:f}}}function jb(t,e,n){const{windingDirection:r}=e.data.contour,{windingDirection:i}=n.data.contour;o8(e,n),m8(n);const{contour:a}=n.data,o=X2(a.polyline,t);Vc(n,{points:o,closed:a.closed},t);const{element:s}=t,c=new Set([pg,e.metadata.toolName,n.metadata.toolName]);for(const l of c.values()){const f=dg(s,l);mi(f)}}function y0e(t,e){return s8(e).map(n=>{const r=X2(n.data.contour.polyline,t);return{annotation:n,polyline:r}})}function T0e(t,e,n,r,i){var T;if(!Uie(pg)){console.warn(`${pg} is not registered in cornerstone`);return}if(!zb(t))return;const a=i[0],o=sl(n,a),s=y0e(t,e),c=new Set(s),l=new Map,f=(C,w)=>{let x=l.get(C);x||(x=[],l.set(C,x)),x.push(w),c.delete(w)},u=[];if(o){const C=Ob(n,i);u.push(C),Array.from(c.keys()).forEach(w=>f(C,w))}else Db(n,i).forEach(w=>{u.push(w),Array.from(c.keys()).forEach(x=>{v8(w,x.polyline)&&(f(w,x),c.delete(x))})});Array.from(l.values()).forEach(C=>C.forEach(w=>a8(w.annotation)));const{element:g}=t,d=We(g),{metadata:h,data:p}=e,{handles:m,segmentation:v}=p,{textBox:y}=m;al(r.annotationUID),al(e.annotationUID);for(let C=0;C<u.length;C++){const w=u[C],x=t.canvasToWorld(w[0]),O=t.canvasToWorld(w[w.length-1]),M={metadata:{...h,toolName:pg,originalToolName:h.originalToolName||h.toolName},data:{cachedStats:{},handles:{points:[x,O],textBox:y?{...y}:void 0},contour:{polyline:[],closed:!0},spline:e.data.spline,segmentation:{...v}},annotationUID:In(),highlighted:!0,invalidated:!0,isLocked:!1,isVisible:void 0,interpolationUID:e.interpolationUID,interpolationCompleted:e.interpolationCompleted};Vc(M,{points:w,closed:!0,targetWindingDirection:Uu.Clockwise},t),il(M,g),Au(M),So(M,t.element),(T=l.get(w))==null||T.forEach(A=>o8(M,A.annotation))}C0e(d,e,r)}function C0e(t,e,n){const{viewport:r}=t,{element:i}=r,a=new Set([pg,e.metadata.toolName,n.metadata.toolName]);for(const o of a.values()){const s=dg(i,o);mi(s)}return new Promise(o=>window.requestAnimationFrame(o))}const{PointsManager:_f}=ws,oC=.2;function Sp(t){if(!t.annotation)return;const{isInterpolationUpdate:e,annotation:n}=t;queueMicrotask(()=>{try{e&&(n.isInterpolationUpdate=!0,n.autoGenerated=!1),w0e(t)}finally{e&&(n.autoGenerated=!0)}})}function w0e(t){const{annotation:e}=t;d0e(e);const{interpolationData:n,interpolationList:r}=r0e(e,t)||{};if(!n||!r)return;const i={toolName:e.metadata.toolName,toolType:e.metadata.toolName,viewport:t.viewport};for(let l=0;l<r.length;l++)r[l]&&x0e(r[l].list,r[l].pair,n,i);const{id:a,renderingEngineId:o,element:s}=t.viewport,c={annotation:e,element:s,viewportId:a,renderingEngineId:o};r.length&&De(t.viewport.element,he.ANNOTATION_INTERPOLATION_PROCESS_COMPLETED,c)}function x0e(t,e,n,r){const i=n.get(e[0])[0],a=n.get(e[1])[0],o=dC(i.data.contour.polyline),s=dC(a.data.contour.polyline),{c1Interp:c,c2Interp:l}=R0e(o,s);c.kIndex=e[0],l.kIndex=e[1],t.forEach(function(f){S0e(c,l,f,e,n,o.x.length>s.x.length,r)})}function S0e(t,e,n,r,i,a,o){const[s,c]=r,l=(n-s)/(c-s),f=i.get(s)[0],u=i.get(c)[0],g=D0e(t,e,l,a),d=l>.5?u:f,h=l0e(g);i.has(n)?O0e(g,h,n,d,o):E0e(g,h,n,d,o)}function E0e(t,e,n,r,i){var f;const a=t.points,{viewport:o}=i,s=$b(a,e,r),c=o.getViewReference({sliceIndex:n});if(!c)throw new Error(`Can't find slice ${n}`);Object.assign(s.metadata,c),$u.addAnnotation(s,o.element),(f=r.onInterpolationComplete)==null||f.call(r,s,r);const{parentAnnotationUID:l}=r;if(l){const u=$u.getAnnotation(l),g=Hb(u,n,i);jb(o,g,s)}}function Hb(t,e,n){const{viewport:r}=n,i=$u.getAnnotations(t.metadata.toolName,r.element);for(let a=0;a<i.length;a++){const o=i[a];if(o.interpolationUID===t.interpolationUID&&o.metadata.sliceIndex===e)return o}}function O0e(t,e,n,r,i){const a=Hb(r,n,i),o=t.points,s=$b(o,e,a);Object.assign(a,{metadata:s.metadata,data:s.data})}function D0e(t,e,n,r){const i=r?t.I:e.I,a=_f.fromXYZ(t),o=_f.fromXYZ(e),{length:s}=a,c=_f.create3(s),l=Le(),f=Le(),u=_f.create3(s);u.kIndex=t.kIndex;const g=_f.create3(s);g.kIndex=e.kIndex;for(let d=0;d<t.x.length;d++)if(i[d]){const h=a.getPoint(d),p=o.getPoint(d);u.push(h),g.push(p),_n(l,p,h),c.push(vr(f,h,l,n))}return c.sources=[u,g],c}function R0e(t,e){const n=gC(t),r=gC(e),i=Math.max(Math.ceil(n[n.length-1]/oC),Math.ceil(r[r.length-1]/oC)),a=fC(n),o=fC(r),s=i+e.x.length,c=i+t.x.length,l=uC(s,a),f=uC(c,o),u=lC(s-2,t.x.length),g=lC(c-2,e.x.length),d=cC(l,u),h=cC(f,g),p=sC(t,d),m=sC(e,h);return _0e(p,m),M0e(p,m)}function M0e(t,e){const n={x:[],y:[],z:[],I:[]},r={x:[],y:[],z:[],I:[]};for(let i=0;i<t.x.length;i++)(t.I[i]||e.I[i])&&(n.x.push(t.x[i]),n.y.push(t.y[i]),n.z.push(t.z[i]),n.I.push(t.I[i]),r.x.push(e.x[i]),r.y.push(e.y[i]),r.z.push(e.z[i]),r.I.push(e.I[i]));return{c1Interp:n,c2Interp:r}}function _0e(t,e){const n=t.x.length,r={startingNode:0,totalSquaredXYLengths:1/0};for(let a=0;a<n;a++){let o=a,s=0;for(let c=0;c<n;c++)s+=(t.x[o]-e.x[c])**2+(t.y[o]-e.y[c])**2+(t.z[o]-e.z[c])**2,o++,o===n&&(o=0);s<r.totalSquaredXYLengths&&(r.totalSquaredXYLengths=s,r.startingNode=a)}const i=r.startingNode;N1(t.x,i),N1(t.y,i),N1(t.z,i),N1(t.I,i)}function N1(t,e){e-=t.length*Math.floor(e/t.length);const n=t.splice(0,e);return t.push(...n),t}function sC(t,e){const n={x:[],y:[],z:[],I:[]};for(let r=0;r<t.x.length-1;r++){n.x.push(t.x[r]),n.y.push(t.y[r]),n.z.push(t.z[r]),n.I.push(!0);const i=(t.x[r+1]-t.x[r])/(e[r]+1),a=(t.y[r+1]-t.y[r])/(e[r]+1),o=(t.z[r+1]-t.z[r])/(e[r]+1);for(let s=0;s<e[r]-1;s++)n.x.push(n.x[n.x.length-1]+i),n.y.push(n.y[n.y.length-1]+a),n.z.push(n.z[n.z.length-1]+o),n.I.push(!1)}return n}function cC(t,e){const n=[];for(let o=0;o<t.length;++o)n[o]=o;n.sort(function(o,s){return t[o]<t[s]?-1:1});const r=[];for(let o=0;o<e.length;o++)r.push(e[n[o]]);const i=r.reduce(function(o,s,c){return s&&o.push(c),o},[]),a=[];for(let o=0;o<i.length-1;o++)a.push(i[o+1]-i[o]);return a}function lC(t,e){const n=new Array(t+e);return n.fill(!1,0,t),n.fill(!0,t,t+e),n}function uC(t,e){const n=1/(t-1),r=[n];for(let i=1;i<t-2;i++)r.push(r[r.length-1]+n);return r.concat(e)}function fC(t){const e=[];for(let n=0;n<t.length;n++)e.push(t[n]/t[t.length-1]);return e}function gC(t){const e=[0];for(let n=1;n<t.x.length;n++){const r=Math.sqrt((t.x[n]-t.x[n-1])**2+(t.y[n]-t.y[n-1])**2+(t.z[n]-t.z[n-1])**2);e.push(e[n-1]+r)}return e}function dC(t){const e={x:[],y:[],z:[]};for(let n=0;n<t.length;n++)e.x[n]=t[n][0],e.y[n]=t[n][1],e.z[n]=t[n][2];return e.x.push(e.x[0]),e.y.push(e.y[0]),e.z.push(e.z[0]),e}function pC(t){const{annotation:e}=t,n=D8(t,[{key:"interpolationUID",value:t.interpolationUID}]),r=e.metadata.sliceIndex;let i=-1,a=t.sliceData.numberOfSlices;for(const[s,c]of n.entries())s===r||!c.find(f=>!f.autoGenerated)||(s<r?i=Math.max(s,i):a=Math.min(s,a));const o=[];for(const[s,c]of n.entries())s<=i||s>=a||s===r||c.forEach(l=>{l.autoGenerated&&($u.removeAnnotation(l.annotationUID),o.push(l))});if(o.length){const s={annotations:o,element:t.viewport.element,viewportId:t.viewport.id,renderingEngineId:t.viewport.getRenderingEngine().id};De(t.viewport.element,he.INTERPOLATED_ANNOTATIONS_REMOVED,s)}if(i>=0&&a<t.sliceData.numberOfSlices){const s=n.get(a)[0],c={viewport:t.viewport,sliceData:{numberOfSlices:t.sliceData.numberOfSlices,imageIndex:s.metadata.sliceIndex},annotation:s,interpolationUID:s.interpolationUID};Sp(c)}}function mm(t){const e=Wb(t);return e.length?e[0]:void 0}const{uuidv4:b0e}=ws,L0e=[ys.HandlesUpdated,ys.InterpolationUpdated],sa=class sa{static addTool(e){this.toolNames.includes(e)||this.toolNames.push(e)}static acceptAutoGenerated(e,n={}){const{toolNames:r,segmentationId:i,segmentIndex:a,sliceIndex:o}=n;for(const s of r||sa.toolNames){const c=$u.getAnnotations(s,e);if(c!=null&&c.length)for(const l of c){const{interpolationUID:f,data:u,autoGenerated:g,metadata:d}=l;f&&(l.interpolationCompleted=!0),g&&(a&&a!==u.segmentation.segmentIndex||o!==void 0&&d&&o!==d.sliceIndex||i&&i!==u.segmentation.segmentationId||(Au(l),l.autoGenerated=!1))}}}};sa.toolNames=[],sa.handleAnnotationCompleted=e=>{var d;const n=e.detail.annotation;if(!(n!=null&&n.metadata))return;const{toolName:r,originalToolName:i}=n.metadata;if(!sa.toolNames.includes(r)&&!sa.toolNames.includes(i))return;const a=mm(n);if(!a){console.warn("Unable to find viewport for",n);return}const o=vm(a),s={viewport:a,sliceData:o,annotation:n,interpolationUID:n.interpolationUID},c=!!n.interpolationUID;if(n.autoGenerated=!1,c){pC(s),Sp(s);return}const l=[{key:"segmentIndex",value:n.data.segmentation.segmentIndex,parentKey:h=>h.data.segmentation},{key:"viewPlaneNormal",value:n.metadata.viewPlaneNormal,parentKey:h=>h.metadata},{key:"viewUp",value:n.metadata.viewUp,parentKey:h=>h.metadata}];let f=n0e(s,l);const{sliceIndex:u}=n.metadata,g=new Set;f.forEach(h=>{if(h.interpolationCompleted||h.metadata.sliceIndex===u){const{interpolationUID:p}=h;g.add(p)}}),f=f.filter(h=>!g.has(h.interpolationUID)),n.interpolationUID=((d=f[0])==null?void 0:d.interpolationUID)||b0e(),s.interpolationUID=n.interpolationUID,Sp(s)},sa.handleAnnotationUpdate=e=>{const n=e.detail.annotation,{changeType:r=ys.HandlesUpdated}=e.detail;if(!(n!=null&&n.metadata))return;const{toolName:i,originalToolName:a}=n.metadata;if(!sa.toolNames.includes(i)&&!sa.toolNames.includes(a)||!L0e.includes(r))return;const o=mm(n);if(!o){console.warn("Unable to find matching viewport for annotation interpolation",n);return}n.autoGenerated&&(Au(n),n.autoGenerated=!1);const s=vm(o),c={viewport:o,sliceData:s,annotation:n,interpolationUID:n.interpolationUID,isInterpolationUpdate:r===ys.InterpolationUpdated};Sp(c)},sa.handleAnnotationDelete=e=>{const n=e.detail.annotation;if(!(n!=null&&n.metadata))return;const{toolName:r}=n.metadata;if(!sa.toolNames.includes(r)||n.autoGenerated)return;const i=mm(n);if(!i){console.warn("No viewport, can't delete interpolated results",n);return}const a=vm(i),o={viewport:i,sliceData:a,annotation:n,interpolationUID:n.interpolationUID};n.autoGenerated=!1,pC(o)};let us=sa;function vm(t){return{numberOfSlices:t.getNumberOfSlices(),imageIndex:t.getCurrentImageIdIndex()}}function I0e(t){t.forEach(e=>{const n=t8(e);if(!n){console.warn(`ToolGroup not available for ${e}`);return}n.getViewportsInfo().forEach(i=>{const{renderingEngineId:a,viewportId:o}=i,s=dl(a);if(!s){console.warn(`RenderingEngine not available for ${a}`);return}const c=s.getViewport(o);_d(c.element)})})}function R8(t){return Mo.getActiveSegmentation(t)}function M8(t){const e=on(t);if(e){const n=Object.keys(e.segments).find(r=>e.segments[r].active);return n?Number(n):void 0}}function V0e(t){const e=on(t);if(!e)throw new Error(`No segmentation state found for ${t}`);const{segments:n}=e;return Object.keys(n).filter(i=>n[i].locked).map(i=>parseInt(i))}function P0e(t,e){return Mo.getSegmentationRepresentationVisibility(t,e)}function Kb(t,e){const n=cb(t,e);return n?Object.entries(n.segments).reduce((i,[a,o])=>(o.visible||i.add(Number(a)),i),new Set):new Set}function N0e({segmentationId:t,segmentIndex:e,viewportId:n,autoGenerated:r=!1}){const i=hb(n,t,e),a=P0e(n,{segmentationId:t,type:je.Contour}),o=R8(n),s=(o==null?void 0:o.segmentationId)===t,l=$0.getStyle({viewportId:n,segmentationId:t,type:je.Contour,segmentIndex:e});let f=1,u,g=1,d=0;r?(f=l.outlineWidthAutoGenerated??f,u=l.outlineDashAutoGenerated??u,g=l.outlineOpacity??g,d=l.fillAlphaAutoGenerated??d):s?(f=l.outlineWidth??f,u=l.outlineDash??u,g=l.outlineOpacity??g,d=l.fillAlpha??d):(f=l.outlineWidthInactive??f,u=l.outlineDashInactive??u,g=l.outlineOpacityInactive??g,d=l.fillAlphaInactive??d),M8(t)===e&&(f+=l.activeSegmentOutlineWidthDelta),f=l.renderOutline?f:0,d=l.renderFill?d:0;const h=`rgba(${i[0]}, ${i[1]}, ${i[2]}, ${g})`,p=`rgb(${i[0]}, ${i[1]}, ${i[2]})`,v=!Kb(n,{segmentationId:t,type:je.Contour}).has(e);return{color:h,fillColor:p,lineWidth:f,fillOpacity:d,lineDash:u,textbox:{color:h},visibility:a&&v}}const V8=class V8 extends Xce{constructor(e,n){var r;super(e,n),(r=this.configuration.interpolation)!=null&&r.enabled&&us.addTool(this.getToolName())}isContourSegmentationTool(){return!0}createAnnotation(e){const n=e.detail,{element:r}=n,i=We(r);if(!i)return;const{viewport:a}=i,o=super.createAnnotation(e);if(!this.isContourSegmentationTool())return o;const s=R8(a.id);if(!s)throw new Error("No active segmentation detected, create one before using scissors tool");if(!s.representationData.Contour)throw new Error("A contour segmentation must be active");const{segmentationId:c}=s,l=M8(c);return Li(o,{data:{segmentation:{segmentationId:c,segmentIndex:l}}})}addAnnotation(e,n){const r=super.addAnnotation(e,n);return this.isContourSegmentationTool()&&Au(e),r}cancelAnnotation(e){this.isContourSegmentationTool()&&m8(e),super.cancelAnnotation(e)}getAnnotationStyle(e){const n=super.getAnnotationStyle(e);if(!this.isContourSegmentationTool())return n;const r=this._getContourSegmentationStyle(e);return Li(n,r)}renderAnnotationInstance(e){const{annotation:n}=e,{invalidated:r}=n,i=super.renderAnnotationInstance(e);if(r&&this.isContourSegmentationTool()){const{segmentationId:a}=n.data.segmentation;G2(a);const s=h8(a).map(c=>Vr(c).id);I0e(s)}return i}_getContourSegmentationStyle(e){const n=e.annotation,{segmentationId:r,segmentIndex:i}=n.data.segmentation,{viewportId:a}=e.styleSpecifier,o=W0(a,{segmentationId:r});if(!(o!=null&&o.length))return{};o.length>1?o.find(m=>m.segmentationId===r&&m.type===je.Contour):o[0];const{autoGenerated:s}=n,l=V0e(r).includes(i),{color:f,fillColor:u,lineWidth:g,fillOpacity:d,lineDash:h,visibility:p}=N0e({segmentationId:r,segmentIndex:i,viewportId:a,autoGenerated:s});return{color:f,fillColor:u,lineWidth:g,fillOpacity:d,lineDash:h,textbox:{color:f},visibility:p,locked:l}}};V8.PreviewSegmentIndex=255;let mv=V8;function k0e(t,e,n){return t==="CT"?"HU":t==="PT"?A0e(e,n):""}function A0e(t,e){if(!e.isPreScaled)return"raw";if(e.isSuvScaled)return"SUV";const n=Ve("generalSeriesModule",t);if((n==null?void 0:n.modality)==="PT"){const r=Ve("petSeriesModule",t);return(r==null?void 0:r.units)||"unitless"}return"unknown"}const{pointCanProjectOnLine:hC}=ml,{EPSILON:F0e}=Bx,U0e=1-F0e,P8=class P8 extends mv{constructor(e={},n={supportedInteractionTypes:["Mouse","Touch"],configuration:{storePointData:!1,shadow:!0,preventHandleOutsideImage:!1,contourHoleAdditionModifierKey:Ei.Shift,alwaysRenderOpenContourHandles:{enabled:!1,radius:2},allowOpenContours:!0,closeContourProximity:10,checkCanvasEditFallbackProximity:6,makeClockWise:!0,subPixelResolution:4,smoothing:{smoothOnAdd:!1,smoothOnEdit:!1,knotsRatioPercentageOnAdd:40,knotsRatioPercentageOnEdit:40},interpolation:{enabled:!1,onInterpolationComplete:null},decimate:{enabled:!1,epsilon:.1},displayOnePointAsCrosshairs:!1,calculateStats:!0,getTextLines:B0e,statsCalculator:dv}}){super(e,n),this.isDrawing=!1,this.isEditingClosed=!1,this.isEditingOpen=!1,this.addNewAnnotation=r=>{const i=r.detail,{element:a}=i,o=this.createAnnotation(r);this.addAnnotation(o,a);const s=dg(a,this.getToolName());return this.activateDraw(r,o,s),r.preventDefault(),mi(s),o},this.handleSelectedCallback=(r,i,a)=>{const o=r.detail,{element:s}=o,c=dg(s,this.getToolName());this.activateOpenContourEndEdit(r,i,c,a)},this.toolSelectedCallback=(r,i)=>{const a=r.detail,{element:o}=a,s=dg(o,this.getToolName());i.data.contour.closed?this.activateClosedContourEdit(r,i,s):this.activateOpenContourEdit(r,i,s),r.preventDefault()},this.isPointNearTool=(r,i,a,o)=>{const s=We(r),{viewport:c}=s,{polyline:l}=i.data.contour;let f=c.worldToCanvas(l[0]);for(let d=1;d<l.length;d++){const h=f,p=c.worldToCanvas(l[d]);if(hC(a,h,p,o))return!0;f=p}if(!i.data.contour.closed)return!1;const u=c.worldToCanvas(l[0]),g=c.worldToCanvas(l[l.length-1]);return hC(a,u,g,o)},this.cancel=r=>{const i=this.isDrawing,a=this.isEditingOpen,o=this.isEditingClosed;i?this.cancelDrawing(r):a?this.cancelOpenContourEdit(r):o&&this.cancelClosedContourEdit(r)},this._calculateCachedStats=(r,i,a,o)=>{const{data:s}=r,{cachedStats:c}=s,{polyline:l,closed:f}=s.contour,u=Object.keys(c);for(let g=0;g<u.length;g++){const d=u[g],h=this.getTargetImageData(d);if(!h)continue;const{imageData:p,metadata:m}=h,v=l.map(w=>i.worldToCanvas(w)),y={isPreScaled:Ice(i,d),isSuvScaled:this.isSuvScaled(i,d,r.metadata.referencedImageId)},T=k0e(m.Modality,r.metadata.referencedImageId,y),C=Toe(h,()=>{const w=s.contour.polyline,x=w.length,O=new Array(x);for(let J=0;J<x;J++)O[J]=i.worldToCanvas(w[J]);const{maxX:M,maxY:A,minX:_,minY:k}=Gh(O),z=i.canvasToWorld([_,k]),X=Qo(p,z),Z=i.canvasToWorld([M,A]),ce=Qo(p,Z);return[X,ce]});f?this.updateClosedCachedStats({targetId:d,viewport:i,canvasCoordinates:v,points:l,imageData:p,metadata:m,cachedStats:c,modalityUnit:T,calibratedScale:C}):this.updateOpenCachedStats({metadata:m,canvasCoordinates:v,targetId:d,cachedStats:c,modalityUnit:T,calibratedScale:C})}return So(r,o.viewport.element,ys.StatsUpdated),r.invalidated=!1,c},this._renderStats=(r,i,a,o)=>{const{data:s}=r,c=this.getTargetId(i),l={toolGroupId:this.toolGroupId,toolName:this.getToolName(),viewportId:a.viewport.id},f=this.getLinkedTextBoxStyle(l,r);if(!f.visibility)return;const u=this.configuration.getTextLines(s,c);if(!u||u.length===0)return;const g=s.contour.polyline.map(C=>i.worldToCanvas(C));if(!s.handles.textBox.hasMoved){const C=bce(g);s.handles.textBox.worldPosition=i.canvasToWorld(C)}const d=i.worldToCanvas(s.handles.textBox.worldPosition),p=cse(o,r.annotationUID??"","1",u,d,g,{},f),{x:m,y:v,width:y,height:T}=p;s.handles.textBox.worldBoundingBox={topLeft:i.canvasToWorld([m,v]),topRight:i.canvasToWorld([m+y,v]),bottomLeft:i.canvasToWorld([m,v+T]),bottomRight:i.canvasToWorld([m+y,v+T])}},kse(this),zse(this),ece(this),dce(this),mce(this),_ce(this),this._throttledCalculateCachedStats=Uoe(this._calculateCachedStats,100,{trailing:!0})}filterInteractableAnnotationsForElement(e,n){if(!n||!n.length)return;const r=We(e),{viewport:i}=r;let a;if(i instanceof Hi){const o=i.getCamera(),{spacingInNormalDirection:s}=xd(i,o);a=this.filterAnnotationsWithinSlice(n,o,s)}else a=Ib(i,n);return a}filterAnnotationsWithinSlice(e,n,r){const{viewPlaneNormal:i}=n,a=e.filter(l=>{const f=l.metadata.viewPlaneNormal,u=Math.abs(Qe(i,f))>U0e;return f&&u});if(!a.length)return[];const o=r/2,{focalPoint:s}=n,c=[];for(const l of a){const u=l.data.contour.polyline[0];if(!l.isVisible)continue;const g=Le();_n(g,s,u);const d=Qe(g,i);Math.abs(d)<o&&c.push(l)}return c}isContourSegmentationTool(){return!1}createAnnotation(e){const n=e.detail.currentPoints.world,r=super.createAnnotation(e),i=o=>{o.data.handles.points.length=0};return Li(r,{data:{contour:{polyline:[[...n]]},label:"",cachedStats:{}},onInterpolationComplete:i})}getAnnotationStyle(e){return super.getAnnotationStyle(e)}renderAnnotationInstance(e){const{enabledElement:n,targetId:r,svgDrawingHelper:i}=e,a=e.annotation;let o=!1;const{viewport:s,renderingEngine:c}=n,l=this.isDrawing,f=this.isEditingOpen,u=this.isEditingClosed;if(!(l||f||u))this.configuration.displayOnePointAsCrosshairs&&a.data.contour.polyline.length===1?this.renderPointContourWithMarker(n,i,a):this.renderContour(n,i,a);else{const g=this.commonData.annotation.annotationUID;if(a.annotationUID===g)if(l)this.renderContourBeingDrawn(n,i,a);else if(u)this.renderClosedContourBeingEdited(n,i,a);else if(f)this.renderOpenContourBeingEdited(n,i,a);else throw new Error(`Unknown ${this.getToolName()} annotation rendering state`);else this.configuration.displayOnePointAsCrosshairs&&a.data.contour.polyline.length===1?this.renderPointContourWithMarker(n,i,a):this.renderContour(n,i,a);o=!0}if(this.configuration.calculateStats)return this._calculateStatsIfActive(a,r,s,c,n),this._renderStats(a,s,n,i),o}_calculateStatsIfActive(e,n,r,i,a){var s,c,l;const o=(s=this.commonData)==null?void 0:s.annotation.annotationUID;if(!(e.annotationUID===o&&!((c=this.commonData)!=null&&c.movingTextBox))&&!((l=this.commonData)!=null&&l.movingTextBox)){const{data:f}=e;!f.cachedStats[n]||f.cachedStats[n].areaUnit==null?(f.cachedStats[n]={Modality:null,area:null,max:null,mean:null,stdDev:null,areaUnit:null},this._calculateCachedStats(e,r,i,a)):e.invalidated&&this._throttledCalculateCachedStats(e,r,i,a)}}updateClosedCachedStats({viewport:e,points:n,imageData:r,metadata:i,cachedStats:a,targetId:o,modalityUnit:s,canvasCoordinates:c,calibratedScale:l}){var Fe,kt,lt;const{scale:f,areaUnit:u,unit:g}=l,{voxelManager:d}=e.getImageData(),h=c[0],p=e.canvasToWorld(h),m=e.canvasToWorld([h[0]+1,h[1]]),v=e.canvasToWorld([h[0],h[1]+1]),y=Gg(p,m),T=Gg(p,v),C=Qo(r,n[0]);C[0]=Math.floor(C[0]),C[1]=Math.floor(C[1]),C[2]=Math.floor(C[2]);let w=C[0],x=C[0],O=C[1],M=C[1],A=C[2],_=C[2];for(let yt=1;yt<n.length;yt++){const dt=Qo(r,n[yt]);dt[0]=Math.floor(dt[0]),dt[1]=Math.floor(dt[1]),dt[2]=Math.floor(dt[2]),w=Math.min(w,dt[0]),x=Math.max(x,dt[0]),O=Math.min(O,dt[1]),M=Math.max(M,dt[1]),A=Math.min(A,dt[2]),_=Math.max(_,dt[2])}const k=Qo(r,n[1]);k[0]=Math.floor(k[0]),k[1]=Math.floor(k[1]),k[2]=Math.floor(k[2]);let z=y8(c)/f/f;z*=y*T;const X=.01*(x-w),Z=.01*(M-O),ce=.01*(_-A);w=Math.floor(w-X),x=Math.ceil(x+X),O=Math.floor(O-Z),M=Math.ceil(M+Z),A=Math.floor(A-ce),_=Math.ceil(_+ce);const J=[[w,x],[O,M],[A,_]],de=r.indexToWorld([x,M,_]),Q=e.worldToCanvas(de);let q=0,j=[],ie=0;const ue=d.forEach(this.configuration.statsCalculator.statsCallback,{imageData:r,isInObject:(yt,dt)=>{let _t=!0;const Ke=e.worldToCanvas(yt);return Ke[1]!=q&&(ie=0,q=Ke[1],j=bb(c,Ke,[Q[0],Ke[1]]),j.sort(function(Ye){return function(Zt,jr){return Zt[Ye]===jr[Ye]?0:Zt[Ye]<jr[Ye]?-1:1}}(0))),j.length&&Ke[0]>j[0][0]&&(j.shift(),ie++),ie%2===0&&(_t=!1),_t},boundsIJK:J,returnPoints:this.configuration.storePointData}),le=this.configuration.statsCalculator.getStatistics();a[o]={Modality:i.Modality,area:z,perimeter:nC(c,closed)/f,mean:(Fe=le.mean)==null?void 0:Fe.value,max:(kt=le.max)==null?void 0:kt.value,stdDev:(lt=le.stdDev)==null?void 0:lt.value,statsArray:le.array,pointsInShape:ue,areaUnit:u,modalityUnit:s,unit:g}}updateOpenCachedStats({targetId:e,metadata:n,canvasCoordinates:r,cachedStats:i,modalityUnit:a,calibratedScale:o}){const{scale:s,unit:c}=o;i[e]={Modality:n.Modality,length:nC(r,!1)/s,modalityUnit:a,unit:c}}};P8.toolName="PlanarFreehandROI";let vv=P8;function B0e(t,e){const n=t.cachedStats[e],{area:r,mean:i,stdDev:a,length:o,perimeter:s,max:c,isEmptyArea:l,unit:f,areaUnit:u,modalityUnit:g}=n||{},d=[];if(r){const h=l?"Area: Oblique not supported":`Area: ${Qs(r)} ${u}`;d.push(h)}return i&&d.push(`Mean: ${Qs(i)} ${g}`),Number.isFinite(c)&&d.push(`Max: ${Qs(c)} ${g}`),a&&d.push(`Std Dev: ${Qs(a)} ${g}`),s&&d.push(`Perimeter: ${Qs(s)} ${f}`),o&&d.push(`${Qs(o)} ${f}`),d}const N8=class N8 extends vv{constructor(e){const n=Li({configuration:{calculateStats:!1,allowOpenContours:!1}},e);super(n)}isContourSegmentationTool(){return!0}renderAnnotationInstance(e){const n=e.annotation,{invalidated:r}=n,i=super.renderAnnotationInstance(e);if(r){const{segmentationId:a}=n.data.segmentation;G2(a)}return i}};N8.toolName="PlanarFreehandContourSegmentationTool";let nd=N8;function G0e(t,e,n){const r=new Map;for(const[i,a]of t)for(const o of a){const{points:s}=o,{lineSegments:c,linesNumberOfPoints:l}=$0e(o);for(let f=0;f<c.length;f++){const u=c[f],g=[];for(let p=0;p<l[f];p++){const m=u[p];g.push([s[3*m],s[3*m+1],s[3*m+2]])}if(g.length<3)continue;const d={annotationUID:In(),data:{contour:{closed:!0,polyline:g},segmentation:{segmentationId:n,segmentIndex:i},handles:{}},handles:{},highlighted:!1,autoGenerated:!1,invalidated:!1,isLocked:!1,isVisible:!0,metadata:{toolName:nd.toolName,...e.getViewReference()}};il(d,e.element);const h=(r==null?void 0:r.get(i))||new Set;h.add(d.annotationUID),r.set(i,h)}}return r}const $0e=t=>{const{numberOfCells:e,lines:n}=t,r=[],i=[];for(let a=0;a<n.length;){const o=n[a];if(i.push(o),r.push(n.slice(a+1,a+o+1)),a+=o+1,r.length===e)break}return{lineSegments:r,linesNumberOfPoints:i}};async function W0e(t,e={}){var c;const n=(c=e.segmentIndices)!=null&&c.length?e.segmentIndices:xs(t);let r;const a=on(t).representationData;try{a.Surface?r=await j0e(t,{segmentIndices:n,...e}):a.Labelmap&&(r=await z0e(t,{segmentIndices:n,...e}))}catch(l){throw console.error(l),l}if(!r)throw new Error("Not enough data to convert to contour, currently only support converting volume labelmap to contour if available");const{viewport:o}=e,s=G0e(r,o,t);return $0.setStyle({segmentationId:t,type:je.Contour},{fillAlpha:0}),{annotationUIDsMap:s}}async function z0e(t,e={}){if(!e.viewport)throw new Error("Viewport is required to compute contour from labelmap");const n=await p8(t,e);if(!(n!=null&&n.length)){console.error("Failed to convert labelmap to surface or labelmap is empty");return}const{viewport:r}=e,i=n.map(s=>({id:s.segmentIndex.toString(),points:s.data.points,polys:s.data.polys,segmentIndex:s.segmentIndex})),a=await yb(i,r);return Tb(a)}async function j0e(t,e={}){var u;if(!e.viewport)throw new Error("Viewport is required to compute contour from surface");const{viewport:n}=e,r=(u=e.segmentIndices)!=null&&u.length?e.segmentIndices:xs(t),i=new Map,a=new Map,s=on(t).representationData.Surface,c=[];s.geometryIds.forEach((g,d)=>{var h;if(r.includes(d)){i.set(d,g);const p=(h=Me.getGeometry(g))==null?void 0:h.data;p&&c.push({id:g,points:p.points,polys:p.polys,segmentIndex:d})}}),i.forEach((g,d)=>{a.set(g,d)});const l=await yb(c,n);return Tb(l)}function H0e(t,e={}){return d8(t,je.Contour,()=>W0e(t,e),()=>{})}function K0e(t,e,n=!1){const r=on(e),{annotationUIDsMap:i}=r.representationData.Contour;i.forEach(a=>{a.forEach(o=>{al(o)})})}let ym=!1;function q0e(t,e,n=!1){const r=Dr(t);if(!r)return;const{viewport:i}=r;n&&(K0e(t,e),i.render())}async function X0e(t,e){var a;const{segmentationId:n}=e,r=on(n);if(!r)return;let i=r.representationData[je.Contour];!i&&g8(n,je.Contour)&&!ym&&(ym=!0,i=await H0e(n,{viewport:t}),ym=!1),i&&(a=i.geometryIds)!=null&&a.length&&loe(t,i.geometryIds,i.annotationUIDsMap,e)}const Y0e={render:X0e,removeRepresentation:q0e};function rd(t,e){return Mo.getCurrentLabelmapImageIdForViewport(t,e)}const mC=new Map,Z0e=({cfun:t,ofun:e,actor:n})=>{n.getProperty().setRGBTransferFunction(1,t),n.getProperty().setScalarOpacity(1,e)};async function Q0e({viewport:t,volumeInputs:e,segmentationId:n}){var O;const r=t.getDefaultActor(),{actor:i}=r,{uid:a,callback:o}=r,s=t.getVolumeId();if((O=mC.get(a))!=null&&O.added)return{uid:a,actor:i};const c=e,l=Me.getVolume(c[0].volumeId);if(!l)throw new Error(`imageVolume with id: ${l.volumeId} does not exist`);const{volumeId:f}=c[0],u=await IR(f);if(!u)throw new Error(`segImageVolume with id: ${u.volumeId} does not exist`);const g=u.voxelManager,{imageData:d}=u,h=Me.getVolume(s),p=h.voxelManager,m=2,v=new Float32Array(m*h.voxelManager.getScalarDataLength()),y=d.getDimensions();for(let M=0;M<y[2];++M)for(let A=0;A<y[1];++A)for(let _=0;_<y[0];++_){const k=_+y[0]*(A+y[1]*M);v[k*m+0]=p.getAtIndex(k),v[k*m+1]=g.getAtIndex(k)}t.removeActors([a]);const T=i.getMapper(),C=iX(T);i.setMapper(C),C.setBlendMode(Tc.LABELMAP_EDGE_PROJECTION_BLEND);const w=C.getInputData().getPointData().getArray(0);w.setData(v),w.setNumberOfComponents(2),i.getProperty().setColorMixPreset(1),i.getProperty().setForceNearestInterpolation(1,!0),i.getProperty().setIndependentComponents(!0),t.addActor({actor:i,uid:a,callback:o,referencedId:s,representationUID:`${n}-${je.Labelmap}`}),mC.set(a,{added:!0,segmentationRepresentationUID:`${n}`,originalBlendMode:t.getBlendMode()}),i.set({preLoad:Z0e});function x(M){const{segmentationId:A,modifiedSlicesToUse:_}=M.detail,{representationData:k}=on(A),{volumeId:z}=k.Labelmap;if(z!==u.volumeId)return;const Z=Me.getVolume(z).voxelManager,ce=C.getInputData().getPointData().getArray(0),J=ce.getData(),de=2,Q=d.getDimensions(),q=_!=null&&_.length?_:Array.from({length:Q[2]},(j,ie)=>ie);for(const j of q)for(let ie=0;ie<Q[1];++ie)for(let ue=0;ue<Q[0];++ue){const le=ue+Q[0]*(ie+Q[1]*j);J[le*de+1]=Z.getAtIndex(le)}ce.setData(J)}return Ee.addEventListener(he.SEGMENTATION_DATA_MODIFIED,x),Ee.addEventListener(he.SEGMENTATION_REPRESENTATION_REMOVED,async M=>{Ee.removeEventListener(he.SEGMENTATION_DATA_MODIFIED,x);const A=t.getActor(a),{element:_,id:k}=t;t.removeActors([a]);const z=await K3({volumeId:a,blendMode:Tc.MAXIMUM_INTENSITY_BLEND,callback:({volumeActor:X})=>{A.callback&&A.callback({volumeActor:X,volumeId:f})}},_,k);t.addActor({actor:z,uid:a}),t.render()}),{uid:a,actor:i}}const{uuidv4:qb}=ws;async function J0e(t,e,n,r){const i=We(t),{renderingEngine:a,viewport:o}=i,{id:s}=o,c=!0,l=!1,f=!0;if(o instanceof za){const g=ele(e,n);Me.getVolume(g)||await tle(e);let d=(r==null?void 0:r.blendMode)??Tc.MAXIMUM_INTENSITY_BLEND,h=d===Tc.LABELMAP_EDGE_PROJECTION_BLEND;if(h){const m=o.getVolumeId(),v=Me.getVolume(m),T=Me.getVolume(g).dimensions,C=v.dimensions;(T[0]!==C[0]||T[1]!==C[1]||T[2]!==C[2])&&(h=!1,d=Tc.MAXIMUM_INTENSITY_BLEND,console.debug("Dimensions mismatch - falling back to regular volume addition"))}const p=[{volumeId:g,visibility:c,representationUID:`${n}-${je.Labelmap}`,useIndependentComponents:h,blendMode:d}];if(!p[0].useIndependentComponents)await kY(a,p,[s],l,f);else return await Q0e({viewport:o,volumeInputs:p,segmentationId:n})}else{const g=[{imageId:rd(o.id,n),representationUID:`${n}-${je.Labelmap}`}];AY(a,g,[s])}G2(n)}function ele(t,e){let{volumeId:n}=t;if(!n){n=qb();const r=on(e);r.representationData.Labelmap={...r.representationData.Labelmap,volumeId:n},t.volumeId=n,ku(e)}return n}async function tle(t){const e=t;if(!(e.imageIds.length>0))throw new Error("cannot create labelmap, no imageIds found for the volume labelmap");return await Ry(t.volumeId||qb(),e.imageIds)}function nle(t,e){const n=We(t),{viewport:r}=n;r.removeActors([bae(r.id,e)])}function rle(t){return R8(t)}const Xb=Ic(),vu=(t,e)=>{De(t,Oe.WEB_WORKER_PROGRESS,{progress:e,type:nl.POLYSEG_CONTOUR_TO_LABELMAP})};async function ile(t,e={}){var p;const n=e.viewport,r=n.getVolumeId();if(!cM(n))throw new Error("No imageIds found, labelmap computation from contour requires viewports with imageIds");const a=In(),o=PR(r,{volumeId:a}),{dimensions:s,origin:c,direction:l,spacing:f,voxelManager:u}=o,{segmentIndices:g,annotationUIDsInSegmentMap:d}=Yb(t,e);vu(Ee,0);const h=await Xb.executeTask("polySeg","convertContourToVolumeLabelmap",{segmentIndices:g,dimensions:s,scalarData:(p=u.getCompleteScalarDataArray)==null?void 0:p.call(u),origin:c,direction:l,spacing:f,annotationUIDsInSegmentMap:d},{callbacks:[m=>{vu(Ee,m)}]});return vu(Ee,100),u.setCompleteScalarDataArray(h),o.modified(),{volumeId:o.volumeId}}async function ale(t,e={}){if(!e.viewport)throw new Error("No viewport provided, labelmap computation from contour requires viewports");const r=e.viewport.getImageIds();if(!r)throw new Error("No imageIds found, labelmap computation from contour requires viewports with imageIds");r.forEach(u=>{if(!Me.getImageLoadObject(u))throw new Error("ImageIds must be cached before converting contour to labelmap")});const a=(await xR(r)).map(u=>u.imageId),{segmentIndices:o,annotationUIDsInSegmentMap:s}=Yb(t,e),c=new Map;a.forEach((u,g)=>{const d=Me.getImage(u),h=Ve(li.IMAGE_PLANE,u);let{columnCosines:p,rowCosines:m,rowPixelSpacing:v,columnPixelSpacing:y,imagePositionPatient:T}=h;p=p??[0,1,0],m=m??[1,0,0],v=v??1,y=y??1,T=T??[0,0,0];const C=Cn(m[0],m[1],m[2]),w=Cn(p[0],p[1],p[2]),x=Le();an(x,C,w);const O=[...C,...w,...x],M=[v,y,1],A=T;c.set(r[g],{direction:O,spacing:M,origin:A,scalarData:d.voxelManager.getScalarData(),imageId:u,dimensions:[d.width,d.height,1]})}),vu(Ee,0);const l=await Xb.executeTask("polySeg","convertContourToStackLabelmap",{segmentationsInfo:c,annotationUIDsInSegmentMap:s,segmentIndices:o},{callbacks:[u=>{vu(Ee,u)}]});vu(Ee,100);const f=[];return l.forEach(({scalarData:u},g)=>{var m,v;const d=c.get(g),{imageId:h}=d,p=Me.getImage(h);p.voxelManager.getScalarData().set(u),(v=(m=p.imageFrame)==null?void 0:m.pixelData)==null||v.set(u),f.push(h)}),{imageIds:f}}function Yb(t,e={}){var a;const n=t.annotationUIDsMap,r=(a=e.segmentIndices)!=null&&a.length?e.segmentIndices:Array.from(n.keys()),i=new Map;return r.forEach(o=>{const s=n.get(o);let c=Array.from(s);c=c.filter(f=>!sr(f).parentAnnotationUID);const l=c.map(f=>{var d;const u=sr(f),g=(d=u.childAnnotationUIDs)==null?void 0:d.length;return{polyline:u.data.contour.polyline,referencedImageId:u.metadata.referencedImageId,holesPolyline:g&&u.childAnnotationUIDs.map(h=>sr(h).data.contour.polyline)}});i.set(o,l)}),{segmentIndices:r,annotationUIDsInSegmentMap:i}}const ole=Ic(),Tm=(t,e)=>{De(t,Oe.WEB_WORKER_PROGRESS,{progress:e,type:nl.POLYSEG_SURFACE_TO_LABELMAP})};async function sle(t,e){const{geometryIds:n}=t;if(!(n!=null&&n.size))throw new Error("No geometry IDs found for surface representation");const r=new Map;n.forEach((f,u)=>{const d=Me.getGeometry(f).data,h=d.points,p=d.polys;r.set(u,{points:h,polys:p})});const{dimensions:i,direction:a,origin:o,spacing:s,voxelManager:c}=e;Tm(Ee,0);const l=await ole.executeTask("polySeg","convertSurfacesToVolumeLabelmap",{segmentsInfo:r,dimensions:i,spacing:s,direction:a,origin:o},{callbacks:[f=>{Tm(Ee,f)}]});return Tm(Ee,100),c.setCompleteScalarDataArray(l),e.modified(),{volumeId:e.volumeId}}async function cle({volumeId:t}){return{imageIds:Me.getVolume(t).imageIds}}async function lle(t,e={}){var o;const n=(o=e.segmentIndices)!=null&&o.length?e.segmentIndices:xs(t);let r;const i=on(t),a=i.representationData;try{a.Contour?r=await ule(t,{segmentIndices:n,...e}):a.Surface&&(r=await fle(i.segmentationId,{segmentIndices:n,...e}))}catch(s){throw console.error(s),s}if(!r)throw new Error("Not enough data to convert to surface, currently only support converting volume labelmap to surface if available");return r}async function ule(t,e={}){var c;const n=e.viewport?e.viewport instanceof Hi:!0;if(n&&!e.viewport)throw new Error("Cannot compute labelmap from contour segmentation without providing the viewport");const r=(c=e.segmentIndices)!=null&&c.length?e.segmentIndices:xs(t),a=on(t).representationData.Contour;return await(n?ile:ale)(a,{segmentIndices:r,viewport:e.viewport})}async function fle(t,e={}){var u;const{viewport:n}=e,r=n?n instanceof Hi:!0,i=(u=e.segmentIndices)!=null&&u.length?e.segmentIndices:xs(t),a=on(t),o=new Map;if(a.representationData.Surface.geometryIds.forEach((g,d)=>{i.includes(d)&&o.set(d,g)}),r&&!n)throw new Error("Cannot compute labelmap from surface segmentation without providing the viewport");let c;if(r){const g=n.getVolumeId();c=PR(g)}else{const g=e.viewport.getImageIds(),h=xR(g).map(p=>p.imageId);c=await Ry("generatedSegmentationVolumeId",h)}const l=await sle({geometryIds:o},c);return r?l:await cle({volumeId:c.volumeId})}async function gle(t,e={}){return d8(t,je.Labelmap,()=>lle(t,e),()=>null,()=>{Mo.processLabelmapRepresentationAddition(e.viewport.id,t),setTimeout(()=>{G2(t)},0)})}const Cm=255,hg=new Map;let wm=!1;function dle(t,e,n=!1){const r=Dr(t);if(hg.forEach((a,o)=>{o.includes(e)&&hg.delete(o)}),!r)return;const{viewport:i}=r;nle(i.element,e),n&&i.render()}async function ple(t,e){const{segmentationId:n,config:r}=e,i=on(n);if(!i){console.warn("No segmentation found for segmentationId: ",n);return}let a=i.representationData[je.Labelmap],o=pu(t.id,n);if(!a&&g8(n,je.Labelmap)&&!wm){if(wm=!0,a=await gle(n,{viewport:t}),!a)throw new Error(`No labelmap data found for segmentationId ${n}.`);wm=!1}if(a){if(t instanceof Hi)o||await yC(t,a,n,r),o=pu(t.id,n);else{if(!rd(t.id,n))return;o||await yC(t,a,n,r),o=pu(t.id,n)}o&&hle(t.id,o,e)}}function hle(t,e,n){var w;const{segmentationId:r}=n,{cfun:i,ofun:a}=n.config,{colorLUTIndex:o}=n,s=rle(t),c=(s==null?void 0:s.segmentationId)===r,l=$0.getStyle({viewportId:t,type:je.Labelmap,segmentationId:r}),f=$0.getRenderInactiveSegmentations(t),u=f8(o),g=Math.min(256,u.length),{outlineWidth:d,renderOutline:h,outlineOpacity:p,activeSegmentOutlineWidthDelta:m}=vC(l,c),v=Kb(t,{segmentationId:r,type:je.Labelmap});for(let x=0;x<g;x++){const O=x,M=u[O],_=$0.getStyle({viewportId:t,type:je.Labelmap,segmentationId:r,segmentIndex:O}),{fillAlpha:k,outlineWidth:z,renderFill:X,renderOutline:Z}=vC(l,c,_),{forceOpacityUpdate:ce,forceColorUpdate:J}=mle(t,r,O,{fillAlpha:k,renderFill:X,renderOutline:Z,segmentColor:M,outlineWidth:z,segmentsHidden:v,cfun:i,ofun:a});if(J&&i.addRGBPoint(O,M[0]/Cm,M[1]/Cm,M[2]/Cm),ce)if(X){const de=v.has(O)?0:M[3]/255*k;a.removePoint(O),a.addPointLong(O,de,.5,1)}else a.addPointLong(O,.01,.5,1)}a.setClamping(!1);const y=e.actor,{preLoad:T}=((w=y.get)==null?void 0:w.call(y,"preLoad"))||{preLoad:null};if(T?T({cfun:i,ofun:a,actor:y}):(y.getProperty().setRGBTransferFunction(0,i),y.getProperty().setScalarOpacity(0,a),y.getProperty().setInterpolationTypeToNearest()),h){y.getProperty().setUseLabelOutline(h),y.getProperty().setLabelOutlineOpacity(p);const x=M8(n.segmentationId),O=new Array(g-1);for(let M=1;M<g;M++){if(v.has(M)){O[M-1]=0;continue}O[M-1]=M===x?d+m:d}y.getProperty().setLabelOutlineThickness(O)}else y.getProperty().setLabelOutlineThickness(new Array(g-1).fill(0));const C=c||f;y.setVisibility(C)}function vC(t,e,n){const i={...t,...n||{}},a=e?i.fillAlpha:i.fillAlphaInactive,o=e?i.outlineWidth:i.outlineWidthInactive,s=e?i.renderFill:i.renderFillInactive,c=e?i.renderOutline:i.renderOutlineInactive,l=e?i.outlineOpacity:i.outlineOpacityInactive,f=i.activeSegmentOutlineWidthDelta;return{fillAlpha:a,outlineWidth:o,renderFill:s,renderOutline:c,outlineOpacity:l,activeSegmentOutlineWidthDelta:f}}function mle(t,e,n,{fillAlpha:r,renderFill:i,renderOutline:a,segmentColor:o,outlineWidth:s,segmentsHidden:c,cfun:l,ofun:f}){const u=`${t}-${e}-${n}`,g=hg.get(u);if(!g)return hg.set(u,{fillAlpha:r,renderFill:i,renderOutline:a,outlineWidth:s,segmentColor:o.slice(),segmentsHidden:new Set(c),cfunMTime:l.getMTime(),ofunMTime:f.getMTime()}),{forceOpacityUpdate:!0,forceColorUpdate:!0};const{fillAlpha:d,renderFill:h,renderOutline:p,outlineWidth:m,segmentColor:v,segmentsHidden:y,cfunMTime:T,ofunMTime:C}=g,w=v[0]!==o[0]||v[1]!==o[1]||v[2]!==o[2],x=v[3]!==o[3]||d!==r||h!==i||p!==a||m!==s||y!==c;return(x||w)&&hg.set(u,{fillAlpha:r,renderFill:i,renderOutline:a,outlineWidth:s,segmentColor:o.slice(),segmentsHidden:new Set(c),cfunMTime:l.getMTime(),ofunMTime:f.getMTime()}),{forceOpacityUpdate:x,forceColorUpdate:w}}async function yC(t,e,n,r){return await J0e(t.element,e,n,r)||void 0}const vle={render:ple,removeRepresentation:dle},yle={[je.Labelmap]:vle,[je.Contour]:Y0e,[je.Surface]:ioe},k1=nd.toolName;class Tle{constructor(){this._needsRender=new Set,this._animationFrameSet=!1,this._animationFrameHandle=null,this._getAllViewports=()=>Do().flatMap(n=>n.getViewports()),this._renderFlaggedSegmentations=()=>{this._throwIfDestroyed(),Array.from(this._needsRender).forEach(n=>{this._triggerRender(n)}),this._needsRender.clear(),this._animationFrameSet=!1,this._animationFrameHandle=null}}renderSegmentationsForViewport(e){const n=e?[e]:this._getViewportIdsForSegmentation();this._setViewportsToBeRenderedNextFrame(n)}renderSegmentation(e){const n=this._getViewportIdsForSegmentation(e);this._setViewportsToBeRenderedNextFrame(n)}_getViewportIdsForSegmentation(e){const n=this._getAllViewports(),r=[];for(const i of n){const a=i.id;if(e){const o=W0(a,{segmentationId:e});(o==null?void 0:o.length)>0&&r.push(a)}else{const o=W0(a);(o==null?void 0:o.length)>0&&r.push(a)}}return r}_throwIfDestroyed(){if(this.hasBeenDestroyed)throw new Error("this.destroy() has been manually called to free up memory, can not longer use this instance. Instead make a new one.")}_setViewportsToBeRenderedNextFrame(e){e.forEach(n=>{this._needsRender.add(n)}),this._render()}_render(){this._needsRender.size>0&&this._animationFrameSet===!1&&(this._animationFrameHandle=window.requestAnimationFrame(this._renderFlaggedSegmentations),this._animationFrameSet=!0)}_triggerRender(e){const n=W0(e);if(!(n!=null&&n.length))return;const{viewport:r}=Dr(e)||{};if(!r)return;const i=[],a=n.map(o=>{o.type===je.Contour&&this._addPlanarFreeHandToolIfAbsent(r);const s=yle[o.type];try{const c=s.render(r,o);i.push(c)}catch(c){console.error(c)}return Promise.resolve({segmentationId:o.segmentationId,type:o.type})});Promise.allSettled(a).then(o=>{const s=o.filter(f=>f.status==="fulfilled").map(f=>f.value);function c(f){const{element:u,viewportId:g}=f.detail;u.removeEventListener(Oe.IMAGE_RENDERED,c),s.forEach(d=>{const h={viewportId:g,segmentationId:d.segmentationId,type:d.type};De(Ee,he.SEGMENTATION_RENDERED,{...h})})}r.element.addEventListener(Oe.IMAGE_RENDERED,c),r.render()})}_addPlanarFreeHandToolIfAbsent(e){k1 in $e.tools||sv(nd);const n=Vr(e.id);n.hasTool(k1)||(n.addTool(k1),n.setToolPassive(k1))}}function Zb(t){Jb.renderSegmentationsForViewport(t)}function Qb(t){Jb.renderSegmentation(t)}const Jb=new Tle;function Cle(t,e){return Mo.updateLabelmapSegmentationImageReferences(t,e)}const wle=function(t){const{segmentationId:e,modifiedSlicesToUse:n}=t.detail,{representationData:r}=on(e),i=h8(e),a=i.some(c=>{const{viewport:l}=Dr(c);return l instanceof Hi}),o=i.some(c=>{const{viewport:l}=Dr(c);return l instanceof ha}),s=a&&o;i.forEach(c=>{const{viewport:l}=Dr(c);l instanceof Hi&&xle({modifiedSlicesToUse:s?[]:n,representationData:r,type:je.Labelmap}),l instanceof ha&&Sle({viewportIds:i,segmentationId:e})})};function xle({modifiedSlicesToUse:t,representationData:e,type:n}){const r=Me.getVolume(e[n].volumeId);if(!r){console.warn("segmentation not found in cache");return}const{imageData:i,vtkOpenGLTexture:a}=r;let o;if((t==null?void 0:t.length)>0)o=t;else{const s=i.getDimensions()[2];o=[...Array(s).keys()]}o.forEach(s=>{a.setUpdatedFrame(s)}),i.modified()}function Sle({viewportIds:t,segmentationId:e}){t.forEach(n=>{let r=W0(n,{segmentationId:e});r=r.filter(i=>i.type===je.Labelmap),r.forEach(i=>{if(i.segmentationId!==e)return;const a=Dr(n);if(!a)return;const{viewport:o}=a;if(o instanceof Hi)return;const s=pu(n,e);if(!s)return;const c=s.actor.getMapper().getInputData(),l=rd(n,e),f=Me.getImage(l);c.modified(),D2(c,f)})})}const eL=function(t){const{segmentationId:e}=t.detail,{representationData:n}=on(e);n.Labelmap&&wle(t),Qb(e)},tL=function(t){const{segmentationId:e}=t.detail;Qb(e)},Ele=function(t){if(!t)return;const e=We(t);if(!e)return;const{viewport:n}=e;n instanceof za||(t.addEventListener(Oe.STACK_NEW_IMAGE,id),t.addEventListener(Oe.IMAGE_RENDERED,id))},Ole=function(t){t.removeEventListener(Oe.STACK_NEW_IMAGE,id),t.removeEventListener(Oe.IMAGE_RENDERED,id)};function id(t){const e=t.detail,{viewportId:n,renderingEngineId:r}=e,{viewport:i}=Sd(n,r),a=W0(n);if(!(a!=null&&a.length))return;const o=a.filter(l=>l.type===je.Labelmap),s=i.getActors();o.forEach(l=>{const{segmentationId:f}=l;Cle(n,f)});const c=o.map(l=>pu(n,l.segmentationId)).filter(l=>l!==void 0);c.length&&(c.forEach(l=>{o.find(u=>rd(n,u.segmentationId)===l.referencedId)||i.removeActors([l.uid])}),o.forEach(l=>{const{segmentationId:f}=l,u=i.getCurrentImageId(),g=rd(n,f);if(!g)return;const d=Me.getImage(g);if(!d){console.warn("No derived image found in the cache for segmentation representation",l);return}const h=s.find(p=>p.referencedId===g);if(h){const p=h.actor.getMapper().getInputData();p.setDerivedImage?p.setDerivedImage(d):D2(p,d)}else{const{dimensions:p,spacing:m,direction:v}=i.getImageDataMetadata(d),y=Me.getImage(u)||{imageId:u},{origin:T}=i.getImageDataMetadata(y),C=T,w=d.voxelManager.getConstructor(),x=d.voxelManager.getScalarData(),O=nt.newInstance({name:"Pixels",numberOfComponents:1,values:new w(x)}),M=v2.newInstance();M.setDimensions(p[0],p[1],1),M.setSpacing(m),M.setDirection(v),M.setOrigin(C),M.getPointData().setScalars(O),M.modified(),i.addImages([{imageId:g,representationUID:`${f}-${je.Labelmap}`,callback:({imageActor:A})=>{A.getMapper().setInputData(M)}}]),Zb(n);return}i.render(),t.type===Oe.IMAGE_RENDERED&&i.element.removeEventListener(Oe.IMAGE_RENDERED,id)}))}const nL={enable:Ele,disable:Ole};function Dle(t){const e=t.detail.annotation;m8(e)}function rL(t){const e=t.detail.annotation;$2(e)&&p0e(t)}function Wh(t){if(!t.detail.removed.length)return;Do().forEach(r=>{const a=r.getViewports().map(o=>o.id);mi(a)})}function iL(t){const{viewportId:e}=t.detail;mi([e])}function Rle(t){const e=t.detail.annotation;$2(e)&&Dle(t)}const aL=function(t){_d(t.detail.element)},Mle=function(t){t.addEventListener(Oe.IMAGE_RENDERED,aL)},_le=function(t){t.removeEventListener(Oe.IMAGE_RENDERED,aL)},oL={enable:Mle,disable:_le},{Active:ble}=Yt;function of(t,e,n){if($e.isInteractingWithTool)return!1;const{renderingEngineId:r,viewportId:i}=n.detail,a=Vr(i,r);if(!a)return!1;let o;const s=Object.keys(a.toolOptions);for(let c=0;c<s.length;c++){const l=s[c],f=a.toolOptions[l],u=a.getToolInstance(l);if(f.mode===ble&&typeof u[e]=="function"){o=a.getToolInstance(l);break}}o&&o[e](n)}const sL=of.bind(null,"Mouse","mouseClickCallback"),cL=of.bind(null,"Mouse","doubleClickCallback");function lL(t,e,n,r="mouse"){const i=r==="touch"?36:6,a=[];return e.forEach(({tool:o,annotations:s})=>{for(const c of s){if(c.isLocked||!c.isVisible)continue;const l=o.getHandleNearImagePoint(t,c,n,i);if(l){a.push({tool:o,annotation:c,handle:l});break}}}),a}function Y2(t,e){const n=[];for(let r=0;r<e.length;r++){const i=e[r];if(!i){console.warn("undefined tool in filterToolsWithAnnotationsForElement");continue}let a=Qg(i.constructor.toolName,t);a!=null&&a.length&&(typeof i.filterInteractableAnnotationsForElement=="function"&&(a=i.filterInteractableAnnotationsForElement(t,a)),(a==null?void 0:a.length)>0&&n.push({tool:i,annotations:a}))}return n}function _8(t,e,n,r="mouse"){const i=r==="touch"?36:6,a=[];return e.forEach(({tool:o,annotations:s})=>{for(const c of s){if(c.isLocked||!c.isVisible)continue;if(o.isPointNearTool(t,c,n,i,r)){a.push({tool:o,annotation:c});break}}}),a}const{Active:Lle}=Yt;function Z2(t){const{renderingEngineId:e,viewportId:n,event:r}=t.detail,i=H2(r)||af.getModifierKey(),a=Vr(n,e);if(!a)return null;const o=Object.keys(a.toolOptions),s=a.getDefaultMousePrimary(),c=t.detail.buttons??(r==null?void 0:r.buttons)??s;for(let l=0;l<o.length;l++){const f=o[l],u=a.toolOptions[f],g=u.bindings.length&&u.bindings.some(d=>d.mouseButton===c&&d.modifierKey===i);if(u.mode===Lle&&g)return a.getToolInstance(f)}}function Wu(t,e,n){const{renderingEngineId:r,viewportId:i}=t.detail,a=Vr(i,r);if(!a)return[];const o=[],s=Object.keys(a.toolOptions);for(let c=0;c<s.length;c++){const l=s[c],f=a.toolOptions[l],u=n!=null&&f.bindings.length&&f.bindings.some(g=>g.mouseButton===n);if(e.includes(f.mode)&&(!n||u)){const g=a.getToolInstance(l);o.push(g)}}return o}function Ile(t,e){var u;const n=new Map,{renderingEngineId:r,viewportId:i}=t.detail,a=Vr(i,r);if(!a)return n;const o=Object.keys(a.toolOptions),s=a.getDefaultMousePrimary(),c=t.detail.event,l=(c==null?void 0:c.buttons)??s,f=H2(c)||af.getModifierKey();for(let g=0;g<o.length;g++){const d=o[g],h=a.getToolInstance(d),p=((u=h.configuration)==null?void 0:u.actions)??{},m=Object.values(p);if(!(m!=null&&m.length)||!e.includes(h.mode))continue;const v=m.find(y=>{var T;return((T=y.bindings)==null?void 0:T.length)&&y.bindings.some(C=>C.mouseButton===l&&C.modifierKey===f)});v&&n.set(h,v)}return n}const{Active:Vle,Passive:Ple}=Yt;function Nle(t){if($e.isInteractingWithTool)return!1;const e=t.detail,{element:n}=e,r=We(n),{canvas:i}=e.currentPoints;if(!r)return!1;const a=Ile(t,[Vle,Ple]),o=Array.from(a.keys()),s=Y2(n,o),c=_8(n,s,i);if(c.length>0){const{tool:l,annotation:f}=c[0],u=a.get(l);return(typeof u.method=="string"?l[u.method]:u.method).call(l,t,f),!0}return!1}const{Active:kle,Passive:Ale}=Yt;function uL(t){if($e.isInteractingWithTool)return;const e=Z2(t);if(e&&typeof e.preMouseDownCallback=="function"&&e.preMouseDownCallback(t))return;const n=t.detail.event.buttons===1,r=Wu(t,[kle],t.detail.event.buttons),i=n?Wu(t,[Ale]):void 0,a=[...r||[],...i||[]];if(Nle(t))return;const s=t.detail,{element:c}=s,l=Y2(c,a),f=s.currentPoints.canvas,u=lL(c,l,f,"mouse"),g=!!t.detail.event.shiftKey;if(u.length>0){const{tool:h,annotation:p,handle:m}=TC(u);CC(p.annotationUID,g),h.handleSelectedCallback(t,p,m,"Mouse");return}const d=_8(c,l,f,"mouse");if(d.length>0){const{tool:h,annotation:p}=TC(d);CC(p.annotationUID,g),h.toolSelectedCallback(t,p,"Mouse",f);return}e&&typeof e.postMouseDownCallback=="function"&&e.postMouseDownCallback(t)}function TC(t){if(t.length>1){const e=t.find(n=>{const r=!Gu(n.annotation.annotationUID),i=$h(n.annotation.annotationUID);return r&&i});if(e)return e}return t[0]}function CC(t,e=!1){e?q2(t)?ho(t,!1):ho(t,!0,!0):ho(t,!0,!1)}function fL(t){if($e.isInteractingWithTool)return;const e=Z2(t);if(e&&e.addNewAnnotation){const n=e.addNewAnnotation(t,"mouse");ho(n.annotationUID)}}function gL(t){if($e.isInteractingWithTool)return;const e=Z2(t);!e||typeof e.mouseDragCallback!="function"||e.mouseDragCallback(t)}const{Active:Fle,Passive:Ule}=Yt;function dL(t){if($e.isInteractingWithTool||$e.isMultiPartToolActive)return;const e=Wu(t,[Fle,Ule]),n=t.detail,{element:r}=n,i=Y2(r,e),a=e.filter(s=>!i.some(l=>l.tool.getToolName()===s.getToolName()));let o=!1;for(const{tool:s,annotations:c}of i)typeof s.mouseMoveCallback=="function"&&(o=s.mouseMoveCallback(t,c)||o);a.forEach(s=>{typeof s.mouseMoveCallback=="function"&&s.mouseMoveCallback(t)}),o===!0&&_d(r)}const pL=of.bind(null,"Mouse","mouseUpCallback");function hL(t){if($e.isInteractingWithTool)return;t.detail.buttons=cs.Wheel|(t.detail.event.buttons||0);const e=Z2(t);if(e)return e.mouseWheelCallback(t)}const Ble=function(t){t.addEventListener(he.MOUSE_CLICK,sL),t.addEventListener(he.MOUSE_DOWN,uL),t.addEventListener(he.MOUSE_DOWN_ACTIVATE,fL),t.addEventListener(he.MOUSE_DOUBLE_CLICK,cL),t.addEventListener(he.MOUSE_DRAG,gL),t.addEventListener(he.MOUSE_MOVE,dL),t.addEventListener(he.MOUSE_UP,pL),t.addEventListener(he.MOUSE_WHEEL,hL)},Gle=function(t){t.removeEventListener(he.MOUSE_CLICK,sL),t.removeEventListener(he.MOUSE_DOWN,uL),t.removeEventListener(he.MOUSE_DOWN_ACTIVATE,fL),t.removeEventListener(he.MOUSE_DOUBLE_CLICK,cL),t.removeEventListener(he.MOUSE_DRAG,gL),t.removeEventListener(he.MOUSE_MOVE,dL),t.removeEventListener(he.MOUSE_UP,pL),t.removeEventListener(he.MOUSE_WHEEL,hL)},mL={enable:Ble,disable:Gle},{Active:$le}=Yt;function vL(t){const{renderingEngineId:e,viewportId:n}=t.detail,r=Jie(),i=af.getModifierKey(),a=Vr(n,e);if(!a)return null;const o=Object.keys(a.toolOptions),s=a.getDefaultMousePrimary();for(let c=0;c<o.length;c++){const l=o[c],f=a.toolOptions[l];if(f.mode!==$le)continue;if(f.bindings.length&&f.bindings.some(g=>g.mouseButton===(r??s)&&g.modifierKey===i))return a.getToolInstance(l)}}function Wle(t,e){var c;const n=new Map,{renderingEngineId:r,viewportId:i}=t.detail,a=Vr(i,r);if(!a)return n;const o=Object.keys(a.toolOptions),s=t.detail.key;for(let l=0;l<o.length;l++){const f=o[l],u=a.getToolInstance(f),g=(c=u.configuration)==null?void 0:c.actions;if(!g)continue;const d=Object.values(g);if(!(d!=null&&d.length)||!e.includes(u.mode))continue;const h=d.find(p=>{var m;return(m=p.bindings)==null?void 0:m.some(v=>v.key===s)});h&&n.set(u,h)}return n}function yL(t){const e=vL(t);if(e){const{renderingEngineId:r,viewportId:i}=t.detail,a=Vr(i,r),o=e.getToolName();Object.keys(a.toolOptions).includes(o)&&a.setViewportsCursorByToolName(o)}const n=Wle(t,[Yt.Active]);if(n!=null&&n.size){const{element:r}=t.detail;for(const[i,a]of[...n.entries()])(typeof a.method=="function"?a.method:i[a.method]).call(i,r,a,t)}}function TL(t){const e=vL(t);if(!e)return;const{renderingEngineId:n,viewportId:r}=t.detail,i=Vr(r,n);ob();const a=e.getToolName();Object.keys(i.toolOptions).includes(a)&&i.setViewportsCursorByToolName(a)}const zle=function(t){t.addEventListener(he.KEY_DOWN,yL),t.addEventListener(he.KEY_UP,TL)},jle=function(t){t.removeEventListener(he.KEY_DOWN,yL),t.removeEventListener(he.KEY_UP,TL)},CL={enable:zle,disable:jle},{Active:Hle,Passive:Kle,Enabled:qle}=Yt,wL=function(t){Wu(t,[Hle,Kle,qle]).forEach(n=>{n.onCameraModified&&n.onCameraModified(t)})},Xle=function(t){t.addEventListener(Oe.CAMERA_MODIFIED,wL)},Yle=function(t){t.removeEventListener(Oe.CAMERA_MODIFIED,wL)},xL={enable:Xle,disable:Yle},{Active:Zle,Passive:Qle,Enabled:Jle}=Yt,SL=function(t){Wu(t,[Zle,Qle,Jle]).forEach(n=>{n.onImageSpacingCalibrated&&n.onImageSpacingCalibrated(t)})},eue=function(t){t.addEventListener(Oe.IMAGE_SPACING_CALIBRATED,SL)},tue=function(t){t.removeEventListener(Oe.IMAGE_SPACING_CALIBRATED,SL)},EL={enable:eue,disable:tue},{Active:nue}=Yt;function b8(t){const{renderingEngineId:e,viewportId:n}=t.detail,r=t.detail.event,i=Vr(n,e);if(!i)return null;const a=Object.keys(i.toolOptions),o=Object.keys(r.touches).length,s=H2(r)||af.getModifierKey(),c=i.getDefaultMousePrimary();for(let l=0;l<a.length;l++){const f=a[l],u=i.toolOptions[f],g=u.bindings.length&&u.bindings.some(d=>(d.numTouchPoints===o||o===1&&d.mouseButton===c)&&d.modifierKey===s);if(u.mode===nue&&g)return i.getToolInstance(f)}}function wC(t,e,n){const{renderingEngineId:r,viewportId:i}=t.detail,a=Vr(i,r);if(!a)return[];const o=[],s=Object.keys(a.toolOptions);for(let c=0;c<s.length;c++){const l=s[c],f=a.toolOptions[l],u=n!=null&&f.bindings.length&&f.bindings.some(g=>g.numTouchPoints===n);if(e.includes(f.mode)&&(!n||u)){const g=a.getToolInstance(l);o.push(g)}}return o}const{Active:rue,Passive:iue}=Yt;function OL(t){if($e.isInteractingWithTool)return;const e=b8(t);if(e&&typeof e.preTouchStartCallback=="function"&&e.preTouchStartCallback(t))return;const n=Object.keys(t.detail.event.touches).length===1,r=wC(t,[rue],Object.keys(t.detail.event.touches).length),i=n?wC(t,[iue]):void 0,a=[...r||[],...i||[],e],o=t.detail,{element:s}=o,c=Y2(s,a),l=o.currentPoints.canvas,f=lL(s,c,l,"touch"),u=!1;if(f.length>0){const{tool:d,annotation:h,handle:p}=xC(f);SC(h.annotationUID,u),d.handleSelectedCallback(t,h,p,"Touch");return}const g=_8(s,c,l,"touch");if(g.length>0){const{tool:d,annotation:h}=xC(g);SC(h.annotationUID,u),d.toolSelectedCallback(t,h,"Touch");return}e&&typeof e.postTouchStartCallback=="function"&&e.postTouchStartCallback(t)}function xC(t){return t.length>1&&t.find(e=>!Gu(e.annotation.annotationUID)&&$h(e.annotation.annotationUID))||t[0]}function SC(t,e=!1){e?q2(t)?ho(t,!1):ho(t,!0,!0):ho(t,!0,!1)}function DL(t){if($e.isInteractingWithTool)return;const e=b8(t);if(e&&e.addNewAnnotation){const n=e.addNewAnnotation(t,"touch");ho(n.annotationUID)}}function RL(t){if($e.isInteractingWithTool)return;const e=b8(t);!e||typeof e.touchDragCallback!="function"||e.touchDragCallback(t)}const ML=of.bind(null,"Touch","touchEndCallback"),aue=of.bind(null,"Touch","touchTapCallback"),_L=of.bind(null,"Touch","touchPressCallback"),oue=function(t){t.addEventListener(he.TOUCH_START,OL),t.addEventListener(he.TOUCH_START_ACTIVATE,DL),t.addEventListener(he.TOUCH_DRAG,RL),t.addEventListener(he.TOUCH_END,ML),t.addEventListener(he.TOUCH_TAP,aue),t.addEventListener(he.TOUCH_PRESS,_L)},sue=function(t){t.removeEventListener(he.TOUCH_START,OL),t.removeEventListener(he.TOUCH_START_ACTIVATE,DL),t.removeEventListener(he.TOUCH_DRAG,RL),t.removeEventListener(he.TOUCH_END,ML),t.removeEventListener(he.TOUCH_PRESS,_L)},bL={enable:oue,disable:sue},cue=function(){Ee.addEventListener(he.ANNOTATION_COMPLETED,us.handleAnnotationCompleted),Ee.addEventListener(he.ANNOTATION_MODIFIED,us.handleAnnotationUpdate),Ee.addEventListener(he.ANNOTATION_REMOVED,us.handleAnnotationDelete)},lue=function(){Ee.removeEventListener(he.ANNOTATION_COMPLETED,us.handleAnnotationCompleted),Ee.removeEventListener(he.ANNOTATION_MODIFIED,us.handleAnnotationUpdate),Ee.removeEventListener(he.ANNOTATION_REMOVED,us.handleAnnotationDelete)},LL={enable:cue,disable:lue},{Active:uue,Passive:fue,Enabled:gue}=Yt,IL=function(t){Wu(t,[uue,fue,gue]).forEach(n=>{n.onResetCamera&&n.onResetCamera(t)})},due=function(t){t.addEventListener(Oe.CAMERA_RESET,IL)},pue=function(t){t.removeEventListener(Oe.CAMERA_RESET,IL)},VL={enable:due,disable:pue};function PL(t){const{element:e,viewportId:n}=t.detail,r=hue(n);mue(e),vue(r,e),x8.addViewportElement(n,e),F_.enable(e),ib.enable(e),tb.enable(e),af.enable(e),nL.enable(e),oL.enable(e),xL.enable(e),EL.enable(e),VL.enable(e),mL.enable(e),CL.enable(e),bL.enable(e),$e.enabledElements.push(e)}function hue(t){const e="http://www.w3.org/2000/svg",n=document.createElementNS(e,"svg"),r=`svg-layer-${t}`;n.classList.add("svg-layer"),n.setAttribute("id",r),n.setAttribute("xmlns","http://www.w3.org/2000/svg"),n.style.width="100%",n.style.height="100%",n.style.pointerEvents="none",n.style.position="absolute";const i=document.createElementNS(e,"defs"),a=document.createElementNS(e,"filter"),o=document.createElementNS(e,"feOffset"),s=document.createElementNS(e,"feColorMatrix"),c=document.createElementNS(e,"feBlend");return a.setAttribute("id",`shadow-${r}`),a.setAttribute("filterUnits","userSpaceOnUse"),o.setAttribute("result","offOut"),o.setAttribute("in","SourceGraphic"),o.setAttribute("dx","0.5"),o.setAttribute("dy","0.5"),s.setAttribute("result","matrixOut"),s.setAttribute("in","offOut"),s.setAttribute("in2","matrix"),s.setAttribute("values","0.2 0 0 0 0 0 0.2 0 0 0 0 0 0.2 0 0 0 0 0 1 0"),c.setAttribute("in","SourceGraphic"),c.setAttribute("in2","matrixOut"),c.setAttribute("mode","normal"),a.appendChild(o),a.appendChild(s),a.appendChild(c),i.appendChild(a),n.appendChild(i),n}function mue(t){const{viewportUid:e,renderingEngineUid:n}=t.dataset,r=`${e}:${n}`;$e.svgNodeCache[r]={}}function vue(t,e){e.querySelector("div.viewport-element").appendChild(t)}function yue(t,e){const n=[];if(!e&&!t)throw new Error("At least one of renderingEngineId or viewportId should be given");for(let r=0;r<$e.synchronizers.length;r++){const i=$e.synchronizers[r],a=!i.isDisabled(),o=i.hasSourceViewport(e,t),s=i.hasTargetViewport(e,t);a&&(o||s)&&n.push(i)}return n}const Tue="viewport-element";function NL(t){const{element:e,viewportId:n}=t.detail;xue(e),Sue(e),x8.removeViewportElement(n,e),F_.disable(e),ib.disable(e),tb.disable(e),af.disable(e),nL.disable(e),oL.disable(e),xL.disable(e),EL.disable(e),VL.disable(e),mL.disable(e),CL.disable(e),bL.disable(e),Cue(e),wue(e),Eue(e)}const Cue=t=>{const e=We(t);if(!e)return;yue(e.viewportId,e.renderingEngineId).forEach(r=>{r.remove(e)})},wue=t=>{const e=We(t);if(!e)return;const{renderingEngineId:n,viewportId:r}=e,i=Vr(r,n);i&&i.removeViewports(n,r)};function xue(t){const{viewportUid:e,renderingEngineUid:n}=t.dataset,r=`${e}:${n}`;delete $e.svgNodeCache[r]}function Sue(t){const e=t.querySelector(`div.${Tue}`),n=e.querySelector("svg");n&&e.removeChild(n)}const Eue=function(t){const e=$e.enabledElements.findIndex(n=>n===t);e>-1&&$e.enabledElements.splice(e,1)},zh=function(t){const{viewportId:e}=t.detail;Zb(e)};let EC=!1;function Oue(t={}){EC||(Due(),Mue(),EC=!0)}function Due(){Rue();const t=Oe.ELEMENT_ENABLED,e=Oe.ELEMENT_DISABLED;Ee.addEventListener(t,PL),Ee.addEventListener(e,NL),LL.enable()}function Rue(){const t=Oe.ELEMENT_ENABLED,e=Oe.ELEMENT_DISABLED;Ee.removeEventListener(t,PL),Ee.removeEventListener(e,NL),LL.disable()}function Mue(){_ue(),Ee.addEventListener(he.ANNOTATION_COMPLETED,rL),Ee.addEventListener(he.ANNOTATION_MODIFIED,iL),Ee.addEventListener(he.ANNOTATION_SELECTION_CHANGE,Wh),Ee.addEventListener(he.ANNOTATION_SELECTION_CHANGE,Wh),Ee.addEventListener(he.ANNOTATION_REMOVED,Rle),Ee.addEventListener(he.SEGMENTATION_MODIFIED,tL),Ee.addEventListener(he.SEGMENTATION_DATA_MODIFIED,eL),Ee.addEventListener(he.SEGMENTATION_REPRESENTATION_MODIFIED,zh),Ee.addEventListener(he.SEGMENTATION_REPRESENTATION_ADDED,zh)}function _ue(){Ee.removeEventListener(he.ANNOTATION_COMPLETED,rL),Ee.removeEventListener(he.ANNOTATION_MODIFIED,iL),Ee.removeEventListener(he.ANNOTATION_SELECTION_CHANGE,Wh),Ee.removeEventListener(he.ANNOTATION_SELECTION_CHANGE,Wh),Ee.removeEventListener(he.SEGMENTATION_MODIFIED,tL),Ee.removeEventListener(he.SEGMENTATION_DATA_MODIFIED,eL),Ee.removeEventListener(he.SEGMENTATION_REPRESENTATION_MODIFIED,zh),Ee.removeEventListener(he.SEGMENTATION_REPRESENTATION_ADDED,zh)}class Ep extends Bu{constructor(e={},n={supportedInteractionTypes:["Mouse","Touch"]}){super(e,n)}touchDragCallback(e){this._dragCallback(e)}mouseDragCallback(e){this._dragCallback(e)}_dragCallback(e){const{element:n,deltaPoints:r}=e.detail,i=We(n),a=r.world;if(a[0]===0&&a[1]===0&&a[2]===0)return;const o=i.viewport.getCamera(),{focalPoint:s,position:c}=o,l=[c[0]-a[0],c[1]-a[1],c[2]-a[2]],f=[s[0]-a[0],s[1]-a[1],s[2]-a[2]];i.viewport.setCamera({focalPoint:f,position:l}),i.viewport.render()}}Ep.toolName="Pan";class Op extends Bu{constructor(e={},n={supportedInteractionTypes:["Mouse","Touch"],configuration:{zoomToCenter:!1,minZoomScale:.001,maxZoomScale:3e3,pinchToZoom:!0,pan:!0,invert:!1}}){super(e,n),this.preMouseDownCallback=r=>{const i=r.detail,{element:a,currentPoints:o}=i,s=o.world,l=We(a).viewport.getCamera(),{focalPoint:f}=l;this.initialMousePosWorld=s;let u=Cn(f[0]-s[0],f[1]-s[1],f[2]-s[2]);return u=wn(Le(),u),this.dirVec=u,!1},this.preTouchStartCallback=r=>{if(!this.configuration.pinchToZoom)return this.preMouseDownCallback(r)},this._dragParallelProjection=(r,i,a,o=!1)=>{const{element:s,deltaPoints:c}=r.detail,l=o?r.detail.deltaDistance.canvas:c.canvas[1],f=[s.clientWidth,s.clientHeight],{parallelScale:u,focalPoint:g,position:d}=a,h=5/f[1],p=l*h*(this.configuration.invert?-1:1),m=(1-p)*u;let v=g,y=d;if(!this.configuration.zoomToCenter){const k=Gg(g,this.initialMousePosWorld);y=vr(Le(),d,this.dirVec,-k*p),v=vr(Le(),g,this.dirVec,-k*p)}const T=i.getImageData();let C=[1,1,1];T&&(C=T.spacing);const{minZoomScale:w,maxZoomScale:x}=this.configuration,O=s.clientHeight*C[1]*.5,M=O/m;let A=m,_=!1;T&&(M<w?(A=O/w,_=!0):M>=x&&(A=O/x,_=!0)),i.setCamera({parallelScale:A,focalPoint:_?g:v,position:_?d:y})},this._dragPerspectiveProjection=(r,i,a,o=!1)=>{const{element:s,deltaPoints:c}=r.detail,l=o?r.detail.deltaDistance.canvas:c.canvas[1],f=[s.clientWidth,s.clientHeight],{position:u,focalPoint:g,viewPlaneNormal:d}=a,h=fa.distance2BetweenPoints(u,g),p=Math.sqrt(h)/f[1],m=[-d[0],-d[1],-d[2]],v=this.configuration.invert?l/p:l*p;let y=v*m[0];u[0]+=y,g[0]+=y,y=v*m[1],u[1]+=y,g[1]+=y,y=v*m[2],u[2]+=y,g[2]+=y,i.setCamera({position:u,focalPoint:g})},this.initialMousePosWorld=[0,0,0],this.dirVec=[0,0,0],this.configuration.pinchToZoom?this.touchDragCallback=this._pinchCallback.bind(this):this.touchDragCallback=this._dragCallback.bind(this),this.mouseDragCallback=this._dragCallback.bind(this)}_pinchCallback(e){if(e.detail.currentPointsList.length>1){const{element:r,currentPoints:i}=e.detail,a=We(r),{viewport:o}=a,s=o.getCamera(),c=i.world,{focalPoint:l}=s;this.initialMousePosWorld=c;let f=Cn(l[0]-c[0],l[1]-c[1],l[2]-c[2]);f=wn(Le(),f),this.dirVec=f,s.parallelProjection?this._dragParallelProjection(e,o,s,!0):this._dragPerspectiveProjection(e,o,s,!0),o.render()}this.configuration.pan&&this._panCallback(e)}_dragCallback(e){const{element:n}=e.detail,r=We(n),{viewport:i}=r,a=i.getCamera();a.parallelProjection?this._dragParallelProjection(e,i,a):this._dragPerspectiveProjection(e,i,a),i.render()}_panCallback(e){const{element:n,deltaPoints:r}=e.detail,i=We(n),a=r.world,o=i.viewport.getCamera(),{focalPoint:s,position:c}=o,l=[c[0]-a[0],c[1]-a[1],c[2]-a[2]],f=[s[0]-a[0],s[1]-a[1],s[2]-a[2]];i.viewport.setCamera({focalPoint:f,position:l}),i.viewport.render()}}Op.toolName="Zoom";tX(_R);function bue({id:t,zoomLevel:e,onZoomChange:n,syncZoom:r,onSyncToggle:i,onRemove:a,isSyncMaster:o}){const s=Fn.useRef(null),c=Fn.useRef(!1),l=Fn.useRef(null),f=Fn.useRef(null),[u,g]=Fn.useState(!1),d=Fn.useRef(!1),h=Fn.useRef(null),p=Fn.useRef(null),m=Fn.useRef(1),v=Fn.useCallback(C=>{var w;if(!(!u||d.current))try{const x=(w=l.current)==null?void 0:w.getCamera();if(!x)return;const A=150/x.parallelScale*100,_=Math.max(.01,Math.min(10,A/100)),k=p.current!==null;n(_,k)}catch(x){console.warn(`[Viewer ${t}] Zoom change error:`,x)}},[n,u,t,r]),y=Fn.useCallback((C,w)=>{if(!(!u||!l.current||!f.current)&&w!==t)try{d.current=!0,p.current=w;const O=150/C;l.current.setCamera({parallelScale:O}),l.current.render(),m.current=C}catch(x){console.warn(`[Viewer ${t}] Apply zoom error:`,x)}finally{setTimeout(()=>{d.current=!1,p.current=null},10)}},[u,t]);Fn.useEffect(()=>((async()=>{if(c.current)return;c.current=!0,g(!1),await uW(),await Oue(),vne({maxWebWorkers:1});try{sv(Op),sv(Ep)}catch(k){console.warn("Error adding tools:",k)}const w=await fre("/dicom-image.dcm"),x=`renderingEngine_${t}_${Date.now()}`,O=new tM(x);f.current=O;const M=`viewport_${t}_${Date.now()}`,A={viewportId:M,type:un.STACK,element:s.current};O.enableElement(A);const _=O.getViewport(M);l.current=_,await _.setStack(w);try{if(!Iie){console.warn("ToolGroupManager not available");return}const k=`toolGroup_${t}_${Date.now()}`,z=T_(k);h.current=z,z?(z.addTool(Op.toolName),z.addTool(Ep.toolName),z.addViewport(M,x),z.setToolActive(Op.toolName,{bindings:[{mouseButton:cs.Secondary},{mouseButton:cs.Primary,modifierKey:Ei.Ctrl}]}),z.setToolActive(Ep.toolName,{bindings:[{mouseButton:cs.Primary}]})):console.warn(`Failed to create ToolGroup for viewer ${t}`)}catch(k){console.warn(`ToolGroup creation error for viewer ${t}:`,k)}_.render(),setTimeout(()=>{g(!0)},50)})(),()=>{try{g(!1),f.current&&(f.current.destroy(),f.current=null),l.current=null,h.current=null,c.current=!1}catch(w){console.warn("Cleanup error:",w)}}),[t]),Fn.useEffect(()=>{if(u){const C=s.current;if(C){C.addEventListener("cornerstonecameramodified",v);const{eventTarget:w}=require("@cornerstonejs/core");w.addEventListener("CORNERSTONE_CAMERA_MODIFIED",v);const x=O=>{if(O.preventDefault(),!(!u||!l.current||d.current))try{const M=O.deltaY>0?.9:1.1,k=l.current.getCamera().parallelScale*M;l.current.setCamera({parallelScale:k}),l.current.render(),setTimeout(()=>{v({type:"manual-zoom"})},50)}catch(M){console.warn(`[Viewer ${t}] Wheel zoom error:`,M)}};return C.addEventListener("wheel",x),()=>{C.removeEventListener("cornerstonecameramodified",v),C.removeEventListener("wheel",x),w.removeEventListener("CORNERSTONE_CAMERA_MODIFIED",v)}}}},[u,v,t]),Fn.useEffect(()=>{if(!u||!l.current)return;const C=setInterval(()=>{var w;try{const x=(w=l.current)==null?void 0:w.getCamera();if(!x)return;const A=150/x.parallelScale,_=Math.max(.01,Math.min(10,A));if(Math.abs(_-m.current)>.01){m.current=_;const k=p.current!==null;n(_,k)}}catch(x){console.warn(`[Viewer ${t}] Manual zoom check error:`,x)}},100);return()=>{clearInterval(C)}},[u,t,n]),Fn.useEffect(()=>{if(!u||!l.current||!f.current||o)return;const O=150/l.current.getCamera().parallelScale;Math.abs(e-O)>.01&&y(e,"external")},[e,u,t,o,y]);const T=()=>{try{l.current&&f.current&&u&&(l.current.setCamera({parallelScale:150}),l.current.render(),n(1,!1))}catch(C){console.warn("Reset zoom error:",C)}};return hr.jsxs("div",{style:{border:"2px solid #ccc",borderRadius:"8px",padding:"10px",backgroundColor:"#f9f9f9",minWidth:"300px"},children:[hr.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"10px"},children:[hr.jsxs("span",{style:{fontWeight:"bold"},children:["Viewer ",t]}),hr.jsx("button",{onClick:a,style:{padding:"2px 8px",backgroundColor:"#dc3545",color:"white",border:"none",borderRadius:"4px",cursor:"pointer",fontSize:"12px"},children:"Remove"})]}),hr.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px",marginBottom:"10px"},children:[hr.jsxs("span",{children:["Zoom: ",(e*100).toFixed(0),"%"]}),hr.jsx("button",{onClick:T,style:{padding:"3px 8px",backgroundColor:"#007bff",color:"white",border:"none",borderRadius:"4px",cursor:"pointer",fontSize:"12px"},children:"Reset"}),hr.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"5px",fontSize:"12px"},children:[hr.jsx("input",{type:"checkbox",checked:r,onChange:C=>i(C.target.checked)}),"Sync"]})]}),hr.jsx("div",{ref:s,style:{width:"300px",height:"300px",backgroundColor:"#000"}})]})}function Lue(){const[t,e]=Fn.useState(()=>{const c=localStorage.getItem("viewers");return c?JSON.parse(c).map((f,u)=>({...f,id:(u+1).toString()})):[{id:"1",zoomLevel:1,syncZoom:!1}]}),n=Fn.useRef(null);Fn.useEffect(()=>{localStorage.setItem("viewers",JSON.stringify(t))},[t]);const r=c=>c.map((l,f)=>({...l,id:(f+1).toString()})),i=()=>{const l={id:(t.length+1).toString(),zoomLevel:1,syncZoom:!1};e(f=>[...f,l])},a=c=>{e(l=>{const f=l.filter(u=>u.id!==c);return r(f)})},o=(c,l,f)=>{e(u=>{const g=u.map(d=>d.id===c?{...d,zoomLevel:l}:d);if(!f){const d=g.find(h=>h.id===c);d&&d.syncZoom&&g.filter(p=>p.id!==c&&p.syncZoom).forEach(p=>{const m=g.findIndex(v=>v.id===p.id);m!==-1&&(g[m]={...p,zoomLevel:l})})}return g})},s=(c,l)=>{e(f=>{const u=f.map(g=>g.id===c?{...g,syncZoom:l}:g);if(l){const g=u.filter(d=>d.id!==c&&d.syncZoom);if(g.length>0){const d=g[0].zoomLevel,h=u.findIndex(p=>p.id===c);h!==-1&&(u[h]={...u[h],zoomLevel:d})}}return u})};return hr.jsxs("div",{style:{padding:"20px",fontFamily:"Arial, sans-serif"},children:[hr.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"20px"},children:[hr.jsx("h1",{style:{margin:0},children:"DICOM Multi-Viewer"}),hr.jsx("button",{onClick:i,style:{padding:"10px 20px",backgroundColor:"#007bff",color:"white",border:"none",borderRadius:"4px",cursor:"pointer"},children:"Add Viewer"})]}),hr.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(320px, 1fr))",gap:"20px",maxHeight:"80vh",overflowY:"auto"},children:t.map(c=>hr.jsx(bue,{id:c.id,zoomLevel:c.zoomLevel,onZoomChange:(l,f)=>o(c.id,l,f),syncZoom:c.syncZoom,onSyncToggle:l=>s(c.id,l),onRemove:()=>a(c.id),isSyncMaster:n.current===c.id},c.id))})]})}xm.createRoot(document.getElementById("root")).render(hr.jsx(QL.StrictMode,{children:hr.jsx(Lue,{})}));
